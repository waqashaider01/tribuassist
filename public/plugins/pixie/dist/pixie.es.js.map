{"version":3,"file":"pixie.es.js","sources":["../node_modules/deepmerge/dist/cjs.js","../node_modules/style-inject/dist/style-inject.es.js","../node_modules/number-precision/build/index.es.js","../node_modules/@sentry/utils/esm/global.js","../node_modules/@sentry/utils/esm/is.js","../node_modules/@sentry/utils/esm/browser.js","../node_modules/@sentry/utils/esm/error.js","../node_modules/@sentry/utils/esm/dsn.js","../node_modules/@sentry/utils/esm/logger.js","../node_modules/@sentry/utils/esm/string.js","../node_modules/@sentry/utils/esm/object.js","../node_modules/@sentry/utils/esm/stacktrace.js","../node_modules/@sentry/utils/esm/supports.js","../node_modules/@sentry/utils/esm/instrument.js","../node_modules/@sentry/utils/esm/memo.js","../node_modules/@sentry/utils/esm/misc.js","../node_modules/@sentry/utils/esm/env.js","../node_modules/@sentry/utils/esm/node.js","../node_modules/@sentry/utils/esm/normalize.js","../node_modules/@sentry/utils/esm/syncpromise.js","../node_modules/@sentry/utils/esm/promisebuffer.js","../node_modules/@sentry/utils/esm/url.js","../node_modules/@sentry/utils/esm/severity.js","../node_modules/@sentry/utils/esm/time.js","../node_modules/@sentry/utils/esm/envelope.js","../node_modules/@sentry/utils/esm/clientreport.js","../node_modules/@sentry/utils/esm/ratelimit.js","../node_modules/@sentry/hub/esm/session.js","../node_modules/@sentry/hub/esm/scope.js","../node_modules/@sentry/hub/esm/hub.js","../node_modules/@sentry/hub/esm/exports.js","../node_modules/@sentry/core/esm/api.js","../node_modules/@sentry/core/esm/envelope.js","../node_modules/@sentry/core/esm/integration.js","../node_modules/@sentry/core/esm/baseclient.js","../node_modules/@sentry/core/esm/sdk.js","../node_modules/@sentry/core/esm/transports/base.js","../node_modules/@sentry/core/esm/version.js","../node_modules/@sentry/core/esm/integrations/functiontostring.js","../node_modules/@sentry/core/esm/integrations/inboundfilters.js","../node_modules/@sentry/browser/esm/eventbuilder.js","../node_modules/@sentry/browser/esm/integrations/breadcrumbs.js","../node_modules/@sentry/browser/esm/client.js","../node_modules/@sentry/browser/esm/transports/utils.js","../node_modules/@sentry/browser/esm/transports/fetch.js","../node_modules/@sentry/browser/esm/transports/xhr.js","../node_modules/@sentry/browser/esm/stack-parsers.js","../node_modules/@sentry/browser/esm/helpers.js","../node_modules/@sentry/browser/esm/integrations/globalhandlers.js","../node_modules/@sentry/browser/esm/integrations/trycatch.js","../node_modules/@sentry/browser/esm/integrations/linkederrors.js","../node_modules/@sentry/browser/esm/integrations/httpcontext.js","../node_modules/@sentry/browser/esm/integrations/dedupe.js","../node_modules/@sentry/browser/esm/sdk.js","../node_modules/@sentry/react/esm/sdk.js","../node_modules/react/cjs/react-jsx-runtime.production.min.js","../node_modules/react/jsx-runtime.js","../src/config/editor-mode.ts","../src/ui/navbar/nav-position.ts","../src/config/default-shapes.ts","../src/config/emoticons.ts","../src/common/i18n/message.ts","../src/config/default-stickers.ts","../src/config/default-object-props.ts","../src/tools/draw/draw-defaults.ts","../src/config/editor-theme.ts","../src/config/default-themes.ts","../src/tools/tool-name.ts","../node_modules/clsx/dist/clsx.m.js","../src/common/icons/svg-icon.tsx","../src/common/icons/create-svg-icon.tsx","../src/common/icons/material/Tune.tsx","../src/common/icons/material/PhotoSizeSelectLarge.tsx","../src/common/icons/material/Crop.tsx","../src/common/icons/material/TextFields.tsx","../src/common/icons/material/Extension.tsx","../src/common/icons/material/Face.tsx","../src/common/icons/material/FilterFrames.tsx","../src/common/icons/material/Merge.tsx","../src/common/icons/material/RoundedCorner.tsx","../src/common/icons/material/PhotoLibrary.tsx","../src/common/icons/material/History.tsx","../src/common/icons/material/Style.tsx","../src/common/icons/material/Delete.tsx","../src/ui/icons/draw.tsx","../src/common/icons/material/Home.tsx","../src/tools/history/history-display-names.ts","../src/config/default-nav-items.ts","../src/common/icons/material/FileDownload.tsx","../src/config/default-config.ts","../node_modules/zustand/esm/vanilla.js","../node_modules/use-sync-external-store/cjs/use-sync-external-store-shim.production.min.js","../node_modules/use-sync-external-store/shim/index.js","../node_modules/use-sync-external-store/cjs/use-sync-external-store-shim/with-selector.production.min.js","../node_modules/use-sync-external-store/shim/with-selector.js","../node_modules/zustand/esm/index.js","../node_modules/zustand/esm/middleware.js","../node_modules/immer/dist/immer.esm.js","../src/common/utils/string/lower-first.ts","../src/config/merge-config.ts","../src/tools/history/state/history-slice.ts","../src/state/editor-state.ts","../src/tools/filter/filter-slice.ts","../src/tools/crop/crop-slice.ts","../src/objects/utils/is-text.ts","../src/objects/object-name.ts","../src/objects/utils/is-image.ts","../src/objects/state/default-active-obj-props.ts","../src/objects/state/fabric-obj-to-state.ts","../src/objects/state/objects-slice.ts","../src/tools/frame/frame-slice.ts","../src/tools/resize/state/resize-slice.ts","../src/tools/corners/corners-slice.ts","../node_modules/zustand/esm/middleware/immer.js","../node_modules/color-name/index.js","../node_modules/simple-swizzle/node_modules/is-arrayish/index.js","../node_modules/simple-swizzle/index.js","../node_modules/color-string/index.js","../node_modules/color/node_modules/color-name/index.js","../node_modules/color/node_modules/color-convert/conversions.js","../node_modules/color/node_modules/color-convert/route.js","../node_modules/color/node_modules/color-convert/index.js","../node_modules/color/index.js","../src/utils/pixie-theme-to-css-theme.ts","../src/common/core/root-el.ts","../src/common/ui/themes/utils/set-theme-color.ts","../src/common/ui/themes/utils/apply-theme-to-dom.ts","../src/state/store.ts","../src/state/utils.ts","../src/utils/reset-editor.ts","../src/tools/import/fetch-state-json-from-url.ts","../src/objects/static-object-config.ts","../src/tools/history/state/get-current-canvas-state.ts","../src/ui/navbar/set-active-tool.ts","../src/tools/canvas/canvas-is-empty.ts","../node_modules/nanoid/index.browser.js","../src/common/ui/toast/toast-timer.ts","../src/common/ui/toast/toast-store.ts","../src/common/ui/toast/toast.ts","../node_modules/react-dom/client.js","../node_modules/framer-motion/dist/es/context/MotionConfigContext.mjs","../node_modules/framer-motion/dist/es/context/MotionContext/index.mjs","../node_modules/framer-motion/dist/es/context/PresenceContext.mjs","../node_modules/framer-motion/dist/es/utils/is-browser.mjs","../node_modules/framer-motion/dist/es/utils/use-isomorphic-effect.mjs","../node_modules/framer-motion/dist/es/context/LazyContext.mjs","../node_modules/framer-motion/dist/es/motion/utils/use-visual-element.mjs","../node_modules/framer-motion/dist/es/utils/is-ref-object.mjs","../node_modules/framer-motion/dist/es/motion/utils/use-motion-ref.mjs","../node_modules/framer-motion/dist/es/render/utils/is-variant-label.mjs","../node_modules/framer-motion/dist/es/animation/utils/is-animation-controls.mjs","../node_modules/framer-motion/dist/es/render/utils/is-controlling-variants.mjs","../node_modules/framer-motion/dist/es/context/MotionContext/utils.mjs","../node_modules/framer-motion/dist/es/context/MotionContext/create.mjs","../node_modules/framer-motion/dist/es/motion/features/definitions.mjs","../node_modules/framer-motion/dist/es/motion/features/load-features.mjs","../node_modules/framer-motion/dist/es/utils/use-constant.mjs","../node_modules/framer-motion/dist/es/projection/node/state.mjs","../node_modules/framer-motion/dist/es/projection/node/id.mjs","../node_modules/framer-motion/dist/es/context/LayoutGroupContext.mjs","../node_modules/framer-motion/dist/es/motion/utils/VisualElementHandler.mjs","../node_modules/framer-motion/dist/es/context/SwitchLayoutGroupContext.mjs","../node_modules/framer-motion/dist/es/motion/utils/symbol.mjs","../node_modules/framer-motion/dist/es/motion/index.mjs","../node_modules/framer-motion/dist/es/render/dom/motion-proxy.mjs","../node_modules/framer-motion/dist/es/render/svg/lowercase-elements.mjs","../node_modules/framer-motion/dist/es/render/dom/utils/is-svg-component.mjs","../node_modules/framer-motion/dist/es/projection/styles/scale-correction.mjs","../node_modules/framer-motion/dist/es/render/html/utils/transform.mjs","../node_modules/framer-motion/dist/es/motion/utils/is-forced-motion-value.mjs","../node_modules/framer-motion/dist/es/value/utils/is-motion-value.mjs","../node_modules/framer-motion/dist/es/render/html/utils/build-transform.mjs","../node_modules/framer-motion/dist/es/render/dom/utils/is-css-variable.mjs","../node_modules/framer-motion/dist/es/render/dom/value-types/get-as-type.mjs","../node_modules/style-value-types/dist/es/utils.mjs","../node_modules/style-value-types/dist/es/numbers/index.mjs","../node_modules/style-value-types/dist/es/numbers/units.mjs","../node_modules/style-value-types/dist/es/color/utils.mjs","../node_modules/style-value-types/dist/es/color/hsla.mjs","../node_modules/style-value-types/dist/es/color/rgba.mjs","../node_modules/style-value-types/dist/es/color/hex.mjs","../node_modules/style-value-types/dist/es/color/index.mjs","../node_modules/style-value-types/dist/es/complex/index.mjs","../node_modules/style-value-types/dist/es/complex/filter.mjs","../node_modules/framer-motion/dist/es/render/dom/value-types/type-int.mjs","../node_modules/framer-motion/dist/es/render/dom/value-types/number.mjs","../node_modules/framer-motion/dist/es/render/html/utils/build-styles.mjs","../node_modules/framer-motion/dist/es/render/html/utils/create-render-state.mjs","../node_modules/framer-motion/dist/es/render/html/use-props.mjs","../node_modules/framer-motion/dist/es/motion/utils/valid-prop.mjs","../node_modules/framer-motion/dist/es/render/dom/utils/filter-props.mjs","../node_modules/framer-motion/dist/es/render/svg/utils/transform-origin.mjs","../node_modules/framer-motion/dist/es/render/svg/utils/path.mjs","../node_modules/framer-motion/dist/es/render/svg/utils/build-attrs.mjs","../node_modules/framer-motion/dist/es/render/svg/utils/create-render-state.mjs","../node_modules/framer-motion/dist/es/render/svg/use-props.mjs","../node_modules/framer-motion/dist/es/render/dom/use-render.mjs","../node_modules/framer-motion/dist/es/render/dom/utils/camel-to-dash.mjs","../node_modules/framer-motion/dist/es/render/html/utils/render.mjs","../node_modules/framer-motion/dist/es/render/svg/utils/camel-case-attrs.mjs","../node_modules/framer-motion/dist/es/render/svg/utils/render.mjs","../node_modules/framer-motion/dist/es/render/html/utils/scrape-motion-values.mjs","../node_modules/framer-motion/dist/es/render/svg/utils/scrape-motion-values.mjs","../node_modules/framer-motion/dist/es/render/utils/resolve-variants.mjs","../node_modules/framer-motion/dist/es/animation/utils/is-keyframes-target.mjs","../node_modules/framer-motion/dist/es/utils/resolve-value.mjs","../node_modules/framer-motion/dist/es/value/utils/resolve-motion-value.mjs","../node_modules/framer-motion/dist/es/motion/utils/use-visual-state.mjs","../node_modules/framer-motion/dist/es/render/svg/config-motion.mjs","../node_modules/framer-motion/dist/es/render/html/config-motion.mjs","../node_modules/framer-motion/dist/es/render/dom/utils/create-config.mjs","../node_modules/framer-motion/dist/es/render/utils/types.mjs","../node_modules/framer-motion/dist/es/events/use-dom-event.mjs","../node_modules/framer-motion/dist/es/gestures/use-focus-gesture.mjs","../node_modules/framer-motion/dist/es/gestures/utils/event-type.mjs","../node_modules/framer-motion/dist/es/events/event-info.mjs","../node_modules/framer-motion/dist/es/events/utils.mjs","../node_modules/framer-motion/dist/es/events/use-pointer-event.mjs","../node_modules/framer-motion/dist/es/gestures/drag/utils/lock.mjs","../node_modules/framer-motion/dist/es/gestures/use-hover-gesture.mjs","../node_modules/framer-motion/dist/es/gestures/utils/is-node-or-child.mjs","../node_modules/framer-motion/dist/es/utils/use-unmount-effect.mjs","../node_modules/popmotion/node_modules/tslib/tslib.es6.js","../node_modules/hey-listen/dist/hey-listen.es.js","../node_modules/popmotion/dist/es/utils/clamp.mjs","../node_modules/popmotion/dist/es/animations/utils/find-spring.mjs","../node_modules/popmotion/dist/es/animations/generators/spring.mjs","../node_modules/popmotion/dist/es/utils/progress.mjs","../node_modules/popmotion/dist/es/utils/mix.mjs","../node_modules/popmotion/dist/es/utils/hsla-to-rgba.mjs","../node_modules/popmotion/dist/es/utils/mix-color.mjs","../node_modules/popmotion/dist/es/utils/inc.mjs","../node_modules/popmotion/dist/es/utils/pipe.mjs","../node_modules/popmotion/dist/es/utils/mix-complex.mjs","../node_modules/popmotion/dist/es/utils/interpolate.mjs","../node_modules/popmotion/dist/es/easing/utils.mjs","../node_modules/popmotion/dist/es/easing/index.mjs","../node_modules/popmotion/dist/es/animations/generators/keyframes.mjs","../node_modules/popmotion/dist/es/animations/generators/decay.mjs","../node_modules/popmotion/dist/es/animations/utils/detect-animation-from-options.mjs","../node_modules/framesync/dist/es/on-next-frame.mjs","../node_modules/framesync/dist/es/create-render-step.mjs","../node_modules/framesync/dist/es/index.mjs","../node_modules/popmotion/dist/es/animations/utils/elapsed.mjs","../node_modules/popmotion/dist/es/animations/index.mjs","../node_modules/popmotion/dist/es/utils/velocity-per-second.mjs","../node_modules/popmotion/dist/es/animations/inertia.mjs","../node_modules/popmotion/dist/es/easing/cubic-bezier.mjs","../node_modules/framer-motion/dist/es/gestures/use-tap-gesture.mjs","../node_modules/framer-motion/dist/es/utils/process.mjs","../node_modules/framer-motion/dist/es/utils/warn-once.mjs","../node_modules/framer-motion/dist/es/motion/features/viewport/observers.mjs","../node_modules/framer-motion/dist/es/motion/features/viewport/use-viewport.mjs","../node_modules/framer-motion/dist/es/motion/utils/make-renderless-component.mjs","../node_modules/framer-motion/dist/es/motion/features/gestures.mjs","../node_modules/framer-motion/dist/es/components/AnimatePresence/use-presence.mjs","../node_modules/framer-motion/dist/es/utils/shallow-compare.mjs","../node_modules/framer-motion/dist/es/utils/time-conversion.mjs","../node_modules/framer-motion/dist/es/animation/utils/easing.mjs","../node_modules/framer-motion/dist/es/animation/utils/is-animatable.mjs","../node_modules/framer-motion/dist/es/animation/utils/default-transitions.mjs","../node_modules/framer-motion/dist/es/render/dom/value-types/defaults.mjs","../node_modules/framer-motion/dist/es/render/dom/value-types/animatable-none.mjs","../node_modules/framer-motion/dist/es/utils/use-instant-transition-state.mjs","../node_modules/framer-motion/dist/es/animation/utils/transitions.mjs","../node_modules/framer-motion/dist/es/utils/is-numerical-string.mjs","../node_modules/framer-motion/dist/es/utils/is-zero-value-string.mjs","../node_modules/framer-motion/dist/es/utils/array.mjs","../node_modules/framer-motion/dist/es/utils/subscription-manager.mjs","../node_modules/framer-motion/dist/es/value/index.mjs","../node_modules/framer-motion/dist/es/render/dom/value-types/test.mjs","../node_modules/framer-motion/dist/es/render/dom/value-types/type-auto.mjs","../node_modules/framer-motion/dist/es/render/dom/value-types/dimensions.mjs","../node_modules/framer-motion/dist/es/render/dom/value-types/find.mjs","../node_modules/framer-motion/dist/es/render/utils/resolve-dynamic-variants.mjs","../node_modules/framer-motion/dist/es/render/utils/setters.mjs","../node_modules/framer-motion/dist/es/value/use-will-change/is.mjs","../node_modules/framer-motion/dist/es/render/utils/animation.mjs","../node_modules/framer-motion/dist/es/render/utils/animation-state.mjs","../node_modules/framer-motion/dist/es/motion/features/animations.mjs","../node_modules/framer-motion/dist/es/projection/geometry/conversion.mjs","../node_modules/framer-motion/dist/es/projection/utils/measure.mjs","../node_modules/framer-motion/dist/es/utils/reduced-motion/state.mjs","../node_modules/framer-motion/dist/es/utils/reduced-motion/index.mjs","../node_modules/framer-motion/dist/es/render/utils/lifecycles.mjs","../node_modules/framer-motion/dist/es/render/utils/motion-values.mjs","../node_modules/framer-motion/dist/es/render/index.mjs","../node_modules/framer-motion/dist/es/render/dom/utils/css-variables-conversion.mjs","../node_modules/framer-motion/dist/es/render/dom/utils/unit-conversion.mjs","../node_modules/framer-motion/dist/es/render/dom/utils/parse-dom-variant.mjs","../node_modules/framer-motion/dist/es/render/html/visual-element.mjs","../node_modules/framer-motion/dist/es/render/svg/visual-element.mjs","../node_modules/framer-motion/dist/es/render/dom/create-visual-element.mjs","../node_modules/framer-motion/dist/es/render/dom/motion-minimal.mjs","../node_modules/framer-motion/dist/es/utils/use-is-mounted.mjs","../node_modules/framer-motion/dist/es/utils/use-force-update.mjs","../node_modules/framer-motion/dist/es/components/AnimatePresence/PopChild.mjs","../node_modules/framer-motion/dist/es/components/AnimatePresence/PresenceChild.mjs","../node_modules/framer-motion/dist/es/components/AnimatePresence/index.mjs","../node_modules/framer-motion/dist/es/components/LazyMotion/index.mjs","../node_modules/framer-motion/dist/es/render/dom/features-animation.mjs","../node_modules/@react-stately/utils/dist/module.js","../node_modules/@react-aria/ssr/dist/module.js","../node_modules/@react-aria/utils/dist/module.js","../__vite-browser-external","../node_modules/fabric/dist/fabric.js","../src/objects/default-obj-config.ts","../src/common/utils/string/random-string.ts","../src/utils/init-fabric.ts","../src/common/ui/interactions/active-interaction.ts","../src/tools/zoom-tool.ts","../src/tools/canvas/load-fabric-image.ts","../src/tools/canvas/pixie-canvas.ts","../src/objects/utils/is-svg-sticker.ts","../src/objects/size-and-position-props.ts","../src/objects/object-modified-event.ts","../src/objects/bind-to-fabric-selection-events.ts","../src/objects/object-tool.ts","../src/tools/history/serialized-pixie-state.ts","../src/tools/history/state/create-history-item.ts","../src/tools/text/text-tool.ts","../src/common/ui/font-picker/load-fonts.ts","../src/common/utils/urls/is-absolute-url.ts","../src/utils/asset-url.ts","../src/tools/history/history-tool.ts","../src/tools/merge/merge-tool.ts","../src/tools/filter/filter-list.ts","../src/common/utils/string/uc-first.ts","../src/tools/filter/filter-tool.ts","../src/tools/resize/clamp-resize-payload.ts","../src/tools/resize/resize-tool.ts","../src/tools/crop/ui/cropzone/draw-cropzone.ts","../src/common/ui/interactions/utils/calc-new-size-from-aspect-ratio.ts","../src/common/ui/interactions/utils/center-within-boundary.ts","../src/tools/crop/crop-tool.ts","../src/tools/shapes/shape-tool.ts","../src/tools/frame/frame-patterns.ts","../src/tools/frame/frame-builder.ts","../src/tools/frame/active-frame.ts","../src/tools/frame/frame-tool.ts","../src/tools/draw/brushes/v-line-brush.ts","../src/tools/draw/brushes/h-line-brush.ts","../src/tools/draw/brushes/diamond-brush.ts","../src/tools/draw/brushes/square-brush.ts","../src/tools/draw/draw-tool.ts","../src/common/uploads/utils/extension-from-filename.ts","../src/common/uploads/utils/get-file-mime.ts","../src/common/workspace/active-workspace-id.ts","../src/common/uploads/uploaded-file.ts","../src/common/uploads/utils/create-upload-input.ts","../src/common/uploads/utils/open-upload-window.ts","../src/tools/canvas/add-image.ts","../src/common/uploads/types/upload-input-config.ts","../src/common/uploads/utils/pretty-bytes.ts","../node_modules/wildcard/index.js","../node_modules/mime-match/index.js","../src/common/uploads/uploader/validate-upload.ts","../src/common/uploads/utils/convert-to-bytes.ts","../src/tools/import/import-tool.ts","../src/tools/export/watermark-tool.ts","../node_modules/file-saver/dist/FileSaver.min.js","../src/tools/export/b64-to-blob.ts","../src/tools/export/export-tool.ts","../src/tools/corners/corners-tool.ts","../src/tools/transform/transform-tool.ts","../src/tools/init-tools.ts","../src/common/utils/dom/observe-size.ts","../src/common/utils/dom/get-bounding-client-rect.ts","../src/ui/toolbar/toolbar-style.tsx","../src/common/ui/buttons/button-size.ts","../src/common/ui/buttons/get-shared-button-style.ts","../src/common/utils/dom/create-event-handler.ts","../src/common/ui/buttons/button-base.tsx","../src/common/ui/buttons/button.tsx","../node_modules/nano-memoize/index.js","../src/common/ui/forms/listbox/section.tsx","../src/common/ui/forms/listbox/build-listbox-collection.ts","../node_modules/@floating-ui/core/dist/floating-ui.core.esm.js","../node_modules/@floating-ui/dom/dist/floating-ui.dom.esm.js","../node_modules/@floating-ui/react-dom/dist/floating-ui.react-dom.esm.js","../node_modules/react-merge-refs/dist/index.mjs","../src/common/ui/overlays/floating-position.ts","../src/common/ui/forms/listbox/use-listbox.ts","../src/common/ui/forms/listbox/listbox-context.ts","../src/common/icons/material/Check.tsx","../src/common/ui/list/list-item-base.tsx","../src/common/ui/forms/listbox/item.tsx","../src/common/utils/hooks/is-mobile-device.ts","../src/common/ui/overlays/popover-animation.ts","../src/common/ui/overlays/use-overlay-viewport.ts","../node_modules/@react-aria/interactions/dist/module.js","../node_modules/@react-aria/focus/dist/module.js","../node_modules/@internationalized/string/dist/module.js","../node_modules/@internationalized/number/dist/module.js","../node_modules/@react-aria/overlays/dist/module.js","../src/common/ui/overlays/popover.tsx","../src/common/ui/animation/opacity-animation.ts","../src/common/ui/overlays/underlay.tsx","../src/common/ui/overlays/tray.tsx","../src/common/utils/shallow-equal.ts","../src/common/core/bootstrap-data/bootstrap-data-context.ts","../src/common/i18n/selected-locale.ts","../src/common/i18n/handle-plural-message.tsx","../src/common/i18n/trans.tsx","../src/common/ui/forms/listbox/listbox.tsx","../src/common/ui/forms/listbox/use-listbox-keyboard-navigation.ts","../src/common/i18n/use-collator.ts","../src/common/ui/forms/listbox/use-type-select.ts","../src/common/utils/hooks/use-media-query.ts","../src/common/utils/hooks/is-mobile-media-query.ts","../src/common/ui/navigation/menu/menu-trigger.tsx","../src/ui/toolbar/toolbar-item/dropdown-button.tsx","../src/common/ui/buttons/icon-button.tsx","../src/ui/mixed-icon.tsx","../src/common/i18n/mixed-text.tsx","../src/ui/toolbar/toolbar-item/toolbar-button.tsx","../src/common/ui/buttons/button-group.tsx","../src/common/icons/material/Undo.tsx","../src/common/icons/material/Redo.tsx","../src/ui/toolbar/toolbar-item/undo-redo-btns.tsx","../src/common/icons/material/Remove.tsx","../src/common/icons/material/Add.tsx","../src/ui/toolbar/toolbar-item/zoom-widget.tsx","../src/ui/toolbar/toolbar-item/toolbar-item.tsx","../src/common/icons/material/Close.tsx","../src/ui/editor-mode.ts","../src/ui/toolbar/main-toolbar.tsx","../src/tools/crop/ui/crop-nav/cropzone-size-indicator.tsx","../src/ui/toolbar/active-toolbar.tsx","../src/ui/toolbar/toolbar-container.tsx","../src/ui/stage/loading-indicator.tsx","../node_modules/@use-gesture/core/dist/maths-b2a210f4.esm.js","../node_modules/@use-gesture/core/dist/actions-aeda4790.esm.js","../node_modules/@use-gesture/core/dist/use-gesture-core.esm.js","../node_modules/@use-gesture/react/dist/use-gesture-react.esm.js","../src/common/ui/interactions/interactable-event.ts","../src/common/ui/interactions/use-pointer-events.ts","../src/common/ui/interactions/utils/restrict-resizable-within-boundary.ts","../src/common/ui/interactions/utils/dom-rect-to-obj.ts","../src/common/ui/interactions/use-resize.ts","../src/objects/ui/corner-handle.tsx","../src/tools/crop/ui/cropzone/mask-part.tsx","../src/tools/crop/ui/cropzone/cropzone-line.tsx","../src/common/utils/number/clamp.ts","../src/common/ui/interactions/use-move.ts","../src/tools/crop/ui/cropzone/cropzone.tsx","../src/ui/icons/duplicate.tsx","../src/ui/icons/flip.tsx","../src/ui/icons/front-sorting.tsx","../src/ui/icons/remove.tsx","../src/objects/ui/floating-object-controls.tsx","../src/objects/ui/object-box/object-box-actions.ts","../src/objects/ui/object-box/ratation-control.tsx","../src/common/ui/interactions/use-rotate.ts","../src/objects/ui/object-box/object-box.tsx","../src/ui/stage/stage-overlays.tsx","../src/ui/stage/canvas-wrapper.tsx","../src/ui/navbar/tool-controls-overlay-wrapper.tsx","../node_modules/react-colorful/dist/index.module.js","../node_modules/@react-stately/color/dist/module.js","../src/common/ui/color-picker/color-swatch.tsx","../src/common/ui/forms/input-field/get-input-field-class-names.ts","../src/common/ui/color-picker/color-picker.tsx","../src/common/ui/overlays/dialog/dialog-context.ts","../src/common/i18n/use-trans.ts","../src/common/ui/overlays/dialog/dismiss-button.tsx","../src/common/ui/overlays/dialog/dialog.tsx","../src/common/icons/material/KeyboardArrowDown.tsx","../src/common/ui/overlays/modal.tsx","../src/common/ui/overlays/dialog/dialog-trigger.tsx","../src/ui/color-picker-button.tsx","../src/common/ui/forms/slider/base-slider.tsx","../src/common/i18n/use-number-formatter.ts","../src/common/ui/forms/slider/use-slider.ts","../src/common/ui/forms/slider/slider-thumb.tsx","../node_modules/react-hook-form/dist/index.esm.mjs","../src/common/ui/forms/slider/slider.tsx","../src/common/ui/forms/input-field/adornment.tsx","../src/common/ui/forms/input-field/field.tsx","../src/common/ui/focus/use-auto-focus.ts","../src/common/ui/forms/input-field/use-field.ts","../src/common/ui/forms/select/select.tsx","../src/tools/filter/ui/filter-controls.tsx","../src/tools/frame/ui/active-frame-controls.tsx","../src/common/ui/tabs/tabs-context.tsx","../src/common/ui/tabs/tab-line.tsx","../src/common/ui/tabs/tab-list.tsx","../src/common/ui/tabs/tabs.tsx","../src/common/icons/material/FormatUnderlined.tsx","../src/common/icons/material/FormatStrikethrough.tsx","../src/common/icons/material/FormatItalic.tsx","../src/common/icons/material/FormatAlignRight.tsx","../src/common/icons/material/FormatAlignLeft.tsx","../src/common/icons/material/FormatAlignCenter.tsx","../src/common/ui/forms/input-field/text-field/text-field.tsx","../src/objects/ui/active-obj-controls/text-style-tab-panel.tsx","../src/common/ui/tabs/tab-panels.tsx","../src/config/default-gradients.ts","../src/common/icons/material/Texture.tsx","../src/common/icons/material/Gradient.tsx","../src/common/icons/material/AddPhotoAlternate.tsx","../src/objects/ui/active-obj-controls/color-tab-panel.tsx","../src/objects/ui/active-obj-controls/opacity-tab-panel.tsx","../src/objects/ui/active-obj-controls/outline-tab-panel.tsx","../src/common/icons/material/Image.tsx","../src/objects/ui/active-obj-controls/image-tab-panel.tsx","../src/objects/ui/active-obj-controls/shadow-tab-panel.tsx","../src/common/ui/tabs/tab.tsx","../src/objects/ui/active-obj-controls/active-object-controls.tsx","../src/tools/text/ui/active-text-controls.tsx","../src/ui/navbar/tool-controls-overlay.tsx","../src/common/icons/material/Cancel.tsx","../src/tools/filter/ui/filter-button.tsx","../src/ui/navbar/scrollable-view.tsx","../src/tools/filter/ui/filter-nav.tsx","../src/common/icons/material/Lock.tsx","../src/common/icons/material/LockOpen.tsx","../src/common/icons/material/CheckBoxOutlineBlank.tsx","../src/common/ui/forms/toggle/checkbox-filled-icon.tsx","../src/common/ui/forms/toggle/indeterminate-checkbox-filled-icon.tsx","../src/common/ui/forms/toggle/checkbox.tsx","../src/tools/resize/ui/resize-nav.tsx","../src/tools/crop/ui/crop-nav/crop-preset-btns.tsx","../src/common/icons/material/Flip.tsx","../src/tools/transform/ui/flip-btns.tsx","../src/common/icons/material/RotateLeft.tsx","../src/common/icons/material/RotateRight.tsx","../src/tools/transform/ui/rotate-btns.tsx","../src/tools/transform/ui/transform-widget.tsx","../src/tools/crop/ui/crop-nav/crop-nav.tsx","../src/ui/icons/ellipse.tsx","../src/ui/icons/circle.tsx","../src/ui/icons/square.tsx","../src/ui/icons/triangle.tsx","../src/tools/shapes/ui/shape-nav.tsx","../node_modules/@tanstack/react-virtual/build/esm/index.js","../src/utils/use-active-theme.ts","../src/tools/shapes/ui/sticker-nav/sticker-list.tsx","../src/tools/shapes/ui/sticker-nav/sticker-nav.tsx","../src/tools/frame/ui/frame-nav.tsx","../src/tools/text/ui/text-nav.tsx","../src/tools/draw/ui/draw-nav.tsx","../src/tools/corners/ui/corners-nav.tsx","../src/ui/navbar/navbar-animation.ts","../src/ui/navbar/tool-controls.tsx","../src/ui/navbar/navbar.tsx","../src/tools/history/ui/history-panel.tsx","../src/common/ui/overlays/dialog/dialog-header.tsx","../src/common/ui/overlays/dialog/dialog-body.tsx","../src/ui/new-image-dialog.tsx","../src/common/ui/forms/radio-group/radio-group.tsx","../src/common/ui/forms/radio-group/radio.tsx","../src/tools/export/export-dialog-trigger.tsx","../src/objects/ui/obj-list-panel.tsx","../src/ui/overlay-panel-container.tsx","../node_modules/@remix-run/router/dist/router.js","../node_modules/react-router/dist/index.js","../node_modules/react-router-dom/dist/index.js","../src/common/icons/material/ErrorOutline.tsx","../src/common/icons/material/CheckCircle.tsx","../src/common/ui/toast/toast-container.tsx","../src/common/utils/keybinds/is-ctrl-key-pressed.ts","../src/ui/handle-canvas-keydown.ts","../src/common/ui/interactions/dnd/drag-state.ts","../src/common/ui/interactions/dnd/read-files-from-data-transfer.ts","../src/common/utils/array/async-iterable-to-array.ts","../src/common/ui/interactions/dnd/use-droppable.ts","../src/pixie-bootstrap-data-provider.tsx","../src/ui/image-editor.tsx","../src/pixie.tsx"],"sourcesContent":["'use strict';\n\nvar isMergeableObject = function isMergeableObject(value) {\n\treturn isNonNullObject(value)\n\t\t&& !isSpecial(value)\n};\n\nfunction isNonNullObject(value) {\n\treturn !!value && typeof value === 'object'\n}\n\nfunction isSpecial(value) {\n\tvar stringValue = Object.prototype.toString.call(value);\n\n\treturn stringValue === '[object RegExp]'\n\t\t|| stringValue === '[object Date]'\n\t\t|| isReactElement(value)\n}\n\n// see https://github.com/facebook/react/blob/b5ac963fb791d1298e7f396236383bc955f916c1/src/isomorphic/classic/element/ReactElement.js#L21-L25\nvar canUseSymbol = typeof Symbol === 'function' && Symbol.for;\nvar REACT_ELEMENT_TYPE = canUseSymbol ? Symbol.for('react.element') : 0xeac7;\n\nfunction isReactElement(value) {\n\treturn value.$$typeof === REACT_ELEMENT_TYPE\n}\n\nfunction emptyTarget(val) {\n\treturn Array.isArray(val) ? [] : {}\n}\n\nfunction cloneUnlessOtherwiseSpecified(value, options) {\n\treturn (options.clone !== false && options.isMergeableObject(value))\n\t\t? deepmerge(emptyTarget(value), value, options)\n\t\t: value\n}\n\nfunction defaultArrayMerge(target, source, options) {\n\treturn target.concat(source).map(function(element) {\n\t\treturn cloneUnlessOtherwiseSpecified(element, options)\n\t})\n}\n\nfunction getMergeFunction(key, options) {\n\tif (!options.customMerge) {\n\t\treturn deepmerge\n\t}\n\tvar customMerge = options.customMerge(key);\n\treturn typeof customMerge === 'function' ? customMerge : deepmerge\n}\n\nfunction getEnumerableOwnPropertySymbols(target) {\n\treturn Object.getOwnPropertySymbols\n\t\t? Object.getOwnPropertySymbols(target).filter(function(symbol) {\n\t\t\treturn target.propertyIsEnumerable(symbol)\n\t\t})\n\t\t: []\n}\n\nfunction getKeys(target) {\n\treturn Object.keys(target).concat(getEnumerableOwnPropertySymbols(target))\n}\n\nfunction propertyIsOnObject(object, property) {\n\ttry {\n\t\treturn property in object\n\t} catch(_) {\n\t\treturn false\n\t}\n}\n\n// Protects from prototype poisoning and unexpected merging up the prototype chain.\nfunction propertyIsUnsafe(target, key) {\n\treturn propertyIsOnObject(target, key) // Properties are safe to merge if they don't exist in the target yet,\n\t\t&& !(Object.hasOwnProperty.call(target, key) // unsafe if they exist up the prototype chain,\n\t\t\t&& Object.propertyIsEnumerable.call(target, key)) // and also unsafe if they're nonenumerable.\n}\n\nfunction mergeObject(target, source, options) {\n\tvar destination = {};\n\tif (options.isMergeableObject(target)) {\n\t\tgetKeys(target).forEach(function(key) {\n\t\t\tdestination[key] = cloneUnlessOtherwiseSpecified(target[key], options);\n\t\t});\n\t}\n\tgetKeys(source).forEach(function(key) {\n\t\tif (propertyIsUnsafe(target, key)) {\n\t\t\treturn\n\t\t}\n\n\t\tif (propertyIsOnObject(target, key) && options.isMergeableObject(source[key])) {\n\t\t\tdestination[key] = getMergeFunction(key, options)(target[key], source[key], options);\n\t\t} else {\n\t\t\tdestination[key] = cloneUnlessOtherwiseSpecified(source[key], options);\n\t\t}\n\t});\n\treturn destination\n}\n\nfunction deepmerge(target, source, options) {\n\toptions = options || {};\n\toptions.arrayMerge = options.arrayMerge || defaultArrayMerge;\n\toptions.isMergeableObject = options.isMergeableObject || isMergeableObject;\n\t// cloneUnlessOtherwiseSpecified is added to `options` so that custom arrayMerge()\n\t// implementations can use it. The caller may not replace it.\n\toptions.cloneUnlessOtherwiseSpecified = cloneUnlessOtherwiseSpecified;\n\n\tvar sourceIsArray = Array.isArray(source);\n\tvar targetIsArray = Array.isArray(target);\n\tvar sourceAndTargetTypesMatch = sourceIsArray === targetIsArray;\n\n\tif (!sourceAndTargetTypesMatch) {\n\t\treturn cloneUnlessOtherwiseSpecified(source, options)\n\t} else if (sourceIsArray) {\n\t\treturn options.arrayMerge(target, source, options)\n\t} else {\n\t\treturn mergeObject(target, source, options)\n\t}\n}\n\ndeepmerge.all = function deepmergeAll(array, options) {\n\tif (!Array.isArray(array)) {\n\t\tthrow new Error('first argument should be an array')\n\t}\n\n\treturn array.reduce(function(prev, next) {\n\t\treturn deepmerge(prev, next, options)\n\t}, {})\n};\n\nvar deepmerge_1 = deepmerge;\n\nmodule.exports = deepmerge_1;\n","function styleInject(css, ref) {\n  if ( ref === void 0 ) ref = {};\n  var insertAt = ref.insertAt;\n\n  if (!css || typeof document === 'undefined') { return; }\n\n  var head = document.head || document.getElementsByTagName('head')[0];\n  var style = document.createElement('style');\n  style.type = 'text/css';\n\n  if (insertAt === 'top') {\n    if (head.firstChild) {\n      head.insertBefore(style, head.firstChild);\n    } else {\n      head.appendChild(style);\n    }\n  } else {\n    head.appendChild(style);\n  }\n\n  if (style.styleSheet) {\n    style.styleSheet.cssText = css;\n  } else {\n    style.appendChild(document.createTextNode(css));\n  }\n}\n\nexport default styleInject;\n","/**\r\n * @desc 解决浮动运算问题，避免小数点后产生多位数和计算精度损失。\r\n * 问题示例：2.3 + 2.4 = 4.699999999999999，1.0 - 0.9 = 0.09999999999999998\r\n */\r\n/**\r\n * 把错误的数据转正\r\n * strip(0.09999999999999998)=0.1\r\n */\r\nfunction strip(num, precision) {\r\n    if (precision === void 0) { precision = 15; }\r\n    return +parseFloat(Number(num).toPrecision(precision));\r\n}\r\n/**\r\n * Return digits length of a number\r\n * @param {*number} num Input number\r\n */\r\nfunction digitLength(num) {\r\n    // Get digit length of e\r\n    var eSplit = num.toString().split(/[eE]/);\r\n    var len = (eSplit[0].split('.')[1] || '').length - +(eSplit[1] || 0);\r\n    return len > 0 ? len : 0;\r\n}\r\n/**\r\n * 把小数转成整数，支持科学计数法。如果是小数则放大成整数\r\n * @param {*number} num 输入数\r\n */\r\nfunction float2Fixed(num) {\r\n    if (num.toString().indexOf('e') === -1) {\r\n        return Number(num.toString().replace('.', ''));\r\n    }\r\n    var dLen = digitLength(num);\r\n    return dLen > 0 ? strip(Number(num) * Math.pow(10, dLen)) : Number(num);\r\n}\r\n/**\r\n * 检测数字是否越界，如果越界给出提示\r\n * @param {*number} num 输入数\r\n */\r\nfunction checkBoundary(num) {\r\n    if (_boundaryCheckingState) {\r\n        if (num > Number.MAX_SAFE_INTEGER || num < Number.MIN_SAFE_INTEGER) {\r\n            console.warn(num + \" is beyond boundary when transfer to integer, the results may not be accurate\");\r\n        }\r\n    }\r\n}\r\n/**\r\n * 迭代操作\r\n */\r\nfunction iteratorOperation(arr, operation) {\r\n    var num1 = arr[0], num2 = arr[1], others = arr.slice(2);\r\n    var res = operation(num1, num2);\r\n    others.forEach(function (num) {\r\n        res = operation(res, num);\r\n    });\r\n    return res;\r\n}\r\n/**\r\n * 精确乘法\r\n */\r\nfunction times() {\r\n    var nums = [];\r\n    for (var _i = 0; _i < arguments.length; _i++) {\r\n        nums[_i] = arguments[_i];\r\n    }\r\n    if (nums.length > 2) {\r\n        return iteratorOperation(nums, times);\r\n    }\r\n    var num1 = nums[0], num2 = nums[1];\r\n    var num1Changed = float2Fixed(num1);\r\n    var num2Changed = float2Fixed(num2);\r\n    var baseNum = digitLength(num1) + digitLength(num2);\r\n    var leftValue = num1Changed * num2Changed;\r\n    checkBoundary(leftValue);\r\n    return leftValue / Math.pow(10, baseNum);\r\n}\r\n/**\r\n * 精确加法\r\n */\r\nfunction plus() {\r\n    var nums = [];\r\n    for (var _i = 0; _i < arguments.length; _i++) {\r\n        nums[_i] = arguments[_i];\r\n    }\r\n    if (nums.length > 2) {\r\n        return iteratorOperation(nums, plus);\r\n    }\r\n    var num1 = nums[0], num2 = nums[1];\r\n    // 取最大的小数位\r\n    var baseNum = Math.pow(10, Math.max(digitLength(num1), digitLength(num2)));\r\n    // 把小数都转为整数然后再计算\r\n    return (times(num1, baseNum) + times(num2, baseNum)) / baseNum;\r\n}\r\n/**\r\n * 精确减法\r\n */\r\nfunction minus() {\r\n    var nums = [];\r\n    for (var _i = 0; _i < arguments.length; _i++) {\r\n        nums[_i] = arguments[_i];\r\n    }\r\n    if (nums.length > 2) {\r\n        return iteratorOperation(nums, minus);\r\n    }\r\n    var num1 = nums[0], num2 = nums[1];\r\n    var baseNum = Math.pow(10, Math.max(digitLength(num1), digitLength(num2)));\r\n    return (times(num1, baseNum) - times(num2, baseNum)) / baseNum;\r\n}\r\n/**\r\n * 精确除法\r\n */\r\nfunction divide() {\r\n    var nums = [];\r\n    for (var _i = 0; _i < arguments.length; _i++) {\r\n        nums[_i] = arguments[_i];\r\n    }\r\n    if (nums.length > 2) {\r\n        return iteratorOperation(nums, divide);\r\n    }\r\n    var num1 = nums[0], num2 = nums[1];\r\n    var num1Changed = float2Fixed(num1);\r\n    var num2Changed = float2Fixed(num2);\r\n    checkBoundary(num1Changed);\r\n    checkBoundary(num2Changed);\r\n    // fix: 类似 10 ** -4 为 0.00009999999999999999，strip 修正\r\n    return times(num1Changed / num2Changed, strip(Math.pow(10, digitLength(num2) - digitLength(num1))));\r\n}\r\n/**\r\n * 四舍五入\r\n */\r\nfunction round(num, ratio) {\r\n    var base = Math.pow(10, ratio);\r\n    var result = divide(Math.round(Math.abs(times(num, base))), base);\r\n    if (num < 0 && result !== 0) {\r\n        result = times(result, -1);\r\n    }\r\n    return result;\r\n}\r\nvar _boundaryCheckingState = true;\r\n/**\r\n * 是否进行边界检查，默认开启\r\n * @param flag 标记开关，true 为开启，false 为关闭，默认为 true\r\n */\r\nfunction enableBoundaryChecking(flag) {\r\n    if (flag === void 0) { flag = true; }\r\n    _boundaryCheckingState = flag;\r\n}\r\nvar index = {\r\n    strip: strip,\r\n    plus: plus,\r\n    minus: minus,\r\n    times: times,\r\n    divide: divide,\r\n    round: round,\r\n    digitLength: digitLength,\r\n    float2Fixed: float2Fixed,\r\n    enableBoundaryChecking: enableBoundaryChecking,\r\n};\n\nexport { strip, plus, minus, times, divide, round, digitLength, float2Fixed, enableBoundaryChecking };\nexport default index;\n","/** Internal */\n\n// The code below for 'isGlobalObj' and 'GLOBAL' was copied from core-js before modification\n// https://github.com/zloirock/core-js/blob/1b944df55282cdc99c90db5f49eb0b6eda2cc0a3/packages/core-js/internals/global.js\n// core-js has the following licence:\n//\n// Copyright (c) 2014-2022 Denis Pushkarev\n//\n// Permission is hereby granted, free of charge, to any person obtaining a copy\n// of this software and associated documentation files (the \"Software\"), to deal\n// in the Software without restriction, including without limitation the rights\n// to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\n// copies of the Software, and to permit persons to whom the Software is\n// furnished to do so, subject to the following conditions:\n//\n// The above copyright notice and this permission notice shall be included in\n// all copies or substantial portions of the Software.\n//\n// THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n// IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n// FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n// AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n// LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n// OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\n// THE SOFTWARE.\n\n/** Returns 'obj' if it's the global object, otherwise returns undefined */\nfunction isGlobalObj(obj) {\n  return obj && obj.Math == Math ? obj : undefined;\n}\n\nvar GLOBAL =\n  (typeof globalThis == 'object' && isGlobalObj(globalThis)) ||\n  // eslint-disable-next-line no-restricted-globals\n  (typeof window == 'object' && isGlobalObj(window)) ||\n  (typeof self == 'object' && isGlobalObj(self)) ||\n  (typeof global == 'object' && isGlobalObj(global)) ||\n  (function () {\n    return this;\n  })() ||\n  {};\n\n/**\n * Safely get global scope object\n *\n * @returns Global scope object\n */\nfunction getGlobalObject() {\n  return GLOBAL ;\n}\n\n/**\n * Returns a global singleton contained in the global `__SENTRY__` object.\n *\n * If the singleton doesn't already exist in `__SENTRY__`, it will be created using the given factory\n * function and added to the `__SENTRY__` object.\n *\n * @param name name of the global singleton on __SENTRY__\n * @param creator creator Factory function to create the singleton if it doesn't already exist on `__SENTRY__`\n * @param obj (Optional) The global object on which to look for `__SENTRY__`, if not `getGlobalObject`'s return value\n * @returns the singleton\n */\nfunction getGlobalSingleton(name, creator, obj) {\n  var global = (obj || GLOBAL) ;\n  var __SENTRY__ = (global.__SENTRY__ = global.__SENTRY__ || {});\n  var singleton = __SENTRY__[name] || (__SENTRY__[name] = creator());\n  return singleton;\n}\n\nexport { getGlobalObject, getGlobalSingleton };\n//# sourceMappingURL=global.js.map\n","// eslint-disable-next-line @typescript-eslint/unbound-method\nvar objectToString = Object.prototype.toString;\n\n/**\n * Checks whether given value's type is one of a few Error or Error-like\n * {@link isError}.\n *\n * @param wat A value to be checked.\n * @returns A boolean representing the result.\n */\nfunction isError(wat) {\n  switch (objectToString.call(wat)) {\n    case '[object Error]':\n    case '[object Exception]':\n    case '[object DOMException]':\n      return true;\n    default:\n      return isInstanceOf(wat, Error);\n  }\n}\n/**\n * Checks whether given value is an instance of the given built-in class.\n *\n * @param wat The value to be checked\n * @param className\n * @returns A boolean representing the result.\n */\nfunction isBuiltin(wat, className) {\n  return objectToString.call(wat) === `[object ${className}]`;\n}\n\n/**\n * Checks whether given value's type is ErrorEvent\n * {@link isErrorEvent}.\n *\n * @param wat A value to be checked.\n * @returns A boolean representing the result.\n */\nfunction isErrorEvent(wat) {\n  return isBuiltin(wat, 'ErrorEvent');\n}\n\n/**\n * Checks whether given value's type is DOMError\n * {@link isDOMError}.\n *\n * @param wat A value to be checked.\n * @returns A boolean representing the result.\n */\nfunction isDOMError(wat) {\n  return isBuiltin(wat, 'DOMError');\n}\n\n/**\n * Checks whether given value's type is DOMException\n * {@link isDOMException}.\n *\n * @param wat A value to be checked.\n * @returns A boolean representing the result.\n */\nfunction isDOMException(wat) {\n  return isBuiltin(wat, 'DOMException');\n}\n\n/**\n * Checks whether given value's type is a string\n * {@link isString}.\n *\n * @param wat A value to be checked.\n * @returns A boolean representing the result.\n */\nfunction isString(wat) {\n  return isBuiltin(wat, 'String');\n}\n\n/**\n * Checks whether given value is a primitive (undefined, null, number, boolean, string, bigint, symbol)\n * {@link isPrimitive}.\n *\n * @param wat A value to be checked.\n * @returns A boolean representing the result.\n */\nfunction isPrimitive(wat) {\n  return wat === null || (typeof wat !== 'object' && typeof wat !== 'function');\n}\n\n/**\n * Checks whether given value's type is an object literal\n * {@link isPlainObject}.\n *\n * @param wat A value to be checked.\n * @returns A boolean representing the result.\n */\nfunction isPlainObject(wat) {\n  return isBuiltin(wat, 'Object');\n}\n\n/**\n * Checks whether given value's type is an Event instance\n * {@link isEvent}.\n *\n * @param wat A value to be checked.\n * @returns A boolean representing the result.\n */\nfunction isEvent(wat) {\n  return typeof Event !== 'undefined' && isInstanceOf(wat, Event);\n}\n\n/**\n * Checks whether given value's type is an Element instance\n * {@link isElement}.\n *\n * @param wat A value to be checked.\n * @returns A boolean representing the result.\n */\nfunction isElement(wat) {\n  return typeof Element !== 'undefined' && isInstanceOf(wat, Element);\n}\n\n/**\n * Checks whether given value's type is an regexp\n * {@link isRegExp}.\n *\n * @param wat A value to be checked.\n * @returns A boolean representing the result.\n */\nfunction isRegExp(wat) {\n  return isBuiltin(wat, 'RegExp');\n}\n\n/**\n * Checks whether given value has a then function.\n * @param wat A value to be checked.\n */\nfunction isThenable(wat) {\n  // eslint-disable-next-line @typescript-eslint/no-unsafe-member-access\n  return Boolean(wat && wat.then && typeof wat.then === 'function');\n}\n\n/**\n * Checks whether given value's type is a SyntheticEvent\n * {@link isSyntheticEvent}.\n *\n * @param wat A value to be checked.\n * @returns A boolean representing the result.\n */\nfunction isSyntheticEvent(wat) {\n  return isPlainObject(wat) && 'nativeEvent' in wat && 'preventDefault' in wat && 'stopPropagation' in wat;\n}\n\n/**\n * Checks whether given value is NaN\n * {@link isNaN}.\n *\n * @param wat A value to be checked.\n * @returns A boolean representing the result.\n */\nfunction isNaN(wat) {\n  return typeof wat === 'number' && wat !== wat;\n}\n\n/**\n * Checks whether given value's type is an instance of provided constructor.\n * {@link isInstanceOf}.\n *\n * @param wat A value to be checked.\n * @param base A constructor to be used in a check.\n * @returns A boolean representing the result.\n */\nfunction isInstanceOf(wat, base) {\n  try {\n    return wat instanceof base;\n  } catch (_e) {\n    return false;\n  }\n}\n\nexport { isDOMError, isDOMException, isElement, isError, isErrorEvent, isEvent, isInstanceOf, isNaN, isPlainObject, isPrimitive, isRegExp, isString, isSyntheticEvent, isThenable };\n//# sourceMappingURL=is.js.map\n","import { getGlobalObject } from './global.js';\nimport { isString } from './is.js';\n\n/**\n * Given a child DOM element, returns a query-selector statement describing that\n * and its ancestors\n * e.g. [HTMLElement] => body > div > input#foo.btn[name=baz]\n * @returns generated DOM path\n */\nfunction htmlTreeAsString(elem, keyAttrs) {\n\n  // try/catch both:\n  // - accessing event.target (see getsentry/raven-js#838, #768)\n  // - `htmlTreeAsString` because it's complex, and just accessing the DOM incorrectly\n  // - can throw an exception in some circumstances.\n  try {\n    let currentElem = elem ;\n    var MAX_TRAVERSE_HEIGHT = 5;\n    var MAX_OUTPUT_LEN = 80;\n    var out = [];\n    let height = 0;\n    let len = 0;\n    var separator = ' > ';\n    var sepLength = separator.length;\n    let nextStr;\n\n    // eslint-disable-next-line no-plusplus\n    while (currentElem && height++ < MAX_TRAVERSE_HEIGHT) {\n      nextStr = _htmlElementAsString(currentElem, keyAttrs);\n      // bail out if\n      // - nextStr is the 'html' element\n      // - the length of the string that would be created exceeds MAX_OUTPUT_LEN\n      //   (ignore this limit if we are on the first iteration)\n      if (nextStr === 'html' || (height > 1 && len + out.length * sepLength + nextStr.length >= MAX_OUTPUT_LEN)) {\n        break;\n      }\n\n      out.push(nextStr);\n\n      len += nextStr.length;\n      currentElem = currentElem.parentNode;\n    }\n\n    return out.reverse().join(separator);\n  } catch (_oO) {\n    return '<unknown>';\n  }\n}\n\n/**\n * Returns a simple, query-selector representation of a DOM element\n * e.g. [HTMLElement] => input#foo.btn[name=baz]\n * @returns generated DOM path\n */\nfunction _htmlElementAsString(el, keyAttrs) {\n  var elem = el\n\n;\n\n  var out = [];\n  let className;\n  let classes;\n  let key;\n  let attr;\n  let i;\n\n  if (!elem || !elem.tagName) {\n    return '';\n  }\n\n  out.push(elem.tagName.toLowerCase());\n\n  // Pairs of attribute keys defined in `serializeAttribute` and their values on element.\n  var keyAttrPairs =\n    keyAttrs && keyAttrs.length\n      ? keyAttrs.filter(keyAttr => elem.getAttribute(keyAttr)).map(keyAttr => [keyAttr, elem.getAttribute(keyAttr)])\n      : null;\n\n  if (keyAttrPairs && keyAttrPairs.length) {\n    keyAttrPairs.forEach(keyAttrPair => {\n      out.push(`[${keyAttrPair[0]}=\"${keyAttrPair[1]}\"]`);\n    });\n  } else {\n    if (elem.id) {\n      out.push(`#${elem.id}`);\n    }\n\n    // eslint-disable-next-line prefer-const\n    className = elem.className;\n    if (className && isString(className)) {\n      classes = className.split(/\\s+/);\n      for (i = 0; i < classes.length; i++) {\n        out.push(`.${classes[i]}`);\n      }\n    }\n  }\n  var allowedAttrs = ['type', 'name', 'title', 'alt'];\n  for (i = 0; i < allowedAttrs.length; i++) {\n    key = allowedAttrs[i];\n    attr = elem.getAttribute(key);\n    if (attr) {\n      out.push(`[${key}=\"${attr}\"]`);\n    }\n  }\n  return out.join('');\n}\n\n/**\n * A safe form of location.href\n */\nfunction getLocationHref() {\n  var global = getGlobalObject();\n  try {\n    return global.document.location.href;\n  } catch (oO) {\n    return '';\n  }\n}\n\n/**\n * Gets a DOM element by using document.querySelector.\n *\n * This wrapper will first check for the existance of the function before\n * actually calling it so that we don't have to take care of this check,\n * every time we want to access the DOM.\n *\n * Reason: DOM/querySelector is not available in all environments.\n *\n * We have to cast to any because utils can be consumed by a variety of environments,\n * and we don't want to break TS users. If you know what element will be selected by\n * `document.querySelector`, specify it as part of the generic call. For example,\n * `var element = getDomElement<Element>('selector');`\n *\n * @param selector the selector string passed on to document.querySelector\n */\n// eslint-disable-next-line @typescript-eslint/no-explicit-any\nfunction getDomElement(selector) {\n  var global = getGlobalObject();\n  if (global.document && global.document.querySelector) {\n    return global.document.querySelector(selector) ;\n  }\n  return null;\n}\n\nexport { getDomElement, getLocationHref, htmlTreeAsString };\n//# sourceMappingURL=browser.js.map\n","/** An error emitted by Sentry SDKs and related utilities. */\nclass SentryError extends Error {\n  /** Display name of this error instance. */\n\n   constructor( message, logLevel = 'warn') {\n    super(message);this.message = message;;\n\n    this.name = new.target.prototype.constructor.name;\n    // This sets the prototype to be `Error`, not `SentryError`. It's unclear why we do this, but commenting this line\n    // out causes various (seemingly totally unrelated) playwright tests consistently time out. FYI, this makes\n    // instances of `SentryError` fail `obj instanceof SentryError` checks.\n    Object.setPrototypeOf(this, new.target.prototype);\n    this.logLevel = logLevel;\n  }\n}\n\nexport { SentryError };\n//# sourceMappingURL=error.js.map\n","import { SentryError } from './error.js';\n\n/** Regular expression used to parse a Dsn. */\nvar DSN_REGEX = /^(?:(\\w+):)\\/\\/(?:(\\w+)(?::(\\w+))?@)([\\w.-]+)(?::(\\d+))?\\/(.+)/;\n\nfunction isValidProtocol(protocol) {\n  return protocol === 'http' || protocol === 'https';\n}\n\n/**\n * Renders the string representation of this Dsn.\n *\n * By default, this will render the public representation without the password\n * component. To get the deprecated private representation, set `withPassword`\n * to true.\n *\n * @param withPassword When set to true, the password will be included.\n */\nfunction dsnToString(dsn, withPassword = false) {\n  const { host, path, pass, port, projectId, protocol, publicKey } = dsn;\n  return (\n    `${protocol}://${publicKey}${withPassword && pass ? `:${pass}` : ''}` +\n    `@${host}${port ? `:${port}` : ''}/${path ? `${path}/` : path}${projectId}`\n  );\n}\n\n/**\n * Parses a Dsn from a given string.\n *\n * @param str A Dsn as string\n * @returns Dsn as DsnComponents\n */\nfunction dsnFromString(str) {\n  var match = DSN_REGEX.exec(str);\n\n  if (!match) {\n    throw new SentryError(`Invalid Sentry Dsn: ${str}`);\n  }\n\n  const [protocol, publicKey, pass = '', host, port = '', lastPath] = match.slice(1);\n  let path = '';\n  let projectId = lastPath;\n\n  var split = projectId.split('/');\n  if (split.length > 1) {\n    path = split.slice(0, -1).join('/');\n    projectId = split.pop() ;\n  }\n\n  if (projectId) {\n    var projectMatch = projectId.match(/^\\d+/);\n    if (projectMatch) {\n      projectId = projectMatch[0];\n    }\n  }\n\n  return dsnFromComponents({ host, pass, path, projectId, port, protocol: protocol , publicKey });\n}\n\nfunction dsnFromComponents(components) {\n  return {\n    protocol: components.protocol,\n    publicKey: components.publicKey || '',\n    pass: components.pass || '',\n    host: components.host,\n    port: components.port || '',\n    path: components.path || '',\n    projectId: components.projectId,\n  };\n}\n\nfunction validateDsn(dsn) {\n  if (!(typeof __SENTRY_DEBUG__ === 'undefined' || __SENTRY_DEBUG__)) {\n    return;\n  }\n\n  const { port, projectId, protocol } = dsn;\n\n  var requiredComponents = ['protocol', 'publicKey', 'host', 'projectId'];\n  requiredComponents.forEach(component => {\n    if (!dsn[component]) {\n      throw new SentryError(`Invalid Sentry Dsn: ${component} missing`);\n    }\n  });\n\n  if (!projectId.match(/^\\d+$/)) {\n    throw new SentryError(`Invalid Sentry Dsn: Invalid projectId ${projectId}`);\n  }\n\n  if (!isValidProtocol(protocol)) {\n    throw new SentryError(`Invalid Sentry Dsn: Invalid protocol ${protocol}`);\n  }\n\n  if (port && isNaN(parseInt(port, 10))) {\n    throw new SentryError(`Invalid Sentry Dsn: Invalid port ${port}`);\n  }\n\n  return true;\n}\n\n/** The Sentry Dsn, identifying a Sentry instance and project. */\nfunction makeDsn(from) {\n  var components = typeof from === 'string' ? dsnFromString(from) : dsnFromComponents(from);\n  validateDsn(components);\n  return components;\n}\n\nexport { dsnFromString, dsnToString, makeDsn };\n//# sourceMappingURL=dsn.js.map\n","import { getGlobalObject, getGlobalSingleton } from './global.js';\n\n// TODO: Implement different loggers for different environments\nvar global = getGlobalObject();\n\n/** Prefix for logging strings */\nvar PREFIX = 'Sentry Logger ';\n\nvar CONSOLE_LEVELS = ['debug', 'info', 'warn', 'error', 'log', 'assert', 'trace'] ;\n\n/**\n * Temporarily disable sentry console instrumentations.\n *\n * @param callback The function to run against the original `console` messages\n * @returns The results of the callback\n */\nfunction consoleSandbox(callback) {\n  var global = getGlobalObject();\n\n  if (!('console' in global)) {\n    return callback();\n  }\n\n  var originalConsole = global.console ;\n  var wrappedLevels = {};\n\n  // Restore all wrapped console methods\n  CONSOLE_LEVELS.forEach(level => {\n    // TODO(v7): Remove this check as it's only needed for Node 6\n    var originalWrappedFunc =\n      originalConsole[level] && (originalConsole[level] ).__sentry_original__;\n    if (level in global.console && originalWrappedFunc) {\n      wrappedLevels[level] = originalConsole[level] ;\n      originalConsole[level] = originalWrappedFunc ;\n    }\n  });\n\n  try {\n    return callback();\n  } finally {\n    // Revert restoration to wrapped state\n    Object.keys(wrappedLevels).forEach(level => {\n      originalConsole[level] = wrappedLevels[level ];\n    });\n  }\n}\n\nfunction makeLogger() {\n  let enabled = false;\n  var logger = {\n    enable: () => {\n      enabled = true;\n    },\n    disable: () => {\n      enabled = false;\n    },\n  };\n\n  if ((typeof __SENTRY_DEBUG__ === 'undefined' || __SENTRY_DEBUG__)) {\n    CONSOLE_LEVELS.forEach(name => {\n      // eslint-disable-next-line @typescript-eslint/no-explicit-any\n      logger[name] = (...args) => {\n        if (enabled) {\n          consoleSandbox(() => {\n            global.console[name](`${PREFIX}[${name}]:`, ...args);\n          });\n        }\n      };\n    });\n  } else {\n    CONSOLE_LEVELS.forEach(name => {\n      logger[name] = () => undefined;\n    });\n  }\n\n  return logger ;\n}\n\n// Ensure we only have a single logger instance, even if multiple versions of @sentry/utils are being used\nlet logger;\nif ((typeof __SENTRY_DEBUG__ === 'undefined' || __SENTRY_DEBUG__)) {\n  logger = getGlobalSingleton('logger', makeLogger);\n} else {\n  logger = makeLogger();\n}\n\nexport { CONSOLE_LEVELS, consoleSandbox, logger };\n//# sourceMappingURL=logger.js.map\n","import { isString, isRegExp } from './is.js';\n\n/**\n * Truncates given string to the maximum characters count\n *\n * @param str An object that contains serializable values\n * @param max Maximum number of characters in truncated string (0 = unlimited)\n * @returns string Encoded\n */\nfunction truncate(str, max = 0) {\n  if (typeof str !== 'string' || max === 0) {\n    return str;\n  }\n  return str.length <= max ? str : `${str.substr(0, max)}...`;\n}\n\n/**\n * This is basically just `trim_line` from\n * https://github.com/getsentry/sentry/blob/master/src/sentry/lang/javascript/processor.py#L67\n *\n * @param str An object that contains serializable values\n * @param max Maximum number of characters in truncated string\n * @returns string Encoded\n */\nfunction snipLine(line, colno) {\n  let newLine = line;\n  var lineLength = newLine.length;\n  if (lineLength <= 150) {\n    return newLine;\n  }\n  if (colno > lineLength) {\n    // eslint-disable-next-line no-param-reassign\n    colno = lineLength;\n  }\n\n  let start = Math.max(colno - 60, 0);\n  if (start < 5) {\n    start = 0;\n  }\n\n  let end = Math.min(start + 140, lineLength);\n  if (end > lineLength - 5) {\n    end = lineLength;\n  }\n  if (end === lineLength) {\n    start = Math.max(end - 140, 0);\n  }\n\n  newLine = newLine.slice(start, end);\n  if (start > 0) {\n    newLine = `'{snip} ${newLine}`;\n  }\n  if (end < lineLength) {\n    newLine += ' {snip}';\n  }\n\n  return newLine;\n}\n\n/**\n * Join values in array\n * @param input array of values to be joined together\n * @param delimiter string to be placed in-between values\n * @returns Joined values\n */\n// eslint-disable-next-line @typescript-eslint/no-explicit-any\nfunction safeJoin(input, delimiter) {\n  if (!Array.isArray(input)) {\n    return '';\n  }\n\n  var output = [];\n  // eslint-disable-next-line @typescript-eslint/prefer-for-of\n  for (let i = 0; i < input.length; i++) {\n    var value = input[i];\n    try {\n      output.push(String(value));\n    } catch (e) {\n      output.push('[value cannot be serialized]');\n    }\n  }\n\n  return output.join(delimiter);\n}\n\n/**\n * Checks if the value matches a regex or includes the string\n * @param value The string value to be checked against\n * @param pattern Either a regex or a string that must be contained in value\n */\nfunction isMatchingPattern(value, pattern) {\n  if (!isString(value)) {\n    return false;\n  }\n\n  if (isRegExp(pattern)) {\n    return pattern.test(value);\n  }\n  if (typeof pattern === 'string') {\n    return value.indexOf(pattern) !== -1;\n  }\n  return false;\n}\n\n/**\n * Given a string, escape characters which have meaning in the regex grammar, such that the result is safe to feed to\n * `new RegExp()`.\n *\n * Based on https://github.com/sindresorhus/escape-string-regexp. Vendored to a) reduce the size by skipping the runtime\n * type-checking, and b) ensure it gets down-compiled for old versions of Node (the published package only supports Node\n * 12+).\n *\n * @param regexString The string to escape\n * @returns An version of the string with all special regex characters escaped\n */\nfunction escapeStringForRegex(regexString) {\n  // escape the hyphen separately so we can also replace it with a unicode literal hyphen, to avoid the problems\n  // discussed in https://github.com/sindresorhus/escape-string-regexp/issues/20.\n  return regexString.replace(/[|\\\\{}()[\\]^$+*?.]/g, '\\\\$&').replace(/-/g, '\\\\x2d');\n}\n\nexport { escapeStringForRegex, isMatchingPattern, safeJoin, snipLine, truncate };\n//# sourceMappingURL=string.js.map\n","import { htmlTreeAsString } from './browser.js';\nimport { isError, isEvent, isInstanceOf, isElement, isPlainObject, isPrimitive } from './is.js';\nimport { truncate } from './string.js';\n\n/**\n * Replace a method in an object with a wrapped version of itself.\n *\n * @param source An object that contains a method to be wrapped.\n * @param name The name of the method to be wrapped.\n * @param replacementFactory A higher-order function that takes the original version of the given method and returns a\n * wrapped version. Note: The function returned by `replacementFactory` needs to be a non-arrow function, in order to\n * preserve the correct value of `this`, and the original method must be called using `origMethod.call(this, <other\n * args>)` or `origMethod.apply(this, [<other args>])` (rather than being called directly), again to preserve `this`.\n * @returns void\n */\nfunction fill(source, name, replacementFactory) {\n  if (!(name in source)) {\n    return;\n  }\n\n  var original = source[name] ;\n  var wrapped = replacementFactory(original) ;\n\n  // Make sure it's a function first, as we need to attach an empty prototype for `defineProperties` to work\n  // otherwise it'll throw \"TypeError: Object.defineProperties called on non-object\"\n  if (typeof wrapped === 'function') {\n    try {\n      markFunctionWrapped(wrapped, original);\n    } catch (_Oo) {\n      // This can throw if multiple fill happens on a global object like XMLHttpRequest\n      // Fixes https://github.com/getsentry/sentry-javascript/issues/2043\n    }\n  }\n\n  source[name] = wrapped;\n}\n\n/**\n * Defines a non-enumerable property on the given object.\n *\n * @param obj The object on which to set the property\n * @param name The name of the property to be set\n * @param value The value to which to set the property\n */\nfunction addNonEnumerableProperty(obj, name, value) {\n  Object.defineProperty(obj, name, {\n    // enumerable: false, // the default, so we can save on bundle size by not explicitly setting it\n    value: value,\n    writable: true,\n    configurable: true,\n  });\n}\n\n/**\n * Remembers the original function on the wrapped function and\n * patches up the prototype.\n *\n * @param wrapped the wrapper function\n * @param original the original function that gets wrapped\n */\nfunction markFunctionWrapped(wrapped, original) {\n  var proto = original.prototype || {};\n  wrapped.prototype = original.prototype = proto;\n  addNonEnumerableProperty(wrapped, '__sentry_original__', original);\n}\n\n/**\n * This extracts the original function if available.  See\n * `markFunctionWrapped` for more information.\n *\n * @param func the function to unwrap\n * @returns the unwrapped version of the function if available.\n */\nfunction getOriginalFunction(func) {\n  return func.__sentry_original__;\n}\n\n/**\n * Encodes given object into url-friendly format\n *\n * @param object An object that contains serializable values\n * @returns string Encoded\n */\nfunction urlEncode(object) {\n  return Object.keys(object)\n    .map(key => `${encodeURIComponent(key)}=${encodeURIComponent(object[key])}`)\n    .join('&');\n}\n\n/**\n * Transforms any `Error` or `Event` into a plain object with all of their enumerable properties, and some of their\n * non-enumerable properties attached.\n *\n * @param value Initial source that we have to transform in order for it to be usable by the serializer\n * @returns An Event or Error turned into an object - or the value argurment itself, when value is neither an Event nor\n *  an Error.\n */\nfunction convertToPlainObject(\n  value,\n)\n\n {\n  if (isError(value)) {\n    return {\n      message: value.message,\n      name: value.name,\n      stack: value.stack,\n      ...getOwnProperties(value),\n    };\n  } else if (isEvent(value)) {\n    var newObj\n\n = {\n      type: value.type,\n      target: serializeEventTarget(value.target),\n      currentTarget: serializeEventTarget(value.currentTarget),\n      ...getOwnProperties(value),\n    };\n\n    if (typeof CustomEvent !== 'undefined' && isInstanceOf(value, CustomEvent)) {\n      newObj.detail = value.detail;\n    }\n\n    return newObj;\n  } else {\n    return value;\n  }\n}\n\n/** Creates a string representation of the target of an `Event` object */\nfunction serializeEventTarget(target) {\n  try {\n    return isElement(target) ? htmlTreeAsString(target) : Object.prototype.toString.call(target);\n  } catch (_oO) {\n    return '<unknown>';\n  }\n}\n\n/** Filters out all but an object's own properties */\nfunction getOwnProperties(obj) {\n  if (typeof obj === 'object' && obj !== null) {\n    var extractedProps = {};\n    for (var property in obj) {\n      if (Object.prototype.hasOwnProperty.call(obj, property)) {\n        extractedProps[property] = (obj )[property];\n      }\n    }\n    return extractedProps;\n  } else {\n    return {};\n  }\n}\n\n/**\n * Given any captured exception, extract its keys and create a sorted\n * and truncated list that will be used inside the event message.\n * eg. `Non-error exception captured with keys: foo, bar, baz`\n */\nfunction extractExceptionKeysForMessage(exception, maxLength = 40) {\n  var keys = Object.keys(convertToPlainObject(exception));\n  keys.sort();\n\n  if (!keys.length) {\n    return '[object has no keys]';\n  }\n\n  if (keys[0].length >= maxLength) {\n    return truncate(keys[0], maxLength);\n  }\n\n  for (let includedKeys = keys.length; includedKeys > 0; includedKeys--) {\n    var serialized = keys.slice(0, includedKeys).join(', ');\n    if (serialized.length > maxLength) {\n      continue;\n    }\n    if (includedKeys === keys.length) {\n      return serialized;\n    }\n    return truncate(serialized, maxLength);\n  }\n\n  return '';\n}\n\n/**\n * Given any object, return a new object having removed all fields whose value was `undefined`.\n * Works recursively on objects and arrays.\n *\n * Attention: This function keeps circular references in the returned object.\n */\nfunction dropUndefinedKeys(inputValue) {\n  // This map keeps track of what already visited nodes map to.\n  // Our Set - based memoBuilder doesn't work here because we want to the output object to have the same circular\n  // references as the input object.\n  var memoizationMap = new Map();\n\n  // This function just proxies `_dropUndefinedKeys` to keep the `memoBuilder` out of this function's API\n  return _dropUndefinedKeys(inputValue, memoizationMap);\n}\n\nfunction _dropUndefinedKeys(inputValue, memoizationMap) {\n  if (isPlainObject(inputValue)) {\n    // If this node has already been visited due to a circular reference, return the object it was mapped to in the new object\n    var memoVal = memoizationMap.get(inputValue);\n    if (memoVal !== undefined) {\n      return memoVal ;\n    }\n\n    var returnValue = {};\n    // Store the mapping of this value in case we visit it again, in case of circular data\n    memoizationMap.set(inputValue, returnValue);\n\n    for (var key of Object.keys(inputValue)) {\n      if (typeof inputValue[key] !== 'undefined') {\n        returnValue[key] = _dropUndefinedKeys(inputValue[key], memoizationMap);\n      }\n    }\n\n    return returnValue ;\n  }\n\n  if (Array.isArray(inputValue)) {\n    // If this node has already been visited due to a circular reference, return the array it was mapped to in the new object\n    var memoVal = memoizationMap.get(inputValue);\n    if (memoVal !== undefined) {\n      return memoVal ;\n    }\n\n    var returnValue = [];\n    // Store the mapping of this value in case we visit it again, in case of circular data\n    memoizationMap.set(inputValue, returnValue);\n\n    inputValue.forEach((item) => {\n      returnValue.push(_dropUndefinedKeys(item, memoizationMap));\n    });\n\n    return returnValue ;\n  }\n\n  return inputValue;\n}\n\n/**\n * Ensure that something is an object.\n *\n * Turns `undefined` and `null` into `String`s and all other primitives into instances of their respective wrapper\n * classes (String, Boolean, Number, etc.). Acts as the identity function on non-primitives.\n *\n * @param wat The subject of the objectification\n * @returns A version of `wat` which can safely be used with `Object` class methods\n */\nfunction objectify(wat) {\n  let objectified;\n  switch (true) {\n    case wat === undefined || wat === null:\n      objectified = new String(wat);\n      break;\n\n    // Though symbols and bigints do have wrapper classes (`Symbol` and `BigInt`, respectively), for whatever reason\n    // those classes don't have constructors which can be used with the `new` keyword. We therefore need to cast each as\n    // an object in order to wrap it.\n    case typeof wat === 'symbol' || typeof wat === 'bigint':\n      objectified = Object(wat);\n      break;\n\n    // this will catch the remaining primitives: `String`, `Number`, and `Boolean`\n    case isPrimitive(wat):\n      // eslint-disable-next-line @typescript-eslint/no-unsafe-member-access\n      objectified = new (wat ).constructor(wat);\n      break;\n\n    // by process of elimination, at this point we know that `wat` must already be an object\n    default:\n      objectified = wat;\n      break;\n  }\n  return objectified;\n}\n\nexport { addNonEnumerableProperty, convertToPlainObject, dropUndefinedKeys, extractExceptionKeysForMessage, fill, getOriginalFunction, markFunctionWrapped, objectify, urlEncode };\n//# sourceMappingURL=object.js.map\n","import { _optionalChain } from './buildPolyfills';\n\nvar STACKTRACE_LIMIT = 50;\n\n/**\n * Creates a stack parser with the supplied line parsers\n *\n * StackFrames are returned in the correct order for Sentry Exception\n * frames and with Sentry SDK internal frames removed from the top and bottom\n *\n */\nfunction createStackParser(...parsers) {\n  var sortedParsers = parsers.sort((a, b) => a[0] - b[0]).map(p => p[1]);\n\n  return (stack, skipFirst = 0) => {\n    var frames = [];\n\n    for (var line of stack.split('\\n').slice(skipFirst)) {\n      // https://github.com/getsentry/sentry-javascript/issues/5459\n      // Remove webpack (error: *) wrappers\n      var cleanedLine = line.replace(/\\(error: (.*)\\)/, '$1');\n\n      for (var parser of sortedParsers) {\n        var frame = parser(cleanedLine);\n\n        if (frame) {\n          frames.push(frame);\n          break;\n        }\n      }\n    }\n\n    return stripSentryFramesAndReverse(frames);\n  };\n}\n\n/**\n * Gets a stack parser implementation from Options.stackParser\n * @see Options\n *\n * If options contains an array of line parsers, it is converted into a parser\n */\nfunction stackParserFromStackParserOptions(stackParser) {\n  if (Array.isArray(stackParser)) {\n    return createStackParser(...stackParser);\n  }\n  return stackParser;\n}\n\n/**\n * @hidden\n */\nfunction stripSentryFramesAndReverse(stack) {\n  if (!stack.length) {\n    return [];\n  }\n\n  let localStack = stack;\n\n  var firstFrameFunction = localStack[0].function || '';\n  var lastFrameFunction = localStack[localStack.length - 1].function || '';\n\n  // If stack starts with one of our API calls, remove it (starts, meaning it's the top of the stack - aka last call)\n  if (firstFrameFunction.indexOf('captureMessage') !== -1 || firstFrameFunction.indexOf('captureException') !== -1) {\n    localStack = localStack.slice(1);\n  }\n\n  // If stack ends with one of our internal API calls, remove it (ends, meaning it's the bottom of the stack - aka top-most call)\n  if (lastFrameFunction.indexOf('sentryWrapped') !== -1) {\n    localStack = localStack.slice(0, -1);\n  }\n\n  // The frame where the crash happened, should be the last entry in the array\n  return localStack\n    .slice(0, STACKTRACE_LIMIT)\n    .map(frame => ({\n      ...frame,\n      filename: frame.filename || localStack[0].filename,\n      function: frame.function || '?',\n    }))\n    .reverse();\n}\n\nvar defaultFunctionName = '<anonymous>';\n\n/**\n * Safely extract function name from itself\n */\nfunction getFunctionName(fn) {\n  try {\n    if (!fn || typeof fn !== 'function') {\n      return defaultFunctionName;\n    }\n    return fn.name || defaultFunctionName;\n  } catch (e) {\n    // Just accessing custom props in some Selenium environments\n    // can cause a \"Permission denied\" exception (see raven-js#495).\n    return defaultFunctionName;\n  }\n}\n\n// eslint-disable-next-line complexity\nfunction node(getModule) {\n  var FILENAME_MATCH = /^\\s*[-]{4,}$/;\n  var FULL_MATCH = /at (?:async )?(?:(.+?)\\s+\\()?(?:(.+):(\\d+):(\\d+)?|([^)]+))\\)?/;\n\n  // eslint-disable-next-line complexity\n  return (line) => {\n    if (line.match(FILENAME_MATCH)) {\n      return {\n        filename: line,\n      };\n    }\n\n    var lineMatch = line.match(FULL_MATCH);\n    if (!lineMatch) {\n      return undefined;\n    }\n\n    let object;\n    let method;\n    let functionName;\n    let typeName;\n    let methodName;\n\n    if (lineMatch[1]) {\n      functionName = lineMatch[1];\n\n      let methodStart = functionName.lastIndexOf('.');\n      if (functionName[methodStart - 1] === '.') {\n        // eslint-disable-next-line no-plusplus\n        methodStart--;\n      }\n\n      if (methodStart > 0) {\n        object = functionName.substr(0, methodStart);\n        method = functionName.substr(methodStart + 1);\n        var objectEnd = object.indexOf('.Module');\n        if (objectEnd > 0) {\n          functionName = functionName.substr(objectEnd + 1);\n          object = object.substr(0, objectEnd);\n        }\n      }\n      typeName = undefined;\n    }\n\n    if (method) {\n      typeName = object;\n      methodName = method;\n    }\n\n    if (method === '<anonymous>') {\n      methodName = undefined;\n      functionName = undefined;\n    }\n\n    if (functionName === undefined) {\n      methodName = methodName || '<anonymous>';\n      functionName = typeName ? `${typeName}.${methodName}` : methodName;\n    }\n\n    var filename = _optionalChain([lineMatch, 'access', _ => _[2], 'optionalAccess', _2 => _2.startsWith, 'call', _3 => _3('file://')]) ? lineMatch[2].substr(7) : lineMatch[2];\n    var isNative = lineMatch[5] === 'native';\n    var isInternal =\n      isNative || (filename && !filename.startsWith('/') && !filename.startsWith('.') && filename.indexOf(':\\\\') !== 1);\n\n    // in_app is all that's not an internal Node function or a module within node_modules\n    // note that isNative appears to return true even for node core libraries\n    // see https://github.com/getsentry/raven-node/issues/176\n    var in_app = !isInternal && filename !== undefined && !filename.includes('node_modules/');\n\n    return {\n      filename,\n      module: _optionalChain([getModule, 'optionalCall', _4 => _4(filename)]),\n      function: functionName,\n      lineno: parseInt(lineMatch[3], 10) || undefined,\n      colno: parseInt(lineMatch[4], 10) || undefined,\n      in_app,\n    };\n  };\n}\n\n/**\n * Node.js stack line parser\n *\n * This is in @sentry/utils so it can be used from the Electron SDK in the browser for when `nodeIntegration == true`.\n * This allows it to be used without referencing or importing any node specific code which causes bundlers to complain\n */\nfunction nodeStackLineParser(getModule) {\n  return [90, node(getModule)];\n}\n\nexport { createStackParser, getFunctionName, nodeStackLineParser, stackParserFromStackParserOptions, stripSentryFramesAndReverse };\n//# sourceMappingURL=stacktrace.js.map\n","import { getGlobalObject } from './global.js';\nimport { logger } from './logger.js';\n\n/**\n * Tells whether current environment supports ErrorEvent objects\n * {@link supportsErrorEvent}.\n *\n * @returns Answer to the given question.\n */\nfunction supportsErrorEvent() {\n  try {\n    new ErrorEvent('');\n    return true;\n  } catch (e) {\n    return false;\n  }\n}\n\n/**\n * Tells whether current environment supports DOMError objects\n * {@link supportsDOMError}.\n *\n * @returns Answer to the given question.\n */\nfunction supportsDOMError() {\n  try {\n    // Chrome: VM89:1 Uncaught TypeError: Failed to construct 'DOMError':\n    // 1 argument required, but only 0 present.\n    // @ts-ignore It really needs 1 argument, not 0.\n    new DOMError('');\n    return true;\n  } catch (e) {\n    return false;\n  }\n}\n\n/**\n * Tells whether current environment supports DOMException objects\n * {@link supportsDOMException}.\n *\n * @returns Answer to the given question.\n */\nfunction supportsDOMException() {\n  try {\n    new DOMException('');\n    return true;\n  } catch (e) {\n    return false;\n  }\n}\n\n/**\n * Tells whether current environment supports Fetch API\n * {@link supportsFetch}.\n *\n * @returns Answer to the given question.\n */\nfunction supportsFetch() {\n  if (!('fetch' in getGlobalObject())) {\n    return false;\n  }\n\n  try {\n    new Headers();\n    new Request('http://www.example.com');\n    new Response();\n    return true;\n  } catch (e) {\n    return false;\n  }\n}\n/**\n * isNativeFetch checks if the given function is a native implementation of fetch()\n */\n// eslint-disable-next-line @typescript-eslint/ban-types\nfunction isNativeFetch(func) {\n  return func && /^function fetch\\(\\)\\s+\\{\\s+\\[native code\\]\\s+\\}$/.test(func.toString());\n}\n\n/**\n * Tells whether current environment supports Fetch API natively\n * {@link supportsNativeFetch}.\n *\n * @returns true if `window.fetch` is natively implemented, false otherwise\n */\nfunction supportsNativeFetch() {\n  if (!supportsFetch()) {\n    return false;\n  }\n\n  var global = getGlobalObject();\n\n  // Fast path to avoid DOM I/O\n  // eslint-disable-next-line @typescript-eslint/unbound-method\n  if (isNativeFetch(global.fetch)) {\n    return true;\n  }\n\n  // window.fetch is implemented, but is polyfilled or already wrapped (e.g: by a chrome extension)\n  // so create a \"pure\" iframe to see if that has native fetch\n  let result = false;\n  var doc = global.document;\n  // eslint-disable-next-line deprecation/deprecation\n  if (doc && typeof (doc.createElement ) === 'function') {\n    try {\n      var sandbox = doc.createElement('iframe');\n      sandbox.hidden = true;\n      doc.head.appendChild(sandbox);\n      if (sandbox.contentWindow && sandbox.contentWindow.fetch) {\n        // eslint-disable-next-line @typescript-eslint/unbound-method\n        result = isNativeFetch(sandbox.contentWindow.fetch);\n      }\n      doc.head.removeChild(sandbox);\n    } catch (err) {\n      (typeof __SENTRY_DEBUG__ === 'undefined' || __SENTRY_DEBUG__) &&\n        logger.warn('Could not create sandbox iframe for pure fetch check, bailing to window.fetch: ', err);\n    }\n  }\n\n  return result;\n}\n\n/**\n * Tells whether current environment supports ReportingObserver API\n * {@link supportsReportingObserver}.\n *\n * @returns Answer to the given question.\n */\nfunction supportsReportingObserver() {\n  return 'ReportingObserver' in getGlobalObject();\n}\n\n/**\n * Tells whether current environment supports Referrer Policy API\n * {@link supportsReferrerPolicy}.\n *\n * @returns Answer to the given question.\n */\nfunction supportsReferrerPolicy() {\n  // Despite all stars in the sky saying that Edge supports old draft syntax, aka 'never', 'always', 'origin' and 'default'\n  // (see https://caniuse.com/#feat=referrer-policy),\n  // it doesn't. And it throws an exception instead of ignoring this parameter...\n  // REF: https://github.com/getsentry/raven-js/issues/1233\n\n  if (!supportsFetch()) {\n    return false;\n  }\n\n  try {\n    new Request('_', {\n      referrerPolicy: 'origin' ,\n    });\n    return true;\n  } catch (e) {\n    return false;\n  }\n}\n\n/**\n * Tells whether current environment supports History API\n * {@link supportsHistory}.\n *\n * @returns Answer to the given question.\n */\nfunction supportsHistory() {\n  // NOTE: in Chrome App environment, touching history.pushState, *even inside\n  //       a try/catch block*, will cause Chrome to output an error to console.error\n  // borrowed from: https://github.com/angular/angular.js/pull/13945/files\n  var global = getGlobalObject();\n  /* eslint-disable @typescript-eslint/no-unsafe-member-access */\n  // eslint-disable-next-line @typescript-eslint/no-explicit-any\n  var chrome = (global ).chrome;\n  var isChromePackagedApp = chrome && chrome.app && chrome.app.runtime;\n  /* eslint-enable @typescript-eslint/no-unsafe-member-access */\n  var hasHistoryApi = 'history' in global && !!global.history.pushState && !!global.history.replaceState;\n\n  return !isChromePackagedApp && hasHistoryApi;\n}\n\nexport { isNativeFetch, supportsDOMError, supportsDOMException, supportsErrorEvent, supportsFetch, supportsHistory, supportsNativeFetch, supportsReferrerPolicy, supportsReportingObserver };\n//# sourceMappingURL=supports.js.map\n","import { getGlobalObject } from './global.js';\nimport { isInstanceOf, isString } from './is.js';\nimport { logger, CONSOLE_LEVELS } from './logger.js';\nimport { fill } from './object.js';\nimport { getFunctionName } from './stacktrace.js';\nimport { supportsNativeFetch, supportsHistory } from './supports.js';\n\nvar global = getGlobalObject();\n\n/**\n * Instrument native APIs to call handlers that can be used to create breadcrumbs, APM spans etc.\n *  - Console API\n *  - Fetch API\n *  - XHR API\n *  - History API\n *  - DOM API (click/typing)\n *  - Error API\n *  - UnhandledRejection API\n */\n\nvar handlers = {};\nvar instrumented = {};\n\n/** Instruments given API */\nfunction instrument(type) {\n  if (instrumented[type]) {\n    return;\n  }\n\n  instrumented[type] = true;\n\n  switch (type) {\n    case 'console':\n      instrumentConsole();\n      break;\n    case 'dom':\n      instrumentDOM();\n      break;\n    case 'xhr':\n      instrumentXHR();\n      break;\n    case 'fetch':\n      instrumentFetch();\n      break;\n    case 'history':\n      instrumentHistory();\n      break;\n    case 'error':\n      instrumentError();\n      break;\n    case 'unhandledrejection':\n      instrumentUnhandledRejection();\n      break;\n    default:\n      (typeof __SENTRY_DEBUG__ === 'undefined' || __SENTRY_DEBUG__) && logger.warn('unknown instrumentation type:', type);\n      return;\n  }\n}\n\n/**\n * Add handler that will be called when given type of instrumentation triggers.\n * Use at your own risk, this might break without changelog notice, only used internally.\n * @hidden\n */\nfunction addInstrumentationHandler(type, callback) {\n  handlers[type] = handlers[type] || [];\n  (handlers[type] ).push(callback);\n  instrument(type);\n}\n\n/** JSDoc */\nfunction triggerHandlers(type, data) {\n  if (!type || !handlers[type]) {\n    return;\n  }\n\n  for (var handler of handlers[type] || []) {\n    try {\n      handler(data);\n    } catch (e) {\n      (typeof __SENTRY_DEBUG__ === 'undefined' || __SENTRY_DEBUG__) &&\n        logger.error(\n          `Error while triggering instrumentation handler.\\nType: ${type}\\nName: ${getFunctionName(handler)}\\nError:`,\n          e,\n        );\n    }\n  }\n}\n\n/** JSDoc */\nfunction instrumentConsole() {\n  if (!('console' in global)) {\n    return;\n  }\n\n  CONSOLE_LEVELS.forEach(function (level) {\n    if (!(level in global.console)) {\n      return;\n    }\n\n    fill(global.console, level, function (originalConsoleMethod) {\n      return function (...args) {\n        triggerHandlers('console', { args, level });\n\n        // this fails for some browsers. :(\n        if (originalConsoleMethod) {\n          originalConsoleMethod.apply(global.console, args);\n        }\n      };\n    });\n  });\n}\n\n/** JSDoc */\nfunction instrumentFetch() {\n  if (!supportsNativeFetch()) {\n    return;\n  }\n\n  fill(global, 'fetch', function (originalFetch) {\n    return function (...args) {\n      var handlerData = {\n        args,\n        fetchData: {\n          method: getFetchMethod(args),\n          url: getFetchUrl(args),\n        },\n        startTimestamp: Date.now(),\n      };\n\n      triggerHandlers('fetch', {\n        ...handlerData,\n      });\n\n      // eslint-disable-next-line @typescript-eslint/no-unsafe-member-access\n      return originalFetch.apply(global, args).then(\n        (response) => {\n          triggerHandlers('fetch', {\n            ...handlerData,\n            endTimestamp: Date.now(),\n            response,\n          });\n          return response;\n        },\n        (error) => {\n          triggerHandlers('fetch', {\n            ...handlerData,\n            endTimestamp: Date.now(),\n            error,\n          });\n          // NOTE: If you are a Sentry user, and you are seeing this stack frame,\n          //       it means the sentry.javascript SDK caught an error invoking your application code.\n          //       This is expected behavior and NOT indicative of a bug with sentry.javascript.\n          throw error;\n        },\n      );\n    };\n  });\n}\n\n/* eslint-disable @typescript-eslint/no-unsafe-member-access */\n/** Extract `method` from fetch call arguments */\nfunction getFetchMethod(fetchArgs = []) {\n  if ('Request' in global && isInstanceOf(fetchArgs[0], Request) && fetchArgs[0].method) {\n    return String(fetchArgs[0].method).toUpperCase();\n  }\n  if (fetchArgs[1] && fetchArgs[1].method) {\n    return String(fetchArgs[1].method).toUpperCase();\n  }\n  return 'GET';\n}\n\n/** Extract `url` from fetch call arguments */\nfunction getFetchUrl(fetchArgs = []) {\n  if (typeof fetchArgs[0] === 'string') {\n    return fetchArgs[0];\n  }\n  if ('Request' in global && isInstanceOf(fetchArgs[0], Request)) {\n    return fetchArgs[0].url;\n  }\n  return String(fetchArgs[0]);\n}\n/* eslint-enable @typescript-eslint/no-unsafe-member-access */\n\n/** JSDoc */\nfunction instrumentXHR() {\n  if (!('XMLHttpRequest' in global)) {\n    return;\n  }\n\n  var xhrproto = XMLHttpRequest.prototype;\n\n  fill(xhrproto, 'open', function (originalOpen) {\n    return function ( ...args) {\n      // eslint-disable-next-line @typescript-eslint/no-this-alias\n      var xhr = this;\n      var url = args[1];\n      var xhrInfo = (xhr.__sentry_xhr__ = {\n        // eslint-disable-next-line @typescript-eslint/no-unsafe-member-access\n        method: isString(args[0]) ? args[0].toUpperCase() : args[0],\n        url: args[1],\n      });\n\n      // if Sentry key appears in URL, don't capture it as a request\n      // eslint-disable-next-line @typescript-eslint/no-unsafe-member-access\n      if (isString(url) && xhrInfo.method === 'POST' && url.match(/sentry_key/)) {\n        xhr.__sentry_own_request__ = true;\n      }\n\n      var onreadystatechangeHandler = function () {\n        if (xhr.readyState === 4) {\n          try {\n            // touching statusCode in some platforms throws\n            // an exception\n            xhrInfo.status_code = xhr.status;\n          } catch (e) {\n            /* do nothing */\n          }\n\n          triggerHandlers('xhr', {\n            args,\n            endTimestamp: Date.now(),\n            startTimestamp: Date.now(),\n            xhr,\n          });\n        }\n      };\n\n      if ('onreadystatechange' in xhr && typeof xhr.onreadystatechange === 'function') {\n        fill(xhr, 'onreadystatechange', function (original) {\n          return function (...readyStateArgs) {\n            onreadystatechangeHandler();\n            return original.apply(xhr, readyStateArgs);\n          };\n        });\n      } else {\n        xhr.addEventListener('readystatechange', onreadystatechangeHandler);\n      }\n\n      return originalOpen.apply(xhr, args);\n    };\n  });\n\n  fill(xhrproto, 'send', function (originalSend) {\n    return function ( ...args) {\n      if (this.__sentry_xhr__ && args[0] !== undefined) {\n        this.__sentry_xhr__.body = args[0];\n      }\n\n      triggerHandlers('xhr', {\n        args,\n        startTimestamp: Date.now(),\n        xhr: this,\n      });\n\n      return originalSend.apply(this, args);\n    };\n  });\n}\n\nlet lastHref;\n\n/** JSDoc */\nfunction instrumentHistory() {\n  if (!supportsHistory()) {\n    return;\n  }\n\n  var oldOnPopState = global.onpopstate;\n  global.onpopstate = function ( ...args) {\n    var to = global.location.href;\n    // keep track of the current URL state, as we always receive only the updated state\n    var from = lastHref;\n    lastHref = to;\n    triggerHandlers('history', {\n      from,\n      to,\n    });\n    if (oldOnPopState) {\n      // Apparently this can throw in Firefox when incorrectly implemented plugin is installed.\n      // https://github.com/getsentry/sentry-javascript/issues/3344\n      // https://github.com/bugsnag/bugsnag-js/issues/469\n      try {\n        return oldOnPopState.apply(this, args);\n      } catch (_oO) {\n        // no-empty\n      }\n    }\n  };\n\n  /** @hidden */\n  function historyReplacementFunction(originalHistoryFunction) {\n    return function ( ...args) {\n      var url = args.length > 2 ? args[2] : undefined;\n      if (url) {\n        // coerce to string (this is what pushState does)\n        var from = lastHref;\n        var to = String(url);\n        // keep track of the current URL state, as we always receive only the updated state\n        lastHref = to;\n        triggerHandlers('history', {\n          from,\n          to,\n        });\n      }\n      return originalHistoryFunction.apply(this, args);\n    };\n  }\n\n  fill(global.history, 'pushState', historyReplacementFunction);\n  fill(global.history, 'replaceState', historyReplacementFunction);\n}\n\nvar debounceDuration = 1000;\nlet debounceTimerID;\nlet lastCapturedEvent;\n\n/**\n * Decide whether the current event should finish the debounce of previously captured one.\n * @param previous previously captured event\n * @param current event to be captured\n */\nfunction shouldShortcircuitPreviousDebounce(previous, current) {\n  // If there was no previous event, it should always be swapped for the new one.\n  if (!previous) {\n    return true;\n  }\n\n  // If both events have different type, then user definitely performed two separate actions. e.g. click + keypress.\n  if (previous.type !== current.type) {\n    return true;\n  }\n\n  try {\n    // If both events have the same type, it's still possible that actions were performed on different targets.\n    // e.g. 2 clicks on different buttons.\n    if (previous.target !== current.target) {\n      return true;\n    }\n  } catch (e) {\n    // just accessing `target` property can throw an exception in some rare circumstances\n    // see: https://github.com/getsentry/sentry-javascript/issues/838\n  }\n\n  // If both events have the same type _and_ same `target` (an element which triggered an event, _not necessarily_\n  // to which an event listener was attached), we treat them as the same action, as we want to capture\n  // only one breadcrumb. e.g. multiple clicks on the same button, or typing inside a user input box.\n  return false;\n}\n\n/**\n * Decide whether an event should be captured.\n * @param event event to be captured\n */\nfunction shouldSkipDOMEvent(event) {\n  // We are only interested in filtering `keypress` events for now.\n  if (event.type !== 'keypress') {\n    return false;\n  }\n\n  try {\n    var target = event.target ;\n\n    if (!target || !target.tagName) {\n      return true;\n    }\n\n    // Only consider keypress events on actual input elements. This will disregard keypresses targeting body\n    // e.g.tabbing through elements, hotkeys, etc.\n    if (target.tagName === 'INPUT' || target.tagName === 'TEXTAREA' || target.isContentEditable) {\n      return false;\n    }\n  } catch (e) {\n    // just accessing `target` property can throw an exception in some rare circumstances\n    // see: https://github.com/getsentry/sentry-javascript/issues/838\n  }\n\n  return true;\n}\n\n/**\n * Wraps addEventListener to capture UI breadcrumbs\n * @param handler function that will be triggered\n * @param globalListener indicates whether event was captured by the global event listener\n * @returns wrapped breadcrumb events handler\n * @hidden\n */\nfunction makeDOMEventHandler(handler, globalListener = false) {\n  return (event) => {\n    // It's possible this handler might trigger multiple times for the same\n    // event (e.g. event propagation through node ancestors).\n    // Ignore if we've already captured that event.\n    if (!event || lastCapturedEvent === event) {\n      return;\n    }\n\n    // We always want to skip _some_ events.\n    if (shouldSkipDOMEvent(event)) {\n      return;\n    }\n\n    var name = event.type === 'keypress' ? 'input' : event.type;\n\n    // If there is no debounce timer, it means that we can safely capture the new event and store it for future comparisons.\n    if (debounceTimerID === undefined) {\n      handler({\n        event: event,\n        name,\n        global: globalListener,\n      });\n      lastCapturedEvent = event;\n    }\n    // If there is a debounce awaiting, see if the new event is different enough to treat it as a unique one.\n    // If that's the case, emit the previous event and store locally the newly-captured DOM event.\n    else if (shouldShortcircuitPreviousDebounce(lastCapturedEvent, event)) {\n      handler({\n        event: event,\n        name,\n        global: globalListener,\n      });\n      lastCapturedEvent = event;\n    }\n\n    // Start a new debounce timer that will prevent us from capturing multiple events that should be grouped together.\n    clearTimeout(debounceTimerID);\n    debounceTimerID = global.setTimeout(() => {\n      debounceTimerID = undefined;\n    }, debounceDuration);\n  };\n}\n\n/** JSDoc */\nfunction instrumentDOM() {\n  if (!('document' in global)) {\n    return;\n  }\n\n  // Make it so that any click or keypress that is unhandled / bubbled up all the way to the document triggers our dom\n  // handlers. (Normally we have only one, which captures a breadcrumb for each click or keypress.) Do this before\n  // we instrument `addEventListener` so that we don't end up attaching this handler twice.\n  var triggerDOMHandler = triggerHandlers.bind(null, 'dom');\n  var globalDOMEventHandler = makeDOMEventHandler(triggerDOMHandler, true);\n  global.document.addEventListener('click', globalDOMEventHandler, false);\n  global.document.addEventListener('keypress', globalDOMEventHandler, false);\n\n  // After hooking into click and keypress events bubbled up to `document`, we also hook into user-handled\n  // clicks & keypresses, by adding an event listener of our own to any element to which they add a listener. That\n  // way, whenever one of their handlers is triggered, ours will be, too. (This is needed because their handler\n  // could potentially prevent the event from bubbling up to our global listeners. This way, our handler are still\n  // guaranteed to fire at least once.)\n  ['EventTarget', 'Node'].forEach((target) => {\n    // eslint-disable-next-line @typescript-eslint/no-unsafe-member-access\n    var proto = (global )[target] && (global )[target].prototype;\n    // eslint-disable-next-line @typescript-eslint/no-unsafe-member-access, no-prototype-builtins\n    if (!proto || !proto.hasOwnProperty || !proto.hasOwnProperty('addEventListener')) {\n      return;\n    }\n\n    fill(proto, 'addEventListener', function (originalAddEventListener) {\n      return function (\n\n        type,\n        listener,\n        options,\n      ) {\n        if (type === 'click' || type == 'keypress') {\n          try {\n            var el = this ;\n            var handlers = (el.__sentry_instrumentation_handlers__ = el.__sentry_instrumentation_handlers__ || {});\n            var handlerForType = (handlers[type] = handlers[type] || { refCount: 0 });\n\n            if (!handlerForType.handler) {\n              var handler = makeDOMEventHandler(triggerDOMHandler);\n              handlerForType.handler = handler;\n              originalAddEventListener.call(this, type, handler, options);\n            }\n\n            handlerForType.refCount += 1;\n          } catch (e) {\n            // Accessing dom properties is always fragile.\n            // Also allows us to skip `addEventListenrs` calls with no proper `this` context.\n          }\n        }\n\n        return originalAddEventListener.call(this, type, listener, options);\n      };\n    });\n\n    fill(\n      proto,\n      'removeEventListener',\n      function (originalRemoveEventListener) {\n        return function (\n\n          type,\n          listener,\n          options,\n        ) {\n          if (type === 'click' || type == 'keypress') {\n            try {\n              var el = this ;\n              var handlers = el.__sentry_instrumentation_handlers__ || {};\n              var handlerForType = handlers[type];\n\n              if (handlerForType) {\n                handlerForType.refCount -= 1;\n                // If there are no longer any custom handlers of the current type on this element, we can remove ours, too.\n                if (handlerForType.refCount <= 0) {\n                  originalRemoveEventListener.call(this, type, handlerForType.handler, options);\n                  handlerForType.handler = undefined;\n                  delete handlers[type]; // eslint-disable-line @typescript-eslint/no-dynamic-delete\n                }\n\n                // If there are no longer any custom handlers of any type on this element, cleanup everything.\n                if (Object.keys(handlers).length === 0) {\n                  delete el.__sentry_instrumentation_handlers__;\n                }\n              }\n            } catch (e) {\n              // Accessing dom properties is always fragile.\n              // Also allows us to skip `addEventListenrs` calls with no proper `this` context.\n            }\n          }\n\n          return originalRemoveEventListener.call(this, type, listener, options);\n        };\n      },\n    );\n  });\n}\n\nlet _oldOnErrorHandler = null;\n/** JSDoc */\nfunction instrumentError() {\n  _oldOnErrorHandler = global.onerror;\n\n  global.onerror = function (msg, url, line, column, error) {\n    triggerHandlers('error', {\n      column,\n      error,\n      line,\n      msg,\n      url,\n    });\n\n    if (_oldOnErrorHandler) {\n      // eslint-disable-next-line prefer-rest-params\n      return _oldOnErrorHandler.apply(this, arguments);\n    }\n\n    return false;\n  };\n}\n\nlet _oldOnUnhandledRejectionHandler = null;\n/** JSDoc */\nfunction instrumentUnhandledRejection() {\n  _oldOnUnhandledRejectionHandler = global.onunhandledrejection;\n\n  global.onunhandledrejection = function (e) {\n    triggerHandlers('unhandledrejection', e);\n\n    if (_oldOnUnhandledRejectionHandler) {\n      // eslint-disable-next-line prefer-rest-params\n      return _oldOnUnhandledRejectionHandler.apply(this, arguments);\n    }\n\n    return true;\n  };\n}\n\nexport { addInstrumentationHandler };\n//# sourceMappingURL=instrument.js.map\n","/* eslint-disable @typescript-eslint/no-unsafe-member-access */\n/* eslint-disable @typescript-eslint/no-explicit-any */\n\n/**\n * Helper to decycle json objects\n */\nfunction memoBuilder() {\n  var hasWeakSet = typeof WeakSet === 'function';\n  var inner = hasWeakSet ? new WeakSet() : [];\n  function memoize(obj) {\n    if (hasWeakSet) {\n      if (inner.has(obj)) {\n        return true;\n      }\n      inner.add(obj);\n      return false;\n    }\n    // eslint-disable-next-line @typescript-eslint/prefer-for-of\n    for (let i = 0; i < inner.length; i++) {\n      var value = inner[i];\n      if (value === obj) {\n        return true;\n      }\n    }\n    inner.push(obj);\n    return false;\n  }\n\n  function unmemoize(obj) {\n    if (hasWeakSet) {\n      inner.delete(obj);\n    } else {\n      for (let i = 0; i < inner.length; i++) {\n        if (inner[i] === obj) {\n          inner.splice(i, 1);\n          break;\n        }\n      }\n    }\n  }\n  return [memoize, unmemoize];\n}\n\nexport { memoBuilder };\n//# sourceMappingURL=memo.js.map\n","import { getGlobalObject } from './global.js';\nimport { addNonEnumerableProperty } from './object.js';\nimport { snipLine } from './string.js';\n\n/**\n * Extended Window interface that allows for Crypto API usage in IE browsers\n */\n\n/**\n * UUID4 generator\n *\n * @returns string Generated UUID4.\n */\nfunction uuid4() {\n  var global = getGlobalObject() ;\n  var crypto = (global.crypto || global.msCrypto) ;\n\n  if (crypto && crypto.randomUUID) {\n    return crypto.randomUUID().replace(/-/g, '');\n  }\n\n  var getRandomByte =\n    crypto && crypto.getRandomValues ? () => crypto.getRandomValues(new Uint8Array(1))[0] : () => Math.random() * 16;\n\n  // http://stackoverflow.com/questions/105034/how-to-create-a-guid-uuid-in-javascript/2117523#2117523\n  // Concatenating the following numbers as strings results in '10000000100040008000100000000000'\n  return (([1e7] ) + 1e3 + 4e3 + 8e3 + 1e11).replace(/[018]/g, c =>\n    // eslint-disable-next-line no-bitwise\n    ((c ) ^ ((getRandomByte() & 15) >> ((c ) / 4))).toString(16),\n  );\n}\n\nfunction getFirstException(event) {\n  return event.exception && event.exception.values ? event.exception.values[0] : undefined;\n}\n\n/**\n * Extracts either message or type+value from an event that can be used for user-facing logs\n * @returns event's description\n */\nfunction getEventDescription(event) {\n  const { message, event_id: eventId } = event;\n  if (message) {\n    return message;\n  }\n\n  var firstException = getFirstException(event);\n  if (firstException) {\n    if (firstException.type && firstException.value) {\n      return `${firstException.type}: ${firstException.value}`;\n    }\n    return firstException.type || firstException.value || eventId || '<unknown>';\n  }\n  return eventId || '<unknown>';\n}\n\n/**\n * Adds exception values, type and value to an synthetic Exception.\n * @param event The event to modify.\n * @param value Value of the exception.\n * @param type Type of the exception.\n * @hidden\n */\nfunction addExceptionTypeValue(event, value, type) {\n  var exception = (event.exception = event.exception || {});\n  var values = (exception.values = exception.values || []);\n  var firstException = (values[0] = values[0] || {});\n  if (!firstException.value) {\n    firstException.value = value || '';\n  }\n  if (!firstException.type) {\n    firstException.type = type || 'Error';\n  }\n}\n\n/**\n * Adds exception mechanism data to a given event. Uses defaults if the second parameter is not passed.\n *\n * @param event The event to modify.\n * @param newMechanism Mechanism data to add to the event.\n * @hidden\n */\nfunction addExceptionMechanism(event, newMechanism) {\n  var firstException = getFirstException(event);\n  if (!firstException) {\n    return;\n  }\n\n  var defaultMechanism = { type: 'generic', handled: true };\n  var currentMechanism = firstException.mechanism;\n  firstException.mechanism = { ...defaultMechanism, ...currentMechanism, ...newMechanism };\n\n  if (newMechanism && 'data' in newMechanism) {\n    var mergedData = { ...(currentMechanism && currentMechanism.data), ...newMechanism.data };\n    firstException.mechanism.data = mergedData;\n  }\n}\n\n// https://semver.org/#is-there-a-suggested-regular-expression-regex-to-check-a-semver-string\nvar SEMVER_REGEXP =\n  /^(0|[1-9]\\d*)\\.(0|[1-9]\\d*)\\.(0|[1-9]\\d*)(?:-((?:0|[1-9]\\d*|\\d*[a-zA-Z-][0-9a-zA-Z-]*)(?:\\.(?:0|[1-9]\\d*|\\d*[a-zA-Z-][0-9a-zA-Z-]*))*))?(?:\\+([0-9a-zA-Z-]+(?:\\.[0-9a-zA-Z-]+)*))?$/;\n\n/**\n * Represents Semantic Versioning object\n */\n\n/**\n * Parses input into a SemVer interface\n * @param input string representation of a semver version\n */\nfunction parseSemver(input) {\n  var match = input.match(SEMVER_REGEXP) || [];\n  var major = parseInt(match[1], 10);\n  var minor = parseInt(match[2], 10);\n  var patch = parseInt(match[3], 10);\n  return {\n    buildmetadata: match[5],\n    major: isNaN(major) ? undefined : major,\n    minor: isNaN(minor) ? undefined : minor,\n    patch: isNaN(patch) ? undefined : patch,\n    prerelease: match[4],\n  };\n}\n\n/**\n * This function adds context (pre/post/line) lines to the provided frame\n *\n * @param lines string[] containing all lines\n * @param frame StackFrame that will be mutated\n * @param linesOfContext number of context lines we want to add pre/post\n */\nfunction addContextToFrame(lines, frame, linesOfContext = 5) {\n  var lineno = frame.lineno || 0;\n  var maxLines = lines.length;\n  var sourceLine = Math.max(Math.min(maxLines, lineno - 1), 0);\n\n  frame.pre_context = lines\n    .slice(Math.max(0, sourceLine - linesOfContext), sourceLine)\n    .map((line) => snipLine(line, 0));\n\n  frame.context_line = snipLine(lines[Math.min(maxLines - 1, sourceLine)], frame.colno || 0);\n\n  frame.post_context = lines\n    .slice(Math.min(sourceLine + 1, maxLines), sourceLine + 1 + linesOfContext)\n    .map((line) => snipLine(line, 0));\n}\n\n/**\n * Checks whether or not we've already captured the given exception (note: not an identical exception - the very object\n * in question), and marks it captured if not.\n *\n * This is useful because it's possible for an error to get captured by more than one mechanism. After we intercept and\n * record an error, we rethrow it (assuming we've intercepted it before it's reached the top-level global handlers), so\n * that we don't interfere with whatever effects the error might have had were the SDK not there. At that point, because\n * the error has been rethrown, it's possible for it to bubble up to some other code we've instrumented. If it's not\n * caught after that, it will bubble all the way up to the global handlers (which of course we also instrument). This\n * function helps us ensure that even if we encounter the same error more than once, we only record it the first time we\n * see it.\n *\n * Note: It will ignore primitives (always return `false` and not mark them as seen), as properties can't be set on\n * them. {@link: Object.objectify} can be used on exceptions to convert any that are primitives into their equivalent\n * object wrapper forms so that this check will always work. However, because we need to flag the exact object which\n * will get rethrown, and because that rethrowing happens outside of the event processing pipeline, the objectification\n * must be done before the exception captured.\n *\n * @param A thrown exception to check or flag as having been seen\n * @returns `true` if the exception has already been captured, `false` if not (with the side effect of marking it seen)\n */\nfunction checkOrSetAlreadyCaught(exception) {\n  // eslint-disable-next-line @typescript-eslint/no-unsafe-member-access\n  if (exception && (exception ).__sentry_captured__) {\n    return true;\n  }\n\n  try {\n    // set it this way rather than by assignment so that it's not ennumerable and therefore isn't recorded by the\n    // `ExtraErrorData` integration\n    addNonEnumerableProperty(exception , '__sentry_captured__', true);\n  } catch (err) {\n    // `exception` is a primitive, so we can't mark it seen\n  }\n\n  return false;\n}\n\n/**\n * Checks whether the given input is already an array, and if it isn't, wraps it in one.\n *\n * @param maybeArray Input to turn into an array, if necessary\n * @returns The input, if already an array, or an array with the input as the only element, if not\n */\nfunction arrayify(maybeArray) {\n  return Array.isArray(maybeArray) ? maybeArray : [maybeArray];\n}\n\nexport { addContextToFrame, addExceptionMechanism, addExceptionTypeValue, arrayify, checkOrSetAlreadyCaught, getEventDescription, parseSemver, uuid4 };\n//# sourceMappingURL=misc.js.map\n","/*\n * This module exists for optimizations in the build process through rollup and terser.  We define some global\n * constants, which can be overridden during build. By guarding certain pieces of code with functions that return these\n * constants, we can control whether or not they appear in the final bundle. (Any code guarded by a false condition will\n * never run, and will hence be dropped during treeshaking.) The two primary uses for this are stripping out calls to\n * `logger` and preventing node-related code from appearing in browser bundles.\n *\n * Attention:\n * This file should not be used to define constants/flags that are intended to be used for tree-shaking conducted by\n * users. These fags should live in their respective packages, as we identified user tooling (specifically webpack)\n * having issues tree-shaking these constants across package boundaries.\n * An example for this is the __SENTRY_DEBUG__ constant. It is declared in each package individually because we want\n * users to be able to shake away expressions that it guards.\n */\n\n/**\n * Figures out if we're building a browser bundle.\n *\n * @returns true if this is a browser bundle build.\n */\nfunction isBrowserBundle() {\n  return typeof __SENTRY_BROWSER_BUNDLE__ !== 'undefined' && !!__SENTRY_BROWSER_BUNDLE__;\n}\n\nexport { isBrowserBundle };\n//# sourceMappingURL=env.js.map\n","import { isBrowserBundle } from './env.js';\n\n/**\n * NOTE: In order to avoid circular dependencies, if you add a function to this module and it needs to print something,\n * you must either a) use `console.log` rather than the logger, or b) put your function elsewhere.\n */\n\n/**\n * Checks whether we're in the Node.js or Browser environment\n *\n * @returns Answer to given question\n */\nfunction isNodeEnv() {\n  // explicitly check for browser bundles as those can be optimized statically\n  // by terser/rollup.\n  return (\n    !isBrowserBundle() &&\n    Object.prototype.toString.call(typeof process !== 'undefined' ? process : 0) === '[object process]'\n  );\n}\n\n/**\n * Requires a module which is protected against bundler minification.\n *\n * @param request The module path to resolve\n */\n// eslint-disable-next-line @typescript-eslint/explicit-module-boundary-types, @typescript-eslint/no-explicit-any\nfunction dynamicRequire(mod, request) {\n  // eslint-disable-next-line @typescript-eslint/no-unsafe-member-access\n  return mod.require(request);\n}\n\n/**\n * Helper for dynamically loading module that should work with linked dependencies.\n * The problem is that we _should_ be using `require(require.resolve(moduleName, { paths: [cwd()] }))`\n * However it's _not possible_ to do that with Webpack, as it has to know all the dependencies during\n * build time. `require.resolve` is also not available in any other way, so we cannot create,\n * a fake helper like we do with `dynamicRequire`.\n *\n * We always prefer to use local package, thus the value is not returned early from each `try/catch` block.\n * That is to mimic the behavior of `require.resolve` exactly.\n *\n * @param moduleName module name to require\n * @returns possibly required module\n */\nfunction loadModule(moduleName) {\n  let mod;\n\n  try {\n    mod = dynamicRequire(module, moduleName);\n  } catch (e) {\n    // no-empty\n  }\n\n  try {\n    const { cwd } = dynamicRequire(module, 'process');\n    mod = dynamicRequire(module, `${cwd()}/node_modules/${moduleName}`) ;\n  } catch (e) {\n    // no-empty\n  }\n\n  return mod;\n}\n\nexport { dynamicRequire, isNodeEnv, loadModule };\n//# sourceMappingURL=node.js.map\n","import { isNaN, isSyntheticEvent } from './is.js';\nimport { memoBuilder } from './memo.js';\nimport { convertToPlainObject } from './object.js';\nimport { getFunctionName } from './stacktrace.js';\n\n/**\n * Recursively normalizes the given object.\n *\n * - Creates a copy to prevent original input mutation\n * - Skips non-enumerable properties\n * - When stringifying, calls `toJSON` if implemented\n * - Removes circular references\n * - Translates non-serializable values (`undefined`/`NaN`/functions) to serializable format\n * - Translates known global objects/classes to a string representations\n * - Takes care of `Error` object serialization\n * - Optionally limits depth of final output\n * - Optionally limits number of properties/elements included in any single object/array\n *\n * @param input The object to be normalized.\n * @param depth The max depth to which to normalize the object. (Anything deeper stringified whole.)\n * @param maxProperties The max number of elements or properties to be included in any single array or\n * object in the normallized output.\n * @returns A normalized version of the object, or `\"**non-serializable**\"` if any errors are thrown during normalization.\n */\n// eslint-disable-next-line @typescript-eslint/no-explicit-any\nfunction normalize(input, depth = +Infinity, maxProperties = +Infinity) {\n  try {\n    // since we're at the outermost level, we don't provide a key\n    return visit('', input, depth, maxProperties);\n  } catch (err) {\n    return { ERROR: `**non-serializable** (${err})` };\n  }\n}\n\n/** JSDoc */\nfunction normalizeToSize(\n  // eslint-disable-next-line @typescript-eslint/no-explicit-any\n  object,\n  // Default Node.js REPL depth\n  depth = 3,\n  // 100kB, as 200kB is max payload size, so half sounds reasonable\n  maxSize = 100 * 1024,\n) {\n  var normalized = normalize(object, depth);\n\n  if (jsonSize(normalized) > maxSize) {\n    return normalizeToSize(object, depth - 1, maxSize);\n  }\n\n  return normalized ;\n}\n\n/**\n * Visits a node to perform normalization on it\n *\n * @param key The key corresponding to the given node\n * @param value The node to be visited\n * @param depth Optional number indicating the maximum recursion depth\n * @param maxProperties Optional maximum number of properties/elements included in any single object/array\n * @param memo Optional Memo class handling decycling\n */\nfunction visit(\n  key,\n  value,\n  depth = +Infinity,\n  maxProperties = +Infinity,\n  memo = memoBuilder(),\n) {\n  const [memoize, unmemoize] = memo;\n\n  // Get the simple cases out of the way first\n  if (value === null || (['number', 'boolean', 'string'].includes(typeof value) && !isNaN(value))) {\n    return value ;\n  }\n\n  var stringified = stringifyValue(key, value);\n\n  // Anything we could potentially dig into more (objects or arrays) will have come back as `\"[object XXXX]\"`.\n  // Everything else will have already been serialized, so if we don't see that pattern, we're done.\n  if (!stringified.startsWith('[object ')) {\n    return stringified;\n  }\n\n  // From here on, we can assert that `value` is either an object or an array.\n\n  // Do not normalize objects that we know have already been normalized. As a general rule, the\n  // \"__sentry_skip_normalization__\" property should only be used sparingly and only should only be set on objects that\n  // have already been normalized.\n  if ((value )['__sentry_skip_normalization__']) {\n    return value ;\n  }\n\n  // We're also done if we've reached the max depth\n  if (depth === 0) {\n    // At this point we know `serialized` is a string of the form `\"[object XXXX]\"`. Clean it up so it's just `\"[XXXX]\"`.\n    return stringified.replace('object ', '');\n  }\n\n  // If we've already visited this branch, bail out, as it's circular reference. If not, note that we're seeing it now.\n  if (memoize(value)) {\n    return '[Circular ~]';\n  }\n\n  // If the value has a `toJSON` method, we call it to extract more information\n  var valueWithToJSON = value ;\n  if (valueWithToJSON && typeof valueWithToJSON.toJSON === 'function') {\n    try {\n      var jsonValue = valueWithToJSON.toJSON();\n      // We need to normalize the return value of `.toJSON()` in case it has circular references\n      return visit('', jsonValue, depth - 1, maxProperties, memo);\n    } catch (err) {\n      // pass (The built-in `toJSON` failed, but we can still try to do it ourselves)\n    }\n  }\n\n  // At this point we know we either have an object or an array, we haven't seen it before, and we're going to recurse\n  // because we haven't yet reached the max depth. Create an accumulator to hold the results of visiting each\n  // property/entry, and keep track of the number of items we add to it.\n  var normalized = (Array.isArray(value) ? [] : {}) ;\n  let numAdded = 0;\n\n  // Before we begin, convert`Error` and`Event` instances into plain objects, since some of each of their relevant\n  // properties are non-enumerable and otherwise would get missed.\n  var visitable = convertToPlainObject(value );\n\n  for (var visitKey in visitable) {\n    // Avoid iterating over fields in the prototype if they've somehow been exposed to enumeration.\n    if (!Object.prototype.hasOwnProperty.call(visitable, visitKey)) {\n      continue;\n    }\n\n    if (numAdded >= maxProperties) {\n      normalized[visitKey] = '[MaxProperties ~]';\n      break;\n    }\n\n    // Recursively visit all the child nodes\n    var visitValue = visitable[visitKey];\n    normalized[visitKey] = visit(visitKey, visitValue, depth - 1, maxProperties, memo);\n\n    numAdded += 1;\n  }\n\n  // Once we've visited all the branches, remove the parent from memo storage\n  unmemoize(value);\n\n  // Return accumulated values\n  return normalized;\n}\n\n/**\n * Stringify the given value. Handles various known special values and types.\n *\n * Not meant to be used on simple primitives which already have a string representation, as it will, for example, turn\n * the number 1231 into \"[Object Number]\", nor on `null`, as it will throw.\n *\n * @param value The value to stringify\n * @returns A stringified representation of the given value\n */\nfunction stringifyValue(\n  key,\n  // this type is a tiny bit of a cheat, since this function does handle NaN (which is technically a number), but for\n  // our internal use, it'll do\n  value,\n) {\n  try {\n    if (key === 'domain' && value && typeof value === 'object' && (value )._events) {\n      return '[Domain]';\n    }\n\n    if (key === 'domainEmitter') {\n      return '[DomainEmitter]';\n    }\n\n    // It's safe to use `global`, `window`, and `document` here in this manner, as we are asserting using `typeof` first\n    // which won't throw if they are not present.\n\n    if (typeof global !== 'undefined' && value === global) {\n      return '[Global]';\n    }\n\n    // eslint-disable-next-line no-restricted-globals\n    if (typeof window !== 'undefined' && value === window) {\n      return '[Window]';\n    }\n\n    // eslint-disable-next-line no-restricted-globals\n    if (typeof document !== 'undefined' && value === document) {\n      return '[Document]';\n    }\n\n    // React's SyntheticEvent thingy\n    if (isSyntheticEvent(value)) {\n      return '[SyntheticEvent]';\n    }\n\n    if (typeof value === 'number' && value !== value) {\n      return '[NaN]';\n    }\n\n    // this catches `undefined` (but not `null`, which is a primitive and can be serialized on its own)\n    if (value === void 0) {\n      return '[undefined]';\n    }\n\n    if (typeof value === 'function') {\n      return `[Function: ${getFunctionName(value)}]`;\n    }\n\n    if (typeof value === 'symbol') {\n      return `[${String(value)}]`;\n    }\n\n    // stringified BigInts are indistinguishable from regular numbers, so we need to label them to avoid confusion\n    if (typeof value === 'bigint') {\n      return `[BigInt: ${String(value)}]`;\n    }\n\n    // Now that we've knocked out all the special cases and the primitives, all we have left are objects. Simply casting\n    // them to strings means that instances of classes which haven't defined their `toStringTag` will just come out as\n    // `\"[object Object]\"`. If we instead look at the constructor's name (which is the same as the name of the class),\n    // we can make sure that only plain objects come out that way.\n    return `[object ${(Object.getPrototypeOf(value) ).constructor.name}]`;\n  } catch (err) {\n    return `**non-serializable** (${err})`;\n  }\n}\n\n/** Calculates bytes size of input string */\nfunction utf8Length(value) {\n  // eslint-disable-next-line no-bitwise\n  return ~-encodeURI(value).split(/%..|./).length;\n}\n\n/** Calculates bytes size of input object */\n// eslint-disable-next-line @typescript-eslint/no-explicit-any\nfunction jsonSize(value) {\n  return utf8Length(JSON.stringify(value));\n}\n\nexport { normalize, normalizeToSize, visit as walk };\n//# sourceMappingURL=normalize.js.map\n","import { isThenable } from './is.js';\n\n/* eslint-disable @typescript-eslint/explicit-function-return-type */\n\n/** SyncPromise internal states */\nvar States; (function (States) {\n  /** Pending */\n  var PENDING = 0; States[States[\"PENDING\"] = PENDING] = \"PENDING\";\n  /** Resolved / OK */\n  var RESOLVED = 1; States[States[\"RESOLVED\"] = RESOLVED] = \"RESOLVED\";\n  /** Rejected / Error */\n  var REJECTED = 2; States[States[\"REJECTED\"] = REJECTED] = \"REJECTED\";\n})(States || (States = {}));\n\n// Overloads so we can call resolvedSyncPromise without arguments and generic argument\n\n/**\n * Creates a resolved sync promise.\n *\n * @param value the value to resolve the promise with\n * @returns the resolved sync promise\n */\nfunction resolvedSyncPromise(value) {\n  return new SyncPromise(resolve => {\n    resolve(value);\n  });\n}\n\n/**\n * Creates a rejected sync promise.\n *\n * @param value the value to reject the promise with\n * @returns the rejected sync promise\n */\nfunction rejectedSyncPromise(reason) {\n  return new SyncPromise((_, reject) => {\n    reject(reason);\n  });\n}\n\n/**\n * Thenable class that behaves like a Promise and follows it's interface\n * but is not async internally\n */\nclass SyncPromise {\n   __init() {this._state = States.PENDING;}\n   __init2() {this._handlers = [];}\n\n   constructor(\n    executor,\n  ) {;SyncPromise.prototype.__init.call(this);SyncPromise.prototype.__init2.call(this);SyncPromise.prototype.__init3.call(this);SyncPromise.prototype.__init4.call(this);SyncPromise.prototype.__init5.call(this);SyncPromise.prototype.__init6.call(this);\n    try {\n      executor(this._resolve, this._reject);\n    } catch (e) {\n      this._reject(e);\n    }\n  }\n\n  /** JSDoc */\n   then(\n    onfulfilled,\n    onrejected,\n  ) {\n    return new SyncPromise((resolve, reject) => {\n      this._handlers.push([\n        false,\n        result => {\n          if (!onfulfilled) {\n            // TODO: ¯\\_(ツ)_/¯\n            // TODO: FIXME\n            resolve(result );\n          } else {\n            try {\n              resolve(onfulfilled(result));\n            } catch (e) {\n              reject(e);\n            }\n          }\n        },\n        reason => {\n          if (!onrejected) {\n            reject(reason);\n          } else {\n            try {\n              resolve(onrejected(reason));\n            } catch (e) {\n              reject(e);\n            }\n          }\n        },\n      ]);\n      this._executeHandlers();\n    });\n  }\n\n  /** JSDoc */\n   catch(\n    onrejected,\n  ) {\n    return this.then(val => val, onrejected);\n  }\n\n  /** JSDoc */\n   finally(onfinally) {\n    return new SyncPromise((resolve, reject) => {\n      let val;\n      let isRejected;\n\n      return this.then(\n        value => {\n          isRejected = false;\n          val = value;\n          if (onfinally) {\n            onfinally();\n          }\n        },\n        reason => {\n          isRejected = true;\n          val = reason;\n          if (onfinally) {\n            onfinally();\n          }\n        },\n      ).then(() => {\n        if (isRejected) {\n          reject(val);\n          return;\n        }\n\n        resolve(val );\n      });\n    });\n  }\n\n  /** JSDoc */\n    __init3() {this._resolve = (value) => {\n    this._setResult(States.RESOLVED, value);\n  };}\n\n  /** JSDoc */\n    __init4() {this._reject = (reason) => {\n    this._setResult(States.REJECTED, reason);\n  };}\n\n  /** JSDoc */\n    __init5() {this._setResult = (state, value) => {\n    if (this._state !== States.PENDING) {\n      return;\n    }\n\n    if (isThenable(value)) {\n      void (value ).then(this._resolve, this._reject);\n      return;\n    }\n\n    this._state = state;\n    this._value = value;\n\n    this._executeHandlers();\n  };}\n\n  /** JSDoc */\n    __init6() {this._executeHandlers = () => {\n    if (this._state === States.PENDING) {\n      return;\n    }\n\n    var cachedHandlers = this._handlers.slice();\n    this._handlers = [];\n\n    cachedHandlers.forEach(handler => {\n      if (handler[0]) {\n        return;\n      }\n\n      if (this._state === States.RESOLVED) {\n        // eslint-disable-next-line @typescript-eslint/no-floating-promises\n        handler[1](this._value );\n      }\n\n      if (this._state === States.REJECTED) {\n        handler[2](this._value);\n      }\n\n      handler[0] = true;\n    });\n  };}\n}\n\nexport { SyncPromise, rejectedSyncPromise, resolvedSyncPromise };\n//# sourceMappingURL=syncpromise.js.map\n","import { SentryError } from './error.js';\nimport { rejectedSyncPromise, SyncPromise, resolvedSyncPromise } from './syncpromise.js';\n\n/**\n * Creates an new PromiseBuffer object with the specified limit\n * @param limit max number of promises that can be stored in the buffer\n */\nfunction makePromiseBuffer(limit) {\n  var buffer = [];\n\n  function isReady() {\n    return limit === undefined || buffer.length < limit;\n  }\n\n  /**\n   * Remove a promise from the queue.\n   *\n   * @param task Can be any PromiseLike<T>\n   * @returns Removed promise.\n   */\n  function remove(task) {\n    return buffer.splice(buffer.indexOf(task), 1)[0];\n  }\n\n  /**\n   * Add a promise (representing an in-flight action) to the queue, and set it to remove itself on fulfillment.\n   *\n   * @param taskProducer A function producing any PromiseLike<T>; In previous versions this used to be `task:\n   *        PromiseLike<T>`, but under that model, Promises were instantly created on the call-site and their executor\n   *        functions therefore ran immediately. Thus, even if the buffer was full, the action still happened. By\n   *        requiring the promise to be wrapped in a function, we can defer promise creation until after the buffer\n   *        limit check.\n   * @returns The original promise.\n   */\n  function add(taskProducer) {\n    if (!isReady()) {\n      return rejectedSyncPromise(new SentryError('Not adding Promise because buffer limit was reached.'));\n    }\n\n    // start the task and add its promise to the queue\n    var task = taskProducer();\n    if (buffer.indexOf(task) === -1) {\n      buffer.push(task);\n    }\n    void task\n      .then(() => remove(task))\n      // Use `then(null, rejectionHandler)` rather than `catch(rejectionHandler)` so that we can use `PromiseLike`\n      // rather than `Promise`. `PromiseLike` doesn't have a `.catch` method, making its polyfill smaller. (ES5 didn't\n      // have promises, so TS has to polyfill when down-compiling.)\n      .then(null, () =>\n        remove(task).then(null, () => {\n          // We have to add another catch here because `remove()` starts a new promise chain.\n        }),\n      );\n    return task;\n  }\n\n  /**\n   * Wait for all promises in the queue to resolve or for timeout to expire, whichever comes first.\n   *\n   * @param timeout The time, in ms, after which to resolve to `false` if the queue is still non-empty. Passing `0` (or\n   * not passing anything) will make the promise wait as long as it takes for the queue to drain before resolving to\n   * `true`.\n   * @returns A promise which will resolve to `true` if the queue is already empty or drains before the timeout, and\n   * `false` otherwise\n   */\n  function drain(timeout) {\n    return new SyncPromise((resolve, reject) => {\n      let counter = buffer.length;\n\n      if (!counter) {\n        return resolve(true);\n      }\n\n      // wait for `timeout` ms and then resolve to `false` (if not cancelled first)\n      var capturedSetTimeout = setTimeout(() => {\n        if (timeout && timeout > 0) {\n          resolve(false);\n        }\n      }, timeout);\n\n      // if all promises resolve in time, cancel the timer and resolve to `true`\n      buffer.forEach(item => {\n        void resolvedSyncPromise(item).then(() => {\n          // eslint-disable-next-line no-plusplus\n          if (!--counter) {\n            clearTimeout(capturedSetTimeout);\n            resolve(true);\n          }\n        }, reject);\n      });\n    });\n  }\n\n  return {\n    $: buffer,\n    add,\n    drain,\n  };\n}\n\nexport { makePromiseBuffer };\n//# sourceMappingURL=promisebuffer.js.map\n","/**\n * Parses string form of URL into an object\n * // borrowed from https://tools.ietf.org/html/rfc3986#appendix-B\n * // intentionally using regex and not <a/> href parsing trick because React Native and other\n * // environments where DOM might not be available\n * @returns parsed URL object\n */\nfunction parseUrl(url)\n\n {\n  if (!url) {\n    return {};\n  }\n\n  var match = url.match(/^(([^:/?#]+):)?(\\/\\/([^/?#]*))?([^?#]*)(\\?([^#]*))?(#(.*))?$/);\n\n  if (!match) {\n    return {};\n  }\n\n  // coerce to undefined values to empty string so we don't get 'undefined'\n  var query = match[6] || '';\n  var fragment = match[8] || '';\n  return {\n    host: match[4],\n    path: match[5],\n    protocol: match[2],\n    relative: match[5] + query + fragment, // everything minus origin\n  };\n}\n\n/**\n * Strip the query string and fragment off of a given URL or path (if present)\n *\n * @param urlPath Full URL or path, including possible query string and/or fragment\n * @returns URL or path without query string or fragment\n */\nfunction stripUrlQueryAndFragment(urlPath) {\n  // eslint-disable-next-line no-useless-escape\n  return urlPath.split(/[\\?#]/, 1)[0];\n}\n\n/**\n * Returns number of URL segments of a passed string URL.\n */\nfunction getNumberOfUrlSegments(url) {\n  // split at '/' or at '\\/' to split regex urls correctly\n  return url.split(/\\\\?\\//).filter(s => s.length > 0 && s !== ',').length;\n}\n\nexport { getNumberOfUrlSegments, parseUrl, stripUrlQueryAndFragment };\n//# sourceMappingURL=url.js.map\n","// Note: Ideally the `SeverityLevel` type would be derived from `validSeverityLevels`, but that would mean either\n//\n// a) moving `validSeverityLevels` to `@sentry/types`,\n// b) moving the`SeverityLevel` type here, or\n// c) importing `validSeverityLevels` from here into `@sentry/types`.\n//\n// Option A would make `@sentry/types` a runtime dependency of `@sentry/utils` (not good), and options B and C would\n// create a circular dependency between `@sentry/types` and `@sentry/utils` (also not good). So a TODO accompanying the\n// type, reminding anyone who changes it to change this list also, will have to do.\n\nvar validSeverityLevels = ['fatal', 'error', 'warning', 'log', 'info', 'debug'];\n\n/**\n * Converts a string-based level into a member of the deprecated {@link Severity} enum.\n *\n * @deprecated `severityFromString` is deprecated. Please use `severityLevelFromString` instead.\n *\n * @param level String representation of Severity\n * @returns Severity\n */\nfunction severityFromString(level) {\n  return severityLevelFromString(level) ;\n}\n\n/**\n * Converts a string-based level into a `SeverityLevel`, normalizing it along the way.\n *\n * @param level String representation of desired `SeverityLevel`.\n * @returns The `SeverityLevel` corresponding to the given string, or 'log' if the string isn't a valid level.\n */\nfunction severityLevelFromString(level) {\n  return (level === 'warn' ? 'warning' : validSeverityLevels.includes(level) ? level : 'log') ;\n}\n\nexport { severityFromString, severityLevelFromString, validSeverityLevels };\n//# sourceMappingURL=severity.js.map\n","import { getGlobalObject } from './global.js';\nimport { dynamicRequire, isNodeEnv } from './node.js';\n\n/**\n * An object that can return the current timestamp in seconds since the UNIX epoch.\n */\n\n/**\n * A TimestampSource implementation for environments that do not support the Performance Web API natively.\n *\n * Note that this TimestampSource does not use a monotonic clock. A call to `nowSeconds` may return a timestamp earlier\n * than a previously returned value. We do not try to emulate a monotonic behavior in order to facilitate debugging. It\n * is more obvious to explain \"why does my span have negative duration\" than \"why my spans have zero duration\".\n */\nvar dateTimestampSource = {\n  nowSeconds: () => Date.now() / 1000,\n};\n\n/**\n * A partial definition of the [Performance Web API]{@link https://developer.mozilla.org/en-US/docs/Web/API/Performance}\n * for accessing a high-resolution monotonic clock.\n */\n\n/**\n * Returns a wrapper around the native Performance API browser implementation, or undefined for browsers that do not\n * support the API.\n *\n * Wrapping the native API works around differences in behavior from different browsers.\n */\nfunction getBrowserPerformance() {\n  const { performance } = getGlobalObject();\n  if (!performance || !performance.now) {\n    return undefined;\n  }\n\n  // Replace performance.timeOrigin with our own timeOrigin based on Date.now().\n  //\n  // This is a partial workaround for browsers reporting performance.timeOrigin such that performance.timeOrigin +\n  // performance.now() gives a date arbitrarily in the past.\n  //\n  // Additionally, computing timeOrigin in this way fills the gap for browsers where performance.timeOrigin is\n  // undefined.\n  //\n  // The assumption that performance.timeOrigin + performance.now() ~= Date.now() is flawed, but we depend on it to\n  // interact with data coming out of performance entries.\n  //\n  // Note that despite recommendations against it in the spec, browsers implement the Performance API with a clock that\n  // might stop when the computer is asleep (and perhaps under other circumstances). Such behavior causes\n  // performance.timeOrigin + performance.now() to have an arbitrary skew over Date.now(). In laptop computers, we have\n  // observed skews that can be as long as days, weeks or months.\n  //\n  // See https://github.com/getsentry/sentry-javascript/issues/2590.\n  //\n  // BUG: despite our best intentions, this workaround has its limitations. It mostly addresses timings of pageload\n  // transactions, but ignores the skew built up over time that can aversely affect timestamps of navigation\n  // transactions of long-lived web pages.\n  var timeOrigin = Date.now() - performance.now();\n\n  return {\n    now: () => performance.now(),\n    timeOrigin,\n  };\n}\n\n/**\n * Returns the native Performance API implementation from Node.js. Returns undefined in old Node.js versions that don't\n * implement the API.\n */\nfunction getNodePerformance() {\n  try {\n    var perfHooks = dynamicRequire(module, 'perf_hooks') ;\n    return perfHooks.performance;\n  } catch (_) {\n    return undefined;\n  }\n}\n\n/**\n * The Performance API implementation for the current platform, if available.\n */\nvar platformPerformance = isNodeEnv() ? getNodePerformance() : getBrowserPerformance();\n\nvar timestampSource =\n  platformPerformance === undefined\n    ? dateTimestampSource\n    : {\n        nowSeconds: () => (platformPerformance.timeOrigin + platformPerformance.now()) / 1000,\n      };\n\n/**\n * Returns a timestamp in seconds since the UNIX epoch using the Date API.\n */\nvar dateTimestampInSeconds = dateTimestampSource.nowSeconds.bind(dateTimestampSource);\n\n/**\n * Returns a timestamp in seconds since the UNIX epoch using either the Performance or Date APIs, depending on the\n * availability of the Performance API.\n *\n * See `usingPerformanceAPI` to test whether the Performance API is used.\n *\n * BUG: Note that because of how browsers implement the Performance API, the clock might stop when the computer is\n * asleep. This creates a skew between `dateTimestampInSeconds` and `timestampInSeconds`. The\n * skew can grow to arbitrary amounts like days, weeks or months.\n * See https://github.com/getsentry/sentry-javascript/issues/2590.\n */\nvar timestampInSeconds = timestampSource.nowSeconds.bind(timestampSource);\n\n// Re-exported with an old name for backwards-compatibility.\nvar timestampWithMs = timestampInSeconds;\n\n/**\n * A boolean that is true when timestampInSeconds uses the Performance API to produce monotonic timestamps.\n */\nvar usingPerformanceAPI = platformPerformance !== undefined;\n\n/**\n * Internal helper to store what is the source of browserPerformanceTimeOrigin below. For debugging only.\n */\nlet _browserPerformanceTimeOriginMode;\n\n/**\n * The number of milliseconds since the UNIX epoch. This value is only usable in a browser, and only when the\n * performance API is available.\n */\nvar browserPerformanceTimeOrigin = (() => {\n  // Unfortunately browsers may report an inaccurate time origin data, through either performance.timeOrigin or\n  // performance.timing.navigationStart, which results in poor results in performance data. We only treat time origin\n  // data as reliable if they are within a reasonable threshold of the current time.\n\n  const { performance } = getGlobalObject();\n  if (!performance || !performance.now) {\n    _browserPerformanceTimeOriginMode = 'none';\n    return undefined;\n  }\n\n  var threshold = 3600 * 1000;\n  var performanceNow = performance.now();\n  var dateNow = Date.now();\n\n  // if timeOrigin isn't available set delta to threshold so it isn't used\n  var timeOriginDelta = performance.timeOrigin\n    ? Math.abs(performance.timeOrigin + performanceNow - dateNow)\n    : threshold;\n  var timeOriginIsReliable = timeOriginDelta < threshold;\n\n  // While performance.timing.navigationStart is deprecated in favor of performance.timeOrigin, performance.timeOrigin\n  // is not as widely supported. Namely, performance.timeOrigin is undefined in Safari as of writing.\n  // Also as of writing, performance.timing is not available in Web Workers in mainstream browsers, so it is not always\n  // a valid fallback. In the absence of an initial time provided by the browser, fallback to the current time from the\n  // Date API.\n  // eslint-disable-next-line deprecation/deprecation\n  var navigationStart = performance.timing && performance.timing.navigationStart;\n  var hasNavigationStart = typeof navigationStart === 'number';\n  // if navigationStart isn't available set delta to threshold so it isn't used\n  var navigationStartDelta = hasNavigationStart ? Math.abs(navigationStart + performanceNow - dateNow) : threshold;\n  var navigationStartIsReliable = navigationStartDelta < threshold;\n\n  if (timeOriginIsReliable || navigationStartIsReliable) {\n    // Use the more reliable time origin\n    if (timeOriginDelta <= navigationStartDelta) {\n      _browserPerformanceTimeOriginMode = 'timeOrigin';\n      return performance.timeOrigin;\n    } else {\n      _browserPerformanceTimeOriginMode = 'navigationStart';\n      return navigationStart;\n    }\n  }\n\n  // Either both timeOrigin and navigationStart are skewed or neither is available, fallback to Date.\n  _browserPerformanceTimeOriginMode = 'dateNow';\n  return dateNow;\n})();\n\nexport { _browserPerformanceTimeOriginMode, browserPerformanceTimeOrigin, dateTimestampInSeconds, timestampInSeconds, timestampWithMs, usingPerformanceAPI };\n//# sourceMappingURL=time.js.map\n","import { dropUndefinedKeys } from './object.js';\n\n/**\n * Creates an envelope.\n * Make sure to always explicitly provide the generic to this function\n * so that the envelope types resolve correctly.\n */\nfunction createEnvelope(headers, items = []) {\n  return [headers, items] ;\n}\n\n/**\n * Add an item to an envelope.\n * Make sure to always explicitly provide the generic to this function\n * so that the envelope types resolve correctly.\n */\nfunction addItemToEnvelope(envelope, newItem) {\n  const [headers, items] = envelope;\n  return [headers, [...items, newItem]] ;\n}\n\n/**\n * Convenience function to loop through the items and item types of an envelope.\n * (This function was mostly created because working with envelope types is painful at the moment)\n */\nfunction forEachEnvelopeItem(\n  envelope,\n  callback,\n) {\n  var envelopeItems = envelope[1];\n  envelopeItems.forEach((envelopeItem) => {\n    var envelopeItemType = envelopeItem[0].type;\n    callback(envelopeItem, envelopeItemType);\n  });\n}\n\nfunction encodeUTF8(input, textEncoder) {\n  var utf8 = textEncoder || new TextEncoder();\n  return utf8.encode(input);\n}\n\n/**\n * Serializes an envelope.\n */\nfunction serializeEnvelope(envelope, textEncoder) {\n  const [envHeaders, items] = envelope;\n\n  // Initially we construct our envelope as a string and only convert to binary chunks if we encounter binary data\n  let parts = JSON.stringify(envHeaders);\n\n  function append(next) {\n    if (typeof parts === 'string') {\n      parts = typeof next === 'string' ? parts + next : [encodeUTF8(parts, textEncoder), next];\n    } else {\n      parts.push(typeof next === 'string' ? encodeUTF8(next, textEncoder) : next);\n    }\n  }\n\n  for (var item of items) {\n    const [itemHeaders, payload] = item ;\n    append(`\\n${JSON.stringify(itemHeaders)}\\n`);\n    append(typeof payload === 'string' || payload instanceof Uint8Array ? payload : JSON.stringify(payload));\n  }\n\n  return typeof parts === 'string' ? parts : concatBuffers(parts);\n}\n\nfunction concatBuffers(buffers) {\n  var totalLength = buffers.reduce((acc, buf) => acc + buf.length, 0);\n\n  var merged = new Uint8Array(totalLength);\n  let offset = 0;\n  for (var buffer of buffers) {\n    merged.set(buffer, offset);\n    offset += buffer.length;\n  }\n\n  return merged;\n}\n\n/**\n * Creates attachment envelope items\n */\nfunction createAttachmentEnvelopeItem(\n  attachment,\n  textEncoder,\n) {\n  var buffer = typeof attachment.data === 'string' ? encodeUTF8(attachment.data, textEncoder) : attachment.data;\n\n  return [\n    dropUndefinedKeys({\n      type: 'attachment',\n      length: buffer.length,\n      filename: attachment.filename,\n      content_type: attachment.contentType,\n      attachment_type: attachment.attachmentType,\n    }),\n    buffer,\n  ];\n}\n\nvar ITEM_TYPE_TO_DATA_CATEGORY_MAP = {\n  session: 'session',\n  sessions: 'session',\n  attachment: 'attachment',\n  transaction: 'transaction',\n  event: 'error',\n  client_report: 'internal',\n  user_report: 'default',\n};\n\n/**\n * Maps the type of an envelope item to a data category.\n */\nfunction envelopeItemTypeToDataCategory(type) {\n  return ITEM_TYPE_TO_DATA_CATEGORY_MAP[type];\n}\n\nexport { addItemToEnvelope, createAttachmentEnvelopeItem, createEnvelope, envelopeItemTypeToDataCategory, forEachEnvelopeItem, serializeEnvelope };\n//# sourceMappingURL=envelope.js.map\n","import { createEnvelope } from './envelope.js';\nimport { dateTimestampInSeconds } from './time.js';\n\n/**\n * Creates client report envelope\n * @param discarded_events An array of discard events\n * @param dsn A DSN that can be set on the header. Optional.\n */\nfunction createClientReportEnvelope(\n  discarded_events,\n  dsn,\n  timestamp,\n) {\n  var clientReportItem = [\n    { type: 'client_report' },\n    {\n      timestamp: timestamp || dateTimestampInSeconds(),\n      discarded_events,\n    },\n  ];\n  return createEnvelope(dsn ? { dsn } : {}, [clientReportItem]);\n}\n\nexport { createClientReportEnvelope };\n//# sourceMappingURL=clientreport.js.map\n","// Intentionally keeping the key broad, as we don't know for sure what rate limit headers get returned from backend\n\nvar DEFAULT_RETRY_AFTER = 60 * 1000; // 60 seconds\n\n/**\n * Extracts Retry-After value from the request header or returns default value\n * @param header string representation of 'Retry-After' header\n * @param now current unix timestamp\n *\n */\nfunction parseRetryAfterHeader(header, now = Date.now()) {\n  var headerDelay = parseInt(`${header}`, 10);\n  if (!isNaN(headerDelay)) {\n    return headerDelay * 1000;\n  }\n\n  var headerDate = Date.parse(`${header}`);\n  if (!isNaN(headerDate)) {\n    return headerDate - now;\n  }\n\n  return DEFAULT_RETRY_AFTER;\n}\n\n/**\n * Gets the time that given category is disabled until for rate limiting\n */\nfunction disabledUntil(limits, category) {\n  return limits[category] || limits.all || 0;\n}\n\n/**\n * Checks if a category is rate limited\n */\nfunction isRateLimited(limits, category, now = Date.now()) {\n  return disabledUntil(limits, category) > now;\n}\n\n/**\n * Update ratelimits from incoming headers.\n * Returns true if headers contains a non-empty rate limiting header.\n */\nfunction updateRateLimits(\n  limits,\n  { statusCode, headers },\n  now = Date.now(),\n) {\n  var updatedRateLimits = {\n    ...limits,\n  };\n\n  // \"The name is case-insensitive.\"\n  // https://developer.mozilla.org/en-US/docs/Web/API/Headers/get\n  var rateLimitHeader = headers && headers['x-sentry-rate-limits'];\n  var retryAfterHeader = headers && headers['retry-after'];\n\n  if (rateLimitHeader) {\n    /**\n     * rate limit headers are of the form\n     *     <header>,<header>,..\n     * where each <header> is of the form\n     *     <retry_after>: <categories>: <scope>: <reason_code>\n     * where\n     *     <retry_after> is a delay in seconds\n     *     <categories> is the event type(s) (error, transaction, etc) being rate limited and is of the form\n     *         <category>;<category>;...\n     *     <scope> is what's being limited (org, project, or key) - ignored by SDK\n     *     <reason_code> is an arbitrary string like \"org_quota\" - ignored by SDK\n     */\n    for (var limit of rateLimitHeader.trim().split(',')) {\n      const [retryAfter, categories] = limit.split(':', 2);\n      var headerDelay = parseInt(retryAfter, 10);\n      var delay = (!isNaN(headerDelay) ? headerDelay : 60) * 1000; // 60sec default\n      if (!categories) {\n        updatedRateLimits.all = now + delay;\n      } else {\n        for (var category of categories.split(';')) {\n          updatedRateLimits[category] = now + delay;\n        }\n      }\n    }\n  } else if (retryAfterHeader) {\n    updatedRateLimits.all = now + parseRetryAfterHeader(retryAfterHeader, now);\n  } else if (statusCode === 429) {\n    updatedRateLimits.all = now + 60 * 1000;\n  }\n\n  return updatedRateLimits;\n}\n\nexport { DEFAULT_RETRY_AFTER, disabledUntil, isRateLimited, parseRetryAfterHeader, updateRateLimits };\n//# sourceMappingURL=ratelimit.js.map\n","import { timestampInSeconds, uuid4, dropUndefinedKeys } from '@sentry/utils';\n\n/**\n * Creates a new `Session` object by setting certain default parameters. If optional @param context\n * is passed, the passed properties are applied to the session object.\n *\n * @param context (optional) additional properties to be applied to the returned session object\n *\n * @returns a new `Session` object\n */\nfunction makeSession(context) {\n  // Both timestamp and started are in seconds since the UNIX epoch.\n  var startingTime = timestampInSeconds();\n\n  var session = {\n    sid: uuid4(),\n    init: true,\n    timestamp: startingTime,\n    started: startingTime,\n    duration: 0,\n    status: 'ok',\n    errors: 0,\n    ignoreDuration: false,\n    toJSON: () => sessionToJSON(session),\n  };\n\n  if (context) {\n    updateSession(session, context);\n  }\n\n  return session;\n}\n\n/**\n * Updates a session object with the properties passed in the context.\n *\n * Note that this function mutates the passed object and returns void.\n * (Had to do this instead of returning a new and updated session because closing and sending a session\n * makes an update to the session after it was passed to the sending logic.\n * @see BaseClient.captureSession )\n *\n * @param session the `Session` to update\n * @param context the `SessionContext` holding the properties that should be updated in @param session\n */\n// eslint-disable-next-line complexity\nfunction updateSession(session, context = {}) {\n  if (context.user) {\n    if (!session.ipAddress && context.user.ip_address) {\n      session.ipAddress = context.user.ip_address;\n    }\n\n    if (!session.did && !context.did) {\n      session.did = context.user.id || context.user.email || context.user.username;\n    }\n  }\n\n  session.timestamp = context.timestamp || timestampInSeconds();\n\n  if (context.ignoreDuration) {\n    session.ignoreDuration = context.ignoreDuration;\n  }\n  if (context.sid) {\n    // Good enough uuid validation. — Kamil\n    session.sid = context.sid.length === 32 ? context.sid : uuid4();\n  }\n  if (context.init !== undefined) {\n    session.init = context.init;\n  }\n  if (!session.did && context.did) {\n    session.did = `${context.did}`;\n  }\n  if (typeof context.started === 'number') {\n    session.started = context.started;\n  }\n  if (session.ignoreDuration) {\n    session.duration = undefined;\n  } else if (typeof context.duration === 'number') {\n    session.duration = context.duration;\n  } else {\n    var duration = session.timestamp - session.started;\n    session.duration = duration >= 0 ? duration : 0;\n  }\n  if (context.release) {\n    session.release = context.release;\n  }\n  if (context.environment) {\n    session.environment = context.environment;\n  }\n  if (!session.ipAddress && context.ipAddress) {\n    session.ipAddress = context.ipAddress;\n  }\n  if (!session.userAgent && context.userAgent) {\n    session.userAgent = context.userAgent;\n  }\n  if (typeof context.errors === 'number') {\n    session.errors = context.errors;\n  }\n  if (context.status) {\n    session.status = context.status;\n  }\n}\n\n/**\n * Closes a session by setting its status and updating the session object with it.\n * Internally calls `updateSession` to update the passed session object.\n *\n * Note that this function mutates the passed session (@see updateSession for explanation).\n *\n * @param session the `Session` object to be closed\n * @param status the `SessionStatus` with which the session was closed. If you don't pass a status,\n *               this function will keep the previously set status, unless it was `'ok'` in which case\n *               it is changed to `'exited'`.\n */\nfunction closeSession(session, status) {\n  let context = {};\n  if (status) {\n    context = { status };\n  } else if (session.status === 'ok') {\n    context = { status: 'exited' };\n  }\n\n  updateSession(session, context);\n}\n\n/**\n * Serializes a passed session object to a JSON object with a slightly different structure.\n * This is necessary because the Sentry backend requires a slightly different schema of a session\n * than the one the JS SDKs use internally.\n *\n * @param session the session to be converted\n *\n * @returns a JSON object of the passed session\n */\nfunction sessionToJSON(session) {\n  return dropUndefinedKeys({\n    sid: `${session.sid}`,\n    init: session.init,\n    // Make sure that sec is converted to ms for date constructor\n    started: new Date(session.started * 1000).toISOString(),\n    timestamp: new Date(session.timestamp * 1000).toISOString(),\n    status: session.status,\n    errors: session.errors,\n    did: typeof session.did === 'number' || typeof session.did === 'string' ? `${session.did}` : undefined,\n    duration: session.duration,\n    attrs: {\n      release: session.release,\n      environment: session.environment,\n      ip_address: session.ipAddress,\n      user_agent: session.userAgent,\n    },\n  });\n}\n\nexport { closeSession, makeSession, updateSession };\n//# sourceMappingURL=session.js.map\n","import { isPlainObject, dateTimestampInSeconds, getGlobalSingleton, SyncPromise, logger, isThenable, arrayify } from '@sentry/utils';\nimport { updateSession } from './session.js';\n\n/**\n * Absolute maximum number of breadcrumbs added to an event.\n * The `maxBreadcrumbs` option cannot be higher than this value.\n */\nvar MAX_BREADCRUMBS = 100;\n\n/**\n * Holds additional event information. {@link Scope.applyToEvent} will be\n * called by the client before an event will be sent.\n */\nclass Scope  {\n  /** Flag if notifying is happening. */\n\n  /** Callback for client to receive scope changes. */\n\n  /** Callback list that will be called after {@link applyToEvent}. */\n\n  /** Array of breadcrumbs. */\n\n  /** User */\n\n  /** Tags */\n\n  /** Extra */\n\n  /** Contexts */\n\n  /** Attachments */\n\n  /**\n   * A place to stash data which is needed at some point in the SDK's event processing pipeline but which shouldn't get\n   * sent to Sentry\n   */\n\n  /** Fingerprint */\n\n  /** Severity */\n  // eslint-disable-next-line deprecation/deprecation\n\n  /** Transaction Name */\n\n  /** Span */\n\n  /** Session */\n\n  /** Request Mode Session Status */\n\n   constructor() {\n    this._notifyingListeners = false;\n    this._scopeListeners = [];\n    this._eventProcessors = [];\n    this._breadcrumbs = [];\n    this._attachments = [];\n    this._user = {};\n    this._tags = {};\n    this._extra = {};\n    this._contexts = {};\n    this._sdkProcessingMetadata = {};\n  }\n\n  /**\n   * Inherit values from the parent scope.\n   * @param scope to clone.\n   */\n   static clone(scope) {\n    var newScope = new Scope();\n    if (scope) {\n      newScope._breadcrumbs = [...scope._breadcrumbs];\n      newScope._tags = { ...scope._tags };\n      newScope._extra = { ...scope._extra };\n      newScope._contexts = { ...scope._contexts };\n      newScope._user = scope._user;\n      newScope._level = scope._level;\n      newScope._span = scope._span;\n      newScope._session = scope._session;\n      newScope._transactionName = scope._transactionName;\n      newScope._fingerprint = scope._fingerprint;\n      newScope._eventProcessors = [...scope._eventProcessors];\n      newScope._requestSession = scope._requestSession;\n      newScope._attachments = [...scope._attachments];\n    }\n    return newScope;\n  }\n\n  /**\n   * Add internal on change listener. Used for sub SDKs that need to store the scope.\n   * @hidden\n   */\n   addScopeListener(callback) {\n    this._scopeListeners.push(callback);\n  }\n\n  /**\n   * @inheritDoc\n   */\n   addEventProcessor(callback) {\n    this._eventProcessors.push(callback);\n    return this;\n  }\n\n  /**\n   * @inheritDoc\n   */\n   setUser(user) {\n    this._user = user || {};\n    if (this._session) {\n      updateSession(this._session, { user });\n    }\n    this._notifyScopeListeners();\n    return this;\n  }\n\n  /**\n   * @inheritDoc\n   */\n   getUser() {\n    return this._user;\n  }\n\n  /**\n   * @inheritDoc\n   */\n   getRequestSession() {\n    return this._requestSession;\n  }\n\n  /**\n   * @inheritDoc\n   */\n   setRequestSession(requestSession) {\n    this._requestSession = requestSession;\n    return this;\n  }\n\n  /**\n   * @inheritDoc\n   */\n   setTags(tags) {\n    this._tags = {\n      ...this._tags,\n      ...tags,\n    };\n    this._notifyScopeListeners();\n    return this;\n  }\n\n  /**\n   * @inheritDoc\n   */\n   setTag(key, value) {\n    this._tags = { ...this._tags, [key]: value };\n    this._notifyScopeListeners();\n    return this;\n  }\n\n  /**\n   * @inheritDoc\n   */\n   setExtras(extras) {\n    this._extra = {\n      ...this._extra,\n      ...extras,\n    };\n    this._notifyScopeListeners();\n    return this;\n  }\n\n  /**\n   * @inheritDoc\n   */\n   setExtra(key, extra) {\n    this._extra = { ...this._extra, [key]: extra };\n    this._notifyScopeListeners();\n    return this;\n  }\n\n  /**\n   * @inheritDoc\n   */\n   setFingerprint(fingerprint) {\n    this._fingerprint = fingerprint;\n    this._notifyScopeListeners();\n    return this;\n  }\n\n  /**\n   * @inheritDoc\n   */\n   setLevel(\n    // eslint-disable-next-line deprecation/deprecation\n    level,\n  ) {\n    this._level = level;\n    this._notifyScopeListeners();\n    return this;\n  }\n\n  /**\n   * @inheritDoc\n   */\n   setTransactionName(name) {\n    this._transactionName = name;\n    this._notifyScopeListeners();\n    return this;\n  }\n\n  /**\n   * @inheritDoc\n   */\n   setContext(key, context) {\n    if (context === null) {\n      // eslint-disable-next-line @typescript-eslint/no-dynamic-delete\n      delete this._contexts[key];\n    } else {\n      this._contexts = { ...this._contexts, [key]: context };\n    }\n\n    this._notifyScopeListeners();\n    return this;\n  }\n\n  /**\n   * @inheritDoc\n   */\n   setSpan(span) {\n    this._span = span;\n    this._notifyScopeListeners();\n    return this;\n  }\n\n  /**\n   * @inheritDoc\n   */\n   getSpan() {\n    return this._span;\n  }\n\n  /**\n   * @inheritDoc\n   */\n   getTransaction() {\n    // Often, this span (if it exists at all) will be a transaction, but it's not guaranteed to be. Regardless, it will\n    // have a pointer to the currently-active transaction.\n    var span = this.getSpan();\n    return span && span.transaction;\n  }\n\n  /**\n   * @inheritDoc\n   */\n   setSession(session) {\n    if (!session) {\n      delete this._session;\n    } else {\n      this._session = session;\n    }\n    this._notifyScopeListeners();\n    return this;\n  }\n\n  /**\n   * @inheritDoc\n   */\n   getSession() {\n    return this._session;\n  }\n\n  /**\n   * @inheritDoc\n   */\n   update(captureContext) {\n    if (!captureContext) {\n      return this;\n    }\n\n    if (typeof captureContext === 'function') {\n      var updatedScope = (captureContext )(this);\n      return updatedScope instanceof Scope ? updatedScope : this;\n    }\n\n    if (captureContext instanceof Scope) {\n      this._tags = { ...this._tags, ...captureContext._tags };\n      this._extra = { ...this._extra, ...captureContext._extra };\n      this._contexts = { ...this._contexts, ...captureContext._contexts };\n      if (captureContext._user && Object.keys(captureContext._user).length) {\n        this._user = captureContext._user;\n      }\n      if (captureContext._level) {\n        this._level = captureContext._level;\n      }\n      if (captureContext._fingerprint) {\n        this._fingerprint = captureContext._fingerprint;\n      }\n      if (captureContext._requestSession) {\n        this._requestSession = captureContext._requestSession;\n      }\n    } else if (isPlainObject(captureContext)) {\n      // eslint-disable-next-line no-param-reassign\n      captureContext = captureContext ;\n      this._tags = { ...this._tags, ...captureContext.tags };\n      this._extra = { ...this._extra, ...captureContext.extra };\n      this._contexts = { ...this._contexts, ...captureContext.contexts };\n      if (captureContext.user) {\n        this._user = captureContext.user;\n      }\n      if (captureContext.level) {\n        this._level = captureContext.level;\n      }\n      if (captureContext.fingerprint) {\n        this._fingerprint = captureContext.fingerprint;\n      }\n      if (captureContext.requestSession) {\n        this._requestSession = captureContext.requestSession;\n      }\n    }\n\n    return this;\n  }\n\n  /**\n   * @inheritDoc\n   */\n   clear() {\n    this._breadcrumbs = [];\n    this._tags = {};\n    this._extra = {};\n    this._user = {};\n    this._contexts = {};\n    this._level = undefined;\n    this._transactionName = undefined;\n    this._fingerprint = undefined;\n    this._requestSession = undefined;\n    this._span = undefined;\n    this._session = undefined;\n    this._notifyScopeListeners();\n    this._attachments = [];\n    return this;\n  }\n\n  /**\n   * @inheritDoc\n   */\n   addBreadcrumb(breadcrumb, maxBreadcrumbs) {\n    var maxCrumbs = typeof maxBreadcrumbs === 'number' ? Math.min(maxBreadcrumbs, MAX_BREADCRUMBS) : MAX_BREADCRUMBS;\n\n    // No data has been changed, so don't notify scope listeners\n    if (maxCrumbs <= 0) {\n      return this;\n    }\n\n    var mergedBreadcrumb = {\n      timestamp: dateTimestampInSeconds(),\n      ...breadcrumb,\n    };\n    this._breadcrumbs = [...this._breadcrumbs, mergedBreadcrumb].slice(-maxCrumbs);\n    this._notifyScopeListeners();\n\n    return this;\n  }\n\n  /**\n   * @inheritDoc\n   */\n   clearBreadcrumbs() {\n    this._breadcrumbs = [];\n    this._notifyScopeListeners();\n    return this;\n  }\n\n  /**\n   * @inheritDoc\n   */\n   addAttachment(attachment) {\n    this._attachments.push(attachment);\n    return this;\n  }\n\n  /**\n   * @inheritDoc\n   */\n   getAttachments() {\n    return this._attachments;\n  }\n\n  /**\n   * @inheritDoc\n   */\n   clearAttachments() {\n    this._attachments = [];\n    return this;\n  }\n\n  /**\n   * Applies data from the scope to the event and runs all event processors on it.\n   *\n   * @param event Event\n   * @param hint Object containing additional information about the original exception, for use by the event processors.\n   * @hidden\n   */\n   applyToEvent(event, hint = {}) {\n    if (this._extra && Object.keys(this._extra).length) {\n      event.extra = { ...this._extra, ...event.extra };\n    }\n    if (this._tags && Object.keys(this._tags).length) {\n      event.tags = { ...this._tags, ...event.tags };\n    }\n    if (this._user && Object.keys(this._user).length) {\n      event.user = { ...this._user, ...event.user };\n    }\n    if (this._contexts && Object.keys(this._contexts).length) {\n      event.contexts = { ...this._contexts, ...event.contexts };\n    }\n    if (this._level) {\n      event.level = this._level;\n    }\n    if (this._transactionName) {\n      event.transaction = this._transactionName;\n    }\n\n    // We want to set the trace context for normal events only if there isn't already\n    // a trace context on the event. There is a product feature in place where we link\n    // errors with transaction and it relies on that.\n    if (this._span) {\n      event.contexts = { trace: this._span.getTraceContext(), ...event.contexts };\n      var transactionName = this._span.transaction && this._span.transaction.name;\n      if (transactionName) {\n        event.tags = { transaction: transactionName, ...event.tags };\n      }\n    }\n\n    this._applyFingerprint(event);\n\n    event.breadcrumbs = [...(event.breadcrumbs || []), ...this._breadcrumbs];\n    event.breadcrumbs = event.breadcrumbs.length > 0 ? event.breadcrumbs : undefined;\n\n    event.sdkProcessingMetadata = { ...event.sdkProcessingMetadata, ...this._sdkProcessingMetadata };\n\n    return this._notifyEventProcessors([...getGlobalEventProcessors(), ...this._eventProcessors], event, hint);\n  }\n\n  /**\n   * Add data which will be accessible during event processing but won't get sent to Sentry\n   */\n   setSDKProcessingMetadata(newData) {\n    this._sdkProcessingMetadata = { ...this._sdkProcessingMetadata, ...newData };\n\n    return this;\n  }\n\n  /**\n   * This will be called after {@link applyToEvent} is finished.\n   */\n   _notifyEventProcessors(\n    processors,\n    event,\n    hint,\n    index = 0,\n  ) {\n    return new SyncPromise((resolve, reject) => {\n      var processor = processors[index];\n      if (event === null || typeof processor !== 'function') {\n        resolve(event);\n      } else {\n        var result = processor({ ...event }, hint) ;\n\n        (typeof __SENTRY_DEBUG__ === 'undefined' || __SENTRY_DEBUG__) &&\n          processor.id &&\n          result === null &&\n          logger.log(`Event processor \"${processor.id}\" dropped event`);\n\n        if (isThenable(result)) {\n          void result\n            .then(final => this._notifyEventProcessors(processors, final, hint, index + 1).then(resolve))\n            .then(null, reject);\n        } else {\n          void this._notifyEventProcessors(processors, result, hint, index + 1)\n            .then(resolve)\n            .then(null, reject);\n        }\n      }\n    });\n  }\n\n  /**\n   * This will be called on every set call.\n   */\n   _notifyScopeListeners() {\n    // We need this check for this._notifyingListeners to be able to work on scope during updates\n    // If this check is not here we'll produce endless recursion when something is done with the scope\n    // during the callback.\n    if (!this._notifyingListeners) {\n      this._notifyingListeners = true;\n      this._scopeListeners.forEach(callback => {\n        callback(this);\n      });\n      this._notifyingListeners = false;\n    }\n  }\n\n  /**\n   * Applies fingerprint from the scope to the event if there's one,\n   * uses message if there's one instead or get rid of empty fingerprint\n   */\n   _applyFingerprint(event) {\n    // Make sure it's an array first and we actually have something in place\n    event.fingerprint = event.fingerprint ? arrayify(event.fingerprint) : [];\n\n    // If we have something on the scope, then merge it with event\n    if (this._fingerprint) {\n      event.fingerprint = event.fingerprint.concat(this._fingerprint);\n    }\n\n    // If we have no data at all, remove empty array default\n    if (event.fingerprint && !event.fingerprint.length) {\n      delete event.fingerprint;\n    }\n  }\n}\n\n/**\n * Returns the global event processors.\n */\nfunction getGlobalEventProcessors() {\n  return getGlobalSingleton('globalEventProcessors', () => []);\n}\n\n/**\n * Add a EventProcessor to be kept globally.\n * @param callback EventProcessor to add\n */\nfunction addGlobalEventProcessor(callback) {\n  getGlobalEventProcessors().push(callback);\n}\n\nexport { Scope, addGlobalEventProcessor };\n//# sourceMappingURL=scope.js.map\n","import { uuid4, dateTimestampInSeconds, consoleSandbox, logger, getGlobalObject, getGlobalSingleton, isNodeEnv } from '@sentry/utils';\nimport { Scope } from './scope.js';\nimport { closeSession, makeSession, updateSession } from './session.js';\n\n/**\n * API compatibility version of this hub.\n *\n * WARNING: This number should only be increased when the global interface\n * changes and new methods are introduced.\n *\n * @hidden\n */\nvar API_VERSION = 4;\n\n/**\n * Default maximum number of breadcrumbs added to an event. Can be overwritten\n * with {@link Options.maxBreadcrumbs}.\n */\nvar DEFAULT_BREADCRUMBS = 100;\n\n/**\n * A layer in the process stack.\n * @hidden\n */\n\n/**\n * @inheritDoc\n */\nclass Hub  {\n  /** Is a {@link Layer}[] containing the client and scope */\n    __init() {this._stack = [{}];}\n\n  /** Contains the last event id of a captured event.  */\n\n  /**\n   * Creates a new instance of the hub, will push one {@link Layer} into the\n   * internal stack on creation.\n   *\n   * @param client bound to the hub.\n   * @param scope bound to the hub.\n   * @param version number, higher number means higher priority.\n   */\n   constructor(client, scope = new Scope(),   _version = API_VERSION) {;this._version = _version;Hub.prototype.__init.call(this);\n    this.getStackTop().scope = scope;\n    if (client) {\n      this.bindClient(client);\n    }\n  }\n\n  /**\n   * @inheritDoc\n   */\n   isOlderThan(version) {\n    return this._version < version;\n  }\n\n  /**\n   * @inheritDoc\n   */\n   bindClient(client) {\n    var top = this.getStackTop();\n    top.client = client;\n    if (client && client.setupIntegrations) {\n      client.setupIntegrations();\n    }\n  }\n\n  /**\n   * @inheritDoc\n   */\n   pushScope() {\n    // We want to clone the content of prev scope\n    var scope = Scope.clone(this.getScope());\n    this.getStack().push({\n      client: this.getClient(),\n      scope,\n    });\n    return scope;\n  }\n\n  /**\n   * @inheritDoc\n   */\n   popScope() {\n    if (this.getStack().length <= 1) return false;\n    return !!this.getStack().pop();\n  }\n\n  /**\n   * @inheritDoc\n   */\n   withScope(callback) {\n    var scope = this.pushScope();\n    try {\n      callback(scope);\n    } finally {\n      this.popScope();\n    }\n  }\n\n  /**\n   * @inheritDoc\n   */\n   getClient() {\n    return this.getStackTop().client ;\n  }\n\n  /** Returns the scope of the top stack. */\n   getScope() {\n    return this.getStackTop().scope;\n  }\n\n  /** Returns the scope stack for domains or the process. */\n   getStack() {\n    return this._stack;\n  }\n\n  /** Returns the topmost scope layer in the order domain > local > process. */\n   getStackTop() {\n    return this._stack[this._stack.length - 1];\n  }\n\n  /**\n   * @inheritDoc\n   */\n  // eslint-disable-next-line @typescript-eslint/no-explicit-any, @typescript-eslint/explicit-module-boundary-types\n   captureException(exception, hint) {\n    var eventId = (this._lastEventId = hint && hint.event_id ? hint.event_id : uuid4());\n    var syntheticException = new Error('Sentry syntheticException');\n    this._withClient((client, scope) => {\n      client.captureException(\n        exception,\n        {\n          originalException: exception,\n          syntheticException,\n          ...hint,\n          event_id: eventId,\n        },\n        scope,\n      );\n    });\n    return eventId;\n  }\n\n  /**\n   * @inheritDoc\n   */\n   captureMessage(\n    message,\n    // eslint-disable-next-line deprecation/deprecation\n    level,\n    hint,\n  ) {\n    var eventId = (this._lastEventId = hint && hint.event_id ? hint.event_id : uuid4());\n    var syntheticException = new Error(message);\n    this._withClient((client, scope) => {\n      client.captureMessage(\n        message,\n        level,\n        {\n          originalException: message,\n          syntheticException,\n          ...hint,\n          event_id: eventId,\n        },\n        scope,\n      );\n    });\n    return eventId;\n  }\n\n  /**\n   * @inheritDoc\n   */\n   captureEvent(event, hint) {\n    var eventId = hint && hint.event_id ? hint.event_id : uuid4();\n    if (event.type !== 'transaction') {\n      this._lastEventId = eventId;\n    }\n\n    this._withClient((client, scope) => {\n      client.captureEvent(event, { ...hint, event_id: eventId }, scope);\n    });\n    return eventId;\n  }\n\n  /**\n   * @inheritDoc\n   */\n   lastEventId() {\n    return this._lastEventId;\n  }\n\n  /**\n   * @inheritDoc\n   */\n   addBreadcrumb(breadcrumb, hint) {\n    const { scope, client } = this.getStackTop();\n\n    if (!scope || !client) return;\n\n    // eslint-disable-next-line @typescript-eslint/unbound-method\n    const { beforeBreadcrumb = null, maxBreadcrumbs = DEFAULT_BREADCRUMBS } =\n      (client.getOptions && client.getOptions()) || {};\n\n    if (maxBreadcrumbs <= 0) return;\n\n    var timestamp = dateTimestampInSeconds();\n    var mergedBreadcrumb = { timestamp, ...breadcrumb };\n    var finalBreadcrumb = beforeBreadcrumb\n      ? (consoleSandbox(() => beforeBreadcrumb(mergedBreadcrumb, hint)) )\n      : mergedBreadcrumb;\n\n    if (finalBreadcrumb === null) return;\n\n    scope.addBreadcrumb(finalBreadcrumb, maxBreadcrumbs);\n  }\n\n  /**\n   * @inheritDoc\n   */\n   setUser(user) {\n    var scope = this.getScope();\n    if (scope) scope.setUser(user);\n  }\n\n  /**\n   * @inheritDoc\n   */\n   setTags(tags) {\n    var scope = this.getScope();\n    if (scope) scope.setTags(tags);\n  }\n\n  /**\n   * @inheritDoc\n   */\n   setExtras(extras) {\n    var scope = this.getScope();\n    if (scope) scope.setExtras(extras);\n  }\n\n  /**\n   * @inheritDoc\n   */\n   setTag(key, value) {\n    var scope = this.getScope();\n    if (scope) scope.setTag(key, value);\n  }\n\n  /**\n   * @inheritDoc\n   */\n   setExtra(key, extra) {\n    var scope = this.getScope();\n    if (scope) scope.setExtra(key, extra);\n  }\n\n  /**\n   * @inheritDoc\n   */\n  // eslint-disable-next-line @typescript-eslint/no-explicit-any\n   setContext(name, context) {\n    var scope = this.getScope();\n    if (scope) scope.setContext(name, context);\n  }\n\n  /**\n   * @inheritDoc\n   */\n   configureScope(callback) {\n    const { scope, client } = this.getStackTop();\n    if (scope && client) {\n      callback(scope);\n    }\n  }\n\n  /**\n   * @inheritDoc\n   */\n   run(callback) {\n    var oldHub = makeMain(this);\n    try {\n      callback(this);\n    } finally {\n      makeMain(oldHub);\n    }\n  }\n\n  /**\n   * @inheritDoc\n   */\n   getIntegration(integration) {\n    var client = this.getClient();\n    if (!client) return null;\n    try {\n      return client.getIntegration(integration);\n    } catch (_oO) {\n      (typeof __SENTRY_DEBUG__ === 'undefined' || __SENTRY_DEBUG__) && logger.warn(`Cannot retrieve integration ${integration.id} from the current Hub`);\n      return null;\n    }\n  }\n\n  /**\n   * @inheritDoc\n   */\n   startTransaction(context, customSamplingContext) {\n    return this._callExtensionMethod('startTransaction', context, customSamplingContext);\n  }\n\n  /**\n   * @inheritDoc\n   */\n   traceHeaders() {\n    return this._callExtensionMethod('traceHeaders');\n  }\n\n  /**\n   * @inheritDoc\n   */\n   captureSession(endSession = false) {\n    // both send the update and pull the session from the scope\n    if (endSession) {\n      return this.endSession();\n    }\n\n    // only send the update\n    this._sendSessionUpdate();\n  }\n\n  /**\n   * @inheritDoc\n   */\n   endSession() {\n    var layer = this.getStackTop();\n    var scope = layer && layer.scope;\n    var session = scope && scope.getSession();\n    if (session) {\n      closeSession(session);\n    }\n    this._sendSessionUpdate();\n\n    // the session is over; take it off of the scope\n    if (scope) {\n      scope.setSession();\n    }\n  }\n\n  /**\n   * @inheritDoc\n   */\n   startSession(context) {\n    const { scope, client } = this.getStackTop();\n    const { release, environment } = (client && client.getOptions()) || {};\n\n    // Will fetch userAgent if called from browser sdk\n    var global = getGlobalObject();\n    const { userAgent } = global.navigator || {};\n\n    var session = makeSession({\n      release,\n      environment,\n      ...(scope && { user: scope.getUser() }),\n      ...(userAgent && { userAgent }),\n      ...context,\n    });\n\n    if (scope) {\n      // End existing session if there's one\n      var currentSession = scope.getSession && scope.getSession();\n      if (currentSession && currentSession.status === 'ok') {\n        updateSession(currentSession, { status: 'exited' });\n      }\n      this.endSession();\n\n      // Afterwards we set the new session on the scope\n      scope.setSession(session);\n    }\n\n    return session;\n  }\n\n  /**\n   * Returns if default PII should be sent to Sentry and propagated in ourgoing requests\n   * when Tracing is used.\n   */\n   shouldSendDefaultPii() {\n    var client = this.getClient();\n    var options = client && client.getOptions();\n    return Boolean(options && options.sendDefaultPii);\n  }\n\n  /**\n   * Sends the current Session on the scope\n   */\n   _sendSessionUpdate() {\n    const { scope, client } = this.getStackTop();\n    if (!scope) return;\n\n    var session = scope.getSession();\n    if (session) {\n      if (client && client.captureSession) {\n        client.captureSession(session);\n      }\n    }\n  }\n\n  /**\n   * Internal helper function to call a method on the top client if it exists.\n   *\n   * @param method The method to call on the client.\n   * @param args Arguments to pass to the client function.\n   */\n   _withClient(callback) {\n    const { scope, client } = this.getStackTop();\n    if (client) {\n      callback(client, scope);\n    }\n  }\n\n  /**\n   * Calls global extension method and binding current instance to the function call\n   */\n  // @ts-ignore Function lacks ending return statement and return type does not include 'undefined'. ts(2366)\n  // eslint-disable-next-line @typescript-eslint/no-explicit-any\n   _callExtensionMethod(method, ...args) {\n    var carrier = getMainCarrier();\n    var sentry = carrier.__SENTRY__;\n    if (sentry && sentry.extensions && typeof sentry.extensions[method] === 'function') {\n      return sentry.extensions[method].apply(this, args);\n    }\n    (typeof __SENTRY_DEBUG__ === 'undefined' || __SENTRY_DEBUG__) && logger.warn(`Extension method ${method} couldn't be found, doing nothing.`);\n  }\n}\n\n/**\n * Returns the global shim registry.\n *\n * FIXME: This function is problematic, because despite always returning a valid Carrier,\n * it has an optional `__SENTRY__` property, which then in turn requires us to always perform an unnecessary check\n * at the call-site. We always access the carrier through this function, so we can guarantee that `__SENTRY__` is there.\n **/\nfunction getMainCarrier() {\n  var carrier = getGlobalObject();\n  carrier.__SENTRY__ = carrier.__SENTRY__ || {\n    extensions: {},\n    hub: undefined,\n  };\n  return carrier;\n}\n\n/**\n * Replaces the current main hub with the passed one on the global object\n *\n * @returns The old replaced hub\n */\nfunction makeMain(hub) {\n  var registry = getMainCarrier();\n  var oldHub = getHubFromCarrier(registry);\n  setHubOnCarrier(registry, hub);\n  return oldHub;\n}\n\n/**\n * Returns the default hub instance.\n *\n * If a hub is already registered in the global carrier but this module\n * contains a more recent version, it replaces the registered version.\n * Otherwise, the currently registered hub will be returned.\n */\nfunction getCurrentHub() {\n  // Get main carrier (global for every environment)\n  var registry = getMainCarrier();\n\n  // If there's no hub, or its an old API, assign a new one\n  if (!hasHubOnCarrier(registry) || getHubFromCarrier(registry).isOlderThan(API_VERSION)) {\n    setHubOnCarrier(registry, new Hub());\n  }\n\n  // Prefer domains over global if they are there (applicable only to Node environment)\n  if (isNodeEnv()) {\n    return getHubFromActiveDomain(registry);\n  }\n  // Return hub that lives on a global object\n  return getHubFromCarrier(registry);\n}\n\n/**\n * Try to read the hub from an active domain, and fallback to the registry if one doesn't exist\n * @returns discovered hub\n */\nfunction getHubFromActiveDomain(registry) {\n  try {\n    var sentry = getMainCarrier().__SENTRY__;\n    var activeDomain = sentry && sentry.extensions && sentry.extensions.domain && sentry.extensions.domain.active;\n\n    // If there's no active domain, just return global hub\n    if (!activeDomain) {\n      return getHubFromCarrier(registry);\n    }\n\n    // If there's no hub on current domain, or it's an old API, assign a new one\n    if (!hasHubOnCarrier(activeDomain) || getHubFromCarrier(activeDomain).isOlderThan(API_VERSION)) {\n      var registryHubTopStack = getHubFromCarrier(registry).getStackTop();\n      setHubOnCarrier(activeDomain, new Hub(registryHubTopStack.client, Scope.clone(registryHubTopStack.scope)));\n    }\n\n    // Return hub that lives on a domain\n    return getHubFromCarrier(activeDomain);\n  } catch (_Oo) {\n    // Return hub that lives on a global object\n    return getHubFromCarrier(registry);\n  }\n}\n\n/**\n * This will tell whether a carrier has a hub on it or not\n * @param carrier object\n */\nfunction hasHubOnCarrier(carrier) {\n  return !!(carrier && carrier.__SENTRY__ && carrier.__SENTRY__.hub);\n}\n\n/**\n * This will create a new {@link Hub} and add to the passed object on\n * __SENTRY__.hub.\n * @param carrier object\n * @hidden\n */\nfunction getHubFromCarrier(carrier) {\n  return getGlobalSingleton('hub', () => new Hub(), carrier);\n}\n\n/**\n * This will set passed {@link Hub} on the passed object's __SENTRY__.hub attribute\n * @param carrier object\n * @param hub Hub\n * @returns A boolean indicating success or failure\n */\nfunction setHubOnCarrier(carrier, hub) {\n  if (!carrier) return false;\n  var __SENTRY__ = (carrier.__SENTRY__ = carrier.__SENTRY__ || {});\n  __SENTRY__.hub = hub;\n  return true;\n}\n\nexport { API_VERSION, Hub, getCurrentHub, getHubFromCarrier, getMainCarrier, makeMain, setHubOnCarrier };\n//# sourceMappingURL=hub.js.map\n","import { getCurrentHub } from './hub.js';\n\n// Note: All functions in this file are typed with a return value of `ReturnType<Hub[HUB_FUNCTION]>`,\n// where HUB_FUNCTION is some method on the Hub class.\n//\n// This is done to make sure the top level SDK methods stay in sync with the hub methods.\n// Although every method here has an explicit return type, some of them (that map to void returns) do not\n// contain `return` keywords. This is done to save on bundle size, as `return` is not minifiable.\n\n/**\n * Captures an exception event and sends it to Sentry.\n *\n * @param exception An exception-like object.\n * @param captureContext Additional scope data to apply to exception event.\n * @returns The generated eventId.\n */\n// eslint-disable-next-line @typescript-eslint/no-explicit-any, @typescript-eslint/explicit-module-boundary-types\nfunction captureException(exception, captureContext) {\n  return getCurrentHub().captureException(exception, { captureContext });\n}\n\n/**\n * Captures a message event and sends it to Sentry.\n *\n * @param message The message to send to Sentry.\n * @param Severity Define the level of the message.\n * @returns The generated eventId.\n */\nfunction captureMessage(\n  message,\n  // eslint-disable-next-line deprecation/deprecation\n  captureContext,\n) {\n  // This is necessary to provide explicit scopes upgrade, without changing the original\n  // arity of the `captureMessage(message, level)` method.\n  var level = typeof captureContext === 'string' ? captureContext : undefined;\n  var context = typeof captureContext !== 'string' ? { captureContext } : undefined;\n  return getCurrentHub().captureMessage(message, level, context);\n}\n\n/**\n * Captures a manually created event and sends it to Sentry.\n *\n * @param event The event to send to Sentry.\n * @returns The generated eventId.\n */\nfunction captureEvent(event, hint) {\n  return getCurrentHub().captureEvent(event, hint);\n}\n\n/**\n * Callback to set context information onto the scope.\n * @param callback Callback function that receives Scope.\n */\nfunction configureScope(callback) {\n  getCurrentHub().configureScope(callback);\n}\n\n/**\n * Records a new breadcrumb which will be attached to future events.\n *\n * Breadcrumbs will be added to subsequent events to provide more context on\n * user's actions prior to an error or crash.\n *\n * @param breadcrumb The breadcrumb to record.\n */\nfunction addBreadcrumb(breadcrumb) {\n  getCurrentHub().addBreadcrumb(breadcrumb);\n}\n\n/**\n * Sets context data with the given name.\n * @param name of the context\n * @param context Any kind of data. This data will be normalized.\n */\n// eslint-disable-next-line @typescript-eslint/no-explicit-any\nfunction setContext(name, context) {\n  getCurrentHub().setContext(name, context);\n}\n\n/**\n * Set an object that will be merged sent as extra data with the event.\n * @param extras Extras object to merge into current context.\n */\nfunction setExtras(extras) {\n  getCurrentHub().setExtras(extras);\n}\n\n/**\n * Set key:value that will be sent as extra data with the event.\n * @param key String of extra\n * @param extra Any kind of data. This data will be normalized.\n */\nfunction setExtra(key, extra) {\n  getCurrentHub().setExtra(key, extra);\n}\n\n/**\n * Set an object that will be merged sent as tags data with the event.\n * @param tags Tags context object to merge into current context.\n */\nfunction setTags(tags) {\n  getCurrentHub().setTags(tags);\n}\n\n/**\n * Set key:value that will be sent as tags data with the event.\n *\n * Can also be used to unset a tag, by passing `undefined`.\n *\n * @param key String key of tag\n * @param value Value of tag\n */\nfunction setTag(key, value) {\n  getCurrentHub().setTag(key, value);\n}\n\n/**\n * Updates user context information for future events.\n *\n * @param user User context object to be set in the current context. Pass `null` to unset the user.\n */\nfunction setUser(user) {\n  getCurrentHub().setUser(user);\n}\n\n/**\n * Creates a new scope with and executes the given operation within.\n * The scope is automatically removed once the operation\n * finishes or throws.\n *\n * This is essentially a convenience function for:\n *\n *     pushScope();\n *     callback();\n *     popScope();\n *\n * @param callback that will be enclosed into push/popScope.\n */\nfunction withScope(callback) {\n  getCurrentHub().withScope(callback);\n}\n\n/**\n * Starts a new `Transaction` and returns it. This is the entry point to manual tracing instrumentation.\n *\n * A tree structure can be built by adding child spans to the transaction, and child spans to other spans. To start a\n * new child span within the transaction or any span, call the respective `.startChild()` method.\n *\n * Every child span must be finished before the transaction is finished, otherwise the unfinished spans are discarded.\n *\n * The transaction must be finished with a call to its `.finish()` method, at which point the transaction with all its\n * finished child spans will be sent to Sentry.\n *\n * NOTE: This function should only be used for *manual* instrumentation. Auto-instrumentation should call\n * `startTransaction` directly on the hub.\n *\n * @param context Properties of the new `Transaction`.\n * @param customSamplingContext Information given to the transaction sampling function (along with context-dependent\n * default values). See {@link Options.tracesSampler}.\n *\n * @returns The transaction which was just started\n */\nfunction startTransaction(\n  context,\n  customSamplingContext,\n) {\n  return getCurrentHub().startTransaction({ ...context }, customSamplingContext);\n}\n\nexport { addBreadcrumb, captureEvent, captureException, captureMessage, configureScope, setContext, setExtra, setExtras, setTag, setTags, setUser, startTransaction, withScope };\n//# sourceMappingURL=exports.js.map\n","import { urlEncode, makeDsn, dsnToString } from '@sentry/utils';\n\nvar SENTRY_API_VERSION = '7';\n\n/** Returns the prefix to construct Sentry ingestion API endpoints. */\nfunction getBaseApiEndpoint(dsn) {\n  var protocol = dsn.protocol ? `${dsn.protocol}:` : '';\n  var port = dsn.port ? `:${dsn.port}` : '';\n  return `${protocol}//${dsn.host}${port}${dsn.path ? `/${dsn.path}` : ''}/api/`;\n}\n\n/** Returns the ingest API endpoint for target. */\nfunction _getIngestEndpoint(dsn) {\n  return `${getBaseApiEndpoint(dsn)}${dsn.projectId}/envelope/`;\n}\n\n/** Returns a URL-encoded string with auth config suitable for a query string. */\nfunction _encodedAuth(dsn, sdkInfo) {\n  return urlEncode({\n    // We send only the minimum set of required information. See\n    // https://github.com/getsentry/sentry-javascript/issues/2572.\n    sentry_key: dsn.publicKey,\n    sentry_version: SENTRY_API_VERSION,\n    ...(sdkInfo && { sentry_client: `${sdkInfo.name}/${sdkInfo.version}` }),\n  });\n}\n\n/**\n * Returns the envelope endpoint URL with auth in the query string.\n *\n * Sending auth as part of the query string and not as custom HTTP headers avoids CORS preflight requests.\n */\nfunction getEnvelopeEndpointWithUrlEncodedAuth(\n  dsn,\n  // TODO (v8): Remove `tunnelOrOptions` in favor of `options`, and use the substitute code below\n  // options: ClientOptions = {} as ClientOptions,\n  tunnelOrOptions = {} ,\n) {\n  // TODO (v8): Use this code instead\n  // const { tunnel, _metadata = {} } = options;\n  // return tunnel ? tunnel : `${_getIngestEndpoint(dsn)}?${_encodedAuth(dsn, _metadata.sdk)}`;\n\n  var tunnel = typeof tunnelOrOptions === 'string' ? tunnelOrOptions : tunnelOrOptions.tunnel;\n  var sdkInfo =\n    typeof tunnelOrOptions === 'string' || !tunnelOrOptions._metadata ? undefined : tunnelOrOptions._metadata.sdk;\n\n  return tunnel ? tunnel : `${_getIngestEndpoint(dsn)}?${_encodedAuth(dsn, sdkInfo)}`;\n}\n\n/** Returns the url to the report dialog endpoint. */\nfunction getReportDialogEndpoint(\n  dsnLike,\n  dialogOptions\n\n,\n) {\n  var dsn = makeDsn(dsnLike);\n  var endpoint = `${getBaseApiEndpoint(dsn)}embed/error-page/`;\n\n  let encodedOptions = `dsn=${dsnToString(dsn)}`;\n  for (var key in dialogOptions) {\n    if (key === 'dsn') {\n      continue;\n    }\n\n    if (key === 'user') {\n      var user = dialogOptions.user;\n      if (!user) {\n        continue;\n      }\n      if (user.name) {\n        encodedOptions += `&name=${encodeURIComponent(user.name)}`;\n      }\n      if (user.email) {\n        encodedOptions += `&email=${encodeURIComponent(user.email)}`;\n      }\n    } else {\n      encodedOptions += `&${encodeURIComponent(key)}=${encodeURIComponent(dialogOptions[key] )}`;\n    }\n  }\n\n  return `${endpoint}?${encodedOptions}`;\n}\n\nexport { getEnvelopeEndpointWithUrlEncodedAuth, getReportDialogEndpoint };\n//# sourceMappingURL=api.js.map\n","import { dsnToString, createEnvelope, dropUndefinedKeys } from '@sentry/utils';\n\n/** Extract sdk info from from the API metadata */\nfunction getSdkMetadataForEnvelopeHeader(metadata) {\n  if (!metadata || !metadata.sdk) {\n    return;\n  }\n  const { name, version } = metadata.sdk;\n  return { name, version };\n}\n\n/**\n * Apply SdkInfo (name, version, packages, integrations) to the corresponding event key.\n * Merge with existing data if any.\n **/\nfunction enhanceEventWithSdkInfo(event, sdkInfo) {\n  if (!sdkInfo) {\n    return event;\n  }\n  event.sdk = event.sdk || {};\n  event.sdk.name = event.sdk.name || sdkInfo.name;\n  event.sdk.version = event.sdk.version || sdkInfo.version;\n  event.sdk.integrations = [...(event.sdk.integrations || []), ...(sdkInfo.integrations || [])];\n  event.sdk.packages = [...(event.sdk.packages || []), ...(sdkInfo.packages || [])];\n  return event;\n}\n\n/** Creates an envelope from a Session */\nfunction createSessionEnvelope(\n  session,\n  dsn,\n  metadata,\n  tunnel,\n) {\n  var sdkInfo = getSdkMetadataForEnvelopeHeader(metadata);\n  var envelopeHeaders = {\n    sent_at: new Date().toISOString(),\n    ...(sdkInfo && { sdk: sdkInfo }),\n    ...(!!tunnel && { dsn: dsnToString(dsn) }),\n  };\n\n  var envelopeItem =\n    'aggregates' in session ? [{ type: 'sessions' }, session] : [{ type: 'session' }, session];\n\n  return createEnvelope(envelopeHeaders, [envelopeItem]);\n}\n\n/**\n * Create an Envelope from an event.\n */\nfunction createEventEnvelope(\n  event,\n  dsn,\n  metadata,\n  tunnel,\n) {\n  var sdkInfo = getSdkMetadataForEnvelopeHeader(metadata);\n  var eventType = event.type || 'event';\n\n  enhanceEventWithSdkInfo(event, metadata && metadata.sdk);\n\n  var envelopeHeaders = createEventEnvelopeHeaders(event, sdkInfo, tunnel, dsn);\n\n  // Prevent this data (which, if it exists, was used in earlier steps in the processing pipeline) from being sent to\n  // sentry. (Note: Our use of this property comes and goes with whatever we might be debugging, whatever hacks we may\n  // have temporarily added, etc. Even if we don't happen to be using it at some point in the future, let's not get rid\n  // of this `delete`, lest we miss putting it back in the next time the property is in use.)\n  delete event.sdkProcessingMetadata;\n\n  var eventItem = [{ type: eventType }, event];\n  return createEnvelope(envelopeHeaders, [eventItem]);\n}\n\nfunction createEventEnvelopeHeaders(\n  event,\n  sdkInfo,\n  tunnel,\n  dsn,\n) {\n  var dynamicSamplingContext = event.sdkProcessingMetadata && event.sdkProcessingMetadata.dynamicSamplingContext;\n\n  return {\n    event_id: event.event_id ,\n    sent_at: new Date().toISOString(),\n    ...(sdkInfo && { sdk: sdkInfo }),\n    ...(!!tunnel && { dsn: dsnToString(dsn) }),\n    ...(event.type === 'transaction' &&\n      dynamicSamplingContext && {\n        trace: dropUndefinedKeys({ ...dynamicSamplingContext }),\n      }),\n  };\n}\n\nexport { createEventEnvelope, createSessionEnvelope };\n//# sourceMappingURL=envelope.js.map\n","import { addGlobalEventProcessor, getCurrentHub } from '@sentry/hub';\nimport { arrayify, logger } from '@sentry/utils';\n\nvar installedIntegrations = [];\n\n/** Map of integrations assigned to a client */\n\n/**\n * Remove duplicates from the given array, preferring the last instance of any duplicate. Not guaranteed to\n * preseve the order of integrations in the array.\n *\n * @private\n */\nfunction filterDuplicates(integrations) {\n  var integrationsByName = {};\n\n  integrations.forEach(currentInstance => {\n    const { name } = currentInstance;\n\n    var existingInstance = integrationsByName[name];\n\n    // We want integrations later in the array to overwrite earlier ones of the same type, except that we never want a\n    // default instance to overwrite an existing user instance\n    if (existingInstance && !existingInstance.isDefaultInstance && currentInstance.isDefaultInstance) {\n      return;\n    }\n\n    integrationsByName[name] = currentInstance;\n  });\n\n  return Object.values(integrationsByName);\n}\n\n/** Gets integrations to install */\nfunction getIntegrationsToSetup(options) {\n  var defaultIntegrations = options.defaultIntegrations || [];\n  var userIntegrations = options.integrations;\n\n  // We flag default instances, so that later we can tell them apart from any user-created instances of the same class\n  defaultIntegrations.forEach(integration => {\n    integration.isDefaultInstance = true;\n  });\n\n  let integrations;\n\n  if (Array.isArray(userIntegrations)) {\n    integrations = [...defaultIntegrations, ...userIntegrations];\n  } else if (typeof userIntegrations === 'function') {\n    integrations = arrayify(userIntegrations(defaultIntegrations));\n  } else {\n    integrations = defaultIntegrations;\n  }\n\n  var finalIntegrations = filterDuplicates(integrations);\n\n  // The `Debug` integration prints copies of the `event` and `hint` which will be passed to `beforeSend`. It therefore\n  // has to run after all other integrations, so that the changes of all event processors will be reflected in the\n  // printed values. For lack of a more elegant way to guarantee that, we therefore locate it and, assuming it exists,\n  // pop it out of its current spot and shove it onto the end of the array.\n  var debugIndex = finalIntegrations.findIndex(integration => integration.name === 'Debug');\n  if (debugIndex !== -1) {\n    const [debugInstance] = finalIntegrations.splice(debugIndex, 1);\n    finalIntegrations.push(debugInstance);\n  }\n\n  return finalIntegrations;\n}\n\n/**\n * Given a list of integration instances this installs them all. When `withDefaults` is set to `true` then all default\n * integrations are added unless they were already provided before.\n * @param integrations array of integration instances\n * @param withDefault should enable default integrations\n */\nfunction setupIntegrations(integrations) {\n  var integrationIndex = {};\n\n  integrations.forEach(integration => {\n    integrationIndex[integration.name] = integration;\n\n    if (installedIntegrations.indexOf(integration.name) === -1) {\n      integration.setupOnce(addGlobalEventProcessor, getCurrentHub);\n      installedIntegrations.push(integration.name);\n      (typeof __SENTRY_DEBUG__ === 'undefined' || __SENTRY_DEBUG__) && logger.log(`Integration installed: ${integration.name}`);\n    }\n  });\n\n  return integrationIndex;\n}\n\nexport { getIntegrationsToSetup, installedIntegrations, setupIntegrations };\n//# sourceMappingURL=integration.js.map\n","import { updateSession, Scope } from '@sentry/hub';\nimport { makeDsn, logger, checkOrSetAlreadyCaught, isPrimitive, resolvedSyncPromise, addItemToEnvelope, createAttachmentEnvelopeItem, SyncPromise, uuid4, dateTimestampInSeconds, normalize, truncate, rejectedSyncPromise, SentryError, isThenable, isPlainObject } from '@sentry/utils';\nimport { getEnvelopeEndpointWithUrlEncodedAuth } from './api.js';\nimport { createEventEnvelope, createSessionEnvelope } from './envelope.js';\nimport { setupIntegrations } from './integration.js';\n\n/* eslint-disable max-lines */\n\nvar ALREADY_SEEN_ERROR = \"Not capturing exception because it's already been captured.\";\n\n/**\n * Base implementation for all JavaScript SDK clients.\n *\n * Call the constructor with the corresponding options\n * specific to the client subclass. To access these options later, use\n * {@link Client.getOptions}.\n *\n * If a Dsn is specified in the options, it will be parsed and stored. Use\n * {@link Client.getDsn} to retrieve the Dsn at any moment. In case the Dsn is\n * invalid, the constructor will throw a {@link SentryException}. Note that\n * without a valid Dsn, the SDK will not send any events to Sentry.\n *\n * Before sending an event, it is passed through\n * {@link BaseClient._prepareEvent} to add SDK information and scope data\n * (breadcrumbs and context). To add more custom information, override this\n * method and extend the resulting prepared event.\n *\n * To issue automatically created events (e.g. via instrumentation), use\n * {@link Client.captureEvent}. It will prepare the event and pass it through\n * the callback lifecycle. To issue auto-breadcrumbs, use\n * {@link Client.addBreadcrumb}.\n *\n * @example\n * class NodeClient extends BaseClient<NodeOptions> {\n *   public constructor(options: NodeOptions) {\n *     super(options);\n *   }\n *\n *   // ...\n * }\n */\nclass BaseClient {\n  /** Options passed to the SDK. */\n\n  /** The client Dsn, if specified in options. Without this Dsn, the SDK will be disabled. */\n\n  /** Array of set up integrations. */\n   __init() {this._integrations = {};}\n\n  /** Indicates whether this client's integrations have been set up. */\n   __init2() {this._integrationsInitialized = false;}\n\n  /** Number of calls being processed */\n   __init3() {this._numProcessing = 0;}\n\n  /** Holds flushable  */\n   __init4() {this._outcomes = {};}\n\n  /**\n   * Initializes this client instance.\n   *\n   * @param options Options for the client.\n   */\n   constructor(options) {;BaseClient.prototype.__init.call(this);BaseClient.prototype.__init2.call(this);BaseClient.prototype.__init3.call(this);BaseClient.prototype.__init4.call(this);\n    this._options = options;\n    if (options.dsn) {\n      this._dsn = makeDsn(options.dsn);\n      var url = getEnvelopeEndpointWithUrlEncodedAuth(this._dsn, options);\n      this._transport = options.transport({\n        recordDroppedEvent: this.recordDroppedEvent.bind(this),\n        ...options.transportOptions,\n        url,\n      });\n    } else {\n      (typeof __SENTRY_DEBUG__ === 'undefined' || __SENTRY_DEBUG__) && logger.warn('No DSN provided, client will not do anything.');\n    }\n  }\n\n  /**\n   * @inheritDoc\n   */\n  // eslint-disable-next-line @typescript-eslint/no-explicit-any, @typescript-eslint/explicit-module-boundary-types\n   captureException(exception, hint, scope) {\n    // ensure we haven't captured this very object before\n    if (checkOrSetAlreadyCaught(exception)) {\n      (typeof __SENTRY_DEBUG__ === 'undefined' || __SENTRY_DEBUG__) && logger.log(ALREADY_SEEN_ERROR);\n      return;\n    }\n\n    let eventId = hint && hint.event_id;\n\n    this._process(\n      this.eventFromException(exception, hint)\n        .then(event => this._captureEvent(event, hint, scope))\n        .then(result => {\n          eventId = result;\n        }),\n    );\n\n    return eventId;\n  }\n\n  /**\n   * @inheritDoc\n   */\n   captureMessage(\n    message,\n    // eslint-disable-next-line deprecation/deprecation\n    level,\n    hint,\n    scope,\n  ) {\n    let eventId = hint && hint.event_id;\n\n    var promisedEvent = isPrimitive(message)\n      ? this.eventFromMessage(String(message), level, hint)\n      : this.eventFromException(message, hint);\n\n    this._process(\n      promisedEvent\n        .then(event => this._captureEvent(event, hint, scope))\n        .then(result => {\n          eventId = result;\n        }),\n    );\n\n    return eventId;\n  }\n\n  /**\n   * @inheritDoc\n   */\n   captureEvent(event, hint, scope) {\n    // ensure we haven't captured this very object before\n    if (hint && hint.originalException && checkOrSetAlreadyCaught(hint.originalException)) {\n      (typeof __SENTRY_DEBUG__ === 'undefined' || __SENTRY_DEBUG__) && logger.log(ALREADY_SEEN_ERROR);\n      return;\n    }\n\n    let eventId = hint && hint.event_id;\n\n    this._process(\n      this._captureEvent(event, hint, scope).then(result => {\n        eventId = result;\n      }),\n    );\n\n    return eventId;\n  }\n\n  /**\n   * @inheritDoc\n   */\n   captureSession(session) {\n    if (!this._isEnabled()) {\n      (typeof __SENTRY_DEBUG__ === 'undefined' || __SENTRY_DEBUG__) && logger.warn('SDK not enabled, will not capture session.');\n      return;\n    }\n\n    if (!(typeof session.release === 'string')) {\n      (typeof __SENTRY_DEBUG__ === 'undefined' || __SENTRY_DEBUG__) && logger.warn('Discarded session because of missing or non-string release');\n    } else {\n      this.sendSession(session);\n      // After sending, we set init false to indicate it's not the first occurrence\n      updateSession(session, { init: false });\n    }\n  }\n\n  /**\n   * @inheritDoc\n   */\n   getDsn() {\n    return this._dsn;\n  }\n\n  /**\n   * @inheritDoc\n   */\n   getOptions() {\n    return this._options;\n  }\n\n  /**\n   * @inheritDoc\n   */\n   getTransport() {\n    return this._transport;\n  }\n\n  /**\n   * @inheritDoc\n   */\n   flush(timeout) {\n    var transport = this._transport;\n    if (transport) {\n      return this._isClientDoneProcessing(timeout).then(clientFinished => {\n        return transport.flush(timeout).then(transportFlushed => clientFinished && transportFlushed);\n      });\n    } else {\n      return resolvedSyncPromise(true);\n    }\n  }\n\n  /**\n   * @inheritDoc\n   */\n   close(timeout) {\n    return this.flush(timeout).then(result => {\n      this.getOptions().enabled = false;\n      return result;\n    });\n  }\n\n  /**\n   * Sets up the integrations\n   */\n   setupIntegrations() {\n    if (this._isEnabled() && !this._integrationsInitialized) {\n      this._integrations = setupIntegrations(this._options.integrations);\n      this._integrationsInitialized = true;\n    }\n  }\n\n  /**\n   * Gets an installed integration by its `id`.\n   *\n   * @returns The installed integration or `undefined` if no integration with that `id` was installed.\n   */\n   getIntegrationById(integrationId) {\n    return this._integrations[integrationId];\n  }\n\n  /**\n   * @inheritDoc\n   */\n   getIntegration(integration) {\n    try {\n      return (this._integrations[integration.id] ) || null;\n    } catch (_oO) {\n      (typeof __SENTRY_DEBUG__ === 'undefined' || __SENTRY_DEBUG__) && logger.warn(`Cannot retrieve integration ${integration.id} from the current Client`);\n      return null;\n    }\n  }\n\n  /**\n   * @inheritDoc\n   */\n   sendEvent(event, hint = {}) {\n    if (this._dsn) {\n      let env = createEventEnvelope(event, this._dsn, this._options._metadata, this._options.tunnel);\n\n      for (var attachment of hint.attachments || []) {\n        env = addItemToEnvelope(\n          env,\n          createAttachmentEnvelopeItem(\n            attachment,\n            this._options.transportOptions && this._options.transportOptions.textEncoder,\n          ),\n        );\n      }\n\n      this._sendEnvelope(env);\n    }\n  }\n\n  /**\n   * @inheritDoc\n   */\n   sendSession(session) {\n    if (this._dsn) {\n      var env = createSessionEnvelope(session, this._dsn, this._options._metadata, this._options.tunnel);\n      this._sendEnvelope(env);\n    }\n  }\n\n  /**\n   * @inheritDoc\n   */\n   recordDroppedEvent(reason, category) {\n    if (this._options.sendClientReports) {\n      // We want to track each category (error, transaction, session) separately\n      // but still keep the distinction between different type of outcomes.\n      // We could use nested maps, but it's much easier to read and type this way.\n      // A correct type for map-based implementation if we want to go that route\n      // would be `Partial<Record<SentryRequestType, Partial<Record<Outcome, number>>>>`\n      // With typescript 4.1 we could even use template literal types\n      var key = `${reason}:${category}`;\n      (typeof __SENTRY_DEBUG__ === 'undefined' || __SENTRY_DEBUG__) && logger.log(`Adding outcome: \"${key}\"`);\n\n      // The following works because undefined + 1 === NaN and NaN is falsy\n      this._outcomes[key] = this._outcomes[key] + 1 || 1;\n    }\n  }\n\n  /** Updates existing session based on the provided event */\n   _updateSessionFromEvent(session, event) {\n    let crashed = false;\n    let errored = false;\n    var exceptions = event.exception && event.exception.values;\n\n    if (exceptions) {\n      errored = true;\n\n      for (var ex of exceptions) {\n        var mechanism = ex.mechanism;\n        if (mechanism && mechanism.handled === false) {\n          crashed = true;\n          break;\n        }\n      }\n    }\n\n    // A session is updated and that session update is sent in only one of the two following scenarios:\n    // 1. Session with non terminal status and 0 errors + an error occurred -> Will set error count to 1 and send update\n    // 2. Session with non terminal status and 1 error + a crash occurred -> Will set status crashed and send update\n    var sessionNonTerminal = session.status === 'ok';\n    var shouldUpdateAndSend = (sessionNonTerminal && session.errors === 0) || (sessionNonTerminal && crashed);\n\n    if (shouldUpdateAndSend) {\n      updateSession(session, {\n        ...(crashed && { status: 'crashed' }),\n        errors: session.errors || Number(errored || crashed),\n      });\n      this.captureSession(session);\n    }\n  }\n\n  /**\n   * Determine if the client is finished processing. Returns a promise because it will wait `timeout` ms before saying\n   * \"no\" (resolving to `false`) in order to give the client a chance to potentially finish first.\n   *\n   * @param timeout The time, in ms, after which to resolve to `false` if the client is still busy. Passing `0` (or not\n   * passing anything) will make the promise wait as long as it takes for processing to finish before resolving to\n   * `true`.\n   * @returns A promise which will resolve to `true` if processing is already done or finishes before the timeout, and\n   * `false` otherwise\n   */\n   _isClientDoneProcessing(timeout) {\n    return new SyncPromise(resolve => {\n      let ticked = 0;\n      var tick = 1;\n\n      var interval = setInterval(() => {\n        if (this._numProcessing == 0) {\n          clearInterval(interval);\n          resolve(true);\n        } else {\n          ticked += tick;\n          if (timeout && ticked >= timeout) {\n            clearInterval(interval);\n            resolve(false);\n          }\n        }\n      }, tick);\n    });\n  }\n\n  /** Determines whether this SDK is enabled and a valid Dsn is present. */\n   _isEnabled() {\n    return this.getOptions().enabled !== false && this._dsn !== undefined;\n  }\n\n  /**\n   * Adds common information to events.\n   *\n   * The information includes release and environment from `options`,\n   * breadcrumbs and context (extra, tags and user) from the scope.\n   *\n   * Information that is already present in the event is never overwritten. For\n   * nested objects, such as the context, keys are merged.\n   *\n   * @param event The original event.\n   * @param hint May contain additional information about the original exception.\n   * @param scope A scope containing event metadata.\n   * @returns A new event with more information.\n   */\n   _prepareEvent(event, hint, scope) {\n    const { normalizeDepth = 3, normalizeMaxBreadth = 1000 } = this.getOptions();\n    var prepared = {\n      ...event,\n      event_id: event.event_id || hint.event_id || uuid4(),\n      timestamp: event.timestamp || dateTimestampInSeconds(),\n    };\n\n    this._applyClientOptions(prepared);\n    this._applyIntegrationsMetadata(prepared);\n\n    // If we have scope given to us, use it as the base for further modifications.\n    // This allows us to prevent unnecessary copying of data if `captureContext` is not provided.\n    let finalScope = scope;\n    if (hint.captureContext) {\n      finalScope = Scope.clone(finalScope).update(hint.captureContext);\n    }\n\n    // We prepare the result here with a resolved Event.\n    let result = resolvedSyncPromise(prepared);\n\n    // This should be the last thing called, since we want that\n    // {@link Hub.addEventProcessor} gets the finished prepared event.\n    if (finalScope) {\n      // Collect attachments from the hint and scope\n      var attachments = [...(hint.attachments || []), ...finalScope.getAttachments()];\n\n      if (attachments.length) {\n        hint.attachments = attachments;\n      }\n\n      // In case we have a hub we reassign it.\n      result = finalScope.applyToEvent(prepared, hint);\n    }\n\n    return result.then(evt => {\n      if (typeof normalizeDepth === 'number' && normalizeDepth > 0) {\n        return this._normalizeEvent(evt, normalizeDepth, normalizeMaxBreadth);\n      }\n      return evt;\n    });\n  }\n\n  /**\n   * Applies `normalize` function on necessary `Event` attributes to make them safe for serialization.\n   * Normalized keys:\n   * - `breadcrumbs.data`\n   * - `user`\n   * - `contexts`\n   * - `extra`\n   * @param event Event\n   * @returns Normalized event\n   */\n   _normalizeEvent(event, depth, maxBreadth) {\n    if (!event) {\n      return null;\n    }\n\n    var normalized = {\n      ...event,\n      ...(event.breadcrumbs && {\n        breadcrumbs: event.breadcrumbs.map(b => ({\n          ...b,\n          ...(b.data && {\n            data: normalize(b.data, depth, maxBreadth),\n          }),\n        })),\n      }),\n      ...(event.user && {\n        user: normalize(event.user, depth, maxBreadth),\n      }),\n      ...(event.contexts && {\n        contexts: normalize(event.contexts, depth, maxBreadth),\n      }),\n      ...(event.extra && {\n        extra: normalize(event.extra, depth, maxBreadth),\n      }),\n    };\n\n    // event.contexts.trace stores information about a Transaction. Similarly,\n    // event.spans[] stores information about child Spans. Given that a\n    // Transaction is conceptually a Span, normalization should apply to both\n    // Transactions and Spans consistently.\n    // For now the decision is to skip normalization of Transactions and Spans,\n    // so this block overwrites the normalized event to add back the original\n    // Transaction information prior to normalization.\n    if (event.contexts && event.contexts.trace && normalized.contexts) {\n      normalized.contexts.trace = event.contexts.trace;\n\n      // event.contexts.trace.data may contain circular/dangerous data so we need to normalize it\n      if (event.contexts.trace.data) {\n        normalized.contexts.trace.data = normalize(event.contexts.trace.data, depth, maxBreadth);\n      }\n    }\n\n    // event.spans[].data may contain circular/dangerous data so we need to normalize it\n    if (event.spans) {\n      normalized.spans = event.spans.map(span => {\n        // We cannot use the spread operator here because `toJSON` on `span` is non-enumerable\n        if (span.data) {\n          span.data = normalize(span.data, depth, maxBreadth);\n        }\n        return span;\n      });\n    }\n\n    return normalized;\n  }\n\n  /**\n   *  Enhances event using the client configuration.\n   *  It takes care of all \"static\" values like environment, release and `dist`,\n   *  as well as truncating overly long values.\n   * @param event event instance to be enhanced\n   */\n   _applyClientOptions(event) {\n    var options = this.getOptions();\n    const { environment, release, dist, maxValueLength = 250 } = options;\n\n    if (!('environment' in event)) {\n      event.environment = 'environment' in options ? environment : 'production';\n    }\n\n    if (event.release === undefined && release !== undefined) {\n      event.release = release;\n    }\n\n    if (event.dist === undefined && dist !== undefined) {\n      event.dist = dist;\n    }\n\n    if (event.message) {\n      event.message = truncate(event.message, maxValueLength);\n    }\n\n    var exception = event.exception && event.exception.values && event.exception.values[0];\n    if (exception && exception.value) {\n      exception.value = truncate(exception.value, maxValueLength);\n    }\n\n    var request = event.request;\n    if (request && request.url) {\n      request.url = truncate(request.url, maxValueLength);\n    }\n  }\n\n  /**\n   * This function adds all used integrations to the SDK info in the event.\n   * @param event The event that will be filled with all integrations.\n   */\n   _applyIntegrationsMetadata(event) {\n    var integrationsArray = Object.keys(this._integrations);\n    if (integrationsArray.length > 0) {\n      event.sdk = event.sdk || {};\n      event.sdk.integrations = [...(event.sdk.integrations || []), ...integrationsArray];\n    }\n  }\n\n  /**\n   * Processes the event and logs an error in case of rejection\n   * @param event\n   * @param hint\n   * @param scope\n   */\n   _captureEvent(event, hint = {}, scope) {\n    return this._processEvent(event, hint, scope).then(\n      finalEvent => {\n        return finalEvent.event_id;\n      },\n      reason => {\n        if ((typeof __SENTRY_DEBUG__ === 'undefined' || __SENTRY_DEBUG__)) {\n          // If something's gone wrong, log the error as a warning. If it's just us having used a `SentryError` for\n          // control flow, log just the message (no stack) as a log-level log.\n          var sentryError = reason ;\n          if (sentryError.logLevel === 'log') {\n            logger.log(sentryError.message);\n          } else {\n            logger.warn(sentryError);\n          }\n        }\n        return undefined;\n      },\n    );\n  }\n\n  /**\n   * Processes an event (either error or message) and sends it to Sentry.\n   *\n   * This also adds breadcrumbs and context information to the event. However,\n   * platform specific meta data (such as the User's IP address) must be added\n   * by the SDK implementor.\n   *\n   *\n   * @param event The event to send to Sentry.\n   * @param hint May contain additional information about the original exception.\n   * @param scope A scope containing event metadata.\n   * @returns A SyncPromise that resolves with the event or rejects in case event was/will not be send.\n   */\n   _processEvent(event, hint, scope) {\n    const { beforeSend, sampleRate } = this.getOptions();\n\n    if (!this._isEnabled()) {\n      return rejectedSyncPromise(new SentryError('SDK not enabled, will not capture event.', 'log'));\n    }\n\n    var isTransaction = event.type === 'transaction';\n    // 1.0 === 100% events are sent\n    // 0.0 === 0% events are sent\n    // Sampling for transaction happens somewhere else\n    if (!isTransaction && typeof sampleRate === 'number' && Math.random() > sampleRate) {\n      this.recordDroppedEvent('sample_rate', 'error');\n      return rejectedSyncPromise(\n        new SentryError(\n          `Discarding event because it's not included in the random sample (sampling rate = ${sampleRate})`,\n          'log',\n        ),\n      );\n    }\n\n    return this._prepareEvent(event, hint, scope)\n      .then(prepared => {\n        if (prepared === null) {\n          this.recordDroppedEvent('event_processor', event.type || 'error');\n          throw new SentryError('An event processor returned null, will not send event.', 'log');\n        }\n\n        var isInternalException = hint.data && (hint.data ).__sentry__ === true;\n        if (isInternalException || isTransaction || !beforeSend) {\n          return prepared;\n        }\n\n        var beforeSendResult = beforeSend(prepared, hint);\n        return _ensureBeforeSendRv(beforeSendResult);\n      })\n      .then(processedEvent => {\n        if (processedEvent === null) {\n          this.recordDroppedEvent('before_send', event.type || 'error');\n          throw new SentryError('`beforeSend` returned `null`, will not send event.', 'log');\n        }\n\n        var session = scope && scope.getSession();\n        if (!isTransaction && session) {\n          this._updateSessionFromEvent(session, processedEvent);\n        }\n\n        // None of the Sentry built event processor will update transaction name,\n        // so if the transaction name has been changed by an event processor, we know\n        // it has to come from custom event processor added by a user\n        var transactionInfo = processedEvent.transaction_info;\n        if (isTransaction && transactionInfo && processedEvent.transaction !== event.transaction) {\n          var source = 'custom';\n          processedEvent.transaction_info = {\n            ...transactionInfo,\n            source,\n            changes: [\n              ...transactionInfo.changes,\n              {\n                source,\n                // use the same timestamp as the processed event.\n                timestamp: processedEvent.timestamp ,\n                propagations: transactionInfo.propagations,\n              },\n            ],\n          };\n        }\n\n        this.sendEvent(processedEvent, hint);\n        return processedEvent;\n      })\n      .then(null, reason => {\n        if (reason instanceof SentryError) {\n          throw reason;\n        }\n\n        this.captureException(reason, {\n          data: {\n            __sentry__: true,\n          },\n          originalException: reason ,\n        });\n        throw new SentryError(\n          `Event processing pipeline threw an error, original event will not be sent. Details have been sent as a new event.\\nReason: ${reason}`,\n        );\n      });\n  }\n\n  /**\n   * Occupies the client with processing and event\n   */\n   _process(promise) {\n    this._numProcessing += 1;\n    void promise.then(\n      value => {\n        this._numProcessing -= 1;\n        return value;\n      },\n      reason => {\n        this._numProcessing -= 1;\n        return reason;\n      },\n    );\n  }\n\n  /**\n   * @inheritdoc\n   */\n   _sendEnvelope(envelope) {\n    if (this._transport && this._dsn) {\n      this._transport.send(envelope).then(null, reason => {\n        (typeof __SENTRY_DEBUG__ === 'undefined' || __SENTRY_DEBUG__) && logger.error('Error while sending event:', reason);\n      });\n    } else {\n      (typeof __SENTRY_DEBUG__ === 'undefined' || __SENTRY_DEBUG__) && logger.error('Transport disabled');\n    }\n  }\n\n  /**\n   * Clears outcomes on this client and returns them.\n   */\n   _clearOutcomes() {\n    var outcomes = this._outcomes;\n    this._outcomes = {};\n    return Object.keys(outcomes).map(key => {\n      const [reason, category] = key.split(':') ;\n      return {\n        reason,\n        category,\n        quantity: outcomes[key],\n      };\n    });\n  }\n\n  /**\n   * @inheritDoc\n   */\n  // eslint-disable-next-line @typescript-eslint/no-explicit-any, @typescript-eslint/explicit-module-boundary-types\n\n}\n\n/**\n * Verifies that return value of configured `beforeSend` is of expected type.\n */\nfunction _ensureBeforeSendRv(rv) {\n  var nullErr = '`beforeSend` method has to return `null` or a valid event.';\n  if (isThenable(rv)) {\n    return rv.then(\n      event => {\n        if (!(isPlainObject(event) || event === null)) {\n          throw new SentryError(nullErr);\n        }\n        return event;\n      },\n      e => {\n        throw new SentryError(`beforeSend rejected with ${e}`);\n      },\n    );\n  } else if (!(isPlainObject(rv) || rv === null)) {\n    throw new SentryError(nullErr);\n  }\n  return rv;\n}\n\nexport { BaseClient };\n//# sourceMappingURL=baseclient.js.map\n","import { getCurrentHub } from '@sentry/hub';\nimport { logger } from '@sentry/utils';\n\n/** A class object that can instantiate Client objects. */\n\n/**\n * Internal function to create a new SDK client instance. The client is\n * installed and then bound to the current scope.\n *\n * @param clientClass The client class to instantiate.\n * @param options Options to pass to the client.\n */\nfunction initAndBind(\n  clientClass,\n  options,\n) {\n  if (options.debug === true) {\n    if ((typeof __SENTRY_DEBUG__ === 'undefined' || __SENTRY_DEBUG__)) {\n      logger.enable();\n    } else {\n      // use `console.warn` rather than `logger.warn` since by non-debug bundles have all `logger.x` statements stripped\n      // eslint-disable-next-line no-console\n      console.warn('[Sentry] Cannot initialize SDK with `debug` option using a non-debug bundle.');\n    }\n  }\n  var hub = getCurrentHub();\n  var scope = hub.getScope();\n  if (scope) {\n    scope.update(options.initialScope);\n  }\n\n  var client = new clientClass(options);\n  hub.bindClient(client);\n}\n\nexport { initAndBind };\n//# sourceMappingURL=sdk.js.map\n","import { makePromiseBuffer, forEachEnvelopeItem, envelopeItemTypeToDataCategory, isRateLimited, resolvedSyncPromise, createEnvelope, serializeEnvelope, logger, updateRateLimits, SentryError } from '@sentry/utils';\n\nvar DEFAULT_TRANSPORT_BUFFER_SIZE = 30;\n\n/**\n * Creates an instance of a Sentry `Transport`\n *\n * @param options\n * @param makeRequest\n */\nfunction createTransport(\n  options,\n  makeRequest,\n  buffer = makePromiseBuffer(options.bufferSize || DEFAULT_TRANSPORT_BUFFER_SIZE),\n) {\n  let rateLimits = {};\n\n  var flush = (timeout) => buffer.drain(timeout);\n\n  function send(envelope) {\n    var filteredEnvelopeItems = [];\n\n    // Drop rate limited items from envelope\n    forEachEnvelopeItem(envelope, (item, type) => {\n      var envelopeItemDataCategory = envelopeItemTypeToDataCategory(type);\n      if (isRateLimited(rateLimits, envelopeItemDataCategory)) {\n        options.recordDroppedEvent('ratelimit_backoff', envelopeItemDataCategory);\n      } else {\n        filteredEnvelopeItems.push(item);\n      }\n    });\n\n    // Skip sending if envelope is empty after filtering out rate limited events\n    if (filteredEnvelopeItems.length === 0) {\n      return resolvedSyncPromise();\n    }\n\n    // eslint-disable-next-line @typescript-eslint/no-explicit-any\n    var filteredEnvelope = createEnvelope(envelope[0], filteredEnvelopeItems );\n\n    // Creates client report for each item in an envelope\n    var recordEnvelopeLoss = (reason) => {\n      forEachEnvelopeItem(filteredEnvelope, (_, type) => {\n        options.recordDroppedEvent(reason, envelopeItemTypeToDataCategory(type));\n      });\n    };\n\n    var requestTask = () =>\n      makeRequest({ body: serializeEnvelope(filteredEnvelope, options.textEncoder) }).then(\n        response => {\n          // We don't want to throw on NOK responses, but we want to at least log them\n          if (response.statusCode !== undefined && (response.statusCode < 200 || response.statusCode >= 300)) {\n            (typeof __SENTRY_DEBUG__ === 'undefined' || __SENTRY_DEBUG__) && logger.warn(`Sentry responded with status code ${response.statusCode} to sent event.`);\n          }\n\n          rateLimits = updateRateLimits(rateLimits, response);\n        },\n        error => {\n          (typeof __SENTRY_DEBUG__ === 'undefined' || __SENTRY_DEBUG__) && logger.error('Failed while sending event:', error);\n          recordEnvelopeLoss('network_error');\n        },\n      );\n\n    return buffer.add(requestTask).then(\n      result => result,\n      error => {\n        if (error instanceof SentryError) {\n          (typeof __SENTRY_DEBUG__ === 'undefined' || __SENTRY_DEBUG__) && logger.error('Skipped sending event because buffer is full.');\n          recordEnvelopeLoss('queue_overflow');\n          return resolvedSyncPromise();\n        } else {\n          throw error;\n        }\n      },\n    );\n  }\n\n  return {\n    send,\n    flush,\n  };\n}\n\nexport { DEFAULT_TRANSPORT_BUFFER_SIZE, createTransport };\n//# sourceMappingURL=base.js.map\n","var SDK_VERSION = '7.14.0';\n\nexport { SDK_VERSION };\n//# sourceMappingURL=version.js.map\n","import { getOriginalFunction } from '@sentry/utils';\n\nlet originalFunctionToString;\n\n/** Patch toString calls to return proper name for wrapped functions */\nclass FunctionToString  {constructor() { FunctionToString.prototype.__init.call(this); }\n  /**\n   * @inheritDoc\n   */\n   static __initStatic() {this.id = 'FunctionToString';}\n\n  /**\n   * @inheritDoc\n   */\n   __init() {this.name = FunctionToString.id;}\n\n  /**\n   * @inheritDoc\n   */\n   setupOnce() {\n    // eslint-disable-next-line @typescript-eslint/unbound-method\n    originalFunctionToString = Function.prototype.toString;\n\n    // eslint-disable-next-line @typescript-eslint/no-explicit-any\n    Function.prototype.toString = function ( ...args) {\n      var context = getOriginalFunction(this) || this;\n      return originalFunctionToString.apply(context, args);\n    };\n  }\n} FunctionToString.__initStatic();\n\nexport { FunctionToString };\n//# sourceMappingURL=functiontostring.js.map\n","import { logger, getEventDescription, isMatchingPattern } from '@sentry/utils';\n\n// \"Script error.\" is hard coded into browsers for errors that it can't read.\n// this is the result of a script being pulled in from an external domain and CORS.\nvar DEFAULT_IGNORE_ERRORS = [/^Script error\\.?$/, /^Javascript error: Script error\\.? on line 0$/];\n\n/** Options for the InboundFilters integration */\n\n/** Inbound filters configurable by the user */\nclass InboundFilters  {\n  /**\n   * @inheritDoc\n   */\n   static __initStatic() {this.id = 'InboundFilters';}\n\n  /**\n   * @inheritDoc\n   */\n   __init() {this.name = InboundFilters.id;}\n\n   constructor(  _options = {}) {;this._options = _options;InboundFilters.prototype.__init.call(this);}\n\n  /**\n   * @inheritDoc\n   */\n   setupOnce(addGlobalEventProcessor, getCurrentHub) {\n    var eventProcess = (event) => {\n      var hub = getCurrentHub();\n      if (hub) {\n        var self = hub.getIntegration(InboundFilters);\n        if (self) {\n          var client = hub.getClient();\n          var clientOptions = client ? client.getOptions() : {};\n          var options = _mergeOptions(self._options, clientOptions);\n          return _shouldDropEvent(event, options) ? null : event;\n        }\n      }\n      return event;\n    };\n\n    eventProcess.id = this.name;\n    addGlobalEventProcessor(eventProcess);\n  }\n} InboundFilters.__initStatic();\n\n/** JSDoc */\nfunction _mergeOptions(\n  internalOptions = {},\n  clientOptions = {},\n) {\n  return {\n    allowUrls: [...(internalOptions.allowUrls || []), ...(clientOptions.allowUrls || [])],\n    denyUrls: [...(internalOptions.denyUrls || []), ...(clientOptions.denyUrls || [])],\n    ignoreErrors: [\n      ...(internalOptions.ignoreErrors || []),\n      ...(clientOptions.ignoreErrors || []),\n      ...DEFAULT_IGNORE_ERRORS,\n    ],\n    ignoreInternal: internalOptions.ignoreInternal !== undefined ? internalOptions.ignoreInternal : true,\n  };\n}\n\n/** JSDoc */\nfunction _shouldDropEvent(event, options) {\n  if (options.ignoreInternal && _isSentryError(event)) {\n    (typeof __SENTRY_DEBUG__ === 'undefined' || __SENTRY_DEBUG__) &&\n      logger.warn(`Event dropped due to being internal Sentry Error.\\nEvent: ${getEventDescription(event)}`);\n    return true;\n  }\n  if (_isIgnoredError(event, options.ignoreErrors)) {\n    (typeof __SENTRY_DEBUG__ === 'undefined' || __SENTRY_DEBUG__) &&\n      logger.warn(\n        `Event dropped due to being matched by \\`ignoreErrors\\` option.\\nEvent: ${getEventDescription(event)}`,\n      );\n    return true;\n  }\n  if (_isDeniedUrl(event, options.denyUrls)) {\n    (typeof __SENTRY_DEBUG__ === 'undefined' || __SENTRY_DEBUG__) &&\n      logger.warn(\n        `Event dropped due to being matched by \\`denyUrls\\` option.\\nEvent: ${getEventDescription(\n          event,\n        )}.\\nUrl: ${_getEventFilterUrl(event)}`,\n      );\n    return true;\n  }\n  if (!_isAllowedUrl(event, options.allowUrls)) {\n    (typeof __SENTRY_DEBUG__ === 'undefined' || __SENTRY_DEBUG__) &&\n      logger.warn(\n        `Event dropped due to not being matched by \\`allowUrls\\` option.\\nEvent: ${getEventDescription(\n          event,\n        )}.\\nUrl: ${_getEventFilterUrl(event)}`,\n      );\n    return true;\n  }\n  return false;\n}\n\nfunction _isIgnoredError(event, ignoreErrors) {\n  if (!ignoreErrors || !ignoreErrors.length) {\n    return false;\n  }\n\n  return _getPossibleEventMessages(event).some(message =>\n    ignoreErrors.some(pattern => isMatchingPattern(message, pattern)),\n  );\n}\n\nfunction _isDeniedUrl(event, denyUrls) {\n  // TODO: Use Glob instead?\n  if (!denyUrls || !denyUrls.length) {\n    return false;\n  }\n  var url = _getEventFilterUrl(event);\n  return !url ? false : denyUrls.some(pattern => isMatchingPattern(url, pattern));\n}\n\nfunction _isAllowedUrl(event, allowUrls) {\n  // TODO: Use Glob instead?\n  if (!allowUrls || !allowUrls.length) {\n    return true;\n  }\n  var url = _getEventFilterUrl(event);\n  return !url ? true : allowUrls.some(pattern => isMatchingPattern(url, pattern));\n}\n\nfunction _getPossibleEventMessages(event) {\n  if (event.message) {\n    return [event.message];\n  }\n  if (event.exception) {\n    try {\n      const { type = '', value = '' } = (event.exception.values && event.exception.values[0]) || {};\n      return [`${value}`, `${type}: ${value}`];\n    } catch (oO) {\n      (typeof __SENTRY_DEBUG__ === 'undefined' || __SENTRY_DEBUG__) && logger.error(`Cannot extract message for event ${getEventDescription(event)}`);\n      return [];\n    }\n  }\n  return [];\n}\n\nfunction _isSentryError(event) {\n  try {\n    // @ts-ignore can't be a sentry error if undefined\n    // eslint-disable-next-line @typescript-eslint/no-unsafe-member-access\n    return event.exception.values[0].type === 'SentryError';\n  } catch (e) {\n    // ignore\n  }\n  return false;\n}\n\nfunction _getLastValidUrl(frames = []) {\n  for (let i = frames.length - 1; i >= 0; i--) {\n    var frame = frames[i];\n\n    if (frame && frame.filename !== '<anonymous>' && frame.filename !== '[native code]') {\n      return frame.filename || null;\n    }\n  }\n\n  return null;\n}\n\nfunction _getEventFilterUrl(event) {\n  try {\n    let frames;\n    try {\n      // @ts-ignore we only care about frames if the whole thing here is defined\n      frames = event.exception.values[0].stacktrace.frames;\n    } catch (e) {\n      // ignore\n    }\n    return frames ? _getLastValidUrl(frames) : null;\n  } catch (oO) {\n    (typeof __SENTRY_DEBUG__ === 'undefined' || __SENTRY_DEBUG__) && logger.error(`Cannot extract url for event ${getEventDescription(event)}`);\n    return null;\n  }\n}\n\nexport { InboundFilters, _mergeOptions, _shouldDropEvent };\n//# sourceMappingURL=inboundfilters.js.map\n","import { getCurrentHub } from '@sentry/core';\nimport { isEvent, extractExceptionKeysForMessage, normalizeToSize, addExceptionMechanism, resolvedSyncPromise, isErrorEvent, isDOMError, isDOMException, addExceptionTypeValue, isError, isPlainObject } from '@sentry/utils';\n\n/**\n * This function creates an exception from a JavaScript Error\n */\nfunction exceptionFromError(stackParser, ex) {\n  // Get the frames first since Opera can lose the stack if we touch anything else first\n  var frames = parseStackFrames(stackParser, ex);\n\n  var exception = {\n    type: ex && ex.name,\n    value: extractMessage(ex),\n  };\n\n  if (frames.length) {\n    exception.stacktrace = { frames };\n  }\n\n  if (exception.type === undefined && exception.value === '') {\n    exception.value = 'Unrecoverable error caught';\n  }\n\n  return exception;\n}\n\n/**\n * @hidden\n */\nfunction eventFromPlainObject(\n  stackParser,\n  exception,\n  syntheticException,\n  isUnhandledRejection,\n) {\n  var hub = getCurrentHub();\n  var client = hub.getClient();\n  var normalizeDepth = client && client.getOptions().normalizeDepth;\n\n  var event = {\n    exception: {\n      values: [\n        {\n          type: isEvent(exception) ? exception.constructor.name : isUnhandledRejection ? 'UnhandledRejection' : 'Error',\n          value: `Non-Error ${\n            isUnhandledRejection ? 'promise rejection' : 'exception'\n          } captured with keys: ${extractExceptionKeysForMessage(exception)}`,\n        },\n      ],\n    },\n    extra: {\n      __serialized__: normalizeToSize(exception, normalizeDepth),\n    },\n  };\n\n  if (syntheticException) {\n    var frames = parseStackFrames(stackParser, syntheticException);\n    if (frames.length) {\n      // event.exception.values[0] has been set above\n      (event.exception ).values[0].stacktrace = { frames };\n    }\n  }\n\n  return event;\n}\n\n/**\n * @hidden\n */\nfunction eventFromError(stackParser, ex) {\n  return {\n    exception: {\n      values: [exceptionFromError(stackParser, ex)],\n    },\n  };\n}\n\n/** Parses stack frames from an error */\nfunction parseStackFrames(\n  stackParser,\n  ex,\n) {\n  // Access and store the stacktrace property before doing ANYTHING\n  // else to it because Opera is not very good at providing it\n  // reliably in other circumstances.\n  var stacktrace = ex.stacktrace || ex.stack || '';\n\n  var popSize = getPopSize(ex);\n\n  try {\n    return stackParser(stacktrace, popSize);\n  } catch (e) {\n    // no-empty\n  }\n\n  return [];\n}\n\n// Based on our own mapping pattern - https://github.com/getsentry/sentry/blob/9f08305e09866c8bd6d0c24f5b0aabdd7dd6c59c/src/sentry/lang/javascript/errormapping.py#L83-L108\nvar reactMinifiedRegexp = /Minified React error #\\d+;/i;\n\nfunction getPopSize(ex) {\n  if (ex) {\n    if (typeof ex.framesToPop === 'number') {\n      return ex.framesToPop;\n    }\n\n    if (reactMinifiedRegexp.test(ex.message)) {\n      return 1;\n    }\n  }\n\n  return 0;\n}\n\n/**\n * There are cases where stacktrace.message is an Event object\n * https://github.com/getsentry/sentry-javascript/issues/1949\n * In this specific case we try to extract stacktrace.message.error.message\n */\nfunction extractMessage(ex) {\n  var message = ex && ex.message;\n  if (!message) {\n    return 'No error message';\n  }\n  if (message.error && typeof message.error.message === 'string') {\n    return message.error.message;\n  }\n  return message;\n}\n\n/**\n * Creates an {@link Event} from all inputs to `captureException` and non-primitive inputs to `captureMessage`.\n * @hidden\n */\nfunction eventFromException(\n  stackParser,\n  exception,\n  hint,\n  attachStacktrace,\n) {\n  var syntheticException = (hint && hint.syntheticException) || undefined;\n  var event = eventFromUnknownInput(stackParser, exception, syntheticException, attachStacktrace);\n  addExceptionMechanism(event); // defaults to { type: 'generic', handled: true }\n  event.level = 'error';\n  if (hint && hint.event_id) {\n    event.event_id = hint.event_id;\n  }\n  return resolvedSyncPromise(event);\n}\n\n/**\n * Builds and Event from a Message\n * @hidden\n */\nfunction eventFromMessage(\n  stackParser,\n  message,\n  // eslint-disable-next-line deprecation/deprecation\n  level = 'info',\n  hint,\n  attachStacktrace,\n) {\n  var syntheticException = (hint && hint.syntheticException) || undefined;\n  var event = eventFromString(stackParser, message, syntheticException, attachStacktrace);\n  event.level = level;\n  if (hint && hint.event_id) {\n    event.event_id = hint.event_id;\n  }\n  return resolvedSyncPromise(event);\n}\n\n/**\n * @hidden\n */\nfunction eventFromUnknownInput(\n  stackParser,\n  exception,\n  syntheticException,\n  attachStacktrace,\n  isUnhandledRejection,\n) {\n  let event;\n\n  if (isErrorEvent(exception ) && (exception ).error) {\n    // If it is an ErrorEvent with `error` property, extract it to get actual Error\n    var errorEvent = exception ;\n    return eventFromError(stackParser, errorEvent.error );\n  }\n\n  // If it is a `DOMError` (which is a legacy API, but still supported in some browsers) then we just extract the name\n  // and message, as it doesn't provide anything else. According to the spec, all `DOMExceptions` should also be\n  // `Error`s, but that's not the case in IE11, so in that case we treat it the same as we do a `DOMError`.\n  //\n  // https://developer.mozilla.org/en-US/docs/Web/API/DOMError\n  // https://developer.mozilla.org/en-US/docs/Web/API/DOMException\n  // https://webidl.spec.whatwg.org/#es-DOMException-specialness\n  if (isDOMError(exception ) || isDOMException(exception )) {\n    var domException = exception ;\n\n    if ('stack' in (exception )) {\n      event = eventFromError(stackParser, exception );\n    } else {\n      var name = domException.name || (isDOMError(domException) ? 'DOMError' : 'DOMException');\n      var message = domException.message ? `${name}: ${domException.message}` : name;\n      event = eventFromString(stackParser, message, syntheticException, attachStacktrace);\n      addExceptionTypeValue(event, message);\n    }\n    if ('code' in domException) {\n      event.tags = { ...event.tags, 'DOMException.code': `${domException.code}` };\n    }\n\n    return event;\n  }\n  if (isError(exception)) {\n    // we have a real Error object, do nothing\n    return eventFromError(stackParser, exception);\n  }\n  if (isPlainObject(exception) || isEvent(exception)) {\n    // If it's a plain object or an instance of `Event` (the built-in JS kind, not this SDK's `Event` type), serialize\n    // it manually. This will allow us to group events based on top-level keys which is much better than creating a new\n    // group on any key/value change.\n    var objectException = exception ;\n    event = eventFromPlainObject(stackParser, objectException, syntheticException, isUnhandledRejection);\n    addExceptionMechanism(event, {\n      synthetic: true,\n    });\n    return event;\n  }\n\n  // If none of previous checks were valid, then it means that it's not:\n  // - an instance of DOMError\n  // - an instance of DOMException\n  // - an instance of Event\n  // - an instance of Error\n  // - a valid ErrorEvent (one with an error property)\n  // - a plain Object\n  //\n  // So bail out and capture it as a simple message:\n  event = eventFromString(stackParser, exception , syntheticException, attachStacktrace);\n  addExceptionTypeValue(event, `${exception}`, undefined);\n  addExceptionMechanism(event, {\n    synthetic: true,\n  });\n\n  return event;\n}\n\n/**\n * @hidden\n */\nfunction eventFromString(\n  stackParser,\n  input,\n  syntheticException,\n  attachStacktrace,\n) {\n  var event = {\n    message: input,\n  };\n\n  if (attachStacktrace && syntheticException) {\n    var frames = parseStackFrames(stackParser, syntheticException);\n    if (frames.length) {\n      event.exception = {\n        values: [{ value: input, stacktrace: { frames } }],\n      };\n    }\n  }\n\n  return event;\n}\n\nexport { eventFromError, eventFromException, eventFromMessage, eventFromPlainObject, eventFromString, eventFromUnknownInput, exceptionFromError, parseStackFrames };\n//# sourceMappingURL=eventbuilder.js.map\n","import { getCurrentHub } from '@sentry/core';\nimport { addInstrumentationHandler, htmlTreeAsString, severityLevelFromString, safeJoin, getGlobalObject, parseUrl } from '@sentry/utils';\n\n/* eslint-disable @typescript-eslint/no-unsafe-member-access */\n\n/** JSDoc */\n\nvar BREADCRUMB_INTEGRATION_ID = 'Breadcrumbs';\n\n/**\n * Default Breadcrumbs instrumentations\n * TODO: Deprecated - with v6, this will be renamed to `Instrument`\n */\nclass Breadcrumbs  {\n  /**\n   * @inheritDoc\n   */\n   static __initStatic() {this.id = BREADCRUMB_INTEGRATION_ID;}\n\n  /**\n   * @inheritDoc\n   */\n   __init() {this.name = Breadcrumbs.id;}\n\n  /**\n   * Options of the breadcrumbs integration.\n   */\n  // This field is public, because we use it in the browser client to check if the `sentry` option is enabled.\n\n  /**\n   * @inheritDoc\n   */\n   constructor(options) {;Breadcrumbs.prototype.__init.call(this);\n    this.options = {\n      console: true,\n      dom: true,\n      fetch: true,\n      history: true,\n      sentry: true,\n      xhr: true,\n      ...options,\n    };\n  }\n\n  /**\n   * Instrument browser built-ins w/ breadcrumb capturing\n   *  - Console API\n   *  - DOM API (click/typing)\n   *  - XMLHttpRequest API\n   *  - Fetch API\n   *  - History API\n   */\n   setupOnce() {\n    if (this.options.console) {\n      addInstrumentationHandler('console', _consoleBreadcrumb);\n    }\n    if (this.options.dom) {\n      addInstrumentationHandler('dom', _domBreadcrumb(this.options.dom));\n    }\n    if (this.options.xhr) {\n      addInstrumentationHandler('xhr', _xhrBreadcrumb);\n    }\n    if (this.options.fetch) {\n      addInstrumentationHandler('fetch', _fetchBreadcrumb);\n    }\n    if (this.options.history) {\n      addInstrumentationHandler('history', _historyBreadcrumb);\n    }\n  }\n} Breadcrumbs.__initStatic();\n\n/**\n * A HOC that creaes a function that creates breadcrumbs from DOM API calls.\n * This is a HOC so that we get access to dom options in the closure.\n */\n// eslint-disable-next-line @typescript-eslint/no-explicit-any\nfunction _domBreadcrumb(dom) {\n  // eslint-disable-next-line @typescript-eslint/no-explicit-any\n  function _innerDomBreadcrumb(handlerData) {\n    let target;\n    let keyAttrs = typeof dom === 'object' ? dom.serializeAttribute : undefined;\n\n    if (typeof keyAttrs === 'string') {\n      keyAttrs = [keyAttrs];\n    }\n\n    // Accessing event.target can throw (see getsentry/raven-js#838, #768)\n    try {\n      target = handlerData.event.target\n        ? htmlTreeAsString(handlerData.event.target , keyAttrs)\n        : htmlTreeAsString(handlerData.event , keyAttrs);\n    } catch (e) {\n      target = '<unknown>';\n    }\n\n    if (target.length === 0) {\n      return;\n    }\n\n    getCurrentHub().addBreadcrumb(\n      {\n        category: `ui.${handlerData.name}`,\n        message: target,\n      },\n      {\n        event: handlerData.event,\n        name: handlerData.name,\n        global: handlerData.global,\n      },\n    );\n  }\n\n  return _innerDomBreadcrumb;\n}\n\n/**\n * Creates breadcrumbs from console API calls\n */\n// eslint-disable-next-line @typescript-eslint/no-explicit-any\nfunction _consoleBreadcrumb(handlerData) {\n  var breadcrumb = {\n    category: 'console',\n    data: {\n      arguments: handlerData.args,\n      logger: 'console',\n    },\n    level: severityLevelFromString(handlerData.level),\n    message: safeJoin(handlerData.args, ' '),\n  };\n\n  if (handlerData.level === 'assert') {\n    if (handlerData.args[0] === false) {\n      breadcrumb.message = `Assertion failed: ${safeJoin(handlerData.args.slice(1), ' ') || 'console.assert'}`;\n      breadcrumb.data.arguments = handlerData.args.slice(1);\n    } else {\n      // Don't capture a breadcrumb for passed assertions\n      return;\n    }\n  }\n\n  getCurrentHub().addBreadcrumb(breadcrumb, {\n    input: handlerData.args,\n    level: handlerData.level,\n  });\n}\n\n/**\n * Creates breadcrumbs from XHR API calls\n */\n// eslint-disable-next-line @typescript-eslint/no-explicit-any\nfunction _xhrBreadcrumb(handlerData) {\n  if (handlerData.endTimestamp) {\n    // We only capture complete, non-sentry requests\n    if (handlerData.xhr.__sentry_own_request__) {\n      return;\n    }\n\n    const { method, url, status_code, body } = handlerData.xhr.__sentry_xhr__ || {};\n\n    getCurrentHub().addBreadcrumb(\n      {\n        category: 'xhr',\n        data: {\n          method,\n          url,\n          status_code,\n        },\n        type: 'http',\n      },\n      {\n        xhr: handlerData.xhr,\n        input: body,\n      },\n    );\n\n    return;\n  }\n}\n\n/**\n * Creates breadcrumbs from fetch API calls\n */\n// eslint-disable-next-line @typescript-eslint/no-explicit-any\nfunction _fetchBreadcrumb(handlerData) {\n  // We only capture complete fetch requests\n  if (!handlerData.endTimestamp) {\n    return;\n  }\n\n  if (handlerData.fetchData.url.match(/sentry_key/) && handlerData.fetchData.method === 'POST') {\n    // We will not create breadcrumbs for fetch requests that contain `sentry_key` (internal sentry requests)\n    return;\n  }\n\n  if (handlerData.error) {\n    getCurrentHub().addBreadcrumb(\n      {\n        category: 'fetch',\n        data: handlerData.fetchData,\n        level: 'error',\n        type: 'http',\n      },\n      {\n        data: handlerData.error,\n        input: handlerData.args,\n      },\n    );\n  } else {\n    getCurrentHub().addBreadcrumb(\n      {\n        category: 'fetch',\n        data: {\n          ...handlerData.fetchData,\n          status_code: handlerData.response.status,\n        },\n        type: 'http',\n      },\n      {\n        input: handlerData.args,\n        response: handlerData.response,\n      },\n    );\n  }\n}\n\n/**\n * Creates breadcrumbs from history API calls\n */\n// eslint-disable-next-line @typescript-eslint/no-explicit-any\nfunction _historyBreadcrumb(handlerData) {\n  var global = getGlobalObject();\n  let from = handlerData.from;\n  let to = handlerData.to;\n  var parsedLoc = parseUrl(global.location.href);\n  let parsedFrom = parseUrl(from);\n  var parsedTo = parseUrl(to);\n\n  // Initial pushState doesn't provide `from` information\n  if (!parsedFrom.path) {\n    parsedFrom = parsedLoc;\n  }\n\n  // Use only the path component of the URL if the URL matches the current\n  // document (almost all the time when using pushState)\n  if (parsedLoc.protocol === parsedTo.protocol && parsedLoc.host === parsedTo.host) {\n    to = parsedTo.relative;\n  }\n  if (parsedLoc.protocol === parsedFrom.protocol && parsedLoc.host === parsedFrom.host) {\n    from = parsedFrom.relative;\n  }\n\n  getCurrentHub().addBreadcrumb({\n    category: 'navigation',\n    data: {\n      from,\n      to,\n    },\n  });\n}\n\nexport { BREADCRUMB_INTEGRATION_ID, Breadcrumbs };\n//# sourceMappingURL=breadcrumbs.js.map\n","import { BaseClient, SDK_VERSION, getCurrentHub, getEnvelopeEndpointWithUrlEncodedAuth } from '@sentry/core';\nimport { getGlobalObject, getEventDescription, logger, createClientReportEnvelope, dsnToString, serializeEnvelope } from '@sentry/utils';\nimport { eventFromException, eventFromMessage } from './eventbuilder.js';\nimport { BREADCRUMB_INTEGRATION_ID } from './integrations/breadcrumbs.js';\n\nvar globalObject = getGlobalObject();\n\n/**\n * The Sentry Browser SDK Client.\n *\n * @see BrowserOptions for documentation on configuration options.\n * @see SentryClient for usage documentation.\n */\nclass BrowserClient extends BaseClient {\n  /**\n   * Creates a new Browser SDK instance.\n   *\n   * @param options Configuration options for this SDK.\n   */\n   constructor(options) {\n    options._metadata = options._metadata || {};\n    options._metadata.sdk = options._metadata.sdk || {\n      name: 'sentry.javascript.browser',\n      packages: [\n        {\n          name: 'npm:@sentry/browser',\n          version: SDK_VERSION,\n        },\n      ],\n      version: SDK_VERSION,\n    };\n\n    super(options);\n\n    if (options.sendClientReports && globalObject.document) {\n      globalObject.document.addEventListener('visibilitychange', () => {\n        if (globalObject.document.visibilityState === 'hidden') {\n          this._flushOutcomes();\n        }\n      });\n    }\n  }\n\n  /**\n   * @inheritDoc\n   */\n   eventFromException(exception, hint) {\n    return eventFromException(this._options.stackParser, exception, hint, this._options.attachStacktrace);\n  }\n\n  /**\n   * @inheritDoc\n   */\n   eventFromMessage(\n    message,\n    // eslint-disable-next-line deprecation/deprecation\n    level = 'info',\n    hint,\n  ) {\n    return eventFromMessage(this._options.stackParser, message, level, hint, this._options.attachStacktrace);\n  }\n\n  /**\n   * @inheritDoc\n   */\n   sendEvent(event, hint) {\n    // We only want to add the sentry event breadcrumb when the user has the breadcrumb integration installed and\n    // activated its `sentry` option.\n    // We also do not want to use the `Breadcrumbs` class here directly, because we do not want it to be included in\n    // bundles, if it is not used by the SDK.\n    // This all sadly is a bit ugly, but we currently don't have a \"pre-send\" hook on the integrations so we do it this\n    // way for now.\n    var breadcrumbIntegration = this.getIntegrationById(BREADCRUMB_INTEGRATION_ID) ;\n    if (\n      breadcrumbIntegration &&\n      // We check for definedness of `options`, even though it is not strictly necessary, because that access to\n      // `.sentry` below does not throw, in case users provided their own integration with id \"Breadcrumbs\" that does\n      // not have an`options` field\n      breadcrumbIntegration.options &&\n      breadcrumbIntegration.options.sentry\n    ) {\n      getCurrentHub().addBreadcrumb(\n        {\n          category: `sentry.${event.type === 'transaction' ? 'transaction' : 'event'}`,\n          event_id: event.event_id,\n          level: event.level,\n          message: getEventDescription(event),\n        },\n        {\n          event,\n        },\n      );\n    }\n\n    super.sendEvent(event, hint);\n  }\n\n  /**\n   * @inheritDoc\n   */\n   _prepareEvent(event, hint, scope) {\n    event.platform = event.platform || 'javascript';\n    return super._prepareEvent(event, hint, scope);\n  }\n\n  /**\n   * Sends client reports as an envelope.\n   */\n   _flushOutcomes() {\n    var outcomes = this._clearOutcomes();\n\n    if (outcomes.length === 0) {\n      (typeof __SENTRY_DEBUG__ === 'undefined' || __SENTRY_DEBUG__) && logger.log('No outcomes to send');\n      return;\n    }\n\n    if (!this._dsn) {\n      (typeof __SENTRY_DEBUG__ === 'undefined' || __SENTRY_DEBUG__) && logger.log('No dsn provided, will not send outcomes');\n      return;\n    }\n\n    (typeof __SENTRY_DEBUG__ === 'undefined' || __SENTRY_DEBUG__) && logger.log('Sending outcomes:', outcomes);\n\n    var url = getEnvelopeEndpointWithUrlEncodedAuth(this._dsn, this._options);\n    var envelope = createClientReportEnvelope(outcomes, this._options.tunnel && dsnToString(this._dsn));\n\n    try {\n      var global = getGlobalObject();\n      var isRealNavigator = Object.prototype.toString.call(global && global.navigator) === '[object Navigator]';\n      var hasSendBeacon = isRealNavigator && typeof global.navigator.sendBeacon === 'function';\n      // Make sure beacon is not used if user configures custom transport options\n      if (hasSendBeacon && !this._options.transportOptions) {\n        // Prevent illegal invocations - https://xgwang.me/posts/you-may-not-know-beacon/#it-may-throw-error%2C-be-sure-to-catch\n        var sendBeacon = global.navigator.sendBeacon.bind(global.navigator);\n        sendBeacon(url, serializeEnvelope(envelope));\n      } else {\n        // If beacon is not supported or if they are using the tunnel option\n        // use our regular transport to send client reports to Sentry.\n        this._sendEnvelope(envelope);\n      }\n    } catch (e) {\n      (typeof __SENTRY_DEBUG__ === 'undefined' || __SENTRY_DEBUG__) && logger.error(e);\n    }\n  }\n}\n\nexport { BrowserClient };\n//# sourceMappingURL=client.js.map\n","import { getGlobalObject, isNativeFetch, logger } from '@sentry/utils';\n\nvar global = getGlobalObject();\nlet cachedFetchImpl;\n\n/**\n * A special usecase for incorrectly wrapped Fetch APIs in conjunction with ad-blockers.\n * Whenever someone wraps the Fetch API and returns the wrong promise chain,\n * this chain becomes orphaned and there is no possible way to capture it's rejections\n * other than allowing it bubble up to this very handler. eg.\n *\n * var f = window.fetch;\n * window.fetch = function () {\n *   var p = f.apply(this, arguments);\n *\n *   p.then(function() {\n *     console.log('hi.');\n *   });\n *\n *   return p;\n * }\n *\n * `p.then(function () { ... })` is producing a completely separate promise chain,\n * however, what's returned is `p` - the result of original `fetch` call.\n *\n * This mean, that whenever we use the Fetch API to send our own requests, _and_\n * some ad-blocker blocks it, this orphaned chain will _always_ reject,\n * effectively causing another event to be captured.\n * This makes a whole process become an infinite loop, which we need to somehow\n * deal with, and break it in one way or another.\n *\n * To deal with this issue, we are making sure that we _always_ use the real\n * browser Fetch API, instead of relying on what `window.fetch` exposes.\n * The only downside to this would be missing our own requests as breadcrumbs,\n * but because we are already not doing this, it should be just fine.\n *\n * Possible failed fetch error messages per-browser:\n *\n * Chrome:  Failed to fetch\n * Edge:    Failed to Fetch\n * Firefox: NetworkError when attempting to fetch resource\n * Safari:  resource blocked by content blocker\n */\nfunction getNativeFetchImplementation() {\n  if (cachedFetchImpl) {\n    return cachedFetchImpl;\n  }\n\n  /* eslint-disable @typescript-eslint/unbound-method */\n\n  // Fast path to avoid DOM I/O\n  if (isNativeFetch(global.fetch)) {\n    return (cachedFetchImpl = global.fetch.bind(global));\n  }\n\n  var document = global.document;\n  let fetchImpl = global.fetch;\n  // eslint-disable-next-line deprecation/deprecation\n  if (document && typeof document.createElement === 'function') {\n    try {\n      var sandbox = document.createElement('iframe');\n      sandbox.hidden = true;\n      document.head.appendChild(sandbox);\n      var contentWindow = sandbox.contentWindow;\n      if (contentWindow && contentWindow.fetch) {\n        fetchImpl = contentWindow.fetch;\n      }\n      document.head.removeChild(sandbox);\n    } catch (e) {\n      (typeof __SENTRY_DEBUG__ === 'undefined' || __SENTRY_DEBUG__) &&\n        logger.warn('Could not create sandbox iframe for pure fetch check, bailing to window.fetch: ', e);\n    }\n  }\n\n  return (cachedFetchImpl = fetchImpl.bind(global));\n  /* eslint-enable @typescript-eslint/unbound-method */\n}\n\nexport { getNativeFetchImplementation };\n//# sourceMappingURL=utils.js.map\n","import { createTransport } from '@sentry/core';\nimport { getNativeFetchImplementation } from './utils.js';\n\n/**\n * Creates a Transport that uses the Fetch API to send events to Sentry.\n */\nfunction makeFetchTransport(\n  options,\n  nativeFetch = getNativeFetchImplementation(),\n) {\n  function makeRequest(request) {\n    var requestOptions = {\n      body: request.body,\n      method: 'POST',\n      referrerPolicy: 'origin',\n      headers: options.headers,\n      // Outgoing requests are usually cancelled when navigating to a different page, causing a \"TypeError: Failed to\n      // fetch\" error and sending a \"network_error\" client-outcome - in Chrome, the request status shows \"(cancelled)\".\n      // The `keepalive` flag keeps outgoing requests alive, even when switching pages. We want this since we're\n      // frequently sending events right before the user is switching pages (eg. whenfinishing navigation transactions).\n      // Gotchas:\n      // - `keepalive` isn't supported by Firefox\n      // - As per spec (https://fetch.spec.whatwg.org/#http-network-or-cache-fetch), a request with `keepalive: true`\n      //   and a content length of > 64 kibibytes returns a network error. We will therefore only activate the flag when\n      //   we're below that limit.\n      keepalive: request.body.length <= 65536,\n      ...options.fetchOptions,\n    };\n\n    return nativeFetch(options.url, requestOptions).then(response => ({\n      statusCode: response.status,\n      headers: {\n        'x-sentry-rate-limits': response.headers.get('X-Sentry-Rate-Limits'),\n        'retry-after': response.headers.get('Retry-After'),\n      },\n    }));\n  }\n\n  return createTransport(options, makeRequest);\n}\n\nexport { makeFetchTransport };\n//# sourceMappingURL=fetch.js.map\n","import { createTransport } from '@sentry/core';\nimport { SyncPromise } from '@sentry/utils';\n\n/**\n * The DONE ready state for XmlHttpRequest\n *\n * Defining it here as a constant b/c XMLHttpRequest.DONE is not always defined\n * (e.g. during testing, it is `undefined`)\n *\n * @see {@link https://developer.mozilla.org/en-US/docs/Web/API/XMLHttpRequest/readyState}\n */\nvar XHR_READYSTATE_DONE = 4;\n\n/**\n * Creates a Transport that uses the XMLHttpRequest API to send events to Sentry.\n */\nfunction makeXHRTransport(options) {\n  function makeRequest(request) {\n    return new SyncPromise((resolve, reject) => {\n      var xhr = new XMLHttpRequest();\n\n      xhr.onerror = reject;\n\n      xhr.onreadystatechange = () => {\n        if (xhr.readyState === XHR_READYSTATE_DONE) {\n          resolve({\n            statusCode: xhr.status,\n            headers: {\n              'x-sentry-rate-limits': xhr.getResponseHeader('X-Sentry-Rate-Limits'),\n              'retry-after': xhr.getResponseHeader('Retry-After'),\n            },\n          });\n        }\n      };\n\n      xhr.open('POST', options.url);\n\n      for (var header in options.headers) {\n        if (Object.prototype.hasOwnProperty.call(options.headers, header)) {\n          xhr.setRequestHeader(header, options.headers[header]);\n        }\n      }\n\n      xhr.send(request.body);\n    });\n  }\n\n  return createTransport(options, makeRequest);\n}\n\nexport { makeXHRTransport };\n//# sourceMappingURL=xhr.js.map\n","import { createStackParser } from '@sentry/utils';\n\n// global reference to slice\nvar UNKNOWN_FUNCTION = '?';\n\nvar OPERA10_PRIORITY = 10;\nvar OPERA11_PRIORITY = 20;\nvar CHROME_PRIORITY = 30;\nvar WINJS_PRIORITY = 40;\nvar GECKO_PRIORITY = 50;\n\nfunction createFrame(filename, func, lineno, colno) {\n  var frame = {\n    filename,\n    function: func,\n    // All browser frames are considered in_app\n    in_app: true,\n  };\n\n  if (lineno !== undefined) {\n    frame.lineno = lineno;\n  }\n\n  if (colno !== undefined) {\n    frame.colno = colno;\n  }\n\n  return frame;\n}\n\n// Chromium based browsers: Chrome, Brave, new Opera, new Edge\nvar chromeRegex =\n  /^\\s*at (?:(.*\\).*?|.*?) ?\\((?:address at )?)?((?:file|https?|blob|chrome-extension|address|native|eval|webpack|<anonymous>|[-a-z]+:|.*bundle|\\/)?.*?)(?::(\\d+))?(?::(\\d+))?\\)?\\s*$/i;\nvar chromeEvalRegex = /\\((\\S*)(?::(\\d+))(?::(\\d+))\\)/;\n\nvar chrome = line => {\n  var parts = chromeRegex.exec(line);\n\n  if (parts) {\n    var isEval = parts[2] && parts[2].indexOf('eval') === 0; // start of line\n\n    if (isEval) {\n      var subMatch = chromeEvalRegex.exec(parts[2]);\n\n      if (subMatch) {\n        // throw out eval line/column and use top-most line/column number\n        parts[2] = subMatch[1]; // url\n        parts[3] = subMatch[2]; // line\n        parts[4] = subMatch[3]; // column\n      }\n    }\n\n    // Kamil: One more hack won't hurt us right? Understanding and adding more rules on top of these regexps right now\n    // would be way too time consuming. (TODO: Rewrite whole RegExp to be more readable)\n    const [func, filename] = extractSafariExtensionDetails(parts[1] || UNKNOWN_FUNCTION, parts[2]);\n\n    return createFrame(filename, func, parts[3] ? +parts[3] : undefined, parts[4] ? +parts[4] : undefined);\n  }\n\n  return;\n};\n\nvar chromeStackLineParser = [CHROME_PRIORITY, chrome];\n\n// gecko regex: `(?:bundle|\\d+\\.js)`: `bundle` is for react native, `\\d+\\.js` also but specifically for ram bundles because it\n// generates filenames without a prefix like `file://` the filenames in the stacktrace are just 42.js\n// We need this specific case for now because we want no other regex to match.\nvar geckoREgex =\n  /^\\s*(.*?)(?:\\((.*?)\\))?(?:^|@)?((?:file|https?|blob|chrome|webpack|resource|moz-extension|safari-extension|safari-web-extension|capacitor)?:\\/.*?|\\[native code\\]|[^@]*(?:bundle|\\d+\\.js)|\\/[\\w\\-. /=]+)(?::(\\d+))?(?::(\\d+))?\\s*$/i;\nvar geckoEvalRegex = /(\\S+) line (\\d+)(?: > eval line \\d+)* > eval/i;\n\nvar gecko = line => {\n  var parts = geckoREgex.exec(line);\n\n  if (parts) {\n    var isEval = parts[3] && parts[3].indexOf(' > eval') > -1;\n    if (isEval) {\n      var subMatch = geckoEvalRegex.exec(parts[3]);\n\n      if (subMatch) {\n        // throw out eval line/column and use top-most line number\n        parts[1] = parts[1] || 'eval';\n        parts[3] = subMatch[1];\n        parts[4] = subMatch[2];\n        parts[5] = ''; // no column when eval\n      }\n    }\n\n    let filename = parts[3];\n    let func = parts[1] || UNKNOWN_FUNCTION;\n    [func, filename] = extractSafariExtensionDetails(func, filename);\n\n    return createFrame(filename, func, parts[4] ? +parts[4] : undefined, parts[5] ? +parts[5] : undefined);\n  }\n\n  return;\n};\n\nvar geckoStackLineParser = [GECKO_PRIORITY, gecko];\n\nvar winjsRegex =\n  /^\\s*at (?:((?:\\[object object\\])?.+) )?\\(?((?:file|ms-appx|https?|webpack|blob):.*?):(\\d+)(?::(\\d+))?\\)?\\s*$/i;\n\nvar winjs = line => {\n  var parts = winjsRegex.exec(line);\n\n  return parts\n    ? createFrame(parts[2], parts[1] || UNKNOWN_FUNCTION, +parts[3], parts[4] ? +parts[4] : undefined)\n    : undefined;\n};\n\nvar winjsStackLineParser = [WINJS_PRIORITY, winjs];\n\nvar opera10Regex = / line (\\d+).*script (?:in )?(\\S+)(?:: in function (\\S+))?$/i;\n\nvar opera10 = line => {\n  var parts = opera10Regex.exec(line);\n  return parts ? createFrame(parts[2], parts[3] || UNKNOWN_FUNCTION, +parts[1]) : undefined;\n};\n\nvar opera10StackLineParser = [OPERA10_PRIORITY, opera10];\n\nvar opera11Regex =\n  / line (\\d+), column (\\d+)\\s*(?:in (?:<anonymous function: ([^>]+)>|([^)]+))\\(.*\\))? in (.*):\\s*$/i;\n\nvar opera11 = line => {\n  var parts = opera11Regex.exec(line);\n  return parts ? createFrame(parts[5], parts[3] || parts[4] || UNKNOWN_FUNCTION, +parts[1], +parts[2]) : undefined;\n};\n\nvar opera11StackLineParser = [OPERA11_PRIORITY, opera11];\n\nvar defaultStackLineParsers = [chromeStackLineParser, geckoStackLineParser, winjsStackLineParser];\n\nvar defaultStackParser = createStackParser(...defaultStackLineParsers);\n\n/**\n * Safari web extensions, starting version unknown, can produce \"frames-only\" stacktraces.\n * What it means, is that instead of format like:\n *\n * Error: wat\n *   at function@url:row:col\n *   at function@url:row:col\n *   at function@url:row:col\n *\n * it produces something like:\n *\n *   function@url:row:col\n *   function@url:row:col\n *   function@url:row:col\n *\n * Because of that, it won't be captured by `chrome` RegExp and will fall into `Gecko` branch.\n * This function is extracted so that we can use it in both places without duplicating the logic.\n * Unfortunately \"just\" changing RegExp is too complicated now and making it pass all tests\n * and fix this case seems like an impossible, or at least way too time-consuming task.\n */\nvar extractSafariExtensionDetails = (func, filename) => {\n  var isSafariExtension = func.indexOf('safari-extension') !== -1;\n  var isSafariWebExtension = func.indexOf('safari-web-extension') !== -1;\n\n  return isSafariExtension || isSafariWebExtension\n    ? [\n        func.indexOf('@') !== -1 ? func.split('@')[0] : UNKNOWN_FUNCTION,\n        isSafariExtension ? `safari-extension:${filename}` : `safari-web-extension:${filename}`,\n      ]\n    : [func, filename];\n};\n\nexport { chromeStackLineParser, defaultStackLineParsers, defaultStackParser, geckoStackLineParser, opera10StackLineParser, opera11StackLineParser, winjsStackLineParser };\n//# sourceMappingURL=stack-parsers.js.map\n","import { withScope, captureException } from '@sentry/core';\nimport { getOriginalFunction, addExceptionTypeValue, addExceptionMechanism, markFunctionWrapped, addNonEnumerableProperty } from '@sentry/utils';\n\nlet ignoreOnError = 0;\n\n/**\n * @hidden\n */\nfunction shouldIgnoreOnError() {\n  return ignoreOnError > 0;\n}\n\n/**\n * @hidden\n */\nfunction ignoreNextOnError() {\n  // onerror should trigger before setTimeout\n  ignoreOnError += 1;\n  setTimeout(() => {\n    ignoreOnError -= 1;\n  });\n}\n\n/**\n * Instruments the given function and sends an event to Sentry every time the\n * function throws an exception.\n *\n * @param fn A function to wrap. It is generally safe to pass an unbound function, because the returned wrapper always\n * has a correct `this` context.\n * @returns The wrapped function.\n * @hidden\n */\nfunction wrap(\n  fn,\n  options\n\n = {},\n  before,\n  // eslint-disable-next-line @typescript-eslint/no-explicit-any\n) {\n  // for future readers what this does is wrap a function and then create\n  // a bi-directional wrapping between them.\n  //\n  // example: wrapped = wrap(original);\n  //  original.__sentry_wrapped__ -> wrapped\n  //  wrapped.__sentry_original__ -> original\n\n  if (typeof fn !== 'function') {\n    return fn;\n  }\n\n  try {\n    // if we're dealing with a function that was previously wrapped, return\n    // the original wrapper.\n    var wrapper = fn.__sentry_wrapped__;\n    if (wrapper) {\n      return wrapper;\n    }\n\n    // We don't wanna wrap it twice\n    if (getOriginalFunction(fn)) {\n      return fn;\n    }\n  } catch (e) {\n    // Just accessing custom props in some Selenium environments\n    // can cause a \"Permission denied\" exception (see raven-js#495).\n    // Bail on wrapping and return the function as-is (defers to window.onerror).\n    return fn;\n  }\n\n  /* eslint-disable prefer-rest-params */\n  // It is important that `sentryWrapped` is not an arrow function to preserve the context of `this`\n  var sentryWrapped = function () {\n    var args = Array.prototype.slice.call(arguments);\n\n    try {\n      if (before && typeof before === 'function') {\n        before.apply(this, arguments);\n      }\n\n      // eslint-disable-next-line @typescript-eslint/no-explicit-any, @typescript-eslint/no-unsafe-member-access\n      var wrappedArguments = args.map((arg) => wrap(arg, options));\n\n      // Attempt to invoke user-land function\n      // NOTE: If you are a Sentry user, and you are seeing this stack frame, it\n      //       means the sentry.javascript SDK caught an error invoking your application code. This\n      //       is expected behavior and NOT indicative of a bug with sentry.javascript.\n      return fn.apply(this, wrappedArguments);\n    } catch (ex) {\n      ignoreNextOnError();\n\n      withScope((scope) => {\n        scope.addEventProcessor((event) => {\n          if (options.mechanism) {\n            addExceptionTypeValue(event, undefined, undefined);\n            addExceptionMechanism(event, options.mechanism);\n          }\n\n          event.extra = {\n            ...event.extra,\n            arguments: args,\n          };\n\n          return event;\n        });\n\n        captureException(ex);\n      });\n\n      throw ex;\n    }\n  };\n  /* eslint-enable prefer-rest-params */\n\n  // Accessing some objects may throw\n  // ref: https://github.com/getsentry/sentry-javascript/issues/1168\n  try {\n    for (var property in fn) {\n      if (Object.prototype.hasOwnProperty.call(fn, property)) {\n        sentryWrapped[property] = fn[property];\n      }\n    }\n  } catch (_oO) {} // eslint-disable-line no-empty\n\n  // Signal that this function has been wrapped/filled already\n  // for both debugging and to prevent it to being wrapped/filled twice\n  markFunctionWrapped(sentryWrapped, fn);\n\n  addNonEnumerableProperty(fn, '__sentry_wrapped__', sentryWrapped);\n\n  // Restore original function name (not all browsers allow that)\n  try {\n    var descriptor = Object.getOwnPropertyDescriptor(sentryWrapped, 'name') ;\n    if (descriptor.configurable) {\n      Object.defineProperty(sentryWrapped, 'name', {\n        get() {\n          return fn.name;\n        },\n      });\n    }\n    // eslint-disable-next-line no-empty\n  } catch (_oO) {}\n\n  return sentryWrapped;\n}\n\n/**\n * All properties the report dialog supports\n */\n\nexport { ignoreNextOnError, shouldIgnoreOnError, wrap };\n//# sourceMappingURL=helpers.js.map\n","import { getCurrentHub } from '@sentry/core';\nimport { addInstrumentationHandler, isString, isPrimitive, isErrorEvent, getLocationHref, logger, addExceptionMechanism } from '@sentry/utils';\nimport { eventFromUnknownInput } from '../eventbuilder.js';\nimport { shouldIgnoreOnError } from '../helpers.js';\n\n/* eslint-disable @typescript-eslint/no-unsafe-member-access */\n\n/** Global handlers */\nclass GlobalHandlers  {\n  /**\n   * @inheritDoc\n   */\n   static __initStatic() {this.id = 'GlobalHandlers';}\n\n  /**\n   * @inheritDoc\n   */\n   __init() {this.name = GlobalHandlers.id;}\n\n  /** JSDoc */\n\n  /**\n   * Stores references functions to installing handlers. Will set to undefined\n   * after they have been run so that they are not used twice.\n   */\n   __init2() {this._installFunc = {\n    onerror: _installGlobalOnErrorHandler,\n    onunhandledrejection: _installGlobalOnUnhandledRejectionHandler,\n  };}\n\n  /** JSDoc */\n   constructor(options) {;GlobalHandlers.prototype.__init.call(this);GlobalHandlers.prototype.__init2.call(this);\n    this._options = {\n      onerror: true,\n      onunhandledrejection: true,\n      ...options,\n    };\n  }\n  /**\n   * @inheritDoc\n   */\n   setupOnce() {\n    Error.stackTraceLimit = 50;\n    var options = this._options;\n\n    // We can disable guard-for-in as we construct the options object above + do checks against\n    // `this._installFunc` for the property.\n    // eslint-disable-next-line guard-for-in\n    for (var key in options) {\n      var installFunc = this._installFunc[key ];\n      if (installFunc && options[key ]) {\n        globalHandlerLog(key);\n        installFunc();\n        this._installFunc[key ] = undefined;\n      }\n    }\n  }\n} GlobalHandlers.__initStatic();\n\n/** JSDoc */\nfunction _installGlobalOnErrorHandler() {\n  addInstrumentationHandler(\n    'error',\n    // eslint-disable-next-line @typescript-eslint/no-explicit-any\n    (data) => {\n      const [hub, stackParser, attachStacktrace] = getHubAndOptions();\n      if (!hub.getIntegration(GlobalHandlers)) {\n        return;\n      }\n      const { msg, url, line, column, error } = data;\n      if (shouldIgnoreOnError() || (error && error.__sentry_own_request__)) {\n        return;\n      }\n\n      var event =\n        error === undefined && isString(msg)\n          ? _eventFromIncompleteOnError(msg, url, line, column)\n          : _enhanceEventWithInitialFrame(\n              eventFromUnknownInput(stackParser, error || msg, undefined, attachStacktrace, false),\n              url,\n              line,\n              column,\n            );\n\n      event.level = 'error';\n\n      addMechanismAndCapture(hub, error, event, 'onerror');\n    },\n  );\n}\n\n/** JSDoc */\nfunction _installGlobalOnUnhandledRejectionHandler() {\n  addInstrumentationHandler(\n    'unhandledrejection',\n    // eslint-disable-next-line @typescript-eslint/no-explicit-any\n    (e) => {\n      const [hub, stackParser, attachStacktrace] = getHubAndOptions();\n      if (!hub.getIntegration(GlobalHandlers)) {\n        return;\n      }\n      let error = e;\n\n      // dig the object of the rejection out of known event types\n      try {\n        // PromiseRejectionEvents store the object of the rejection under 'reason'\n        // see https://developer.mozilla.org/en-US/docs/Web/API/PromiseRejectionEvent\n        if ('reason' in e) {\n          error = e.reason;\n        }\n        // something, somewhere, (likely a browser extension) effectively casts PromiseRejectionEvents\n        // to CustomEvents, moving the `promise` and `reason` attributes of the PRE into\n        // the CustomEvent's `detail` attribute, since they're not part of CustomEvent's spec\n        // see https://developer.mozilla.org/en-US/docs/Web/API/CustomEvent and\n        // https://github.com/getsentry/sentry-javascript/issues/2380\n        else if ('detail' in e && 'reason' in e.detail) {\n          error = e.detail.reason;\n        }\n      } catch (_oO) {\n        // no-empty\n      }\n\n      if (shouldIgnoreOnError() || (error && error.__sentry_own_request__)) {\n        return true;\n      }\n\n      var event = isPrimitive(error)\n        ? _eventFromRejectionWithPrimitive(error)\n        : eventFromUnknownInput(stackParser, error, undefined, attachStacktrace, true);\n\n      event.level = 'error';\n\n      addMechanismAndCapture(hub, error, event, 'onunhandledrejection');\n      return;\n    },\n  );\n}\n\n/**\n * Create an event from a promise rejection where the `reason` is a primitive.\n *\n * @param reason: The `reason` property of the promise rejection\n * @returns An Event object with an appropriate `exception` value\n */\nfunction _eventFromRejectionWithPrimitive(reason) {\n  return {\n    exception: {\n      values: [\n        {\n          type: 'UnhandledRejection',\n          // String() is needed because the Primitive type includes symbols (which can't be automatically stringified)\n          value: `Non-Error promise rejection captured with value: ${String(reason)}`,\n        },\n      ],\n    },\n  };\n}\n\n/**\n * This function creates a stack from an old, error-less onerror handler.\n */\n// eslint-disable-next-line @typescript-eslint/no-explicit-any\nfunction _eventFromIncompleteOnError(msg, url, line, column) {\n  var ERROR_TYPES_RE =\n    /^(?:[Uu]ncaught (?:exception: )?)?(?:((?:Eval|Internal|Range|Reference|Syntax|Type|URI|)Error): )?(.*)$/i;\n\n  // If 'message' is ErrorEvent, get real message from inside\n  let message = isErrorEvent(msg) ? msg.message : msg;\n  let name = 'Error';\n\n  var groups = message.match(ERROR_TYPES_RE);\n  if (groups) {\n    name = groups[1];\n    message = groups[2];\n  }\n\n  var event = {\n    exception: {\n      values: [\n        {\n          type: name,\n          value: message,\n        },\n      ],\n    },\n  };\n\n  return _enhanceEventWithInitialFrame(event, url, line, column);\n}\n\n/** JSDoc */\n// eslint-disable-next-line @typescript-eslint/no-explicit-any\nfunction _enhanceEventWithInitialFrame(event, url, line, column) {\n  // event.exception\n  var e = (event.exception = event.exception || {});\n  // event.exception.values\n  var ev = (e.values = e.values || []);\n  // event.exception.values[0]\n  var ev0 = (ev[0] = ev[0] || {});\n  // event.exception.values[0].stacktrace\n  var ev0s = (ev0.stacktrace = ev0.stacktrace || {});\n  // event.exception.values[0].stacktrace.frames\n  var ev0sf = (ev0s.frames = ev0s.frames || []);\n\n  var colno = isNaN(parseInt(column, 10)) ? undefined : column;\n  var lineno = isNaN(parseInt(line, 10)) ? undefined : line;\n  var filename = isString(url) && url.length > 0 ? url : getLocationHref();\n\n  // event.exception.values[0].stacktrace.frames\n  if (ev0sf.length === 0) {\n    ev0sf.push({\n      colno,\n      filename,\n      function: '?',\n      in_app: true,\n      lineno,\n    });\n  }\n\n  return event;\n}\n\nfunction globalHandlerLog(type) {\n  (typeof __SENTRY_DEBUG__ === 'undefined' || __SENTRY_DEBUG__) && logger.log(`Global Handler attached: ${type}`);\n}\n\nfunction addMechanismAndCapture(hub, error, event, type) {\n  addExceptionMechanism(event, {\n    handled: false,\n    type,\n  });\n  hub.captureEvent(event, {\n    originalException: error,\n  });\n}\n\nfunction getHubAndOptions() {\n  var hub = getCurrentHub();\n  var client = hub.getClient();\n  var options = (client && client.getOptions()) || {\n    stackParser: () => [],\n    attachStacktrace: false,\n  };\n  return [hub, options.stackParser, options.attachStacktrace];\n}\n\nexport { GlobalHandlers };\n//# sourceMappingURL=globalhandlers.js.map\n","import { getGlobalObject, fill, getFunctionName, getOriginalFunction } from '@sentry/utils';\nimport { wrap } from '../helpers.js';\n\nvar DEFAULT_EVENT_TARGET = [\n  'EventTarget',\n  'Window',\n  'Node',\n  'ApplicationCache',\n  'AudioTrackList',\n  'ChannelMergerNode',\n  'CryptoOperation',\n  'EventSource',\n  'FileReader',\n  'HTMLUnknownElement',\n  'IDBDatabase',\n  'IDBRequest',\n  'IDBTransaction',\n  'KeyOperation',\n  'MediaController',\n  'MessagePort',\n  'ModalWindow',\n  'Notification',\n  'SVGElementInstance',\n  'Screen',\n  'TextTrack',\n  'TextTrackCue',\n  'TextTrackList',\n  'WebSocket',\n  'WebSocketWorker',\n  'Worker',\n  'XMLHttpRequest',\n  'XMLHttpRequestEventTarget',\n  'XMLHttpRequestUpload',\n];\n\n/** Wrap timer functions and event targets to catch errors and provide better meta data */\nclass TryCatch  {\n  /**\n   * @inheritDoc\n   */\n   static __initStatic() {this.id = 'TryCatch';}\n\n  /**\n   * @inheritDoc\n   */\n   __init() {this.name = TryCatch.id;}\n\n  /** JSDoc */\n\n  /**\n   * @inheritDoc\n   */\n   constructor(options) {;TryCatch.prototype.__init.call(this);\n    this._options = {\n      XMLHttpRequest: true,\n      eventTarget: true,\n      requestAnimationFrame: true,\n      setInterval: true,\n      setTimeout: true,\n      ...options,\n    };\n  }\n\n  /**\n   * Wrap timer functions and event targets to catch errors\n   * and provide better metadata.\n   */\n   setupOnce() {\n    var global = getGlobalObject();\n\n    if (this._options.setTimeout) {\n      fill(global, 'setTimeout', _wrapTimeFunction);\n    }\n\n    if (this._options.setInterval) {\n      fill(global, 'setInterval', _wrapTimeFunction);\n    }\n\n    if (this._options.requestAnimationFrame) {\n      fill(global, 'requestAnimationFrame', _wrapRAF);\n    }\n\n    if (this._options.XMLHttpRequest && 'XMLHttpRequest' in global) {\n      fill(XMLHttpRequest.prototype, 'send', _wrapXHR);\n    }\n\n    var eventTargetOption = this._options.eventTarget;\n    if (eventTargetOption) {\n      var eventTarget = Array.isArray(eventTargetOption) ? eventTargetOption : DEFAULT_EVENT_TARGET;\n      eventTarget.forEach(_wrapEventTarget);\n    }\n  }\n} TryCatch.__initStatic();\n\n/** JSDoc */\nfunction _wrapTimeFunction(original) {\n  // eslint-disable-next-line @typescript-eslint/no-explicit-any\n  return function ( ...args) {\n    var originalCallback = args[0];\n    args[0] = wrap(originalCallback, {\n      mechanism: {\n        data: { function: getFunctionName(original) },\n        handled: true,\n        type: 'instrument',\n      },\n    });\n    return original.apply(this, args);\n  };\n}\n\n/** JSDoc */\n// eslint-disable-next-line @typescript-eslint/no-explicit-any\nfunction _wrapRAF(original) {\n  // eslint-disable-next-line @typescript-eslint/no-explicit-any\n  return function ( callback) {\n    // eslint-disable-next-line @typescript-eslint/no-unsafe-member-access\n    return original.apply(this, [\n      wrap(callback, {\n        mechanism: {\n          data: {\n            function: 'requestAnimationFrame',\n            handler: getFunctionName(original),\n          },\n          handled: true,\n          type: 'instrument',\n        },\n      }),\n    ]);\n  };\n}\n\n/** JSDoc */\nfunction _wrapXHR(originalSend) {\n  // eslint-disable-next-line @typescript-eslint/no-explicit-any\n  return function ( ...args) {\n    // eslint-disable-next-line @typescript-eslint/no-this-alias\n    var xhr = this;\n    var xmlHttpRequestProps = ['onload', 'onerror', 'onprogress', 'onreadystatechange'];\n\n    xmlHttpRequestProps.forEach(prop => {\n      if (prop in xhr && typeof xhr[prop] === 'function') {\n        // eslint-disable-next-line @typescript-eslint/no-explicit-any\n        fill(xhr, prop, function (original) {\n          var wrapOptions = {\n            mechanism: {\n              data: {\n                function: prop,\n                handler: getFunctionName(original),\n              },\n              handled: true,\n              type: 'instrument',\n            },\n          };\n\n          // If Instrument integration has been called before TryCatch, get the name of original function\n          var originalFunction = getOriginalFunction(original);\n          if (originalFunction) {\n            wrapOptions.mechanism.data.handler = getFunctionName(originalFunction);\n          }\n\n          // Otherwise wrap directly\n          return wrap(original, wrapOptions);\n        });\n      }\n    });\n\n    return originalSend.apply(this, args);\n  };\n}\n\n/** JSDoc */\nfunction _wrapEventTarget(target) {\n  // eslint-disable-next-line @typescript-eslint/no-explicit-any\n  var global = getGlobalObject() ;\n  // eslint-disable-next-line @typescript-eslint/no-unsafe-member-access\n  var proto = global[target] && global[target].prototype;\n\n  // eslint-disable-next-line @typescript-eslint/no-unsafe-member-access, no-prototype-builtins\n  if (!proto || !proto.hasOwnProperty || !proto.hasOwnProperty('addEventListener')) {\n    return;\n  }\n\n  fill(proto, 'addEventListener', function (original)\n\n {\n    return function (\n      // eslint-disable-next-line @typescript-eslint/no-explicit-any\n\n      eventName,\n      fn,\n      options,\n    ) {\n      try {\n        if (typeof fn.handleEvent === 'function') {\n          // ESlint disable explanation:\n          //  First, it is generally safe to call `wrap` with an unbound function. Furthermore, using `.bind()` would\n          //  introduce a bug here, because bind returns a new function that doesn't have our\n          //  flags(like __sentry_original__) attached. `wrap` checks for those flags to avoid unnecessary wrapping.\n          //  Without those flags, every call to addEventListener wraps the function again, causing a memory leak.\n          // eslint-disable-next-line @typescript-eslint/unbound-method\n          fn.handleEvent = wrap(fn.handleEvent, {\n            mechanism: {\n              data: {\n                function: 'handleEvent',\n                handler: getFunctionName(fn),\n                target,\n              },\n              handled: true,\n              type: 'instrument',\n            },\n          });\n        }\n      } catch (err) {\n        // can sometimes get 'Permission denied to access property \"handle Event'\n      }\n\n      return original.apply(this, [\n        eventName,\n        // eslint-disable-next-line @typescript-eslint/no-explicit-any\n        wrap(fn , {\n          mechanism: {\n            data: {\n              function: 'addEventListener',\n              handler: getFunctionName(fn),\n              target,\n            },\n            handled: true,\n            type: 'instrument',\n          },\n        }),\n        options,\n      ]);\n    };\n  });\n\n  fill(\n    proto,\n    'removeEventListener',\n    function (\n      originalRemoveEventListener,\n      // eslint-disable-next-line @typescript-eslint/no-explicit-any\n    ) {\n      return function (\n        // eslint-disable-next-line @typescript-eslint/no-explicit-any\n\n        eventName,\n        fn,\n        options,\n      ) {\n        /**\n         * There are 2 possible scenarios here:\n         *\n         * 1. Someone passes a callback, which was attached prior to Sentry initialization, or by using unmodified\n         * method, eg. `document.addEventListener.call(el, name, handler). In this case, we treat this function\n         * as a pass-through, and call original `removeEventListener` with it.\n         *\n         * 2. Someone passes a callback, which was attached after Sentry was initialized, which means that it was using\n         * our wrapped version of `addEventListener`, which internally calls `wrap` helper.\n         * This helper \"wraps\" whole callback inside a try/catch statement, and attached appropriate metadata to it,\n         * in order for us to make a distinction between wrapped/non-wrapped functions possible.\n         * If a function was wrapped, it has additional property of `__sentry_wrapped__`, holding the handler.\n         *\n         * When someone adds a handler prior to initialization, and then do it again, but after,\n         * then we have to detach both of them. Otherwise, if we'd detach only wrapped one, it'd be impossible\n         * to get rid of the initial handler and it'd stick there forever.\n         */\n        var wrappedEventHandler = fn ;\n        try {\n          var originalEventHandler = wrappedEventHandler && wrappedEventHandler.__sentry_wrapped__;\n          if (originalEventHandler) {\n            originalRemoveEventListener.call(this, eventName, originalEventHandler, options);\n          }\n        } catch (e) {\n          // ignore, accessing __sentry_wrapped__ will throw in some Selenium environments\n        }\n        return originalRemoveEventListener.call(this, eventName, wrappedEventHandler, options);\n      };\n    },\n  );\n}\n\nexport { TryCatch };\n//# sourceMappingURL=trycatch.js.map\n","import { getCurrentHub, addGlobalEventProcessor } from '@sentry/core';\nimport { isInstanceOf } from '@sentry/utils';\nimport { exceptionFromError } from '../eventbuilder.js';\n\nvar DEFAULT_KEY = 'cause';\nvar DEFAULT_LIMIT = 5;\n\n/** Adds SDK info to an event. */\nclass LinkedErrors  {\n  /**\n   * @inheritDoc\n   */\n   static __initStatic() {this.id = 'LinkedErrors';}\n\n  /**\n   * @inheritDoc\n   */\n    __init() {this.name = LinkedErrors.id;}\n\n  /**\n   * @inheritDoc\n   */\n\n  /**\n   * @inheritDoc\n   */\n\n  /**\n   * @inheritDoc\n   */\n   constructor(options = {}) {;LinkedErrors.prototype.__init.call(this);\n    this._key = options.key || DEFAULT_KEY;\n    this._limit = options.limit || DEFAULT_LIMIT;\n  }\n\n  /**\n   * @inheritDoc\n   */\n   setupOnce() {\n    var client = getCurrentHub().getClient();\n    if (!client) {\n      return;\n    }\n    addGlobalEventProcessor((event, hint) => {\n      var self = getCurrentHub().getIntegration(LinkedErrors);\n      return self ? _handler(client.getOptions().stackParser, self._key, self._limit, event, hint) : event;\n    });\n  }\n} LinkedErrors.__initStatic();\n\n/**\n * @inheritDoc\n */\nfunction _handler(\n  parser,\n  key,\n  limit,\n  event,\n  hint,\n) {\n  if (!event.exception || !event.exception.values || !hint || !isInstanceOf(hint.originalException, Error)) {\n    return event;\n  }\n  var linkedErrors = _walkErrorTree(parser, limit, hint.originalException , key);\n  event.exception.values = [...linkedErrors, ...event.exception.values];\n  return event;\n}\n\n/**\n * JSDOC\n */\nfunction _walkErrorTree(\n  parser,\n  limit,\n  error,\n  key,\n  stack = [],\n) {\n  if (!isInstanceOf(error[key], Error) || stack.length + 1 >= limit) {\n    return stack;\n  }\n  var exception = exceptionFromError(parser, error[key]);\n  return _walkErrorTree(parser, limit, error[key], key, [exception, ...stack]);\n}\n\nexport { LinkedErrors, _handler, _walkErrorTree };\n//# sourceMappingURL=linkederrors.js.map\n","import { addGlobalEventProcessor, getCurrentHub } from '@sentry/core';\nimport { getGlobalObject } from '@sentry/utils';\n\nvar global = getGlobalObject();\n\n/** HttpContext integration collects information about HTTP request headers */\nclass HttpContext  {constructor() { HttpContext.prototype.__init.call(this); }\n  /**\n   * @inheritDoc\n   */\n   static __initStatic() {this.id = 'HttpContext';}\n\n  /**\n   * @inheritDoc\n   */\n   __init() {this.name = HttpContext.id;}\n\n  /**\n   * @inheritDoc\n   */\n   setupOnce() {\n    addGlobalEventProcessor((event) => {\n      if (getCurrentHub().getIntegration(HttpContext)) {\n        // if none of the information we want exists, don't bother\n        if (!global.navigator && !global.location && !global.document) {\n          return event;\n        }\n\n        // grab as much info as exists and add it to the event\n        var url = (event.request && event.request.url) || (global.location && global.location.href);\n        const { referrer } = global.document || {};\n        const { userAgent } = global.navigator || {};\n\n        var headers = {\n          ...(event.request && event.request.headers),\n          ...(referrer && { Referer: referrer }),\n          ...(userAgent && { 'User-Agent': userAgent }),\n        };\n        var request = { ...(url && { url }), headers };\n\n        return { ...event, request };\n      }\n      return event;\n    });\n  }\n} HttpContext.__initStatic();\n\nexport { HttpContext };\n//# sourceMappingURL=httpcontext.js.map\n","import { logger } from '@sentry/utils';\n\n/** Deduplication filter */\nclass Dedupe  {constructor() { Dedupe.prototype.__init.call(this); }\n  /**\n   * @inheritDoc\n   */\n   static __initStatic() {this.id = 'Dedupe';}\n\n  /**\n   * @inheritDoc\n   */\n   __init() {this.name = Dedupe.id;}\n\n  /**\n   * @inheritDoc\n   */\n\n  /**\n   * @inheritDoc\n   */\n   setupOnce(addGlobalEventProcessor, getCurrentHub) {\n    var eventProcessor = currentEvent => {\n      var self = getCurrentHub().getIntegration(Dedupe);\n      if (self) {\n        // Juuust in case something goes wrong\n        try {\n          if (_shouldDropEvent(currentEvent, self._previousEvent)) {\n            (typeof __SENTRY_DEBUG__ === 'undefined' || __SENTRY_DEBUG__) && logger.warn('Event dropped due to being a duplicate of previously captured event.');\n            return null;\n          }\n        } catch (_oO) {\n          return (self._previousEvent = currentEvent);\n        }\n\n        return (self._previousEvent = currentEvent);\n      }\n      return currentEvent;\n    };\n\n    eventProcessor.id = this.name;\n    addGlobalEventProcessor(eventProcessor);\n  }\n} Dedupe.__initStatic();\n\n/** JSDoc */\nfunction _shouldDropEvent(currentEvent, previousEvent) {\n  if (!previousEvent) {\n    return false;\n  }\n\n  if (_isSameMessageEvent(currentEvent, previousEvent)) {\n    return true;\n  }\n\n  if (_isSameExceptionEvent(currentEvent, previousEvent)) {\n    return true;\n  }\n\n  return false;\n}\n\n/** JSDoc */\nfunction _isSameMessageEvent(currentEvent, previousEvent) {\n  var currentMessage = currentEvent.message;\n  var previousMessage = previousEvent.message;\n\n  // If neither event has a message property, they were both exceptions, so bail out\n  if (!currentMessage && !previousMessage) {\n    return false;\n  }\n\n  // If only one event has a stacktrace, but not the other one, they are not the same\n  if ((currentMessage && !previousMessage) || (!currentMessage && previousMessage)) {\n    return false;\n  }\n\n  if (currentMessage !== previousMessage) {\n    return false;\n  }\n\n  if (!_isSameFingerprint(currentEvent, previousEvent)) {\n    return false;\n  }\n\n  if (!_isSameStacktrace(currentEvent, previousEvent)) {\n    return false;\n  }\n\n  return true;\n}\n\n/** JSDoc */\nfunction _isSameExceptionEvent(currentEvent, previousEvent) {\n  var previousException = _getExceptionFromEvent(previousEvent);\n  var currentException = _getExceptionFromEvent(currentEvent);\n\n  if (!previousException || !currentException) {\n    return false;\n  }\n\n  if (previousException.type !== currentException.type || previousException.value !== currentException.value) {\n    return false;\n  }\n\n  if (!_isSameFingerprint(currentEvent, previousEvent)) {\n    return false;\n  }\n\n  if (!_isSameStacktrace(currentEvent, previousEvent)) {\n    return false;\n  }\n\n  return true;\n}\n\n/** JSDoc */\nfunction _isSameStacktrace(currentEvent, previousEvent) {\n  let currentFrames = _getFramesFromEvent(currentEvent);\n  let previousFrames = _getFramesFromEvent(previousEvent);\n\n  // If neither event has a stacktrace, they are assumed to be the same\n  if (!currentFrames && !previousFrames) {\n    return true;\n  }\n\n  // If only one event has a stacktrace, but not the other one, they are not the same\n  if ((currentFrames && !previousFrames) || (!currentFrames && previousFrames)) {\n    return false;\n  }\n\n  currentFrames = currentFrames ;\n  previousFrames = previousFrames ;\n\n  // If number of frames differ, they are not the same\n  if (previousFrames.length !== currentFrames.length) {\n    return false;\n  }\n\n  // Otherwise, compare the two\n  for (let i = 0; i < previousFrames.length; i++) {\n    var frameA = previousFrames[i];\n    var frameB = currentFrames[i];\n\n    if (\n      frameA.filename !== frameB.filename ||\n      frameA.lineno !== frameB.lineno ||\n      frameA.colno !== frameB.colno ||\n      frameA.function !== frameB.function\n    ) {\n      return false;\n    }\n  }\n\n  return true;\n}\n\n/** JSDoc */\nfunction _isSameFingerprint(currentEvent, previousEvent) {\n  let currentFingerprint = currentEvent.fingerprint;\n  let previousFingerprint = previousEvent.fingerprint;\n\n  // If neither event has a fingerprint, they are assumed to be the same\n  if (!currentFingerprint && !previousFingerprint) {\n    return true;\n  }\n\n  // If only one event has a fingerprint, but not the other one, they are not the same\n  if ((currentFingerprint && !previousFingerprint) || (!currentFingerprint && previousFingerprint)) {\n    return false;\n  }\n\n  currentFingerprint = currentFingerprint ;\n  previousFingerprint = previousFingerprint ;\n\n  // Otherwise, compare the two\n  try {\n    return !!(currentFingerprint.join('') === previousFingerprint.join(''));\n  } catch (_oO) {\n    return false;\n  }\n}\n\n/** JSDoc */\nfunction _getExceptionFromEvent(event) {\n  return event.exception && event.exception.values && event.exception.values[0];\n}\n\n/** JSDoc */\nfunction _getFramesFromEvent(event) {\n  var exception = event.exception;\n\n  if (exception) {\n    try {\n      // @ts-ignore Object could be undefined\n      return exception.values[0].stacktrace.frames;\n    } catch (_oO) {\n      return undefined;\n    }\n  }\n  return undefined;\n}\n\nexport { Dedupe };\n//# sourceMappingURL=dedupe.js.map\n","import { Integrations, getIntegrationsToSetup, initAndBind, getCurrentHub, getReportDialogEndpoint } from '@sentry/core';\nimport { getGlobalObject, stackParserFromStackParserOptions, supportsFetch, logger, resolvedSyncPromise, addInstrumentationHandler } from '@sentry/utils';\nimport { BrowserClient } from './client.js';\nimport { wrap as wrap$1 } from './helpers.js';\nimport './integrations/index.js';\nimport { defaultStackParser } from './stack-parsers.js';\nimport './transports/index.js';\nimport { TryCatch } from './integrations/trycatch.js';\nimport { Breadcrumbs } from './integrations/breadcrumbs.js';\nimport { GlobalHandlers } from './integrations/globalhandlers.js';\nimport { LinkedErrors } from './integrations/linkederrors.js';\nimport { Dedupe } from './integrations/dedupe.js';\nimport { HttpContext } from './integrations/httpcontext.js';\nimport { makeFetchTransport } from './transports/fetch.js';\nimport { makeXHRTransport } from './transports/xhr.js';\n\nvar defaultIntegrations = [\n  new Integrations.InboundFilters(),\n  new Integrations.FunctionToString(),\n  new TryCatch(),\n  new Breadcrumbs(),\n  new GlobalHandlers(),\n  new LinkedErrors(),\n  new Dedupe(),\n  new HttpContext(),\n];\n\n/**\n * The Sentry Browser SDK Client.\n *\n * To use this SDK, call the {@link init} function as early as possible when\n * loading the web page. To set context information or send manual events, use\n * the provided methods.\n *\n * @example\n *\n * ```\n *\n * import { init } from '@sentry/browser';\n *\n * init({\n *   dsn: '__DSN__',\n *   // ...\n * });\n * ```\n *\n * @example\n * ```\n *\n * import { configureScope } from '@sentry/browser';\n * configureScope((scope: Scope) => {\n *   scope.setExtra({ battery: 0.7 });\n *   scope.setTag({ user_mode: 'admin' });\n *   scope.setUser({ id: '4711' });\n * });\n * ```\n *\n * @example\n * ```\n *\n * import { addBreadcrumb } from '@sentry/browser';\n * addBreadcrumb({\n *   message: 'My Breadcrumb',\n *   // ...\n * });\n * ```\n *\n * @example\n *\n * ```\n *\n * import * as Sentry from '@sentry/browser';\n * Sentry.captureMessage('Hello, world!');\n * Sentry.captureException(new Error('Good bye'));\n * Sentry.captureEvent({\n *   message: 'Manual',\n *   stacktrace: [\n *     // ...\n *   ],\n * });\n * ```\n *\n * @see {@link BrowserOptions} for documentation on configuration options.\n */\nfunction init(options = {}) {\n  if (options.defaultIntegrations === undefined) {\n    options.defaultIntegrations = defaultIntegrations;\n  }\n  if (options.release === undefined) {\n    var window = getGlobalObject();\n    // This supports the variable that sentry-webpack-plugin injects\n    if (window.SENTRY_RELEASE && window.SENTRY_RELEASE.id) {\n      options.release = window.SENTRY_RELEASE.id;\n    }\n  }\n  if (options.autoSessionTracking === undefined) {\n    options.autoSessionTracking = true;\n  }\n  if (options.sendClientReports === undefined) {\n    options.sendClientReports = true;\n  }\n\n  var clientOptions = {\n    ...options,\n    stackParser: stackParserFromStackParserOptions(options.stackParser || defaultStackParser),\n    integrations: getIntegrationsToSetup(options),\n    transport: options.transport || (supportsFetch() ? makeFetchTransport : makeXHRTransport),\n  };\n\n  initAndBind(BrowserClient, clientOptions);\n\n  if (options.autoSessionTracking) {\n    startSessionTracking();\n  }\n}\n\n/**\n * Present the user with a report dialog.\n *\n * @param options Everything is optional, we try to fetch all info need from the global scope.\n */\nfunction showReportDialog(options = {}, hub = getCurrentHub()) {\n  // doesn't work without a document (React Native)\n  var global = getGlobalObject();\n  if (!global.document) {\n    (typeof __SENTRY_DEBUG__ === 'undefined' || __SENTRY_DEBUG__) && logger.error('Global document not defined in showReportDialog call');\n    return;\n  }\n\n  const { client, scope } = hub.getStackTop();\n  var dsn = options.dsn || (client && client.getDsn());\n  if (!dsn) {\n    (typeof __SENTRY_DEBUG__ === 'undefined' || __SENTRY_DEBUG__) && logger.error('DSN not configured for showReportDialog call');\n    return;\n  }\n\n  if (scope) {\n    options.user = {\n      ...scope.getUser(),\n      ...options.user,\n    };\n  }\n\n  if (!options.eventId) {\n    options.eventId = hub.lastEventId();\n  }\n\n  var script = global.document.createElement('script');\n  script.async = true;\n  script.src = getReportDialogEndpoint(dsn, options);\n\n  if (options.onLoad) {\n    // eslint-disable-next-line @typescript-eslint/unbound-method\n    script.onload = options.onLoad;\n  }\n\n  var injectionPoint = global.document.head || global.document.body;\n  if (injectionPoint) {\n    injectionPoint.appendChild(script);\n  } else {\n    (typeof __SENTRY_DEBUG__ === 'undefined' || __SENTRY_DEBUG__) && logger.error('Not injecting report dialog. No injection point found in HTML');\n  }\n}\n\n/**\n * This is the getter for lastEventId.\n *\n * @returns The last event id of a captured event.\n */\nfunction lastEventId() {\n  return getCurrentHub().lastEventId();\n}\n\n/**\n * This function is here to be API compatible with the loader.\n * @hidden\n */\nfunction forceLoad() {\n  // Noop\n}\n\n/**\n * This function is here to be API compatible with the loader.\n * @hidden\n */\nfunction onLoad(callback) {\n  callback();\n}\n\n/**\n * Call `flush()` on the current client, if there is one. See {@link Client.flush}.\n *\n * @param timeout Maximum time in ms the client should wait to flush its event queue. Omitting this parameter will cause\n * the client to wait until all events are sent before resolving the promise.\n * @returns A promise which resolves to `true` if the queue successfully drains before the timeout, or `false` if it\n * doesn't (or if there's no client defined).\n */\nfunction flush(timeout) {\n  var client = getCurrentHub().getClient();\n  if (client) {\n    return client.flush(timeout);\n  }\n  (typeof __SENTRY_DEBUG__ === 'undefined' || __SENTRY_DEBUG__) && logger.warn('Cannot flush events. No client defined.');\n  return resolvedSyncPromise(false);\n}\n\n/**\n * Call `close()` on the current client, if there is one. See {@link Client.close}.\n *\n * @param timeout Maximum time in ms the client should wait to flush its event queue before shutting down. Omitting this\n * parameter will cause the client to wait until all events are sent before disabling itself.\n * @returns A promise which resolves to `true` if the queue successfully drains before the timeout, or `false` if it\n * doesn't (or if there's no client defined).\n */\nfunction close(timeout) {\n  var client = getCurrentHub().getClient();\n  if (client) {\n    return client.close(timeout);\n  }\n  (typeof __SENTRY_DEBUG__ === 'undefined' || __SENTRY_DEBUG__) && logger.warn('Cannot flush events and disable SDK. No client defined.');\n  return resolvedSyncPromise(false);\n}\n\n/**\n * Wrap code within a try/catch block so the SDK is able to capture errors.\n *\n * @param fn A function to wrap.\n *\n * @returns The result of wrapped function call.\n */\n// eslint-disable-next-line @typescript-eslint/no-explicit-any\nfunction wrap(fn) {\n  return wrap$1(fn)();\n}\n\nfunction startSessionOnHub(hub) {\n  hub.startSession({ ignoreDuration: true });\n  hub.captureSession();\n}\n\n/**\n * Enable automatic Session Tracking for the initial page load.\n */\nfunction startSessionTracking() {\n  var window = getGlobalObject();\n  var document = window.document;\n\n  if (typeof document === 'undefined') {\n    (typeof __SENTRY_DEBUG__ === 'undefined' || __SENTRY_DEBUG__) &&\n      logger.warn('Session tracking in non-browser environment with @sentry/browser is not supported.');\n    return;\n  }\n\n  var hub = getCurrentHub();\n\n  // The only way for this to be false is for there to be a version mismatch between @sentry/browser (>= 6.0.0) and\n  // @sentry/hub (< 5.27.0). In the simple case, there won't ever be such a mismatch, because the two packages are\n  // pinned at the same version in package.json, but there are edge cases where it's possible. See\n  // https://github.com/getsentry/sentry-javascript/issues/3207 and\n  // https://github.com/getsentry/sentry-javascript/issues/3234 and\n  // https://github.com/getsentry/sentry-javascript/issues/3278.\n  if (!hub.captureSession) {\n    return;\n  }\n\n  // The session duration for browser sessions does not track a meaningful\n  // concept that can be used as a metric.\n  // Automatically captured sessions are akin to page views, and thus we\n  // discard their duration.\n  startSessionOnHub(hub);\n\n  // We want to create a session for every navigation as well\n  addInstrumentationHandler('history', ({ from, to }) => {\n    // Don't create an additional session for the initial route or if the location did not change\n    if (!(from === undefined || from === to)) {\n      startSessionOnHub(getCurrentHub());\n    }\n  });\n}\n\nexport { close, defaultIntegrations, flush, forceLoad, init, lastEventId, onLoad, showReportDialog, wrap };\n//# sourceMappingURL=sdk.js.map\n","import { SDK_VERSION, init as init$1 } from '@sentry/browser';\n\n/**\n * Inits the React SDK\n */\nfunction init(options) {\n  options._metadata = options._metadata || {};\n  options._metadata.sdk = options._metadata.sdk || {\n    name: 'sentry.javascript.react',\n    packages: [\n      {\n        name: 'npm:@sentry/react',\n        version: SDK_VERSION,\n      },\n    ],\n    version: SDK_VERSION,\n  };\n  init$1(options);\n}\n\nexport { init };\n//# sourceMappingURL=sdk.js.map\n","/**\n * @license React\n * react-jsx-runtime.production.min.js\n *\n * Copyright (c) Facebook, Inc. and its affiliates.\n *\n * This source code is licensed under the MIT license found in the\n * LICENSE file in the root directory of this source tree.\n */\n'use strict';var f=require(\"react\"),k=Symbol.for(\"react.element\"),l=Symbol.for(\"react.fragment\"),m=Object.prototype.hasOwnProperty,n=f.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,p={key:!0,ref:!0,__self:!0,__source:!0};\nfunction q(c,a,g){var b,d={},e=null,h=null;void 0!==g&&(e=\"\"+g);void 0!==a.key&&(e=\"\"+a.key);void 0!==a.ref&&(h=a.ref);for(b in a)m.call(a,b)&&!p.hasOwnProperty(b)&&(d[b]=a[b]);if(c&&c.defaultProps)for(b in a=c.defaultProps,a)void 0===d[b]&&(d[b]=a[b]);return{$$typeof:k,type:c,key:e,ref:h,props:d,_owner:n.current}}exports.Fragment=l;exports.jsx=q;exports.jsxs=q;\n","'use strict';\n\nif (process.env.NODE_ENV === 'production') {\n  module.exports = require('./cjs/react-jsx-runtime.production.min.js');\n} else {\n  module.exports = require('./cjs/react-jsx-runtime.development.js');\n}\n","export enum EditorMode {\n  INLINE = 'inline',\n  OVERLAY = 'overlay',\n}\n","export enum NavPosition {\n  TOP = 'top',\n  BOTTOM = 'bottom',\n  HIDDEN = '',\n}\n\nexport enum MenubarPosition {\n  TOP = 'top',\n  BOTTOM = 'bottom',\n  HIDDEN = '',\n}\n","import {ICircleOptions, IObjectOptions, IRectOptions} from 'fabric/fabric-impl';\n\nexport interface PathOptions extends IObjectOptions {\n  path: string | undefined;\n}\n\nexport interface BasicShape {\n  name: string;\n  type: string;\n  options?: IObjectOptions | IRectOptions | PathOptions | ICircleOptions;\n}\n\nexport const defaultShapes: BasicShape[] = [\n  {\n    name: 'circle',\n    type: 'Circle',\n  },\n  {\n    name: 'square',\n    type: 'Rect',\n    options: {\n      lockUniScaling: false,\n    },\n  },\n  {\n    name: 'triangle',\n    type: 'Triangle',\n  },\n  {\n    name: 'ellipse',\n    type: 'Ellipse',\n    options: {\n      lockUniScaling: false,\n    },\n  },\n  {\n    name: 'Arrow #1',\n    type: 'Path',\n    options: {\n      path: 'M 294.9 16.4 l 15.7 42.2 c -171.4 70.3 -294 242.3 -289.1 437.4 l 14.7 -1 c 9.1 -0.6 18.1 -1.2 27.1 -1.9 l 14.7 -1 c -4.3 -170.1 102.5 -320 252 -381.3 l 15.7 42.2 c 34.7 -40.5 83.1 -76.6 144.8 -99.8 c -58.1 -26.2 -124.9 -39.6 -195.6 -36.8 z',\n    },\n  },\n  {\n    name: 'Arrow #2',\n    type: 'Path',\n    options: {\n      path: 'M 16 248.4 v 14.9 h 447.5 l -93.2 82.5 l 11.9 10.5 l 113.8 -100.2 l -113.6 -100.4 l -11.8 10.5 l 92.9 82.2 z',\n    },\n  },\n  {\n    name: 'Arrow #3',\n    type: 'Path',\n    options: {\n      path: 'M 496 256 l -118.6 -66 v 40.8 h -361.4 v 50.4 h 361.4 v 40.8 l 118.6 -66 z',\n    },\n  },\n  {\n    name: 'Line',\n    type: 'Path',\n    options: {\n      path: 'M 16 256 h 480',\n      strokeWidth: 10,\n      stroke: '#000',\n      padding: 10,\n    },\n  },\n  {\n    name: 'Star',\n    type: 'Path',\n    options: {\n      path: 'M 256 406.3 l 148.3 78 l -28.3 -165.2 l 120 -117 l -165.8 -24.1 l -74.2 -150.3 l -74.2 150.3 l -165.8 24.1 l 120 117 l -28.3 165.2 z',\n    },\n  },\n  {\n    name: 'Polygon',\n    type: 'Path',\n    options: {\n      path: 'M 256 19.6 l 156.6 57.1 l 83.4 144.3 l -28.9 164.2 l -127.7 107.2 h -166.8 l -127.7 -107.2 l -28.9 -164.2 l 83.4 -144.3 z',\n    },\n  },\n  {\n    name: 'Badge',\n    type: 'Path',\n    options: {\n      path: 'M 257.3 16.2 s -148 58.2 -204.4 81.4 c 0 75.7 -16.8 303.5 204.4 398.2 c 218.7 -94.6 201.9 -322.4 201.9 -398.2 c -62.1 -23.6 -201.9 -81.4 -201.9 -81.4 z',\n    },\n  },\n];\n","export const emoticonsList = [\n  'afro-1',\n  'afro',\n  'agent',\n  'alien-1',\n  'alien',\n  'angel',\n  'angry-1',\n  'angry-2',\n  'angry-3',\n  'angry-4',\n  'angry-5',\n  'angry',\n  'arguing',\n  'arrogant',\n  'asian-1',\n  'asian',\n  'avatar',\n  'baby-1',\n  'baby-2',\n  'baby',\n  'bully',\n  'burglar',\n  'businessman',\n  'cheeky-1',\n  'cheeky',\n  'clown',\n  'confused-1',\n  'confused-2',\n  'confused-3',\n  'confused',\n  'creepy',\n  'crying-1',\n  'crying-2',\n  'crying-3',\n  'crying',\n  'dazed-1',\n  'dazed-2',\n  'dazed-3',\n  'dazed',\n  'dead-1',\n  'dead-2',\n  'dead-3',\n  'dead-4',\n  'dead-5',\n  'dead-6',\n  'dead',\n  'desperate-1',\n  'desperate',\n  'detective',\n  'dissapointment',\n  'doctor',\n  'drunk',\n  'dumb',\n  'emo-1',\n  'emo-2',\n  'emo',\n  'emoticon',\n  'evil',\n  'faint-1',\n  'faint',\n  'flirt-1',\n  'flirt-2',\n  'flirt',\n  'flirty',\n  'gangster',\n  'geek-1',\n  'geek',\n  'gentleman-1',\n  'gentleman-2',\n  'gentleman-3',\n  'gentleman-4',\n  'gentleman',\n  'ginger',\n  'girl-1',\n  'girl',\n  'goofy-1',\n  'goofy-2',\n  'goofy-3',\n  'goofy-4',\n  'goofy',\n  'grubby-1',\n  'grubby',\n  'happy-1',\n  'happy-10',\n  'happy-11',\n  'happy-12',\n  'happy-13',\n  'happy-14',\n  'happy-15',\n  'happy-16',\n  'happy-2',\n  'happy-3',\n  'happy-4',\n  'happy-5',\n  'happy-6',\n  'happy-7',\n  'happy-8',\n  'happy-9',\n  'happy',\n  'harry-potter',\n  'heisenberg',\n  'hipster-1',\n  'hipster-2',\n  'hipster',\n  'in-love-1',\n  'in-love-2',\n  'in-love-3',\n  'in-love-4',\n  'in-love-5',\n  'in-love-6',\n  'in-love',\n  'japan',\n  'jew',\n  'joyful-1',\n  'joyful-2',\n  'joyful',\n  'kiss-1',\n  'kiss-2',\n  'kiss-3',\n  'kiss-4',\n  'kiss',\n  'laughing-1',\n  'laughing-2',\n  'laughing-3',\n  'laughing',\n  'listening',\n  'love',\n  'manly',\n  'miserly-1',\n  'miserly',\n  'nerd-1',\n  'nerd-2',\n  'nerd-3',\n  'nerd-4',\n  'nerd',\n  'ninja',\n  'pirate-1',\n  'pirate-2',\n  'pirate',\n  'punk-1',\n  'punk-2',\n  'punk',\n  'rapper',\n  'relieved',\n  'rich-1',\n  'rich-2',\n  'rich',\n  'rockstar',\n  'sad-1',\n  'sad-2',\n  'sad-3',\n  'sad-4',\n  'sad-5',\n  'sad-6',\n  'sad',\n  'scared-1',\n  'scared-2',\n  'scared-3',\n  'scared',\n  'sceptic-1',\n  'sceptic-2',\n  'sceptic-3',\n  'sceptic-4',\n  'sceptic-5',\n  'sceptic-6',\n  'sceptic-7',\n  'sceptic',\n  'secret',\n  'shocked-1',\n  'shocked-2',\n  'shocked-3',\n  'shocked',\n  'sick-1',\n  'sick-2',\n  'sick-3',\n  'sick-4',\n  'sick',\n  'silent',\n  'skeleton',\n  'smile',\n  'smiling-1',\n  'smiling',\n  'smoked',\n  'smug-1',\n  'smug-2',\n  'smug-3',\n  'smug-4',\n  'smug-5',\n  'smug-6',\n  'smug',\n  'sporty',\n  'stunned',\n  'superhero-1',\n  'superhero-2',\n  'superhero-3',\n  'superhero-4',\n  'superhero',\n  'surprised-1',\n  'surprised',\n  'thinking',\n  'tired-1',\n  'tired-2',\n  'tired-3',\n  'tired',\n  'tough-1',\n  'tough',\n  'trendy',\n  'vampire-1',\n  'vampire',\n  'wink-1',\n  'wink-2',\n  'wink',\n  'winking-1',\n  'winking',\n  'yawning-1',\n  'yawning-2',\n  'yawning-3',\n  'yawning',\n  'yelling',\n  'zombie',\n];\n","import {MessageDescriptor} from './message-descriptor';\n\ninterface MessageProps extends Omit<MessageDescriptor, 'message'> {}\nexport function message(msg: string, props?: MessageProps): MessageDescriptor {\n  return {...props, message: msg};\n}\n","import {emoticonsList} from './emoticons';\nimport {MessageDescriptor} from '../common/i18n/message-descriptor';\nimport {message} from '../common/i18n/message';\n\nexport interface StickerCategory {\n  name: string;\n  items?: number;\n  list?: string[];\n  type: 'svg' | 'png';\n  thumbnailUrl?: string;\n  invertPreview?: boolean;\n}\n\nexport const defaultStickers: StickerCategory[] = [\n  {\n    name: 'emoticons',\n    list: emoticonsList,\n    type: 'svg',\n    thumbnailUrl: 'images/stickers/categories/emoticon.svg',\n  },\n  {\n    name: 'doodles',\n    items: 100,\n    type: 'svg',\n    thumbnailUrl: 'images/stickers/categories/doodles.svg',\n  },\n  {\n    name: 'landmarks',\n    items: 100,\n    type: 'svg',\n    thumbnailUrl: 'images/stickers/categories/landmark.svg',\n    invertPreview: true,\n  },\n  {\n    name: 'bubbles',\n    items: 104,\n    type: 'png',\n    thumbnailUrl: 'images/stickers/categories/speech-bubble.svg',\n  },\n  {\n    name: 'transportation',\n    items: 22,\n    type: 'svg',\n    thumbnailUrl: 'images/stickers/categories/transportation.svg',\n    invertPreview: true,\n  },\n  {\n    name: 'beach',\n    items: 22,\n    type: 'svg',\n    thumbnailUrl: 'images/stickers/categories/beach.svg',\n    invertPreview: true,\n  },\n];\n\nexport const StickerCategoryMessages: Record<string, MessageDescriptor> = {\n  emoticons: message('Emoticons'),\n  doodles: message('Doodles'),\n  landmarks: message('Landmarks'),\n  bubbles: message('Bubbles'),\n  transportation: message('Transportation'),\n  beach: message('Beach'),\n};\n","export const defaultObjectProps = {\n  fill: '#1565C0',\n  opacity: 1,\n  backgroundColor: null,\n  strokeWidth: 0.05,\n  stroke: '#000',\n};\n","export const BrushTypes = [\n  'PencilBrush',\n  'SprayBrush',\n  'CircleBrush',\n  'DiamondBrush',\n  'VLineBrush',\n  'HLineBrush',\n  'SquareBrush',\n];\n\nexport const BrushSizes = [1, 8, 15, 20, 25];\n","export enum EditorTheme {\n  DARK = 'dark',\n  LIGHT = 'light',\n}\n","import {EditorTheme} from './editor-theme';\nimport type {PixieTheme} from './default-config';\n\nexport const DEFAULT_THEMES: PixieTheme[] = [\n  {\n    name: EditorTheme.LIGHT,\n    colors: {\n      '--be-foreground-base': '0 0 0',\n      '--be-primary-light': '191 219 254', // 200\n      '--be-primary': '59 130 246', // 500\n      '--be-primary-dark': '37 99 235',\n      '--be-on-primary': '255 255 255',\n      '--be-danger': '179 38 30',\n      '--be-on-danger': '255 255 255',\n      '--be-background': '255 255 255',\n      '--be-background-alt': '250 250 250',\n      '--be-paper': '255 255 255',\n      '--be-disabled-bg-opacity': '12%',\n      '--be-disabled-fg-opacity': '26%',\n      '--be-hover-opacity': '4%',\n      '--be-focus-opacity': '12%',\n      '--be-selected-opacity': '8%',\n      '--be-text-main-opacity': '87%',\n      '--be-text-muted-opacity': '60%',\n      '--be-divider-opacity': '12%',\n    },\n  },\n  {\n    name: EditorTheme.DARK,\n    isDark: true,\n    colors: {\n      '--be-foreground-base': '255 255 255',\n      '--be-primary-light': '239 246 255', // 50\n      '--be-primary': '191 219 254', // 200\n      '--be-primary-dark': '147 197 253', // 300\n      '--be-on-primary': '56 30 114',\n      '--be-danger': '242 184 181',\n      '--be-on-danger': '96 20 16',\n      '--be-background': '20 21 23',\n      '--be-background-alt': '26 27 30',\n      '--be-paper': '44 46 51',\n      '--be-disabled-bg-opacity': '12%',\n      '--be-disabled-fg-opacity': '30%',\n      '--be-hover-opacity': '8%',\n      '--be-focus-opacity': '12%',\n      '--be-selected-opacity': '16%',\n      '--be-text-main-opacity': '100%',\n      '--be-text-muted-opacity': '70%',\n      '--be-divider-opacity': '12%',\n    },\n  },\n];\n","export enum ToolName {\n  FILTER = 'filter',\n  RESIZE = 'resize',\n  CROP = 'crop',\n  DRAW = 'draw',\n  TEXT = 'text',\n  SHAPES = 'shapes',\n  STICKERS = 'stickers',\n  FRAME = 'frame',\n  CORNERS = 'corners',\n  MERGE = 'merge',\n}\n","function r(e){var t,f,n=\"\";if(\"string\"==typeof e||\"number\"==typeof e)n+=e;else if(\"object\"==typeof e)if(Array.isArray(e))for(t=0;t<e.length;t++)e[t]&&(f=r(e[t]))&&(n&&(n+=\" \"),n+=f);else for(t in e)e[t]&&(n&&(n+=\" \"),n+=t);return n}export function clsx(){for(var e,t,f=0,n=\"\";f<arguments.length;)(e=arguments[f++])&&(t=r(e))&&(n&&(n+=\" \"),n+=t);return n}export default clsx;","import React, {forwardRef} from 'react';\nimport clsx from 'clsx';\n\nexport type IconSize = '2xs' | 'xs' | 'sm' | 'md' | 'lg' | 'xl';\n\nexport interface SvgIconProps extends React.SVGAttributes<SVGElement> {\n  children?: React.ReactNode;\n  size?: IconSize;\n  color?: string;\n  title?: string;\n}\n\nexport const SvgIcon = forwardRef<SVGSVGElement, SvgIconProps & {attr?: {}}>(\n  (props, ref) => {\n    const {\n      attr,\n      size,\n      title,\n      className,\n      color,\n      style,\n      children,\n      viewBox,\n      width,\n      height,\n      ...svgProps\n    } = props;\n\n    return (\n      <svg\n        aria-hidden={!title}\n        focusable={false}\n        xmlns=\"http://www.w3.org/2000/svg\"\n        viewBox={viewBox || '0 0 24 24'}\n        {...attr}\n        {...svgProps}\n        className={clsx('svg-icon', className, getSizeClassName(size))}\n        style={{\n          color,\n          ...style,\n        }}\n        ref={ref}\n        height={height || '1em'}\n        width={width || '1em'}\n      >\n        {title && <title>{title}</title>}\n        {children}\n      </svg>\n    );\n  }\n);\n\nfunction getSizeClassName(size?: IconSize) {\n  switch (size) {\n    case '2xs':\n      return 'icon-2xs';\n    case 'xs':\n      return 'icon-xs';\n    case 'sm':\n      return 'icon-sm';\n    case 'md':\n      return 'icon-md';\n    case 'lg':\n      return 'icon-lg';\n    case 'xl':\n      return 'icon-xl';\n    default:\n      return '';\n  }\n}\n","import React, {ComponentType, ReactElement, RefObject} from 'react';\nimport {SvgIcon, SvgIconProps} from './svg-icon';\n\nexport function createSvgIcon(\n  path: ReactElement | ReactElement[],\n  displayName: string = '',\n  viewBox?: string\n): ComponentType<SvgIconProps> {\n  const Component = (props: SvgIconProps, ref: RefObject<SVGSVGElement>) => (\n    <SvgIcon\n      data-testid={`${displayName}Icon`}\n      ref={ref}\n      viewBox={viewBox}\n      {...props}\n      size={props.size || 'md'}\n    >\n      {path}\n    </SvgIcon>\n  );\n\n  if (process.env.NODE_ENV !== 'production') {\n    // Need to set `displayName` on the inner component for React.memo.\n    // React prior to 16.14 ignores `displayName` on the wrapper.\n    Component.displayName = `${displayName}Icon`;\n  }\n\n  return React.memo(React.forwardRef(Component as any));\n}\n\nexport interface IconTree {\n  tag: string;\n  attr?: {[key: string]: string};\n  // Can't use \"IconTree\", otherwise there's circular reference error in hook form\n  child?: {tag: string; attr?: {[key: string]: string}}[];\n}\nexport function createSvgIconFromTree(\n  data: IconTree[],\n  displayName: string = ''\n) {\n  const path = treeToElement(data);\n  return createSvgIcon(path!, displayName);\n}\n\nfunction treeToElement(\n  tree?: IconTree[]\n): React.ReactElement<{}>[] | undefined {\n  return (\n    tree?.map &&\n    tree.map((node, i) => {\n      return React.createElement(\n        node.tag,\n        {key: i, ...node.attr},\n        treeToElement(node.child)\n      );\n    })\n  );\n}\n\nexport function elementToTree(el: HTMLElement | SVGElement): IconTree {\n  const attributes: IconTree['attr'] = {};\n  const tree: IconTree = {tag: el.tagName, attr: attributes};\n  Array.from(el.attributes).forEach(attribute => {\n    attributes[attribute.name] = attribute.value;\n  });\n  if (el.children.length) {\n    tree.child = Array.from(el.children).map(child =>\n      elementToTree(child as HTMLElement)\n    );\n  }\n  return tree;\n}\n","import {createSvgIcon} from '../create-svg-icon';\n\nexport const TuneIcon = createSvgIcon(\n  <path d=\"M3 17v2h6v-2H3zM3 5v2h10V5H3zm10 16v-2h8v-2h-8v-2h-2v6h2zM7 9v2H3v2h4v2h2V9H7zm14 4v-2H11v2h10zm-6-4h2V7h4V5h-4V3h-2v6z\" />\n, 'TuneOutlined');\n","import {createSvgIcon} from '../create-svg-icon';\n\nexport const PhotoSizeSelectLargeIcon = createSvgIcon(\n  <path d=\"M21 15h2v2h-2v-2zm0-4h2v2h-2v-2zm2 8h-2v2c1 0 2-1 2-2zM13 3h2v2h-2V3zm8 4h2v2h-2V7zm0-4v2h2c0-1-1-2-2-2zM1 7h2v2H1V7zm16-4h2v2h-2V3zm0 16h2v2h-2v-2zM3 3C2 3 1 4 1 5h2V3zm6 0h2v2H9V3zM5 3h2v2H5V3zm-4 8v8c0 1.1.9 2 2 2h12V11H1zm2 8 2.5-3.21 1.79 2.15 2.5-3.22L13 19H3z\" />\n, 'PhotoSizeSelectLargeOutlined');\n","import {createSvgIcon} from '../create-svg-icon';\n\nexport const CropIcon = createSvgIcon(\n  <path d=\"M17 15h2V7c0-1.1-.9-2-2-2H9v2h8v8zM7 17V1H5v4H1v2h4v10c0 1.1.9 2 2 2h10v4h2v-4h4v-2H7z\" />\n, 'CropOutlined');\n","import {createSvgIcon} from '../create-svg-icon';\n\nexport const TextFieldsIcon = createSvgIcon(\n  <path d=\"M2.5 4v3h5v12h3V7h5V4h-13zm19 5h-9v3h3v7h3v-7h3V9z\" />\n, 'TextFieldsOutlined');\n","import {createSvgIcon} from '../create-svg-icon';\n\nexport const ExtensionIcon = createSvgIcon(\n  <path d=\"M10.5 4.5c.28 0 .5.22.5.5v2h6v6h2c.28 0 .5.22.5.5s-.22.5-.5.5h-2v6h-2.12c-.68-1.75-2.39-3-4.38-3s-3.7 1.25-4.38 3H4v-2.12c1.75-.68 3-2.39 3-4.38 0-1.99-1.24-3.7-2.99-4.38L4 7h6V5c0-.28.22-.5.5-.5m0-2C9.12 2.5 8 3.62 8 5H4c-1.1 0-1.99.9-1.99 2v3.8h.29c1.49 0 2.7 1.21 2.7 2.7s-1.21 2.7-2.7 2.7H2V20c0 1.1.9 2 2 2h3.8v-.3c0-1.49 1.21-2.7 2.7-2.7s2.7 1.21 2.7 2.7v.3H17c1.1 0 2-.9 2-2v-4c1.38 0 2.5-1.12 2.5-2.5S20.38 11 19 11V7c0-1.1-.9-2-2-2h-4c0-1.38-1.12-2.5-2.5-2.5z\" />\n, 'ExtensionOutlined');\n","import {createSvgIcon} from '../create-svg-icon';\n\nexport const FaceIcon = createSvgIcon(\n  <path d=\"M10.25 13c0 .69-.56 1.25-1.25 1.25S7.75 13.69 7.75 13s.56-1.25 1.25-1.25 1.25.56 1.25 1.25zM15 11.75c-.69 0-1.25.56-1.25 1.25s.56 1.25 1.25 1.25 1.25-.56 1.25-1.25-.56-1.25-1.25-1.25zm7 .25c0 5.52-4.48 10-10 10S2 17.52 2 12 6.48 2 12 2s10 4.48 10 10zM10.66 4.12C12.06 6.44 14.6 8 17.5 8c.46 0 .91-.05 1.34-.12C17.44 5.56 14.9 4 12 4c-.46 0-.91.05-1.34.12zM4.42 9.47c1.71-.97 3.03-2.55 3.66-4.44C6.37 6 5.05 7.58 4.42 9.47zM20 12c0-.78-.12-1.53-.33-2.24-.7.15-1.42.24-2.17.24-3.13 0-5.92-1.44-7.76-3.69C8.69 8.87 6.6 10.88 4 11.86c.01.04 0 .09 0 .14 0 4.41 3.59 8 8 8s8-3.59 8-8z\" />\n, 'FaceOutlined');\n","import {createSvgIcon} from '../create-svg-icon';\n\nexport const FilterFramesIcon = createSvgIcon(\n  <path d=\"M20 4h-4l-4-4-4 4H4c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2V6c0-1.1-.9-2-2-2zm0 16H4V6h4.52l3.52-3.5L15.52 6H20v14zM6 18h12V8H6v10zm2-8h8v6H8v-6z\" />\n, 'FilterFramesOutlined');\n","import {createSvgIcon} from '../create-svg-icon';\n\nexport const MergeIcon = createSvgIcon(\n  <path d=\"M6.41 21 5 19.59l4.83-4.83c.75-.75 1.17-1.77 1.17-2.83v-5.1L9.41 8.41 8 7l4-4 4 4-1.41 1.41L13 6.83v5.1c0 1.06.42 2.08 1.17 2.83L19 19.59 17.59 21 12 15.41 6.41 21z\" />\n, 'MergeOutlined');\n","import {createSvgIcon} from '../create-svg-icon';\n\nexport const RoundedCornerIcon = createSvgIcon(\n  <path d=\"M19 19h2v2h-2v-2zm0-2h2v-2h-2v2zM3 13h2v-2H3v2zm0 4h2v-2H3v2zm0-8h2V7H3v2zm0-4h2V3H3v2zm4 0h2V3H7v2zm8 16h2v-2h-2v2zm-4 0h2v-2h-2v2zm4 0h2v-2h-2v2zm-8 0h2v-2H7v2zm-4 0h2v-2H3v2zM21 8c0-2.76-2.24-5-5-5h-5v2h5c1.65 0 3 1.35 3 3v5h2V8z\" />\n, 'RoundedCornerOutlined');\n","import {createSvgIcon} from '../create-svg-icon';\n\nexport const PhotoLibraryIcon = createSvgIcon(\n  <path d=\"M20 4v12H8V4h12m0-2H8c-1.1 0-2 .9-2 2v12c0 1.1.9 2 2 2h12c1.1 0 2-.9 2-2V4c0-1.1-.9-2-2-2zm-8.5 9.67 1.69 2.26 2.48-3.1L19 15H9zM2 6v14c0 1.1.9 2 2 2h14v-2H4V6H2z\" />\n, 'PhotoLibraryOutlined');\n","import {createSvgIcon} from '../create-svg-icon';\n\nexport const HistoryIcon = createSvgIcon(\n  <path d=\"M13 3c-4.97 0-9 4.03-9 9H1l3.89 3.89.07.14L9 12H6c0-3.87 3.13-7 7-7s7 3.13 7 7-3.13 7-7 7c-1.93 0-3.68-.79-4.94-2.06l-1.42 1.42C8.27 19.99 10.51 21 13 21c4.97 0 9-4.03 9-9s-4.03-9-9-9zm-1 5v5l4.25 2.52.77-1.28-3.52-2.09V8z\" />\n, 'HistoryOutlined');\n","import {createSvgIcon} from '../create-svg-icon';\n\nexport const StyleIcon = createSvgIcon(\n  [<path d=\"m2.53 19.65 1.34.56v-9.03l-2.43 5.86c-.41 1.02.08 2.19 1.09 2.61zm19.5-3.7L17.07 3.98c-.31-.75-1.04-1.21-1.81-1.23-.26 0-.53.04-.79.15L7.1 5.95c-.75.31-1.21 1.03-1.23 1.8-.01.27.04.54.15.8l4.96 11.97c.31.76 1.05 1.22 1.83 1.23.26 0 .52-.05.77-.15l7.36-3.05c1.02-.42 1.51-1.59 1.09-2.6zm-9.2 3.8L7.87 7.79l7.35-3.04h.01l4.95 11.95-7.35 3.05z\" key=\"0\" />,<circle cx=\"11\" cy=\"9\" r=\"1\" key=\"1\" />,<path d=\"M5.88 19.75c0 1.1.9 2 2 2h1.45l-3.45-8.34v6.34z\" key=\"2\" />,]\n, 'StyleOutlined');\n","import {createSvgIcon} from '../create-svg-icon';\n\nexport const DeleteIcon = createSvgIcon(\n  <path d=\"M16 9v10H8V9h8m-1.5-6h-5l-1 1H5v2h14V4h-3.5l-1-1zM18 7H6v12c0 1.1.9 2 2 2h8c1.1 0 2-.9 2-2V7z\" />\n, 'DeleteOutlined');\n","import {createSvgIcon} from '../../common/icons/create-svg-icon';\n\nexport const DrawIcon = createSvgIcon(\n  <path d=\"M18.85,10.39l1.06-1.06c0.78-0.78,0.78-2.05,0-2.83L18.5,5.09c-0.78-0.78-2.05-0.78-2.83,0l-1.06,1.06L18.85,10.39z M14.61,11.81L7.41,19H6v-1.41l7.19-7.19L14.61,11.81z M13.19,7.56L4,16.76V21h4.24l9.19-9.19L13.19,7.56L13.19,7.56z M19,17.5 c0,2.19-2.54,3.5-5,3.5c-0.55,0-1-0.45-1-1s0.45-1,1-1c1.54,0,3-0.73,3-1.5c0-0.47-0.48-0.87-1.23-1.2l1.48-1.48 C18.32,15.45,19,16.29,19,17.5z M4.58,13.35C3.61,12.79,3,12.06,3,11c0-1.8,1.89-2.63,3.56-3.36C7.59,7.18,9,6.56,9,6 c0-0.41-0.78-1-2-1C5.74,5,5.2,5.61,5.17,5.64C4.82,6.05,4.19,6.1,3.77,5.76C3.36,5.42,3.28,4.81,3.62,4.38C3.73,4.24,4.76,3,7,3 c2.24,0,4,1.32,4,3c0,1.87-1.93,2.72-3.64,3.47C6.42,9.88,5,10.5,5,11c0,0.31,0.43,0.6,1.07,0.86L4.58,13.35z\" />,\n  'Draw'\n);\n","import {createSvgIcon} from '../create-svg-icon';\n\nexport const HomeIcon = createSvgIcon(\n  <path d=\"m12 5.69 5 4.5V18h-2v-6H9v6H7v-7.81l5-4.5M12 3 2 12h3v8h6v-6h2v6h6v-8h3L12 3z\" />\n, 'HomeOutlined');\n","import {ComponentType} from 'react';\nimport {ToolName} from '../tool-name';\nimport {TuneIcon} from '../../common/icons/material/Tune';\nimport {PhotoSizeSelectLargeIcon} from '../../common/icons/material/PhotoSizeSelectLarge';\nimport {CropIcon} from '../../common/icons/material/Crop';\nimport {TextFieldsIcon} from '../../common/icons/material/TextFields';\nimport {ExtensionIcon} from '../../common/icons/material/Extension';\nimport {FaceIcon} from '../../common/icons/material/Face';\nimport {FilterFramesIcon} from '../../common/icons/material/FilterFrames';\nimport {MergeIcon} from '../../common/icons/material/Merge';\nimport {RoundedCornerIcon} from '../../common/icons/material/RoundedCorner';\nimport {PhotoLibraryIcon} from '../../common/icons/material/PhotoLibrary';\nimport {HistoryIcon} from '../../common/icons/material/History';\nimport {StyleIcon} from '../../common/icons/material/Style';\nimport {DeleteIcon} from '../../common/icons/material/Delete';\nimport {SvgIconProps} from '../../common/icons/svg-icon';\nimport {DrawIcon} from '../../ui/icons/draw';\nimport {HomeIcon} from '../../common/icons/material/Home';\nimport {MessageDescriptor} from '../../common/i18n/message-descriptor';\nimport {message} from '../../common/i18n/message';\n\nexport const HISTORY_DISPLAY_NAMES: Record<\n  HistoryName,\n  {name: MessageDescriptor; icon: ComponentType<SvgIconProps>}\n> = {\n  [ToolName.FILTER]: {\n    name: message('Applied Filters'),\n    icon: TuneIcon,\n  },\n  [ToolName.RESIZE]: {\n    name: message('Resized Image'),\n    icon: PhotoSizeSelectLargeIcon,\n  },\n  [ToolName.CROP]: {\n    name: message('Cropped Image'),\n    icon: CropIcon,\n  },\n  [ToolName.DRAW]: {\n    name: message('Added Drawing'),\n    icon: DrawIcon,\n  },\n  [ToolName.TEXT]: {\n    name: message('Added Text'),\n    icon: TextFieldsIcon,\n  },\n  [ToolName.SHAPES]: {\n    name: message('Added Shape'),\n    icon: ExtensionIcon,\n  },\n  [ToolName.STICKERS]: {\n    name: message('Added Sticker'),\n    icon: FaceIcon,\n  },\n  [ToolName.FRAME]: {\n    name: message('Added Frame'),\n    icon: FilterFramesIcon,\n  },\n  [ToolName.MERGE]: {\n    name: message('Merged Objects'),\n    icon: MergeIcon,\n  },\n  [ToolName.CORNERS]: {\n    name: message('Rounded Corner'),\n    icon: RoundedCornerIcon,\n  },\n  bgImage: {\n    name: message('Replaced Background Image'),\n    icon: PhotoLibraryIcon,\n  },\n  overlayImage: {\n    name: message('Added Image'),\n    icon: PhotoLibraryIcon,\n  },\n  initial: {name: message('Initial'), icon: HomeIcon},\n  loadedState: {\n    name: message('Loaded State'),\n    icon: HistoryIcon,\n  },\n  objectStyle: {\n    name: message('Changed Style'),\n    icon: StyleIcon,\n  },\n  deletedObject: {\n    name: message('Deleted object'),\n    icon: DeleteIcon,\n  },\n};\n\nexport type HistoryName =\n  | ToolName\n  | 'initial'\n  | 'loadedState'\n  | 'bgImage'\n  | 'overlayImage'\n  | 'objectStyle'\n  | 'deletedObject';\n","import {ToolName} from '../tools/tool-name';\nimport type {NavItem} from './default-config';\nimport type {Pixie} from '../pixie';\nimport {HISTORY_DISPLAY_NAMES} from '../tools/history/history-display-names';\nimport {MessageDescriptor} from '../common/i18n/message-descriptor';\nimport {message} from '../common/i18n/message';\n\nexport const DEFAULT_NAV_ITEMS: NavItem[] = Object.values(ToolName).map(\n  toolName => {\n    return {\n      name: toolName,\n      icon: HISTORY_DISPLAY_NAMES[toolName].icon,\n      action:\n        toolName === ToolName.MERGE\n          ? (editor: Pixie) => {\n              editor.tools.merge.apply();\n            }\n          : toolName,\n    };\n  }\n);\n\nexport const navItemMessages: Record<string, MessageDescriptor> = {\n  filter: message('Filter'),\n  resize: message('Resize'),\n  crop: message('Crop'),\n  draw: message('Draw'),\n  text: message('Text'),\n  shapes: message('Shapes'),\n  Stickers: message('Stickers'),\n  frame: message('Frame'),\n  corners: message('Corners'),\n  merge: message('Merge'),\n};\n","import {createSvgIcon} from '../create-svg-icon';\n\nexport const FileDownloadIcon = createSvgIcon(\n  <path d=\"M18 15v3H6v-3H4v3c0 1.1.9 2 2 2h12c1.1 0 2-.9 2-2v-3h-2zm-1-4-1.41-1.41L13 12.17V4h-2v8.17L8.41 9.59 7 11l5 5 5-5z\" />\n, 'FileDownloadOutlined');\n","import React, {ComponentType} from 'react';\nimport {ToolName} from '../tools/tool-name';\nimport {EditorMode} from './editor-mode';\nimport {MenubarPosition, NavPosition} from '../ui/navbar/nav-position';\nimport {SampleImage} from '../tools/sample-image';\nimport {BasicShape, defaultShapes} from './default-shapes';\nimport {defaultStickers, StickerCategory} from './default-stickers';\nimport {defaultObjectProps} from './default-object-props';\nimport {BrushSizes, BrushTypes} from '../tools/draw/draw-defaults';\nimport {EditorTheme} from './editor-theme';\nimport type {Frame} from '../tools/frame/frame';\nimport type {FontFaceConfig} from '../common/ui/font-picker/font-face-config';\nimport {DEFAULT_THEMES} from './default-themes';\nimport {DEFAULT_NAV_ITEMS} from './default-nav-items';\nimport type {Pixie} from '../pixie';\nimport {FileDownloadIcon} from '../common/icons/material/FileDownload';\nimport {HistoryIcon} from '../common/icons/material/History';\nimport {ObjectName} from '../objects/object-name';\nimport packageConfig from '../../package.json';\nimport {MessageDescriptor} from '../common/i18n/message-descriptor';\nimport {message} from '../common/i18n/message';\nimport {\n  ButtonColor,\n  ButtonVariant,\n} from '../common/ui/buttons/get-shared-button-style';\nimport {IconTree} from '../common/icons/create-svg-icon';\n\nexport const PIXIE_VERSION = packageConfig.version;\n\nexport interface NavItem {\n  /**\n   * unique identifier for this navigation item.\n   */\n  name: string;\n\n  /**\n   * Action to perform when this nav item is clicked. Either name of panel to open or custom function.\n   */\n  action: Function | ToolName;\n\n  /**\n   * Name or url of icon for this navigation item.\n   */\n  icon: React.ComponentType;\n}\n\nexport interface ToolbarItemConfig {\n  /**\n   * Type for this toolbar item.\n   */\n  type: 'button' | 'zoomWidget' | 'undoWidget' | 'image';\n\n  /**\n   * Url for image when toolbar item type is set to \"image\".\n   */\n  src?: string;\n\n  /**\n   * Icon that should be shown for this item.\n   */\n  icon?: ComponentType | IconTree[];\n\n  /**\n   * Label that should be shown for this item.\n   */\n  label?: string | MessageDescriptor;\n\n  /**\n   * Style for the item when type is set to \"button\".\n   */\n  buttonVariant?: ButtonVariant;\n\n  /**\n   * Color for the item when type is set to \"button\".\n   */\n  buttonColor?: ButtonColor;\n\n  /**\n   * Action that should be performed when user clicks on this item.\n   */\n  action?: (editor: Pixie) => void;\n\n  /**\n   * On which side of the menubar should this item be shown.\n   */\n  align?: 'left' | 'center' | 'right';\n\n  /**\n   * Menubar items will be sorted based on position. Items with lower position will appear first.\n   */\n  position?: number;\n\n  /**\n   * Whether this toolbar item should only show on mobile.\n   */\n  mobileOnly?: boolean;\n\n  /**\n   * Whether this toolbar item should only show on desktop.\n   */\n  desktopOnly?: boolean;\n\n  /**\n   * List of dropdown menu items that will be shown when this button is clicked.\n   */\n  menuItems?: {label: string; action: (editor: Pixie) => void}[];\n}\n\nexport interface ObjectDefaults {\n  /**\n   * Default object background color.\n   */\n  fill?: string;\n\n  /**\n   * Default align for text added via pixie.\n   */\n  textAlign?:\n    | 'initial'\n    | 'left'\n    | 'center'\n    | 'right'\n    | 'justify'\n    | 'justify-left'\n    | 'justify-center'\n    | 'justify-right';\n\n  /**\n   * Whether text should have an underline.\n   */\n  underline?: boolean;\n\n  /**\n   * Whether text should have a strikethrough line.\n   */\n  linethrough?: boolean;\n\n  /**\n   * Default font style for text added via pixie.\n   */\n  fontStyle?: 'normal' | 'italic' | 'oblique';\n\n  /**\n   * Default font family for text added via pixie.\n   */\n  fontFamily?: string;\n\n  /**\n   * Default font size for text added via pixie.\n   */\n  fontSize?: number;\n\n  /**\n   * Default font weight text added via pixie.\n   */\n  fontWeight?:\n    | 'bold'\n    | 'normal'\n    | 100\n    | 200\n    | 300\n    | 400\n    | 500\n    | 600\n    | 700\n    | 800\n    | 900;\n\n  /**\n   * Text border color.\n   */\n  stroke?: string;\n\n  /**\n   * Default object width. Will be 1/4 of canvas size if not specified.\n   */\n  width?: number;\n\n  /**\n   * Default object width. Will be 1/4 of canvas size if not specified.\n   */\n  height?: number;\n}\n\nexport interface ObjectControlConfig {\n  hideTopLeft?: boolean;\n  hideTopRight?: boolean;\n  hideBottomRight?: boolean;\n  hideBottomLeft?: boolean;\n  hideRotatingPoint?: boolean;\n  hideFloatingControls?: boolean;\n  unlockAspectRatio?: boolean;\n  lockMovement?: boolean;\n}\n\nexport interface PixieTheme {\n  name: string;\n  isDark?: boolean;\n  colors: Record<string, string>;\n}\n\nexport interface PixieConfig {\n  /**\n   * Selector for the container into which pixie should be loaded.\n   */\n  selector: string;\n\n  /**\n   * Image or pixie state that should be loaded into editor with initial load.\n   * Will accept url or image/state data.\n   */\n  image?: string;\n\n  /**\n   * Pixie state to load into the editor.\n   */\n  state?: string;\n\n  /**\n   * Opens new empty canvas at specified size. Alternative to \"image\" and \"state\".\n   */\n  blankCanvasSize?: {width: number; height: number};\n\n  /**\n   * Whether images loaded into pixie will be hosted on another domain from where pixie is hosted.\n   */\n  crossOrigin?: boolean;\n\n  /**\n   * Adds specified text as watermark on downloaded or exported image.\n   */\n  watermarkText?: string;\n\n  /**\n   * Maximum memory pixie will use when applying filters.\n   * https://support.vebto.com/help-center/articles/10/45/164/filter-texture-size\n   */\n  textureSize?: number;\n\n  /**\n   * From where should pixie assets be loaded.\n   * https://support.vebto.com/help-center/articles/10/45/150/specifying-base-url\n   */\n  baseUrl?: string;\n\n  ui?: {\n    /**\n     * Tool that should be activated when editor is opened initially.\n     */\n    defaultTool?: ToolName;\n\n    /**\n     * Whether pixie is currently visible.\n     */\n    visible?: boolean;\n\n    /**\n     * Theme that is currently active.\n     */\n    activeTheme?: string;\n\n    /**\n     * List of available themes.\n     */\n    themes?: PixieTheme[];\n\n    /**\n     * Whether inline or overlay (modal) mode should be used.\n     */\n    mode?: EditorMode;\n\n    /**\n     * If true, editor will always show as overlay on mobile, regardless of specified \"mode\".\n     */\n    forceOverlayModeOnMobile?: boolean;\n\n    /**\n     * Whether user should be able to close editor while in overlay mode.\n     */\n    allowEditorClose?: boolean;\n\n    /**\n     * When user clicks on \"done\" button, show panel where image format, name and quality can be selected before download.\n     */\n    showExportPanel?: boolean;\n\n    /**\n     * Preset colors that will be shown in pixie color widgets.\n     */\n    colorPresets?: {\n      /**\n       * Lists of colors in hex or rgba format.\n       */\n      items: string[];\n\n      /**\n       * Whether default pixie colors should be overwritten with specified ones.\n       */\n      replaceDefault?: boolean;\n    };\n\n    /**\n     * Navigation bar configuration.\n     */\n    nav?: {\n      /**\n       * At which predefined position should navigation bar be displayed.\n       */\n      position?: NavPosition;\n\n      /**\n       * Whether specified navigation items should replace default ones.\n       */\n      replaceDefault?: boolean;\n\n      /**\n       * What Items should be shown in the navigation bar.\n       */\n      items?: NavItem[];\n    };\n\n    /**\n     * If no image or state is provided via configuration, this panel can be opened to allow\n     * user to select from sample images, upload new image, or enter blank canvas size.\n     */\n    openImageDialog?: {\n      /**\n       * Whether this panel should be shown.\n       */\n      show: boolean;\n\n      /**\n       * Sample images that user should be able to pick from.\n       */\n      sampleImages?: SampleImage[];\n    };\n\n    /**\n     * Menubar appearance and items configuration.\n     */\n    menubar?: {\n      /**\n       * Where should menubar appear.\n       */\n      position?: MenubarPosition;\n\n      /**\n       * Items to show in the menubar.\n       */\n      items?: ToolbarItemConfig[];\n    };\n  };\n\n  /**\n   * Currently active language for the editor.\n   */\n  activeLanguage?: string;\n\n  /**\n   * List of available translations.\n   */\n  languages?: {\n    [key: string]: Record<string, string>;\n  };\n\n  /**\n   * On \"save\" button click pixie will automatically send image data to specified url.\n   */\n  saveUrl?: string;\n\n  /**\n   * Called when image is saved via save button, export panel or pixie API.\n   */\n  onSave?: Function;\n\n  /**\n   * Called when pixie editor is fully loaded.\n   */\n  onLoad?: Function;\n\n  /**\n   * Called when editor is closed (via pixie API or close button click)\n   */\n  onClose?: Function;\n\n  /**\n   * Called when editor is opened (via pixie API or custom open button)\n   */\n  onOpen?: Function;\n\n  /**\n   * Called whenever a new file (image or state) is opened via file picker.\n   */\n  onFileOpen?: Function;\n\n  /**\n   * Called when main image is loaded (or changed) in the editor.\n   */\n  onMainImageLoaded?: Function;\n\n  tools?: {\n    /**\n     * Filter tool configuration.\n     */\n    filter?: {\n      /**\n       * Whether specified filters should replace default ones.\n       */\n      replaceDefault?: boolean;\n\n      /**\n       * Filters that should be shown in filter panel.\n       */\n      items: string[];\n    };\n\n    /**\n     * Resize tool configuration.\n     */\n    resize?: {\n      /**\n       * Minimum width user should be able to resize image to.\n       */\n      minWidth?: number;\n\n      /**\n       * Maximum width user should be able to resize image to.\n       */\n      maxWidth?: number;\n\n      /**\n       * Minimum height user should be able to resize image to.\n       */\n      minHeight?: number;\n\n      /**\n       * Maximum height user should be able to resize image to.\n       */\n      maxHeight?: number;\n    };\n\n    crop?: {\n      /**\n       * Initial aspect ratio for cropzone.\n       */\n      defaultRatio?: string;\n\n      /**\n       * Whether user should be able to resize cropzone to any aspect ratio.\n       */\n      allowCustomRatio?: boolean;\n\n      /**\n       * Whether built-in cropzone aspect ratios should be overwritten with specified ones.\n       */\n      replaceDefaultPresets?: boolean;\n\n      /**\n       * Custom cropzone aspect ratios.\n       */\n      presets?: {ratio: string | null; name?: string}[];\n\n      /**\n       * Cropzone appearance and functionality configuration.\n       */\n      cropzone?: ObjectControlConfig;\n    };\n\n    /**\n     * Draw tool configuration.\n     */\n    draw?: {\n      /**\n       * Whether default brush sizes should be replaced.\n       */\n      replaceDefaultBrushSizes?: boolean;\n\n      /**\n       * Whether default brush types should be replaced.\n       */\n      replaceDefaultBrushTypes?: boolean;\n\n      /**\n       * Brush sizes that user should be able to pick from.\n       */\n      brushSizes: number[];\n\n      /**\n       * Brush types that user should be able to pick from.\n       */\n      brushTypes: string[];\n    };\n\n    text?: {\n      /**\n       * Whether default fonts should be replaced with specified custom ones.\n       */\n      replaceDefaultItems?: boolean;\n\n      /**\n       * Text that should be added by default when clicking on \"add text\" button.\n       */\n      defaultText?: string;\n\n      /**\n       * Custom fonts that should be shown in font picker.\n       */\n      items?: FontFaceConfig[];\n    };\n\n    frame?: {\n      /**\n       * Whether default frames should be replaced with specified custom ones.\n       */\n      replaceDefault?: boolean;\n\n      /**\n       * Custom frames that user should be able to add to the image.\n       */\n      items?: Frame[];\n    };\n\n    shapes?: {\n      /**\n       * Whether default shapes should be replaced with specified custom ones.\n       */\n      replaceDefault?: boolean;\n\n      /**\n       * Custom shapes that user should be able to add to the image.\n       */\n      items?: BasicShape[];\n    };\n\n    stickers?: {\n      /**\n       * Whether default sticker categories should be replaced with specified custom ones.\n       */\n      replaceDefault?: boolean;\n\n      /**\n       * Custom sticker categories and their stickers that should appear in stickers panel.\n       */\n      items?: StickerCategory[];\n    };\n\n    import?: {\n      /**\n       * File extensions user should be able to select when opening new image.\n       */\n      validImgExtensions?: string[];\n\n      /**\n       * Maximum file size when opening new image or state file.\n       */\n      maxFileSize?: number; // in bytes\n\n      /**\n       * Whether new image overlays should be automatically resized to fit available canvas space.\n       */\n      fitOverlayToScreen?: boolean;\n\n      /**\n       * When user drags image from desktop onto pixie, should that image be opened as background or overlay.\n       */\n      openDroppedImageAsBackground?: boolean;\n    };\n\n    export?: {\n      /**\n       * Which format should images be downloaded in by default.\n       */\n      defaultFormat: 'png' | 'jpeg' | 'json';\n\n      /**\n       * What compression level should be applied to downloaded images. 0 to 1.\n       */\n      defaultQuality: number;\n\n      /**\n       * Default file name for downloaded images.\n       */\n      defaultName: string;\n    };\n\n    zoom?: {\n      /**\n       * Whether user should be able to manually zoom in and out via toolbar buttons.\n       */\n      allowUserZoom?: boolean;\n\n      /**\n       * Whether new image should be automatically zoomed, so it fits into available screen space.\n       */\n      fitImageToScreen?: boolean;\n    };\n  };\n\n  /**\n   * Default styles and behaviour for various objects in pixie.\n   */\n  objectDefaults?: {\n    /**\n     * Styles and behaviour for all objects.\n     */\n    global?: ObjectDefaults;\n\n    /**\n     * Styles and behaviour for new basic shapes (circle, triangle etc.)\n     */\n    [ObjectName.Shape]?: ObjectDefaults;\n\n    /**\n     * Styles and behaviour for new stickers.\n     */\n    [ObjectName.Sticker]?: ObjectDefaults;\n\n    /**\n     * Styles and behaviour for text added to image via pixie.\n     */\n    [ObjectName.Text]?: ObjectDefaults;\n  };\n\n  /**\n   * Visibility and behaviour of object controls.\n   */\n  objectControls?: {\n    /**\n     * Object controls and behaviour for all objects.\n     */\n    global?: ObjectControlConfig;\n\n    /**\n     * Object controls and behaviour for new basic shapes (circle, triangle etc.)\n     */\n    [ObjectName.Shape]?: ObjectControlConfig;\n\n    /**\n     * Object controls and behaviour for new stickers.\n     */\n    [ObjectName.Sticker]?: ObjectControlConfig;\n\n    /**\n     * Object controls and behaviour for text added to image via pixie.\n     */\n    [ObjectName.Text]?: ObjectControlConfig;\n  };\n\n  sentryDsn?: string;\n}\n\nexport const DEFAULT_CONFIG: PixieConfig = {\n  selector: 'pixie-editor',\n  textureSize: 4096,\n  activeLanguage: 'en',\n  ui: {\n    visible: true,\n    mode: EditorMode.INLINE,\n    forceOverlayModeOnMobile: true,\n    activeTheme: EditorTheme.LIGHT,\n    themes: DEFAULT_THEMES,\n    allowEditorClose: true,\n    menubar: {\n      items: [\n        {\n          type: 'undoWidget',\n          align: 'left',\n        },\n        {\n          type: 'zoomWidget',\n          align: 'center',\n          desktopOnly: true,\n        },\n        {\n          type: 'button',\n          icon: HistoryIcon,\n          align: 'right',\n          desktopOnly: true,\n          action: editor => {\n            editor.togglePanel('history');\n          },\n        },\n        {\n          type: 'button',\n          icon: FileDownloadIcon,\n          label: message('Done'),\n          align: 'right',\n          action: editor => {\n            if (editor.state.config.ui?.showExportPanel) {\n              editor.state.togglePanel('export', true);\n            } else {\n              editor.tools.export.save('image');\n            }\n          },\n        },\n      ],\n    },\n    nav: {\n      position: NavPosition.BOTTOM,\n      items: [...DEFAULT_NAV_ITEMS],\n    },\n    openImageDialog: {\n      show: true,\n      sampleImages: [\n        {\n          url: 'images/samples/sample1.jpg',\n          thumbnail: 'images/samples/sample1_thumbnail.jpg',\n        },\n        {\n          url: 'images/samples/sample2.jpg',\n          thumbnail: 'images/samples/sample2_thumbnail.jpg',\n        },\n        {\n          url: 'images/samples/sample3.jpg',\n          thumbnail: 'images/samples/sample3_thumbnail.jpg',\n        },\n      ],\n    },\n    colorPresets: {\n      items: [\n        'rgb(0,0,0)',\n        'rgb(255, 255, 255)',\n        'rgb(242, 38, 19)',\n        'rgb(249, 105, 14)',\n        'rgb(253, 227, 167)',\n        'rgb(4, 147, 114)',\n        'rgb(30, 139, 195)',\n        'rgb(142, 68, 173)',\n      ],\n    },\n  },\n  objectDefaults: {\n    global: {\n      ...defaultObjectProps,\n    },\n    sticker: {\n      fill: undefined,\n    },\n    text: {\n      textAlign: 'initial',\n      underline: false,\n      linethrough: false,\n      fontStyle: 'normal',\n      fontFamily: 'Times New Roman',\n      fontWeight: 'normal',\n      stroke: undefined,\n      fontSize: 40,\n    },\n  },\n  tools: {\n    filter: {\n      items: [\n        'grayscale',\n        'blackWhite',\n        'sharpen',\n        'invert',\n        'vintage',\n        'polaroid',\n        'kodachrome',\n        'technicolor',\n        'brownie',\n        'sepia',\n        'removeColor',\n        'brightness',\n        'gamma',\n        'noise',\n        'pixelate',\n        'blur',\n        'emboss',\n        'blendColor',\n      ],\n    },\n    zoom: {\n      allowUserZoom: true,\n      fitImageToScreen: true,\n    },\n    crop: {\n      allowCustomRatio: true,\n      defaultRatio: '1:1',\n      presets: [\n        {ratio: null, name: 'Custom'},\n        {ratio: '1:1', name: 'Square'},\n        {ratio: '4:3'},\n        {ratio: '16:9'},\n        {ratio: '5:3'},\n        {ratio: '5:4'},\n        {ratio: '6:4'},\n        {ratio: '7:5'},\n        {ratio: '10:8'},\n      ],\n    },\n    text: {\n      defaultText: 'Double click to edit',\n      items: [\n        {\n          family: 'Roboto',\n          src: 'fonts/open-sans-v27-latin-ext_latin-regular.woff2',\n        },\n        {\n          family: 'Fuzzy Bubbles',\n          src: 'fonts/fuzzy-bubbles-v3-latin-700.woff2',\n          descriptors: {weight: '700'},\n        },\n        {\n          family: 'Aleo Bold',\n          src: 'fonts/aleo-v4-latin-ext_latin-700.woff2',\n          descriptors: {weight: '700'},\n        },\n        {\n          family: 'Amatic SC',\n          src: 'fonts/amatic-sc-v16-latin-ext_latin-regular.woff2',\n        },\n        {\n          family: 'Corinthia Bold',\n          src: 'fonts/corinthia-v7-latin-ext_latin-700.woff2',\n        },\n        {\n          family: 'Bungee Inline',\n          src: 'fonts/bungee-inline-v6-latin-ext_latin-regular.woff2',\n        },\n        {\n          family: 'Robot Slab Bold',\n          src: 'fonts/roboto-slab-v16-latin-ext_latin-500.woff2',\n        },\n        {\n          family: 'Carter One',\n          src: 'fonts/carter-one-v12-latin-regular.woff2',\n        },\n        {\n          family: 'Cody Star',\n          src: 'fonts/codystar-v10-latin-ext_latin-regular.woff2',\n        },\n        {\n          family: 'Fira Sans',\n          src: 'fonts/fira-sans-v11-latin-ext_latin_cyrillic-regular.woff2',\n        },\n        {\n          family: 'Krona One',\n          src: 'fonts/krona-one-v9-latin-ext_latin-regular.woff2',\n        },\n        {\n          family: 'Kumar One Outline',\n          src: 'fonts/kumar-one-outline-v8-latin-ext_latin-regular.woff2',\n        },\n        {\n          family: 'Lobster Two',\n          src: 'fonts/lobster-two-v13-latin-regular.woff2',\n        },\n        {\n          family: 'Molle Italic',\n          src: 'fonts/molle-v11-latin-ext_latin-italic.woff2',\n        },\n        {\n          family: 'Monoton',\n          src: 'fonts/monoton-v10-latin-regular.woff2',\n        },\n        {\n          family: 'Nixie One',\n          src: 'fonts/nixie-one-v11-latin-regular.woff2',\n        },\n        {\n          family: 'Permanent Marker',\n          src: 'fonts/permanent-marker-v10-latin-regular.woff2',\n        },\n        {\n          family: 'Sancreek',\n          src: 'fonts/sancreek-v13-latin-ext_latin-regular.woff2',\n        },\n        {\n          family: 'Stint Ultra Expanded',\n          src: 'fonts/stint-ultra-expanded-v10-latin-regular.woff2',\n        },\n        {\n          family: 'VT323',\n          src: 'fonts/vt323-v12-latin-ext_latin-regular.woff2',\n        },\n        {\n          family: 'Trash Hand',\n          src: 'fonts/TrashHand.ttf',\n        },\n      ],\n    },\n    draw: {\n      brushSizes: BrushSizes,\n      brushTypes: BrushTypes,\n    },\n    shapes: {\n      items: defaultShapes.slice(),\n    },\n    stickers: {\n      items: defaultStickers,\n    },\n    import: {\n      validImgExtensions: ['png', 'jpg', 'jpeg', 'svg', 'gif'],\n      fitOverlayToScreen: true,\n      openDroppedImageAsBackground: false,\n    },\n    export: {\n      defaultFormat: 'png',\n      defaultQuality: 0.8,\n      defaultName: 'image',\n    },\n    frame: {\n      items: [\n        {\n          name: 'basic',\n          mode: 'basic',\n          size: {\n            min: 1,\n            max: 35,\n            default: 10,\n          },\n        },\n        {\n          name: 'pine',\n          mode: 'stretch',\n          size: {\n            min: 1,\n            max: 35,\n            default: 15,\n          },\n        },\n        {\n          name: 'oak',\n          mode: 'stretch',\n          size: {\n            min: 1,\n            max: 35,\n            default: 15,\n          },\n        },\n        {\n          name: 'rainbow',\n          mode: 'stretch',\n          size: {\n            min: 1,\n            max: 35,\n            default: 15,\n          },\n        },\n        {\n          name: 'grunge1',\n          display_name: 'grunge #1',\n          mode: 'stretch',\n          size: {\n            min: 1,\n            max: 35,\n            default: 15,\n          },\n        },\n        {\n          name: 'grunge2',\n          display_name: 'grunge #2',\n          mode: 'stretch',\n          size: {\n            min: 1,\n            max: 35,\n            default: 20,\n          },\n        },\n        {\n          name: 'ebony',\n          mode: 'stretch',\n          size: {\n            min: 1,\n            max: 35,\n            default: 15,\n          },\n        },\n        {\n          name: 'art1',\n          display_name: 'Art #1',\n          mode: 'repeat',\n          size: {\n            min: 10,\n            max: 70,\n            default: 55,\n          },\n        },\n        {\n          name: 'art2',\n          display_name: 'Art #2',\n          mode: 'repeat',\n          size: {\n            min: 10,\n            max: 70,\n            default: 55,\n          },\n        },\n      ],\n    },\n  },\n};\n","const createStoreImpl = (createState) => {\n  let state;\n  const listeners = /* @__PURE__ */ new Set();\n  const setState = (partial, replace) => {\n    const nextState = typeof partial === \"function\" ? partial(state) : partial;\n    if (nextState !== state) {\n      const previousState = state;\n      state = (replace != null ? replace : typeof nextState !== \"object\") ? nextState : Object.assign({}, state, nextState);\n      listeners.forEach((listener) => listener(state, previousState));\n    }\n  };\n  const getState = () => state;\n  const subscribe = (listener) => {\n    listeners.add(listener);\n    return () => listeners.delete(listener);\n  };\n  const destroy = () => listeners.clear();\n  const api = { setState, getState, subscribe, destroy };\n  state = createState(\n    setState,\n    getState,\n    api\n  );\n  return api;\n};\nconst createStore = (createState) => createState ? createStoreImpl(createState) : createStoreImpl;\n\nexport { createStore as default };\n","/**\n * @license React\n * use-sync-external-store-shim.production.min.js\n *\n * Copyright (c) Facebook, Inc. and its affiliates.\n *\n * This source code is licensed under the MIT license found in the\n * LICENSE file in the root directory of this source tree.\n */\n'use strict';var e=require(\"react\");function h(a,b){return a===b&&(0!==a||1/a===1/b)||a!==a&&b!==b}var k=\"function\"===typeof Object.is?Object.is:h,l=e.useState,m=e.useEffect,n=e.useLayoutEffect,p=e.useDebugValue;function q(a,b){var d=b(),f=l({inst:{value:d,getSnapshot:b}}),c=f[0].inst,g=f[1];n(function(){c.value=d;c.getSnapshot=b;r(c)&&g({inst:c})},[a,d,b]);m(function(){r(c)&&g({inst:c});return a(function(){r(c)&&g({inst:c})})},[a]);p(d);return d}\nfunction r(a){var b=a.getSnapshot;a=a.value;try{var d=b();return!k(a,d)}catch(f){return!0}}function t(a,b){return b()}var u=\"undefined\"===typeof window||\"undefined\"===typeof window.document||\"undefined\"===typeof window.document.createElement?t:q;exports.useSyncExternalStore=void 0!==e.useSyncExternalStore?e.useSyncExternalStore:u;\n","'use strict';\n\nif (process.env.NODE_ENV === 'production') {\n  module.exports = require('../cjs/use-sync-external-store-shim.production.min.js');\n} else {\n  module.exports = require('../cjs/use-sync-external-store-shim.development.js');\n}\n","/**\n * @license React\n * use-sync-external-store-shim/with-selector.production.min.js\n *\n * Copyright (c) Facebook, Inc. and its affiliates.\n *\n * This source code is licensed under the MIT license found in the\n * LICENSE file in the root directory of this source tree.\n */\n'use strict';var h=require(\"react\"),n=require(\"use-sync-external-store/shim\");function p(a,b){return a===b&&(0!==a||1/a===1/b)||a!==a&&b!==b}var q=\"function\"===typeof Object.is?Object.is:p,r=n.useSyncExternalStore,t=h.useRef,u=h.useEffect,v=h.useMemo,w=h.useDebugValue;\nexports.useSyncExternalStoreWithSelector=function(a,b,e,l,g){var c=t(null);if(null===c.current){var f={hasValue:!1,value:null};c.current=f}else f=c.current;c=v(function(){function a(a){if(!c){c=!0;d=a;a=l(a);if(void 0!==g&&f.hasValue){var b=f.value;if(g(b,a))return k=b}return k=a}b=k;if(q(d,a))return b;var e=l(a);if(void 0!==g&&g(b,e))return b;d=a;return k=e}var c=!1,d,k,m=void 0===e?null:e;return[function(){return a(b())},null===m?void 0:function(){return a(m())}]},[b,e,l,g]);var d=r(a,c[0],c[1]);\nu(function(){f.hasValue=!0;f.value=d},[d]);w(d);return d};\n","'use strict';\n\nif (process.env.NODE_ENV === 'production') {\n  module.exports = require('../cjs/use-sync-external-store-shim/with-selector.production.min.js');\n} else {\n  module.exports = require('../cjs/use-sync-external-store-shim/with-selector.development.js');\n}\n","import createStore__default from 'zustand/vanilla';\nexport * from 'zustand/vanilla';\nexport { default as createStore } from 'zustand/vanilla';\nimport { useDebugValue } from 'react';\nimport useSyncExternalStoreExports from 'use-sync-external-store/shim/with-selector.js';\n\nconst { useSyncExternalStoreWithSelector } = useSyncExternalStoreExports;\nfunction useStore(api, selector = api.getState, equalityFn) {\n  const slice = useSyncExternalStoreWithSelector(\n    api.subscribe,\n    api.getState,\n    api.getServerState || api.getState,\n    selector,\n    equalityFn\n  );\n  useDebugValue(slice);\n  return slice;\n}\nconst createImpl = (createState) => {\n  const api = typeof createState === \"function\" ? createStore__default(createState) : createState;\n  const useBoundStore = (selector, equalityFn) => useStore(api, selector, equalityFn);\n  Object.assign(useBoundStore, api);\n  return useBoundStore;\n};\nconst create = (createState) => createState ? createImpl(createState) : createImpl;\nvar create$1 = create;\n\nexport { create$1 as default, useStore };\n","const reduxImpl = (reducer, initial) => (set, _get, api) => {\n  api.dispatch = (action) => {\n    set((state) => reducer(state, action), false, action);\n    return action;\n  };\n  api.dispatchFromDevtools = true;\n  return { dispatch: (...a) => api.dispatch(...a), ...initial };\n};\nconst redux = reduxImpl;\n\nconst devtoolsImpl = (fn, devtoolsOptions = {}) => (set, get, api) => {\n  const { enabled, anonymousActionType, ...options } = devtoolsOptions;\n  let extensionConnector;\n  try {\n    extensionConnector = (enabled != null ? enabled : (import.meta.env && import.meta.env.MODE) !== \"production\") && window.__REDUX_DEVTOOLS_EXTENSION__;\n  } catch {\n  }\n  if (!extensionConnector) {\n    if ((import.meta.env && import.meta.env.MODE) !== \"production\" && enabled) {\n      console.warn(\n        \"[zustand devtools middleware] Please install/enable Redux devtools extension\"\n      );\n    }\n    return fn(set, get, api);\n  }\n  const extension = extensionConnector.connect(options);\n  let isRecording = true;\n  api.setState = (state, replace, nameOrAction) => {\n    const r = set(state, replace);\n    if (!isRecording)\n      return r;\n    extension.send(\n      nameOrAction === void 0 ? { type: anonymousActionType || \"anonymous\" } : typeof nameOrAction === \"string\" ? { type: nameOrAction } : nameOrAction,\n      get()\n    );\n    return r;\n  };\n  const setStateFromDevtools = (...a) => {\n    const originalIsRecording = isRecording;\n    isRecording = false;\n    set(...a);\n    isRecording = originalIsRecording;\n  };\n  const initialState = fn(api.setState, get, api);\n  extension.init(initialState);\n  if (api.dispatchFromDevtools && typeof api.dispatch === \"function\") {\n    let didWarnAboutReservedActionType = false;\n    const originalDispatch = api.dispatch;\n    api.dispatch = (...a) => {\n      if ((import.meta.env && import.meta.env.MODE) !== \"production\" && a[0].type === \"__setState\" && !didWarnAboutReservedActionType) {\n        console.warn(\n          '[zustand devtools middleware] \"__setState\" action type is reserved to set state from the devtools. Avoid using it.'\n        );\n        didWarnAboutReservedActionType = true;\n      }\n      originalDispatch(...a);\n    };\n  }\n  extension.subscribe((message) => {\n    var _a;\n    switch (message.type) {\n      case \"ACTION\":\n        if (typeof message.payload !== \"string\") {\n          console.error(\n            \"[zustand devtools middleware] Unsupported action format\"\n          );\n          return;\n        }\n        return parseJsonThen(\n          message.payload,\n          (action) => {\n            if (action.type === \"__setState\") {\n              setStateFromDevtools(action.state);\n              return;\n            }\n            if (!api.dispatchFromDevtools)\n              return;\n            if (typeof api.dispatch !== \"function\")\n              return;\n            api.dispatch(action);\n          }\n        );\n      case \"DISPATCH\":\n        switch (message.payload.type) {\n          case \"RESET\":\n            setStateFromDevtools(initialState);\n            return extension.init(api.getState());\n          case \"COMMIT\":\n            return extension.init(api.getState());\n          case \"ROLLBACK\":\n            return parseJsonThen(message.state, (state) => {\n              setStateFromDevtools(state);\n              extension.init(api.getState());\n            });\n          case \"JUMP_TO_STATE\":\n          case \"JUMP_TO_ACTION\":\n            return parseJsonThen(message.state, (state) => {\n              setStateFromDevtools(state);\n            });\n          case \"IMPORT_STATE\": {\n            const { nextLiftedState } = message.payload;\n            const lastComputedState = (_a = nextLiftedState.computedStates.slice(-1)[0]) == null ? void 0 : _a.state;\n            if (!lastComputedState)\n              return;\n            setStateFromDevtools(lastComputedState);\n            extension.send(\n              null,\n              nextLiftedState\n            );\n            return;\n          }\n          case \"PAUSE_RECORDING\":\n            return isRecording = !isRecording;\n        }\n        return;\n    }\n  });\n  return initialState;\n};\nconst devtools = devtoolsImpl;\nconst parseJsonThen = (stringified, f) => {\n  let parsed;\n  try {\n    parsed = JSON.parse(stringified);\n  } catch (e) {\n    console.error(\n      \"[zustand devtools middleware] Could not parse the received json\",\n      e\n    );\n  }\n  if (parsed !== void 0)\n    f(parsed);\n};\n\nconst subscribeWithSelectorImpl = (fn) => (set, get, api) => {\n  const origSubscribe = api.subscribe;\n  api.subscribe = (selector, optListener, options) => {\n    let listener = selector;\n    if (optListener) {\n      const equalityFn = (options == null ? void 0 : options.equalityFn) || Object.is;\n      let currentSlice = selector(api.getState());\n      listener = (state) => {\n        const nextSlice = selector(state);\n        if (!equalityFn(currentSlice, nextSlice)) {\n          const previousSlice = currentSlice;\n          optListener(currentSlice = nextSlice, previousSlice);\n        }\n      };\n      if (options == null ? void 0 : options.fireImmediately) {\n        optListener(currentSlice, currentSlice);\n      }\n    }\n    return origSubscribe(listener);\n  };\n  const initialState = fn(set, get, api);\n  return initialState;\n};\nconst subscribeWithSelector = subscribeWithSelectorImpl;\n\nconst combine = (initialState, create) => (...a) => Object.assign({}, initialState, create(...a));\n\nconst toThenable = (fn) => (input) => {\n  try {\n    const result = fn(input);\n    if (result instanceof Promise) {\n      return result;\n    }\n    return {\n      then(onFulfilled) {\n        return toThenable(onFulfilled)(result);\n      },\n      catch(_onRejected) {\n        return this;\n      }\n    };\n  } catch (e) {\n    return {\n      then(_onFulfilled) {\n        return this;\n      },\n      catch(onRejected) {\n        return toThenable(onRejected)(e);\n      }\n    };\n  }\n};\nconst persistImpl = (config, baseOptions) => (set, get, api) => {\n  let options = {\n    getStorage: () => localStorage,\n    serialize: JSON.stringify,\n    deserialize: JSON.parse,\n    partialize: (state) => state,\n    version: 0,\n    merge: (persistedState, currentState) => ({\n      ...currentState,\n      ...persistedState\n    }),\n    ...baseOptions\n  };\n  let hasHydrated = false;\n  const hydrationListeners = /* @__PURE__ */ new Set();\n  const finishHydrationListeners = /* @__PURE__ */ new Set();\n  let storage;\n  try {\n    storage = options.getStorage();\n  } catch (e) {\n  }\n  if (!storage) {\n    return config(\n      (...args) => {\n        console.warn(\n          `[zustand persist middleware] Unable to update item '${options.name}', the given storage is currently unavailable.`\n        );\n        set(...args);\n      },\n      get,\n      api\n    );\n  }\n  const thenableSerialize = toThenable(options.serialize);\n  const setItem = () => {\n    const state = options.partialize({ ...get() });\n    let errorInSync;\n    const thenable = thenableSerialize({ state, version: options.version }).then(\n      (serializedValue) => storage.setItem(options.name, serializedValue)\n    ).catch((e) => {\n      errorInSync = e;\n    });\n    if (errorInSync) {\n      throw errorInSync;\n    }\n    return thenable;\n  };\n  const savedSetState = api.setState;\n  api.setState = (state, replace) => {\n    savedSetState(state, replace);\n    void setItem();\n  };\n  const configResult = config(\n    (...args) => {\n      set(...args);\n      void setItem();\n    },\n    get,\n    api\n  );\n  let stateFromStorage;\n  const hydrate = () => {\n    var _a;\n    if (!storage)\n      return;\n    hasHydrated = false;\n    hydrationListeners.forEach((cb) => cb(get()));\n    const postRehydrationCallback = ((_a = options.onRehydrateStorage) == null ? void 0 : _a.call(options, get())) || void 0;\n    return toThenable(storage.getItem.bind(storage))(options.name).then((storageValue) => {\n      if (storageValue) {\n        return options.deserialize(storageValue);\n      }\n    }).then((deserializedStorageValue) => {\n      if (deserializedStorageValue) {\n        if (typeof deserializedStorageValue.version === \"number\" && deserializedStorageValue.version !== options.version) {\n          if (options.migrate) {\n            return options.migrate(\n              deserializedStorageValue.state,\n              deserializedStorageValue.version\n            );\n          }\n          console.error(\n            `State loaded from storage couldn't be migrated since no migrate function was provided`\n          );\n        } else {\n          return deserializedStorageValue.state;\n        }\n      }\n    }).then((migratedState) => {\n      var _a2;\n      stateFromStorage = options.merge(\n        migratedState,\n        (_a2 = get()) != null ? _a2 : configResult\n      );\n      set(stateFromStorage, true);\n      return setItem();\n    }).then(() => {\n      postRehydrationCallback == null ? void 0 : postRehydrationCallback(stateFromStorage, void 0);\n      hasHydrated = true;\n      finishHydrationListeners.forEach((cb) => cb(stateFromStorage));\n    }).catch((e) => {\n      postRehydrationCallback == null ? void 0 : postRehydrationCallback(void 0, e);\n    });\n  };\n  api.persist = {\n    setOptions: (newOptions) => {\n      options = {\n        ...options,\n        ...newOptions\n      };\n      if (newOptions.getStorage) {\n        storage = newOptions.getStorage();\n      }\n    },\n    clearStorage: () => {\n      storage == null ? void 0 : storage.removeItem(options.name);\n    },\n    getOptions: () => options,\n    rehydrate: () => hydrate(),\n    hasHydrated: () => hasHydrated,\n    onHydrate: (cb) => {\n      hydrationListeners.add(cb);\n      return () => {\n        hydrationListeners.delete(cb);\n      };\n    },\n    onFinishHydration: (cb) => {\n      finishHydrationListeners.add(cb);\n      return () => {\n        finishHydrationListeners.delete(cb);\n      };\n    }\n  };\n  hydrate();\n  return stateFromStorage || configResult;\n};\nconst persist = persistImpl;\n\nexport { combine, devtools, persist, redux, subscribeWithSelector };\n","function n(n){for(var r=arguments.length,t=Array(r>1?r-1:0),e=1;e<r;e++)t[e-1]=arguments[e];if(\"production\"!==process.env.NODE_ENV){var i=Y[n],o=i?\"function\"==typeof i?i.apply(null,t):i:\"unknown error nr: \"+n;throw Error(\"[Immer] \"+o)}throw Error(\"[Immer] minified error nr: \"+n+(t.length?\" \"+t.map((function(n){return\"'\"+n+\"'\"})).join(\",\"):\"\")+\". Find the full error at: https://bit.ly/3cXEKWf\")}function r(n){return!!n&&!!n[Q]}function t(n){return!!n&&(function(n){if(!n||\"object\"!=typeof n)return!1;var r=Object.getPrototypeOf(n);if(null===r)return!0;var t=Object.hasOwnProperty.call(r,\"constructor\")&&r.constructor;return t===Object||\"function\"==typeof t&&Function.toString.call(t)===Z}(n)||Array.isArray(n)||!!n[L]||!!n.constructor[L]||s(n)||v(n))}function e(t){return r(t)||n(23,t),t[Q].t}function i(n,r,t){void 0===t&&(t=!1),0===o(n)?(t?Object.keys:nn)(n).forEach((function(e){t&&\"symbol\"==typeof e||r(e,n[e],n)})):n.forEach((function(t,e){return r(e,t,n)}))}function o(n){var r=n[Q];return r?r.i>3?r.i-4:r.i:Array.isArray(n)?1:s(n)?2:v(n)?3:0}function u(n,r){return 2===o(n)?n.has(r):Object.prototype.hasOwnProperty.call(n,r)}function a(n,r){return 2===o(n)?n.get(r):n[r]}function f(n,r,t){var e=o(n);2===e?n.set(r,t):3===e?(n.delete(r),n.add(t)):n[r]=t}function c(n,r){return n===r?0!==n||1/n==1/r:n!=n&&r!=r}function s(n){return X&&n instanceof Map}function v(n){return q&&n instanceof Set}function p(n){return n.o||n.t}function l(n){if(Array.isArray(n))return Array.prototype.slice.call(n);var r=rn(n);delete r[Q];for(var t=nn(r),e=0;e<t.length;e++){var i=t[e],o=r[i];!1===o.writable&&(o.writable=!0,o.configurable=!0),(o.get||o.set)&&(r[i]={configurable:!0,writable:!0,enumerable:o.enumerable,value:n[i]})}return Object.create(Object.getPrototypeOf(n),r)}function d(n,e){return void 0===e&&(e=!1),y(n)||r(n)||!t(n)?n:(o(n)>1&&(n.set=n.add=n.clear=n.delete=h),Object.freeze(n),e&&i(n,(function(n,r){return d(r,!0)}),!0),n)}function h(){n(2)}function y(n){return null==n||\"object\"!=typeof n||Object.isFrozen(n)}function b(r){var t=tn[r];return t||n(18,r),t}function m(n,r){tn[n]||(tn[n]=r)}function _(){return\"production\"===process.env.NODE_ENV||U||n(0),U}function j(n,r){r&&(b(\"Patches\"),n.u=[],n.s=[],n.v=r)}function O(n){g(n),n.p.forEach(S),n.p=null}function g(n){n===U&&(U=n.l)}function w(n){return U={p:[],l:U,h:n,m:!0,_:0}}function S(n){var r=n[Q];0===r.i||1===r.i?r.j():r.O=!0}function P(r,e){e._=e.p.length;var i=e.p[0],o=void 0!==r&&r!==i;return e.h.g||b(\"ES5\").S(e,r,o),o?(i[Q].P&&(O(e),n(4)),t(r)&&(r=M(e,r),e.l||x(e,r)),e.u&&b(\"Patches\").M(i[Q].t,r,e.u,e.s)):r=M(e,i,[]),O(e),e.u&&e.v(e.u,e.s),r!==H?r:void 0}function M(n,r,t){if(y(r))return r;var e=r[Q];if(!e)return i(r,(function(i,o){return A(n,e,r,i,o,t)}),!0),r;if(e.A!==n)return r;if(!e.P)return x(n,e.t,!0),e.t;if(!e.I){e.I=!0,e.A._--;var o=4===e.i||5===e.i?e.o=l(e.k):e.o;i(3===e.i?new Set(o):o,(function(r,i){return A(n,e,o,r,i,t)})),x(n,o,!1),t&&n.u&&b(\"Patches\").R(e,t,n.u,n.s)}return e.o}function A(e,i,o,a,c,s){if(\"production\"!==process.env.NODE_ENV&&c===o&&n(5),r(c)){var v=M(e,c,s&&i&&3!==i.i&&!u(i.D,a)?s.concat(a):void 0);if(f(o,a,v),!r(v))return;e.m=!1}if(t(c)&&!y(c)){if(!e.h.F&&e._<1)return;M(e,c),i&&i.A.l||x(e,c)}}function x(n,r,t){void 0===t&&(t=!1),n.h.F&&n.m&&d(r,t)}function z(n,r){var t=n[Q];return(t?p(t):n)[r]}function I(n,r){if(r in n)for(var t=Object.getPrototypeOf(n);t;){var e=Object.getOwnPropertyDescriptor(t,r);if(e)return e;t=Object.getPrototypeOf(t)}}function k(n){n.P||(n.P=!0,n.l&&k(n.l))}function E(n){n.o||(n.o=l(n.t))}function R(n,r,t){var e=s(r)?b(\"MapSet\").N(r,t):v(r)?b(\"MapSet\").T(r,t):n.g?function(n,r){var t=Array.isArray(n),e={i:t?1:0,A:r?r.A:_(),P:!1,I:!1,D:{},l:r,t:n,k:null,o:null,j:null,C:!1},i=e,o=en;t&&(i=[e],o=on);var u=Proxy.revocable(i,o),a=u.revoke,f=u.proxy;return e.k=f,e.j=a,f}(r,t):b(\"ES5\").J(r,t);return(t?t.A:_()).p.push(e),e}function D(e){return r(e)||n(22,e),function n(r){if(!t(r))return r;var e,u=r[Q],c=o(r);if(u){if(!u.P&&(u.i<4||!b(\"ES5\").K(u)))return u.t;u.I=!0,e=F(r,c),u.I=!1}else e=F(r,c);return i(e,(function(r,t){u&&a(u.t,r)===t||f(e,r,n(t))})),3===c?new Set(e):e}(e)}function F(n,r){switch(r){case 2:return new Map(n);case 3:return Array.from(n)}return l(n)}function N(){function t(n,r){var t=s[n];return t?t.enumerable=r:s[n]=t={configurable:!0,enumerable:r,get:function(){var r=this[Q];return\"production\"!==process.env.NODE_ENV&&f(r),en.get(r,n)},set:function(r){var t=this[Q];\"production\"!==process.env.NODE_ENV&&f(t),en.set(t,n,r)}},t}function e(n){for(var r=n.length-1;r>=0;r--){var t=n[r][Q];if(!t.P)switch(t.i){case 5:a(t)&&k(t);break;case 4:o(t)&&k(t)}}}function o(n){for(var r=n.t,t=n.k,e=nn(t),i=e.length-1;i>=0;i--){var o=e[i];if(o!==Q){var a=r[o];if(void 0===a&&!u(r,o))return!0;var f=t[o],s=f&&f[Q];if(s?s.t!==a:!c(f,a))return!0}}var v=!!r[Q];return e.length!==nn(r).length+(v?0:1)}function a(n){var r=n.k;if(r.length!==n.t.length)return!0;var t=Object.getOwnPropertyDescriptor(r,r.length-1);if(t&&!t.get)return!0;for(var e=0;e<r.length;e++)if(!r.hasOwnProperty(e))return!0;return!1}function f(r){r.O&&n(3,JSON.stringify(p(r)))}var s={};m(\"ES5\",{J:function(n,r){var e=Array.isArray(n),i=function(n,r){if(n){for(var e=Array(r.length),i=0;i<r.length;i++)Object.defineProperty(e,\"\"+i,t(i,!0));return e}var o=rn(r);delete o[Q];for(var u=nn(o),a=0;a<u.length;a++){var f=u[a];o[f]=t(f,n||!!o[f].enumerable)}return Object.create(Object.getPrototypeOf(r),o)}(e,n),o={i:e?5:4,A:r?r.A:_(),P:!1,I:!1,D:{},l:r,t:n,k:i,o:null,O:!1,C:!1};return Object.defineProperty(i,Q,{value:o,writable:!0}),i},S:function(n,t,o){o?r(t)&&t[Q].A===n&&e(n.p):(n.u&&function n(r){if(r&&\"object\"==typeof r){var t=r[Q];if(t){var e=t.t,o=t.k,f=t.D,c=t.i;if(4===c)i(o,(function(r){r!==Q&&(void 0!==e[r]||u(e,r)?f[r]||n(o[r]):(f[r]=!0,k(t)))})),i(e,(function(n){void 0!==o[n]||u(o,n)||(f[n]=!1,k(t))}));else if(5===c){if(a(t)&&(k(t),f.length=!0),o.length<e.length)for(var s=o.length;s<e.length;s++)f[s]=!1;else for(var v=e.length;v<o.length;v++)f[v]=!0;for(var p=Math.min(o.length,e.length),l=0;l<p;l++)o.hasOwnProperty(l)||(f[l]=!0),void 0===f[l]&&n(o[l])}}}}(n.p[0]),e(n.p))},K:function(n){return 4===n.i?o(n):a(n)}})}function T(){function e(n){if(!t(n))return n;if(Array.isArray(n))return n.map(e);if(s(n))return new Map(Array.from(n.entries()).map((function(n){return[n[0],e(n[1])]})));if(v(n))return new Set(Array.from(n).map(e));var r=Object.create(Object.getPrototypeOf(n));for(var i in n)r[i]=e(n[i]);return u(n,L)&&(r[L]=n[L]),r}function f(n){return r(n)?e(n):n}var c=\"add\";m(\"Patches\",{$:function(r,t){return t.forEach((function(t){for(var i=t.path,u=t.op,f=r,s=0;s<i.length-1;s++){var v=o(f),p=\"\"+i[s];0!==v&&1!==v||\"__proto__\"!==p&&\"constructor\"!==p||n(24),\"function\"==typeof f&&\"prototype\"===p&&n(24),\"object\"!=typeof(f=a(f,p))&&n(15,i.join(\"/\"))}var l=o(f),d=e(t.value),h=i[i.length-1];switch(u){case\"replace\":switch(l){case 2:return f.set(h,d);case 3:n(16);default:return f[h]=d}case c:switch(l){case 1:return\"-\"===h?f.push(d):f.splice(h,0,d);case 2:return f.set(h,d);case 3:return f.add(d);default:return f[h]=d}case\"remove\":switch(l){case 1:return f.splice(h,1);case 2:return f.delete(h);case 3:return f.delete(t.value);default:return delete f[h]}default:n(17,u)}})),r},R:function(n,r,t,e){switch(n.i){case 0:case 4:case 2:return function(n,r,t,e){var o=n.t,s=n.o;i(n.D,(function(n,i){var v=a(o,n),p=a(s,n),l=i?u(o,n)?\"replace\":c:\"remove\";if(v!==p||\"replace\"!==l){var d=r.concat(n);t.push(\"remove\"===l?{op:l,path:d}:{op:l,path:d,value:p}),e.push(l===c?{op:\"remove\",path:d}:\"remove\"===l?{op:c,path:d,value:f(v)}:{op:\"replace\",path:d,value:f(v)})}}))}(n,r,t,e);case 5:case 1:return function(n,r,t,e){var i=n.t,o=n.D,u=n.o;if(u.length<i.length){var a=[u,i];i=a[0],u=a[1];var s=[e,t];t=s[0],e=s[1]}for(var v=0;v<i.length;v++)if(o[v]&&u[v]!==i[v]){var p=r.concat([v]);t.push({op:\"replace\",path:p,value:f(u[v])}),e.push({op:\"replace\",path:p,value:f(i[v])})}for(var l=i.length;l<u.length;l++){var d=r.concat([l]);t.push({op:c,path:d,value:f(u[l])})}i.length<u.length&&e.push({op:\"replace\",path:r.concat([\"length\"]),value:i.length})}(n,r,t,e);case 3:return function(n,r,t,e){var i=n.t,o=n.o,u=0;i.forEach((function(n){if(!o.has(n)){var i=r.concat([u]);t.push({op:\"remove\",path:i,value:n}),e.unshift({op:c,path:i,value:n})}u++})),u=0,o.forEach((function(n){if(!i.has(n)){var o=r.concat([u]);t.push({op:c,path:o,value:n}),e.unshift({op:\"remove\",path:o,value:n})}u++}))}(n,r,t,e)}},M:function(n,r,t,e){t.push({op:\"replace\",path:[],value:r===H?void 0:r}),e.push({op:\"replace\",path:[],value:n})}})}function C(){function r(n,r){function t(){this.constructor=n}a(n,r),n.prototype=(t.prototype=r.prototype,new t)}function e(n){n.o||(n.D=new Map,n.o=new Map(n.t))}function o(n){n.o||(n.o=new Set,n.t.forEach((function(r){if(t(r)){var e=R(n.A.h,r,n);n.p.set(r,e),n.o.add(e)}else n.o.add(r)})))}function u(r){r.O&&n(3,JSON.stringify(p(r)))}var a=function(n,r){return(a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,r){n.__proto__=r}||function(n,r){for(var t in r)r.hasOwnProperty(t)&&(n[t]=r[t])})(n,r)},f=function(){function n(n,r){return this[Q]={i:2,l:r,A:r?r.A:_(),P:!1,I:!1,o:void 0,D:void 0,t:n,k:this,C:!1,O:!1},this}r(n,Map);var o=n.prototype;return Object.defineProperty(o,\"size\",{get:function(){return p(this[Q]).size}}),o.has=function(n){return p(this[Q]).has(n)},o.set=function(n,r){var t=this[Q];return u(t),p(t).has(n)&&p(t).get(n)===r||(e(t),k(t),t.D.set(n,!0),t.o.set(n,r),t.D.set(n,!0)),this},o.delete=function(n){if(!this.has(n))return!1;var r=this[Q];return u(r),e(r),k(r),r.t.has(n)?r.D.set(n,!1):r.D.delete(n),r.o.delete(n),!0},o.clear=function(){var n=this[Q];u(n),p(n).size&&(e(n),k(n),n.D=new Map,i(n.t,(function(r){n.D.set(r,!1)})),n.o.clear())},o.forEach=function(n,r){var t=this;p(this[Q]).forEach((function(e,i){n.call(r,t.get(i),i,t)}))},o.get=function(n){var r=this[Q];u(r);var i=p(r).get(n);if(r.I||!t(i))return i;if(i!==r.t.get(n))return i;var o=R(r.A.h,i,r);return e(r),r.o.set(n,o),o},o.keys=function(){return p(this[Q]).keys()},o.values=function(){var n,r=this,t=this.keys();return(n={})[V]=function(){return r.values()},n.next=function(){var n=t.next();return n.done?n:{done:!1,value:r.get(n.value)}},n},o.entries=function(){var n,r=this,t=this.keys();return(n={})[V]=function(){return r.entries()},n.next=function(){var n=t.next();if(n.done)return n;var e=r.get(n.value);return{done:!1,value:[n.value,e]}},n},o[V]=function(){return this.entries()},n}(),c=function(){function n(n,r){return this[Q]={i:3,l:r,A:r?r.A:_(),P:!1,I:!1,o:void 0,t:n,k:this,p:new Map,O:!1,C:!1},this}r(n,Set);var t=n.prototype;return Object.defineProperty(t,\"size\",{get:function(){return p(this[Q]).size}}),t.has=function(n){var r=this[Q];return u(r),r.o?!!r.o.has(n)||!(!r.p.has(n)||!r.o.has(r.p.get(n))):r.t.has(n)},t.add=function(n){var r=this[Q];return u(r),this.has(n)||(o(r),k(r),r.o.add(n)),this},t.delete=function(n){if(!this.has(n))return!1;var r=this[Q];return u(r),o(r),k(r),r.o.delete(n)||!!r.p.has(n)&&r.o.delete(r.p.get(n))},t.clear=function(){var n=this[Q];u(n),p(n).size&&(o(n),k(n),n.o.clear())},t.values=function(){var n=this[Q];return u(n),o(n),n.o.values()},t.entries=function(){var n=this[Q];return u(n),o(n),n.o.entries()},t.keys=function(){return this.values()},t[V]=function(){return this.values()},t.forEach=function(n,r){for(var t=this.values(),e=t.next();!e.done;)n.call(r,e.value,e.value,this),e=t.next()},n}();m(\"MapSet\",{N:function(n,r){return new f(n,r)},T:function(n,r){return new c(n,r)}})}function J(){N(),C(),T()}function K(n){return n}function $(n){return n}var G,U,W=\"undefined\"!=typeof Symbol&&\"symbol\"==typeof Symbol(\"x\"),X=\"undefined\"!=typeof Map,q=\"undefined\"!=typeof Set,B=\"undefined\"!=typeof Proxy&&void 0!==Proxy.revocable&&\"undefined\"!=typeof Reflect,H=W?Symbol.for(\"immer-nothing\"):((G={})[\"immer-nothing\"]=!0,G),L=W?Symbol.for(\"immer-draftable\"):\"__$immer_draftable\",Q=W?Symbol.for(\"immer-state\"):\"__$immer_state\",V=\"undefined\"!=typeof Symbol&&Symbol.iterator||\"@@iterator\",Y={0:\"Illegal state\",1:\"Immer drafts cannot have computed properties\",2:\"This object has been frozen and should not be mutated\",3:function(n){return\"Cannot use a proxy that has been revoked. Did you pass an object from inside an immer function to an async process? \"+n},4:\"An immer producer returned a new value *and* modified its draft. Either return a new value *or* modify the draft.\",5:\"Immer forbids circular references\",6:\"The first or second argument to `produce` must be a function\",7:\"The third argument to `produce` must be a function or undefined\",8:\"First argument to `createDraft` must be a plain object, an array, or an immerable object\",9:\"First argument to `finishDraft` must be a draft returned by `createDraft`\",10:\"The given draft is already finalized\",11:\"Object.defineProperty() cannot be used on an Immer draft\",12:\"Object.setPrototypeOf() cannot be used on an Immer draft\",13:\"Immer only supports deleting array indices\",14:\"Immer only supports setting array indices and the 'length' property\",15:function(n){return\"Cannot apply patch, path doesn't resolve: \"+n},16:'Sets cannot have \"replace\" patches.',17:function(n){return\"Unsupported patch operation: \"+n},18:function(n){return\"The plugin for '\"+n+\"' has not been loaded into Immer. To enable the plugin, import and call `enable\"+n+\"()` when initializing your application.\"},20:\"Cannot use proxies if Proxy, Proxy.revocable or Reflect are not available\",21:function(n){return\"produce can only be called on things that are draftable: plain objects, arrays, Map, Set or classes that are marked with '[immerable]: true'. Got '\"+n+\"'\"},22:function(n){return\"'current' expects a draft, got: \"+n},23:function(n){return\"'original' expects a draft, got: \"+n},24:\"Patching reserved attributes like __proto__, prototype and constructor is not allowed\"},Z=\"\"+Object.prototype.constructor,nn=\"undefined\"!=typeof Reflect&&Reflect.ownKeys?Reflect.ownKeys:void 0!==Object.getOwnPropertySymbols?function(n){return Object.getOwnPropertyNames(n).concat(Object.getOwnPropertySymbols(n))}:Object.getOwnPropertyNames,rn=Object.getOwnPropertyDescriptors||function(n){var r={};return nn(n).forEach((function(t){r[t]=Object.getOwnPropertyDescriptor(n,t)})),r},tn={},en={get:function(n,r){if(r===Q)return n;var e=p(n);if(!u(e,r))return function(n,r,t){var e,i=I(r,t);return i?\"value\"in i?i.value:null===(e=i.get)||void 0===e?void 0:e.call(n.k):void 0}(n,e,r);var i=e[r];return n.I||!t(i)?i:i===z(n.t,r)?(E(n),n.o[r]=R(n.A.h,i,n)):i},has:function(n,r){return r in p(n)},ownKeys:function(n){return Reflect.ownKeys(p(n))},set:function(n,r,t){var e=I(p(n),r);if(null==e?void 0:e.set)return e.set.call(n.k,t),!0;if(!n.P){var i=z(p(n),r),o=null==i?void 0:i[Q];if(o&&o.t===t)return n.o[r]=t,n.D[r]=!1,!0;if(c(t,i)&&(void 0!==t||u(n.t,r)))return!0;E(n),k(n)}return n.o[r]===t&&\"number\"!=typeof t&&(void 0!==t||r in n.o)||(n.o[r]=t,n.D[r]=!0,!0)},deleteProperty:function(n,r){return void 0!==z(n.t,r)||r in n.t?(n.D[r]=!1,E(n),k(n)):delete n.D[r],n.o&&delete n.o[r],!0},getOwnPropertyDescriptor:function(n,r){var t=p(n),e=Reflect.getOwnPropertyDescriptor(t,r);return e?{writable:!0,configurable:1!==n.i||\"length\"!==r,enumerable:e.enumerable,value:t[r]}:e},defineProperty:function(){n(11)},getPrototypeOf:function(n){return Object.getPrototypeOf(n.t)},setPrototypeOf:function(){n(12)}},on={};i(en,(function(n,r){on[n]=function(){return arguments[0]=arguments[0][0],r.apply(this,arguments)}})),on.deleteProperty=function(r,t){return\"production\"!==process.env.NODE_ENV&&isNaN(parseInt(t))&&n(13),on.set.call(this,r,t,void 0)},on.set=function(r,t,e){return\"production\"!==process.env.NODE_ENV&&\"length\"!==t&&isNaN(parseInt(t))&&n(14),en.set.call(this,r[0],t,e,r[0])};var un=function(){function e(r){var e=this;this.g=B,this.F=!0,this.produce=function(r,i,o){if(\"function\"==typeof r&&\"function\"!=typeof i){var u=i;i=r;var a=e;return function(n){var r=this;void 0===n&&(n=u);for(var t=arguments.length,e=Array(t>1?t-1:0),o=1;o<t;o++)e[o-1]=arguments[o];return a.produce(n,(function(n){var t;return(t=i).call.apply(t,[r,n].concat(e))}))}}var f;if(\"function\"!=typeof i&&n(6),void 0!==o&&\"function\"!=typeof o&&n(7),t(r)){var c=w(e),s=R(e,r,void 0),v=!0;try{f=i(s),v=!1}finally{v?O(c):g(c)}return\"undefined\"!=typeof Promise&&f instanceof Promise?f.then((function(n){return j(c,o),P(n,c)}),(function(n){throw O(c),n})):(j(c,o),P(f,c))}if(!r||\"object\"!=typeof r){if(void 0===(f=i(r))&&(f=r),f===H&&(f=void 0),e.F&&d(f,!0),o){var p=[],l=[];b(\"Patches\").M(r,f,p,l),o(p,l)}return f}n(21,r)},this.produceWithPatches=function(n,r){if(\"function\"==typeof n)return function(r){for(var t=arguments.length,i=Array(t>1?t-1:0),o=1;o<t;o++)i[o-1]=arguments[o];return e.produceWithPatches(r,(function(r){return n.apply(void 0,[r].concat(i))}))};var t,i,o=e.produce(n,r,(function(n,r){t=n,i=r}));return\"undefined\"!=typeof Promise&&o instanceof Promise?o.then((function(n){return[n,t,i]})):[o,t,i]},\"boolean\"==typeof(null==r?void 0:r.useProxies)&&this.setUseProxies(r.useProxies),\"boolean\"==typeof(null==r?void 0:r.autoFreeze)&&this.setAutoFreeze(r.autoFreeze)}var i=e.prototype;return i.createDraft=function(e){t(e)||n(8),r(e)&&(e=D(e));var i=w(this),o=R(this,e,void 0);return o[Q].C=!0,g(i),o},i.finishDraft=function(r,t){var e=r&&r[Q];\"production\"!==process.env.NODE_ENV&&(e&&e.C||n(9),e.I&&n(10));var i=e.A;return j(i,t),P(void 0,i)},i.setAutoFreeze=function(n){this.F=n},i.setUseProxies=function(r){r&&!B&&n(20),this.g=r},i.applyPatches=function(n,t){var e;for(e=t.length-1;e>=0;e--){var i=t[e];if(0===i.path.length&&\"replace\"===i.op){n=i.value;break}}e>-1&&(t=t.slice(e+1));var o=b(\"Patches\").$;return r(n)?o(n,t):this.produce(n,(function(n){return o(n,t)}))},e}(),an=new un,fn=an.produce,cn=an.produceWithPatches.bind(an),sn=an.setAutoFreeze.bind(an),vn=an.setUseProxies.bind(an),pn=an.applyPatches.bind(an),ln=an.createDraft.bind(an),dn=an.finishDraft.bind(an);export default fn;export{un as Immer,pn as applyPatches,K as castDraft,$ as castImmutable,ln as createDraft,D as current,J as enableAllPlugins,N as enableES5,C as enableMapSet,T as enablePatches,dn as finishDraft,d as freeze,L as immerable,r as isDraft,t as isDraftable,H as nothing,e as original,fn as produce,cn as produceWithPatches,sn as setAutoFreeze,vn as setUseProxies};\n//# sourceMappingURL=immer.esm.js.map\n","export function lowerFirst(string: string): string {\n  if (!string) return '';\n  return string.charAt(0).toLowerCase() + string.slice(1);\n}\n","import deepmerge from 'deepmerge';\nimport {PixieConfig} from './default-config';\nimport {lowerFirst} from '../common/utils/string/lower-first';\n\nexport function mergeConfig(\n  userConfig: Partial<PixieConfig>,\n  currentConfig: PixieConfig\n): PixieConfig {\n  const merged = deepmerge(currentConfig, userConfig);\n  return replaceDefaultConfigItems(merged, userConfig) as PixieConfig;\n}\n\nfunction replaceDefaultConfigItems(\n  config: Record<string, any>,\n  userConfig: Record<string, any> | undefined\n) {\n  Object.keys(config).forEach(key => {\n    if (key.startsWith('replaceDefault') && config[key]) {\n      // \"replaceDefaultSamples\" => \"samples\" or just \"items\"\n      const iterablesKey = lowerFirst(\n        key.replace('replaceDefault', '') || 'items'\n      );\n      config[iterablesKey] = userConfig ? userConfig[iterablesKey] : [];\n      // remove passed in \"replaceDefaultItems\" option, so\n      // it does not cause issues on subsequent config merged\n      delete config[key];\n    } else if (typeof config[key] === 'object' && config[key] !== null) {\n      replaceDefaultConfigItems(config[key], userConfig?.[key]);\n    }\n  });\n  return config;\n}\n","import {castDraft} from 'immer';\nimport {HistoryItem} from '../history-item.interface';\nimport type {StoreSlice} from '../../../state/store';\n\nexport interface HistorySlice {\n  history: {\n    items: HistoryItem[];\n    pointer: number;\n    canUndo: boolean;\n    canRedo: boolean;\n    updatePointerById: (id: string) => void;\n    update: (pointer: number, items?: HistoryItem[]) => void;\n    reset: () => void;\n  };\n}\n\nexport const createHistorySlice: StoreSlice<HistorySlice> = (set, get) => ({\n  history: {\n    ...historySliceDefaults,\n    updatePointerById: id => {\n      const index = get().history.items.findIndex(i => i.id === id);\n      get().history.update(index);\n    },\n    update: (pointer, items) => {\n      set(state => {\n        state.history.pointer = pointer;\n        if (items) {\n          state.history.items = castDraft(items);\n        }\n        state.history.canUndo = state.history.pointer > 0;\n        state.history.canRedo =\n          state.history.items.length > state.history.pointer + 1;\n      });\n    },\n    reset: () => {\n      set({history: {...get().history, ...historySliceDefaults}});\n    },\n  },\n});\n\nconst historySliceDefaults = {\n  items: [],\n  pointer: 0,\n  canUndo: false,\n  canRedo: false,\n};\n","import {Canvas} from 'fabric/fabric-impl';\nimport type {Pixie} from '../pixie';\nimport type {PixieConfig} from '../config/default-config';\nimport type {PlainRect} from '../common/utils/dom/get-bounding-client-rect';\nimport type {ToolName} from '../tools/tool-name';\nimport {RefObject} from 'react';\nimport {BootstrapData} from '../common/core/bootstrap-data/bootstrap-data';\n\nexport type LoadingType = 'newCanvas' | 'mainImage' | 'state' | 'merge' | false;\n\nexport enum ActiveToolOverlay {\n  Filter = 'filter',\n  Frame = 'frame',\n  ActiveObject = 'activeObj',\n  Text = 'text',\n}\n\nexport type EditorState = {\n  editor: Pixie;\n  fabric: Canvas;\n  config: PixieConfig;\n  setConfig: (partialConfig: Partial<PixieConfig>) => void;\n  bootstrapData: Partial<BootstrapData>;\n  loading: LoadingType;\n  openPanels: {\n    newImage: boolean;\n    history: boolean;\n    objects: boolean;\n    export: boolean;\n  };\n  zoom: number;\n  // original width and height, either size of main image or user selected\n  original: {\n    width: number;\n    height: number;\n  };\n  stageSize: PlainRect;\n  canvasSize: PlainRect;\n  setCanvasSize: (size: PlainRect) => void;\n  canvasRef: RefObject<HTMLElement> | null;\n  activeTool: ToolName | null;\n  activeToolOverlay: ActiveToolOverlay | null;\n  dirty: boolean;\n\n  cancelChanges: () => void;\n  applyChanges: () => void;\n  setZoom: (zoom: number) => void;\n  setOriginal: (width: number, height: number) => void;\n  setDirty: (isDirty: boolean) => void;\n  toggleLoading: (loading: LoadingType) => void;\n  setStageSize: (size: PlainRect) => void;\n  togglePanel: (\n    name: keyof EditorState['openPanels'],\n    isOpen?: boolean\n  ) => void;\n  setActiveTool: (\n    tool: ToolName | null,\n    overlay: ActiveToolOverlay | null\n  ) => void;\n  reset: () => void;\n};\n","import type {StoreSlice} from '../../state/store';\nimport {ToolSlice} from '../../state/tool-slice';\nimport {ActiveToolOverlay} from '../../state/editor-state';\n\nexport interface FilterSlice {\n  filter: ToolSlice & {\n    selected: string | null;\n    applied: string[];\n    select: (selected: string, hasOptions?: boolean) => void;\n    deselect: (filterName: string) => void;\n  };\n}\n\nexport const createFilterSlice: StoreSlice<FilterSlice> = (set, get) => ({\n  filter: {\n    ...filterSliceDefaults,\n    select(filterName, hasOptions = false) {\n      set(state => {\n        state.filter.selected = filterName;\n        state.activeToolOverlay = hasOptions ? ActiveToolOverlay.Filter : null;\n        state.dirty = true;\n      });\n    },\n    deselect(filterName: string) {\n      if (get().filter.selected === filterName) {\n        set(state => {\n          state.filter.selected = null;\n          state.activeToolOverlay = null;\n          state.dirty = true;\n        });\n      }\n    },\n    reset() {\n      set({filter: {...get().filter, ...filterSliceDefaults}});\n    },\n  },\n});\n\nconst filterSliceDefaults = {\n  selected: null,\n  applied: [],\n};\n","import type {StoreSlice} from '../../state/store';\nimport {ToolSlice} from '../../state/tool-slice';\nimport {InteractableRect} from '../../common/ui/interactions/interactable-event';\n\nexport interface CropSlice {\n  crop: ToolSlice & {\n    zoneRect: InteractableRect | null;\n    selectedAspectRatio: string | null;\n    straightenAngle: number;\n\n    setCropzoneRect: (rect: InteractableRect) => void;\n    setAspectRatio: (ratio: string | null) => void;\n    setTransformAngle: (angle: number) => void;\n  };\n}\nexport const createCropSlice: StoreSlice<CropSlice> = (set, get) => ({\n  crop: {\n    ...cropSliceDefaults,\n    setCropzoneRect: rect => {\n      set(state => {\n        state.crop.zoneRect = rect;\n      });\n    },\n    setAspectRatio: ratio => {\n      set(state => {\n        state.crop.selectedAspectRatio = ratio;\n      });\n    },\n    setTransformAngle: angle => {\n      set(state => {\n        state.crop.straightenAngle = angle;\n      });\n    },\n    apply: async () => {\n      const rect = get().crop.zoneRect;\n      if (rect) {\n        const scaledRect = {\n          width: Math.ceil(rect.width / get().zoom),\n          height: Math.ceil(rect.height / get().zoom),\n          left: Math.ceil(rect.left / get().zoom),\n          top: Math.ceil(rect.top / get().zoom),\n        };\n        await get().editor.tools.crop.apply(scaledRect);\n      }\n    },\n    reset: () => {\n      set({crop: {...get().crop, ...cropSliceDefaults}});\n    },\n  },\n});\n\nconst cropSliceDefaults = {\n  zoneRect: null,\n  selectedAspectRatio: null,\n  straightenAngle: 0,\n};\n","import {IObjectOptions, IText, Object} from 'fabric/fabric-impl';\n\nexport function isText(\n  obj: Object | IObjectOptions | null | undefined\n): obj is IText {\n  return obj?.type === 'i-text';\n}\n","import {HISTORY_DISPLAY_NAMES} from '../tools/history/history-display-names';\nimport {message} from '../common/i18n/message';\n\nexport enum ObjectName {\n  Text = 'text',\n  Shape = 'shape',\n  Sticker = 'sticker',\n  Drawing = 'drawing',\n  Image = 'image',\n  MainImage = 'mainImage',\n  StraightenAnchor = 'straightenHelper',\n}\n\nexport const OBJ_DISPLAY_NAMES = {\n  [ObjectName.Text]: {\n    name: message('Text'),\n    icon: HISTORY_DISPLAY_NAMES.text.icon,\n  },\n  [ObjectName.Shape]: {\n    name: message('Shape'),\n    icon: HISTORY_DISPLAY_NAMES.shapes.icon,\n  },\n  [ObjectName.Sticker]: {\n    name: message('Sticker'),\n    icon: HISTORY_DISPLAY_NAMES.stickers.icon,\n  },\n  [ObjectName.Drawing]: {\n    name: message('Drawing'),\n    icon: HISTORY_DISPLAY_NAMES.draw.icon,\n  },\n  [ObjectName.Image]: {\n    name: message('Image'),\n    icon: HISTORY_DISPLAY_NAMES.overlayImage.icon,\n  },\n  [ObjectName.MainImage]: {\n    name: message('Background Image'),\n    icon: HISTORY_DISPLAY_NAMES.bgImage.icon,\n  },\n};\n","import {Image, Object} from 'fabric/fabric-impl';\nimport {ObjectName} from '../object-name';\n\nexport function isImage(obj: Object): obj is Image {\n  return obj.name === ObjectName.Image;\n}\n","import type {ObjectsSlice} from './objects-slice';\n\nexport const DEFAULT_ACTIVE_OBJ_PROPS: ObjectsSlice['objects']['active'] = {\n  isMoving: false,\n  editableProps: {},\n  id: null,\n  isText: false,\n  isImage: false,\n  name: null,\n};\n","import {Object, Shadow} from 'fabric/fabric-impl';\nimport {isText} from '../utils/is-text';\nimport {EditableObjProps} from './editable-obj-props';\nimport {TextAlign} from './text-align';\n\nexport function fabricObjToState(obj: Object): EditableObjProps {\n  if (!obj) return {};\n\n  const props: EditableObjProps = {\n    fill: obj.fill,\n    opacity: obj.opacity,\n    backgroundColor: obj.backgroundColor,\n    stroke: obj.stroke,\n    strokeWidth: obj.strokeWidth,\n  };\n\n  const shadow = obj.shadow as Shadow | null;\n  if (shadow) {\n    props.shadow = {\n      color: shadow.color,\n      blur: shadow.blur,\n      offsetX: shadow.offsetX,\n      offsetY: shadow.offsetY,\n    };\n  }\n\n  if (isText(obj)) {\n    props.textAlign = obj.textAlign as TextAlign;\n    props.underline = obj.underline;\n    props.linethrough = obj.linethrough;\n    props.fontStyle = obj.fontStyle;\n    props.fontFamily = obj.fontFamily;\n    props.fontWeight = obj.fontWeight;\n    props.fontSize = obj.fontSize;\n  }\n\n  return props;\n}\n","import {Object} from 'fabric/fabric-impl';\nimport {castDraft} from 'immer';\nimport type {StoreSlice} from '../../state/store';\nimport {isText} from '../utils/is-text';\nimport {ObjectName} from '../object-name';\nimport {isImage} from '../utils/is-image';\nimport {DEFAULT_ACTIVE_OBJ_PROPS} from './default-active-obj-props';\nimport {fabricObjToState} from './fabric-obj-to-state';\nimport type {EditableObjProps} from './editable-obj-props';\nimport {PartialObject} from './partial-object';\n\nexport interface ObjectsSlice {\n  objects: {\n    all: PartialObject[];\n    isEditingText: boolean;\n    active: {\n      id: string | null;\n      isText: boolean;\n      isImage: boolean;\n      editableProps: Partial<EditableObjProps>;\n      isMoving: boolean;\n      name: ObjectName | null;\n    };\n\n    setActive: (obj: Object | null) => void;\n    setActiveIsMoving: (value: boolean) => void;\n    setIsEditingText: (value: boolean) => void;\n    reset: () => void;\n  };\n}\n\nexport const createObjectsSlice: StoreSlice<ObjectsSlice> = (set, get) => ({\n  objects: {\n    ...objectsSliceDefaults,\n    setActiveIsMoving: (value: boolean) => {\n      set(state => {\n        state.objects.active.isMoving = value;\n      });\n    },\n    setIsEditingText: (value: boolean) => {\n      set(state => {\n        state.objects.isEditingText = value;\n      });\n    },\n    setActive: obj => {\n      if (obj) {\n        set(state => {\n          state.objects.active.editableProps = castDraft(fabricObjToState(obj));\n          state.objects.active.id = obj.data.id;\n          state.objects.active.name = (obj.name as ObjectName) ?? null;\n          state.objects.active.isText = isText(obj);\n          state.objects.active.isImage = isImage(obj);\n        });\n      } else {\n        set(state => {\n          const defaultEditableProps = {\n            ...get().config.objectDefaults?.global,\n            fontFamily: get().config.objectDefaults?.text?.fontFamily,\n            fontSize: get().config.objectDefaults?.text?.fontSize,\n          };\n          state.objects.active = {\n            ...DEFAULT_ACTIVE_OBJ_PROPS,\n            editableProps: defaultEditableProps,\n          };\n        });\n      }\n    },\n    reset() {\n      set({objects: {...get().objects, ...objectsSliceDefaults}});\n    },\n  },\n});\n\nconst objectsSliceDefaults = {\n  all: [],\n  isEditingText: false,\n  active: DEFAULT_ACTIVE_OBJ_PROPS,\n};\n","import type {StoreSlice} from '../../state/store';\nimport {Frame} from './frame';\nimport {ToolSlice} from '../../state/tool-slice';\nimport {ToolName} from '../tool-name';\nimport {ActiveToolOverlay} from '../../state/editor-state';\n\nexport interface FrameSlice {\n  frame: ToolSlice & {\n    active: Frame | null;\n    select: (frame: Frame) => void;\n    deselect: () => void;\n    showOptionsPanel: () => void;\n  };\n}\n\nexport const createFrameSlice: StoreSlice<FrameSlice> = (set, get) => ({\n  frame: {\n    ...frameSliceDefaults,\n    select: frame => {\n      set(state => {\n        state.frame.active = frame;\n      });\n      get().frame.showOptionsPanel();\n    },\n    deselect: () => {\n      set(state => {\n        state.frame.active = null;\n        state.activeToolOverlay = null;\n      });\n    },\n    showOptionsPanel: () => {\n      if (get().activeTool === ToolName.FRAME) {\n        set(state => {\n          state.activeToolOverlay = ActiveToolOverlay.Frame;\n        });\n      }\n    },\n    reset() {\n      set({frame: {...get().frame, ...frameSliceDefaults}});\n    },\n  },\n});\n\nconst frameSliceDefaults = {\n  active: null,\n};\n","import type {StoreSlice} from '../../../state/store';\nimport {ToolSlice} from '../../../state/tool-slice';\n\ninterface ResizeFormValue {\n  width: number;\n  height: number;\n  maintainAspect: boolean;\n  usePercentages: boolean;\n}\n\nexport interface ResizeSlice {\n  resize: ToolSlice & {\n    formValue: ResizeFormValue;\n    setFormValue: (val: Partial<ResizeFormValue>) => void;\n    reset: () => void;\n  };\n}\n\nexport const createResizeSlice: StoreSlice<ResizeSlice> = (set, get) => ({\n  resize: {\n    ...resizeSliceDefaults,\n    setFormValue: value => {\n      set(state => {\n        Object.entries(value).forEach(([k, v]) => {\n          // @ts-ignore\n          state.resize.formValue[k] = v;\n        });\n      });\n    },\n    apply() {\n      const newSize = get().resize.formValue;\n      const oldSize = get().original;\n      // no need to add history item if we did not apply resize\n      if (\n        newSize.width === oldSize.width &&\n        newSize.height === oldSize.height\n      ) {\n        return false;\n      }\n      get().editor.tools.resize.apply(newSize);\n    },\n    reset() {\n      set({resize: {...get().resize, ...resizeSliceDefaults}});\n    },\n  },\n});\n\nconst resizeSliceDefaults = {\n  formValue: {\n    width: 1,\n    height: 1,\n    maintainAspect: true,\n    usePercentages: false,\n  },\n};\n","import {ToolSlice} from '../../state/tool-slice';\nimport type {StoreSlice} from '../../state/store';\n\nexport interface CornersSlice {\n  corners: ToolSlice & {\n    radius: number;\n    setRadius: (radius: number) => void;\n  };\n}\n\nexport const createCornersSlice: StoreSlice<CornersSlice> = (set, get) => ({\n  corners: {\n    ...cornerSliceDefaults,\n    setRadius: newRadius => {\n      set(s => {\n        s.corners.radius = newRadius;\n      });\n    },\n    apply() {\n      return get().editor.tools.corners.apply(get().corners.radius);\n    },\n    reset() {\n      set({corners: {...get().corners, ...cornerSliceDefaults}});\n    },\n  },\n});\n\nconst cornerSliceDefaults = {\n  radius: 50,\n};\n","import { produce } from 'immer';\n\nconst immerImpl = (initializer) => (set, get, store) => {\n  store.setState = (updater, replace, ...a) => {\n    const nextState = typeof updater === \"function\" ? produce(updater) : updater;\n    return set(nextState, replace, ...a);\n  };\n  return initializer(store.setState, get, store);\n};\nconst immer = immerImpl;\n\nexport { immer };\n","'use strict'\r\n\r\nmodule.exports = {\r\n\t\"aliceblue\": [240, 248, 255],\r\n\t\"antiquewhite\": [250, 235, 215],\r\n\t\"aqua\": [0, 255, 255],\r\n\t\"aquamarine\": [127, 255, 212],\r\n\t\"azure\": [240, 255, 255],\r\n\t\"beige\": [245, 245, 220],\r\n\t\"bisque\": [255, 228, 196],\r\n\t\"black\": [0, 0, 0],\r\n\t\"blanchedalmond\": [255, 235, 205],\r\n\t\"blue\": [0, 0, 255],\r\n\t\"blueviolet\": [138, 43, 226],\r\n\t\"brown\": [165, 42, 42],\r\n\t\"burlywood\": [222, 184, 135],\r\n\t\"cadetblue\": [95, 158, 160],\r\n\t\"chartreuse\": [127, 255, 0],\r\n\t\"chocolate\": [210, 105, 30],\r\n\t\"coral\": [255, 127, 80],\r\n\t\"cornflowerblue\": [100, 149, 237],\r\n\t\"cornsilk\": [255, 248, 220],\r\n\t\"crimson\": [220, 20, 60],\r\n\t\"cyan\": [0, 255, 255],\r\n\t\"darkblue\": [0, 0, 139],\r\n\t\"darkcyan\": [0, 139, 139],\r\n\t\"darkgoldenrod\": [184, 134, 11],\r\n\t\"darkgray\": [169, 169, 169],\r\n\t\"darkgreen\": [0, 100, 0],\r\n\t\"darkgrey\": [169, 169, 169],\r\n\t\"darkkhaki\": [189, 183, 107],\r\n\t\"darkmagenta\": [139, 0, 139],\r\n\t\"darkolivegreen\": [85, 107, 47],\r\n\t\"darkorange\": [255, 140, 0],\r\n\t\"darkorchid\": [153, 50, 204],\r\n\t\"darkred\": [139, 0, 0],\r\n\t\"darksalmon\": [233, 150, 122],\r\n\t\"darkseagreen\": [143, 188, 143],\r\n\t\"darkslateblue\": [72, 61, 139],\r\n\t\"darkslategray\": [47, 79, 79],\r\n\t\"darkslategrey\": [47, 79, 79],\r\n\t\"darkturquoise\": [0, 206, 209],\r\n\t\"darkviolet\": [148, 0, 211],\r\n\t\"deeppink\": [255, 20, 147],\r\n\t\"deepskyblue\": [0, 191, 255],\r\n\t\"dimgray\": [105, 105, 105],\r\n\t\"dimgrey\": [105, 105, 105],\r\n\t\"dodgerblue\": [30, 144, 255],\r\n\t\"firebrick\": [178, 34, 34],\r\n\t\"floralwhite\": [255, 250, 240],\r\n\t\"forestgreen\": [34, 139, 34],\r\n\t\"fuchsia\": [255, 0, 255],\r\n\t\"gainsboro\": [220, 220, 220],\r\n\t\"ghostwhite\": [248, 248, 255],\r\n\t\"gold\": [255, 215, 0],\r\n\t\"goldenrod\": [218, 165, 32],\r\n\t\"gray\": [128, 128, 128],\r\n\t\"green\": [0, 128, 0],\r\n\t\"greenyellow\": [173, 255, 47],\r\n\t\"grey\": [128, 128, 128],\r\n\t\"honeydew\": [240, 255, 240],\r\n\t\"hotpink\": [255, 105, 180],\r\n\t\"indianred\": [205, 92, 92],\r\n\t\"indigo\": [75, 0, 130],\r\n\t\"ivory\": [255, 255, 240],\r\n\t\"khaki\": [240, 230, 140],\r\n\t\"lavender\": [230, 230, 250],\r\n\t\"lavenderblush\": [255, 240, 245],\r\n\t\"lawngreen\": [124, 252, 0],\r\n\t\"lemonchiffon\": [255, 250, 205],\r\n\t\"lightblue\": [173, 216, 230],\r\n\t\"lightcoral\": [240, 128, 128],\r\n\t\"lightcyan\": [224, 255, 255],\r\n\t\"lightgoldenrodyellow\": [250, 250, 210],\r\n\t\"lightgray\": [211, 211, 211],\r\n\t\"lightgreen\": [144, 238, 144],\r\n\t\"lightgrey\": [211, 211, 211],\r\n\t\"lightpink\": [255, 182, 193],\r\n\t\"lightsalmon\": [255, 160, 122],\r\n\t\"lightseagreen\": [32, 178, 170],\r\n\t\"lightskyblue\": [135, 206, 250],\r\n\t\"lightslategray\": [119, 136, 153],\r\n\t\"lightslategrey\": [119, 136, 153],\r\n\t\"lightsteelblue\": [176, 196, 222],\r\n\t\"lightyellow\": [255, 255, 224],\r\n\t\"lime\": [0, 255, 0],\r\n\t\"limegreen\": [50, 205, 50],\r\n\t\"linen\": [250, 240, 230],\r\n\t\"magenta\": [255, 0, 255],\r\n\t\"maroon\": [128, 0, 0],\r\n\t\"mediumaquamarine\": [102, 205, 170],\r\n\t\"mediumblue\": [0, 0, 205],\r\n\t\"mediumorchid\": [186, 85, 211],\r\n\t\"mediumpurple\": [147, 112, 219],\r\n\t\"mediumseagreen\": [60, 179, 113],\r\n\t\"mediumslateblue\": [123, 104, 238],\r\n\t\"mediumspringgreen\": [0, 250, 154],\r\n\t\"mediumturquoise\": [72, 209, 204],\r\n\t\"mediumvioletred\": [199, 21, 133],\r\n\t\"midnightblue\": [25, 25, 112],\r\n\t\"mintcream\": [245, 255, 250],\r\n\t\"mistyrose\": [255, 228, 225],\r\n\t\"moccasin\": [255, 228, 181],\r\n\t\"navajowhite\": [255, 222, 173],\r\n\t\"navy\": [0, 0, 128],\r\n\t\"oldlace\": [253, 245, 230],\r\n\t\"olive\": [128, 128, 0],\r\n\t\"olivedrab\": [107, 142, 35],\r\n\t\"orange\": [255, 165, 0],\r\n\t\"orangered\": [255, 69, 0],\r\n\t\"orchid\": [218, 112, 214],\r\n\t\"palegoldenrod\": [238, 232, 170],\r\n\t\"palegreen\": [152, 251, 152],\r\n\t\"paleturquoise\": [175, 238, 238],\r\n\t\"palevioletred\": [219, 112, 147],\r\n\t\"papayawhip\": [255, 239, 213],\r\n\t\"peachpuff\": [255, 218, 185],\r\n\t\"peru\": [205, 133, 63],\r\n\t\"pink\": [255, 192, 203],\r\n\t\"plum\": [221, 160, 221],\r\n\t\"powderblue\": [176, 224, 230],\r\n\t\"purple\": [128, 0, 128],\r\n\t\"rebeccapurple\": [102, 51, 153],\r\n\t\"red\": [255, 0, 0],\r\n\t\"rosybrown\": [188, 143, 143],\r\n\t\"royalblue\": [65, 105, 225],\r\n\t\"saddlebrown\": [139, 69, 19],\r\n\t\"salmon\": [250, 128, 114],\r\n\t\"sandybrown\": [244, 164, 96],\r\n\t\"seagreen\": [46, 139, 87],\r\n\t\"seashell\": [255, 245, 238],\r\n\t\"sienna\": [160, 82, 45],\r\n\t\"silver\": [192, 192, 192],\r\n\t\"skyblue\": [135, 206, 235],\r\n\t\"slateblue\": [106, 90, 205],\r\n\t\"slategray\": [112, 128, 144],\r\n\t\"slategrey\": [112, 128, 144],\r\n\t\"snow\": [255, 250, 250],\r\n\t\"springgreen\": [0, 255, 127],\r\n\t\"steelblue\": [70, 130, 180],\r\n\t\"tan\": [210, 180, 140],\r\n\t\"teal\": [0, 128, 128],\r\n\t\"thistle\": [216, 191, 216],\r\n\t\"tomato\": [255, 99, 71],\r\n\t\"turquoise\": [64, 224, 208],\r\n\t\"violet\": [238, 130, 238],\r\n\t\"wheat\": [245, 222, 179],\r\n\t\"white\": [255, 255, 255],\r\n\t\"whitesmoke\": [245, 245, 245],\r\n\t\"yellow\": [255, 255, 0],\r\n\t\"yellowgreen\": [154, 205, 50]\r\n};\r\n","module.exports = function isArrayish(obj) {\n\tif (!obj || typeof obj === 'string') {\n\t\treturn false;\n\t}\n\n\treturn obj instanceof Array || Array.isArray(obj) ||\n\t\t(obj.length >= 0 && (obj.splice instanceof Function ||\n\t\t\t(Object.getOwnPropertyDescriptor(obj, (obj.length - 1)) && obj.constructor.name !== 'String')));\n};\n","'use strict';\n\nvar isArrayish = require('is-arrayish');\n\nvar concat = Array.prototype.concat;\nvar slice = Array.prototype.slice;\n\nvar swizzle = module.exports = function swizzle(args) {\n\tvar results = [];\n\n\tfor (var i = 0, len = args.length; i < len; i++) {\n\t\tvar arg = args[i];\n\n\t\tif (isArrayish(arg)) {\n\t\t\t// http://jsperf.com/javascript-array-concat-vs-push/98\n\t\t\tresults = concat.call(results, slice.call(arg));\n\t\t} else {\n\t\t\tresults.push(arg);\n\t\t}\n\t}\n\n\treturn results;\n};\n\nswizzle.wrap = function (fn) {\n\treturn function () {\n\t\treturn fn(swizzle(arguments));\n\t};\n};\n","/* MIT license */\nvar colorNames = require('color-name');\nvar swizzle = require('simple-swizzle');\nvar hasOwnProperty = Object.hasOwnProperty;\n\nvar reverseNames = Object.create(null);\n\n// create a list of reverse color names\nfor (var name in colorNames) {\n\tif (hasOwnProperty.call(colorNames, name)) {\n\t\treverseNames[colorNames[name]] = name;\n\t}\n}\n\nvar cs = module.exports = {\n\tto: {},\n\tget: {}\n};\n\ncs.get = function (string) {\n\tvar prefix = string.substring(0, 3).toLowerCase();\n\tvar val;\n\tvar model;\n\tswitch (prefix) {\n\t\tcase 'hsl':\n\t\t\tval = cs.get.hsl(string);\n\t\t\tmodel = 'hsl';\n\t\t\tbreak;\n\t\tcase 'hwb':\n\t\t\tval = cs.get.hwb(string);\n\t\t\tmodel = 'hwb';\n\t\t\tbreak;\n\t\tdefault:\n\t\t\tval = cs.get.rgb(string);\n\t\t\tmodel = 'rgb';\n\t\t\tbreak;\n\t}\n\n\tif (!val) {\n\t\treturn null;\n\t}\n\n\treturn {model: model, value: val};\n};\n\ncs.get.rgb = function (string) {\n\tif (!string) {\n\t\treturn null;\n\t}\n\n\tvar abbr = /^#([a-f0-9]{3,4})$/i;\n\tvar hex = /^#([a-f0-9]{6})([a-f0-9]{2})?$/i;\n\tvar rgba = /^rgba?\\(\\s*([+-]?\\d+)(?=[\\s,])\\s*(?:,\\s*)?([+-]?\\d+)(?=[\\s,])\\s*(?:,\\s*)?([+-]?\\d+)\\s*(?:[,|\\/]\\s*([+-]?[\\d\\.]+)(%?)\\s*)?\\)$/;\n\tvar per = /^rgba?\\(\\s*([+-]?[\\d\\.]+)\\%\\s*,?\\s*([+-]?[\\d\\.]+)\\%\\s*,?\\s*([+-]?[\\d\\.]+)\\%\\s*(?:[,|\\/]\\s*([+-]?[\\d\\.]+)(%?)\\s*)?\\)$/;\n\tvar keyword = /^(\\w+)$/;\n\n\tvar rgb = [0, 0, 0, 1];\n\tvar match;\n\tvar i;\n\tvar hexAlpha;\n\n\tif (match = string.match(hex)) {\n\t\thexAlpha = match[2];\n\t\tmatch = match[1];\n\n\t\tfor (i = 0; i < 3; i++) {\n\t\t\t// https://jsperf.com/slice-vs-substr-vs-substring-methods-long-string/19\n\t\t\tvar i2 = i * 2;\n\t\t\trgb[i] = parseInt(match.slice(i2, i2 + 2), 16);\n\t\t}\n\n\t\tif (hexAlpha) {\n\t\t\trgb[3] = parseInt(hexAlpha, 16) / 255;\n\t\t}\n\t} else if (match = string.match(abbr)) {\n\t\tmatch = match[1];\n\t\thexAlpha = match[3];\n\n\t\tfor (i = 0; i < 3; i++) {\n\t\t\trgb[i] = parseInt(match[i] + match[i], 16);\n\t\t}\n\n\t\tif (hexAlpha) {\n\t\t\trgb[3] = parseInt(hexAlpha + hexAlpha, 16) / 255;\n\t\t}\n\t} else if (match = string.match(rgba)) {\n\t\tfor (i = 0; i < 3; i++) {\n\t\t\trgb[i] = parseInt(match[i + 1], 0);\n\t\t}\n\n\t\tif (match[4]) {\n\t\t\tif (match[5]) {\n\t\t\t\trgb[3] = parseFloat(match[4]) * 0.01;\n\t\t\t} else {\n\t\t\t\trgb[3] = parseFloat(match[4]);\n\t\t\t}\n\t\t}\n\t} else if (match = string.match(per)) {\n\t\tfor (i = 0; i < 3; i++) {\n\t\t\trgb[i] = Math.round(parseFloat(match[i + 1]) * 2.55);\n\t\t}\n\n\t\tif (match[4]) {\n\t\t\tif (match[5]) {\n\t\t\t\trgb[3] = parseFloat(match[4]) * 0.01;\n\t\t\t} else {\n\t\t\t\trgb[3] = parseFloat(match[4]);\n\t\t\t}\n\t\t}\n\t} else if (match = string.match(keyword)) {\n\t\tif (match[1] === 'transparent') {\n\t\t\treturn [0, 0, 0, 0];\n\t\t}\n\n\t\tif (!hasOwnProperty.call(colorNames, match[1])) {\n\t\t\treturn null;\n\t\t}\n\n\t\trgb = colorNames[match[1]];\n\t\trgb[3] = 1;\n\n\t\treturn rgb;\n\t} else {\n\t\treturn null;\n\t}\n\n\tfor (i = 0; i < 3; i++) {\n\t\trgb[i] = clamp(rgb[i], 0, 255);\n\t}\n\trgb[3] = clamp(rgb[3], 0, 1);\n\n\treturn rgb;\n};\n\ncs.get.hsl = function (string) {\n\tif (!string) {\n\t\treturn null;\n\t}\n\n\tvar hsl = /^hsla?\\(\\s*([+-]?(?:\\d{0,3}\\.)?\\d+)(?:deg)?\\s*,?\\s*([+-]?[\\d\\.]+)%\\s*,?\\s*([+-]?[\\d\\.]+)%\\s*(?:[,|\\/]\\s*([+-]?(?=\\.\\d|\\d)(?:0|[1-9]\\d*)?(?:\\.\\d*)?(?:[eE][+-]?\\d+)?)\\s*)?\\)$/;\n\tvar match = string.match(hsl);\n\n\tif (match) {\n\t\tvar alpha = parseFloat(match[4]);\n\t\tvar h = ((parseFloat(match[1]) % 360) + 360) % 360;\n\t\tvar s = clamp(parseFloat(match[2]), 0, 100);\n\t\tvar l = clamp(parseFloat(match[3]), 0, 100);\n\t\tvar a = clamp(isNaN(alpha) ? 1 : alpha, 0, 1);\n\n\t\treturn [h, s, l, a];\n\t}\n\n\treturn null;\n};\n\ncs.get.hwb = function (string) {\n\tif (!string) {\n\t\treturn null;\n\t}\n\n\tvar hwb = /^hwb\\(\\s*([+-]?\\d{0,3}(?:\\.\\d+)?)(?:deg)?\\s*,\\s*([+-]?[\\d\\.]+)%\\s*,\\s*([+-]?[\\d\\.]+)%\\s*(?:,\\s*([+-]?(?=\\.\\d|\\d)(?:0|[1-9]\\d*)?(?:\\.\\d*)?(?:[eE][+-]?\\d+)?)\\s*)?\\)$/;\n\tvar match = string.match(hwb);\n\n\tif (match) {\n\t\tvar alpha = parseFloat(match[4]);\n\t\tvar h = ((parseFloat(match[1]) % 360) + 360) % 360;\n\t\tvar w = clamp(parseFloat(match[2]), 0, 100);\n\t\tvar b = clamp(parseFloat(match[3]), 0, 100);\n\t\tvar a = clamp(isNaN(alpha) ? 1 : alpha, 0, 1);\n\t\treturn [h, w, b, a];\n\t}\n\n\treturn null;\n};\n\ncs.to.hex = function () {\n\tvar rgba = swizzle(arguments);\n\n\treturn (\n\t\t'#' +\n\t\thexDouble(rgba[0]) +\n\t\thexDouble(rgba[1]) +\n\t\thexDouble(rgba[2]) +\n\t\t(rgba[3] < 1\n\t\t\t? (hexDouble(Math.round(rgba[3] * 255)))\n\t\t\t: '')\n\t);\n};\n\ncs.to.rgb = function () {\n\tvar rgba = swizzle(arguments);\n\n\treturn rgba.length < 4 || rgba[3] === 1\n\t\t? 'rgb(' + Math.round(rgba[0]) + ', ' + Math.round(rgba[1]) + ', ' + Math.round(rgba[2]) + ')'\n\t\t: 'rgba(' + Math.round(rgba[0]) + ', ' + Math.round(rgba[1]) + ', ' + Math.round(rgba[2]) + ', ' + rgba[3] + ')';\n};\n\ncs.to.rgb.percent = function () {\n\tvar rgba = swizzle(arguments);\n\n\tvar r = Math.round(rgba[0] / 255 * 100);\n\tvar g = Math.round(rgba[1] / 255 * 100);\n\tvar b = Math.round(rgba[2] / 255 * 100);\n\n\treturn rgba.length < 4 || rgba[3] === 1\n\t\t? 'rgb(' + r + '%, ' + g + '%, ' + b + '%)'\n\t\t: 'rgba(' + r + '%, ' + g + '%, ' + b + '%, ' + rgba[3] + ')';\n};\n\ncs.to.hsl = function () {\n\tvar hsla = swizzle(arguments);\n\treturn hsla.length < 4 || hsla[3] === 1\n\t\t? 'hsl(' + hsla[0] + ', ' + hsla[1] + '%, ' + hsla[2] + '%)'\n\t\t: 'hsla(' + hsla[0] + ', ' + hsla[1] + '%, ' + hsla[2] + '%, ' + hsla[3] + ')';\n};\n\n// hwb is a bit different than rgb(a) & hsl(a) since there is no alpha specific syntax\n// (hwb have alpha optional & 1 is default value)\ncs.to.hwb = function () {\n\tvar hwba = swizzle(arguments);\n\n\tvar a = '';\n\tif (hwba.length >= 4 && hwba[3] !== 1) {\n\t\ta = ', ' + hwba[3];\n\t}\n\n\treturn 'hwb(' + hwba[0] + ', ' + hwba[1] + '%, ' + hwba[2] + '%' + a + ')';\n};\n\ncs.to.keyword = function (rgb) {\n\treturn reverseNames[rgb.slice(0, 3)];\n};\n\n// helpers\nfunction clamp(num, min, max) {\n\treturn Math.min(Math.max(min, num), max);\n}\n\nfunction hexDouble(num) {\n\tvar str = Math.round(num).toString(16).toUpperCase();\n\treturn (str.length < 2) ? '0' + str : str;\n}\n","'use strict'\r\n\r\nmodule.exports = {\r\n\t\"aliceblue\": [240, 248, 255],\r\n\t\"antiquewhite\": [250, 235, 215],\r\n\t\"aqua\": [0, 255, 255],\r\n\t\"aquamarine\": [127, 255, 212],\r\n\t\"azure\": [240, 255, 255],\r\n\t\"beige\": [245, 245, 220],\r\n\t\"bisque\": [255, 228, 196],\r\n\t\"black\": [0, 0, 0],\r\n\t\"blanchedalmond\": [255, 235, 205],\r\n\t\"blue\": [0, 0, 255],\r\n\t\"blueviolet\": [138, 43, 226],\r\n\t\"brown\": [165, 42, 42],\r\n\t\"burlywood\": [222, 184, 135],\r\n\t\"cadetblue\": [95, 158, 160],\r\n\t\"chartreuse\": [127, 255, 0],\r\n\t\"chocolate\": [210, 105, 30],\r\n\t\"coral\": [255, 127, 80],\r\n\t\"cornflowerblue\": [100, 149, 237],\r\n\t\"cornsilk\": [255, 248, 220],\r\n\t\"crimson\": [220, 20, 60],\r\n\t\"cyan\": [0, 255, 255],\r\n\t\"darkblue\": [0, 0, 139],\r\n\t\"darkcyan\": [0, 139, 139],\r\n\t\"darkgoldenrod\": [184, 134, 11],\r\n\t\"darkgray\": [169, 169, 169],\r\n\t\"darkgreen\": [0, 100, 0],\r\n\t\"darkgrey\": [169, 169, 169],\r\n\t\"darkkhaki\": [189, 183, 107],\r\n\t\"darkmagenta\": [139, 0, 139],\r\n\t\"darkolivegreen\": [85, 107, 47],\r\n\t\"darkorange\": [255, 140, 0],\r\n\t\"darkorchid\": [153, 50, 204],\r\n\t\"darkred\": [139, 0, 0],\r\n\t\"darksalmon\": [233, 150, 122],\r\n\t\"darkseagreen\": [143, 188, 143],\r\n\t\"darkslateblue\": [72, 61, 139],\r\n\t\"darkslategray\": [47, 79, 79],\r\n\t\"darkslategrey\": [47, 79, 79],\r\n\t\"darkturquoise\": [0, 206, 209],\r\n\t\"darkviolet\": [148, 0, 211],\r\n\t\"deeppink\": [255, 20, 147],\r\n\t\"deepskyblue\": [0, 191, 255],\r\n\t\"dimgray\": [105, 105, 105],\r\n\t\"dimgrey\": [105, 105, 105],\r\n\t\"dodgerblue\": [30, 144, 255],\r\n\t\"firebrick\": [178, 34, 34],\r\n\t\"floralwhite\": [255, 250, 240],\r\n\t\"forestgreen\": [34, 139, 34],\r\n\t\"fuchsia\": [255, 0, 255],\r\n\t\"gainsboro\": [220, 220, 220],\r\n\t\"ghostwhite\": [248, 248, 255],\r\n\t\"gold\": [255, 215, 0],\r\n\t\"goldenrod\": [218, 165, 32],\r\n\t\"gray\": [128, 128, 128],\r\n\t\"green\": [0, 128, 0],\r\n\t\"greenyellow\": [173, 255, 47],\r\n\t\"grey\": [128, 128, 128],\r\n\t\"honeydew\": [240, 255, 240],\r\n\t\"hotpink\": [255, 105, 180],\r\n\t\"indianred\": [205, 92, 92],\r\n\t\"indigo\": [75, 0, 130],\r\n\t\"ivory\": [255, 255, 240],\r\n\t\"khaki\": [240, 230, 140],\r\n\t\"lavender\": [230, 230, 250],\r\n\t\"lavenderblush\": [255, 240, 245],\r\n\t\"lawngreen\": [124, 252, 0],\r\n\t\"lemonchiffon\": [255, 250, 205],\r\n\t\"lightblue\": [173, 216, 230],\r\n\t\"lightcoral\": [240, 128, 128],\r\n\t\"lightcyan\": [224, 255, 255],\r\n\t\"lightgoldenrodyellow\": [250, 250, 210],\r\n\t\"lightgray\": [211, 211, 211],\r\n\t\"lightgreen\": [144, 238, 144],\r\n\t\"lightgrey\": [211, 211, 211],\r\n\t\"lightpink\": [255, 182, 193],\r\n\t\"lightsalmon\": [255, 160, 122],\r\n\t\"lightseagreen\": [32, 178, 170],\r\n\t\"lightskyblue\": [135, 206, 250],\r\n\t\"lightslategray\": [119, 136, 153],\r\n\t\"lightslategrey\": [119, 136, 153],\r\n\t\"lightsteelblue\": [176, 196, 222],\r\n\t\"lightyellow\": [255, 255, 224],\r\n\t\"lime\": [0, 255, 0],\r\n\t\"limegreen\": [50, 205, 50],\r\n\t\"linen\": [250, 240, 230],\r\n\t\"magenta\": [255, 0, 255],\r\n\t\"maroon\": [128, 0, 0],\r\n\t\"mediumaquamarine\": [102, 205, 170],\r\n\t\"mediumblue\": [0, 0, 205],\r\n\t\"mediumorchid\": [186, 85, 211],\r\n\t\"mediumpurple\": [147, 112, 219],\r\n\t\"mediumseagreen\": [60, 179, 113],\r\n\t\"mediumslateblue\": [123, 104, 238],\r\n\t\"mediumspringgreen\": [0, 250, 154],\r\n\t\"mediumturquoise\": [72, 209, 204],\r\n\t\"mediumvioletred\": [199, 21, 133],\r\n\t\"midnightblue\": [25, 25, 112],\r\n\t\"mintcream\": [245, 255, 250],\r\n\t\"mistyrose\": [255, 228, 225],\r\n\t\"moccasin\": [255, 228, 181],\r\n\t\"navajowhite\": [255, 222, 173],\r\n\t\"navy\": [0, 0, 128],\r\n\t\"oldlace\": [253, 245, 230],\r\n\t\"olive\": [128, 128, 0],\r\n\t\"olivedrab\": [107, 142, 35],\r\n\t\"orange\": [255, 165, 0],\r\n\t\"orangered\": [255, 69, 0],\r\n\t\"orchid\": [218, 112, 214],\r\n\t\"palegoldenrod\": [238, 232, 170],\r\n\t\"palegreen\": [152, 251, 152],\r\n\t\"paleturquoise\": [175, 238, 238],\r\n\t\"palevioletred\": [219, 112, 147],\r\n\t\"papayawhip\": [255, 239, 213],\r\n\t\"peachpuff\": [255, 218, 185],\r\n\t\"peru\": [205, 133, 63],\r\n\t\"pink\": [255, 192, 203],\r\n\t\"plum\": [221, 160, 221],\r\n\t\"powderblue\": [176, 224, 230],\r\n\t\"purple\": [128, 0, 128],\r\n\t\"rebeccapurple\": [102, 51, 153],\r\n\t\"red\": [255, 0, 0],\r\n\t\"rosybrown\": [188, 143, 143],\r\n\t\"royalblue\": [65, 105, 225],\r\n\t\"saddlebrown\": [139, 69, 19],\r\n\t\"salmon\": [250, 128, 114],\r\n\t\"sandybrown\": [244, 164, 96],\r\n\t\"seagreen\": [46, 139, 87],\r\n\t\"seashell\": [255, 245, 238],\r\n\t\"sienna\": [160, 82, 45],\r\n\t\"silver\": [192, 192, 192],\r\n\t\"skyblue\": [135, 206, 235],\r\n\t\"slateblue\": [106, 90, 205],\r\n\t\"slategray\": [112, 128, 144],\r\n\t\"slategrey\": [112, 128, 144],\r\n\t\"snow\": [255, 250, 250],\r\n\t\"springgreen\": [0, 255, 127],\r\n\t\"steelblue\": [70, 130, 180],\r\n\t\"tan\": [210, 180, 140],\r\n\t\"teal\": [0, 128, 128],\r\n\t\"thistle\": [216, 191, 216],\r\n\t\"tomato\": [255, 99, 71],\r\n\t\"turquoise\": [64, 224, 208],\r\n\t\"violet\": [238, 130, 238],\r\n\t\"wheat\": [245, 222, 179],\r\n\t\"white\": [255, 255, 255],\r\n\t\"whitesmoke\": [245, 245, 245],\r\n\t\"yellow\": [255, 255, 0],\r\n\t\"yellowgreen\": [154, 205, 50]\r\n};\r\n","/* MIT license */\n/* eslint-disable no-mixed-operators */\nconst cssKeywords = require('color-name');\n\n// NOTE: conversions should only return primitive values (i.e. arrays, or\n//       values that give correct `typeof` results).\n//       do not use box values types (i.e. Number(), String(), etc.)\n\nconst reverseKeywords = {};\nfor (const key of Object.keys(cssKeywords)) {\n\treverseKeywords[cssKeywords[key]] = key;\n}\n\nconst convert = {\n\trgb: {channels: 3, labels: 'rgb'},\n\thsl: {channels: 3, labels: 'hsl'},\n\thsv: {channels: 3, labels: 'hsv'},\n\thwb: {channels: 3, labels: 'hwb'},\n\tcmyk: {channels: 4, labels: 'cmyk'},\n\txyz: {channels: 3, labels: 'xyz'},\n\tlab: {channels: 3, labels: 'lab'},\n\tlch: {channels: 3, labels: 'lch'},\n\thex: {channels: 1, labels: ['hex']},\n\tkeyword: {channels: 1, labels: ['keyword']},\n\tansi16: {channels: 1, labels: ['ansi16']},\n\tansi256: {channels: 1, labels: ['ansi256']},\n\thcg: {channels: 3, labels: ['h', 'c', 'g']},\n\tapple: {channels: 3, labels: ['r16', 'g16', 'b16']},\n\tgray: {channels: 1, labels: ['gray']}\n};\n\nmodule.exports = convert;\n\n// Hide .channels and .labels properties\nfor (const model of Object.keys(convert)) {\n\tif (!('channels' in convert[model])) {\n\t\tthrow new Error('missing channels property: ' + model);\n\t}\n\n\tif (!('labels' in convert[model])) {\n\t\tthrow new Error('missing channel labels property: ' + model);\n\t}\n\n\tif (convert[model].labels.length !== convert[model].channels) {\n\t\tthrow new Error('channel and label counts mismatch: ' + model);\n\t}\n\n\tconst {channels, labels} = convert[model];\n\tdelete convert[model].channels;\n\tdelete convert[model].labels;\n\tObject.defineProperty(convert[model], 'channels', {value: channels});\n\tObject.defineProperty(convert[model], 'labels', {value: labels});\n}\n\nconvert.rgb.hsl = function (rgb) {\n\tconst r = rgb[0] / 255;\n\tconst g = rgb[1] / 255;\n\tconst b = rgb[2] / 255;\n\tconst min = Math.min(r, g, b);\n\tconst max = Math.max(r, g, b);\n\tconst delta = max - min;\n\tlet h;\n\tlet s;\n\n\tif (max === min) {\n\t\th = 0;\n\t} else if (r === max) {\n\t\th = (g - b) / delta;\n\t} else if (g === max) {\n\t\th = 2 + (b - r) / delta;\n\t} else if (b === max) {\n\t\th = 4 + (r - g) / delta;\n\t}\n\n\th = Math.min(h * 60, 360);\n\n\tif (h < 0) {\n\t\th += 360;\n\t}\n\n\tconst l = (min + max) / 2;\n\n\tif (max === min) {\n\t\ts = 0;\n\t} else if (l <= 0.5) {\n\t\ts = delta / (max + min);\n\t} else {\n\t\ts = delta / (2 - max - min);\n\t}\n\n\treturn [h, s * 100, l * 100];\n};\n\nconvert.rgb.hsv = function (rgb) {\n\tlet rdif;\n\tlet gdif;\n\tlet bdif;\n\tlet h;\n\tlet s;\n\n\tconst r = rgb[0] / 255;\n\tconst g = rgb[1] / 255;\n\tconst b = rgb[2] / 255;\n\tconst v = Math.max(r, g, b);\n\tconst diff = v - Math.min(r, g, b);\n\tconst diffc = function (c) {\n\t\treturn (v - c) / 6 / diff + 1 / 2;\n\t};\n\n\tif (diff === 0) {\n\t\th = 0;\n\t\ts = 0;\n\t} else {\n\t\ts = diff / v;\n\t\trdif = diffc(r);\n\t\tgdif = diffc(g);\n\t\tbdif = diffc(b);\n\n\t\tif (r === v) {\n\t\t\th = bdif - gdif;\n\t\t} else if (g === v) {\n\t\t\th = (1 / 3) + rdif - bdif;\n\t\t} else if (b === v) {\n\t\t\th = (2 / 3) + gdif - rdif;\n\t\t}\n\n\t\tif (h < 0) {\n\t\t\th += 1;\n\t\t} else if (h > 1) {\n\t\t\th -= 1;\n\t\t}\n\t}\n\n\treturn [\n\t\th * 360,\n\t\ts * 100,\n\t\tv * 100\n\t];\n};\n\nconvert.rgb.hwb = function (rgb) {\n\tconst r = rgb[0];\n\tconst g = rgb[1];\n\tlet b = rgb[2];\n\tconst h = convert.rgb.hsl(rgb)[0];\n\tconst w = 1 / 255 * Math.min(r, Math.min(g, b));\n\n\tb = 1 - 1 / 255 * Math.max(r, Math.max(g, b));\n\n\treturn [h, w * 100, b * 100];\n};\n\nconvert.rgb.cmyk = function (rgb) {\n\tconst r = rgb[0] / 255;\n\tconst g = rgb[1] / 255;\n\tconst b = rgb[2] / 255;\n\n\tconst k = Math.min(1 - r, 1 - g, 1 - b);\n\tconst c = (1 - r - k) / (1 - k) || 0;\n\tconst m = (1 - g - k) / (1 - k) || 0;\n\tconst y = (1 - b - k) / (1 - k) || 0;\n\n\treturn [c * 100, m * 100, y * 100, k * 100];\n};\n\nfunction comparativeDistance(x, y) {\n\t/*\n\t\tSee https://en.m.wikipedia.org/wiki/Euclidean_distance#Squared_Euclidean_distance\n\t*/\n\treturn (\n\t\t((x[0] - y[0]) ** 2) +\n\t\t((x[1] - y[1]) ** 2) +\n\t\t((x[2] - y[2]) ** 2)\n\t);\n}\n\nconvert.rgb.keyword = function (rgb) {\n\tconst reversed = reverseKeywords[rgb];\n\tif (reversed) {\n\t\treturn reversed;\n\t}\n\n\tlet currentClosestDistance = Infinity;\n\tlet currentClosestKeyword;\n\n\tfor (const keyword of Object.keys(cssKeywords)) {\n\t\tconst value = cssKeywords[keyword];\n\n\t\t// Compute comparative distance\n\t\tconst distance = comparativeDistance(rgb, value);\n\n\t\t// Check if its less, if so set as closest\n\t\tif (distance < currentClosestDistance) {\n\t\t\tcurrentClosestDistance = distance;\n\t\t\tcurrentClosestKeyword = keyword;\n\t\t}\n\t}\n\n\treturn currentClosestKeyword;\n};\n\nconvert.keyword.rgb = function (keyword) {\n\treturn cssKeywords[keyword];\n};\n\nconvert.rgb.xyz = function (rgb) {\n\tlet r = rgb[0] / 255;\n\tlet g = rgb[1] / 255;\n\tlet b = rgb[2] / 255;\n\n\t// Assume sRGB\n\tr = r > 0.04045 ? (((r + 0.055) / 1.055) ** 2.4) : (r / 12.92);\n\tg = g > 0.04045 ? (((g + 0.055) / 1.055) ** 2.4) : (g / 12.92);\n\tb = b > 0.04045 ? (((b + 0.055) / 1.055) ** 2.4) : (b / 12.92);\n\n\tconst x = (r * 0.4124) + (g * 0.3576) + (b * 0.1805);\n\tconst y = (r * 0.2126) + (g * 0.7152) + (b * 0.0722);\n\tconst z = (r * 0.0193) + (g * 0.1192) + (b * 0.9505);\n\n\treturn [x * 100, y * 100, z * 100];\n};\n\nconvert.rgb.lab = function (rgb) {\n\tconst xyz = convert.rgb.xyz(rgb);\n\tlet x = xyz[0];\n\tlet y = xyz[1];\n\tlet z = xyz[2];\n\n\tx /= 95.047;\n\ty /= 100;\n\tz /= 108.883;\n\n\tx = x > 0.008856 ? (x ** (1 / 3)) : (7.787 * x) + (16 / 116);\n\ty = y > 0.008856 ? (y ** (1 / 3)) : (7.787 * y) + (16 / 116);\n\tz = z > 0.008856 ? (z ** (1 / 3)) : (7.787 * z) + (16 / 116);\n\n\tconst l = (116 * y) - 16;\n\tconst a = 500 * (x - y);\n\tconst b = 200 * (y - z);\n\n\treturn [l, a, b];\n};\n\nconvert.hsl.rgb = function (hsl) {\n\tconst h = hsl[0] / 360;\n\tconst s = hsl[1] / 100;\n\tconst l = hsl[2] / 100;\n\tlet t2;\n\tlet t3;\n\tlet val;\n\n\tif (s === 0) {\n\t\tval = l * 255;\n\t\treturn [val, val, val];\n\t}\n\n\tif (l < 0.5) {\n\t\tt2 = l * (1 + s);\n\t} else {\n\t\tt2 = l + s - l * s;\n\t}\n\n\tconst t1 = 2 * l - t2;\n\n\tconst rgb = [0, 0, 0];\n\tfor (let i = 0; i < 3; i++) {\n\t\tt3 = h + 1 / 3 * -(i - 1);\n\t\tif (t3 < 0) {\n\t\t\tt3++;\n\t\t}\n\n\t\tif (t3 > 1) {\n\t\t\tt3--;\n\t\t}\n\n\t\tif (6 * t3 < 1) {\n\t\t\tval = t1 + (t2 - t1) * 6 * t3;\n\t\t} else if (2 * t3 < 1) {\n\t\t\tval = t2;\n\t\t} else if (3 * t3 < 2) {\n\t\t\tval = t1 + (t2 - t1) * (2 / 3 - t3) * 6;\n\t\t} else {\n\t\t\tval = t1;\n\t\t}\n\n\t\trgb[i] = val * 255;\n\t}\n\n\treturn rgb;\n};\n\nconvert.hsl.hsv = function (hsl) {\n\tconst h = hsl[0];\n\tlet s = hsl[1] / 100;\n\tlet l = hsl[2] / 100;\n\tlet smin = s;\n\tconst lmin = Math.max(l, 0.01);\n\n\tl *= 2;\n\ts *= (l <= 1) ? l : 2 - l;\n\tsmin *= lmin <= 1 ? lmin : 2 - lmin;\n\tconst v = (l + s) / 2;\n\tconst sv = l === 0 ? (2 * smin) / (lmin + smin) : (2 * s) / (l + s);\n\n\treturn [h, sv * 100, v * 100];\n};\n\nconvert.hsv.rgb = function (hsv) {\n\tconst h = hsv[0] / 60;\n\tconst s = hsv[1] / 100;\n\tlet v = hsv[2] / 100;\n\tconst hi = Math.floor(h) % 6;\n\n\tconst f = h - Math.floor(h);\n\tconst p = 255 * v * (1 - s);\n\tconst q = 255 * v * (1 - (s * f));\n\tconst t = 255 * v * (1 - (s * (1 - f)));\n\tv *= 255;\n\n\tswitch (hi) {\n\t\tcase 0:\n\t\t\treturn [v, t, p];\n\t\tcase 1:\n\t\t\treturn [q, v, p];\n\t\tcase 2:\n\t\t\treturn [p, v, t];\n\t\tcase 3:\n\t\t\treturn [p, q, v];\n\t\tcase 4:\n\t\t\treturn [t, p, v];\n\t\tcase 5:\n\t\t\treturn [v, p, q];\n\t}\n};\n\nconvert.hsv.hsl = function (hsv) {\n\tconst h = hsv[0];\n\tconst s = hsv[1] / 100;\n\tconst v = hsv[2] / 100;\n\tconst vmin = Math.max(v, 0.01);\n\tlet sl;\n\tlet l;\n\n\tl = (2 - s) * v;\n\tconst lmin = (2 - s) * vmin;\n\tsl = s * vmin;\n\tsl /= (lmin <= 1) ? lmin : 2 - lmin;\n\tsl = sl || 0;\n\tl /= 2;\n\n\treturn [h, sl * 100, l * 100];\n};\n\n// http://dev.w3.org/csswg/css-color/#hwb-to-rgb\nconvert.hwb.rgb = function (hwb) {\n\tconst h = hwb[0] / 360;\n\tlet wh = hwb[1] / 100;\n\tlet bl = hwb[2] / 100;\n\tconst ratio = wh + bl;\n\tlet f;\n\n\t// Wh + bl cant be > 1\n\tif (ratio > 1) {\n\t\twh /= ratio;\n\t\tbl /= ratio;\n\t}\n\n\tconst i = Math.floor(6 * h);\n\tconst v = 1 - bl;\n\tf = 6 * h - i;\n\n\tif ((i & 0x01) !== 0) {\n\t\tf = 1 - f;\n\t}\n\n\tconst n = wh + f * (v - wh); // Linear interpolation\n\n\tlet r;\n\tlet g;\n\tlet b;\n\t/* eslint-disable max-statements-per-line,no-multi-spaces */\n\tswitch (i) {\n\t\tdefault:\n\t\tcase 6:\n\t\tcase 0: r = v;  g = n;  b = wh; break;\n\t\tcase 1: r = n;  g = v;  b = wh; break;\n\t\tcase 2: r = wh; g = v;  b = n; break;\n\t\tcase 3: r = wh; g = n;  b = v; break;\n\t\tcase 4: r = n;  g = wh; b = v; break;\n\t\tcase 5: r = v;  g = wh; b = n; break;\n\t}\n\t/* eslint-enable max-statements-per-line,no-multi-spaces */\n\n\treturn [r * 255, g * 255, b * 255];\n};\n\nconvert.cmyk.rgb = function (cmyk) {\n\tconst c = cmyk[0] / 100;\n\tconst m = cmyk[1] / 100;\n\tconst y = cmyk[2] / 100;\n\tconst k = cmyk[3] / 100;\n\n\tconst r = 1 - Math.min(1, c * (1 - k) + k);\n\tconst g = 1 - Math.min(1, m * (1 - k) + k);\n\tconst b = 1 - Math.min(1, y * (1 - k) + k);\n\n\treturn [r * 255, g * 255, b * 255];\n};\n\nconvert.xyz.rgb = function (xyz) {\n\tconst x = xyz[0] / 100;\n\tconst y = xyz[1] / 100;\n\tconst z = xyz[2] / 100;\n\tlet r;\n\tlet g;\n\tlet b;\n\n\tr = (x * 3.2406) + (y * -1.5372) + (z * -0.4986);\n\tg = (x * -0.9689) + (y * 1.8758) + (z * 0.0415);\n\tb = (x * 0.0557) + (y * -0.2040) + (z * 1.0570);\n\n\t// Assume sRGB\n\tr = r > 0.0031308\n\t\t? ((1.055 * (r ** (1.0 / 2.4))) - 0.055)\n\t\t: r * 12.92;\n\n\tg = g > 0.0031308\n\t\t? ((1.055 * (g ** (1.0 / 2.4))) - 0.055)\n\t\t: g * 12.92;\n\n\tb = b > 0.0031308\n\t\t? ((1.055 * (b ** (1.0 / 2.4))) - 0.055)\n\t\t: b * 12.92;\n\n\tr = Math.min(Math.max(0, r), 1);\n\tg = Math.min(Math.max(0, g), 1);\n\tb = Math.min(Math.max(0, b), 1);\n\n\treturn [r * 255, g * 255, b * 255];\n};\n\nconvert.xyz.lab = function (xyz) {\n\tlet x = xyz[0];\n\tlet y = xyz[1];\n\tlet z = xyz[2];\n\n\tx /= 95.047;\n\ty /= 100;\n\tz /= 108.883;\n\n\tx = x > 0.008856 ? (x ** (1 / 3)) : (7.787 * x) + (16 / 116);\n\ty = y > 0.008856 ? (y ** (1 / 3)) : (7.787 * y) + (16 / 116);\n\tz = z > 0.008856 ? (z ** (1 / 3)) : (7.787 * z) + (16 / 116);\n\n\tconst l = (116 * y) - 16;\n\tconst a = 500 * (x - y);\n\tconst b = 200 * (y - z);\n\n\treturn [l, a, b];\n};\n\nconvert.lab.xyz = function (lab) {\n\tconst l = lab[0];\n\tconst a = lab[1];\n\tconst b = lab[2];\n\tlet x;\n\tlet y;\n\tlet z;\n\n\ty = (l + 16) / 116;\n\tx = a / 500 + y;\n\tz = y - b / 200;\n\n\tconst y2 = y ** 3;\n\tconst x2 = x ** 3;\n\tconst z2 = z ** 3;\n\ty = y2 > 0.008856 ? y2 : (y - 16 / 116) / 7.787;\n\tx = x2 > 0.008856 ? x2 : (x - 16 / 116) / 7.787;\n\tz = z2 > 0.008856 ? z2 : (z - 16 / 116) / 7.787;\n\n\tx *= 95.047;\n\ty *= 100;\n\tz *= 108.883;\n\n\treturn [x, y, z];\n};\n\nconvert.lab.lch = function (lab) {\n\tconst l = lab[0];\n\tconst a = lab[1];\n\tconst b = lab[2];\n\tlet h;\n\n\tconst hr = Math.atan2(b, a);\n\th = hr * 360 / 2 / Math.PI;\n\n\tif (h < 0) {\n\t\th += 360;\n\t}\n\n\tconst c = Math.sqrt(a * a + b * b);\n\n\treturn [l, c, h];\n};\n\nconvert.lch.lab = function (lch) {\n\tconst l = lch[0];\n\tconst c = lch[1];\n\tconst h = lch[2];\n\n\tconst hr = h / 360 * 2 * Math.PI;\n\tconst a = c * Math.cos(hr);\n\tconst b = c * Math.sin(hr);\n\n\treturn [l, a, b];\n};\n\nconvert.rgb.ansi16 = function (args, saturation = null) {\n\tconst [r, g, b] = args;\n\tlet value = saturation === null ? convert.rgb.hsv(args)[2] : saturation; // Hsv -> ansi16 optimization\n\n\tvalue = Math.round(value / 50);\n\n\tif (value === 0) {\n\t\treturn 30;\n\t}\n\n\tlet ansi = 30\n\t\t+ ((Math.round(b / 255) << 2)\n\t\t| (Math.round(g / 255) << 1)\n\t\t| Math.round(r / 255));\n\n\tif (value === 2) {\n\t\tansi += 60;\n\t}\n\n\treturn ansi;\n};\n\nconvert.hsv.ansi16 = function (args) {\n\t// Optimization here; we already know the value and don't need to get\n\t// it converted for us.\n\treturn convert.rgb.ansi16(convert.hsv.rgb(args), args[2]);\n};\n\nconvert.rgb.ansi256 = function (args) {\n\tconst r = args[0];\n\tconst g = args[1];\n\tconst b = args[2];\n\n\t// We use the extended greyscale palette here, with the exception of\n\t// black and white. normal palette only has 4 greyscale shades.\n\tif (r === g && g === b) {\n\t\tif (r < 8) {\n\t\t\treturn 16;\n\t\t}\n\n\t\tif (r > 248) {\n\t\t\treturn 231;\n\t\t}\n\n\t\treturn Math.round(((r - 8) / 247) * 24) + 232;\n\t}\n\n\tconst ansi = 16\n\t\t+ (36 * Math.round(r / 255 * 5))\n\t\t+ (6 * Math.round(g / 255 * 5))\n\t\t+ Math.round(b / 255 * 5);\n\n\treturn ansi;\n};\n\nconvert.ansi16.rgb = function (args) {\n\tlet color = args % 10;\n\n\t// Handle greyscale\n\tif (color === 0 || color === 7) {\n\t\tif (args > 50) {\n\t\t\tcolor += 3.5;\n\t\t}\n\n\t\tcolor = color / 10.5 * 255;\n\n\t\treturn [color, color, color];\n\t}\n\n\tconst mult = (~~(args > 50) + 1) * 0.5;\n\tconst r = ((color & 1) * mult) * 255;\n\tconst g = (((color >> 1) & 1) * mult) * 255;\n\tconst b = (((color >> 2) & 1) * mult) * 255;\n\n\treturn [r, g, b];\n};\n\nconvert.ansi256.rgb = function (args) {\n\t// Handle greyscale\n\tif (args >= 232) {\n\t\tconst c = (args - 232) * 10 + 8;\n\t\treturn [c, c, c];\n\t}\n\n\targs -= 16;\n\n\tlet rem;\n\tconst r = Math.floor(args / 36) / 5 * 255;\n\tconst g = Math.floor((rem = args % 36) / 6) / 5 * 255;\n\tconst b = (rem % 6) / 5 * 255;\n\n\treturn [r, g, b];\n};\n\nconvert.rgb.hex = function (args) {\n\tconst integer = ((Math.round(args[0]) & 0xFF) << 16)\n\t\t+ ((Math.round(args[1]) & 0xFF) << 8)\n\t\t+ (Math.round(args[2]) & 0xFF);\n\n\tconst string = integer.toString(16).toUpperCase();\n\treturn '000000'.substring(string.length) + string;\n};\n\nconvert.hex.rgb = function (args) {\n\tconst match = args.toString(16).match(/[a-f0-9]{6}|[a-f0-9]{3}/i);\n\tif (!match) {\n\t\treturn [0, 0, 0];\n\t}\n\n\tlet colorString = match[0];\n\n\tif (match[0].length === 3) {\n\t\tcolorString = colorString.split('').map(char => {\n\t\t\treturn char + char;\n\t\t}).join('');\n\t}\n\n\tconst integer = parseInt(colorString, 16);\n\tconst r = (integer >> 16) & 0xFF;\n\tconst g = (integer >> 8) & 0xFF;\n\tconst b = integer & 0xFF;\n\n\treturn [r, g, b];\n};\n\nconvert.rgb.hcg = function (rgb) {\n\tconst r = rgb[0] / 255;\n\tconst g = rgb[1] / 255;\n\tconst b = rgb[2] / 255;\n\tconst max = Math.max(Math.max(r, g), b);\n\tconst min = Math.min(Math.min(r, g), b);\n\tconst chroma = (max - min);\n\tlet grayscale;\n\tlet hue;\n\n\tif (chroma < 1) {\n\t\tgrayscale = min / (1 - chroma);\n\t} else {\n\t\tgrayscale = 0;\n\t}\n\n\tif (chroma <= 0) {\n\t\thue = 0;\n\t} else\n\tif (max === r) {\n\t\thue = ((g - b) / chroma) % 6;\n\t} else\n\tif (max === g) {\n\t\thue = 2 + (b - r) / chroma;\n\t} else {\n\t\thue = 4 + (r - g) / chroma;\n\t}\n\n\thue /= 6;\n\thue %= 1;\n\n\treturn [hue * 360, chroma * 100, grayscale * 100];\n};\n\nconvert.hsl.hcg = function (hsl) {\n\tconst s = hsl[1] / 100;\n\tconst l = hsl[2] / 100;\n\n\tconst c = l < 0.5 ? (2.0 * s * l) : (2.0 * s * (1.0 - l));\n\n\tlet f = 0;\n\tif (c < 1.0) {\n\t\tf = (l - 0.5 * c) / (1.0 - c);\n\t}\n\n\treturn [hsl[0], c * 100, f * 100];\n};\n\nconvert.hsv.hcg = function (hsv) {\n\tconst s = hsv[1] / 100;\n\tconst v = hsv[2] / 100;\n\n\tconst c = s * v;\n\tlet f = 0;\n\n\tif (c < 1.0) {\n\t\tf = (v - c) / (1 - c);\n\t}\n\n\treturn [hsv[0], c * 100, f * 100];\n};\n\nconvert.hcg.rgb = function (hcg) {\n\tconst h = hcg[0] / 360;\n\tconst c = hcg[1] / 100;\n\tconst g = hcg[2] / 100;\n\n\tif (c === 0.0) {\n\t\treturn [g * 255, g * 255, g * 255];\n\t}\n\n\tconst pure = [0, 0, 0];\n\tconst hi = (h % 1) * 6;\n\tconst v = hi % 1;\n\tconst w = 1 - v;\n\tlet mg = 0;\n\n\t/* eslint-disable max-statements-per-line */\n\tswitch (Math.floor(hi)) {\n\t\tcase 0:\n\t\t\tpure[0] = 1; pure[1] = v; pure[2] = 0; break;\n\t\tcase 1:\n\t\t\tpure[0] = w; pure[1] = 1; pure[2] = 0; break;\n\t\tcase 2:\n\t\t\tpure[0] = 0; pure[1] = 1; pure[2] = v; break;\n\t\tcase 3:\n\t\t\tpure[0] = 0; pure[1] = w; pure[2] = 1; break;\n\t\tcase 4:\n\t\t\tpure[0] = v; pure[1] = 0; pure[2] = 1; break;\n\t\tdefault:\n\t\t\tpure[0] = 1; pure[1] = 0; pure[2] = w;\n\t}\n\t/* eslint-enable max-statements-per-line */\n\n\tmg = (1.0 - c) * g;\n\n\treturn [\n\t\t(c * pure[0] + mg) * 255,\n\t\t(c * pure[1] + mg) * 255,\n\t\t(c * pure[2] + mg) * 255\n\t];\n};\n\nconvert.hcg.hsv = function (hcg) {\n\tconst c = hcg[1] / 100;\n\tconst g = hcg[2] / 100;\n\n\tconst v = c + g * (1.0 - c);\n\tlet f = 0;\n\n\tif (v > 0.0) {\n\t\tf = c / v;\n\t}\n\n\treturn [hcg[0], f * 100, v * 100];\n};\n\nconvert.hcg.hsl = function (hcg) {\n\tconst c = hcg[1] / 100;\n\tconst g = hcg[2] / 100;\n\n\tconst l = g * (1.0 - c) + 0.5 * c;\n\tlet s = 0;\n\n\tif (l > 0.0 && l < 0.5) {\n\t\ts = c / (2 * l);\n\t} else\n\tif (l >= 0.5 && l < 1.0) {\n\t\ts = c / (2 * (1 - l));\n\t}\n\n\treturn [hcg[0], s * 100, l * 100];\n};\n\nconvert.hcg.hwb = function (hcg) {\n\tconst c = hcg[1] / 100;\n\tconst g = hcg[2] / 100;\n\tconst v = c + g * (1.0 - c);\n\treturn [hcg[0], (v - c) * 100, (1 - v) * 100];\n};\n\nconvert.hwb.hcg = function (hwb) {\n\tconst w = hwb[1] / 100;\n\tconst b = hwb[2] / 100;\n\tconst v = 1 - b;\n\tconst c = v - w;\n\tlet g = 0;\n\n\tif (c < 1) {\n\t\tg = (v - c) / (1 - c);\n\t}\n\n\treturn [hwb[0], c * 100, g * 100];\n};\n\nconvert.apple.rgb = function (apple) {\n\treturn [(apple[0] / 65535) * 255, (apple[1] / 65535) * 255, (apple[2] / 65535) * 255];\n};\n\nconvert.rgb.apple = function (rgb) {\n\treturn [(rgb[0] / 255) * 65535, (rgb[1] / 255) * 65535, (rgb[2] / 255) * 65535];\n};\n\nconvert.gray.rgb = function (args) {\n\treturn [args[0] / 100 * 255, args[0] / 100 * 255, args[0] / 100 * 255];\n};\n\nconvert.gray.hsl = function (args) {\n\treturn [0, 0, args[0]];\n};\n\nconvert.gray.hsv = convert.gray.hsl;\n\nconvert.gray.hwb = function (gray) {\n\treturn [0, 100, gray[0]];\n};\n\nconvert.gray.cmyk = function (gray) {\n\treturn [0, 0, 0, gray[0]];\n};\n\nconvert.gray.lab = function (gray) {\n\treturn [gray[0], 0, 0];\n};\n\nconvert.gray.hex = function (gray) {\n\tconst val = Math.round(gray[0] / 100 * 255) & 0xFF;\n\tconst integer = (val << 16) + (val << 8) + val;\n\n\tconst string = integer.toString(16).toUpperCase();\n\treturn '000000'.substring(string.length) + string;\n};\n\nconvert.rgb.gray = function (rgb) {\n\tconst val = (rgb[0] + rgb[1] + rgb[2]) / 3;\n\treturn [val / 255 * 100];\n};\n","const conversions = require('./conversions');\n\n/*\n\tThis function routes a model to all other models.\n\n\tall functions that are routed have a property `.conversion` attached\n\tto the returned synthetic function. This property is an array\n\tof strings, each with the steps in between the 'from' and 'to'\n\tcolor models (inclusive).\n\n\tconversions that are not possible simply are not included.\n*/\n\nfunction buildGraph() {\n\tconst graph = {};\n\t// https://jsperf.com/object-keys-vs-for-in-with-closure/3\n\tconst models = Object.keys(conversions);\n\n\tfor (let len = models.length, i = 0; i < len; i++) {\n\t\tgraph[models[i]] = {\n\t\t\t// http://jsperf.com/1-vs-infinity\n\t\t\t// micro-opt, but this is simple.\n\t\t\tdistance: -1,\n\t\t\tparent: null\n\t\t};\n\t}\n\n\treturn graph;\n}\n\n// https://en.wikipedia.org/wiki/Breadth-first_search\nfunction deriveBFS(fromModel) {\n\tconst graph = buildGraph();\n\tconst queue = [fromModel]; // Unshift -> queue -> pop\n\n\tgraph[fromModel].distance = 0;\n\n\twhile (queue.length) {\n\t\tconst current = queue.pop();\n\t\tconst adjacents = Object.keys(conversions[current]);\n\n\t\tfor (let len = adjacents.length, i = 0; i < len; i++) {\n\t\t\tconst adjacent = adjacents[i];\n\t\t\tconst node = graph[adjacent];\n\n\t\t\tif (node.distance === -1) {\n\t\t\t\tnode.distance = graph[current].distance + 1;\n\t\t\t\tnode.parent = current;\n\t\t\t\tqueue.unshift(adjacent);\n\t\t\t}\n\t\t}\n\t}\n\n\treturn graph;\n}\n\nfunction link(from, to) {\n\treturn function (args) {\n\t\treturn to(from(args));\n\t};\n}\n\nfunction wrapConversion(toModel, graph) {\n\tconst path = [graph[toModel].parent, toModel];\n\tlet fn = conversions[graph[toModel].parent][toModel];\n\n\tlet cur = graph[toModel].parent;\n\twhile (graph[cur].parent) {\n\t\tpath.unshift(graph[cur].parent);\n\t\tfn = link(conversions[graph[cur].parent][cur], fn);\n\t\tcur = graph[cur].parent;\n\t}\n\n\tfn.conversion = path;\n\treturn fn;\n}\n\nmodule.exports = function (fromModel) {\n\tconst graph = deriveBFS(fromModel);\n\tconst conversion = {};\n\n\tconst models = Object.keys(graph);\n\tfor (let len = models.length, i = 0; i < len; i++) {\n\t\tconst toModel = models[i];\n\t\tconst node = graph[toModel];\n\n\t\tif (node.parent === null) {\n\t\t\t// No possible conversion, or this node is the source model.\n\t\t\tcontinue;\n\t\t}\n\n\t\tconversion[toModel] = wrapConversion(toModel, graph);\n\t}\n\n\treturn conversion;\n};\n\n","const conversions = require('./conversions');\nconst route = require('./route');\n\nconst convert = {};\n\nconst models = Object.keys(conversions);\n\nfunction wrapRaw(fn) {\n\tconst wrappedFn = function (...args) {\n\t\tconst arg0 = args[0];\n\t\tif (arg0 === undefined || arg0 === null) {\n\t\t\treturn arg0;\n\t\t}\n\n\t\tif (arg0.length > 1) {\n\t\t\targs = arg0;\n\t\t}\n\n\t\treturn fn(args);\n\t};\n\n\t// Preserve .conversion property if there is one\n\tif ('conversion' in fn) {\n\t\twrappedFn.conversion = fn.conversion;\n\t}\n\n\treturn wrappedFn;\n}\n\nfunction wrapRounded(fn) {\n\tconst wrappedFn = function (...args) {\n\t\tconst arg0 = args[0];\n\n\t\tif (arg0 === undefined || arg0 === null) {\n\t\t\treturn arg0;\n\t\t}\n\n\t\tif (arg0.length > 1) {\n\t\t\targs = arg0;\n\t\t}\n\n\t\tconst result = fn(args);\n\n\t\t// We're assuming the result is an array here.\n\t\t// see notice in conversions.js; don't use box types\n\t\t// in conversion functions.\n\t\tif (typeof result === 'object') {\n\t\t\tfor (let len = result.length, i = 0; i < len; i++) {\n\t\t\t\tresult[i] = Math.round(result[i]);\n\t\t\t}\n\t\t}\n\n\t\treturn result;\n\t};\n\n\t// Preserve .conversion property if there is one\n\tif ('conversion' in fn) {\n\t\twrappedFn.conversion = fn.conversion;\n\t}\n\n\treturn wrappedFn;\n}\n\nmodels.forEach(fromModel => {\n\tconvert[fromModel] = {};\n\n\tObject.defineProperty(convert[fromModel], 'channels', {value: conversions[fromModel].channels});\n\tObject.defineProperty(convert[fromModel], 'labels', {value: conversions[fromModel].labels});\n\n\tconst routes = route(fromModel);\n\tconst routeModels = Object.keys(routes);\n\n\trouteModels.forEach(toModel => {\n\t\tconst fn = routes[toModel];\n\n\t\tconvert[fromModel][toModel] = wrapRounded(fn);\n\t\tconvert[fromModel][toModel].raw = wrapRaw(fn);\n\t});\n});\n\nmodule.exports = convert;\n","const colorString = require('color-string');\nconst convert = require('color-convert');\n\nconst skippedModels = [\n\t// To be honest, I don't really feel like keyword belongs in color convert, but eh.\n\t'keyword',\n\n\t// Gray conflicts with some method names, and has its own method defined.\n\t'gray',\n\n\t// Shouldn't really be in color-convert either...\n\t'hex',\n];\n\nconst hashedModelKeys = {};\nfor (const model of Object.keys(convert)) {\n\thashedModelKeys[[...convert[model].labels].sort().join('')] = model;\n}\n\nconst limiters = {};\n\nfunction Color(object, model) {\n\tif (!(this instanceof Color)) {\n\t\treturn new Color(object, model);\n\t}\n\n\tif (model && model in skippedModels) {\n\t\tmodel = null;\n\t}\n\n\tif (model && !(model in convert)) {\n\t\tthrow new Error('Unknown model: ' + model);\n\t}\n\n\tlet i;\n\tlet channels;\n\n\tif (object == null) { // eslint-disable-line no-eq-null,eqeqeq\n\t\tthis.model = 'rgb';\n\t\tthis.color = [0, 0, 0];\n\t\tthis.valpha = 1;\n\t} else if (object instanceof Color) {\n\t\tthis.model = object.model;\n\t\tthis.color = [...object.color];\n\t\tthis.valpha = object.valpha;\n\t} else if (typeof object === 'string') {\n\t\tconst result = colorString.get(object);\n\t\tif (result === null) {\n\t\t\tthrow new Error('Unable to parse color from string: ' + object);\n\t\t}\n\n\t\tthis.model = result.model;\n\t\tchannels = convert[this.model].channels;\n\t\tthis.color = result.value.slice(0, channels);\n\t\tthis.valpha = typeof result.value[channels] === 'number' ? result.value[channels] : 1;\n\t} else if (object.length > 0) {\n\t\tthis.model = model || 'rgb';\n\t\tchannels = convert[this.model].channels;\n\t\tconst newArray = Array.prototype.slice.call(object, 0, channels);\n\t\tthis.color = zeroArray(newArray, channels);\n\t\tthis.valpha = typeof object[channels] === 'number' ? object[channels] : 1;\n\t} else if (typeof object === 'number') {\n\t\t// This is always RGB - can be converted later on.\n\t\tthis.model = 'rgb';\n\t\tthis.color = [\n\t\t\t(object >> 16) & 0xFF,\n\t\t\t(object >> 8) & 0xFF,\n\t\t\tobject & 0xFF,\n\t\t];\n\t\tthis.valpha = 1;\n\t} else {\n\t\tthis.valpha = 1;\n\n\t\tconst keys = Object.keys(object);\n\t\tif ('alpha' in object) {\n\t\t\tkeys.splice(keys.indexOf('alpha'), 1);\n\t\t\tthis.valpha = typeof object.alpha === 'number' ? object.alpha : 0;\n\t\t}\n\n\t\tconst hashedKeys = keys.sort().join('');\n\t\tif (!(hashedKeys in hashedModelKeys)) {\n\t\t\tthrow new Error('Unable to parse color from object: ' + JSON.stringify(object));\n\t\t}\n\n\t\tthis.model = hashedModelKeys[hashedKeys];\n\n\t\tconst {labels} = convert[this.model];\n\t\tconst color = [];\n\t\tfor (i = 0; i < labels.length; i++) {\n\t\t\tcolor.push(object[labels[i]]);\n\t\t}\n\n\t\tthis.color = zeroArray(color);\n\t}\n\n\t// Perform limitations (clamping, etc.)\n\tif (limiters[this.model]) {\n\t\tchannels = convert[this.model].channels;\n\t\tfor (i = 0; i < channels; i++) {\n\t\t\tconst limit = limiters[this.model][i];\n\t\t\tif (limit) {\n\t\t\t\tthis.color[i] = limit(this.color[i]);\n\t\t\t}\n\t\t}\n\t}\n\n\tthis.valpha = Math.max(0, Math.min(1, this.valpha));\n\n\tif (Object.freeze) {\n\t\tObject.freeze(this);\n\t}\n}\n\nColor.prototype = {\n\ttoString() {\n\t\treturn this.string();\n\t},\n\n\ttoJSON() {\n\t\treturn this[this.model]();\n\t},\n\n\tstring(places) {\n\t\tlet self = this.model in colorString.to ? this : this.rgb();\n\t\tself = self.round(typeof places === 'number' ? places : 1);\n\t\tconst args = self.valpha === 1 ? self.color : [...self.color, this.valpha];\n\t\treturn colorString.to[self.model](args);\n\t},\n\n\tpercentString(places) {\n\t\tconst self = this.rgb().round(typeof places === 'number' ? places : 1);\n\t\tconst args = self.valpha === 1 ? self.color : [...self.color, this.valpha];\n\t\treturn colorString.to.rgb.percent(args);\n\t},\n\n\tarray() {\n\t\treturn this.valpha === 1 ? [...this.color] : [...this.color, this.valpha];\n\t},\n\n\tobject() {\n\t\tconst result = {};\n\t\tconst {channels} = convert[this.model];\n\t\tconst {labels} = convert[this.model];\n\n\t\tfor (let i = 0; i < channels; i++) {\n\t\t\tresult[labels[i]] = this.color[i];\n\t\t}\n\n\t\tif (this.valpha !== 1) {\n\t\t\tresult.alpha = this.valpha;\n\t\t}\n\n\t\treturn result;\n\t},\n\n\tunitArray() {\n\t\tconst rgb = this.rgb().color;\n\t\trgb[0] /= 255;\n\t\trgb[1] /= 255;\n\t\trgb[2] /= 255;\n\n\t\tif (this.valpha !== 1) {\n\t\t\trgb.push(this.valpha);\n\t\t}\n\n\t\treturn rgb;\n\t},\n\n\tunitObject() {\n\t\tconst rgb = this.rgb().object();\n\t\trgb.r /= 255;\n\t\trgb.g /= 255;\n\t\trgb.b /= 255;\n\n\t\tif (this.valpha !== 1) {\n\t\t\trgb.alpha = this.valpha;\n\t\t}\n\n\t\treturn rgb;\n\t},\n\n\tround(places) {\n\t\tplaces = Math.max(places || 0, 0);\n\t\treturn new Color([...this.color.map(roundToPlace(places)), this.valpha], this.model);\n\t},\n\n\talpha(value) {\n\t\tif (value !== undefined) {\n\t\t\treturn new Color([...this.color, Math.max(0, Math.min(1, value))], this.model);\n\t\t}\n\n\t\treturn this.valpha;\n\t},\n\n\t// Rgb\n\tred: getset('rgb', 0, maxfn(255)),\n\tgreen: getset('rgb', 1, maxfn(255)),\n\tblue: getset('rgb', 2, maxfn(255)),\n\n\thue: getset(['hsl', 'hsv', 'hsl', 'hwb', 'hcg'], 0, value => ((value % 360) + 360) % 360),\n\n\tsaturationl: getset('hsl', 1, maxfn(100)),\n\tlightness: getset('hsl', 2, maxfn(100)),\n\n\tsaturationv: getset('hsv', 1, maxfn(100)),\n\tvalue: getset('hsv', 2, maxfn(100)),\n\n\tchroma: getset('hcg', 1, maxfn(100)),\n\tgray: getset('hcg', 2, maxfn(100)),\n\n\twhite: getset('hwb', 1, maxfn(100)),\n\twblack: getset('hwb', 2, maxfn(100)),\n\n\tcyan: getset('cmyk', 0, maxfn(100)),\n\tmagenta: getset('cmyk', 1, maxfn(100)),\n\tyellow: getset('cmyk', 2, maxfn(100)),\n\tblack: getset('cmyk', 3, maxfn(100)),\n\n\tx: getset('xyz', 0, maxfn(95.047)),\n\ty: getset('xyz', 1, maxfn(100)),\n\tz: getset('xyz', 2, maxfn(108.833)),\n\n\tl: getset('lab', 0, maxfn(100)),\n\ta: getset('lab', 1),\n\tb: getset('lab', 2),\n\n\tkeyword(value) {\n\t\tif (value !== undefined) {\n\t\t\treturn new Color(value);\n\t\t}\n\n\t\treturn convert[this.model].keyword(this.color);\n\t},\n\n\thex(value) {\n\t\tif (value !== undefined) {\n\t\t\treturn new Color(value);\n\t\t}\n\n\t\treturn colorString.to.hex(this.rgb().round().color);\n\t},\n\n\thexa(value) {\n\t\tif (value !== undefined) {\n\t\t\treturn new Color(value);\n\t\t}\n\n\t\tconst rgbArray = this.rgb().round().color;\n\n\t\tlet alphaHex = Math.round(this.valpha * 255).toString(16).toUpperCase();\n\t\tif (alphaHex.length === 1) {\n\t\t\talphaHex = '0' + alphaHex;\n\t\t}\n\n\t\treturn colorString.to.hex(rgbArray) + alphaHex;\n\t},\n\n\trgbNumber() {\n\t\tconst rgb = this.rgb().color;\n\t\treturn ((rgb[0] & 0xFF) << 16) | ((rgb[1] & 0xFF) << 8) | (rgb[2] & 0xFF);\n\t},\n\n\tluminosity() {\n\t\t// http://www.w3.org/TR/WCAG20/#relativeluminancedef\n\t\tconst rgb = this.rgb().color;\n\n\t\tconst lum = [];\n\t\tfor (const [i, element] of rgb.entries()) {\n\t\t\tconst chan = element / 255;\n\t\t\tlum[i] = (chan <= 0.04045) ? chan / 12.92 : ((chan + 0.055) / 1.055) ** 2.4;\n\t\t}\n\n\t\treturn 0.2126 * lum[0] + 0.7152 * lum[1] + 0.0722 * lum[2];\n\t},\n\n\tcontrast(color2) {\n\t\t// http://www.w3.org/TR/WCAG20/#contrast-ratiodef\n\t\tconst lum1 = this.luminosity();\n\t\tconst lum2 = color2.luminosity();\n\n\t\tif (lum1 > lum2) {\n\t\t\treturn (lum1 + 0.05) / (lum2 + 0.05);\n\t\t}\n\n\t\treturn (lum2 + 0.05) / (lum1 + 0.05);\n\t},\n\n\tlevel(color2) {\n\t\t// https://www.w3.org/TR/WCAG/#contrast-enhanced\n\t\tconst contrastRatio = this.contrast(color2);\n\t\tif (contrastRatio >= 7) {\n\t\t\treturn 'AAA';\n\t\t}\n\n\t\treturn (contrastRatio >= 4.5) ? 'AA' : '';\n\t},\n\n\tisDark() {\n\t\t// YIQ equation from http://24ways.org/2010/calculating-color-contrast\n\t\tconst rgb = this.rgb().color;\n\t\tconst yiq = (rgb[0] * 2126 + rgb[1] * 7152 + rgb[2] * 722) / 10000;\n\t\treturn yiq < 128;\n\t},\n\n\tisLight() {\n\t\treturn !this.isDark();\n\t},\n\n\tnegate() {\n\t\tconst rgb = this.rgb();\n\t\tfor (let i = 0; i < 3; i++) {\n\t\t\trgb.color[i] = 255 - rgb.color[i];\n\t\t}\n\n\t\treturn rgb;\n\t},\n\n\tlighten(ratio) {\n\t\tconst hsl = this.hsl();\n\t\thsl.color[2] += hsl.color[2] * ratio;\n\t\treturn hsl;\n\t},\n\n\tdarken(ratio) {\n\t\tconst hsl = this.hsl();\n\t\thsl.color[2] -= hsl.color[2] * ratio;\n\t\treturn hsl;\n\t},\n\n\tsaturate(ratio) {\n\t\tconst hsl = this.hsl();\n\t\thsl.color[1] += hsl.color[1] * ratio;\n\t\treturn hsl;\n\t},\n\n\tdesaturate(ratio) {\n\t\tconst hsl = this.hsl();\n\t\thsl.color[1] -= hsl.color[1] * ratio;\n\t\treturn hsl;\n\t},\n\n\twhiten(ratio) {\n\t\tconst hwb = this.hwb();\n\t\thwb.color[1] += hwb.color[1] * ratio;\n\t\treturn hwb;\n\t},\n\n\tblacken(ratio) {\n\t\tconst hwb = this.hwb();\n\t\thwb.color[2] += hwb.color[2] * ratio;\n\t\treturn hwb;\n\t},\n\n\tgrayscale() {\n\t\t// http://en.wikipedia.org/wiki/Grayscale#Converting_color_to_grayscale\n\t\tconst rgb = this.rgb().color;\n\t\tconst value = rgb[0] * 0.3 + rgb[1] * 0.59 + rgb[2] * 0.11;\n\t\treturn Color.rgb(value, value, value);\n\t},\n\n\tfade(ratio) {\n\t\treturn this.alpha(this.valpha - (this.valpha * ratio));\n\t},\n\n\topaquer(ratio) {\n\t\treturn this.alpha(this.valpha + (this.valpha * ratio));\n\t},\n\n\trotate(degrees) {\n\t\tconst hsl = this.hsl();\n\t\tlet hue = hsl.color[0];\n\t\thue = (hue + degrees) % 360;\n\t\thue = hue < 0 ? 360 + hue : hue;\n\t\thsl.color[0] = hue;\n\t\treturn hsl;\n\t},\n\n\tmix(mixinColor, weight) {\n\t\t// Ported from sass implementation in C\n\t\t// https://github.com/sass/libsass/blob/0e6b4a2850092356aa3ece07c6b249f0221caced/functions.cpp#L209\n\t\tif (!mixinColor || !mixinColor.rgb) {\n\t\t\tthrow new Error('Argument to \"mix\" was not a Color instance, but rather an instance of ' + typeof mixinColor);\n\t\t}\n\n\t\tconst color1 = mixinColor.rgb();\n\t\tconst color2 = this.rgb();\n\t\tconst p = weight === undefined ? 0.5 : weight;\n\n\t\tconst w = 2 * p - 1;\n\t\tconst a = color1.alpha() - color2.alpha();\n\n\t\tconst w1 = (((w * a === -1) ? w : (w + a) / (1 + w * a)) + 1) / 2;\n\t\tconst w2 = 1 - w1;\n\n\t\treturn Color.rgb(\n\t\t\tw1 * color1.red() + w2 * color2.red(),\n\t\t\tw1 * color1.green() + w2 * color2.green(),\n\t\t\tw1 * color1.blue() + w2 * color2.blue(),\n\t\t\tcolor1.alpha() * p + color2.alpha() * (1 - p));\n\t},\n};\n\n// Model conversion methods and static constructors\nfor (const model of Object.keys(convert)) {\n\tif (skippedModels.includes(model)) {\n\t\tcontinue;\n\t}\n\n\tconst {channels} = convert[model];\n\n\t// Conversion methods\n\tColor.prototype[model] = function (...args) {\n\t\tif (this.model === model) {\n\t\t\treturn new Color(this);\n\t\t}\n\n\t\tif (args.length > 0) {\n\t\t\treturn new Color(args, model);\n\t\t}\n\n\t\treturn new Color([...assertArray(convert[this.model][model].raw(this.color)), this.valpha], model);\n\t};\n\n\t// 'static' construction methods\n\tColor[model] = function (...args) {\n\t\tlet color = args[0];\n\t\tif (typeof color === 'number') {\n\t\t\tcolor = zeroArray(args, channels);\n\t\t}\n\n\t\treturn new Color(color, model);\n\t};\n}\n\nfunction roundTo(number, places) {\n\treturn Number(number.toFixed(places));\n}\n\nfunction roundToPlace(places) {\n\treturn function (number) {\n\t\treturn roundTo(number, places);\n\t};\n}\n\nfunction getset(model, channel, modifier) {\n\tmodel = Array.isArray(model) ? model : [model];\n\n\tfor (const m of model) {\n\t\t(limiters[m] || (limiters[m] = []))[channel] = modifier;\n\t}\n\n\tmodel = model[0];\n\n\treturn function (value) {\n\t\tlet result;\n\n\t\tif (value !== undefined) {\n\t\t\tif (modifier) {\n\t\t\t\tvalue = modifier(value);\n\t\t\t}\n\n\t\t\tresult = this[model]();\n\t\t\tresult.color[channel] = value;\n\t\t\treturn result;\n\t\t}\n\n\t\tresult = this[model]().color[channel];\n\t\tif (modifier) {\n\t\t\tresult = modifier(result);\n\t\t}\n\n\t\treturn result;\n\t};\n}\n\nfunction maxfn(max) {\n\treturn function (v) {\n\t\treturn Math.max(0, Math.min(max, v));\n\t};\n}\n\nfunction assertArray(value) {\n\treturn Array.isArray(value) ? value : [value];\n}\n\nfunction zeroArray(array, length) {\n\tfor (let i = 0; i < length; i++) {\n\t\tif (typeof array[i] !== 'number') {\n\t\t\tarray[i] = 0;\n\t\t}\n\t}\n\n\treturn array;\n}\n\nmodule.exports = Color;\n","import {PixieTheme} from '../config/default-config';\nimport {CssTheme} from '../common/ui/themes/css-theme';\nimport {DEFAULT_THEMES} from '../config/default-themes';\nimport color from 'color';\n\nexport function pixieThemeToCssTheme(theme: PixieTheme): CssTheme {\n  const defaultTheme = theme.isDark\n    ? DEFAULT_THEMES.find(t => t.isDark)\n    : DEFAULT_THEMES.find(t => !t.isDark);\n\n  const mergedTheme = {\n    ...defaultTheme,\n    ...theme,\n    colors: {\n      ...defaultTheme?.colors,\n      ...theme.colors,\n    },\n  };\n\n  const parsedColors = Object.entries(mergedTheme.colors).map(\n    ([key, value]) => {\n      return [key, parseThemeValue(value)];\n    }\n  );\n\n  return {\n    id: mergedTheme.name,\n    name: mergedTheme.name,\n    colors: Object.fromEntries(parsedColors),\n    is_dark: mergedTheme.isDark,\n  };\n}\n\nfunction parseThemeValue(value: string) {\n  // opacity or rgb string: 0 0 0\n  if (value.endsWith('%') || value.split(' ').length === 3) {\n    return value;\n  }\n  // convert user provided color to rgb string\n  return color(value).rgb().array().slice(0, 3).join(' ');\n}\n","export let rootEl = (\n  typeof document !== 'undefined'\n    ? document.getElementById('root') ?? document.body\n    : undefined\n) as HTMLElement;\n\nexport function setRootEl(el: HTMLElement) {\n  rootEl = el;\n}\n","import {rootEl} from '../../../core/root-el';\n\nexport function setThemeColor(key: string, value: string) {\n  rootEl?.style.setProperty(key, value);\n}\n","import {CssTheme} from '../css-theme';\nimport {setThemeColor} from './set-theme-color';\nimport {rootEl} from '../../../core/root-el';\n\nexport function applyThemeToDom(theme: CssTheme) {\n  Object.entries(theme.colors).forEach(([key, value]) => {\n    setThemeColor(key, value);\n  });\n  if (theme.is_dark) {\n    rootEl.classList.add('dark');\n  } else {\n    rootEl.classList.remove('dark');\n  }\n}\n","import create, {GetState} from 'zustand';\nimport {subscribeWithSelector} from 'zustand/middleware';\nimport {castDraft, Draft} from 'immer';\nimport {DEFAULT_CONFIG} from '../config/default-config';\nimport {mergeConfig} from '../config/merge-config';\nimport {\n  createHistorySlice,\n  HistorySlice,\n} from '../tools/history/state/history-slice';\nimport {createFilterSlice, FilterSlice} from '../tools/filter/filter-slice';\nimport {createCropSlice, CropSlice} from '../tools/crop/crop-slice';\nimport {createObjectsSlice, ObjectsSlice} from '../objects/state/objects-slice';\nimport {createFrameSlice, FrameSlice} from '../tools/frame/frame-slice';\nimport {\n  createResizeSlice,\n  ResizeSlice,\n} from '../tools/resize/state/resize-slice';\nimport {EditorState} from './editor-state';\nimport {CornersSlice, createCornersSlice} from '../tools/corners/corners-slice';\nimport {immer} from 'zustand/middleware/immer';\nimport {PlainRect} from '../common/utils/dom/get-bounding-client-rect';\nimport {pixieThemeToCssTheme} from '../utils/pixie-theme-to-css-theme';\nimport {applyThemeToDom} from '../common/ui/themes/utils/apply-theme-to-dom';\n\nexport type StoreSlice<T> = (\n  set: (\n    partial: ((draft: Draft<PixieState>) => void) | Partial<PixieState>,\n    replace?: boolean\n  ) => void,\n  get: GetState<PixieState>\n) => T;\n\nexport type PixieState = EditorState &\n  HistorySlice &\n  ObjectsSlice &\n  FilterSlice &\n  CropSlice &\n  FrameSlice &\n  ResizeSlice &\n  CornersSlice;\n\nconst EMPTY_PLAIN_RECT: PlainRect = {\n  top: 0,\n  right: 0,\n  bottom: 0,\n  left: 0,\n  width: 0,\n  height: 0,\n};\n\nexport const useStore = create<PixieState>()(\n  subscribeWithSelector(\n    immer((set, get) => ({\n      editor: null!,\n      fabric: null!,\n      bootstrapData: {},\n      config: DEFAULT_CONFIG,\n      zoom: 1,\n      dirty: false,\n      original: {\n        width: 1,\n        height: 1,\n      },\n      stageSize: EMPTY_PLAIN_RECT,\n      canvasSize: EMPTY_PLAIN_RECT,\n      canvasRef: null,\n      activeTool: null,\n      activeToolOverlay: null,\n      loading: false,\n      openPanels: {\n        newImage: false,\n        history: false,\n        objects: false,\n        export: false,\n      },\n      ...createHistorySlice(set, get),\n      ...createObjectsSlice(set, get),\n      ...createFilterSlice(set, get),\n      ...createCropSlice(set, get),\n      ...createFrameSlice(set, get),\n      ...createResizeSlice(set, get),\n      ...createCornersSlice(set, get),\n\n      // actions\n      setZoom: newZoom =>\n        set(state => {\n          state.zoom = newZoom;\n        }),\n      setOriginal: (width, height) =>\n        set(state => {\n          state.original = {width, height};\n        }),\n      setDirty: isDirty =>\n        set(state => {\n          state.dirty = isDirty;\n        }),\n      toggleLoading: isLoading =>\n        set(state => {\n          state.loading = isLoading;\n        }),\n      setStageSize: size =>\n        set(state => {\n          state.stageSize = size;\n        }),\n      setCanvasSize: size =>\n        set(state => {\n          state.canvasSize = size;\n        }),\n      setActiveTool: (toolName, overlay) => {\n        set(state => {\n          state.activeTool = toolName;\n          state.activeToolOverlay = overlay;\n        });\n      },\n      setConfig: partialConfig =>\n        set(state => {\n          // set merged config in the store\n          const mergedConfig = mergeConfig(partialConfig, get().config);\n          state.config = castDraft(mergedConfig);\n\n          // get values from merged config and not from state to avoid stale values\n          const language = mergedConfig.activeLanguage || 'en';\n          const lines = mergedConfig.languages?.[language];\n          const themes = (mergedConfig.ui?.themes || []).map(theme =>\n            pixieThemeToCssTheme(theme)\n          );\n\n          // set css variables from changed theme\n          const activeTheme = themes.find(\n            t => t.id === mergedConfig.ui?.activeTheme\n          );\n          if (activeTheme) {\n            applyThemeToDom(activeTheme);\n          }\n\n          // set bootstrap data needed for common components\n          state.bootstrapData = {\n            i18n: {language, name: language, id: 0, lines},\n            themes: {\n              all: themes,\n            },\n          };\n        }),\n      togglePanel: (panelName, isOpen) =>\n        set(state => {\n          state.openPanels[panelName] = isOpen ?? !state.openPanels[panelName];\n        }),\n\n      applyChanges: async () => {\n        const activeToolName = get().activeTool;\n        if (!activeToolName) return;\n\n        // @ts-ignore\n        const toolSlice = get()[activeToolName];\n\n        const result = await toolSlice?.apply?.();\n\n        set(state => {\n          state.dirty = false;\n          state.activeTool = null;\n          state.activeToolOverlay = null;\n        });\n\n        // allow tools to prevent history item addition\n        if (result !== false) {\n          get().editor.tools.history.addHistoryItem({name: activeToolName});\n        }\n\n        toolSlice?.reset();\n      },\n      cancelChanges: async () => {\n        const activeToolName = get().activeTool;\n        if (!activeToolName) return;\n\n        const wasDirty = get().dirty;\n\n        set(state => {\n          state.dirty = false;\n          state.activeTool = null;\n          state.activeToolOverlay = null;\n        });\n\n        if (wasDirty) {\n          await get().editor.tools.history.reload();\n        }\n\n        // @ts-ignore\n        const toolSlice = get()[activeToolName];\n\n        // run reset after history is loaded so too state can perform any needed changes.\n        // Removing straighten anchor for example.\n        toolSlice?.reset();\n      },\n      reset: () => {\n        get().editor.tools.transform.resetStraightenAnchor();\n        set({\n          activeTool: null,\n          activeToolOverlay: null,\n          zoom: 1,\n          dirty: false,\n          loading: false,\n          openPanels: {\n            newImage: false,\n            history: false,\n            objects: false,\n            export: false,\n          },\n        });\n        get().history.reset();\n        get().objects.reset();\n        get().filter.reset();\n        get().crop.reset();\n        get().frame.reset();\n        get().resize.reset();\n        get().corners.reset();\n      },\n    }))\n  )\n);\n","import {Canvas} from 'fabric/fabric-impl';\nimport type {Tools} from '../tools/init-tools';\nimport type {PixieState} from './store';\nimport {useStore} from './store';\n\nexport function state(): PixieState {\n  return useStore.getState();\n}\n\nexport function tools(): Tools {\n  return state().editor.tools;\n}\n\nexport function fabricCanvas(): Canvas {\n  return state().fabric;\n}\n","import {state, tools} from '../state/utils';\nimport {PixieConfig} from '../config/default-config';\n\nexport function resetEditor(config?: PixieConfig): Promise<void> {\n  // reset UI\n  tools().canvas.clear();\n  tools().frame.remove();\n\n  // remove previous image and canvas size\n  state().setConfig({image: undefined, blankCanvasSize: undefined, ...config});\n\n  state().reset();\n\n  return new Promise<void>(resolve => setTimeout(resolve));\n}\n","import {SerializedPixieState} from '../history/serialized-pixie-state';\n\nexport async function fetchStateJsonFromUrl(\n  url: string\n): Promise<SerializedPixieState> {\n  const response = await fetch(url);\n  return response.json();\n}\n","import {IObjectOptions} from 'fabric/fabric-impl';\n\nexport const staticObjectConfig: IObjectOptions = {\n  selectable: false,\n  evented: false,\n  lockMovementX: true,\n  lockMovementY: true,\n  lockRotation: true,\n  lockScalingX: true,\n  lockScalingY: true,\n  lockUniScaling: true,\n  hasControls: false,\n  hasBorders: false,\n  hasRotatingPoint: false,\n  strokeWidth: 0,\n};\n","import {Image} from 'fabric/fabric-impl';\nimport {\n  SerializedFabricState,\n  SerializedPixieState,\n} from '../serialized-pixie-state';\nimport {staticObjectConfig} from '../../../objects/static-object-config';\nimport {isText} from '../../../objects/utils/is-text';\nimport {fabricCanvas, state, tools} from '../../../state/utils';\n\nexport function getCurrentCanvasState(\n  customProps: string[] = []\n): SerializedPixieState {\n  customProps = [\n    ...Object.keys(staticObjectConfig),\n    'crossOrigin',\n    'name',\n    'displayName',\n    'data',\n    ...customProps,\n  ];\n  const canvas = fabricCanvas().toJSON(\n    customProps\n  ) as unknown as SerializedFabricState;\n  canvas.objects = canvas.objects\n    .filter(obj => !obj.data.pixieInternal)\n    .map(obj => {\n      if (obj.type === 'image' && state().config.crossOrigin) {\n        (obj as Image).crossOrigin = 'anonymous';\n      }\n      // text is not selectable/movable when saving\n      // state without first moving the text object\n      if (isText(obj)) {\n        obj.selectable = true;\n        obj.lockMovementX = false;\n        obj.lockMovementY = false;\n        obj.lockUniScaling = false;\n      }\n      // make sure there are no references to live objects\n      return {...obj, data: obj.data ? {...obj.data} : {}};\n    });\n\n  const activeFrame = tools().frame.active.config\n    ? {\n        name: tools().frame.active.config!.name,\n        sizePercent: tools().frame.active.currentSizeInPercent,\n      }\n    : null;\n\n  return {\n    canvas,\n    editor: {\n      frame: activeFrame,\n      // fonts: tools().text.getUsedFonts(),\n      zoom: state().zoom,\n      activeObjectId: state().objects.active?.id || null,\n    },\n    canvasWidth: state().original.width,\n    canvasHeight: state().original.height,\n  };\n}\n","import {Object as IObject} from 'fabric/fabric-impl';\nimport {ObjectName} from '../../objects/object-name';\nimport {ToolName} from '../../tools/tool-name';\nimport {ActiveToolOverlay} from '../../state/editor-state';\nimport {fabricCanvas, state, tools} from '../../state/utils';\n\nexport function setActiveTool(name: ToolName | null = null): void {\n  // prevent changing of active tool if editor is dirty\n  if (state().dirty) {\n    return;\n  }\n\n  tools().zoom.fitToScreen();\n\n  const [toolName, overlayName] = getToolForObj(\n    fabricCanvas().getActiveObject()\n  );\n\n  if (name) {\n    state().setActiveTool(name, toolName === name ? overlayName : null);\n  } else {\n    state().setActiveTool(toolName, overlayName);\n  }\n}\n\nexport function getToolForObj(\n  obj?: IObject\n): [ToolName | null, ActiveToolOverlay | null] {\n  switch (obj?.name) {\n    case ObjectName.Text:\n      return [ToolName.TEXT, ActiveToolOverlay.Text];\n    case ObjectName.Sticker:\n    case ObjectName.Image:\n      return [ToolName.STICKERS, ActiveToolOverlay.ActiveObject];\n    case ObjectName.Shape:\n      return [ToolName.SHAPES, ActiveToolOverlay.ActiveObject];\n    default:\n      return [null, null];\n  }\n}\n","import {fabricCanvas, state} from '../../state/utils';\n\nexport function canvasIsEmpty(): boolean {\n  return (\n    !state().config.image &&\n    !state().config.blankCanvasSize &&\n    (!fabricCanvas() || fabricCanvas().getObjects().length === 0)\n  );\n}\n","export { urlAlphabet } from './url-alphabet/index.js'\nexport let random = bytes => crypto.getRandomValues(new Uint8Array(bytes))\nexport let customRandom = (alphabet, defaultSize, getRandom) => {\n  let mask = (2 << (Math.log(alphabet.length - 1) / Math.LN2)) - 1\n  let step = -~((1.6 * mask * defaultSize) / alphabet.length)\n  return (size = defaultSize) => {\n    let id = ''\n    while (true) {\n      let bytes = getRandom(step)\n      let j = step\n      while (j--) {\n        id += alphabet[bytes[j] & mask] || ''\n        if (id.length === size) return id\n      }\n    }\n  }\n}\nexport let customAlphabet = (alphabet, size = 21) =>\n  customRandom(alphabet, size, random)\nexport let nanoid = (size = 21) =>\n  crypto.getRandomValues(new Uint8Array(size)).reduce((id, byte) => {\n    byte &= 63\n    if (byte < 36) {\n      id += byte.toString(36)\n    } else if (byte < 62) {\n      id += (byte - 26).toString(36).toUpperCase()\n    } else if (byte > 62) {\n      id += '-'\n    } else {\n      id += '_'\n    }\n    return id\n  }, '')\n","export class ToastTimer {\n  private timerId?: ReturnType<typeof setTimeout>;\n  private createdAt: number = 0;\n\n  constructor(private callback: () => void, private remaining: number) {\n    this.resume();\n  }\n\n  pause() {\n    clearTimeout(this.timerId);\n    this.remaining -= Date.now() - this.createdAt;\n  }\n\n  resume() {\n    this.createdAt = Date.now();\n    if (this.timerId) {\n      clearTimeout(this.timerId);\n    }\n    this.timerId = setTimeout(this.callback, this.remaining);\n  }\n\n  clear() {\n    clearTimeout(this.timerId);\n  }\n}\n","import create from 'zustand';\nimport {immer} from 'zustand/middleware/immer';\nimport {MessageDescriptor} from '../../i18n/message-descriptor';\nimport {nanoid} from 'nanoid';\nimport {ToastTimer} from './toast-timer';\n\ntype ToastType = 'danger' | 'default' | 'positive' | null;\ntype ToastPosition = 'bottom-center' | 'bottom-right';\n\ninterface ToastAction {\n  label: string | MessageDescriptor;\n  action: string;\n}\n\nexport interface ToastOptions {\n  type?: ToastType;\n  action?: ToastAction;\n  id?: string | number;\n  duration?: number;\n  position?: 'bottom-center' | 'bottom-right';\n}\n\ninterface Toast {\n  timer?: ToastTimer | null;\n  message: string | MessageDescriptor;\n  type: ToastType;\n  id: string | number;\n  duration: number;\n  action?: ToastAction;\n  position: ToastPosition;\n}\n\ninterface ToastStore {\n  toasts: Toast[];\n  add: (message: Toast['message'], opts?: ToastOptions) => void;\n  remove: (toastId: string | number) => void;\n}\n\nconst maximumVisible = 1;\n\nfunction getDefaultDuration(type: ToastType) {\n  switch (type) {\n    case 'danger':\n      return 8000;\n    default:\n      return 3000;\n  }\n}\n\nexport const useToastStore = create<ToastStore>()(\n  immer((set, get) => ({\n    toasts: [],\n    add: (message, opts) => {\n      const amountToRemove = get().toasts.length + 1 - maximumVisible;\n      if (amountToRemove > 0) {\n        set(state => {\n          state.toasts.splice(0, amountToRemove);\n        });\n      }\n\n      const toastId = opts?.id || nanoid(6);\n      const toastType = opts?.type || 'positive';\n      const duration = opts?.duration ?? getDefaultDuration(toastType);\n      const toast: Toast = {\n        timer:\n          duration > 0\n            ? new ToastTimer(() => get().remove(toastId), duration)\n            : null,\n        message,\n        ...opts,\n        id: toastId,\n        type: toastType,\n        position: opts?.position || 'bottom-center',\n        duration,\n      };\n\n      const toastIndex = get().toasts.findIndex(t => t.id === toast.id);\n      if (toastIndex > -1) {\n        set(state => {\n          state.toasts[toastIndex] = toast;\n        });\n      } else {\n        set(state => {\n          state.toasts.push(toast);\n        });\n      }\n    },\n    remove: toastId => {\n      const newToasts = get().toasts.filter(toast => {\n        if (toastId === toast.id) {\n          toast.timer?.clear();\n          return false;\n        }\n        return true;\n      });\n      set(state => {\n        state.toasts = newToasts;\n      });\n    },\n  }))\n);\n\nexport function toastState() {\n  return useToastStore.getState();\n}\n","import {MessageDescriptor} from '../../i18n/message-descriptor';\nimport {ToastOptions, toastState} from './toast-store';\n\nexport function toast(\n  message: MessageDescriptor | string,\n  opts?: ToastOptions\n) {\n  toastState().add(message, opts);\n}\n\ntoast.danger = (message: MessageDescriptor | string, opts?: ToastOptions) => {\n  toastState().add(message, {...opts, type: 'danger'});\n};\n\ntoast.positive = (message: MessageDescriptor | string, opts?: ToastOptions) => {\n  toastState().add(message, {...opts, type: 'positive'});\n};\n","'use strict';\n\nvar m = require('react-dom');\nif (process.env.NODE_ENV === 'production') {\n  exports.createRoot = m.createRoot;\n  exports.hydrateRoot = m.hydrateRoot;\n} else {\n  var i = m.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED;\n  exports.createRoot = function(c, o) {\n    i.usingClientEntryPoint = true;\n    try {\n      return m.createRoot(c, o);\n    } finally {\n      i.usingClientEntryPoint = false;\n    }\n  };\n  exports.hydrateRoot = function(c, h, o) {\n    i.usingClientEntryPoint = true;\n    try {\n      return m.hydrateRoot(c, h, o);\n    } finally {\n      i.usingClientEntryPoint = false;\n    }\n  };\n}\n","import { createContext } from 'react';\n\n/**\n * @public\n */\nconst MotionConfigContext = createContext({\n    transformPagePoint: (p) => p,\n    isStatic: false,\n    reducedMotion: \"never\",\n});\n\nexport { MotionConfigContext };\n","import { createContext, useContext } from 'react';\n\nconst MotionContext = createContext({});\nfunction useVisualElementContext() {\n    return useContext(MotionContext).visualElement;\n}\n\nexport { MotionContext, useVisualElementContext };\n","import { createContext } from 'react';\n\n/**\n * @public\n */\nconst PresenceContext = createContext(null);\n\nexport { PresenceContext };\n","const isBrowser = typeof document !== \"undefined\";\n\nexport { isBrowser };\n","import { useLayoutEffect, useEffect } from 'react';\nimport { isBrowser } from './is-browser.mjs';\n\nconst useIsomorphicLayoutEffect = isBrowser ? useLayoutEffect : useEffect;\n\nexport { useIsomorphicLayoutEffect };\n","import { createContext } from 'react';\n\nconst LazyContext = createContext({ strict: false });\n\nexport { LazyContext };\n","import { useContext, useRef, useEffect } from 'react';\nimport { PresenceContext } from '../../context/PresenceContext.mjs';\nimport { useVisualElementContext } from '../../context/MotionContext/index.mjs';\nimport { useIsomorphicLayoutEffect } from '../../utils/use-isomorphic-effect.mjs';\nimport { LazyContext } from '../../context/LazyContext.mjs';\nimport { MotionConfigContext } from '../../context/MotionConfigContext.mjs';\n\nfunction useVisualElement(Component, visualState, props, createVisualElement) {\n    const parent = useVisualElementContext();\n    const lazyContext = useContext(LazyContext);\n    const presenceContext = useContext(PresenceContext);\n    const reducedMotionConfig = useContext(MotionConfigContext).reducedMotion;\n    const visualElementRef = useRef(undefined);\n    /**\n     * If we haven't preloaded a renderer, check to see if we have one lazy-loaded\n     */\n    createVisualElement = createVisualElement || lazyContext.renderer;\n    if (!visualElementRef.current && createVisualElement) {\n        visualElementRef.current = createVisualElement(Component, {\n            visualState,\n            parent,\n            props,\n            presenceId: presenceContext ? presenceContext.id : undefined,\n            blockInitialAnimation: presenceContext\n                ? presenceContext.initial === false\n                : false,\n            reducedMotionConfig,\n        });\n    }\n    const visualElement = visualElementRef.current;\n    useIsomorphicLayoutEffect(() => {\n        visualElement && visualElement.syncRender();\n    });\n    useEffect(() => {\n        if (visualElement && visualElement.animationState) {\n            visualElement.animationState.animateChanges();\n        }\n    });\n    useIsomorphicLayoutEffect(() => () => visualElement && visualElement.notifyUnmount(), []);\n    return visualElement;\n}\n\nexport { useVisualElement };\n","function isRefObject(ref) {\n    return (typeof ref === \"object\" &&\n        Object.prototype.hasOwnProperty.call(ref, \"current\"));\n}\n\nexport { isRefObject };\n","import { useCallback } from 'react';\nimport { isRefObject } from '../../utils/is-ref-object.mjs';\n\n/**\n * Creates a ref function that, when called, hydrates the provided\n * external ref and VisualElement.\n */\nfunction useMotionRef(visualState, visualElement, externalRef) {\n    return useCallback((instance) => {\n        instance && visualState.mount && visualState.mount(instance);\n        if (visualElement) {\n            instance\n                ? visualElement.mount(instance)\n                : visualElement.unmount();\n        }\n        if (externalRef) {\n            if (typeof externalRef === \"function\") {\n                externalRef(instance);\n            }\n            else if (isRefObject(externalRef)) {\n                externalRef.current = instance;\n            }\n        }\n    }, \n    /**\n     * Only pass a new ref callback to React if we've received a visual element\n     * factory. Otherwise we'll be mounting/remounting every time externalRef\n     * or other dependencies change.\n     */\n    [visualElement]);\n}\n\nexport { useMotionRef };\n","/**\n * Decides if the supplied variable is variant label\n */\nfunction isVariantLabel(v) {\n    return typeof v === \"string\" || Array.isArray(v);\n}\n\nexport { isVariantLabel };\n","function isAnimationControls(v) {\n    return typeof v === \"object\" && typeof v.start === \"function\";\n}\n\nexport { isAnimationControls };\n","import { isAnimationControls } from '../../animation/utils/is-animation-controls.mjs';\nimport { isVariantLabel } from './is-variant-label.mjs';\n\nconst variantProps = [\n    \"initial\",\n    \"animate\",\n    \"exit\",\n    \"whileHover\",\n    \"whileDrag\",\n    \"whileTap\",\n    \"whileFocus\",\n    \"whileInView\",\n];\nfunction isControllingVariants(props) {\n    return (isAnimationControls(props.animate) ||\n        variantProps.some((name) => isVariantLabel(props[name])));\n}\nfunction isVariantNode(props) {\n    return Boolean(isControllingVariants(props) || props.variants);\n}\n\nexport { isControllingVariants, isVariantNode };\n","import { isVariantLabel } from '../../render/utils/is-variant-label.mjs';\nimport { isControllingVariants } from '../../render/utils/is-controlling-variants.mjs';\n\nfunction getCurrentTreeVariants(props, context) {\n    if (isControllingVariants(props)) {\n        const { initial, animate } = props;\n        return {\n            initial: initial === false || isVariantLabel(initial)\n                ? initial\n                : undefined,\n            animate: isVariantLabel(animate) ? animate : undefined,\n        };\n    }\n    return props.inherit !== false ? context : {};\n}\n\nexport { getCurrentTreeVariants };\n","import { useContext, useMemo } from 'react';\nimport { MotionContext } from './index.mjs';\nimport { getCurrentTreeVariants } from './utils.mjs';\n\nfunction useCreateMotionContext(props) {\n    const { initial, animate } = getCurrentTreeVariants(props, useContext(MotionContext));\n    return useMemo(() => ({ initial, animate }), [variantLabelsAsDependency(initial), variantLabelsAsDependency(animate)]);\n}\nfunction variantLabelsAsDependency(prop) {\n    return Array.isArray(prop) ? prop.join(\" \") : prop;\n}\n\nexport { useCreateMotionContext };\n","const createDefinition = (propNames) => ({\n    isEnabled: (props) => propNames.some((name) => !!props[name]),\n});\nconst featureDefinitions = {\n    measureLayout: createDefinition([\"layout\", \"layoutId\", \"drag\"]),\n    animation: createDefinition([\n        \"animate\",\n        \"exit\",\n        \"variants\",\n        \"whileHover\",\n        \"whileTap\",\n        \"whileFocus\",\n        \"whileDrag\",\n        \"whileInView\",\n    ]),\n    exit: createDefinition([\"exit\"]),\n    drag: createDefinition([\"drag\", \"dragControls\"]),\n    focus: createDefinition([\"whileFocus\"]),\n    hover: createDefinition([\"whileHover\", \"onHoverStart\", \"onHoverEnd\"]),\n    tap: createDefinition([\"whileTap\", \"onTap\", \"onTapStart\", \"onTapCancel\"]),\n    pan: createDefinition([\n        \"onPan\",\n        \"onPanStart\",\n        \"onPanSessionStart\",\n        \"onPanEnd\",\n    ]),\n    inView: createDefinition([\n        \"whileInView\",\n        \"onViewportEnter\",\n        \"onViewportLeave\",\n    ]),\n};\n\nexport { featureDefinitions };\n","import { featureDefinitions } from './definitions.mjs';\n\nfunction loadFeatures(features) {\n    for (const key in features) {\n        if (key === \"projectionNodeConstructor\") {\n            featureDefinitions.projectionNodeConstructor = features[key];\n        }\n        else {\n            featureDefinitions[key].Component = features[key];\n        }\n    }\n}\n\nexport { loadFeatures };\n","import { useRef } from 'react';\n\n/**\n * Creates a constant value over the lifecycle of a component.\n *\n * Even if `useMemo` is provided an empty array as its final argument, it doesn't offer\n * a guarantee that it won't re-run for performance reasons later on. By using `useConstant`\n * you can ensure that initialisers don't execute twice or more.\n */\nfunction useConstant(init) {\n    const ref = useRef(null);\n    if (ref.current === null) {\n        ref.current = init();\n    }\n    return ref.current;\n}\n\nexport { useConstant };\n","/**\n * This should only ever be modified on the client otherwise it'll\n * persist through server requests. If we need instanced states we\n * could lazy-init via root.\n */\nconst globalProjectionState = {\n    /**\n     * Global flag as to whether the tree has animated since the last time\n     * we resized the window\n     */\n    hasAnimatedSinceResize: true,\n    /**\n     * We set this to true once, on the first update. Any nodes added to the tree beyond that\n     * update will be given a `data-projection-id` attribute.\n     */\n    hasEverUpdated: false,\n};\n\nexport { globalProjectionState };\n","import { useConstant } from '../../utils/use-constant.mjs';\nimport { globalProjectionState } from './state.mjs';\n\nlet id = 1;\nfunction useProjectionId() {\n    return useConstant(() => {\n        if (globalProjectionState.hasEverUpdated) {\n            return id++;\n        }\n    });\n}\n\nexport { useProjectionId };\n","import { createContext } from 'react';\n\nconst LayoutGroupContext = createContext({});\n\nexport { LayoutGroupContext };\n","import React__default from 'react';\n\nclass VisualElementHandler extends React__default.Component {\n    /**\n     * Update visual element props as soon as we know this update is going to be commited.\n     */\n    getSnapshotBeforeUpdate() {\n        const { visualElement, props } = this.props;\n        if (visualElement)\n            visualElement.setProps(props);\n        return null;\n    }\n    componentDidUpdate() { }\n    render() {\n        return this.props.children;\n    }\n}\n\nexport { VisualElementHandler };\n","import { createContext } from 'react';\n\n/**\n * Internal, exported only for usage in Framer\n */\nconst SwitchLayoutGroupContext = createContext({});\n\nexport { SwitchLayoutGroupContext };\n","const motionComponentSymbol = Symbol.for(\"motionComponentSymbol\");\n\nexport { motionComponentSymbol };\n","import * as React from 'react';\nimport { forwardRef, useContext } from 'react';\nimport { MotionConfigContext } from '../context/MotionConfigContext.mjs';\nimport { MotionContext } from '../context/MotionContext/index.mjs';\nimport { useVisualElement } from './utils/use-visual-element.mjs';\nimport { useMotionRef } from './utils/use-motion-ref.mjs';\nimport { useCreateMotionContext } from '../context/MotionContext/create.mjs';\nimport { featureDefinitions } from './features/definitions.mjs';\nimport { loadFeatures } from './features/load-features.mjs';\nimport { isBrowser } from '../utils/is-browser.mjs';\nimport { useProjectionId } from '../projection/node/id.mjs';\nimport { LayoutGroupContext } from '../context/LayoutGroupContext.mjs';\nimport { VisualElementHandler } from './utils/VisualElementHandler.mjs';\nimport { LazyContext } from '../context/LazyContext.mjs';\nimport { SwitchLayoutGroupContext } from '../context/SwitchLayoutGroupContext.mjs';\nimport { motionComponentSymbol } from './utils/symbol.mjs';\n\n/**\n * Create a `motion` component.\n *\n * This function accepts a Component argument, which can be either a string (ie \"div\"\n * for `motion.div`), or an actual React component.\n *\n * Alongside this is a config option which provides a way of rendering the provided\n * component \"offline\", or outside the React render cycle.\n */\nfunction createMotionComponent({ preloadedFeatures, createVisualElement, projectionNodeConstructor, useRender, useVisualState, Component, }) {\n    preloadedFeatures && loadFeatures(preloadedFeatures);\n    function MotionComponent(props, externalRef) {\n        const configAndProps = {\n            ...useContext(MotionConfigContext),\n            ...props,\n            layoutId: useLayoutId(props),\n        };\n        const { isStatic } = configAndProps;\n        let features = null;\n        const context = useCreateMotionContext(props);\n        /**\n         * Create a unique projection ID for this component. If a new component is added\n         * during a layout animation we'll use this to query the DOM and hydrate its ref early, allowing\n         * us to measure it as soon as any layout effect flushes pending layout animations.\n         *\n         * Performance note: It'd be better not to have to search the DOM for these elements.\n         * For newly-entering components it could be enough to only correct treeScale, in which\n         * case we could mount in a scale-correction mode. This wouldn't be enough for\n         * shared element transitions however. Perhaps for those we could revert to a root node\n         * that gets forceRendered and layout animations are triggered on its layout effect.\n         */\n        const projectionId = isStatic ? undefined : useProjectionId();\n        /**\n         *\n         */\n        const visualState = useVisualState(props, isStatic);\n        if (!isStatic && isBrowser) {\n            /**\n             * Create a VisualElement for this component. A VisualElement provides a common\n             * interface to renderer-specific APIs (ie DOM/Three.js etc) as well as\n             * providing a way of rendering to these APIs outside of the React render loop\n             * for more performant animations and interactions\n             */\n            context.visualElement = useVisualElement(Component, visualState, configAndProps, createVisualElement);\n            /**\n             * Load Motion gesture and animation features. These are rendered as renderless\n             * components so each feature can optionally make use of React lifecycle methods.\n             */\n            const lazyStrictMode = useContext(LazyContext).strict;\n            const initialLayoutGroupConfig = useContext(SwitchLayoutGroupContext);\n            if (context.visualElement) {\n                features = context.visualElement.loadFeatures(\n                // Note: Pass the full new combined props to correctly re-render dynamic feature components.\n                configAndProps, lazyStrictMode, preloadedFeatures, projectionId, projectionNodeConstructor ||\n                    featureDefinitions.projectionNodeConstructor, initialLayoutGroupConfig);\n            }\n        }\n        /**\n         * The mount order and hierarchy is specific to ensure our element ref\n         * is hydrated by the time features fire their effects.\n         */\n        return (React.createElement(VisualElementHandler, { visualElement: context.visualElement, props: configAndProps },\n            features,\n            React.createElement(MotionContext.Provider, { value: context }, useRender(Component, props, projectionId, useMotionRef(visualState, context.visualElement, externalRef), visualState, isStatic, context.visualElement))));\n    }\n    const ForwardRefComponent = forwardRef(MotionComponent);\n    ForwardRefComponent[motionComponentSymbol] = Component;\n    return ForwardRefComponent;\n}\nfunction useLayoutId({ layoutId }) {\n    const layoutGroupId = useContext(LayoutGroupContext).id;\n    return layoutGroupId && layoutId !== undefined\n        ? layoutGroupId + \"-\" + layoutId\n        : layoutId;\n}\n\nexport { createMotionComponent };\n","import { createMotionComponent } from '../../motion/index.mjs';\n\n/**\n * Convert any React component into a `motion` component. The provided component\n * **must** use `React.forwardRef` to the underlying DOM component you want to animate.\n *\n * ```jsx\n * const Component = React.forwardRef((props, ref) => {\n *   return <div ref={ref} />\n * })\n *\n * const MotionComponent = motion(Component)\n * ```\n *\n * @public\n */\nfunction createMotionProxy(createConfig) {\n    function custom(Component, customMotionComponentConfig = {}) {\n        return createMotionComponent(createConfig(Component, customMotionComponentConfig));\n    }\n    if (typeof Proxy === \"undefined\") {\n        return custom;\n    }\n    /**\n     * A cache of generated `motion` components, e.g `motion.div`, `motion.input` etc.\n     * Rather than generating them anew every render.\n     */\n    const componentCache = new Map();\n    return new Proxy(custom, {\n        /**\n         * Called when `motion` is referenced with a prop: `motion.div`, `motion.input` etc.\n         * The prop name is passed through as `key` and we can use that to generate a `motion`\n         * DOM component with that name.\n         */\n        get: (_target, key) => {\n            /**\n             * If this element doesn't exist in the component cache, create it and cache.\n             */\n            if (!componentCache.has(key)) {\n                componentCache.set(key, custom(key));\n            }\n            return componentCache.get(key);\n        },\n    });\n}\n\nexport { createMotionProxy };\n","/**\n * We keep these listed seperately as we use the lowercase tag names as part\n * of the runtime bundle to detect SVG components\n */\nconst lowercaseSVGElements = [\n    \"animate\",\n    \"circle\",\n    \"defs\",\n    \"desc\",\n    \"ellipse\",\n    \"g\",\n    \"image\",\n    \"line\",\n    \"filter\",\n    \"marker\",\n    \"mask\",\n    \"metadata\",\n    \"path\",\n    \"pattern\",\n    \"polygon\",\n    \"polyline\",\n    \"rect\",\n    \"stop\",\n    \"svg\",\n    \"switch\",\n    \"symbol\",\n    \"text\",\n    \"tspan\",\n    \"use\",\n    \"view\",\n];\n\nexport { lowercaseSVGElements };\n","import { lowercaseSVGElements } from '../../svg/lowercase-elements.mjs';\n\nfunction isSVGComponent(Component) {\n    if (\n    /**\n     * If it's not a string, it's a custom React component. Currently we only support\n     * HTML custom React components.\n     */\n    typeof Component !== \"string\" ||\n        /**\n         * If it contains a dash, the element is a custom HTML webcomponent.\n         */\n        Component.includes(\"-\")) {\n        return false;\n    }\n    else if (\n    /**\n     * If it's in our list of lowercase SVG tags, it's an SVG component\n     */\n    lowercaseSVGElements.indexOf(Component) > -1 ||\n        /**\n         * If it contains a capital letter, it's an SVG component\n         */\n        /[A-Z]/.test(Component)) {\n        return true;\n    }\n    return false;\n}\n\nexport { isSVGComponent };\n","const scaleCorrectors = {};\nfunction addScaleCorrector(correctors) {\n    Object.assign(scaleCorrectors, correctors);\n}\n\nexport { addScaleCorrector, scaleCorrectors };\n","/**\n * Generate a list of every possible transform key.\n */\nconst transformPropOrder = [\n    \"transformPerspective\",\n    \"x\",\n    \"y\",\n    \"z\",\n    \"translateX\",\n    \"translateY\",\n    \"translateZ\",\n    \"scale\",\n    \"scaleX\",\n    \"scaleY\",\n    \"rotate\",\n    \"rotateX\",\n    \"rotateY\",\n    \"rotateZ\",\n    \"skew\",\n    \"skewX\",\n    \"skewY\",\n];\n/**\n * A quick lookup for transform props.\n */\nconst transformProps = new Set(transformPropOrder);\n\nexport { transformPropOrder, transformProps };\n","import { scaleCorrectors } from '../../projection/styles/scale-correction.mjs';\nimport { transformProps } from '../../render/html/utils/transform.mjs';\n\nfunction isForcedMotionValue(key, { layout, layoutId }) {\n    return (transformProps.has(key) ||\n        key.startsWith(\"origin\") ||\n        ((layout || layoutId !== undefined) &&\n            (!!scaleCorrectors[key] || key === \"opacity\")));\n}\n\nexport { isForcedMotionValue };\n","const isMotionValue = (value) => !!(value === null || value === void 0 ? void 0 : value.getVelocity);\n\nexport { isMotionValue };\n","import { transformPropOrder } from './transform.mjs';\n\nconst translateAlias = {\n    x: \"translateX\",\n    y: \"translateY\",\n    z: \"translateZ\",\n    transformPerspective: \"perspective\",\n};\n/**\n * A function to use with Array.sort to sort transform keys by their default order.\n */\nconst sortTransformProps = (a, b) => transformPropOrder.indexOf(a) - transformPropOrder.indexOf(b);\n/**\n * Build a CSS transform style from individual x/y/scale etc properties.\n *\n * This outputs with a default order of transforms/scales/rotations, this can be customised by\n * providing a transformTemplate function.\n */\nfunction buildTransform({ transform, transformKeys }, { enableHardwareAcceleration = true, allowTransformNone = true, }, transformIsDefault, transformTemplate) {\n    // The transform string we're going to build into.\n    let transformString = \"\";\n    // Transform keys into their default order - this will determine the output order.\n    transformKeys.sort(sortTransformProps);\n    // Loop over each transform and build them into transformString\n    for (const key of transformKeys) {\n        transformString += `${translateAlias[key] || key}(${transform[key]}) `;\n    }\n    if (enableHardwareAcceleration && !transform.z) {\n        transformString += \"translateZ(0)\";\n    }\n    transformString = transformString.trim();\n    // If we have a custom `transform` template, pass our transform values and\n    // generated transformString to that before returning\n    if (transformTemplate) {\n        transformString = transformTemplate(transform, transformIsDefault ? \"\" : transformString);\n    }\n    else if (allowTransformNone && transformIsDefault) {\n        transformString = \"none\";\n    }\n    return transformString;\n}\n\nexport { buildTransform };\n","/**\n * Returns true if the provided key is a CSS variable\n */\nfunction isCSSVariable(key) {\n    return key.startsWith(\"--\");\n}\n\nexport { isCSSVariable };\n","/**\n * Provided a value and a ValueType, returns the value as that value type.\n */\nconst getValueAsType = (value, type) => {\n    return type && typeof value === \"number\"\n        ? type.transform(value)\n        : value;\n};\n\nexport { getValueAsType };\n","const clamp = (min, max) => (v) => Math.max(Math.min(v, max), min);\nconst sanitize = (v) => (v % 1 ? Number(v.toFixed(5)) : v);\nconst floatRegex = /(-)?([\\d]*\\.?[\\d])+/g;\nconst colorRegex = /(#[0-9a-f]{6}|#[0-9a-f]{3}|#(?:[0-9a-f]{2}){2,4}|(rgb|hsl)a?\\((-?[\\d\\.]+%?[,\\s]+){2}(-?[\\d\\.]+%?)\\s*[\\,\\/]?\\s*[\\d\\.]*%?\\))/gi;\nconst singleColorRegex = /^(#[0-9a-f]{3}|#(?:[0-9a-f]{2}){2,4}|(rgb|hsl)a?\\((-?[\\d\\.]+%?[,\\s]+){2}(-?[\\d\\.]+%?)\\s*[\\,\\/]?\\s*[\\d\\.]*%?\\))$/i;\nfunction isString(v) {\n    return typeof v === 'string';\n}\n\nexport { clamp, colorRegex, floatRegex, isString, sanitize, singleColorRegex };\n","import { clamp } from '../utils.mjs';\n\nconst number = {\n    test: (v) => typeof v === 'number',\n    parse: parseFloat,\n    transform: (v) => v,\n};\nconst alpha = Object.assign(Object.assign({}, number), { transform: clamp(0, 1) });\nconst scale = Object.assign(Object.assign({}, number), { default: 1 });\n\nexport { alpha, number, scale };\n","import { isString } from '../utils.mjs';\n\nconst createUnitType = (unit) => ({\n    test: (v) => isString(v) && v.endsWith(unit) && v.split(' ').length === 1,\n    parse: parseFloat,\n    transform: (v) => `${v}${unit}`,\n});\nconst degrees = createUnitType('deg');\nconst percent = createUnitType('%');\nconst px = createUnitType('px');\nconst vh = createUnitType('vh');\nconst vw = createUnitType('vw');\nconst progressPercentage = Object.assign(Object.assign({}, percent), { parse: (v) => percent.parse(v) / 100, transform: (v) => percent.transform(v * 100) });\n\nexport { degrees, percent, progressPercentage, px, vh, vw };\n","import { isString, singleColorRegex, floatRegex } from '../utils.mjs';\n\nconst isColorString = (type, testProp) => (v) => {\n    return Boolean((isString(v) && singleColorRegex.test(v) && v.startsWith(type)) ||\n        (testProp && Object.prototype.hasOwnProperty.call(v, testProp)));\n};\nconst splitColor = (aName, bName, cName) => (v) => {\n    if (!isString(v))\n        return v;\n    const [a, b, c, alpha] = v.match(floatRegex);\n    return {\n        [aName]: parseFloat(a),\n        [bName]: parseFloat(b),\n        [cName]: parseFloat(c),\n        alpha: alpha !== undefined ? parseFloat(alpha) : 1,\n    };\n};\n\nexport { isColorString, splitColor };\n","import { alpha } from '../numbers/index.mjs';\nimport { percent } from '../numbers/units.mjs';\nimport { sanitize } from '../utils.mjs';\nimport { isColorString, splitColor } from './utils.mjs';\n\nconst hsla = {\n    test: isColorString('hsl', 'hue'),\n    parse: splitColor('hue', 'saturation', 'lightness'),\n    transform: ({ hue, saturation, lightness, alpha: alpha$1 = 1 }) => {\n        return ('hsla(' +\n            Math.round(hue) +\n            ', ' +\n            percent.transform(sanitize(saturation)) +\n            ', ' +\n            percent.transform(sanitize(lightness)) +\n            ', ' +\n            sanitize(alpha.transform(alpha$1)) +\n            ')');\n    },\n};\n\nexport { hsla };\n","import { number, alpha } from '../numbers/index.mjs';\nimport { sanitize, clamp } from '../utils.mjs';\nimport { isColorString, splitColor } from './utils.mjs';\n\nconst clampRgbUnit = clamp(0, 255);\nconst rgbUnit = Object.assign(Object.assign({}, number), { transform: (v) => Math.round(clampRgbUnit(v)) });\nconst rgba = {\n    test: isColorString('rgb', 'red'),\n    parse: splitColor('red', 'green', 'blue'),\n    transform: ({ red, green, blue, alpha: alpha$1 = 1 }) => 'rgba(' +\n        rgbUnit.transform(red) +\n        ', ' +\n        rgbUnit.transform(green) +\n        ', ' +\n        rgbUnit.transform(blue) +\n        ', ' +\n        sanitize(alpha.transform(alpha$1)) +\n        ')',\n};\n\nexport { rgbUnit, rgba };\n","import { rgba } from './rgba.mjs';\nimport { isColorString } from './utils.mjs';\n\nfunction parseHex(v) {\n    let r = '';\n    let g = '';\n    let b = '';\n    let a = '';\n    if (v.length > 5) {\n        r = v.substr(1, 2);\n        g = v.substr(3, 2);\n        b = v.substr(5, 2);\n        a = v.substr(7, 2);\n    }\n    else {\n        r = v.substr(1, 1);\n        g = v.substr(2, 1);\n        b = v.substr(3, 1);\n        a = v.substr(4, 1);\n        r += r;\n        g += g;\n        b += b;\n        a += a;\n    }\n    return {\n        red: parseInt(r, 16),\n        green: parseInt(g, 16),\n        blue: parseInt(b, 16),\n        alpha: a ? parseInt(a, 16) / 255 : 1,\n    };\n}\nconst hex = {\n    test: isColorString('#'),\n    parse: parseHex,\n    transform: rgba.transform,\n};\n\nexport { hex };\n","import { isString } from '../utils.mjs';\nimport { hex } from './hex.mjs';\nimport { hsla } from './hsla.mjs';\nimport { rgba } from './rgba.mjs';\n\nconst color = {\n    test: (v) => rgba.test(v) || hex.test(v) || hsla.test(v),\n    parse: (v) => {\n        if (rgba.test(v)) {\n            return rgba.parse(v);\n        }\n        else if (hsla.test(v)) {\n            return hsla.parse(v);\n        }\n        else {\n            return hex.parse(v);\n        }\n    },\n    transform: (v) => {\n        return isString(v)\n            ? v\n            : v.hasOwnProperty('red')\n                ? rgba.transform(v)\n                : hsla.transform(v);\n    },\n};\n\nexport { color };\n","import { color } from '../color/index.mjs';\nimport { number } from '../numbers/index.mjs';\nimport { isString, floatRegex, colorRegex, sanitize } from '../utils.mjs';\n\nconst colorToken = '${c}';\nconst numberToken = '${n}';\nfunction test(v) {\n    var _a, _b, _c, _d;\n    return (isNaN(v) &&\n        isString(v) &&\n        ((_b = (_a = v.match(floatRegex)) === null || _a === void 0 ? void 0 : _a.length) !== null && _b !== void 0 ? _b : 0) + ((_d = (_c = v.match(colorRegex)) === null || _c === void 0 ? void 0 : _c.length) !== null && _d !== void 0 ? _d : 0) > 0);\n}\nfunction analyse(v) {\n    if (typeof v === 'number')\n        v = `${v}`;\n    const values = [];\n    let numColors = 0;\n    const colors = v.match(colorRegex);\n    if (colors) {\n        numColors = colors.length;\n        v = v.replace(colorRegex, colorToken);\n        values.push(...colors.map(color.parse));\n    }\n    const numbers = v.match(floatRegex);\n    if (numbers) {\n        v = v.replace(floatRegex, numberToken);\n        values.push(...numbers.map(number.parse));\n    }\n    return { values, numColors, tokenised: v };\n}\nfunction parse(v) {\n    return analyse(v).values;\n}\nfunction createTransformer(v) {\n    const { values, numColors, tokenised } = analyse(v);\n    const numValues = values.length;\n    return (v) => {\n        let output = tokenised;\n        for (let i = 0; i < numValues; i++) {\n            output = output.replace(i < numColors ? colorToken : numberToken, i < numColors ? color.transform(v[i]) : sanitize(v[i]));\n        }\n        return output;\n    };\n}\nconst convertNumbersToZero = (v) => typeof v === 'number' ? 0 : v;\nfunction getAnimatableNone(v) {\n    const parsed = parse(v);\n    const transformer = createTransformer(v);\n    return transformer(parsed.map(convertNumbersToZero));\n}\nconst complex = { test, parse, createTransformer, getAnimatableNone };\n\nexport { complex };\n","import { complex } from './index.mjs';\nimport { floatRegex } from '../utils.mjs';\n\nconst maxDefaults = new Set(['brightness', 'contrast', 'saturate', 'opacity']);\nfunction applyDefaultFilter(v) {\n    let [name, value] = v.slice(0, -1).split('(');\n    if (name === 'drop-shadow')\n        return v;\n    const [number] = value.match(floatRegex) || [];\n    if (!number)\n        return v;\n    const unit = value.replace(number, '');\n    let defaultValue = maxDefaults.has(name) ? 1 : 0;\n    if (number !== value)\n        defaultValue *= 100;\n    return name + '(' + defaultValue + unit + ')';\n}\nconst functionRegex = /([a-z-]*)\\(.*?\\)/g;\nconst filter = Object.assign(Object.assign({}, complex), { getAnimatableNone: (v) => {\n        const functions = v.match(functionRegex);\n        return functions ? functions.map(applyDefaultFilter).join(' ') : v;\n    } });\n\nexport { filter };\n","import { number } from 'style-value-types';\n\nconst int = {\n    ...number,\n    transform: Math.round,\n};\n\nexport { int };\n","import { px, degrees, scale, alpha, progressPercentage } from 'style-value-types';\nimport { int } from './type-int.mjs';\n\nconst numberValueTypes = {\n    // Border props\n    borderWidth: px,\n    borderTopWidth: px,\n    borderRightWidth: px,\n    borderBottomWidth: px,\n    borderLeftWidth: px,\n    borderRadius: px,\n    radius: px,\n    borderTopLeftRadius: px,\n    borderTopRightRadius: px,\n    borderBottomRightRadius: px,\n    borderBottomLeftRadius: px,\n    // Positioning props\n    width: px,\n    maxWidth: px,\n    height: px,\n    maxHeight: px,\n    size: px,\n    top: px,\n    right: px,\n    bottom: px,\n    left: px,\n    // Spacing props\n    padding: px,\n    paddingTop: px,\n    paddingRight: px,\n    paddingBottom: px,\n    paddingLeft: px,\n    margin: px,\n    marginTop: px,\n    marginRight: px,\n    marginBottom: px,\n    marginLeft: px,\n    // Transform props\n    rotate: degrees,\n    rotateX: degrees,\n    rotateY: degrees,\n    rotateZ: degrees,\n    scale,\n    scaleX: scale,\n    scaleY: scale,\n    scaleZ: scale,\n    skew: degrees,\n    skewX: degrees,\n    skewY: degrees,\n    distance: px,\n    translateX: px,\n    translateY: px,\n    translateZ: px,\n    x: px,\n    y: px,\n    z: px,\n    perspective: px,\n    transformPerspective: px,\n    opacity: alpha,\n    originX: progressPercentage,\n    originY: progressPercentage,\n    originZ: px,\n    // Misc\n    zIndex: int,\n    // SVG\n    fillOpacity: alpha,\n    strokeOpacity: alpha,\n    numOctaves: int,\n};\n\nexport { numberValueTypes };\n","import { buildTransform } from './build-transform.mjs';\nimport { isCSSVariable } from '../../dom/utils/is-css-variable.mjs';\nimport { transformProps } from './transform.mjs';\nimport { getValueAsType } from '../../dom/value-types/get-as-type.mjs';\nimport { numberValueTypes } from '../../dom/value-types/number.mjs';\n\nfunction buildHTMLStyles(state, latestValues, options, transformTemplate) {\n    const { style, vars, transform, transformKeys, transformOrigin } = state;\n    transformKeys.length = 0;\n    // Track whether we encounter any transform or transformOrigin values.\n    let hasTransform = false;\n    let hasTransformOrigin = false;\n    // Does the calculated transform essentially equal \"none\"?\n    let transformIsNone = true;\n    /**\n     * Loop over all our latest animated values and decide whether to handle them\n     * as a style or CSS variable.\n     *\n     * Transforms and transform origins are kept seperately for further processing.\n     */\n    for (const key in latestValues) {\n        const value = latestValues[key];\n        /**\n         * If this is a CSS variable we don't do any further processing.\n         */\n        if (isCSSVariable(key)) {\n            vars[key] = value;\n            continue;\n        }\n        // Convert the value to its default value type, ie 0 -> \"0px\"\n        const valueType = numberValueTypes[key];\n        const valueAsType = getValueAsType(value, valueType);\n        if (transformProps.has(key)) {\n            // If this is a transform, flag to enable further transform processing\n            hasTransform = true;\n            transform[key] = valueAsType;\n            transformKeys.push(key);\n            // If we already know we have a non-default transform, early return\n            if (!transformIsNone)\n                continue;\n            // Otherwise check to see if this is a default transform\n            if (value !== (valueType.default || 0))\n                transformIsNone = false;\n        }\n        else if (key.startsWith(\"origin\")) {\n            // If this is a transform origin, flag and enable further transform-origin processing\n            hasTransformOrigin = true;\n            transformOrigin[key] = valueAsType;\n        }\n        else {\n            style[key] = valueAsType;\n        }\n    }\n    if (!latestValues.transform) {\n        if (hasTransform || transformTemplate) {\n            style.transform = buildTransform(state, options, transformIsNone, transformTemplate);\n        }\n        else if (style.transform) {\n            /**\n             * If we have previously created a transform but currently don't have any,\n             * reset transform style to none.\n             */\n            style.transform = \"none\";\n        }\n    }\n    /**\n     * Build a transformOrigin style. Uses the same defaults as the browser for\n     * undefined origins.\n     */\n    if (hasTransformOrigin) {\n        const { originX = \"50%\", originY = \"50%\", originZ = 0, } = transformOrigin;\n        style.transformOrigin = `${originX} ${originY} ${originZ}`;\n    }\n}\n\nexport { buildHTMLStyles };\n","const createHtmlRenderState = () => ({\n    style: {},\n    transform: {},\n    transformKeys: [],\n    transformOrigin: {},\n    vars: {},\n});\n\nexport { createHtmlRenderState };\n","import { useMemo } from 'react';\nimport { isForcedMotionValue } from '../../motion/utils/is-forced-motion-value.mjs';\nimport { isMotionValue } from '../../value/utils/is-motion-value.mjs';\nimport { buildHTMLStyles } from './utils/build-styles.mjs';\nimport { createHtmlRenderState } from './utils/create-render-state.mjs';\n\nfunction copyRawValuesOnly(target, source, props) {\n    for (const key in source) {\n        if (!isMotionValue(source[key]) && !isForcedMotionValue(key, props)) {\n            target[key] = source[key];\n        }\n    }\n}\nfunction useInitialMotionValues({ transformTemplate }, visualState, isStatic) {\n    return useMemo(() => {\n        const state = createHtmlRenderState();\n        buildHTMLStyles(state, visualState, { enableHardwareAcceleration: !isStatic }, transformTemplate);\n        return Object.assign({}, state.vars, state.style);\n    }, [visualState]);\n}\nfunction useStyle(props, visualState, isStatic) {\n    const styleProp = props.style || {};\n    const style = {};\n    /**\n     * Copy non-Motion Values straight into style\n     */\n    copyRawValuesOnly(style, styleProp, props);\n    Object.assign(style, useInitialMotionValues(props, visualState, isStatic));\n    return props.transformValues ? props.transformValues(style) : style;\n}\nfunction useHTMLProps(props, visualState, isStatic) {\n    // The `any` isn't ideal but it is the type of createElement props argument\n    const htmlProps = {};\n    const style = useStyle(props, visualState, isStatic);\n    if (props.drag && props.dragListener !== false) {\n        // Disable the ghost element when a user drags\n        htmlProps.draggable = false;\n        // Disable text selection\n        style.userSelect =\n            style.WebkitUserSelect =\n                style.WebkitTouchCallout =\n                    \"none\";\n        // Disable scrolling on the draggable direction\n        style.touchAction =\n            props.drag === true\n                ? \"none\"\n                : `pan-${props.drag === \"x\" ? \"y\" : \"x\"}`;\n    }\n    htmlProps.style = style;\n    return htmlProps;\n}\n\nexport { copyRawValuesOnly, useHTMLProps };\n","const animationProps = [\n    \"animate\",\n    \"exit\",\n    \"variants\",\n    \"whileHover\",\n    \"whileTap\",\n    \"whileFocus\",\n    \"whileDrag\",\n    \"whileInView\",\n];\nconst tapProps = [\"whileTap\", \"onTap\", \"onTapStart\", \"onTapCancel\"];\nconst panProps = [\"onPan\", \"onPanStart\", \"onPanSessionStart\", \"onPanEnd\"];\nconst inViewProps = [\n    \"whileInView\",\n    \"onViewportEnter\",\n    \"onViewportLeave\",\n    \"viewport\",\n];\n/**\n * A list of all valid MotionProps.\n *\n * @privateRemarks\n * This doesn't throw if a `MotionProp` name is missing - it should.\n */\nconst validMotionProps = new Set([\n    \"initial\",\n    \"style\",\n    \"values\",\n    \"variants\",\n    \"transition\",\n    \"transformTemplate\",\n    \"transformValues\",\n    \"custom\",\n    \"inherit\",\n    \"layout\",\n    \"layoutId\",\n    \"layoutDependency\",\n    \"onLayoutAnimationStart\",\n    \"onLayoutAnimationComplete\",\n    \"onLayoutMeasure\",\n    \"onBeforeLayoutMeasure\",\n    \"onAnimationStart\",\n    \"onAnimationComplete\",\n    \"onUpdate\",\n    \"onDragStart\",\n    \"onDrag\",\n    \"onDragEnd\",\n    \"onMeasureDragConstraints\",\n    \"onDirectionLock\",\n    \"onDragTransitionEnd\",\n    \"drag\",\n    \"dragControls\",\n    \"dragListener\",\n    \"dragConstraints\",\n    \"dragDirectionLock\",\n    \"dragSnapToOrigin\",\n    \"_dragX\",\n    \"_dragY\",\n    \"dragElastic\",\n    \"dragMomentum\",\n    \"dragPropagation\",\n    \"dragTransition\",\n    \"onHoverStart\",\n    \"onHoverEnd\",\n    \"layoutScroll\",\n    ...inViewProps,\n    ...tapProps,\n    ...animationProps,\n    ...panProps,\n]);\n/**\n * Check whether a prop name is a valid `MotionProp` key.\n *\n * @param key - Name of the property to check\n * @returns `true` is key is a valid `MotionProp`.\n *\n * @public\n */\nfunction isValidMotionProp(key) {\n    return validMotionProps.has(key);\n}\n\nexport { isValidMotionProp };\n","import { isValidMotionProp } from '../../../motion/utils/valid-prop.mjs';\n\nlet shouldForward = (key) => !isValidMotionProp(key);\nfunction loadExternalIsValidProp(isValidProp) {\n    if (!isValidProp)\n        return;\n    // Explicitly filter our events\n    shouldForward = (key) => key.startsWith(\"on\") ? !isValidMotionProp(key) : isValidProp(key);\n}\n/**\n * Emotion and Styled Components both allow users to pass through arbitrary props to their components\n * to dynamically generate CSS. They both use the `@emotion/is-prop-valid` package to determine which\n * of these should be passed to the underlying DOM node.\n *\n * However, when styling a Motion component `styled(motion.div)`, both packages pass through *all* props\n * as it's seen as an arbitrary component rather than a DOM node. Motion only allows arbitrary props\n * passed through the `custom` prop so it doesn't *need* the payload or computational overhead of\n * `@emotion/is-prop-valid`, however to fix this problem we need to use it.\n *\n * By making it an optionalDependency we can offer this functionality only in the situations where it's\n * actually required.\n */\ntry {\n    /**\n     * We attempt to import this package but require won't be defined in esm environments, in that case\n     * isPropValid will have to be provided via `MotionContext`. In a 6.0.0 this should probably be removed\n     * in favour of explicit injection.\n     */\n    loadExternalIsValidProp(require(\"@emotion/is-prop-valid\").default);\n}\ncatch (_a) {\n    // We don't need to actually do anything here - the fallback is the existing `isPropValid`.\n}\nfunction filterProps(props, isDom, forwardMotionProps) {\n    const filteredProps = {};\n    for (const key in props) {\n        if (shouldForward(key) ||\n            (forwardMotionProps === true && isValidMotionProp(key)) ||\n            (!isDom && !isValidMotionProp(key)) ||\n            // If trying to use native HTML drag events, forward drag listeners\n            (props[\"draggable\"] && key.startsWith(\"onDrag\"))) {\n            filteredProps[key] = props[key];\n        }\n    }\n    return filteredProps;\n}\n\nexport { filterProps, loadExternalIsValidProp };\n","import { px } from 'style-value-types';\n\nfunction calcOrigin(origin, offset, size) {\n    return typeof origin === \"string\"\n        ? origin\n        : px.transform(offset + size * origin);\n}\n/**\n * The SVG transform origin defaults are different to CSS and is less intuitive,\n * so we use the measured dimensions of the SVG to reconcile these.\n */\nfunction calcSVGTransformOrigin(dimensions, originX, originY) {\n    const pxOriginX = calcOrigin(originX, dimensions.x, dimensions.width);\n    const pxOriginY = calcOrigin(originY, dimensions.y, dimensions.height);\n    return `${pxOriginX} ${pxOriginY}`;\n}\n\nexport { calcSVGTransformOrigin };\n","import { px } from 'style-value-types';\n\nconst dashKeys = {\n    offset: \"stroke-dashoffset\",\n    array: \"stroke-dasharray\",\n};\nconst camelKeys = {\n    offset: \"strokeDashoffset\",\n    array: \"strokeDasharray\",\n};\n/**\n * Build SVG path properties. Uses the path's measured length to convert\n * our custom pathLength, pathSpacing and pathOffset into stroke-dashoffset\n * and stroke-dasharray attributes.\n *\n * This function is mutative to reduce per-frame GC.\n */\nfunction buildSVGPath(attrs, length, spacing = 1, offset = 0, useDashCase = true) {\n    // Normalise path length by setting SVG attribute pathLength to 1\n    attrs.pathLength = 1;\n    // We use dash case when setting attributes directly to the DOM node and camel case\n    // when defining props on a React component.\n    const keys = useDashCase ? dashKeys : camelKeys;\n    // Build the dash offset\n    attrs[keys.offset] = px.transform(-offset);\n    // Build the dash array\n    const pathLength = px.transform(length);\n    const pathSpacing = px.transform(spacing);\n    attrs[keys.array] = `${pathLength} ${pathSpacing}`;\n}\n\nexport { buildSVGPath };\n","import { buildHTMLStyles } from '../../html/utils/build-styles.mjs';\nimport { calcSVGTransformOrigin } from './transform-origin.mjs';\nimport { buildSVGPath } from './path.mjs';\n\n/**\n * Build SVG visual attrbutes, like cx and style.transform\n */\nfunction buildSVGAttrs(state, { attrX, attrY, originX, originY, pathLength, pathSpacing = 1, pathOffset = 0, \n// This is object creation, which we try to avoid per-frame.\n...latest }, options, transformTemplate) {\n    buildHTMLStyles(state, latest, options, transformTemplate);\n    state.attrs = state.style;\n    state.style = {};\n    const { attrs, style, dimensions } = state;\n    /**\n     * However, we apply transforms as CSS transforms. So if we detect a transform we take it from attrs\n     * and copy it into style.\n     */\n    if (attrs.transform) {\n        if (dimensions)\n            style.transform = attrs.transform;\n        delete attrs.transform;\n    }\n    // Parse transformOrigin\n    if (dimensions &&\n        (originX !== undefined || originY !== undefined || style.transform)) {\n        style.transformOrigin = calcSVGTransformOrigin(dimensions, originX !== undefined ? originX : 0.5, originY !== undefined ? originY : 0.5);\n    }\n    // Treat x/y not as shortcuts but as actual attributes\n    if (attrX !== undefined)\n        attrs.x = attrX;\n    if (attrY !== undefined)\n        attrs.y = attrY;\n    // Build SVG path if one has been defined\n    if (pathLength !== undefined) {\n        buildSVGPath(attrs, pathLength, pathSpacing, pathOffset, false);\n    }\n}\n\nexport { buildSVGAttrs };\n","import { createHtmlRenderState } from '../../html/utils/create-render-state.mjs';\n\nconst createSvgRenderState = () => ({\n    ...createHtmlRenderState(),\n    attrs: {},\n});\n\nexport { createSvgRenderState };\n","import { useMemo } from 'react';\nimport { copyRawValuesOnly } from '../html/use-props.mjs';\nimport { buildSVGAttrs } from './utils/build-attrs.mjs';\nimport { createSvgRenderState } from './utils/create-render-state.mjs';\n\nfunction useSVGProps(props, visualState) {\n    const visualProps = useMemo(() => {\n        const state = createSvgRenderState();\n        buildSVGAttrs(state, visualState, { enableHardwareAcceleration: false }, props.transformTemplate);\n        return {\n            ...state.attrs,\n            style: { ...state.style },\n        };\n    }, [visualState]);\n    if (props.style) {\n        const rawStyles = {};\n        copyRawValuesOnly(rawStyles, props.style, props);\n        visualProps.style = { ...rawStyles, ...visualProps.style };\n    }\n    return visualProps;\n}\n\nexport { useSVGProps };\n","import { createElement } from 'react';\nimport { useHTMLProps } from '../html/use-props.mjs';\nimport { filterProps } from './utils/filter-props.mjs';\nimport { isSVGComponent } from './utils/is-svg-component.mjs';\nimport { useSVGProps } from '../svg/use-props.mjs';\n\nfunction createUseRender(forwardMotionProps = false) {\n    const useRender = (Component, props, projectionId, ref, { latestValues }, isStatic) => {\n        const useVisualProps = isSVGComponent(Component)\n            ? useSVGProps\n            : useHTMLProps;\n        const visualProps = useVisualProps(props, latestValues, isStatic);\n        const filteredProps = filterProps(props, typeof Component === \"string\", forwardMotionProps);\n        const elementProps = {\n            ...filteredProps,\n            ...visualProps,\n            ref,\n        };\n        if (projectionId) {\n            elementProps[\"data-projection-id\"] = projectionId;\n        }\n        return createElement(Component, elementProps);\n    };\n    return useRender;\n}\n\nexport { createUseRender };\n","/**\n * Convert camelCase to dash-case properties.\n */\nconst camelToDash = (str) => str.replace(/([a-z])([A-Z])/g, \"$1-$2\").toLowerCase();\n\nexport { camelToDash };\n","function renderHTML(element, { style, vars }, styleProp, projection) {\n    Object.assign(element.style, style, projection && projection.getProjectionStyles(styleProp));\n    // Loop over any CSS variables and assign those.\n    for (const key in vars) {\n        element.style.setProperty(key, vars[key]);\n    }\n}\n\nexport { renderHTML };\n","/**\n * A set of attribute names that are always read/written as camel case.\n */\nconst camelCaseAttributes = new Set([\n    \"baseFrequency\",\n    \"diffuseConstant\",\n    \"kernelMatrix\",\n    \"kernelUnitLength\",\n    \"keySplines\",\n    \"keyTimes\",\n    \"limitingConeAngle\",\n    \"markerHeight\",\n    \"markerWidth\",\n    \"numOctaves\",\n    \"targetX\",\n    \"targetY\",\n    \"surfaceScale\",\n    \"specularConstant\",\n    \"specularExponent\",\n    \"stdDeviation\",\n    \"tableValues\",\n    \"viewBox\",\n    \"gradientTransform\",\n    \"pathLength\",\n]);\n\nexport { camelCaseAttributes };\n","import { camelToDash } from '../../dom/utils/camel-to-dash.mjs';\nimport { renderHTML } from '../../html/utils/render.mjs';\nimport { camelCaseAttributes } from './camel-case-attrs.mjs';\n\nfunction renderSVG(element, renderState, _styleProp, projection) {\n    renderHTML(element, renderState, undefined, projection);\n    for (const key in renderState.attrs) {\n        element.setAttribute(!camelCaseAttributes.has(key) ? camelToDash(key) : key, renderState.attrs[key]);\n    }\n}\n\nexport { renderSVG };\n","import { isForcedMotionValue } from '../../../motion/utils/is-forced-motion-value.mjs';\nimport { isMotionValue } from '../../../value/utils/is-motion-value.mjs';\n\nfunction scrapeMotionValuesFromProps(props) {\n    const { style } = props;\n    const newValues = {};\n    for (const key in style) {\n        if (isMotionValue(style[key]) || isForcedMotionValue(key, props)) {\n            newValues[key] = style[key];\n        }\n    }\n    return newValues;\n}\n\nexport { scrapeMotionValuesFromProps };\n","import { isMotionValue } from '../../../value/utils/is-motion-value.mjs';\nimport { scrapeMotionValuesFromProps as scrapeMotionValuesFromProps$1 } from '../../html/utils/scrape-motion-values.mjs';\n\nfunction scrapeMotionValuesFromProps(props) {\n    const newValues = scrapeMotionValuesFromProps$1(props);\n    for (const key in props) {\n        if (isMotionValue(props[key])) {\n            const targetKey = key === \"x\" || key === \"y\" ? \"attr\" + key.toUpperCase() : key;\n            newValues[targetKey] = props[key];\n        }\n    }\n    return newValues;\n}\n\nexport { scrapeMotionValuesFromProps };\n","function resolveVariantFromProps(props, definition, custom, currentValues = {}, currentVelocity = {}) {\n    /**\n     * If the variant definition is a function, resolve.\n     */\n    if (typeof definition === \"function\") {\n        definition = definition(custom !== undefined ? custom : props.custom, currentValues, currentVelocity);\n    }\n    /**\n     * If the variant definition is a variant label, or\n     * the function returned a variant label, resolve.\n     */\n    if (typeof definition === \"string\") {\n        definition = props.variants && props.variants[definition];\n    }\n    /**\n     * At this point we've resolved both functions and variant labels,\n     * but the resolved variant label might itself have been a function.\n     * If so, resolve. This can only have returned a valid target object.\n     */\n    if (typeof definition === \"function\") {\n        definition = definition(custom !== undefined ? custom : props.custom, currentValues, currentVelocity);\n    }\n    return definition;\n}\n\nexport { resolveVariantFromProps };\n","const isKeyframesTarget = (v) => {\n    return Array.isArray(v);\n};\n\nexport { isKeyframesTarget };\n","import { isKeyframesTarget } from '../animation/utils/is-keyframes-target.mjs';\n\nconst isCustomValue = (v) => {\n    return Boolean(v && typeof v === \"object\" && v.mix && v.toValue);\n};\nconst resolveFinalValueInKeyframes = (v) => {\n    // TODO maybe throw if v.length - 1 is placeholder token?\n    return isKeyframesTarget(v) ? v[v.length - 1] || 0 : v;\n};\n\nexport { isCustomValue, resolveFinalValueInKeyframes };\n","import { isCustomValue } from '../../utils/resolve-value.mjs';\nimport { isMotionValue } from './is-motion-value.mjs';\n\n/**\n * If the provided value is a MotionValue, this returns the actual value, otherwise just the value itself\n *\n * TODO: Remove and move to library\n */\nfunction resolveMotionValue(value) {\n    const unwrappedValue = isMotionValue(value) ? value.get() : value;\n    return isCustomValue(unwrappedValue)\n        ? unwrappedValue.toValue()\n        : unwrappedValue;\n}\n\nexport { resolveMotionValue };\n","import { useContext } from 'react';\nimport { isAnimationControls } from '../../animation/utils/is-animation-controls.mjs';\nimport { PresenceContext } from '../../context/PresenceContext.mjs';\nimport { resolveVariantFromProps } from '../../render/utils/resolve-variants.mjs';\nimport { useConstant } from '../../utils/use-constant.mjs';\nimport { resolveMotionValue } from '../../value/utils/resolve-motion-value.mjs';\nimport { MotionContext } from '../../context/MotionContext/index.mjs';\nimport { isControllingVariants, isVariantNode } from '../../render/utils/is-controlling-variants.mjs';\n\nfunction makeState({ scrapeMotionValuesFromProps, createRenderState, onMount, }, props, context, presenceContext) {\n    const state = {\n        latestValues: makeLatestValues(props, context, presenceContext, scrapeMotionValuesFromProps),\n        renderState: createRenderState(),\n    };\n    if (onMount) {\n        state.mount = (instance) => onMount(props, instance, state);\n    }\n    return state;\n}\nconst makeUseVisualState = (config) => (props, isStatic) => {\n    const context = useContext(MotionContext);\n    const presenceContext = useContext(PresenceContext);\n    const make = () => makeState(config, props, context, presenceContext);\n    return isStatic ? make() : useConstant(make);\n};\nfunction makeLatestValues(props, context, presenceContext, scrapeMotionValues) {\n    const values = {};\n    const motionValues = scrapeMotionValues(props);\n    for (const key in motionValues) {\n        values[key] = resolveMotionValue(motionValues[key]);\n    }\n    let { initial, animate } = props;\n    const isControllingVariants$1 = isControllingVariants(props);\n    const isVariantNode$1 = isVariantNode(props);\n    if (context &&\n        isVariantNode$1 &&\n        !isControllingVariants$1 &&\n        props.inherit !== false) {\n        if (initial === undefined)\n            initial = context.initial;\n        if (animate === undefined)\n            animate = context.animate;\n    }\n    let isInitialAnimationBlocked = presenceContext\n        ? presenceContext.initial === false\n        : false;\n    isInitialAnimationBlocked = isInitialAnimationBlocked || initial === false;\n    const variantToSet = isInitialAnimationBlocked ? animate : initial;\n    if (variantToSet &&\n        typeof variantToSet !== \"boolean\" &&\n        !isAnimationControls(variantToSet)) {\n        const list = Array.isArray(variantToSet) ? variantToSet : [variantToSet];\n        list.forEach((definition) => {\n            const resolved = resolveVariantFromProps(props, definition);\n            if (!resolved)\n                return;\n            const { transitionEnd, transition, ...target } = resolved;\n            for (const key in target) {\n                let valueTarget = target[key];\n                if (Array.isArray(valueTarget)) {\n                    /**\n                     * Take final keyframe if the initial animation is blocked because\n                     * we want to initialise at the end of that blocked animation.\n                     */\n                    const index = isInitialAnimationBlocked\n                        ? valueTarget.length - 1\n                        : 0;\n                    valueTarget = valueTarget[index];\n                }\n                if (valueTarget !== null) {\n                    values[key] = valueTarget;\n                }\n            }\n            for (const key in transitionEnd)\n                values[key] = transitionEnd[key];\n        });\n    }\n    return values;\n}\n\nexport { makeUseVisualState };\n","import { renderSVG } from './utils/render.mjs';\nimport { scrapeMotionValuesFromProps } from './utils/scrape-motion-values.mjs';\nimport { makeUseVisualState } from '../../motion/utils/use-visual-state.mjs';\nimport { createSvgRenderState } from './utils/create-render-state.mjs';\nimport { buildSVGAttrs } from './utils/build-attrs.mjs';\n\nconst svgMotionConfig = {\n    useVisualState: makeUseVisualState({\n        scrapeMotionValuesFromProps: scrapeMotionValuesFromProps,\n        createRenderState: createSvgRenderState,\n        onMount: (props, instance, { renderState, latestValues }) => {\n            try {\n                renderState.dimensions =\n                    typeof instance.getBBox ===\n                        \"function\"\n                        ? instance.getBBox()\n                        : instance.getBoundingClientRect();\n            }\n            catch (e) {\n                // Most likely trying to measure an unrendered element under Firefox\n                renderState.dimensions = {\n                    x: 0,\n                    y: 0,\n                    width: 0,\n                    height: 0,\n                };\n            }\n            buildSVGAttrs(renderState, latestValues, { enableHardwareAcceleration: false }, props.transformTemplate);\n            renderSVG(instance, renderState);\n        },\n    }),\n};\n\nexport { svgMotionConfig };\n","import { makeUseVisualState } from '../../motion/utils/use-visual-state.mjs';\nimport { scrapeMotionValuesFromProps } from './utils/scrape-motion-values.mjs';\nimport { createHtmlRenderState } from './utils/create-render-state.mjs';\n\nconst htmlMotionConfig = {\n    useVisualState: makeUseVisualState({\n        scrapeMotionValuesFromProps,\n        createRenderState: createHtmlRenderState,\n    }),\n};\n\nexport { htmlMotionConfig };\n","import { isSVGComponent } from './is-svg-component.mjs';\nimport { createUseRender } from '../use-render.mjs';\nimport { svgMotionConfig } from '../../svg/config-motion.mjs';\nimport { htmlMotionConfig } from '../../html/config-motion.mjs';\n\nfunction createDomMotionConfig(Component, { forwardMotionProps = false }, preloadedFeatures, createVisualElement, projectionNodeConstructor) {\n    const baseConfig = isSVGComponent(Component)\n        ? svgMotionConfig\n        : htmlMotionConfig;\n    return {\n        ...baseConfig,\n        preloadedFeatures,\n        useRender: createUseRender(forwardMotionProps),\n        createVisualElement,\n        projectionNodeConstructor,\n        Component,\n    };\n}\n\nexport { createDomMotionConfig };\n","var AnimationType;\n(function (AnimationType) {\n    AnimationType[\"Animate\"] = \"animate\";\n    AnimationType[\"Hover\"] = \"whileHover\";\n    AnimationType[\"Tap\"] = \"whileTap\";\n    AnimationType[\"Drag\"] = \"whileDrag\";\n    AnimationType[\"Focus\"] = \"whileFocus\";\n    AnimationType[\"InView\"] = \"whileInView\";\n    AnimationType[\"Exit\"] = \"exit\";\n})(AnimationType || (AnimationType = {}));\n\nexport { AnimationType };\n","import { useEffect } from 'react';\n\nfunction addDomEvent(target, eventName, handler, options = { passive: true }) {\n    target.addEventListener(eventName, handler, options);\n    return () => target.removeEventListener(eventName, handler);\n}\n/**\n * Attaches an event listener directly to the provided DOM element.\n *\n * Bypassing React's event system can be desirable, for instance when attaching non-passive\n * event handlers.\n *\n * ```jsx\n * const ref = useRef(null)\n *\n * useDomEvent(ref, 'wheel', onWheel, { passive: false })\n *\n * return <div ref={ref} />\n * ```\n *\n * @param ref - React.RefObject that's been provided to the element you want to bind the listener to.\n * @param eventName - Name of the event you want listen for.\n * @param handler - Function to fire when receiving the event.\n * @param options - Options to pass to `Event.addEventListener`.\n *\n * @public\n */\nfunction useDomEvent(ref, eventName, handler, options) {\n    useEffect(() => {\n        const element = ref.current;\n        if (handler && element) {\n            return addDomEvent(element, eventName, handler, options);\n        }\n    }, [ref, eventName, handler, options]);\n}\n\nexport { addDomEvent, useDomEvent };\n","import { AnimationType } from '../render/utils/types.mjs';\nimport { useDomEvent } from '../events/use-dom-event.mjs';\n\n/**\n *\n * @param props\n * @param ref\n * @internal\n */\nfunction useFocusGesture({ whileFocus, visualElement }) {\n    const { animationState } = visualElement;\n    const onFocus = () => {\n        animationState && animationState.setActive(AnimationType.Focus, true);\n    };\n    const onBlur = () => {\n        animationState && animationState.setActive(AnimationType.Focus, false);\n    };\n    useDomEvent(visualElement, \"focus\", whileFocus ? onFocus : undefined);\n    useDomEvent(visualElement, \"blur\", whileFocus ? onBlur : undefined);\n}\n\nexport { useFocusGesture };\n","function isMouseEvent(event) {\n    // PointerEvent inherits from MouseEvent so we can't use a straight instanceof check.\n    if (typeof PointerEvent !== \"undefined\" && event instanceof PointerEvent) {\n        return !!(event.pointerType === \"mouse\");\n    }\n    return event instanceof MouseEvent;\n}\nfunction isTouchEvent(event) {\n    const hasTouches = !!event.touches;\n    return hasTouches;\n}\n\nexport { isMouseEvent, isTouchEvent };\n","import { isTouchEvent } from '../gestures/utils/event-type.mjs';\n\n/**\n * Filters out events not attached to the primary pointer (currently left mouse button)\n * @param eventHandler\n */\nfunction filterPrimaryPointer(eventHandler) {\n    return (event) => {\n        const isMouseEvent = event instanceof MouseEvent;\n        const isPrimaryPointer = !isMouseEvent ||\n            (isMouseEvent && event.button === 0);\n        if (isPrimaryPointer) {\n            eventHandler(event);\n        }\n    };\n}\nconst defaultPagePoint = { pageX: 0, pageY: 0 };\nfunction pointFromTouch(e, pointType = \"page\") {\n    const primaryTouch = e.touches[0] || e.changedTouches[0];\n    const point = primaryTouch || defaultPagePoint;\n    return {\n        x: point[pointType + \"X\"],\n        y: point[pointType + \"Y\"],\n    };\n}\nfunction pointFromMouse(point, pointType = \"page\") {\n    return {\n        x: point[pointType + \"X\"],\n        y: point[pointType + \"Y\"],\n    };\n}\nfunction extractEventInfo(event, pointType = \"page\") {\n    return {\n        point: isTouchEvent(event)\n            ? pointFromTouch(event, pointType)\n            : pointFromMouse(event, pointType),\n    };\n}\nconst wrapHandler = (handler, shouldFilterPrimaryPointer = false) => {\n    const listener = (event) => handler(event, extractEventInfo(event));\n    return shouldFilterPrimaryPointer\n        ? filterPrimaryPointer(listener)\n        : listener;\n};\n\nexport { extractEventInfo, wrapHandler };\n","import { isBrowser } from '../utils/is-browser.mjs';\n\n// We check for event support via functions in case they've been mocked by a testing suite.\nconst supportsPointerEvents = () => isBrowser && window.onpointerdown === null;\nconst supportsTouchEvents = () => isBrowser && window.ontouchstart === null;\nconst supportsMouseEvents = () => isBrowser && window.onmousedown === null;\n\nexport { supportsMouseEvents, supportsPointerEvents, supportsTouchEvents };\n","import { addDomEvent, useDomEvent } from './use-dom-event.mjs';\nimport { wrapHandler } from './event-info.mjs';\nimport { supportsPointerEvents, supportsTouchEvents, supportsMouseEvents } from './utils.mjs';\n\nconst mouseEventNames = {\n    pointerdown: \"mousedown\",\n    pointermove: \"mousemove\",\n    pointerup: \"mouseup\",\n    pointercancel: \"mousecancel\",\n    pointerover: \"mouseover\",\n    pointerout: \"mouseout\",\n    pointerenter: \"mouseenter\",\n    pointerleave: \"mouseleave\",\n};\nconst touchEventNames = {\n    pointerdown: \"touchstart\",\n    pointermove: \"touchmove\",\n    pointerup: \"touchend\",\n    pointercancel: \"touchcancel\",\n};\nfunction getPointerEventName(name) {\n    if (supportsPointerEvents()) {\n        return name;\n    }\n    else if (supportsTouchEvents()) {\n        return touchEventNames[name];\n    }\n    else if (supportsMouseEvents()) {\n        return mouseEventNames[name];\n    }\n    return name;\n}\nfunction addPointerEvent(target, eventName, handler, options) {\n    return addDomEvent(target, getPointerEventName(eventName), wrapHandler(handler, eventName === \"pointerdown\"), options);\n}\nfunction usePointerEvent(ref, eventName, handler, options) {\n    return useDomEvent(ref, getPointerEventName(eventName), handler && wrapHandler(handler, eventName === \"pointerdown\"), options);\n}\n\nexport { addPointerEvent, usePointerEvent };\n","function createLock(name) {\n    let lock = null;\n    return () => {\n        const openLock = () => {\n            lock = null;\n        };\n        if (lock === null) {\n            lock = name;\n            return openLock;\n        }\n        return false;\n    };\n}\nconst globalHorizontalLock = createLock(\"dragHorizontal\");\nconst globalVerticalLock = createLock(\"dragVertical\");\nfunction getGlobalLock(drag) {\n    let lock = false;\n    if (drag === \"y\") {\n        lock = globalVerticalLock();\n    }\n    else if (drag === \"x\") {\n        lock = globalHorizontalLock();\n    }\n    else {\n        const openHorizontal = globalHorizontalLock();\n        const openVertical = globalVerticalLock();\n        if (openHorizontal && openVertical) {\n            lock = () => {\n                openHorizontal();\n                openVertical();\n            };\n        }\n        else {\n            // Release the locks because we don't use them\n            if (openHorizontal)\n                openHorizontal();\n            if (openVertical)\n                openVertical();\n        }\n    }\n    return lock;\n}\nfunction isDragActive() {\n    // Check the gesture lock - if we get it, it means no drag gesture is active\n    // and we can safely fire the tap gesture.\n    const openGestureLock = getGlobalLock(true);\n    if (!openGestureLock)\n        return true;\n    openGestureLock();\n    return false;\n}\n\nexport { createLock, getGlobalLock, isDragActive };\n","import { isMouseEvent } from './utils/event-type.mjs';\nimport { AnimationType } from '../render/utils/types.mjs';\nimport { usePointerEvent } from '../events/use-pointer-event.mjs';\nimport { isDragActive } from './drag/utils/lock.mjs';\n\nfunction createHoverEvent(visualElement, isActive, callback) {\n    return (event, info) => {\n        if (!isMouseEvent(event) || isDragActive())\n            return;\n        /**\n         * Ensure we trigger animations before firing event callback\n         */\n        if (visualElement.animationState) {\n            visualElement.animationState.setActive(AnimationType.Hover, isActive);\n        }\n        callback && callback(event, info);\n    };\n}\nfunction useHoverGesture({ onHoverStart, onHoverEnd, whileHover, visualElement, }) {\n    usePointerEvent(visualElement, \"pointerenter\", onHoverStart || whileHover\n        ? createHoverEvent(visualElement, true, onHoverStart)\n        : undefined, { passive: !onHoverStart });\n    usePointerEvent(visualElement, \"pointerleave\", onHoverEnd || whileHover\n        ? createHoverEvent(visualElement, false, onHoverEnd)\n        : undefined, { passive: !onHoverEnd });\n}\n\nexport { useHoverGesture };\n","/**\n * Recursively traverse up the tree to check whether the provided child node\n * is the parent or a descendant of it.\n *\n * @param parent - Element to find\n * @param child - Element to test against parent\n */\nconst isNodeOrChild = (parent, child) => {\n    if (!child) {\n        return false;\n    }\n    else if (parent === child) {\n        return true;\n    }\n    else {\n        return isNodeOrChild(parent, child.parentElement);\n    }\n};\n\nexport { isNodeOrChild };\n","import { useEffect } from 'react';\n\nfunction useUnmountEffect(callback) {\n    return useEffect(() => () => callback(), []);\n}\n\nexport { useUnmountEffect };\n","/******************************************************************************\r\nCopyright (c) Microsoft Corporation.\r\n\r\nPermission to use, copy, modify, and/or distribute this software for any\r\npurpose with or without fee is hereby granted.\r\n\r\nTHE SOFTWARE IS PROVIDED \"AS IS\" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH\r\nREGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY\r\nAND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,\r\nINDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM\r\nLOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR\r\nOTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR\r\nPERFORMANCE OF THIS SOFTWARE.\r\n***************************************************************************** */\r\n/* global Reflect, Promise */\r\n\r\nvar extendStatics = function(d, b) {\r\n    extendStatics = Object.setPrototypeOf ||\r\n        ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\r\n        function (d, b) { for (var p in b) if (Object.prototype.hasOwnProperty.call(b, p)) d[p] = b[p]; };\r\n    return extendStatics(d, b);\r\n};\r\n\r\nexport function __extends(d, b) {\r\n    if (typeof b !== \"function\" && b !== null)\r\n        throw new TypeError(\"Class extends value \" + String(b) + \" is not a constructor or null\");\r\n    extendStatics(d, b);\r\n    function __() { this.constructor = d; }\r\n    d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\r\n}\r\n\r\nexport var __assign = function() {\r\n    __assign = Object.assign || function __assign(t) {\r\n        for (var s, i = 1, n = arguments.length; i < n; i++) {\r\n            s = arguments[i];\r\n            for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p)) t[p] = s[p];\r\n        }\r\n        return t;\r\n    }\r\n    return __assign.apply(this, arguments);\r\n}\r\n\r\nexport function __rest(s, e) {\r\n    var t = {};\r\n    for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p) && e.indexOf(p) < 0)\r\n        t[p] = s[p];\r\n    if (s != null && typeof Object.getOwnPropertySymbols === \"function\")\r\n        for (var i = 0, p = Object.getOwnPropertySymbols(s); i < p.length; i++) {\r\n            if (e.indexOf(p[i]) < 0 && Object.prototype.propertyIsEnumerable.call(s, p[i]))\r\n                t[p[i]] = s[p[i]];\r\n        }\r\n    return t;\r\n}\r\n\r\nexport function __decorate(decorators, target, key, desc) {\r\n    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;\r\n    if (typeof Reflect === \"object\" && typeof Reflect.decorate === \"function\") r = Reflect.decorate(decorators, target, key, desc);\r\n    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;\r\n    return c > 3 && r && Object.defineProperty(target, key, r), r;\r\n}\r\n\r\nexport function __param(paramIndex, decorator) {\r\n    return function (target, key) { decorator(target, key, paramIndex); }\r\n}\r\n\r\nexport function __metadata(metadataKey, metadataValue) {\r\n    if (typeof Reflect === \"object\" && typeof Reflect.metadata === \"function\") return Reflect.metadata(metadataKey, metadataValue);\r\n}\r\n\r\nexport function __awaiter(thisArg, _arguments, P, generator) {\r\n    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }\r\n    return new (P || (P = Promise))(function (resolve, reject) {\r\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\r\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\r\n        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }\r\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\r\n    });\r\n}\r\n\r\nexport function __generator(thisArg, body) {\r\n    var _ = { label: 0, sent: function() { if (t[0] & 1) throw t[1]; return t[1]; }, trys: [], ops: [] }, f, y, t, g;\r\n    return g = { next: verb(0), \"throw\": verb(1), \"return\": verb(2) }, typeof Symbol === \"function\" && (g[Symbol.iterator] = function() { return this; }), g;\r\n    function verb(n) { return function (v) { return step([n, v]); }; }\r\n    function step(op) {\r\n        if (f) throw new TypeError(\"Generator is already executing.\");\r\n        while (_) try {\r\n            if (f = 1, y && (t = op[0] & 2 ? y[\"return\"] : op[0] ? y[\"throw\"] || ((t = y[\"return\"]) && t.call(y), 0) : y.next) && !(t = t.call(y, op[1])).done) return t;\r\n            if (y = 0, t) op = [op[0] & 2, t.value];\r\n            switch (op[0]) {\r\n                case 0: case 1: t = op; break;\r\n                case 4: _.label++; return { value: op[1], done: false };\r\n                case 5: _.label++; y = op[1]; op = [0]; continue;\r\n                case 7: op = _.ops.pop(); _.trys.pop(); continue;\r\n                default:\r\n                    if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) { _ = 0; continue; }\r\n                    if (op[0] === 3 && (!t || (op[1] > t[0] && op[1] < t[3]))) { _.label = op[1]; break; }\r\n                    if (op[0] === 6 && _.label < t[1]) { _.label = t[1]; t = op; break; }\r\n                    if (t && _.label < t[2]) { _.label = t[2]; _.ops.push(op); break; }\r\n                    if (t[2]) _.ops.pop();\r\n                    _.trys.pop(); continue;\r\n            }\r\n            op = body.call(thisArg, _);\r\n        } catch (e) { op = [6, e]; y = 0; } finally { f = t = 0; }\r\n        if (op[0] & 5) throw op[1]; return { value: op[0] ? op[1] : void 0, done: true };\r\n    }\r\n}\r\n\r\nexport var __createBinding = Object.create ? (function(o, m, k, k2) {\r\n    if (k2 === undefined) k2 = k;\r\n    var desc = Object.getOwnPropertyDescriptor(m, k);\r\n    if (!desc || (\"get\" in desc ? !m.__esModule : desc.writable || desc.configurable)) {\r\n        desc = { enumerable: true, get: function() { return m[k]; } };\r\n    }\r\n    Object.defineProperty(o, k2, desc);\r\n}) : (function(o, m, k, k2) {\r\n    if (k2 === undefined) k2 = k;\r\n    o[k2] = m[k];\r\n});\r\n\r\nexport function __exportStar(m, o) {\r\n    for (var p in m) if (p !== \"default\" && !Object.prototype.hasOwnProperty.call(o, p)) __createBinding(o, m, p);\r\n}\r\n\r\nexport function __values(o) {\r\n    var s = typeof Symbol === \"function\" && Symbol.iterator, m = s && o[s], i = 0;\r\n    if (m) return m.call(o);\r\n    if (o && typeof o.length === \"number\") return {\r\n        next: function () {\r\n            if (o && i >= o.length) o = void 0;\r\n            return { value: o && o[i++], done: !o };\r\n        }\r\n    };\r\n    throw new TypeError(s ? \"Object is not iterable.\" : \"Symbol.iterator is not defined.\");\r\n}\r\n\r\nexport function __read(o, n) {\r\n    var m = typeof Symbol === \"function\" && o[Symbol.iterator];\r\n    if (!m) return o;\r\n    var i = m.call(o), r, ar = [], e;\r\n    try {\r\n        while ((n === void 0 || n-- > 0) && !(r = i.next()).done) ar.push(r.value);\r\n    }\r\n    catch (error) { e = { error: error }; }\r\n    finally {\r\n        try {\r\n            if (r && !r.done && (m = i[\"return\"])) m.call(i);\r\n        }\r\n        finally { if (e) throw e.error; }\r\n    }\r\n    return ar;\r\n}\r\n\r\n/** @deprecated */\r\nexport function __spread() {\r\n    for (var ar = [], i = 0; i < arguments.length; i++)\r\n        ar = ar.concat(__read(arguments[i]));\r\n    return ar;\r\n}\r\n\r\n/** @deprecated */\r\nexport function __spreadArrays() {\r\n    for (var s = 0, i = 0, il = arguments.length; i < il; i++) s += arguments[i].length;\r\n    for (var r = Array(s), k = 0, i = 0; i < il; i++)\r\n        for (var a = arguments[i], j = 0, jl = a.length; j < jl; j++, k++)\r\n            r[k] = a[j];\r\n    return r;\r\n}\r\n\r\nexport function __spreadArray(to, from, pack) {\r\n    if (pack || arguments.length === 2) for (var i = 0, l = from.length, ar; i < l; i++) {\r\n        if (ar || !(i in from)) {\r\n            if (!ar) ar = Array.prototype.slice.call(from, 0, i);\r\n            ar[i] = from[i];\r\n        }\r\n    }\r\n    return to.concat(ar || Array.prototype.slice.call(from));\r\n}\r\n\r\nexport function __await(v) {\r\n    return this instanceof __await ? (this.v = v, this) : new __await(v);\r\n}\r\n\r\nexport function __asyncGenerator(thisArg, _arguments, generator) {\r\n    if (!Symbol.asyncIterator) throw new TypeError(\"Symbol.asyncIterator is not defined.\");\r\n    var g = generator.apply(thisArg, _arguments || []), i, q = [];\r\n    return i = {}, verb(\"next\"), verb(\"throw\"), verb(\"return\"), i[Symbol.asyncIterator] = function () { return this; }, i;\r\n    function verb(n) { if (g[n]) i[n] = function (v) { return new Promise(function (a, b) { q.push([n, v, a, b]) > 1 || resume(n, v); }); }; }\r\n    function resume(n, v) { try { step(g[n](v)); } catch (e) { settle(q[0][3], e); } }\r\n    function step(r) { r.value instanceof __await ? Promise.resolve(r.value.v).then(fulfill, reject) : settle(q[0][2], r); }\r\n    function fulfill(value) { resume(\"next\", value); }\r\n    function reject(value) { resume(\"throw\", value); }\r\n    function settle(f, v) { if (f(v), q.shift(), q.length) resume(q[0][0], q[0][1]); }\r\n}\r\n\r\nexport function __asyncDelegator(o) {\r\n    var i, p;\r\n    return i = {}, verb(\"next\"), verb(\"throw\", function (e) { throw e; }), verb(\"return\"), i[Symbol.iterator] = function () { return this; }, i;\r\n    function verb(n, f) { i[n] = o[n] ? function (v) { return (p = !p) ? { value: __await(o[n](v)), done: n === \"return\" } : f ? f(v) : v; } : f; }\r\n}\r\n\r\nexport function __asyncValues(o) {\r\n    if (!Symbol.asyncIterator) throw new TypeError(\"Symbol.asyncIterator is not defined.\");\r\n    var m = o[Symbol.asyncIterator], i;\r\n    return m ? m.call(o) : (o = typeof __values === \"function\" ? __values(o) : o[Symbol.iterator](), i = {}, verb(\"next\"), verb(\"throw\"), verb(\"return\"), i[Symbol.asyncIterator] = function () { return this; }, i);\r\n    function verb(n) { i[n] = o[n] && function (v) { return new Promise(function (resolve, reject) { v = o[n](v), settle(resolve, reject, v.done, v.value); }); }; }\r\n    function settle(resolve, reject, d, v) { Promise.resolve(v).then(function(v) { resolve({ value: v, done: d }); }, reject); }\r\n}\r\n\r\nexport function __makeTemplateObject(cooked, raw) {\r\n    if (Object.defineProperty) { Object.defineProperty(cooked, \"raw\", { value: raw }); } else { cooked.raw = raw; }\r\n    return cooked;\r\n};\r\n\r\nvar __setModuleDefault = Object.create ? (function(o, v) {\r\n    Object.defineProperty(o, \"default\", { enumerable: true, value: v });\r\n}) : function(o, v) {\r\n    o[\"default\"] = v;\r\n};\r\n\r\nexport function __importStar(mod) {\r\n    if (mod && mod.__esModule) return mod;\r\n    var result = {};\r\n    if (mod != null) for (var k in mod) if (k !== \"default\" && Object.prototype.hasOwnProperty.call(mod, k)) __createBinding(result, mod, k);\r\n    __setModuleDefault(result, mod);\r\n    return result;\r\n}\r\n\r\nexport function __importDefault(mod) {\r\n    return (mod && mod.__esModule) ? mod : { default: mod };\r\n}\r\n\r\nexport function __classPrivateFieldGet(receiver, state, kind, f) {\r\n    if (kind === \"a\" && !f) throw new TypeError(\"Private accessor was defined without a getter\");\r\n    if (typeof state === \"function\" ? receiver !== state || !f : !state.has(receiver)) throw new TypeError(\"Cannot read private member from an object whose class did not declare it\");\r\n    return kind === \"m\" ? f : kind === \"a\" ? f.call(receiver) : f ? f.value : state.get(receiver);\r\n}\r\n\r\nexport function __classPrivateFieldSet(receiver, state, value, kind, f) {\r\n    if (kind === \"m\") throw new TypeError(\"Private method is not writable\");\r\n    if (kind === \"a\" && !f) throw new TypeError(\"Private accessor was defined without a setter\");\r\n    if (typeof state === \"function\" ? receiver !== state || !f : !state.has(receiver)) throw new TypeError(\"Cannot write private member to an object whose class did not declare it\");\r\n    return (kind === \"a\" ? f.call(receiver, value) : f ? f.value = value : state.set(receiver, value)), value;\r\n}\r\n\r\nexport function __classPrivateFieldIn(state, receiver) {\r\n    if (receiver === null || (typeof receiver !== \"object\" && typeof receiver !== \"function\")) throw new TypeError(\"Cannot use 'in' operator on non-object\");\r\n    return typeof state === \"function\" ? receiver === state : state.has(receiver);\r\n}\r\n","var warning = function () { };\r\nvar invariant = function () { };\r\nif (process.env.NODE_ENV !== 'production') {\r\n    warning = function (check, message) {\r\n        if (!check && typeof console !== 'undefined') {\r\n            console.warn(message);\r\n        }\r\n    };\r\n    invariant = function (check, message) {\r\n        if (!check) {\r\n            throw new Error(message);\r\n        }\r\n    };\r\n}\n\nexport { invariant, warning };\n","const clamp = (min, max, v) => Math.min(Math.max(v, min), max);\n\nexport { clamp };\n","import { warning } from 'hey-listen';\nimport { clamp } from '../../utils/clamp.mjs';\n\nconst safeMin = 0.001;\nconst minDuration = 0.01;\nconst maxDuration = 10.0;\nconst minDamping = 0.05;\nconst maxDamping = 1;\nfunction findSpring({ duration = 800, bounce = 0.25, velocity = 0, mass = 1, }) {\n    let envelope;\n    let derivative;\n    warning(duration <= maxDuration * 1000, \"Spring duration must be 10 seconds or less\");\n    let dampingRatio = 1 - bounce;\n    dampingRatio = clamp(minDamping, maxDamping, dampingRatio);\n    duration = clamp(minDuration, maxDuration, duration / 1000);\n    if (dampingRatio < 1) {\n        envelope = (undampedFreq) => {\n            const exponentialDecay = undampedFreq * dampingRatio;\n            const delta = exponentialDecay * duration;\n            const a = exponentialDecay - velocity;\n            const b = calcAngularFreq(undampedFreq, dampingRatio);\n            const c = Math.exp(-delta);\n            return safeMin - (a / b) * c;\n        };\n        derivative = (undampedFreq) => {\n            const exponentialDecay = undampedFreq * dampingRatio;\n            const delta = exponentialDecay * duration;\n            const d = delta * velocity + velocity;\n            const e = Math.pow(dampingRatio, 2) * Math.pow(undampedFreq, 2) * duration;\n            const f = Math.exp(-delta);\n            const g = calcAngularFreq(Math.pow(undampedFreq, 2), dampingRatio);\n            const factor = -envelope(undampedFreq) + safeMin > 0 ? -1 : 1;\n            return (factor * ((d - e) * f)) / g;\n        };\n    }\n    else {\n        envelope = (undampedFreq) => {\n            const a = Math.exp(-undampedFreq * duration);\n            const b = (undampedFreq - velocity) * duration + 1;\n            return -safeMin + a * b;\n        };\n        derivative = (undampedFreq) => {\n            const a = Math.exp(-undampedFreq * duration);\n            const b = (velocity - undampedFreq) * (duration * duration);\n            return a * b;\n        };\n    }\n    const initialGuess = 5 / duration;\n    const undampedFreq = approximateRoot(envelope, derivative, initialGuess);\n    duration = duration * 1000;\n    if (isNaN(undampedFreq)) {\n        return {\n            stiffness: 100,\n            damping: 10,\n            duration,\n        };\n    }\n    else {\n        const stiffness = Math.pow(undampedFreq, 2) * mass;\n        return {\n            stiffness,\n            damping: dampingRatio * 2 * Math.sqrt(mass * stiffness),\n            duration,\n        };\n    }\n}\nconst rootIterations = 12;\nfunction approximateRoot(envelope, derivative, initialGuess) {\n    let result = initialGuess;\n    for (let i = 1; i < rootIterations; i++) {\n        result = result - envelope(result) / derivative(result);\n    }\n    return result;\n}\nfunction calcAngularFreq(undampedFreq, dampingRatio) {\n    return undampedFreq * Math.sqrt(1 - dampingRatio * dampingRatio);\n}\n\nexport { calcAngularFreq, findSpring, maxDamping, maxDuration, minDamping, minDuration };\n","import { __rest } from 'tslib';\nimport { findSpring, calcAngularFreq } from '../utils/find-spring.mjs';\n\nconst durationKeys = [\"duration\", \"bounce\"];\nconst physicsKeys = [\"stiffness\", \"damping\", \"mass\"];\nfunction isSpringType(options, keys) {\n    return keys.some((key) => options[key] !== undefined);\n}\nfunction getSpringOptions(options) {\n    let springOptions = Object.assign({ velocity: 0.0, stiffness: 100, damping: 10, mass: 1.0, isResolvedFromDuration: false }, options);\n    if (!isSpringType(options, physicsKeys) &&\n        isSpringType(options, durationKeys)) {\n        const derived = findSpring(options);\n        springOptions = Object.assign(Object.assign(Object.assign({}, springOptions), derived), { velocity: 0.0, mass: 1.0 });\n        springOptions.isResolvedFromDuration = true;\n    }\n    return springOptions;\n}\nfunction spring(_a) {\n    var { from = 0.0, to = 1.0, restSpeed = 2, restDelta } = _a, options = __rest(_a, [\"from\", \"to\", \"restSpeed\", \"restDelta\"]);\n    const state = { done: false, value: from };\n    let { stiffness, damping, mass, velocity, duration, isResolvedFromDuration, } = getSpringOptions(options);\n    let resolveSpring = zero;\n    let resolveVelocity = zero;\n    function createSpring() {\n        const initialVelocity = velocity ? -(velocity / 1000) : 0.0;\n        const initialDelta = to - from;\n        const dampingRatio = damping / (2 * Math.sqrt(stiffness * mass));\n        const undampedAngularFreq = Math.sqrt(stiffness / mass) / 1000;\n        if (restDelta === undefined) {\n            restDelta = Math.min(Math.abs(to - from) / 100, 0.4);\n        }\n        if (dampingRatio < 1) {\n            const angularFreq = calcAngularFreq(undampedAngularFreq, dampingRatio);\n            resolveSpring = (t) => {\n                const envelope = Math.exp(-dampingRatio * undampedAngularFreq * t);\n                return (to -\n                    envelope *\n                        (((initialVelocity +\n                            dampingRatio * undampedAngularFreq * initialDelta) /\n                            angularFreq) *\n                            Math.sin(angularFreq * t) +\n                            initialDelta * Math.cos(angularFreq * t)));\n            };\n            resolveVelocity = (t) => {\n                const envelope = Math.exp(-dampingRatio * undampedAngularFreq * t);\n                return (dampingRatio *\n                    undampedAngularFreq *\n                    envelope *\n                    ((Math.sin(angularFreq * t) *\n                        (initialVelocity +\n                            dampingRatio *\n                                undampedAngularFreq *\n                                initialDelta)) /\n                        angularFreq +\n                        initialDelta * Math.cos(angularFreq * t)) -\n                    envelope *\n                        (Math.cos(angularFreq * t) *\n                            (initialVelocity +\n                                dampingRatio *\n                                    undampedAngularFreq *\n                                    initialDelta) -\n                            angularFreq *\n                                initialDelta *\n                                Math.sin(angularFreq * t)));\n            };\n        }\n        else if (dampingRatio === 1) {\n            resolveSpring = (t) => to -\n                Math.exp(-undampedAngularFreq * t) *\n                    (initialDelta +\n                        (initialVelocity + undampedAngularFreq * initialDelta) *\n                            t);\n        }\n        else {\n            const dampedAngularFreq = undampedAngularFreq * Math.sqrt(dampingRatio * dampingRatio - 1);\n            resolveSpring = (t) => {\n                const envelope = Math.exp(-dampingRatio * undampedAngularFreq * t);\n                const freqForT = Math.min(dampedAngularFreq * t, 300);\n                return (to -\n                    (envelope *\n                        ((initialVelocity +\n                            dampingRatio * undampedAngularFreq * initialDelta) *\n                            Math.sinh(freqForT) +\n                            dampedAngularFreq *\n                                initialDelta *\n                                Math.cosh(freqForT))) /\n                        dampedAngularFreq);\n            };\n        }\n    }\n    createSpring();\n    return {\n        next: (t) => {\n            const current = resolveSpring(t);\n            if (!isResolvedFromDuration) {\n                const currentVelocity = resolveVelocity(t) * 1000;\n                const isBelowVelocityThreshold = Math.abs(currentVelocity) <= restSpeed;\n                const isBelowDisplacementThreshold = Math.abs(to - current) <= restDelta;\n                state.done =\n                    isBelowVelocityThreshold && isBelowDisplacementThreshold;\n            }\n            else {\n                state.done = t >= duration;\n            }\n            state.value = state.done ? to : current;\n            return state;\n        },\n        flipTarget: () => {\n            velocity = -velocity;\n            [from, to] = [to, from];\n            createSpring();\n        },\n    };\n}\nspring.needsInterpolation = (a, b) => typeof a === \"string\" || typeof b === \"string\";\nconst zero = (_t) => 0;\n\nexport { spring };\n","const progress = (from, to, value) => {\n    const toFromDifference = to - from;\n    return toFromDifference === 0 ? 1 : (value - from) / toFromDifference;\n};\n\nexport { progress };\n","const mix = (from, to, progress) => -progress * from + progress * to + from;\n\nexport { mix };\n","function hueToRgb(p, q, t) {\n    if (t < 0)\n        t += 1;\n    if (t > 1)\n        t -= 1;\n    if (t < 1 / 6)\n        return p + (q - p) * 6 * t;\n    if (t < 1 / 2)\n        return q;\n    if (t < 2 / 3)\n        return p + (q - p) * (2 / 3 - t) * 6;\n    return p;\n}\nfunction hslaToRgba({ hue, saturation, lightness, alpha }) {\n    hue /= 360;\n    saturation /= 100;\n    lightness /= 100;\n    let red = 0;\n    let green = 0;\n    let blue = 0;\n    if (!saturation) {\n        red = green = blue = lightness;\n    }\n    else {\n        const q = lightness < 0.5\n            ? lightness * (1 + saturation)\n            : lightness + saturation - lightness * saturation;\n        const p = 2 * lightness - q;\n        red = hueToRgb(p, q, hue + 1 / 3);\n        green = hueToRgb(p, q, hue);\n        blue = hueToRgb(p, q, hue - 1 / 3);\n    }\n    return {\n        red: Math.round(red * 255),\n        green: Math.round(green * 255),\n        blue: Math.round(blue * 255),\n        alpha,\n    };\n}\n\nexport { hslaToRgba };\n","import { mix } from './mix.mjs';\nimport { hsla, rgba, hex } from 'style-value-types';\nimport { invariant } from 'hey-listen';\nimport { hslaToRgba } from './hsla-to-rgba.mjs';\n\nconst mixLinearColor = (from, to, v) => {\n    const fromExpo = from * from;\n    const toExpo = to * to;\n    return Math.sqrt(Math.max(0, v * (toExpo - fromExpo) + fromExpo));\n};\nconst colorTypes = [hex, rgba, hsla];\nconst getColorType = (v) => colorTypes.find((type) => type.test(v));\nconst notAnimatable = (color) => `'${color}' is not an animatable color. Use the equivalent color code instead.`;\nconst mixColor = (from, to) => {\n    let fromColorType = getColorType(from);\n    let toColorType = getColorType(to);\n    invariant(!!fromColorType, notAnimatable(from));\n    invariant(!!toColorType, notAnimatable(to));\n    let fromColor = fromColorType.parse(from);\n    let toColor = toColorType.parse(to);\n    if (fromColorType === hsla) {\n        fromColor = hslaToRgba(fromColor);\n        fromColorType = rgba;\n    }\n    if (toColorType === hsla) {\n        toColor = hslaToRgba(toColor);\n        toColorType = rgba;\n    }\n    const blended = Object.assign({}, fromColor);\n    return (v) => {\n        for (const key in blended) {\n            if (key !== \"alpha\") {\n                blended[key] = mixLinearColor(fromColor[key], toColor[key], v);\n            }\n        }\n        blended.alpha = mix(fromColor.alpha, toColor.alpha, v);\n        return fromColorType.transform(blended);\n    };\n};\n\nexport { mixColor, mixLinearColor };\n","const zeroPoint = {\n    x: 0,\n    y: 0,\n    z: 0\n};\nconst isNum = (v) => typeof v === 'number';\n\nexport { isNum, zeroPoint };\n","const combineFunctions = (a, b) => (v) => b(a(v));\nconst pipe = (...transformers) => transformers.reduce(combineFunctions);\n\nexport { pipe };\n","import { complex, color } from 'style-value-types';\nimport { mix } from './mix.mjs';\nimport { mixColor } from './mix-color.mjs';\nimport { isNum } from './inc.mjs';\nimport { pipe } from './pipe.mjs';\nimport { warning } from 'hey-listen';\n\nfunction getMixer(origin, target) {\n    if (isNum(origin)) {\n        return (v) => mix(origin, target, v);\n    }\n    else if (color.test(origin)) {\n        return mixColor(origin, target);\n    }\n    else {\n        return mixComplex(origin, target);\n    }\n}\nconst mixArray = (from, to) => {\n    const output = [...from];\n    const numValues = output.length;\n    const blendValue = from.map((fromThis, i) => getMixer(fromThis, to[i]));\n    return (v) => {\n        for (let i = 0; i < numValues; i++) {\n            output[i] = blendValue[i](v);\n        }\n        return output;\n    };\n};\nconst mixObject = (origin, target) => {\n    const output = Object.assign(Object.assign({}, origin), target);\n    const blendValue = {};\n    for (const key in output) {\n        if (origin[key] !== undefined && target[key] !== undefined) {\n            blendValue[key] = getMixer(origin[key], target[key]);\n        }\n    }\n    return (v) => {\n        for (const key in blendValue) {\n            output[key] = blendValue[key](v);\n        }\n        return output;\n    };\n};\nfunction analyse(value) {\n    const parsed = complex.parse(value);\n    const numValues = parsed.length;\n    let numNumbers = 0;\n    let numRGB = 0;\n    let numHSL = 0;\n    for (let i = 0; i < numValues; i++) {\n        if (numNumbers || typeof parsed[i] === \"number\") {\n            numNumbers++;\n        }\n        else {\n            if (parsed[i].hue !== undefined) {\n                numHSL++;\n            }\n            else {\n                numRGB++;\n            }\n        }\n    }\n    return { parsed, numNumbers, numRGB, numHSL };\n}\nconst mixComplex = (origin, target) => {\n    const template = complex.createTransformer(target);\n    const originStats = analyse(origin);\n    const targetStats = analyse(target);\n    const canInterpolate = originStats.numHSL === targetStats.numHSL &&\n        originStats.numRGB === targetStats.numRGB &&\n        originStats.numNumbers >= targetStats.numNumbers;\n    if (canInterpolate) {\n        return pipe(mixArray(originStats.parsed, targetStats.parsed), template);\n    }\n    else {\n        warning(true, `Complex values '${origin}' and '${target}' too different to mix. Ensure all colors are of the same type, and that each contains the same quantity of number and color values. Falling back to instant transition.`);\n        return (p) => `${p > 0 ? target : origin}`;\n    }\n};\n\nexport { mixArray, mixComplex, mixObject };\n","import { progress } from './progress.mjs';\nimport { mix } from './mix.mjs';\nimport { mixColor } from './mix-color.mjs';\nimport { mixComplex, mixArray, mixObject } from './mix-complex.mjs';\nimport { color } from 'style-value-types';\nimport { clamp } from './clamp.mjs';\nimport { pipe } from './pipe.mjs';\nimport { invariant } from 'hey-listen';\n\nconst mixNumber = (from, to) => (p) => mix(from, to, p);\nfunction detectMixerFactory(v) {\n    if (typeof v === 'number') {\n        return mixNumber;\n    }\n    else if (typeof v === 'string') {\n        if (color.test(v)) {\n            return mixColor;\n        }\n        else {\n            return mixComplex;\n        }\n    }\n    else if (Array.isArray(v)) {\n        return mixArray;\n    }\n    else if (typeof v === 'object') {\n        return mixObject;\n    }\n}\nfunction createMixers(output, ease, customMixer) {\n    const mixers = [];\n    const mixerFactory = customMixer || detectMixerFactory(output[0]);\n    const numMixers = output.length - 1;\n    for (let i = 0; i < numMixers; i++) {\n        let mixer = mixerFactory(output[i], output[i + 1]);\n        if (ease) {\n            const easingFunction = Array.isArray(ease) ? ease[i] : ease;\n            mixer = pipe(easingFunction, mixer);\n        }\n        mixers.push(mixer);\n    }\n    return mixers;\n}\nfunction fastInterpolate([from, to], [mixer]) {\n    return (v) => mixer(progress(from, to, v));\n}\nfunction slowInterpolate(input, mixers) {\n    const inputLength = input.length;\n    const lastInputIndex = inputLength - 1;\n    return (v) => {\n        let mixerIndex = 0;\n        let foundMixerIndex = false;\n        if (v <= input[0]) {\n            foundMixerIndex = true;\n        }\n        else if (v >= input[lastInputIndex]) {\n            mixerIndex = lastInputIndex - 1;\n            foundMixerIndex = true;\n        }\n        if (!foundMixerIndex) {\n            let i = 1;\n            for (; i < inputLength; i++) {\n                if (input[i] > v || i === lastInputIndex) {\n                    break;\n                }\n            }\n            mixerIndex = i - 1;\n        }\n        const progressInRange = progress(input[mixerIndex], input[mixerIndex + 1], v);\n        return mixers[mixerIndex](progressInRange);\n    };\n}\nfunction interpolate(input, output, { clamp: isClamp = true, ease, mixer } = {}) {\n    const inputLength = input.length;\n    invariant(inputLength === output.length, 'Both input and output ranges must be the same length');\n    invariant(!ease || !Array.isArray(ease) || ease.length === inputLength - 1, 'Array of easing functions must be of length `input.length - 1`, as it applies to the transitions **between** the defined values.');\n    if (input[0] > input[inputLength - 1]) {\n        input = [].concat(input);\n        output = [].concat(output);\n        input.reverse();\n        output.reverse();\n    }\n    const mixers = createMixers(output, ease, mixer);\n    const interpolator = inputLength === 2\n        ? fastInterpolate(input, mixers)\n        : slowInterpolate(input, mixers);\n    return isClamp\n        ? (v) => interpolator(clamp(input[0], input[inputLength - 1], v))\n        : interpolator;\n}\n\nexport { interpolate };\n","const reverseEasing = easing => p => 1 - easing(1 - p);\nconst mirrorEasing = easing => p => p <= 0.5 ? easing(2 * p) / 2 : (2 - easing(2 * (1 - p))) / 2;\nconst createExpoIn = (power) => p => Math.pow(p, power);\nconst createBackIn = (power) => p => p * p * ((power + 1) * p - power);\nconst createAnticipate = (power) => {\n    const backEasing = createBackIn(power);\n    return p => (p *= 2) < 1\n        ? 0.5 * backEasing(p)\n        : 0.5 * (2 - Math.pow(2, -10 * (p - 1)));\n};\n\nexport { createAnticipate, createBackIn, createExpoIn, mirrorEasing, reverseEasing };\n","import { createExpoIn, reverseEasing, mirrorEasing, createBackIn, createAnticipate } from './utils.mjs';\n\nconst DEFAULT_OVERSHOOT_STRENGTH = 1.525;\nconst BOUNCE_FIRST_THRESHOLD = 4.0 / 11.0;\nconst BOUNCE_SECOND_THRESHOLD = 8.0 / 11.0;\nconst BOUNCE_THIRD_THRESHOLD = 9.0 / 10.0;\nconst linear = p => p;\nconst easeIn = createExpoIn(2);\nconst easeOut = reverseEasing(easeIn);\nconst easeInOut = mirrorEasing(easeIn);\nconst circIn = p => 1 - Math.sin(Math.acos(p));\nconst circOut = reverseEasing(circIn);\nconst circInOut = mirrorEasing(circOut);\nconst backIn = createBackIn(DEFAULT_OVERSHOOT_STRENGTH);\nconst backOut = reverseEasing(backIn);\nconst backInOut = mirrorEasing(backIn);\nconst anticipate = createAnticipate(DEFAULT_OVERSHOOT_STRENGTH);\nconst ca = 4356.0 / 361.0;\nconst cb = 35442.0 / 1805.0;\nconst cc = 16061.0 / 1805.0;\nconst bounceOut = (p) => {\n    if (p === 1 || p === 0)\n        return p;\n    const p2 = p * p;\n    return p < BOUNCE_FIRST_THRESHOLD\n        ? 7.5625 * p2\n        : p < BOUNCE_SECOND_THRESHOLD\n            ? 9.075 * p2 - 9.9 * p + 3.4\n            : p < BOUNCE_THIRD_THRESHOLD\n                ? ca * p2 - cb * p + cc\n                : 10.8 * p * p - 20.52 * p + 10.72;\n};\nconst bounceIn = reverseEasing(bounceOut);\nconst bounceInOut = (p) => p < 0.5\n    ? 0.5 * (1.0 - bounceOut(1.0 - p * 2.0))\n    : 0.5 * bounceOut(p * 2.0 - 1.0) + 0.5;\n\nexport { anticipate, backIn, backInOut, backOut, bounceIn, bounceInOut, bounceOut, circIn, circInOut, circOut, easeIn, easeInOut, easeOut, linear };\n","import { interpolate } from '../../utils/interpolate.mjs';\nimport { easeInOut } from '../../easing/index.mjs';\n\nfunction defaultEasing(values, easing) {\n    return values.map(() => easing || easeInOut).splice(0, values.length - 1);\n}\nfunction defaultOffset(values) {\n    const numValues = values.length;\n    return values.map((_value, i) => i !== 0 ? i / (numValues - 1) : 0);\n}\nfunction convertOffsetToTimes(offset, duration) {\n    return offset.map((o) => o * duration);\n}\nfunction keyframes({ from = 0, to = 1, ease, offset, duration = 300, }) {\n    const state = { done: false, value: from };\n    const values = Array.isArray(to) ? to : [from, to];\n    const times = convertOffsetToTimes(offset && offset.length === values.length\n        ? offset\n        : defaultOffset(values), duration);\n    function createInterpolator() {\n        return interpolate(times, values, {\n            ease: Array.isArray(ease) ? ease : defaultEasing(values, ease),\n        });\n    }\n    let interpolator = createInterpolator();\n    return {\n        next: (t) => {\n            state.value = interpolator(t);\n            state.done = t >= duration;\n            return state;\n        },\n        flipTarget: () => {\n            values.reverse();\n            interpolator = createInterpolator();\n        },\n    };\n}\n\nexport { convertOffsetToTimes, defaultEasing, defaultOffset, keyframes };\n","function decay({ velocity = 0, from = 0, power = 0.8, timeConstant = 350, restDelta = 0.5, modifyTarget, }) {\n    const state = { done: false, value: from };\n    let amplitude = power * velocity;\n    const ideal = from + amplitude;\n    const target = modifyTarget === undefined ? ideal : modifyTarget(ideal);\n    if (target !== ideal)\n        amplitude = target - from;\n    return {\n        next: (t) => {\n            const delta = -amplitude * Math.exp(-t / timeConstant);\n            state.done = !(delta > restDelta || delta < -restDelta);\n            state.value = state.done ? target : target + delta;\n            return state;\n        },\n        flipTarget: () => { },\n    };\n}\n\nexport { decay };\n","import { spring } from '../generators/spring.mjs';\nimport { keyframes } from '../generators/keyframes.mjs';\nimport { decay } from '../generators/decay.mjs';\n\nconst types = { keyframes, spring, decay };\nfunction detectAnimationFromOptions(config) {\n    if (Array.isArray(config.to)) {\n        return keyframes;\n    }\n    else if (types[config.type]) {\n        return types[config.type];\n    }\n    const keys = new Set(Object.keys(config));\n    if (keys.has(\"ease\") ||\n        (keys.has(\"duration\") && !keys.has(\"dampingRatio\"))) {\n        return keyframes;\n    }\n    else if (keys.has(\"dampingRatio\") ||\n        keys.has(\"stiffness\") ||\n        keys.has(\"mass\") ||\n        keys.has(\"damping\") ||\n        keys.has(\"restSpeed\") ||\n        keys.has(\"restDelta\")) {\n        return spring;\n    }\n    return keyframes;\n}\n\nexport { detectAnimationFromOptions };\n","const defaultTimestep = (1 / 60) * 1000;\nconst getCurrentTime = typeof performance !== \"undefined\"\n    ? () => performance.now()\n    : () => Date.now();\nconst onNextFrame = typeof window !== \"undefined\"\n    ? (callback) => window.requestAnimationFrame(callback)\n    : (callback) => setTimeout(() => callback(getCurrentTime()), defaultTimestep);\n\nexport { defaultTimestep, onNextFrame };\n","function createRenderStep(runNextFrame) {\n    let toRun = [];\n    let toRunNextFrame = [];\n    let numToRun = 0;\n    let isProcessing = false;\n    let flushNextFrame = false;\n    const toKeepAlive = new WeakSet();\n    const step = {\n        schedule: (callback, keepAlive = false, immediate = false) => {\n            const addToCurrentFrame = immediate && isProcessing;\n            const buffer = addToCurrentFrame ? toRun : toRunNextFrame;\n            if (keepAlive)\n                toKeepAlive.add(callback);\n            if (buffer.indexOf(callback) === -1) {\n                buffer.push(callback);\n                if (addToCurrentFrame && isProcessing)\n                    numToRun = toRun.length;\n            }\n            return callback;\n        },\n        cancel: (callback) => {\n            const index = toRunNextFrame.indexOf(callback);\n            if (index !== -1)\n                toRunNextFrame.splice(index, 1);\n            toKeepAlive.delete(callback);\n        },\n        process: (frameData) => {\n            if (isProcessing) {\n                flushNextFrame = true;\n                return;\n            }\n            isProcessing = true;\n            [toRun, toRunNextFrame] = [toRunNextFrame, toRun];\n            toRunNextFrame.length = 0;\n            numToRun = toRun.length;\n            if (numToRun) {\n                for (let i = 0; i < numToRun; i++) {\n                    const callback = toRun[i];\n                    callback(frameData);\n                    if (toKeepAlive.has(callback)) {\n                        step.schedule(callback);\n                        runNextFrame();\n                    }\n                }\n            }\n            isProcessing = false;\n            if (flushNextFrame) {\n                flushNextFrame = false;\n                step.process(frameData);\n            }\n        },\n    };\n    return step;\n}\n\nexport { createRenderStep };\n","import { onNextFrame, defaultTimestep } from './on-next-frame.mjs';\nimport { createRenderStep } from './create-render-step.mjs';\n\nconst maxElapsed = 40;\nlet useDefaultElapsed = true;\nlet runNextFrame = false;\nlet isProcessing = false;\nconst frame = {\n    delta: 0,\n    timestamp: 0,\n};\nconst stepsOrder = [\n    \"read\",\n    \"update\",\n    \"preRender\",\n    \"render\",\n    \"postRender\",\n];\nconst steps = stepsOrder.reduce((acc, key) => {\n    acc[key] = createRenderStep(() => (runNextFrame = true));\n    return acc;\n}, {});\nconst sync = stepsOrder.reduce((acc, key) => {\n    const step = steps[key];\n    acc[key] = (process, keepAlive = false, immediate = false) => {\n        if (!runNextFrame)\n            startLoop();\n        return step.schedule(process, keepAlive, immediate);\n    };\n    return acc;\n}, {});\nconst cancelSync = stepsOrder.reduce((acc, key) => {\n    acc[key] = steps[key].cancel;\n    return acc;\n}, {});\nconst flushSync = stepsOrder.reduce((acc, key) => {\n    acc[key] = () => steps[key].process(frame);\n    return acc;\n}, {});\nconst processStep = (stepId) => steps[stepId].process(frame);\nconst processFrame = (timestamp) => {\n    runNextFrame = false;\n    frame.delta = useDefaultElapsed\n        ? defaultTimestep\n        : Math.max(Math.min(timestamp - frame.timestamp, maxElapsed), 1);\n    frame.timestamp = timestamp;\n    isProcessing = true;\n    stepsOrder.forEach(processStep);\n    isProcessing = false;\n    if (runNextFrame) {\n        useDefaultElapsed = false;\n        onNextFrame(processFrame);\n    }\n};\nconst startLoop = () => {\n    runNextFrame = true;\n    useDefaultElapsed = true;\n    if (!isProcessing)\n        onNextFrame(processFrame);\n};\nconst getFrameData = () => frame;\n\nexport default sync;\nexport { cancelSync, flushSync, getFrameData };\n","function loopElapsed(elapsed, duration, delay = 0) {\n    return elapsed - duration - delay;\n}\nfunction reverseElapsed(elapsed, duration, delay = 0, isForwardPlayback = true) {\n    return isForwardPlayback\n        ? loopElapsed(duration + -elapsed, duration, delay)\n        : duration - (elapsed - duration) + delay;\n}\nfunction hasRepeatDelayElapsed(elapsed, duration, delay, isForwardPlayback) {\n    return isForwardPlayback ? elapsed >= duration + delay : elapsed <= -delay;\n}\n\nexport { hasRepeatDelayElapsed, loopElapsed, reverseElapsed };\n","import { __rest } from 'tslib';\nimport { detectAnimationFromOptions } from './utils/detect-animation-from-options.mjs';\nimport sync, { cancelSync } from 'framesync';\nimport { interpolate } from '../utils/interpolate.mjs';\nimport { hasRepeatDelayElapsed, reverseElapsed, loopElapsed } from './utils/elapsed.mjs';\n\nconst framesync = (update) => {\n    const passTimestamp = ({ delta }) => update(delta);\n    return {\n        start: () => sync.update(passTimestamp, true),\n        stop: () => cancelSync.update(passTimestamp),\n    };\n};\nfunction animate(_a) {\n    var _b, _c;\n    var { from, autoplay = true, driver = framesync, elapsed = 0, repeat: repeatMax = 0, repeatType = \"loop\", repeatDelay = 0, onPlay, onStop, onComplete, onRepeat, onUpdate } = _a, options = __rest(_a, [\"from\", \"autoplay\", \"driver\", \"elapsed\", \"repeat\", \"repeatType\", \"repeatDelay\", \"onPlay\", \"onStop\", \"onComplete\", \"onRepeat\", \"onUpdate\"]);\n    let { to } = options;\n    let driverControls;\n    let repeatCount = 0;\n    let computedDuration = options.duration;\n    let latest;\n    let isComplete = false;\n    let isForwardPlayback = true;\n    let interpolateFromNumber;\n    const animator = detectAnimationFromOptions(options);\n    if ((_c = (_b = animator).needsInterpolation) === null || _c === void 0 ? void 0 : _c.call(_b, from, to)) {\n        interpolateFromNumber = interpolate([0, 100], [from, to], {\n            clamp: false,\n        });\n        from = 0;\n        to = 100;\n    }\n    const animation = animator(Object.assign(Object.assign({}, options), { from, to }));\n    function repeat() {\n        repeatCount++;\n        if (repeatType === \"reverse\") {\n            isForwardPlayback = repeatCount % 2 === 0;\n            elapsed = reverseElapsed(elapsed, computedDuration, repeatDelay, isForwardPlayback);\n        }\n        else {\n            elapsed = loopElapsed(elapsed, computedDuration, repeatDelay);\n            if (repeatType === \"mirror\")\n                animation.flipTarget();\n        }\n        isComplete = false;\n        onRepeat && onRepeat();\n    }\n    function complete() {\n        driverControls.stop();\n        onComplete && onComplete();\n    }\n    function update(delta) {\n        if (!isForwardPlayback)\n            delta = -delta;\n        elapsed += delta;\n        if (!isComplete) {\n            const state = animation.next(Math.max(0, elapsed));\n            latest = state.value;\n            if (interpolateFromNumber)\n                latest = interpolateFromNumber(latest);\n            isComplete = isForwardPlayback ? state.done : elapsed <= 0;\n        }\n        onUpdate === null || onUpdate === void 0 ? void 0 : onUpdate(latest);\n        if (isComplete) {\n            if (repeatCount === 0)\n                computedDuration !== null && computedDuration !== void 0 ? computedDuration : (computedDuration = elapsed);\n            if (repeatCount < repeatMax) {\n                hasRepeatDelayElapsed(elapsed, computedDuration, repeatDelay, isForwardPlayback) && repeat();\n            }\n            else {\n                complete();\n            }\n        }\n    }\n    function play() {\n        onPlay === null || onPlay === void 0 ? void 0 : onPlay();\n        driverControls = driver(update);\n        driverControls.start();\n    }\n    autoplay && play();\n    return {\n        stop: () => {\n            onStop === null || onStop === void 0 ? void 0 : onStop();\n            driverControls.stop();\n        },\n    };\n}\n\nexport { animate };\n","function velocityPerSecond(velocity, frameDuration) {\n    return frameDuration ? velocity * (1000 / frameDuration) : 0;\n}\n\nexport { velocityPerSecond };\n","import { animate } from './index.mjs';\nimport { velocityPerSecond } from '../utils/velocity-per-second.mjs';\nimport { getFrameData } from 'framesync';\n\nfunction inertia({ from = 0, velocity = 0, min, max, power = 0.8, timeConstant = 750, bounceStiffness = 500, bounceDamping = 10, restDelta = 1, modifyTarget, driver, onUpdate, onComplete, onStop, }) {\n    let currentAnimation;\n    function isOutOfBounds(v) {\n        return (min !== undefined && v < min) || (max !== undefined && v > max);\n    }\n    function boundaryNearest(v) {\n        if (min === undefined)\n            return max;\n        if (max === undefined)\n            return min;\n        return Math.abs(min - v) < Math.abs(max - v) ? min : max;\n    }\n    function startAnimation(options) {\n        currentAnimation === null || currentAnimation === void 0 ? void 0 : currentAnimation.stop();\n        currentAnimation = animate(Object.assign(Object.assign({}, options), { driver, onUpdate: (v) => {\n                var _a;\n                onUpdate === null || onUpdate === void 0 ? void 0 : onUpdate(v);\n                (_a = options.onUpdate) === null || _a === void 0 ? void 0 : _a.call(options, v);\n            }, onComplete,\n            onStop }));\n    }\n    function startSpring(options) {\n        startAnimation(Object.assign({ type: \"spring\", stiffness: bounceStiffness, damping: bounceDamping, restDelta }, options));\n    }\n    if (isOutOfBounds(from)) {\n        startSpring({ from, velocity, to: boundaryNearest(from) });\n    }\n    else {\n        let target = power * velocity + from;\n        if (typeof modifyTarget !== \"undefined\")\n            target = modifyTarget(target);\n        const boundary = boundaryNearest(target);\n        const heading = boundary === min ? -1 : 1;\n        let prev;\n        let current;\n        const checkBoundary = (v) => {\n            prev = current;\n            current = v;\n            velocity = velocityPerSecond(v - prev, getFrameData().delta);\n            if ((heading === 1 && v > boundary) ||\n                (heading === -1 && v < boundary)) {\n                startSpring({ from: v, to: boundary, velocity });\n            }\n        };\n        startAnimation({\n            type: \"decay\",\n            from,\n            velocity,\n            timeConstant,\n            power,\n            restDelta,\n            modifyTarget,\n            onUpdate: isOutOfBounds(target) ? checkBoundary : undefined,\n        });\n    }\n    return {\n        stop: () => currentAnimation === null || currentAnimation === void 0 ? void 0 : currentAnimation.stop(),\n    };\n}\n\nexport { inertia };\n","import { linear } from './index.mjs';\n\nconst a = (a1, a2) => 1.0 - 3.0 * a2 + 3.0 * a1;\nconst b = (a1, a2) => 3.0 * a2 - 6.0 * a1;\nconst c = (a1) => 3.0 * a1;\nconst calcBezier = (t, a1, a2) => ((a(a1, a2) * t + b(a1, a2)) * t + c(a1)) * t;\nconst getSlope = (t, a1, a2) => 3.0 * a(a1, a2) * t * t + 2.0 * b(a1, a2) * t + c(a1);\nconst subdivisionPrecision = 0.0000001;\nconst subdivisionMaxIterations = 10;\nfunction binarySubdivide(aX, aA, aB, mX1, mX2) {\n    let currentX;\n    let currentT;\n    let i = 0;\n    do {\n        currentT = aA + (aB - aA) / 2.0;\n        currentX = calcBezier(currentT, mX1, mX2) - aX;\n        if (currentX > 0.0) {\n            aB = currentT;\n        }\n        else {\n            aA = currentT;\n        }\n    } while (Math.abs(currentX) > subdivisionPrecision &&\n        ++i < subdivisionMaxIterations);\n    return currentT;\n}\nconst newtonIterations = 8;\nconst newtonMinSlope = 0.001;\nfunction newtonRaphsonIterate(aX, aGuessT, mX1, mX2) {\n    for (let i = 0; i < newtonIterations; ++i) {\n        const currentSlope = getSlope(aGuessT, mX1, mX2);\n        if (currentSlope === 0.0) {\n            return aGuessT;\n        }\n        const currentX = calcBezier(aGuessT, mX1, mX2) - aX;\n        aGuessT -= currentX / currentSlope;\n    }\n    return aGuessT;\n}\nconst kSplineTableSize = 11;\nconst kSampleStepSize = 1.0 / (kSplineTableSize - 1.0);\nfunction cubicBezier(mX1, mY1, mX2, mY2) {\n    if (mX1 === mY1 && mX2 === mY2)\n        return linear;\n    const sampleValues = new Float32Array(kSplineTableSize);\n    for (let i = 0; i < kSplineTableSize; ++i) {\n        sampleValues[i] = calcBezier(i * kSampleStepSize, mX1, mX2);\n    }\n    function getTForX(aX) {\n        let intervalStart = 0.0;\n        let currentSample = 1;\n        const lastSample = kSplineTableSize - 1;\n        for (; currentSample !== lastSample && sampleValues[currentSample] <= aX; ++currentSample) {\n            intervalStart += kSampleStepSize;\n        }\n        --currentSample;\n        const dist = (aX - sampleValues[currentSample]) /\n            (sampleValues[currentSample + 1] - sampleValues[currentSample]);\n        const guessForT = intervalStart + dist * kSampleStepSize;\n        const initialSlope = getSlope(guessForT, mX1, mX2);\n        if (initialSlope >= newtonMinSlope) {\n            return newtonRaphsonIterate(aX, guessForT, mX1, mX2);\n        }\n        else if (initialSlope === 0.0) {\n            return guessForT;\n        }\n        else {\n            return binarySubdivide(aX, intervalStart, intervalStart + kSampleStepSize, mX1, mX2);\n        }\n    }\n    return (t) => t === 0 || t === 1 ? t : calcBezier(getTForX(t), mY1, mY2);\n}\n\nexport { cubicBezier };\n","import { useRef } from 'react';\nimport { isNodeOrChild } from './utils/is-node-or-child.mjs';\nimport { usePointerEvent, addPointerEvent } from '../events/use-pointer-event.mjs';\nimport { useUnmountEffect } from '../utils/use-unmount-effect.mjs';\nimport { pipe } from 'popmotion';\nimport { AnimationType } from '../render/utils/types.mjs';\nimport { isDragActive } from './drag/utils/lock.mjs';\n\n/**\n * @param handlers -\n * @internal\n */\nfunction useTapGesture({ onTap, onTapStart, onTapCancel, whileTap, visualElement, }) {\n    const hasPressListeners = onTap || onTapStart || onTapCancel || whileTap;\n    const isPressing = useRef(false);\n    const cancelPointerEndListeners = useRef(null);\n    /**\n     * Only set listener to passive if there are no external listeners.\n     */\n    const eventOptions = {\n        passive: !(onTapStart || onTap || onTapCancel || onPointerDown),\n    };\n    function removePointerEndListener() {\n        cancelPointerEndListeners.current && cancelPointerEndListeners.current();\n        cancelPointerEndListeners.current = null;\n    }\n    function checkPointerEnd() {\n        removePointerEndListener();\n        isPressing.current = false;\n        visualElement.animationState &&\n            visualElement.animationState.setActive(AnimationType.Tap, false);\n        return !isDragActive();\n    }\n    function onPointerUp(event, info) {\n        if (!checkPointerEnd())\n            return;\n        /**\n         * We only count this as a tap gesture if the event.target is the same\n         * as, or a child of, this component's element\n         */\n        !isNodeOrChild(visualElement.getInstance(), event.target)\n            ? onTapCancel && onTapCancel(event, info)\n            : onTap && onTap(event, info);\n    }\n    function onPointerCancel(event, info) {\n        if (!checkPointerEnd())\n            return;\n        onTapCancel && onTapCancel(event, info);\n    }\n    function onPointerDown(event, info) {\n        removePointerEndListener();\n        if (isPressing.current)\n            return;\n        isPressing.current = true;\n        cancelPointerEndListeners.current = pipe(addPointerEvent(window, \"pointerup\", onPointerUp, eventOptions), addPointerEvent(window, \"pointercancel\", onPointerCancel, eventOptions));\n        /**\n         * Ensure we trigger animations before firing event callback\n         */\n        visualElement.animationState &&\n            visualElement.animationState.setActive(AnimationType.Tap, true);\n        onTapStart && onTapStart(event, info);\n    }\n    usePointerEvent(visualElement, \"pointerdown\", hasPressListeners ? onPointerDown : undefined, eventOptions);\n    useUnmountEffect(removePointerEndListener);\n}\n\nexport { useTapGesture };\n","/**\n * Browser-safe usage of process\n */\nconst defaultEnvironment = \"production\";\nconst env = typeof process === \"undefined\" || process.env === undefined\n    ? defaultEnvironment\n    : process.env.NODE_ENV || defaultEnvironment;\n\nexport { env };\n","const warned = new Set();\nfunction warnOnce(condition, message, element) {\n    if (condition || warned.has(message))\n        return;\n    console.warn(message);\n    if (element)\n        console.warn(element);\n    warned.add(message);\n}\n\nexport { warnOnce };\n","/**\n * Map an IntersectionHandler callback to an element. We only ever make one handler for one\n * element, so even though these handlers might all be triggered by different\n * observers, we can keep them in the same map.\n */\nconst observerCallbacks = new WeakMap();\n/**\n * Multiple observers can be created for multiple element/document roots. Each with\n * different settings. So here we store dictionaries of observers to each root,\n * using serialised settings (threshold/margin) as lookup keys.\n */\nconst observers = new WeakMap();\nconst fireObserverCallback = (entry) => {\n    const callback = observerCallbacks.get(entry.target);\n    callback && callback(entry);\n};\nconst fireAllObserverCallbacks = (entries) => {\n    entries.forEach(fireObserverCallback);\n};\nfunction initIntersectionObserver({ root, ...options }) {\n    const lookupRoot = root || document;\n    /**\n     * If we don't have an observer lookup map for this root, create one.\n     */\n    if (!observers.has(lookupRoot)) {\n        observers.set(lookupRoot, {});\n    }\n    const rootObservers = observers.get(lookupRoot);\n    const key = JSON.stringify(options);\n    /**\n     * If we don't have an observer for this combination of root and settings,\n     * create one.\n     */\n    if (!rootObservers[key]) {\n        rootObservers[key] = new IntersectionObserver(fireAllObserverCallbacks, { root, ...options });\n    }\n    return rootObservers[key];\n}\nfunction observeIntersection(element, options, callback) {\n    const rootInteresectionObserver = initIntersectionObserver(options);\n    observerCallbacks.set(element, callback);\n    rootInteresectionObserver.observe(element);\n    return () => {\n        observerCallbacks.delete(element);\n        rootInteresectionObserver.unobserve(element);\n    };\n}\n\nexport { observeIntersection };\n","import { env } from '../../../utils/process.mjs';\nimport { useRef, useEffect } from 'react';\nimport { AnimationType } from '../../../render/utils/types.mjs';\nimport { warnOnce } from '../../../utils/warn-once.mjs';\nimport { observeIntersection } from './observers.mjs';\n\nfunction useViewport({ visualElement, whileInView, onViewportEnter, onViewportLeave, viewport = {}, }) {\n    const state = useRef({\n        hasEnteredView: false,\n        isInView: false,\n    });\n    let shouldObserve = Boolean(whileInView || onViewportEnter || onViewportLeave);\n    if (viewport.once && state.current.hasEnteredView)\n        shouldObserve = false;\n    const useObserver = typeof IntersectionObserver === \"undefined\"\n        ? useMissingIntersectionObserver\n        : useIntersectionObserver;\n    useObserver(shouldObserve, state.current, visualElement, viewport);\n}\nconst thresholdNames = {\n    some: 0,\n    all: 1,\n};\nfunction useIntersectionObserver(shouldObserve, state, visualElement, { root, margin: rootMargin, amount = \"some\", once }) {\n    useEffect(() => {\n        if (!shouldObserve)\n            return;\n        const options = {\n            root: root === null || root === void 0 ? void 0 : root.current,\n            rootMargin,\n            threshold: typeof amount === \"number\" ? amount : thresholdNames[amount],\n        };\n        const intersectionCallback = (entry) => {\n            const { isIntersecting } = entry;\n            /**\n             * If there's been no change in the viewport state, early return.\n             */\n            if (state.isInView === isIntersecting)\n                return;\n            state.isInView = isIntersecting;\n            /**\n             * Handle hasEnteredView. If this is only meant to run once, and\n             * element isn't visible, early return. Otherwise set hasEnteredView to true.\n             */\n            if (once && !isIntersecting && state.hasEnteredView) {\n                return;\n            }\n            else if (isIntersecting) {\n                state.hasEnteredView = true;\n            }\n            if (visualElement.animationState) {\n                visualElement.animationState.setActive(AnimationType.InView, isIntersecting);\n            }\n            /**\n             * Use the latest committed props rather than the ones in scope\n             * when this observer is created\n             */\n            const props = visualElement.getProps();\n            const callback = isIntersecting\n                ? props.onViewportEnter\n                : props.onViewportLeave;\n            callback && callback(entry);\n        };\n        return observeIntersection(visualElement.getInstance(), options, intersectionCallback);\n    }, [shouldObserve, root, rootMargin, amount]);\n}\n/**\n * If IntersectionObserver is missing, we activate inView and fire onViewportEnter\n * on mount. This way, the page will be in the state the author expects users\n * to see it in for everyone.\n */\nfunction useMissingIntersectionObserver(shouldObserve, state, visualElement, { fallback = true }) {\n    useEffect(() => {\n        if (!shouldObserve || !fallback)\n            return;\n        if (env !== \"production\") {\n            warnOnce(false, \"IntersectionObserver not available on this device. whileInView animations will trigger on mount.\");\n        }\n        /**\n         * Fire this in an rAF because, at this point, the animation state\n         * won't have flushed for the first time and there's certain logic in\n         * there that behaves differently on the initial animation.\n         *\n         * This hook should be quite rarely called so setting this in an rAF\n         * is preferred to changing the behaviour of the animation state.\n         */\n        requestAnimationFrame(() => {\n            state.hasEnteredView = true;\n            const { onViewportEnter } = visualElement.getProps();\n            onViewportEnter && onViewportEnter(null);\n            if (visualElement.animationState) {\n                visualElement.animationState.setActive(AnimationType.InView, true);\n            }\n        });\n    }, [shouldObserve]);\n}\n\nexport { useViewport };\n","const makeRenderlessComponent = (hook) => (props) => {\n    hook(props);\n    return null;\n};\n\nexport { makeRenderlessComponent };\n","import { useFocusGesture } from '../../gestures/use-focus-gesture.mjs';\nimport { useHoverGesture } from '../../gestures/use-hover-gesture.mjs';\nimport { useTapGesture } from '../../gestures/use-tap-gesture.mjs';\nimport { useViewport } from './viewport/use-viewport.mjs';\nimport { makeRenderlessComponent } from '../utils/make-renderless-component.mjs';\n\nconst gestureAnimations = {\n    inView: makeRenderlessComponent(useViewport),\n    tap: makeRenderlessComponent(useTapGesture),\n    focus: makeRenderlessComponent(useFocusGesture),\n    hover: makeRenderlessComponent(useHoverGesture),\n};\n\nexport { gestureAnimations };\n","import { useContext, useId, useEffect } from 'react';\nimport { PresenceContext } from '../../context/PresenceContext.mjs';\n\n/**\n * When a component is the child of `AnimatePresence`, it can use `usePresence`\n * to access information about whether it's still present in the React tree.\n *\n * ```jsx\n * import { usePresence } from \"framer-motion\"\n *\n * export const Component = () => {\n *   const [isPresent, safeToRemove] = usePresence()\n *\n *   useEffect(() => {\n *     !isPresent && setTimeout(safeToRemove, 1000)\n *   }, [isPresent])\n *\n *   return <div />\n * }\n * ```\n *\n * If `isPresent` is `false`, it means that a component has been removed the tree, but\n * `AnimatePresence` won't really remove it until `safeToRemove` has been called.\n *\n * @public\n */\nfunction usePresence() {\n    const context = useContext(PresenceContext);\n    if (context === null)\n        return [true, null];\n    const { isPresent, onExitComplete, register } = context;\n    // It's safe to call the following hooks conditionally (after an early return) because the context will always\n    // either be null or non-null for the lifespan of the component.\n    // Replace with useId when released in React\n    const id = useId();\n    useEffect(() => register(id), []);\n    const safeToRemove = () => onExitComplete && onExitComplete(id);\n    return !isPresent && onExitComplete ? [false, safeToRemove] : [true];\n}\n/**\n * Similar to `usePresence`, except `useIsPresent` simply returns whether or not the component is present.\n * There is no `safeToRemove` function.\n *\n * ```jsx\n * import { useIsPresent } from \"framer-motion\"\n *\n * export const Component = () => {\n *   const isPresent = useIsPresent()\n *\n *   useEffect(() => {\n *     !isPresent && console.log(\"I've been removed!\")\n *   }, [isPresent])\n *\n *   return <div />\n * }\n * ```\n *\n * @public\n */\nfunction useIsPresent() {\n    return isPresent(useContext(PresenceContext));\n}\nfunction isPresent(context) {\n    return context === null ? true : context.isPresent;\n}\n\nexport { isPresent, useIsPresent, usePresence };\n","function shallowCompare(next, prev) {\n    if (!Array.isArray(prev))\n        return false;\n    const prevLength = prev.length;\n    if (prevLength !== next.length)\n        return false;\n    for (let i = 0; i < prevLength; i++) {\n        if (prev[i] !== next[i])\n            return false;\n    }\n    return true;\n}\n\nexport { shallowCompare };\n","/**\n * Converts seconds to milliseconds\n *\n * @param seconds - Time in seconds.\n * @return milliseconds - Converted time in milliseconds.\n */\nconst secondsToMilliseconds = (seconds) => seconds * 1000;\n\nexport { secondsToMilliseconds };\n","import { invariant } from 'hey-listen';\nimport { cubicBezier, linear, easeIn, easeInOut, easeOut, circIn, circInOut, circOut, backIn, backInOut, backOut, anticipate, bounceIn, bounceInOut, bounceOut } from 'popmotion';\n\nconst easingLookup = {\n    linear,\n    easeIn,\n    easeInOut,\n    easeOut,\n    circIn,\n    circInOut,\n    circOut,\n    backIn,\n    backInOut,\n    backOut,\n    anticipate,\n    bounceIn,\n    bounceInOut,\n    bounceOut,\n};\nconst easingDefinitionToFunction = (definition) => {\n    if (Array.isArray(definition)) {\n        // If cubic bezier definition, create bezier curve\n        invariant(definition.length === 4, `Cubic bezier arrays must contain four numerical values.`);\n        const [x1, y1, x2, y2] = definition;\n        return cubicBezier(x1, y1, x2, y2);\n    }\n    else if (typeof definition === \"string\") {\n        // Else lookup from table\n        invariant(easingLookup[definition] !== undefined, `Invalid easing type '${definition}'`);\n        return easingLookup[definition];\n    }\n    return definition;\n};\nconst isEasingArray = (ease) => {\n    return Array.isArray(ease) && typeof ease[0] !== \"number\";\n};\n\nexport { easingDefinitionToFunction, isEasingArray };\n","import { complex } from 'style-value-types';\n\n/**\n * Check if a value is animatable. Examples:\n *\n * ✅: 100, \"100px\", \"#fff\"\n * ❌: \"block\", \"url(2.jpg)\"\n * @param value\n *\n * @internal\n */\nconst isAnimatable = (key, value) => {\n    // If the list of keys tat might be non-animatable grows, replace with Set\n    if (key === \"zIndex\")\n        return false;\n    // If it's a number or a keyframes array, we can animate it. We might at some point\n    // need to do a deep isAnimatable check of keyframes, or let Popmotion handle this,\n    // but for now lets leave it like this for performance reasons\n    if (typeof value === \"number\" || Array.isArray(value))\n        return true;\n    if (typeof value === \"string\" && // It's animatable if we have a string\n        complex.test(value) && // And it contains numbers and/or colors\n        !value.startsWith(\"url(\") // Unless it starts with \"url(\"\n    ) {\n        return true;\n    }\n    return false;\n};\n\nexport { isAnimatable };\n","import { isKeyframesTarget } from './is-keyframes-target.mjs';\n\nconst underDampedSpring = () => ({\n    type: \"spring\",\n    stiffness: 500,\n    damping: 25,\n    restSpeed: 10,\n});\nconst criticallyDampedSpring = (to) => ({\n    type: \"spring\",\n    stiffness: 550,\n    damping: to === 0 ? 2 * Math.sqrt(550) : 30,\n    restSpeed: 10,\n});\nconst linearTween = () => ({\n    type: \"keyframes\",\n    ease: \"linear\",\n    duration: 0.3,\n});\nconst keyframes = (values) => ({\n    type: \"keyframes\",\n    duration: 0.8,\n    values,\n});\nconst defaultTransitions = {\n    x: underDampedSpring,\n    y: underDampedSpring,\n    z: underDampedSpring,\n    rotate: underDampedSpring,\n    rotateX: underDampedSpring,\n    rotateY: underDampedSpring,\n    rotateZ: underDampedSpring,\n    scaleX: criticallyDampedSpring,\n    scaleY: criticallyDampedSpring,\n    scale: criticallyDampedSpring,\n    opacity: linearTween,\n    backgroundColor: linearTween,\n    color: linearTween,\n    default: criticallyDampedSpring,\n};\nconst getDefaultTransition = (valueKey, to) => {\n    let transitionFactory;\n    if (isKeyframesTarget(to)) {\n        transitionFactory = keyframes;\n    }\n    else {\n        transitionFactory =\n            defaultTransitions[valueKey] || defaultTransitions.default;\n    }\n    return { to, ...transitionFactory(to) };\n};\n\nexport { criticallyDampedSpring, getDefaultTransition, linearTween, underDampedSpring };\n","import { color, filter } from 'style-value-types';\nimport { numberValueTypes } from './number.mjs';\n\n/**\n * A map of default value types for common values\n */\nconst defaultValueTypes = {\n    ...numberValueTypes,\n    // Color props\n    color,\n    backgroundColor: color,\n    outlineColor: color,\n    fill: color,\n    stroke: color,\n    // Border props\n    borderColor: color,\n    borderTopColor: color,\n    borderRightColor: color,\n    borderBottomColor: color,\n    borderLeftColor: color,\n    filter,\n    WebkitFilter: filter,\n};\n/**\n * Gets the default ValueType for the provided value key\n */\nconst getDefaultValueType = (key) => defaultValueTypes[key];\n\nexport { defaultValueTypes, getDefaultValueType };\n","import { filter, complex } from 'style-value-types';\nimport { getDefaultValueType } from './defaults.mjs';\n\nfunction getAnimatableNone(key, value) {\n    var _a;\n    let defaultValueType = getDefaultValueType(key);\n    if (defaultValueType !== filter)\n        defaultValueType = complex;\n    // If value is not recognised as animatable, ie \"none\", create an animatable version origin based on the target\n    return (_a = defaultValueType.getAnimatableNone) === null || _a === void 0 ? void 0 : _a.call(defaultValueType, value);\n}\n\nexport { getAnimatableNone };\n","const instantAnimationState = {\n    current: false,\n};\n\nexport { instantAnimationState };\n","import { inertia, animate } from 'popmotion';\nimport { secondsToMilliseconds } from '../../utils/time-conversion.mjs';\nimport { isEasingArray, easingDefinitionToFunction } from './easing.mjs';\nimport { isAnimatable } from './is-animatable.mjs';\nimport { getDefaultTransition } from './default-transitions.mjs';\nimport { warning } from 'hey-listen';\nimport { getAnimatableNone } from '../../render/dom/value-types/animatable-none.mjs';\nimport { instantAnimationState } from '../../utils/use-instant-transition-state.mjs';\nimport { resolveFinalValueInKeyframes } from '../../utils/resolve-value.mjs';\n\n/**\n * Decide whether a transition is defined on a given Transition.\n * This filters out orchestration options and returns true\n * if any options are left.\n */\nfunction isTransitionDefined({ when, delay, delayChildren, staggerChildren, staggerDirection, repeat, repeatType, repeatDelay, from, ...transition }) {\n    return !!Object.keys(transition).length;\n}\nlet legacyRepeatWarning = false;\n/**\n * Convert Framer Motion's Transition type into Popmotion-compatible options.\n */\nfunction convertTransitionToAnimationOptions({ ease, times, yoyo, flip, loop, ...transition }) {\n    const options = { ...transition };\n    if (times)\n        options[\"offset\"] = times;\n    /**\n     * Convert any existing durations from seconds to milliseconds\n     */\n    if (transition.duration)\n        options[\"duration\"] = secondsToMilliseconds(transition.duration);\n    if (transition.repeatDelay)\n        options.repeatDelay = secondsToMilliseconds(transition.repeatDelay);\n    /**\n     * Map easing names to Popmotion's easing functions\n     */\n    if (ease) {\n        options[\"ease\"] = isEasingArray(ease)\n            ? ease.map(easingDefinitionToFunction)\n            : easingDefinitionToFunction(ease);\n    }\n    /**\n     * Support legacy transition API\n     */\n    if (transition.type === \"tween\")\n        options.type = \"keyframes\";\n    /**\n     * TODO: These options are officially removed from the API.\n     */\n    if (yoyo || loop || flip) {\n        warning(!legacyRepeatWarning, \"yoyo, loop and flip have been removed from the API. Replace with repeat and repeatType options.\");\n        legacyRepeatWarning = true;\n        if (yoyo) {\n            options.repeatType = \"reverse\";\n        }\n        else if (loop) {\n            options.repeatType = \"loop\";\n        }\n        else if (flip) {\n            options.repeatType = \"mirror\";\n        }\n        options.repeat = loop || yoyo || flip || transition.repeat;\n    }\n    /**\n     * TODO: Popmotion 9 has the ability to automatically detect whether to use\n     * a keyframes or spring animation, but does so by detecting velocity and other spring options.\n     * It'd be good to introduce a similar thing here.\n     */\n    if (transition.type !== \"spring\")\n        options.type = \"keyframes\";\n    return options;\n}\n/**\n * Get the delay for a value by checking Transition with decreasing specificity.\n */\nfunction getDelayFromTransition(transition, key) {\n    var _a, _b;\n    const valueTransition = getValueTransition(transition, key) || {};\n    return (_b = (_a = valueTransition.delay) !== null && _a !== void 0 ? _a : transition.delay) !== null && _b !== void 0 ? _b : 0;\n}\nfunction hydrateKeyframes(options) {\n    if (Array.isArray(options.to) && options.to[0] === null) {\n        options.to = [...options.to];\n        options.to[0] = options.from;\n    }\n    return options;\n}\nfunction getPopmotionAnimationOptions(transition, options, key) {\n    if (Array.isArray(options.to) && transition.duration === undefined) {\n        transition.duration = 0.8;\n    }\n    hydrateKeyframes(options);\n    /**\n     * Get a default transition if none is determined to be defined.\n     */\n    if (!isTransitionDefined(transition)) {\n        transition = {\n            ...transition,\n            ...getDefaultTransition(key, options.to),\n        };\n    }\n    return {\n        ...options,\n        ...convertTransitionToAnimationOptions(transition),\n    };\n}\n/**\n *\n */\nfunction getAnimation(key, value, target, transition, onComplete) {\n    const valueTransition = getValueTransition(transition, key) || {};\n    let origin = valueTransition.from !== undefined ? valueTransition.from : value.get();\n    const isTargetAnimatable = isAnimatable(key, target);\n    if (origin === \"none\" && isTargetAnimatable && typeof target === \"string\") {\n        /**\n         * If we're trying to animate from \"none\", try and get an animatable version\n         * of the target. This could be improved to work both ways.\n         */\n        origin = getAnimatableNone(key, target);\n    }\n    else if (isZero(origin) && typeof target === \"string\") {\n        origin = getZeroUnit(target);\n    }\n    else if (!Array.isArray(target) &&\n        isZero(target) &&\n        typeof origin === \"string\") {\n        target = getZeroUnit(origin);\n    }\n    const isOriginAnimatable = isAnimatable(key, origin);\n    warning(isOriginAnimatable === isTargetAnimatable, `You are trying to animate ${key} from \"${origin}\" to \"${target}\". ${origin} is not an animatable value - to enable this animation set ${origin} to a value animatable to ${target} via the \\`style\\` property.`);\n    function start() {\n        const options = {\n            from: origin,\n            to: target,\n            velocity: value.getVelocity(),\n            onComplete,\n            onUpdate: (v) => value.set(v),\n        };\n        return valueTransition.type === \"inertia\" ||\n            valueTransition.type === \"decay\"\n            ? inertia({ ...options, ...valueTransition })\n            : animate({\n                ...getPopmotionAnimationOptions(valueTransition, options, key),\n                onUpdate: (v) => {\n                    options.onUpdate(v);\n                    valueTransition.onUpdate && valueTransition.onUpdate(v);\n                },\n                onComplete: () => {\n                    options.onComplete();\n                    valueTransition.onComplete && valueTransition.onComplete();\n                },\n            });\n    }\n    function set() {\n        const finalTarget = resolveFinalValueInKeyframes(target);\n        value.set(finalTarget);\n        onComplete();\n        valueTransition.onUpdate && valueTransition.onUpdate(finalTarget);\n        valueTransition.onComplete && valueTransition.onComplete();\n        return { stop: () => { } };\n    }\n    return !isOriginAnimatable ||\n        !isTargetAnimatable ||\n        valueTransition.type === false\n        ? set\n        : start;\n}\nfunction isZero(value) {\n    return (value === 0 ||\n        (typeof value === \"string\" &&\n            parseFloat(value) === 0 &&\n            value.indexOf(\" \") === -1));\n}\nfunction getZeroUnit(potentialUnitType) {\n    return typeof potentialUnitType === \"number\"\n        ? 0\n        : getAnimatableNone(\"\", potentialUnitType);\n}\nfunction getValueTransition(transition, key) {\n    return transition[key] || transition[\"default\"] || transition;\n}\n/**\n * Start animation on a MotionValue. This function is an interface between\n * Framer Motion and Popmotion\n */\nfunction startAnimation(key, value, target, transition = {}) {\n    if (instantAnimationState.current) {\n        transition = { type: false };\n    }\n    return value.start((onComplete) => {\n        let delayTimer;\n        let controls;\n        const animation = getAnimation(key, value, target, transition, onComplete);\n        const delay = getDelayFromTransition(transition, key);\n        const start = () => (controls = animation());\n        if (delay) {\n            delayTimer = window.setTimeout(start, secondsToMilliseconds(delay));\n        }\n        else {\n            start();\n        }\n        return () => {\n            clearTimeout(delayTimer);\n            controls && controls.stop();\n        };\n    });\n}\n\nexport { convertTransitionToAnimationOptions, getDelayFromTransition, getPopmotionAnimationOptions, getValueTransition, getZeroUnit, hydrateKeyframes, isTransitionDefined, isZero, startAnimation };\n","/**\n * Check if value is a numerical string, ie a string that is purely a number eg \"100\" or \"-100.1\"\n */\nconst isNumericalString = (v) => /^\\-?\\d*\\.?\\d+$/.test(v);\n\nexport { isNumericalString };\n","/**\n * Check if the value is a zero value string like \"0px\" or \"0%\"\n */\nconst isZeroValueString = (v) => /^0[^.\\s]+$/.test(v);\n\nexport { isZeroValueString };\n","function addUniqueItem(arr, item) {\n    if (arr.indexOf(item) === -1)\n        arr.push(item);\n}\nfunction removeItem(arr, item) {\n    const index = arr.indexOf(item);\n    if (index > -1)\n        arr.splice(index, 1);\n}\n// Adapted from array-move\nfunction moveItem([...arr], fromIndex, toIndex) {\n    const startIndex = fromIndex < 0 ? arr.length + fromIndex : fromIndex;\n    if (startIndex >= 0 && startIndex < arr.length) {\n        const endIndex = toIndex < 0 ? arr.length + toIndex : toIndex;\n        const [item] = arr.splice(fromIndex, 1);\n        arr.splice(endIndex, 0, item);\n    }\n    return arr;\n}\n\nexport { addUniqueItem, moveItem, removeItem };\n","import { addUniqueItem, removeItem } from './array.mjs';\n\nclass SubscriptionManager {\n    constructor() {\n        this.subscriptions = [];\n    }\n    add(handler) {\n        addUniqueItem(this.subscriptions, handler);\n        return () => removeItem(this.subscriptions, handler);\n    }\n    notify(a, b, c) {\n        const numSubscriptions = this.subscriptions.length;\n        if (!numSubscriptions)\n            return;\n        if (numSubscriptions === 1) {\n            /**\n             * If there's only a single handler we can just call it without invoking a loop.\n             */\n            this.subscriptions[0](a, b, c);\n        }\n        else {\n            for (let i = 0; i < numSubscriptions; i++) {\n                /**\n                 * Check whether the handler exists before firing as it's possible\n                 * the subscriptions were modified during this loop running.\n                 */\n                const handler = this.subscriptions[i];\n                handler && handler(a, b, c);\n            }\n        }\n    }\n    getSize() {\n        return this.subscriptions.length;\n    }\n    clear() {\n        this.subscriptions.length = 0;\n    }\n}\n\nexport { SubscriptionManager };\n","import sync, { getFrameData } from 'framesync';\nimport { velocityPerSecond } from 'popmotion';\nimport { SubscriptionManager } from '../utils/subscription-manager.mjs';\n\nconst isFloat = (value) => {\n    return !isNaN(parseFloat(value));\n};\n/**\n * `MotionValue` is used to track the state and velocity of motion values.\n *\n * @public\n */\nclass MotionValue {\n    /**\n     * @param init - The initiating value\n     * @param config - Optional configuration options\n     *\n     * -  `transformer`: A function to transform incoming values with.\n     *\n     * @internal\n     */\n    constructor(init) {\n        /**\n         * This will be replaced by the build step with the latest version number.\n         * When MotionValues are provided to motion components, warn if versions are mixed.\n         */\n        this.version = \"7.5.1\";\n        /**\n         * Duration, in milliseconds, since last updating frame.\n         *\n         * @internal\n         */\n        this.timeDelta = 0;\n        /**\n         * Timestamp of the last time this `MotionValue` was updated.\n         *\n         * @internal\n         */\n        this.lastUpdated = 0;\n        /**\n         * Functions to notify when the `MotionValue` updates.\n         *\n         * @internal\n         */\n        this.updateSubscribers = new SubscriptionManager();\n        /**\n         * Functions to notify when the velocity updates.\n         *\n         * @internal\n         */\n        this.velocityUpdateSubscribers = new SubscriptionManager();\n        /**\n         * Functions to notify when the `MotionValue` updates and `render` is set to `true`.\n         *\n         * @internal\n         */\n        this.renderSubscribers = new SubscriptionManager();\n        /**\n         * Tracks whether this value can output a velocity. Currently this is only true\n         * if the value is numerical, but we might be able to widen the scope here and support\n         * other value types.\n         *\n         * @internal\n         */\n        this.canTrackVelocity = false;\n        this.updateAndNotify = (v, render = true) => {\n            this.prev = this.current;\n            this.current = v;\n            // Update timestamp\n            const { delta, timestamp } = getFrameData();\n            if (this.lastUpdated !== timestamp) {\n                this.timeDelta = delta;\n                this.lastUpdated = timestamp;\n                sync.postRender(this.scheduleVelocityCheck);\n            }\n            // Update update subscribers\n            if (this.prev !== this.current) {\n                this.updateSubscribers.notify(this.current);\n            }\n            // Update velocity subscribers\n            if (this.velocityUpdateSubscribers.getSize()) {\n                this.velocityUpdateSubscribers.notify(this.getVelocity());\n            }\n            // Update render subscribers\n            if (render) {\n                this.renderSubscribers.notify(this.current);\n            }\n        };\n        /**\n         * Schedule a velocity check for the next frame.\n         *\n         * This is an instanced and bound function to prevent generating a new\n         * function once per frame.\n         *\n         * @internal\n         */\n        this.scheduleVelocityCheck = () => sync.postRender(this.velocityCheck);\n        /**\n         * Updates `prev` with `current` if the value hasn't been updated this frame.\n         * This ensures velocity calculations return `0`.\n         *\n         * This is an instanced and bound function to prevent generating a new\n         * function once per frame.\n         *\n         * @internal\n         */\n        this.velocityCheck = ({ timestamp }) => {\n            if (timestamp !== this.lastUpdated) {\n                this.prev = this.current;\n                this.velocityUpdateSubscribers.notify(this.getVelocity());\n            }\n        };\n        this.hasAnimated = false;\n        this.prev = this.current = init;\n        this.canTrackVelocity = isFloat(this.current);\n    }\n    /**\n     * Adds a function that will be notified when the `MotionValue` is updated.\n     *\n     * It returns a function that, when called, will cancel the subscription.\n     *\n     * When calling `onChange` inside a React component, it should be wrapped with the\n     * `useEffect` hook. As it returns an unsubscribe function, this should be returned\n     * from the `useEffect` function to ensure you don't add duplicate subscribers..\n     *\n     * ```jsx\n     * export const MyComponent = () => {\n     *   const x = useMotionValue(0)\n     *   const y = useMotionValue(0)\n     *   const opacity = useMotionValue(1)\n     *\n     *   useEffect(() => {\n     *     function updateOpacity() {\n     *       const maxXY = Math.max(x.get(), y.get())\n     *       const newOpacity = transform(maxXY, [0, 100], [1, 0])\n     *       opacity.set(newOpacity)\n     *     }\n     *\n     *     const unsubscribeX = x.onChange(updateOpacity)\n     *     const unsubscribeY = y.onChange(updateOpacity)\n     *\n     *     return () => {\n     *       unsubscribeX()\n     *       unsubscribeY()\n     *     }\n     *   }, [])\n     *\n     *   return <motion.div style={{ x }} />\n     * }\n     * ```\n     *\n     * @privateRemarks\n     *\n     * We could look into a `useOnChange` hook if the above lifecycle management proves confusing.\n     *\n     * ```jsx\n     * useOnChange(x, () => {})\n     * ```\n     *\n     * @param subscriber - A function that receives the latest value.\n     * @returns A function that, when called, will cancel this subscription.\n     *\n     * @public\n     */\n    onChange(subscription) {\n        return this.updateSubscribers.add(subscription);\n    }\n    clearListeners() {\n        this.updateSubscribers.clear();\n    }\n    /**\n     * Adds a function that will be notified when the `MotionValue` requests a render.\n     *\n     * @param subscriber - A function that's provided the latest value.\n     * @returns A function that, when called, will cancel this subscription.\n     *\n     * @internal\n     */\n    onRenderRequest(subscription) {\n        // Render immediately\n        subscription(this.get());\n        return this.renderSubscribers.add(subscription);\n    }\n    /**\n     * Attaches a passive effect to the `MotionValue`.\n     *\n     * @internal\n     */\n    attach(passiveEffect) {\n        this.passiveEffect = passiveEffect;\n    }\n    /**\n     * Sets the state of the `MotionValue`.\n     *\n     * @remarks\n     *\n     * ```jsx\n     * const x = useMotionValue(0)\n     * x.set(10)\n     * ```\n     *\n     * @param latest - Latest value to set.\n     * @param render - Whether to notify render subscribers. Defaults to `true`\n     *\n     * @public\n     */\n    set(v, render = true) {\n        if (!render || !this.passiveEffect) {\n            this.updateAndNotify(v, render);\n        }\n        else {\n            this.passiveEffect(v, this.updateAndNotify);\n        }\n    }\n    /**\n     * Returns the latest state of `MotionValue`\n     *\n     * @returns - The latest state of `MotionValue`\n     *\n     * @public\n     */\n    get() {\n        return this.current;\n    }\n    /**\n     * @public\n     */\n    getPrevious() {\n        return this.prev;\n    }\n    /**\n     * Returns the latest velocity of `MotionValue`\n     *\n     * @returns - The latest velocity of `MotionValue`. Returns `0` if the state is non-numerical.\n     *\n     * @public\n     */\n    getVelocity() {\n        // This could be isFloat(this.prev) && isFloat(this.current), but that would be wasteful\n        return this.canTrackVelocity\n            ? // These casts could be avoided if parseFloat would be typed better\n                velocityPerSecond(parseFloat(this.current) -\n                    parseFloat(this.prev), this.timeDelta)\n            : 0;\n    }\n    /**\n     * Registers a new animation to control this `MotionValue`. Only one\n     * animation can drive a `MotionValue` at one time.\n     *\n     * ```jsx\n     * value.start()\n     * ```\n     *\n     * @param animation - A function that starts the provided animation\n     *\n     * @internal\n     */\n    start(animation) {\n        this.stop();\n        return new Promise((resolve) => {\n            this.hasAnimated = true;\n            this.stopAnimation = animation(resolve);\n        }).then(() => this.clearAnimation());\n    }\n    /**\n     * Stop the currently active animation.\n     *\n     * @public\n     */\n    stop() {\n        if (this.stopAnimation)\n            this.stopAnimation();\n        this.clearAnimation();\n    }\n    /**\n     * Returns `true` if this value is currently animating.\n     *\n     * @public\n     */\n    isAnimating() {\n        return !!this.stopAnimation;\n    }\n    clearAnimation() {\n        this.stopAnimation = null;\n    }\n    /**\n     * Destroy and clean up subscribers to this `MotionValue`.\n     *\n     * The `MotionValue` hooks like `useMotionValue` and `useTransform` automatically\n     * handle the lifecycle of the returned `MotionValue`, so this method is only necessary if you've manually\n     * created a `MotionValue` via the `motionValue` function.\n     *\n     * @public\n     */\n    destroy() {\n        this.updateSubscribers.clear();\n        this.renderSubscribers.clear();\n        this.stop();\n    }\n}\nfunction motionValue(init) {\n    return new MotionValue(init);\n}\n\nexport { MotionValue, motionValue };\n","/**\n * Tests a provided value against a ValueType\n */\nconst testValueType = (v) => (type) => type.test(v);\n\nexport { testValueType };\n","/**\n * ValueType for \"auto\"\n */\nconst auto = {\n    test: (v) => v === \"auto\",\n    parse: (v) => v,\n};\n\nexport { auto };\n","import { number, px, percent, degrees, vw, vh } from 'style-value-types';\nimport { testValueType } from './test.mjs';\nimport { auto } from './type-auto.mjs';\n\n/**\n * A list of value types commonly used for dimensions\n */\nconst dimensionValueTypes = [number, px, percent, degrees, vw, vh, auto];\n/**\n * Tests a dimensional value against the list of dimension ValueTypes\n */\nconst findDimensionValueType = (v) => dimensionValueTypes.find(testValueType(v));\n\nexport { dimensionValueTypes, findDimensionValueType };\n","import { color, complex } from 'style-value-types';\nimport { dimensionValueTypes } from './dimensions.mjs';\nimport { testValueType } from './test.mjs';\n\n/**\n * A list of all ValueTypes\n */\nconst valueTypes = [...dimensionValueTypes, color, complex];\n/**\n * Tests a value against the list of ValueTypes\n */\nconst findValueType = (v) => valueTypes.find(testValueType(v));\n\nexport { findValueType };\n","import { resolveVariantFromProps } from './resolve-variants.mjs';\n\n/**\n * Creates an object containing the latest state of every MotionValue on a VisualElement\n */\nfunction getCurrent(visualElement) {\n    const current = {};\n    visualElement.forEachValue((value, key) => (current[key] = value.get()));\n    return current;\n}\n/**\n * Creates an object containing the latest velocity of every MotionValue on a VisualElement\n */\nfunction getVelocity(visualElement) {\n    const velocity = {};\n    visualElement.forEachValue((value, key) => (velocity[key] = value.getVelocity()));\n    return velocity;\n}\nfunction resolveVariant(visualElement, definition, custom) {\n    const props = visualElement.getProps();\n    return resolveVariantFromProps(props, definition, custom !== undefined ? custom : props.custom, getCurrent(visualElement), getVelocity(visualElement));\n}\n\nexport { resolveVariant };\n","import { complex } from 'style-value-types';\nimport { isNumericalString } from '../../utils/is-numerical-string.mjs';\nimport { isZeroValueString } from '../../utils/is-zero-value-string.mjs';\nimport { resolveFinalValueInKeyframes } from '../../utils/resolve-value.mjs';\nimport { motionValue } from '../../value/index.mjs';\nimport { getAnimatableNone } from '../dom/value-types/animatable-none.mjs';\nimport { findValueType } from '../dom/value-types/find.mjs';\nimport { resolveVariant } from './resolve-dynamic-variants.mjs';\n\n/**\n * Set VisualElement's MotionValue, creating a new MotionValue for it if\n * it doesn't exist.\n */\nfunction setMotionValue(visualElement, key, value) {\n    if (visualElement.hasValue(key)) {\n        visualElement.getValue(key).set(value);\n    }\n    else {\n        visualElement.addValue(key, motionValue(value));\n    }\n}\nfunction setTarget(visualElement, definition) {\n    const resolved = resolveVariant(visualElement, definition);\n    let { transitionEnd = {}, transition = {}, ...target } = resolved ? visualElement.makeTargetAnimatable(resolved, false) : {};\n    target = { ...target, ...transitionEnd };\n    for (const key in target) {\n        const value = resolveFinalValueInKeyframes(target[key]);\n        setMotionValue(visualElement, key, value);\n    }\n}\nfunction setVariants(visualElement, variantLabels) {\n    const reversedLabels = [...variantLabels].reverse();\n    reversedLabels.forEach((key) => {\n        var _a;\n        const variant = visualElement.getVariant(key);\n        variant && setTarget(visualElement, variant);\n        (_a = visualElement.variantChildren) === null || _a === void 0 ? void 0 : _a.forEach((child) => {\n            setVariants(child, variantLabels);\n        });\n    });\n}\nfunction setValues(visualElement, definition) {\n    if (Array.isArray(definition)) {\n        return setVariants(visualElement, definition);\n    }\n    else if (typeof definition === \"string\") {\n        return setVariants(visualElement, [definition]);\n    }\n    else {\n        setTarget(visualElement, definition);\n    }\n}\nfunction checkTargetForNewValues(visualElement, target, origin) {\n    var _a, _b;\n    const newValueKeys = Object.keys(target).filter((key) => !visualElement.hasValue(key));\n    const numNewValues = newValueKeys.length;\n    if (!numNewValues)\n        return;\n    for (let i = 0; i < numNewValues; i++) {\n        const key = newValueKeys[i];\n        const targetValue = target[key];\n        let value = null;\n        /**\n         * If the target is a series of keyframes, we can use the first value\n         * in the array. If this first value is null, we'll still need to read from the DOM.\n         */\n        if (Array.isArray(targetValue)) {\n            value = targetValue[0];\n        }\n        /**\n         * If the target isn't keyframes, or the first keyframe was null, we need to\n         * first check if an origin value was explicitly defined in the transition as \"from\",\n         * if not read the value from the DOM. As an absolute fallback, take the defined target value.\n         */\n        if (value === null) {\n            value = (_b = (_a = origin[key]) !== null && _a !== void 0 ? _a : visualElement.readValue(key)) !== null && _b !== void 0 ? _b : target[key];\n        }\n        /**\n         * If value is still undefined or null, ignore it. Preferably this would throw,\n         * but this was causing issues in Framer.\n         */\n        if (value === undefined || value === null)\n            continue;\n        if (typeof value === \"string\" &&\n            (isNumericalString(value) || isZeroValueString(value))) {\n            // If this is a number read as a string, ie \"0\" or \"200\", convert it to a number\n            value = parseFloat(value);\n        }\n        else if (!findValueType(value) && complex.test(targetValue)) {\n            value = getAnimatableNone(key, targetValue);\n        }\n        visualElement.addValue(key, motionValue(value));\n        if (origin[key] === undefined) {\n            origin[key] = value;\n        }\n        visualElement.setBaseTarget(key, value);\n    }\n}\nfunction getOriginFromTransition(key, transition) {\n    if (!transition)\n        return;\n    const valueTransition = transition[key] || transition[\"default\"] || transition;\n    return valueTransition.from;\n}\nfunction getOrigin(target, transition, visualElement) {\n    var _a;\n    const origin = {};\n    for (const key in target) {\n        const transitionOrigin = getOriginFromTransition(key, transition);\n        origin[key] =\n            transitionOrigin !== undefined\n                ? transitionOrigin\n                : (_a = visualElement.getValue(key)) === null || _a === void 0 ? void 0 : _a.get();\n    }\n    return origin;\n}\n\nexport { checkTargetForNewValues, getOrigin, getOriginFromTransition, setTarget, setValues };\n","import { isMotionValue } from '../utils/is-motion-value.mjs';\n\nfunction isWillChangeMotionValue(value) {\n    return Boolean(isMotionValue(value) && value.add);\n}\n\nexport { isWillChangeMotionValue };\n","import { startAnimation } from '../../animation/utils/transitions.mjs';\nimport { setTarget } from './setters.mjs';\nimport { resolveVariant } from './resolve-dynamic-variants.mjs';\nimport { transformProps } from '../html/utils/transform.mjs';\nimport { isWillChangeMotionValue } from '../../value/use-will-change/is.mjs';\n\nfunction animateVisualElement(visualElement, definition, options = {}) {\n    visualElement.notifyAnimationStart(definition);\n    let animation;\n    if (Array.isArray(definition)) {\n        const animations = definition.map((variant) => animateVariant(visualElement, variant, options));\n        animation = Promise.all(animations);\n    }\n    else if (typeof definition === \"string\") {\n        animation = animateVariant(visualElement, definition, options);\n    }\n    else {\n        const resolvedDefinition = typeof definition === \"function\"\n            ? resolveVariant(visualElement, definition, options.custom)\n            : definition;\n        animation = animateTarget(visualElement, resolvedDefinition, options);\n    }\n    return animation.then(() => visualElement.notifyAnimationComplete(definition));\n}\nfunction animateVariant(visualElement, variant, options = {}) {\n    var _a;\n    const resolved = resolveVariant(visualElement, variant, options.custom);\n    let { transition = visualElement.getDefaultTransition() || {} } = resolved || {};\n    if (options.transitionOverride) {\n        transition = options.transitionOverride;\n    }\n    /**\n     * If we have a variant, create a callback that runs it as an animation.\n     * Otherwise, we resolve a Promise immediately for a composable no-op.\n     */\n    const getAnimation = resolved\n        ? () => animateTarget(visualElement, resolved, options)\n        : () => Promise.resolve();\n    /**\n     * If we have children, create a callback that runs all their animations.\n     * Otherwise, we resolve a Promise immediately for a composable no-op.\n     */\n    const getChildAnimations = ((_a = visualElement.variantChildren) === null || _a === void 0 ? void 0 : _a.size)\n        ? (forwardDelay = 0) => {\n            const { delayChildren = 0, staggerChildren, staggerDirection, } = transition;\n            return animateChildren(visualElement, variant, delayChildren + forwardDelay, staggerChildren, staggerDirection, options);\n        }\n        : () => Promise.resolve();\n    /**\n     * If the transition explicitly defines a \"when\" option, we need to resolve either\n     * this animation or all children animations before playing the other.\n     */\n    const { when } = transition;\n    if (when) {\n        const [first, last] = when === \"beforeChildren\"\n            ? [getAnimation, getChildAnimations]\n            : [getChildAnimations, getAnimation];\n        return first().then(last);\n    }\n    else {\n        return Promise.all([getAnimation(), getChildAnimations(options.delay)]);\n    }\n}\n/**\n * @internal\n */\nfunction animateTarget(visualElement, definition, { delay = 0, transitionOverride, type } = {}) {\n    var _a;\n    let { transition = visualElement.getDefaultTransition(), transitionEnd, ...target } = visualElement.makeTargetAnimatable(definition);\n    const willChange = visualElement.getValue(\"willChange\");\n    if (transitionOverride)\n        transition = transitionOverride;\n    const animations = [];\n    const animationTypeState = type && ((_a = visualElement.animationState) === null || _a === void 0 ? void 0 : _a.getState()[type]);\n    for (const key in target) {\n        const value = visualElement.getValue(key);\n        const valueTarget = target[key];\n        if (!value ||\n            valueTarget === undefined ||\n            (animationTypeState &&\n                shouldBlockAnimation(animationTypeState, key))) {\n            continue;\n        }\n        let valueTransition = { delay, ...transition };\n        /**\n         * Make animation instant if this is a transform prop and we should reduce motion.\n         */\n        if (visualElement.shouldReduceMotion && transformProps.has(key)) {\n            valueTransition = {\n                ...valueTransition,\n                type: false,\n                delay: 0,\n            };\n        }\n        let animation = startAnimation(key, value, valueTarget, valueTransition);\n        if (isWillChangeMotionValue(willChange)) {\n            willChange.add(key);\n            animation = animation.then(() => willChange.remove(key));\n        }\n        animations.push(animation);\n    }\n    return Promise.all(animations).then(() => {\n        transitionEnd && setTarget(visualElement, transitionEnd);\n    });\n}\nfunction animateChildren(visualElement, variant, delayChildren = 0, staggerChildren = 0, staggerDirection = 1, options) {\n    const animations = [];\n    const maxStaggerDuration = (visualElement.variantChildren.size - 1) * staggerChildren;\n    const generateStaggerDuration = staggerDirection === 1\n        ? (i = 0) => i * staggerChildren\n        : (i = 0) => maxStaggerDuration - i * staggerChildren;\n    Array.from(visualElement.variantChildren)\n        .sort(sortByTreeOrder)\n        .forEach((child, i) => {\n        animations.push(animateVariant(child, variant, {\n            ...options,\n            delay: delayChildren + generateStaggerDuration(i),\n        }).then(() => child.notifyAnimationComplete(variant)));\n    });\n    return Promise.all(animations);\n}\nfunction stopAnimation(visualElement) {\n    visualElement.forEachValue((value) => value.stop());\n}\nfunction sortByTreeOrder(a, b) {\n    return a.sortNodePosition(b);\n}\n/**\n * Decide whether we should block this animation. Previously, we achieved this\n * just by checking whether the key was listed in protectedKeys, but this\n * posed problems if an animation was triggered by afterChildren and protectedKeys\n * had been set to true in the meantime.\n */\nfunction shouldBlockAnimation({ protectedKeys, needsAnimating }, key) {\n    const shouldBlock = protectedKeys.hasOwnProperty(key) && needsAnimating[key] !== true;\n    needsAnimating[key] = false;\n    return shouldBlock;\n}\n\nexport { animateVisualElement, sortByTreeOrder, stopAnimation };\n","import { isAnimationControls } from '../../animation/utils/is-animation-controls.mjs';\nimport { isKeyframesTarget } from '../../animation/utils/is-keyframes-target.mjs';\nimport { shallowCompare } from '../../utils/shallow-compare.mjs';\nimport { animateVisualElement } from './animation.mjs';\nimport { isVariantLabel } from './is-variant-label.mjs';\nimport { AnimationType } from './types.mjs';\nimport { resolveVariant } from './resolve-dynamic-variants.mjs';\n\nconst variantPriorityOrder = [\n    AnimationType.Animate,\n    AnimationType.InView,\n    AnimationType.Focus,\n    AnimationType.Hover,\n    AnimationType.Tap,\n    AnimationType.Drag,\n    AnimationType.Exit,\n];\nconst reversePriorityOrder = [...variantPriorityOrder].reverse();\nconst numAnimationTypes = variantPriorityOrder.length;\nfunction animateList(visualElement) {\n    return (animations) => Promise.all(animations.map(({ animation, options }) => animateVisualElement(visualElement, animation, options)));\n}\nfunction createAnimationState(visualElement) {\n    let animate = animateList(visualElement);\n    const state = createState();\n    let isInitialRender = true;\n    /**\n     * This function will be used to reduce the animation definitions for\n     * each active animation type into an object of resolved values for it.\n     */\n    const buildResolvedTypeValues = (acc, definition) => {\n        const resolved = resolveVariant(visualElement, definition);\n        if (resolved) {\n            const { transition, transitionEnd, ...target } = resolved;\n            acc = { ...acc, ...target, ...transitionEnd };\n        }\n        return acc;\n    };\n    /**\n     * This just allows us to inject mocked animation functions\n     * @internal\n     */\n    function setAnimateFunction(makeAnimator) {\n        animate = makeAnimator(visualElement);\n    }\n    /**\n     * When we receive new props, we need to:\n     * 1. Create a list of protected keys for each type. This is a directory of\n     *    value keys that are currently being \"handled\" by types of a higher priority\n     *    so that whenever an animation is played of a given type, these values are\n     *    protected from being animated.\n     * 2. Determine if an animation type needs animating.\n     * 3. Determine if any values have been removed from a type and figure out\n     *    what to animate those to.\n     */\n    function animateChanges(options, changedActiveType) {\n        var _a;\n        const props = visualElement.getProps();\n        const context = visualElement.getVariantContext(true) || {};\n        /**\n         * A list of animations that we'll build into as we iterate through the animation\n         * types. This will get executed at the end of the function.\n         */\n        const animations = [];\n        /**\n         * Keep track of which values have been removed. Then, as we hit lower priority\n         * animation types, we can check if they contain removed values and animate to that.\n         */\n        const removedKeys = new Set();\n        /**\n         * A dictionary of all encountered keys. This is an object to let us build into and\n         * copy it without iteration. Each time we hit an animation type we set its protected\n         * keys - the keys its not allowed to animate - to the latest version of this object.\n         */\n        let encounteredKeys = {};\n        /**\n         * If a variant has been removed at a given index, and this component is controlling\n         * variant animations, we want to ensure lower-priority variants are forced to animate.\n         */\n        let removedVariantIndex = Infinity;\n        /**\n         * Iterate through all animation types in reverse priority order. For each, we want to\n         * detect which values it's handling and whether or not they've changed (and therefore\n         * need to be animated). If any values have been removed, we want to detect those in\n         * lower priority props and flag for animation.\n         */\n        for (let i = 0; i < numAnimationTypes; i++) {\n            const type = reversePriorityOrder[i];\n            const typeState = state[type];\n            const prop = (_a = props[type]) !== null && _a !== void 0 ? _a : context[type];\n            const propIsVariant = isVariantLabel(prop);\n            /**\n             * If this type has *just* changed isActive status, set activeDelta\n             * to that status. Otherwise set to null.\n             */\n            const activeDelta = type === changedActiveType ? typeState.isActive : null;\n            if (activeDelta === false)\n                removedVariantIndex = i;\n            /**\n             * If this prop is an inherited variant, rather than been set directly on the\n             * component itself, we want to make sure we allow the parent to trigger animations.\n             *\n             * TODO: Can probably change this to a !isControllingVariants check\n             */\n            let isInherited = prop === context[type] && prop !== props[type] && propIsVariant;\n            /**\n             *\n             */\n            if (isInherited &&\n                isInitialRender &&\n                visualElement.manuallyAnimateOnMount) {\n                isInherited = false;\n            }\n            /**\n             * Set all encountered keys so far as the protected keys for this type. This will\n             * be any key that has been animated or otherwise handled by active, higher-priortiy types.\n             */\n            typeState.protectedKeys = { ...encounteredKeys };\n            // Check if we can skip analysing this prop early\n            if (\n            // If it isn't active and hasn't *just* been set as inactive\n            (!typeState.isActive && activeDelta === null) ||\n                // If we didn't and don't have any defined prop for this animation type\n                (!prop && !typeState.prevProp) ||\n                // Or if the prop doesn't define an animation\n                isAnimationControls(prop) ||\n                typeof prop === \"boolean\") {\n                continue;\n            }\n            /**\n             * As we go look through the values defined on this type, if we detect\n             * a changed value or a value that was removed in a higher priority, we set\n             * this to true and add this prop to the animation list.\n             */\n            const variantDidChange = checkVariantsDidChange(typeState.prevProp, prop);\n            let shouldAnimateType = variantDidChange ||\n                // If we're making this variant active, we want to always make it active\n                (type === changedActiveType &&\n                    typeState.isActive &&\n                    !isInherited &&\n                    propIsVariant) ||\n                // If we removed a higher-priority variant (i is in reverse order)\n                (i > removedVariantIndex && propIsVariant);\n            /**\n             * As animations can be set as variant lists, variants or target objects, we\n             * coerce everything to an array if it isn't one already\n             */\n            const definitionList = Array.isArray(prop) ? prop : [prop];\n            /**\n             * Build an object of all the resolved values. We'll use this in the subsequent\n             * animateChanges calls to determine whether a value has changed.\n             */\n            let resolvedValues = definitionList.reduce(buildResolvedTypeValues, {});\n            if (activeDelta === false)\n                resolvedValues = {};\n            /**\n             * Now we need to loop through all the keys in the prev prop and this prop,\n             * and decide:\n             * 1. If the value has changed, and needs animating\n             * 2. If it has been removed, and needs adding to the removedKeys set\n             * 3. If it has been removed in a higher priority type and needs animating\n             * 4. If it hasn't been removed in a higher priority but hasn't changed, and\n             *    needs adding to the type's protectedKeys list.\n             */\n            const { prevResolvedValues = {} } = typeState;\n            const allKeys = {\n                ...prevResolvedValues,\n                ...resolvedValues,\n            };\n            const markToAnimate = (key) => {\n                shouldAnimateType = true;\n                removedKeys.delete(key);\n                typeState.needsAnimating[key] = true;\n            };\n            for (const key in allKeys) {\n                const next = resolvedValues[key];\n                const prev = prevResolvedValues[key];\n                // If we've already handled this we can just skip ahead\n                if (encounteredKeys.hasOwnProperty(key))\n                    continue;\n                /**\n                 * If the value has changed, we probably want to animate it.\n                 */\n                if (next !== prev) {\n                    /**\n                     * If both values are keyframes, we need to shallow compare them to\n                     * detect whether any value has changed. If it has, we animate it.\n                     */\n                    if (isKeyframesTarget(next) && isKeyframesTarget(prev)) {\n                        if (!shallowCompare(next, prev) || variantDidChange) {\n                            markToAnimate(key);\n                        }\n                        else {\n                            /**\n                             * If it hasn't changed, we want to ensure it doesn't animate by\n                             * adding it to the list of protected keys.\n                             */\n                            typeState.protectedKeys[key] = true;\n                        }\n                    }\n                    else if (next !== undefined) {\n                        // If next is defined and doesn't equal prev, it needs animating\n                        markToAnimate(key);\n                    }\n                    else {\n                        // If it's undefined, it's been removed.\n                        removedKeys.add(key);\n                    }\n                }\n                else if (next !== undefined && removedKeys.has(key)) {\n                    /**\n                     * If next hasn't changed and it isn't undefined, we want to check if it's\n                     * been removed by a higher priority\n                     */\n                    markToAnimate(key);\n                }\n                else {\n                    /**\n                     * If it hasn't changed, we add it to the list of protected values\n                     * to ensure it doesn't get animated.\n                     */\n                    typeState.protectedKeys[key] = true;\n                }\n            }\n            /**\n             * Update the typeState so next time animateChanges is called we can compare the\n             * latest prop and resolvedValues to these.\n             */\n            typeState.prevProp = prop;\n            typeState.prevResolvedValues = resolvedValues;\n            /**\n             *\n             */\n            if (typeState.isActive) {\n                encounteredKeys = { ...encounteredKeys, ...resolvedValues };\n            }\n            if (isInitialRender && visualElement.blockInitialAnimation) {\n                shouldAnimateType = false;\n            }\n            /**\n             * If this is an inherited prop we want to hard-block animations\n             * TODO: Test as this should probably still handle animations triggered\n             * by removed values?\n             */\n            if (shouldAnimateType && !isInherited) {\n                animations.push(...definitionList.map((animation) => ({\n                    animation: animation,\n                    options: { type, ...options },\n                })));\n            }\n        }\n        /**\n         * If there are some removed value that haven't been dealt with,\n         * we need to create a new animation that falls back either to the value\n         * defined in the style prop, or the last read value.\n         */\n        if (removedKeys.size) {\n            const fallbackAnimation = {};\n            removedKeys.forEach((key) => {\n                const fallbackTarget = visualElement.getBaseTarget(key);\n                if (fallbackTarget !== undefined) {\n                    fallbackAnimation[key] = fallbackTarget;\n                }\n            });\n            animations.push({ animation: fallbackAnimation });\n        }\n        let shouldAnimate = Boolean(animations.length);\n        if (isInitialRender &&\n            props.initial === false &&\n            !visualElement.manuallyAnimateOnMount) {\n            shouldAnimate = false;\n        }\n        isInitialRender = false;\n        return shouldAnimate ? animate(animations) : Promise.resolve();\n    }\n    /**\n     * Change whether a certain animation type is active.\n     */\n    function setActive(type, isActive, options) {\n        var _a;\n        // If the active state hasn't changed, we can safely do nothing here\n        if (state[type].isActive === isActive)\n            return Promise.resolve();\n        // Propagate active change to children\n        (_a = visualElement.variantChildren) === null || _a === void 0 ? void 0 : _a.forEach((child) => { var _a; return (_a = child.animationState) === null || _a === void 0 ? void 0 : _a.setActive(type, isActive); });\n        state[type].isActive = isActive;\n        const animations = animateChanges(options, type);\n        for (const key in state) {\n            state[key].protectedKeys = {};\n        }\n        return animations;\n    }\n    return {\n        animateChanges,\n        setActive,\n        setAnimateFunction,\n        getState: () => state,\n    };\n}\nfunction checkVariantsDidChange(prev, next) {\n    if (typeof next === \"string\") {\n        return next !== prev;\n    }\n    else if (Array.isArray(next)) {\n        return !shallowCompare(next, prev);\n    }\n    return false;\n}\nfunction createTypeState(isActive = false) {\n    return {\n        isActive,\n        protectedKeys: {},\n        needsAnimating: {},\n        prevResolvedValues: {},\n    };\n}\nfunction createState() {\n    return {\n        [AnimationType.Animate]: createTypeState(true),\n        [AnimationType.InView]: createTypeState(),\n        [AnimationType.Hover]: createTypeState(),\n        [AnimationType.Tap]: createTypeState(),\n        [AnimationType.Drag]: createTypeState(),\n        [AnimationType.Focus]: createTypeState(),\n        [AnimationType.Exit]: createTypeState(),\n    };\n}\n\nexport { checkVariantsDidChange, createAnimationState, variantPriorityOrder };\n","import { useEffect, useContext } from 'react';\nimport { isAnimationControls } from '../../animation/utils/is-animation-controls.mjs';\nimport { usePresence } from '../../components/AnimatePresence/use-presence.mjs';\nimport { PresenceContext } from '../../context/PresenceContext.mjs';\nimport { createAnimationState } from '../../render/utils/animation-state.mjs';\nimport { AnimationType } from '../../render/utils/types.mjs';\nimport { makeRenderlessComponent } from '../utils/make-renderless-component.mjs';\n\nconst animations = {\n    animation: makeRenderlessComponent(({ visualElement, animate }) => {\n        /**\n         * We dynamically generate the AnimationState manager as it contains a reference\n         * to the underlying animation library. We only want to load that if we load this,\n         * so people can optionally code split it out using the `m` component.\n         */\n        visualElement.animationState || (visualElement.animationState = createAnimationState(visualElement));\n        /**\n         * Subscribe any provided AnimationControls to the component's VisualElement\n         */\n        if (isAnimationControls(animate)) {\n            useEffect(() => animate.subscribe(visualElement), [animate]);\n        }\n    }),\n    exit: makeRenderlessComponent((props) => {\n        const { custom, visualElement } = props;\n        const [isPresent, safeToRemove] = usePresence();\n        const presenceContext = useContext(PresenceContext);\n        useEffect(() => {\n            visualElement.isPresent = isPresent;\n            const animation = visualElement.animationState &&\n                visualElement.animationState.setActive(AnimationType.Exit, !isPresent, {\n                    custom: (presenceContext && presenceContext.custom) ||\n                        custom,\n                });\n            if (animation && !isPresent) {\n                animation.then(safeToRemove);\n            }\n        }, [isPresent]);\n    }),\n};\n\nexport { animations };\n","/**\n * Bounding boxes tend to be defined as top, left, right, bottom. For various operations\n * it's easier to consider each axis individually. This function returns a bounding box\n * as a map of single-axis min/max values.\n */\nfunction convertBoundingBoxToBox({ top, left, right, bottom, }) {\n    return {\n        x: { min: left, max: right },\n        y: { min: top, max: bottom },\n    };\n}\nfunction convertBoxToBoundingBox({ x, y }) {\n    return { top: y.min, right: x.max, bottom: y.max, left: x.min };\n}\n/**\n * Applies a TransformPoint function to a bounding box. TransformPoint is usually a function\n * provided by Framer to allow measured points to be corrected for device scaling. This is used\n * when measuring DOM elements and DOM event points.\n */\nfunction transformBoxPoints(point, transformPoint) {\n    if (!transformPoint)\n        return point;\n    const topLeft = transformPoint({ x: point.left, y: point.top });\n    const bottomRight = transformPoint({ x: point.right, y: point.bottom });\n    return {\n        top: topLeft.y,\n        left: topLeft.x,\n        bottom: bottomRight.y,\n        right: bottomRight.x,\n    };\n}\n\nexport { convertBoundingBoxToBox, convertBoxToBoundingBox, transformBoxPoints };\n","import { convertBoundingBoxToBox, transformBoxPoints } from '../geometry/conversion.mjs';\nimport { translateAxis } from '../geometry/delta-apply.mjs';\n\nfunction measureViewportBox(instance, transformPoint) {\n    return convertBoundingBoxToBox(transformBoxPoints(instance.getBoundingClientRect(), transformPoint));\n}\nfunction measurePageBox(element, rootProjectionNode, transformPagePoint) {\n    const viewportBox = measureViewportBox(element, transformPagePoint);\n    const { scroll } = rootProjectionNode;\n    if (scroll) {\n        translateAxis(viewportBox.x, scroll.x);\n        translateAxis(viewportBox.y, scroll.y);\n    }\n    return viewportBox;\n}\n\nexport { measurePageBox, measureViewportBox };\n","// Does this device prefer reduced motion? Returns `null` server-side.\nconst prefersReducedMotion = { current: null };\nconst hasReducedMotionListener = { current: false };\n\nexport { hasReducedMotionListener, prefersReducedMotion };\n","import { isBrowser } from '../is-browser.mjs';\nimport { hasReducedMotionListener, prefersReducedMotion } from './state.mjs';\n\nfunction initPrefersReducedMotion() {\n    hasReducedMotionListener.current = true;\n    if (!isBrowser)\n        return;\n    if (window.matchMedia) {\n        const motionMediaQuery = window.matchMedia(\"(prefers-reduced-motion)\");\n        const setReducedMotionPreferences = () => (prefersReducedMotion.current = motionMediaQuery.matches);\n        motionMediaQuery.addListener(setReducedMotionPreferences);\n        setReducedMotionPreferences();\n    }\n    else {\n        prefersReducedMotion.current = false;\n    }\n}\n\nexport { initPrefersReducedMotion };\n","import { SubscriptionManager } from '../../utils/subscription-manager.mjs';\n\nconst names = [\n    \"LayoutMeasure\",\n    \"BeforeLayoutMeasure\",\n    \"LayoutUpdate\",\n    \"ViewportBoxUpdate\",\n    \"Update\",\n    \"Render\",\n    \"AnimationComplete\",\n    \"LayoutAnimationComplete\",\n    \"AnimationStart\",\n    \"LayoutAnimationStart\",\n    \"SetAxisTarget\",\n    \"Unmount\",\n];\nfunction createLifecycles() {\n    const managers = names.map(() => new SubscriptionManager());\n    const propSubscriptions = {};\n    const lifecycles = {\n        clearAllListeners: () => managers.forEach((manager) => manager.clear()),\n        updatePropListeners: (props) => {\n            names.forEach((name) => {\n                var _a;\n                const on = \"on\" + name;\n                const propListener = props[on];\n                // Unsubscribe existing subscription\n                (_a = propSubscriptions[name]) === null || _a === void 0 ? void 0 : _a.call(propSubscriptions);\n                // Add new subscription\n                if (propListener) {\n                    propSubscriptions[name] = lifecycles[on](propListener);\n                }\n            });\n        },\n    };\n    managers.forEach((manager, i) => {\n        lifecycles[\"on\" + names[i]] = (handler) => manager.add(handler);\n        lifecycles[\"notify\" + names[i]] = (...args) => manager.notify(...args);\n    });\n    return lifecycles;\n}\n\nexport { createLifecycles };\n","import { isWillChangeMotionValue } from '../../value/use-will-change/is.mjs';\nimport { warnOnce } from '../../utils/warn-once.mjs';\nimport { motionValue } from '../../value/index.mjs';\nimport { isMotionValue } from '../../value/utils/is-motion-value.mjs';\n\nfunction updateMotionValuesFromProps(element, next, prev) {\n    const { willChange } = next;\n    for (const key in next) {\n        const nextValue = next[key];\n        const prevValue = prev[key];\n        if (isMotionValue(nextValue)) {\n            /**\n             * If this is a motion value found in props or style, we want to add it\n             * to our visual element's motion value map.\n             */\n            element.addValue(key, nextValue);\n            if (isWillChangeMotionValue(willChange)) {\n                willChange.add(key);\n            }\n            /**\n             * Check the version of the incoming motion value with this version\n             * and warn against mismatches.\n             */\n            if (process.env.NODE_ENV === \"development\") {\n                warnOnce(nextValue.version === \"7.5.1\", `Attempting to mix Framer Motion versions ${nextValue.version} with 7.5.1 may not work as expected.`);\n            }\n        }\n        else if (isMotionValue(prevValue)) {\n            /**\n             * If we're swapping from a motion value to a static value,\n             * create a new motion value from that\n             */\n            element.addValue(key, motionValue(nextValue));\n            if (isWillChangeMotionValue(willChange)) {\n                willChange.remove(key);\n            }\n        }\n        else if (prevValue !== nextValue) {\n            /**\n             * If this is a flat value that has changed, update the motion value\n             * or create one if it doesn't exist. We only want to do this if we're\n             * not handling the value with our animation state.\n             */\n            if (element.hasValue(key)) {\n                const existingValue = element.getValue(key);\n                // TODO: Only update values that aren't being animated or even looked at\n                !existingValue.hasAnimated && existingValue.set(nextValue);\n            }\n            else {\n                const latestValue = element.getStaticValue(key);\n                element.addValue(key, motionValue(latestValue !== undefined ? latestValue : nextValue));\n            }\n        }\n    }\n    // Handle removed values\n    for (const key in prev) {\n        if (next[key] === undefined)\n            element.removeValue(key);\n    }\n    return next;\n}\n\nexport { updateMotionValuesFromProps };\n","import sync, { cancelSync } from 'framesync';\nimport { initPrefersReducedMotion } from '../utils/reduced-motion/index.mjs';\nimport { hasReducedMotionListener, prefersReducedMotion } from '../utils/reduced-motion/state.mjs';\nimport { motionValue } from '../value/index.mjs';\nimport { isWillChangeMotionValue } from '../value/use-will-change/is.mjs';\nimport { isMotionValue } from '../value/utils/is-motion-value.mjs';\nimport { variantPriorityOrder } from './utils/animation-state.mjs';\nimport { isVariantLabel } from './utils/is-variant-label.mjs';\nimport { createLifecycles } from './utils/lifecycles.mjs';\nimport { updateMotionValuesFromProps } from './utils/motion-values.mjs';\nimport { isControllingVariants, isVariantNode } from './utils/is-controlling-variants.mjs';\nimport { env } from '../utils/process.mjs';\nimport { invariant } from 'hey-listen';\nimport { featureDefinitions } from '../motion/features/definitions.mjs';\nimport { createElement } from 'react';\nimport { isRefObject } from '../utils/is-ref-object.mjs';\n\nconst featureNames = Object.keys(featureDefinitions);\nconst numFeatures = featureNames.length;\nconst visualElement = ({ treeType = \"\", build, getBaseTarget, makeTargetAnimatable, measureViewportBox, render: renderInstance, readValueFromInstance, removeValueFromRenderState, sortNodePosition, scrapeMotionValuesFromProps, }) => ({ parent, props, presenceId, blockInitialAnimation, visualState, reducedMotionConfig, }, options = {}) => {\n    let isMounted = false;\n    const { latestValues, renderState } = visualState;\n    /**\n     * The instance of the render-specific node that will be hydrated by the\n     * exposed React ref. So for example, this visual element can host a\n     * HTMLElement, plain object, or Three.js object. The functions provided\n     * in VisualElementConfig allow us to interface with this instance.\n     */\n    let instance;\n    /**\n     * Manages the subscriptions for a visual element's lifecycle, for instance\n     * onRender\n     */\n    const lifecycles = createLifecycles();\n    /**\n     * A map of all motion values attached to this visual element. Motion\n     * values are source of truth for any given animated value. A motion\n     * value might be provided externally by the component via props.\n     */\n    const values = new Map();\n    /**\n     * A map of every subscription that binds the provided or generated\n     * motion values onChange listeners to this visual element.\n     */\n    const valueSubscriptions = new Map();\n    /**\n     * A reference to the previously-provided motion values as returned\n     * from scrapeMotionValuesFromProps. We use the keys in here to determine\n     * if any motion values need to be removed after props are updated.\n     */\n    let prevMotionValues = {};\n    /**\n     * When values are removed from all animation props we need to search\n     * for a fallback value to animate to. These values are tracked in baseTarget.\n     */\n    const baseTarget = {\n        ...latestValues,\n    };\n    // Internal methods ========================\n    /**\n     * On mount, this will be hydrated with a callback to disconnect\n     * this visual element from its parent on unmount.\n     */\n    let removeFromVariantTree;\n    /**\n     * Render the element with the latest styles outside of the React\n     * render lifecycle\n     */\n    function render() {\n        if (!instance || !isMounted)\n            return;\n        triggerBuild();\n        renderInstance(instance, renderState, props.style, element.projection);\n    }\n    function triggerBuild() {\n        build(element, renderState, latestValues, options, props);\n    }\n    function update() {\n        lifecycles.notifyUpdate(latestValues);\n    }\n    /**\n     *\n     */\n    function bindToMotionValue(key, value) {\n        const removeOnChange = value.onChange((latestValue) => {\n            latestValues[key] = latestValue;\n            props.onUpdate && sync.update(update, false, true);\n        });\n        const removeOnRenderRequest = value.onRenderRequest(element.scheduleRender);\n        valueSubscriptions.set(key, () => {\n            removeOnChange();\n            removeOnRenderRequest();\n        });\n    }\n    /**\n     * Any motion values that are provided to the element when created\n     * aren't yet bound to the element, as this would technically be impure.\n     * However, we iterate through the motion values and set them to the\n     * initial values for this component.\n     *\n     * TODO: This is impure and we should look at changing this to run on mount.\n     * Doing so will break some tests but this isn't neccessarily a breaking change,\n     * more a reflection of the test.\n     */\n    const { willChange, ...initialMotionValues } = scrapeMotionValuesFromProps(props);\n    for (const key in initialMotionValues) {\n        const value = initialMotionValues[key];\n        if (latestValues[key] !== undefined && isMotionValue(value)) {\n            value.set(latestValues[key], false);\n            if (isWillChangeMotionValue(willChange)) {\n                willChange.add(key);\n            }\n        }\n    }\n    /**\n     * Update external values with initial values\n     */\n    if (props.values) {\n        for (const key in props.values) {\n            if (latestValues[key] !== undefined) {\n                props.values[key].set(latestValues[key]);\n            }\n        }\n    }\n    /**\n     * Determine what role this visual element should take in the variant tree.\n     */\n    const isControllingVariants$1 = isControllingVariants(props);\n    const isVariantNode$1 = isVariantNode(props);\n    const element = {\n        treeType,\n        /**\n         * This is a mirror of the internal instance prop, which keeps\n         * VisualElement type-compatible with React's RefObject.\n         */\n        current: null,\n        /**\n         * The depth of this visual element within the visual element tree.\n         */\n        depth: parent ? parent.depth + 1 : 0,\n        parent,\n        children: new Set(),\n        /**\n         *\n         */\n        presenceId,\n        shouldReduceMotion: null,\n        /**\n         * If this component is part of the variant tree, it should track\n         * any children that are also part of the tree. This is essentially\n         * a shadow tree to simplify logic around how to stagger over children.\n         */\n        variantChildren: isVariantNode$1 ? new Set() : undefined,\n        /**\n         * Whether this instance is visible. This can be changed imperatively\n         * by the projection tree, is analogous to CSS's visibility in that\n         * hidden elements should take up layout, and needs enacting by the configured\n         * render function.\n         */\n        isVisible: undefined,\n        /**\n         * Normally, if a component is controlled by a parent's variants, it can\n         * rely on that ancestor to trigger animations further down the tree.\n         * However, if a component is created after its parent is mounted, the parent\n         * won't trigger that mount animation so the child needs to.\n         *\n         * TODO: This might be better replaced with a method isParentMounted\n         */\n        manuallyAnimateOnMount: Boolean(parent === null || parent === void 0 ? void 0 : parent.isMounted()),\n        /**\n         * This can be set by AnimatePresence to force components that mount\n         * at the same time as it to mount as if they have initial={false} set.\n         */\n        blockInitialAnimation,\n        /**\n         * Determine whether this component has mounted yet. This is mostly used\n         * by variant children to determine whether they need to trigger their\n         * own animations on mount.\n         */\n        isMounted: () => Boolean(instance),\n        mount(newInstance) {\n            isMounted = true;\n            instance = element.current = newInstance;\n            if (element.projection) {\n                element.projection.mount(newInstance);\n            }\n            if (isVariantNode$1 && parent && !isControllingVariants$1) {\n                removeFromVariantTree = parent === null || parent === void 0 ? void 0 : parent.addVariantChild(element);\n            }\n            values.forEach((value, key) => bindToMotionValue(key, value));\n            if (!hasReducedMotionListener.current) {\n                initPrefersReducedMotion();\n            }\n            element.shouldReduceMotion =\n                reducedMotionConfig === \"never\"\n                    ? false\n                    : reducedMotionConfig === \"always\"\n                        ? true\n                        : prefersReducedMotion.current;\n            parent === null || parent === void 0 ? void 0 : parent.children.add(element);\n            element.setProps(props);\n        },\n        /**\n         *\n         */\n        unmount() {\n            var _a;\n            (_a = element.projection) === null || _a === void 0 ? void 0 : _a.unmount();\n            cancelSync.update(update);\n            cancelSync.render(render);\n            valueSubscriptions.forEach((remove) => remove());\n            removeFromVariantTree === null || removeFromVariantTree === void 0 ? void 0 : removeFromVariantTree();\n            parent === null || parent === void 0 ? void 0 : parent.children.delete(element);\n            lifecycles.clearAllListeners();\n            instance = undefined;\n            isMounted = false;\n        },\n        loadFeatures(renderedProps, isStrict, preloadedFeatures, projectionId, ProjectionNodeConstructor, initialLayoutGroupConfig) {\n            const features = [];\n            /**\n             * If we're in development mode, check to make sure we're not rendering a motion component\n             * as a child of LazyMotion, as this will break the file-size benefits of using it.\n             */\n            if (env !== \"production\" && preloadedFeatures && isStrict) {\n                invariant(false, \"You have rendered a `motion` component within a `LazyMotion` component. This will break tree shaking. Import and render a `m` component instead.\");\n            }\n            for (let i = 0; i < numFeatures; i++) {\n                const name = featureNames[i];\n                const { isEnabled, Component } = featureDefinitions[name];\n                /**\n                 * It might be possible in the future to use this moment to\n                 * dynamically request functionality. In initial tests this\n                 * was producing a lot of duplication amongst bundles.\n                 */\n                if (isEnabled(renderedProps) && Component) {\n                    features.push(createElement(Component, {\n                        key: name,\n                        ...renderedProps,\n                        visualElement: element,\n                    }));\n                }\n            }\n            if (!element.projection && ProjectionNodeConstructor) {\n                element.projection = new ProjectionNodeConstructor(projectionId, element.getLatestValues(), parent && parent.projection);\n                const { layoutId, layout, drag, dragConstraints, layoutScroll, } = renderedProps;\n                element.projection.setOptions({\n                    layoutId,\n                    layout,\n                    alwaysMeasureLayout: Boolean(drag) ||\n                        (dragConstraints && isRefObject(dragConstraints)),\n                    visualElement: element,\n                    scheduleRender: () => element.scheduleRender(),\n                    /**\n                     * TODO: Update options in an effect. This could be tricky as it'll be too late\n                     * to update by the time layout animations run.\n                     * We also need to fix this safeToRemove by linking it up to the one returned by usePresence,\n                     * ensuring it gets called if there's no potential layout animations.\n                     *\n                     */\n                    animationType: typeof layout === \"string\" ? layout : \"both\",\n                    initialPromotionConfig: initialLayoutGroupConfig,\n                    layoutScroll,\n                });\n            }\n            return features;\n        },\n        /**\n         * Add a child visual element to our set of children.\n         */\n        addVariantChild(child) {\n            var _a;\n            const closestVariantNode = element.getClosestVariantNode();\n            if (closestVariantNode) {\n                (_a = closestVariantNode.variantChildren) === null || _a === void 0 ? void 0 : _a.add(child);\n                return () => closestVariantNode.variantChildren.delete(child);\n            }\n        },\n        sortNodePosition(other) {\n            /**\n             * If these nodes aren't even of the same type we can't compare their depth.\n             */\n            if (!sortNodePosition || treeType !== other.treeType)\n                return 0;\n            return sortNodePosition(element.getInstance(), other.getInstance());\n        },\n        /**\n         * Returns the closest variant node in the tree starting from\n         * this visual element.\n         */\n        getClosestVariantNode: () => isVariantNode$1 ? element : parent === null || parent === void 0 ? void 0 : parent.getClosestVariantNode(),\n        /**\n         * Expose the latest layoutId prop.\n         */\n        getLayoutId: () => props.layoutId,\n        /**\n         * Returns the current instance.\n         */\n        getInstance: () => instance,\n        /**\n         * Get/set the latest static values.\n         */\n        getStaticValue: (key) => latestValues[key],\n        setStaticValue: (key, value) => (latestValues[key] = value),\n        /**\n         * Returns the latest motion value state. Currently only used to take\n         * a snapshot of the visual element - perhaps this can return the whole\n         * visual state\n         */\n        getLatestValues: () => latestValues,\n        /**\n         * Set the visiblity of the visual element. If it's changed, schedule\n         * a render to reflect these changes.\n         */\n        setVisibility(visibility) {\n            if (element.isVisible === visibility)\n                return;\n            element.isVisible = visibility;\n            element.scheduleRender();\n        },\n        /**\n         * Make a target animatable by Popmotion. For instance, if we're\n         * trying to animate width from 100px to 100vw we need to measure 100vw\n         * in pixels to determine what we really need to animate to. This is also\n         * pluggable to support Framer's custom value types like Color,\n         * and CSS variables.\n         */\n        makeTargetAnimatable(target, canMutate = true) {\n            return makeTargetAnimatable(element, target, props, canMutate);\n        },\n        /**\n         * Measure the current viewport box with or without transforms.\n         * Only measures axis-aligned boxes, rotate and skew must be manually\n         * removed with a re-render to work.\n         */\n        measureViewportBox() {\n            return measureViewportBox(instance, props);\n        },\n        // Motion values ========================\n        /**\n         * Add a motion value and bind it to this visual element.\n         */\n        addValue(key, value) {\n            // Remove existing value if it exists\n            if (element.hasValue(key))\n                element.removeValue(key);\n            values.set(key, value);\n            latestValues[key] = value.get();\n            bindToMotionValue(key, value);\n        },\n        /**\n         * Remove a motion value and unbind any active subscriptions.\n         */\n        removeValue(key) {\n            var _a;\n            values.delete(key);\n            (_a = valueSubscriptions.get(key)) === null || _a === void 0 ? void 0 : _a();\n            valueSubscriptions.delete(key);\n            delete latestValues[key];\n            removeValueFromRenderState(key, renderState);\n        },\n        /**\n         * Check whether we have a motion value for this key\n         */\n        hasValue: (key) => values.has(key),\n        /**\n         * Get a motion value for this key. If called with a default\n         * value, we'll create one if none exists.\n         */\n        getValue(key, defaultValue) {\n            if (props.values && props.values[key]) {\n                return props.values[key];\n            }\n            let value = values.get(key);\n            if (value === undefined && defaultValue !== undefined) {\n                value = motionValue(defaultValue);\n                element.addValue(key, value);\n            }\n            return value;\n        },\n        /**\n         * Iterate over our motion values.\n         */\n        forEachValue: (callback) => values.forEach(callback),\n        /**\n         * If we're trying to animate to a previously unencountered value,\n         * we need to check for it in our state and as a last resort read it\n         * directly from the instance (which might have performance implications).\n         */\n        readValue: (key) => latestValues[key] !== undefined\n            ? latestValues[key]\n            : readValueFromInstance(instance, key, options),\n        /**\n         * Set the base target to later animate back to. This is currently\n         * only hydrated on creation and when we first read a value.\n         */\n        setBaseTarget(key, value) {\n            baseTarget[key] = value;\n        },\n        /**\n         * Find the base target for a value thats been removed from all animation\n         * props.\n         */\n        getBaseTarget(key) {\n            if (getBaseTarget) {\n                const target = getBaseTarget(props, key);\n                if (target !== undefined && !isMotionValue(target))\n                    return target;\n            }\n            return baseTarget[key];\n        },\n        // Lifecyles ========================\n        ...lifecycles,\n        /**\n         * Build the renderer state based on the latest visual state.\n         */\n        build() {\n            triggerBuild();\n            return renderState;\n        },\n        /**\n         * Schedule a render on the next animation frame.\n         */\n        scheduleRender() {\n            sync.render(render, false, true);\n        },\n        /**\n         * Synchronously fire render. It's prefered that we batch renders but\n         * in many circumstances, like layout measurement, we need to run this\n         * synchronously. However in those instances other measures should be taken\n         * to batch reads/writes.\n         */\n        syncRender: render,\n        /**\n         * Update the provided props. Ensure any newly-added motion values are\n         * added to our map, old ones removed, and listeners updated.\n         */\n        setProps(newProps) {\n            if (newProps.transformTemplate || props.transformTemplate) {\n                element.scheduleRender();\n            }\n            props = newProps;\n            lifecycles.updatePropListeners(newProps);\n            prevMotionValues = updateMotionValuesFromProps(element, scrapeMotionValuesFromProps(props), prevMotionValues);\n        },\n        getProps: () => props,\n        // Variants ==============================\n        /**\n         * Returns the variant definition with a given name.\n         */\n        getVariant: (name) => { var _a; return (_a = props.variants) === null || _a === void 0 ? void 0 : _a[name]; },\n        /**\n         * Returns the defined default transition on this component.\n         */\n        getDefaultTransition: () => props.transition,\n        getTransformPagePoint: () => {\n            return props.transformPagePoint;\n        },\n        /**\n         * Used by child variant nodes to get the closest ancestor variant props.\n         */\n        getVariantContext(startAtParent = false) {\n            if (startAtParent)\n                return parent === null || parent === void 0 ? void 0 : parent.getVariantContext();\n            if (!isControllingVariants$1) {\n                const context = (parent === null || parent === void 0 ? void 0 : parent.getVariantContext()) || {};\n                if (props.initial !== undefined) {\n                    context.initial = props.initial;\n                }\n                return context;\n            }\n            const context = {};\n            for (let i = 0; i < numVariantProps; i++) {\n                const name = variantProps[i];\n                const prop = props[name];\n                if (isVariantLabel(prop) || prop === false) {\n                    context[name] = prop;\n                }\n            }\n            return context;\n        },\n    };\n    return element;\n};\nconst variantProps = [\"initial\", ...variantPriorityOrder];\nconst numVariantProps = variantProps.length;\n\nexport { visualElement };\n","import { invariant } from 'hey-listen';\n\nfunction isCSSVariable(value) {\n    return typeof value === \"string\" && value.startsWith(\"var(--\");\n}\n/**\n * Parse Framer's special CSS variable format into a CSS token and a fallback.\n *\n * ```\n * `var(--foo, #fff)` => [`--foo`, '#fff']\n * ```\n *\n * @param current\n */\nconst cssVariableRegex = /var\\((--[a-zA-Z0-9-_]+),? ?([a-zA-Z0-9 ()%#.,-]+)?\\)/;\nfunction parseCSSVariable(current) {\n    const match = cssVariableRegex.exec(current);\n    if (!match)\n        return [,];\n    const [, token, fallback] = match;\n    return [token, fallback];\n}\nconst maxDepth = 4;\nfunction getVariableValue(current, element, depth = 1) {\n    invariant(depth <= maxDepth, `Max CSS variable fallback depth detected in property \"${current}\". This may indicate a circular fallback dependency.`);\n    const [token, fallback] = parseCSSVariable(current);\n    // No CSS variable detected\n    if (!token)\n        return;\n    // Attempt to read this CSS variable off the element\n    const resolved = window.getComputedStyle(element).getPropertyValue(token);\n    if (resolved) {\n        return resolved.trim();\n    }\n    else if (isCSSVariable(fallback)) {\n        // The fallback might itself be a CSS variable, in which case we attempt to resolve it too.\n        return getVariableValue(fallback, element, depth + 1);\n    }\n    else {\n        return fallback;\n    }\n}\n/**\n * Resolve CSS variables from\n *\n * @internal\n */\nfunction resolveCSSVariables(visualElement, { ...target }, transitionEnd) {\n    const element = visualElement.getInstance();\n    if (!(element instanceof Element))\n        return { target, transitionEnd };\n    // If `transitionEnd` isn't `undefined`, clone it. We could clone `target` and `transitionEnd`\n    // only if they change but I think this reads clearer and this isn't a performance-critical path.\n    if (transitionEnd) {\n        transitionEnd = { ...transitionEnd };\n    }\n    // Go through existing `MotionValue`s and ensure any existing CSS variables are resolved\n    visualElement.forEachValue((value) => {\n        const current = value.get();\n        if (!isCSSVariable(current))\n            return;\n        const resolved = getVariableValue(current, element);\n        if (resolved)\n            value.set(resolved);\n    });\n    // Cycle through every target property and resolve CSS variables. Currently\n    // we only read single-var properties like `var(--foo)`, not `calc(var(--foo) + 20px)`\n    for (const key in target) {\n        const current = target[key];\n        if (!isCSSVariable(current))\n            continue;\n        const resolved = getVariableValue(current, element);\n        if (!resolved)\n            continue;\n        // Clone target if it hasn't already been\n        target[key] = resolved;\n        // If the user hasn't already set this key on `transitionEnd`, set it to the unresolved\n        // CSS variable. This will ensure that after the animation the component will reflect\n        // changes in the value of the CSS variable.\n        if (transitionEnd && transitionEnd[key] === undefined) {\n            transitionEnd[key] = current;\n        }\n    }\n    return { target, transitionEnd };\n}\n\nexport { cssVariableRegex, parseCSSVariable, resolveCSSVariables };\n","import { px, number } from 'style-value-types';\nimport { isKeyframesTarget } from '../../../animation/utils/is-keyframes-target.mjs';\nimport { invariant } from 'hey-listen';\nimport { transformPropOrder } from '../../html/utils/transform.mjs';\nimport { findDimensionValueType } from '../value-types/dimensions.mjs';\nimport { isBrowser } from '../../../utils/is-browser.mjs';\n\nconst positionalKeys = new Set([\n    \"width\",\n    \"height\",\n    \"top\",\n    \"left\",\n    \"right\",\n    \"bottom\",\n    \"x\",\n    \"y\",\n]);\nconst isPositionalKey = (key) => positionalKeys.has(key);\nconst hasPositionalKey = (target) => {\n    return Object.keys(target).some(isPositionalKey);\n};\nconst setAndResetVelocity = (value, to) => {\n    // Looks odd but setting it twice doesn't render, it'll just\n    // set both prev and current to the latest value\n    value.set(to, false);\n    value.set(to);\n};\nconst isNumOrPxType = (v) => v === number || v === px;\nvar BoundingBoxDimension;\n(function (BoundingBoxDimension) {\n    BoundingBoxDimension[\"width\"] = \"width\";\n    BoundingBoxDimension[\"height\"] = \"height\";\n    BoundingBoxDimension[\"left\"] = \"left\";\n    BoundingBoxDimension[\"right\"] = \"right\";\n    BoundingBoxDimension[\"top\"] = \"top\";\n    BoundingBoxDimension[\"bottom\"] = \"bottom\";\n})(BoundingBoxDimension || (BoundingBoxDimension = {}));\nconst getPosFromMatrix = (matrix, pos) => parseFloat(matrix.split(\", \")[pos]);\nconst getTranslateFromMatrix = (pos2, pos3) => (_bbox, { transform }) => {\n    if (transform === \"none\" || !transform)\n        return 0;\n    const matrix3d = transform.match(/^matrix3d\\((.+)\\)$/);\n    if (matrix3d) {\n        return getPosFromMatrix(matrix3d[1], pos3);\n    }\n    else {\n        const matrix = transform.match(/^matrix\\((.+)\\)$/);\n        if (matrix) {\n            return getPosFromMatrix(matrix[1], pos2);\n        }\n        else {\n            return 0;\n        }\n    }\n};\nconst transformKeys = new Set([\"x\", \"y\", \"z\"]);\nconst nonTranslationalTransformKeys = transformPropOrder.filter((key) => !transformKeys.has(key));\nfunction removeNonTranslationalTransform(visualElement) {\n    const removedTransforms = [];\n    nonTranslationalTransformKeys.forEach((key) => {\n        const value = visualElement.getValue(key);\n        if (value !== undefined) {\n            removedTransforms.push([key, value.get()]);\n            value.set(key.startsWith(\"scale\") ? 1 : 0);\n        }\n    });\n    // Apply changes to element before measurement\n    if (removedTransforms.length)\n        visualElement.syncRender();\n    return removedTransforms;\n}\nconst positionalValues = {\n    // Dimensions\n    width: ({ x }, { paddingLeft = \"0\", paddingRight = \"0\" }) => x.max - x.min - parseFloat(paddingLeft) - parseFloat(paddingRight),\n    height: ({ y }, { paddingTop = \"0\", paddingBottom = \"0\" }) => y.max - y.min - parseFloat(paddingTop) - parseFloat(paddingBottom),\n    top: (_bbox, { top }) => parseFloat(top),\n    left: (_bbox, { left }) => parseFloat(left),\n    bottom: ({ y }, { top }) => parseFloat(top) + (y.max - y.min),\n    right: ({ x }, { left }) => parseFloat(left) + (x.max - x.min),\n    // Transform\n    x: getTranslateFromMatrix(4, 13),\n    y: getTranslateFromMatrix(5, 14),\n};\nconst convertChangedValueTypes = (target, visualElement, changedKeys) => {\n    const originBbox = visualElement.measureViewportBox();\n    const element = visualElement.getInstance();\n    const elementComputedStyle = getComputedStyle(element);\n    const { display } = elementComputedStyle;\n    const origin = {};\n    // If the element is currently set to display: \"none\", make it visible before\n    // measuring the target bounding box\n    if (display === \"none\") {\n        visualElement.setStaticValue(\"display\", target.display || \"block\");\n    }\n    /**\n     * Record origins before we render and update styles\n     */\n    changedKeys.forEach((key) => {\n        origin[key] = positionalValues[key](originBbox, elementComputedStyle);\n    });\n    // Apply the latest values (as set in checkAndConvertChangedValueTypes)\n    visualElement.syncRender();\n    const targetBbox = visualElement.measureViewportBox();\n    changedKeys.forEach((key) => {\n        // Restore styles to their **calculated computed style**, not their actual\n        // originally set style. This allows us to animate between equivalent pixel units.\n        const value = visualElement.getValue(key);\n        setAndResetVelocity(value, origin[key]);\n        target[key] = positionalValues[key](targetBbox, elementComputedStyle);\n    });\n    return target;\n};\nconst checkAndConvertChangedValueTypes = (visualElement, target, origin = {}, transitionEnd = {}) => {\n    target = { ...target };\n    transitionEnd = { ...transitionEnd };\n    const targetPositionalKeys = Object.keys(target).filter(isPositionalKey);\n    // We want to remove any transform values that could affect the element's bounding box before\n    // it's measured. We'll reapply these later.\n    let removedTransformValues = [];\n    let hasAttemptedToRemoveTransformValues = false;\n    const changedValueTypeKeys = [];\n    targetPositionalKeys.forEach((key) => {\n        const value = visualElement.getValue(key);\n        if (!visualElement.hasValue(key))\n            return;\n        let from = origin[key];\n        let fromType = findDimensionValueType(from);\n        const to = target[key];\n        let toType;\n        // TODO: The current implementation of this basically throws an error\n        // if you try and do value conversion via keyframes. There's probably\n        // a way of doing this but the performance implications would need greater scrutiny,\n        // as it'd be doing multiple resize-remeasure operations.\n        if (isKeyframesTarget(to)) {\n            const numKeyframes = to.length;\n            const fromIndex = to[0] === null ? 1 : 0;\n            from = to[fromIndex];\n            fromType = findDimensionValueType(from);\n            for (let i = fromIndex; i < numKeyframes; i++) {\n                if (!toType) {\n                    toType = findDimensionValueType(to[i]);\n                    invariant(toType === fromType ||\n                        (isNumOrPxType(fromType) && isNumOrPxType(toType)), \"Keyframes must be of the same dimension as the current value\");\n                }\n                else {\n                    invariant(findDimensionValueType(to[i]) === toType, \"All keyframes must be of the same type\");\n                }\n            }\n        }\n        else {\n            toType = findDimensionValueType(to);\n        }\n        if (fromType !== toType) {\n            // If they're both just number or px, convert them both to numbers rather than\n            // relying on resize/remeasure to convert (which is wasteful in this situation)\n            if (isNumOrPxType(fromType) && isNumOrPxType(toType)) {\n                const current = value.get();\n                if (typeof current === \"string\") {\n                    value.set(parseFloat(current));\n                }\n                if (typeof to === \"string\") {\n                    target[key] = parseFloat(to);\n                }\n                else if (Array.isArray(to) && toType === px) {\n                    target[key] = to.map(parseFloat);\n                }\n            }\n            else if ((fromType === null || fromType === void 0 ? void 0 : fromType.transform) &&\n                (toType === null || toType === void 0 ? void 0 : toType.transform) &&\n                (from === 0 || to === 0)) {\n                // If one or the other value is 0, it's safe to coerce it to the\n                // type of the other without measurement\n                if (from === 0) {\n                    value.set(toType.transform(from));\n                }\n                else {\n                    target[key] = fromType.transform(to);\n                }\n            }\n            else {\n                // If we're going to do value conversion via DOM measurements, we first\n                // need to remove non-positional transform values that could affect the bbox measurements.\n                if (!hasAttemptedToRemoveTransformValues) {\n                    removedTransformValues =\n                        removeNonTranslationalTransform(visualElement);\n                    hasAttemptedToRemoveTransformValues = true;\n                }\n                changedValueTypeKeys.push(key);\n                transitionEnd[key] =\n                    transitionEnd[key] !== undefined\n                        ? transitionEnd[key]\n                        : target[key];\n                setAndResetVelocity(value, to);\n            }\n        }\n    });\n    if (changedValueTypeKeys.length) {\n        const scrollY = changedValueTypeKeys.indexOf(\"height\") >= 0\n            ? window.pageYOffset\n            : null;\n        const convertedTarget = convertChangedValueTypes(target, visualElement, changedValueTypeKeys);\n        // If we removed transform values, reapply them before the next render\n        if (removedTransformValues.length) {\n            removedTransformValues.forEach(([key, value]) => {\n                visualElement.getValue(key).set(value);\n            });\n        }\n        // Reapply original values\n        visualElement.syncRender();\n        // Restore scroll position\n        if (isBrowser && scrollY !== null) {\n            window.scrollTo({ top: scrollY });\n        }\n        return { target: convertedTarget, transitionEnd };\n    }\n    else {\n        return { target, transitionEnd };\n    }\n};\n/**\n * Convert value types for x/y/width/height/top/left/bottom/right\n *\n * Allows animation between `'auto'` -> `'100%'` or `0` -> `'calc(50% - 10vw)'`\n *\n * @internal\n */\nfunction unitConversion(visualElement, target, origin, transitionEnd) {\n    return hasPositionalKey(target)\n        ? checkAndConvertChangedValueTypes(visualElement, target, origin, transitionEnd)\n        : { target, transitionEnd };\n}\n\nexport { BoundingBoxDimension, positionalValues, unitConversion };\n","import { resolveCSSVariables } from './css-variables-conversion.mjs';\nimport { unitConversion } from './unit-conversion.mjs';\n\n/**\n * Parse a DOM variant to make it animatable. This involves resolving CSS variables\n * and ensuring animations like \"20%\" => \"calc(50vw)\" are performed in pixels.\n */\nconst parseDomVariant = (visualElement, target, origin, transitionEnd) => {\n    const resolved = resolveCSSVariables(visualElement, target, transitionEnd);\n    target = resolved.target;\n    transitionEnd = resolved.transitionEnd;\n    return unitConversion(visualElement, target, origin, transitionEnd);\n};\n\nexport { parseDomVariant };\n","import { visualElement } from '../index.mjs';\nimport { getOrigin, checkTargetForNewValues } from '../utils/setters.mjs';\nimport { buildHTMLStyles } from './utils/build-styles.mjs';\nimport { isCSSVariable } from '../dom/utils/is-css-variable.mjs';\nimport { parseDomVariant } from '../dom/utils/parse-dom-variant.mjs';\nimport { transformProps } from './utils/transform.mjs';\nimport { scrapeMotionValuesFromProps } from './utils/scrape-motion-values.mjs';\nimport { renderHTML } from './utils/render.mjs';\nimport { getDefaultValueType } from '../dom/value-types/defaults.mjs';\nimport { measureViewportBox } from '../../projection/utils/measure.mjs';\n\nfunction getComputedStyle(element) {\n    return window.getComputedStyle(element);\n}\nconst htmlConfig = {\n    treeType: \"dom\",\n    readValueFromInstance(domElement, key) {\n        if (transformProps.has(key)) {\n            const defaultType = getDefaultValueType(key);\n            return defaultType ? defaultType.default || 0 : 0;\n        }\n        else {\n            const computedStyle = getComputedStyle(domElement);\n            const value = (isCSSVariable(key)\n                ? computedStyle.getPropertyValue(key)\n                : computedStyle[key]) || 0;\n            return typeof value === \"string\" ? value.trim() : value;\n        }\n    },\n    sortNodePosition(a, b) {\n        /**\n         * compareDocumentPosition returns a bitmask, by using the bitwise &\n         * we're returning true if 2 in that bitmask is set to true. 2 is set\n         * to true if b preceeds a.\n         */\n        return a.compareDocumentPosition(b) & 2 ? 1 : -1;\n    },\n    getBaseTarget(props, key) {\n        var _a;\n        return (_a = props.style) === null || _a === void 0 ? void 0 : _a[key];\n    },\n    measureViewportBox(element, { transformPagePoint }) {\n        return measureViewportBox(element, transformPagePoint);\n    },\n    /**\n     * Reset the transform on the current Element. This is called as part\n     * of a batched process across the entire layout tree. To remove this write\n     * cycle it'd be interesting to see if it's possible to \"undo\" all the current\n     * layout transforms up the tree in the same way this.getBoundingBoxWithoutTransforms\n     * works\n     */\n    resetTransform(element, domElement, props) {\n        const { transformTemplate } = props;\n        domElement.style.transform = transformTemplate\n            ? transformTemplate({}, \"\")\n            : \"none\";\n        // Ensure that whatever happens next, we restore our transform on the next frame\n        element.scheduleRender();\n    },\n    restoreTransform(instance, mutableState) {\n        instance.style.transform = mutableState.style.transform;\n    },\n    removeValueFromRenderState(key, { vars, style }) {\n        delete vars[key];\n        delete style[key];\n    },\n    /**\n     * Ensure that HTML and Framer-specific value types like `px`->`%` and `Color`\n     * can be animated by Motion.\n     */\n    makeTargetAnimatable(element, { transition, transitionEnd, ...target }, { transformValues }, isMounted = true) {\n        let origin = getOrigin(target, transition || {}, element);\n        /**\n         * If Framer has provided a function to convert `Color` etc value types, convert them\n         */\n        if (transformValues) {\n            if (transitionEnd)\n                transitionEnd = transformValues(transitionEnd);\n            if (target)\n                target = transformValues(target);\n            if (origin)\n                origin = transformValues(origin);\n        }\n        if (isMounted) {\n            checkTargetForNewValues(element, target, origin);\n            const parsed = parseDomVariant(element, target, origin, transitionEnd);\n            transitionEnd = parsed.transitionEnd;\n            target = parsed.target;\n        }\n        return {\n            transition,\n            transitionEnd,\n            ...target,\n        };\n    },\n    scrapeMotionValuesFromProps,\n    build(element, renderState, latestValues, options, props) {\n        if (element.isVisible !== undefined) {\n            renderState.style.visibility = element.isVisible\n                ? \"visible\"\n                : \"hidden\";\n        }\n        buildHTMLStyles(renderState, latestValues, options, props.transformTemplate);\n    },\n    render: renderHTML,\n};\nconst htmlVisualElement = visualElement(htmlConfig);\n\nexport { getComputedStyle, htmlConfig, htmlVisualElement };\n","import { visualElement } from '../index.mjs';\nimport { scrapeMotionValuesFromProps } from './utils/scrape-motion-values.mjs';\nimport { htmlConfig } from '../html/visual-element.mjs';\nimport { buildSVGAttrs } from './utils/build-attrs.mjs';\nimport { camelToDash } from '../dom/utils/camel-to-dash.mjs';\nimport { camelCaseAttributes } from './utils/camel-case-attrs.mjs';\nimport { transformProps } from '../html/utils/transform.mjs';\nimport { renderSVG } from './utils/render.mjs';\nimport { getDefaultValueType } from '../dom/value-types/defaults.mjs';\n\nconst svgVisualElement = visualElement({\n    ...htmlConfig,\n    getBaseTarget(props, key) {\n        return props[key];\n    },\n    readValueFromInstance(domElement, key) {\n        var _a;\n        if (transformProps.has(key)) {\n            return ((_a = getDefaultValueType(key)) === null || _a === void 0 ? void 0 : _a.default) || 0;\n        }\n        key = !camelCaseAttributes.has(key) ? camelToDash(key) : key;\n        return domElement.getAttribute(key);\n    },\n    scrapeMotionValuesFromProps,\n    build(_element, renderState, latestValues, options, props) {\n        buildSVGAttrs(renderState, latestValues, options, props.transformTemplate);\n    },\n    render: renderSVG,\n});\n\nexport { svgVisualElement };\n","import { htmlVisualElement } from '../html/visual-element.mjs';\nimport { svgVisualElement } from '../svg/visual-element.mjs';\nimport { isSVGComponent } from './utils/is-svg-component.mjs';\n\nconst createDomVisualElement = (Component, options) => {\n    return isSVGComponent(Component)\n        ? svgVisualElement(options, { enableHardwareAcceleration: false })\n        : htmlVisualElement(options, { enableHardwareAcceleration: true });\n};\n\nexport { createDomVisualElement };\n","import { createMotionProxy } from './motion-proxy.mjs';\nimport { createDomMotionConfig } from './utils/create-config.mjs';\n\n/**\n * @public\n */\nconst m = createMotionProxy(createDomMotionConfig);\n\nexport { m };\n","import { useRef } from 'react';\nimport { useIsomorphicLayoutEffect } from './use-isomorphic-effect.mjs';\n\nfunction useIsMounted() {\n    const isMounted = useRef(false);\n    useIsomorphicLayoutEffect(() => {\n        isMounted.current = true;\n        return () => {\n            isMounted.current = false;\n        };\n    }, []);\n    return isMounted;\n}\n\nexport { useIsMounted };\n","import sync from 'framesync';\nimport { useState, useCallback } from 'react';\nimport { useIsMounted } from './use-is-mounted.mjs';\n\nfunction useForceUpdate() {\n    const isMounted = useIsMounted();\n    const [forcedRenderCount, setForcedRenderCount] = useState(0);\n    const forceRender = useCallback(() => {\n        isMounted.current && setForcedRenderCount(forcedRenderCount + 1);\n    }, [forcedRenderCount]);\n    /**\n     * Defer this to the end of the next animation frame in case there are multiple\n     * synchronous calls.\n     */\n    const deferredForceRender = useCallback(() => sync.postRender(forceRender), [forceRender]);\n    return [deferredForceRender, forcedRenderCount];\n}\n\nexport { useForceUpdate };\n","import * as React from 'react';\nimport { useId, useRef, useInsertionEffect } from 'react';\n\n/**\n * Measurement functionality has to be within a separate component\n * to leverage snapshot lifecycle.\n */\nclass PopChildMeasure extends React.Component {\n    getSnapshotBeforeUpdate(prevProps) {\n        const element = this.props.childRef.current;\n        if (element && prevProps.isPresent && !this.props.isPresent) {\n            const size = this.props.sizeRef.current;\n            size.height = element.offsetHeight || 0;\n            size.width = element.offsetWidth || 0;\n            size.top = element.offsetTop;\n            size.left = element.offsetLeft;\n        }\n        return null;\n    }\n    /**\n     * Required with getSnapshotBeforeUpdate to stop React complaining.\n     */\n    componentDidUpdate() { }\n    render() {\n        return this.props.children;\n    }\n}\nfunction PopChild({ children, isPresent }) {\n    const id = useId();\n    const ref = useRef(null);\n    const size = useRef({\n        width: 0,\n        height: 0,\n        top: 0,\n        left: 0,\n    });\n    /**\n     * We create and inject a style block so we can apply this explicit\n     * sizing in a non-destructive manner by just deleting the style block.\n     *\n     * We can't apply size via render as the measurement happens\n     * in getSnapshotBeforeUpdate (post-render), likewise if we apply the\n     * styles directly on the DOM node, we might be overwriting\n     * styles set via the style prop.\n     */\n    useInsertionEffect(() => {\n        const { width, height, top, left } = size.current;\n        if (isPresent || !ref.current || !width || !height)\n            return;\n        ref.current.dataset.motionPopId = id;\n        const style = document.createElement(\"style\");\n        document.head.appendChild(style);\n        if (style.sheet) {\n            style.sheet.insertRule(`\n          [data-motion-pop-id=\"${id}\"] {\n            position: absolute !important;\n            width: ${width}px !important;\n            height: ${height}px !important;\n            top: ${top}px !important;\n            left: ${left}px !important;\n          }\n        `);\n        }\n        return () => {\n            document.head.removeChild(style);\n        };\n    }, [isPresent]);\n    return (React.createElement(PopChildMeasure, { isPresent: isPresent, childRef: ref, sizeRef: size }, React.cloneElement(children, { ref })));\n}\n\nexport { PopChild };\n","import * as React from 'react';\nimport { useId, useMemo } from 'react';\nimport { PresenceContext } from '../../context/PresenceContext.mjs';\nimport { useConstant } from '../../utils/use-constant.mjs';\nimport { PopChild } from './PopChild.mjs';\n\nconst PresenceChild = ({ children, initial, isPresent, onExitComplete, custom, presenceAffectsLayout, mode, }) => {\n    const presenceChildren = useConstant(newChildrenMap);\n    const id = useId();\n    const context = useMemo(() => ({\n        id,\n        initial,\n        isPresent,\n        custom,\n        onExitComplete: (childId) => {\n            presenceChildren.set(childId, true);\n            for (const isComplete of presenceChildren.values()) {\n                if (!isComplete)\n                    return; // can stop searching when any is incomplete\n            }\n            onExitComplete && onExitComplete();\n        },\n        register: (childId) => {\n            presenceChildren.set(childId, false);\n            return () => presenceChildren.delete(childId);\n        },\n    }), \n    /**\n     * If the presence of a child affects the layout of the components around it,\n     * we want to make a new context value to ensure they get re-rendered\n     * so they can detect that layout change.\n     */\n    presenceAffectsLayout ? undefined : [isPresent]);\n    useMemo(() => {\n        presenceChildren.forEach((_, key) => presenceChildren.set(key, false));\n    }, [isPresent]);\n    /**\n     * If there's no `motion` components to fire exit animations, we want to remove this\n     * component immediately.\n     */\n    React.useEffect(() => {\n        !isPresent &&\n            !presenceChildren.size &&\n            onExitComplete &&\n            onExitComplete();\n    }, [isPresent]);\n    if (mode === \"popLayout\") {\n        children = React.createElement(PopChild, { isPresent: isPresent }, children);\n    }\n    return (React.createElement(PresenceContext.Provider, { value: context }, children));\n};\nfunction newChildrenMap() {\n    return new Map();\n}\n\nexport { PresenceChild };\n","import * as React from 'react';\nimport { useContext, useRef, cloneElement, Children, isValidElement } from 'react';\nimport { env } from '../../utils/process.mjs';\nimport { useForceUpdate } from '../../utils/use-force-update.mjs';\nimport { useIsMounted } from '../../utils/use-is-mounted.mjs';\nimport { PresenceChild } from './PresenceChild.mjs';\nimport { LayoutGroupContext } from '../../context/LayoutGroupContext.mjs';\nimport { useIsomorphicLayoutEffect } from '../../utils/use-isomorphic-effect.mjs';\nimport { useUnmountEffect } from '../../utils/use-unmount-effect.mjs';\nimport { warnOnce } from '../../utils/warn-once.mjs';\n\nconst getChildKey = (child) => child.key || \"\";\nfunction updateChildLookup(children, allChildren) {\n    children.forEach((child) => {\n        const key = getChildKey(child);\n        allChildren.set(key, child);\n    });\n}\nfunction onlyElements(children) {\n    const filtered = [];\n    // We use forEach here instead of map as map mutates the component key by preprending `.$`\n    Children.forEach(children, (child) => {\n        if (isValidElement(child))\n            filtered.push(child);\n    });\n    return filtered;\n}\n/**\n * `AnimatePresence` enables the animation of components that have been removed from the tree.\n *\n * When adding/removing more than a single child, every child **must** be given a unique `key` prop.\n *\n * Any `motion` components that have an `exit` property defined will animate out when removed from\n * the tree.\n *\n * ```jsx\n * import { motion, AnimatePresence } from 'framer-motion'\n *\n * export const Items = ({ items }) => (\n *   <AnimatePresence>\n *     {items.map(item => (\n *       <motion.div\n *         key={item.id}\n *         initial={{ opacity: 0 }}\n *         animate={{ opacity: 1 }}\n *         exit={{ opacity: 0 }}\n *       />\n *     ))}\n *   </AnimatePresence>\n * )\n * ```\n *\n * You can sequence exit animations throughout a tree using variants.\n *\n * If a child contains multiple `motion` components with `exit` props, it will only unmount the child\n * once all `motion` components have finished animating out. Likewise, any components using\n * `usePresence` all need to call `safeToRemove`.\n *\n * @public\n */\nconst AnimatePresence = ({ children, custom, initial = true, onExitComplete, exitBeforeEnter, presenceAffectsLayout = true, mode = \"sync\", }) => {\n    // Support deprecated exitBeforeEnter prop\n    if (exitBeforeEnter) {\n        mode = \"wait\";\n        warnOnce(false, \"Replace exitBeforeEnter with mode='wait'\");\n    }\n    // We want to force a re-render once all exiting animations have finished. We\n    // either use a local forceRender function, or one from a parent context if it exists.\n    let [forceRender] = useForceUpdate();\n    const forceRenderLayoutGroup = useContext(LayoutGroupContext).forceRender;\n    if (forceRenderLayoutGroup)\n        forceRender = forceRenderLayoutGroup;\n    const isMounted = useIsMounted();\n    // Filter out any children that aren't ReactElements. We can only track ReactElements with a props.key\n    const filteredChildren = onlyElements(children);\n    let childrenToRender = filteredChildren;\n    const exiting = new Set();\n    // Keep a living record of the children we're actually rendering so we\n    // can diff to figure out which are entering and exiting\n    const presentChildren = useRef(childrenToRender);\n    // A lookup table to quickly reference components by key\n    const allChildren = useRef(new Map()).current;\n    // If this is the initial component render, just deal with logic surrounding whether\n    // we play onMount animations or not.\n    const isInitialRender = useRef(true);\n    useIsomorphicLayoutEffect(() => {\n        isInitialRender.current = false;\n        updateChildLookup(filteredChildren, allChildren);\n        presentChildren.current = childrenToRender;\n    });\n    useUnmountEffect(() => {\n        isInitialRender.current = true;\n        allChildren.clear();\n        exiting.clear();\n    });\n    if (isInitialRender.current) {\n        return (React.createElement(React.Fragment, null, childrenToRender.map((child) => (React.createElement(PresenceChild, { key: getChildKey(child), isPresent: true, initial: initial ? undefined : false, presenceAffectsLayout: presenceAffectsLayout, mode: mode }, child)))));\n    }\n    // If this is a subsequent render, deal with entering and exiting children\n    childrenToRender = [...childrenToRender];\n    // Diff the keys of the currently-present and target children to update our\n    // exiting list.\n    const presentKeys = presentChildren.current.map(getChildKey);\n    const targetKeys = filteredChildren.map(getChildKey);\n    // Diff the present children with our target children and mark those that are exiting\n    const numPresent = presentKeys.length;\n    for (let i = 0; i < numPresent; i++) {\n        const key = presentKeys[i];\n        if (targetKeys.indexOf(key) === -1) {\n            exiting.add(key);\n        }\n    }\n    // If we currently have exiting children, and we're deferring rendering incoming children\n    // until after all current children have exiting, empty the childrenToRender array\n    if (mode === \"wait\" && exiting.size) {\n        childrenToRender = [];\n    }\n    // Loop through all currently exiting components and clone them to overwrite `animate`\n    // with any `exit` prop they might have defined.\n    exiting.forEach((key) => {\n        // If this component is actually entering again, early return\n        if (targetKeys.indexOf(key) !== -1)\n            return;\n        const child = allChildren.get(key);\n        if (!child)\n            return;\n        const insertionIndex = presentKeys.indexOf(key);\n        const onExit = () => {\n            allChildren.delete(key);\n            exiting.delete(key);\n            // Remove this child from the present children\n            const removeIndex = presentChildren.current.findIndex((presentChild) => presentChild.key === key);\n            presentChildren.current.splice(removeIndex, 1);\n            // Defer re-rendering until all exiting children have indeed left\n            if (!exiting.size) {\n                presentChildren.current = filteredChildren;\n                if (isMounted.current === false)\n                    return;\n                forceRender();\n                onExitComplete && onExitComplete();\n            }\n        };\n        childrenToRender.splice(insertionIndex, 0, React.createElement(PresenceChild, { key: getChildKey(child), isPresent: false, onExitComplete: onExit, custom: custom, presenceAffectsLayout: presenceAffectsLayout, mode: mode }, child));\n    });\n    // Add `MotionContext` even to children that don't need it to ensure we're rendering\n    // the same tree between renders\n    childrenToRender = childrenToRender.map((child) => {\n        const key = child.key;\n        return exiting.has(key) ? (child) : (React.createElement(PresenceChild, { key: getChildKey(child), isPresent: true, presenceAffectsLayout: presenceAffectsLayout, mode: mode }, child));\n    });\n    if (env !== \"production\" &&\n        mode === \"wait\" &&\n        childrenToRender.length > 1) {\n        console.warn(`You're attempting to animate multiple children within AnimatePresence, but its mode is set to \"wait\". This will lead to odd visual behaviour.`);\n    }\n    return (React.createElement(React.Fragment, null, exiting.size\n        ? childrenToRender\n        : childrenToRender.map((child) => cloneElement(child))));\n};\n\nexport { AnimatePresence };\n","import * as React from 'react';\nimport { useState, useRef, useEffect } from 'react';\nimport { LazyContext } from '../../context/LazyContext.mjs';\nimport { loadFeatures } from '../../motion/features/load-features.mjs';\n\n/**\n * Used in conjunction with the `m` component to reduce bundle size.\n *\n * `m` is a version of the `motion` component that only loads functionality\n * critical for the initial render.\n *\n * `LazyMotion` can then be used to either synchronously or asynchronously\n * load animation and gesture support.\n *\n * ```jsx\n * // Synchronous loading\n * import { LazyMotion, m, domAnimations } from \"framer-motion\"\n *\n * function App() {\n *   return (\n *     <LazyMotion features={domAnimations}>\n *       <m.div animate={{ scale: 2 }} />\n *     </LazyMotion>\n *   )\n * }\n *\n * // Asynchronous loading\n * import { LazyMotion, m } from \"framer-motion\"\n *\n * function App() {\n *   return (\n *     <LazyMotion features={() => import('./path/to/domAnimations')}>\n *       <m.div animate={{ scale: 2 }} />\n *     </LazyMotion>\n *   )\n * }\n * ```\n *\n * @public\n */\nfunction LazyMotion({ children, features, strict = false }) {\n    const [, setIsLoaded] = useState(!isLazyBundle(features));\n    const loadedRenderer = useRef(undefined);\n    /**\n     * If this is a synchronous load, load features immediately\n     */\n    if (!isLazyBundle(features)) {\n        const { renderer, ...loadedFeatures } = features;\n        loadedRenderer.current = renderer;\n        loadFeatures(loadedFeatures);\n    }\n    useEffect(() => {\n        if (isLazyBundle(features)) {\n            features().then(({ renderer, ...loadedFeatures }) => {\n                loadFeatures(loadedFeatures);\n                loadedRenderer.current = renderer;\n                setIsLoaded(true);\n            });\n        }\n    }, []);\n    return (React.createElement(LazyContext.Provider, { value: { renderer: loadedRenderer.current, strict } }, children));\n}\nfunction isLazyBundle(features) {\n    return typeof features === \"function\";\n}\n\nexport { LazyMotion };\n","import { animations } from '../../motion/features/animations.mjs';\nimport { gestureAnimations } from '../../motion/features/gestures.mjs';\nimport { createDomVisualElement } from './create-visual-element.mjs';\n\n/**\n * @public\n */\nconst domAnimation = {\n    renderer: createDomVisualElement,\n    ...animations,\n    ...gestureAnimations,\n};\n\nexport { domAnimation };\n","import {useState as $6imuh$useState, useRef as $6imuh$useRef, useCallback as $6imuh$useCallback} from \"react\";\n\n\nfunction $458b0a5536c1a7cf$export$40bfa8c7b0832715(value1, defaultValue, onChange) {\n    let [stateValue, setStateValue] = $6imuh$useState(value1 || defaultValue);\n    let ref = $6imuh$useRef(value1 !== undefined);\n    let wasControlled = ref.current;\n    let isControlled = value1 !== undefined;\n    // Internal state reference for useCallback\n    let stateRef = $6imuh$useRef(stateValue);\n    if (wasControlled !== isControlled) console.warn(`WARN: A component changed from ${wasControlled ? 'controlled' : 'uncontrolled'} to ${isControlled ? 'controlled' : 'uncontrolled'}.`);\n    ref.current = isControlled;\n    let setValue = $6imuh$useCallback((value2, ...args)=>{\n        let onChangeCaller = (value, ...onChangeArgs)=>{\n            if (onChange) {\n                if (!Object.is(stateRef.current, value)) onChange(value, ...onChangeArgs);\n            }\n            if (!isControlled) stateRef.current = value;\n        };\n        if (typeof value2 === 'function') {\n            console.warn('We can not support a function callback. See Github Issues for details https://github.com/adobe/react-spectrum/issues/2320');\n            // this supports functional updates https://reactjs.org/docs/hooks-reference.html#functional-updates\n            // when someone using useControlledState calls setControlledState(myFunc)\n            // this will call our useState setState with a function as well which invokes myFunc and calls onChange with the value from myFunc\n            // if we're in an uncontrolled state, then we also return the value of myFunc which to setState looks as though it was just called with myFunc from the beginning\n            // otherwise we just return the controlled value, which won't cause a rerender because React knows to bail out when the value is the same\n            let updateFunction = (oldValue, ...functionArgs)=>{\n                let interceptedValue = value2(isControlled ? stateRef.current : oldValue, ...functionArgs);\n                onChangeCaller(interceptedValue, ...args);\n                if (!isControlled) return interceptedValue;\n                return oldValue;\n            };\n            setStateValue(updateFunction);\n        } else {\n            if (!isControlled) setStateValue(value2);\n            onChangeCaller(value2, ...args);\n        }\n    }, [\n        isControlled,\n        onChange\n    ]);\n    // If a controlled component's value prop changes, we need to update stateRef\n    if (isControlled) stateRef.current = value1;\n    else value1 = stateValue;\n    return [\n        value1,\n        setValue\n    ];\n}\n\n\nfunction $9446cca9a3875146$export$7d15b64cf5a3a4c4(value, min = -Infinity, max = Infinity) {\n    let newValue = Math.min(Math.max(value, min), max);\n    return newValue;\n}\nfunction $9446cca9a3875146$export$cb6e0bb50bc19463(value, min, max, step) {\n    let remainder = (value - (isNaN(min) ? 0 : min)) % step;\n    let snappedValue = Math.abs(remainder) * 2 >= step ? value + Math.sign(remainder) * (step - Math.abs(remainder)) : value - remainder;\n    if (!isNaN(min)) {\n        if (snappedValue < min) snappedValue = min;\n        else if (!isNaN(max) && snappedValue > max) snappedValue = min + Math.floor((max - min) / step) * step;\n    } else if (!isNaN(max) && snappedValue > max) snappedValue = Math.floor(max / step) * step;\n    // correct floating point behavior by rounding to step precision\n    let string = step.toString();\n    let index = string.indexOf('.');\n    let precision = index >= 0 ? string.length - index : 0;\n    if (precision > 0) {\n        let pow = Math.pow(10, precision);\n        snappedValue = Math.round(snappedValue * pow) / pow;\n    }\n    return snappedValue;\n}\nfunction $9446cca9a3875146$export$b6268554fba451f(value, digits, base = 10) {\n    const pow = Math.pow(base, digits);\n    return Math.round(value * pow) / pow;\n}\n\n\n\n\nexport {$458b0a5536c1a7cf$export$40bfa8c7b0832715 as useControlledState, $9446cca9a3875146$export$7d15b64cf5a3a4c4 as clamp, $9446cca9a3875146$export$cb6e0bb50bc19463 as snapValueToStep, $9446cca9a3875146$export$b6268554fba451f as toFixedNumber};\n//# sourceMappingURL=module.js.map\n","import $89yE2$react, {useContext as $89yE2$useContext, useMemo as $89yE2$useMemo, useState as $89yE2$useState, useLayoutEffect as $89yE2$useLayoutEffect} from \"react\";\n\n\n// Default context value to use in case there is no SSRProvider. This is fine for\n// client-only apps. In order to support multiple copies of React Aria potentially\n// being on the page at once, the prefix is set to a random number. SSRProvider\n// will reset this to zero for consistency between server and client, so in the\n// SSR case multiple copies of React Aria is not supported.\nconst $704cf1d3b684cc5c$var$defaultContext = {\n    prefix: String(Math.round(Math.random() * 10000000000)),\n    current: 0\n};\nconst $704cf1d3b684cc5c$var$SSRContext = /*#__PURE__*/ $89yE2$react.createContext($704cf1d3b684cc5c$var$defaultContext);\nfunction $704cf1d3b684cc5c$export$9f8ac96af4b1b2ae(props) {\n    let cur = $89yE2$useContext($704cf1d3b684cc5c$var$SSRContext);\n    let value = $89yE2$useMemo(()=>({\n            // If this is the first SSRProvider, start with an empty string prefix, otherwise\n            // append and increment the counter.\n            prefix: cur === $704cf1d3b684cc5c$var$defaultContext ? '' : `${cur.prefix}-${++cur.current}`,\n            current: 0\n        })\n    , [\n        cur\n    ]);\n    return(/*#__PURE__*/ $89yE2$react.createElement($704cf1d3b684cc5c$var$SSRContext.Provider, {\n        value: value\n    }, props.children));\n}\nlet $704cf1d3b684cc5c$var$canUseDOM = Boolean(typeof window !== 'undefined' && window.document && window.document.createElement);\nfunction $704cf1d3b684cc5c$export$619500959fc48b26(defaultId) {\n    let ctx = $89yE2$useContext($704cf1d3b684cc5c$var$SSRContext);\n    // If we are rendering in a non-DOM environment, and there's no SSRProvider,\n    // provide a warning to hint to the developer to add one.\n    if (ctx === $704cf1d3b684cc5c$var$defaultContext && !$704cf1d3b684cc5c$var$canUseDOM) console.warn('When server rendering, you must wrap your application in an <SSRProvider> to ensure consistent ids are generated between the client and server.');\n    return $89yE2$useMemo(()=>defaultId || `react-aria${ctx.prefix}-${++ctx.current}`\n    , [\n        defaultId\n    ]);\n}\nfunction $704cf1d3b684cc5c$export$535bd6ca7f90a273() {\n    let cur = $89yE2$useContext($704cf1d3b684cc5c$var$SSRContext);\n    let isInSSRContext = cur !== $704cf1d3b684cc5c$var$defaultContext;\n    let [isSSR, setIsSSR] = $89yE2$useState(isInSSRContext);\n    // If on the client, and the component was initially server rendered,\n    // then schedule a layout effect to update the component after hydration.\n    if (typeof window !== 'undefined' && isInSSRContext) // This if statement technically breaks the rules of hooks, but is safe\n    // because the condition never changes after mounting.\n    // eslint-disable-next-line react-hooks/rules-of-hooks\n    $89yE2$useLayoutEffect(()=>{\n        setIsSSR(false);\n    }, []);\n    return isSSR;\n}\n\n\n\n\nexport {$704cf1d3b684cc5c$export$9f8ac96af4b1b2ae as SSRProvider, $704cf1d3b684cc5c$export$619500959fc48b26 as useSSRSafeId, $704cf1d3b684cc5c$export$535bd6ca7f90a273 as useIsSSR};\n//# sourceMappingURL=module.js.map\n","import {clamp as $4507461a1b870123$re_export$clamp, snapValueToStep as $4507461a1b870123$re_export$snapValueToStep} from \"@react-stately/utils\";\nimport $12uGp$react, {useState as $12uGp$useState, useRef as $12uGp$useRef, useCallback as $12uGp$useCallback, useEffect as $12uGp$useEffect} from \"react\";\nimport {useSSRSafeId as $12uGp$useSSRSafeId} from \"@react-aria/ssr\";\nimport $12uGp$clsx from \"clsx\";\n\n\n\nconst $f0a04ccd8dbdd83b$export$e5c5a5f917a5871c = typeof window !== 'undefined' ? $12uGp$react.useLayoutEffect : ()=>{\n};\n\n\n\n\nlet $bdb11010cef70236$var$idsUpdaterMap = new Map();\nfunction $bdb11010cef70236$export$f680877a34711e37(defaultId) {\n    let [value, setValue] = $12uGp$useState(defaultId);\n    let nextId = $12uGp$useRef(null);\n    let res = $12uGp$useSSRSafeId(value);\n    let updateValue = $12uGp$useCallback((val)=>{\n        nextId.current = val;\n    }, []);\n    $bdb11010cef70236$var$idsUpdaterMap.set(res, updateValue);\n    $f0a04ccd8dbdd83b$export$e5c5a5f917a5871c(()=>{\n        let r = res;\n        return ()=>{\n            $bdb11010cef70236$var$idsUpdaterMap.delete(r);\n        };\n    }, [\n        res\n    ]);\n    // This cannot cause an infinite loop because the ref is updated first.\n    // eslint-disable-next-line\n    $12uGp$useEffect(()=>{\n        let newId = nextId.current;\n        if (newId) {\n            nextId.current = null;\n            setValue(newId);\n        }\n    });\n    return res;\n}\nfunction $bdb11010cef70236$export$cd8c9cb68f842629(idA, idB) {\n    if (idA === idB) return idA;\n    let setIdA = $bdb11010cef70236$var$idsUpdaterMap.get(idA);\n    if (setIdA) {\n        setIdA(idB);\n        return idB;\n    }\n    let setIdB = $bdb11010cef70236$var$idsUpdaterMap.get(idB);\n    if (setIdB) {\n        setIdB(idA);\n        return idA;\n    }\n    return idB;\n}\nfunction $bdb11010cef70236$export$b4cc09c592e8fdb8(depArray = []) {\n    let id = $bdb11010cef70236$export$f680877a34711e37();\n    let [resolvedId, setResolvedId] = $1dbecbe27a04f9af$export$14d238f342723f25(id);\n    let updateId = $12uGp$useCallback(()=>{\n        setResolvedId(function*() {\n            yield id;\n            yield document.getElementById(id) ? id : null;\n        });\n    }, [\n        id,\n        setResolvedId\n    ]);\n    $f0a04ccd8dbdd83b$export$e5c5a5f917a5871c(updateId, [\n        id,\n        updateId,\n        ...depArray\n    ]);\n    return resolvedId;\n}\n\n\nfunction $ff5963eb1fccf552$export$e08e3b67e392101e(...callbacks) {\n    return (...args)=>{\n        for (let callback of callbacks)if (typeof callback === 'function') callback(...args);\n    };\n}\n\n\n\n\n\nfunction $3ef42575df84b30b$export$9d1611c77c2fe928(...args) {\n    // Start with a base clone of the first argument. This is a lot faster than starting\n    // with an empty object and adding properties as we go.\n    let result = {\n        ...args[0]\n    };\n    for(let i = 1; i < args.length; i++){\n        let props = args[i];\n        for(let key in props){\n            let a = result[key];\n            let b = props[key];\n            // Chain events\n            if (typeof a === 'function' && typeof b === 'function' && // This is a lot faster than a regex.\n            key[0] === 'o' && key[1] === 'n' && key.charCodeAt(2) >= /* 'A' */ 65 && key.charCodeAt(2) <= /* 'Z' */ 90) result[key] = $ff5963eb1fccf552$export$e08e3b67e392101e(a, b);\n            else if ((key === 'className' || key === 'UNSAFE_className') && typeof a === 'string' && typeof b === 'string') result[key] = $12uGp$clsx(a, b);\n            else if (key === 'id' && a && b) result.id = $bdb11010cef70236$export$cd8c9cb68f842629(a, b);\n            else result[key] = b !== undefined ? b : a;\n        }\n    }\n    return result;\n}\n\n\nfunction $5dc95899b306f630$export$c9058316764c140e(...refs) {\n    return (value)=>{\n        for (let ref of refs){\n            if (typeof ref === 'function') ref(value);\n            else if (ref != null) ref.current = value;\n        }\n    };\n}\n\n\nconst $65484d02dcb7eb3e$var$DOMPropNames = new Set([\n    'id'\n]);\nconst $65484d02dcb7eb3e$var$labelablePropNames = new Set([\n    'aria-label',\n    'aria-labelledby',\n    'aria-describedby',\n    'aria-details'\n]);\nconst $65484d02dcb7eb3e$var$propRe = /^(data-.*)$/;\nfunction $65484d02dcb7eb3e$export$457c3d6518dd4c6f(props, opts = {\n}) {\n    let { labelable: labelable , propNames: propNames  } = opts;\n    let filteredProps = {\n    };\n    for(const prop in props)if (Object.prototype.hasOwnProperty.call(props, prop) && ($65484d02dcb7eb3e$var$DOMPropNames.has(prop) || labelable && $65484d02dcb7eb3e$var$labelablePropNames.has(prop) || (propNames === null || propNames === void 0 ? void 0 : propNames.has(prop)) || $65484d02dcb7eb3e$var$propRe.test(prop))) filteredProps[prop] = props[prop];\n    return filteredProps;\n}\n\n\nfunction $7215afc6de606d6b$export$de79e2c695e052f3(element) {\n    if ($7215afc6de606d6b$var$supportsPreventScroll()) element.focus({\n        preventScroll: true\n    });\n    else {\n        let scrollableElements = $7215afc6de606d6b$var$getScrollableElements(element);\n        element.focus();\n        $7215afc6de606d6b$var$restoreScrollPosition(scrollableElements);\n    }\n}\nlet $7215afc6de606d6b$var$supportsPreventScrollCached = null;\nfunction $7215afc6de606d6b$var$supportsPreventScroll() {\n    if ($7215afc6de606d6b$var$supportsPreventScrollCached == null) {\n        $7215afc6de606d6b$var$supportsPreventScrollCached = false;\n        try {\n            var focusElem = document.createElement('div');\n            focusElem.focus({\n                get preventScroll () {\n                    $7215afc6de606d6b$var$supportsPreventScrollCached = true;\n                    return true;\n                }\n            });\n        } catch (e) {\n        // Ignore\n        }\n    }\n    return $7215afc6de606d6b$var$supportsPreventScrollCached;\n}\nfunction $7215afc6de606d6b$var$getScrollableElements(element) {\n    var parent = element.parentNode;\n    var scrollableElements = [];\n    var rootScrollingElement = document.scrollingElement || document.documentElement;\n    while(parent instanceof HTMLElement && parent !== rootScrollingElement){\n        if (parent.offsetHeight < parent.scrollHeight || parent.offsetWidth < parent.scrollWidth) scrollableElements.push({\n            element: parent,\n            scrollTop: parent.scrollTop,\n            scrollLeft: parent.scrollLeft\n        });\n        parent = parent.parentNode;\n    }\n    if (rootScrollingElement instanceof HTMLElement) scrollableElements.push({\n        element: rootScrollingElement,\n        scrollTop: rootScrollingElement.scrollTop,\n        scrollLeft: rootScrollingElement.scrollLeft\n    });\n    return scrollableElements;\n}\nfunction $7215afc6de606d6b$var$restoreScrollPosition(scrollableElements) {\n    for (let { element: element , scrollTop: scrollTop , scrollLeft: scrollLeft  } of scrollableElements){\n        element.scrollTop = scrollTop;\n        element.scrollLeft = scrollLeft;\n    }\n}\n\n\nfunction $ab71dadb03a6fb2e$export$622cea445a1c5b7d(element, reverse, orientation = 'horizontal') {\n    let rect = element.getBoundingClientRect();\n    if (reverse) return orientation === 'horizontal' ? rect.right : rect.bottom;\n    return orientation === 'horizontal' ? rect.left : rect.top;\n}\n\n\n/*\n * Copyright 2020 Adobe. All rights reserved.\n * This file is licensed to you under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License. You may obtain a copy\n * of the License at http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software distributed under\n * the License is distributed on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR REPRESENTATIONS\n * OF ANY KIND, either express or implied. See the License for the specific language\n * governing permissions and limitations under the License.\n */ // We store a global list of elements that are currently transitioning,\n// mapped to a set of CSS properties that are transitioning for that element.\n// This is necessary rather than a simple count of transitions because of browser\n// bugs, e.g. Chrome sometimes fires both transitionend and transitioncancel rather\n// than one or the other. So we need to track what's actually transitioning so that\n// we can ignore these duplicate events.\nlet $bbed8b41f857bcc0$var$transitionsByElement = new Map();\n// A list of callbacks to call once there are no transitioning elements.\nlet $bbed8b41f857bcc0$var$transitionCallbacks = new Set();\nfunction $bbed8b41f857bcc0$var$setupGlobalEvents() {\n    if (typeof window === 'undefined') return;\n    let onTransitionStart = (e)=>{\n        // Add the transitioning property to the list for this element.\n        let transitions = $bbed8b41f857bcc0$var$transitionsByElement.get(e.target);\n        if (!transitions) {\n            transitions = new Set();\n            $bbed8b41f857bcc0$var$transitionsByElement.set(e.target, transitions);\n            // The transitioncancel event must be registered on the element itself, rather than as a global\n            // event. This enables us to handle when the node is deleted from the document while it is transitioning.\n            // In that case, the cancel event would have nowhere to bubble to so we need to handle it directly.\n            e.target.addEventListener('transitioncancel', onTransitionEnd);\n        }\n        transitions.add(e.propertyName);\n    };\n    let onTransitionEnd = (e)=>{\n        // Remove property from list of transitioning properties.\n        let properties = $bbed8b41f857bcc0$var$transitionsByElement.get(e.target);\n        if (!properties) return;\n        properties.delete(e.propertyName);\n        // If empty, remove transitioncancel event, and remove the element from the list of transitioning elements.\n        if (properties.size === 0) {\n            e.target.removeEventListener('transitioncancel', onTransitionEnd);\n            $bbed8b41f857bcc0$var$transitionsByElement.delete(e.target);\n        }\n        // If no transitioning elements, call all of the queued callbacks.\n        if ($bbed8b41f857bcc0$var$transitionsByElement.size === 0) {\n            for (let cb of $bbed8b41f857bcc0$var$transitionCallbacks)cb();\n            $bbed8b41f857bcc0$var$transitionCallbacks.clear();\n        }\n    };\n    document.body.addEventListener('transitionrun', onTransitionStart);\n    document.body.addEventListener('transitionend', onTransitionEnd);\n}\nif (typeof document !== 'undefined') {\n    if (document.readyState !== 'loading') $bbed8b41f857bcc0$var$setupGlobalEvents();\n    else document.addEventListener('DOMContentLoaded', $bbed8b41f857bcc0$var$setupGlobalEvents);\n}\nfunction $bbed8b41f857bcc0$export$24490316f764c430(fn) {\n    // Wait one frame to see if an animation starts, e.g. a transition on mount.\n    requestAnimationFrame(()=>{\n        // If no transitions are running, call the function immediately.\n        // Otherwise, add it to a list of callbacks to run at the end of the animation.\n        if ($bbed8b41f857bcc0$var$transitionsByElement.size === 0) fn();\n        else $bbed8b41f857bcc0$var$transitionCallbacks.add(fn);\n    });\n}\n\n\n\n\n// Keep track of elements that we are currently handling dragging for via useDrag1D.\n// If there's an ancestor and a descendant both using useDrag1D(), and the user starts\n// dragging the descendant, we don't want useDrag1D events to fire for the ancestor.\nconst $9cc09df9fd7676be$var$draggingElements = [];\nfunction $9cc09df9fd7676be$export$7bbed75feba39706(props) {\n    console.warn('useDrag1D is deprecated, please use `useMove` instead https://react-spectrum.adobe.com/react-aria/useMove.html');\n    let { containerRef: containerRef , reverse: reverse , orientation: orientation , onHover: onHover , onDrag: onDrag , onPositionChange: onPositionChange , onIncrement: onIncrement , onDecrement: onDecrement , onIncrementToMax: onIncrementToMax , onDecrementToMin: onDecrementToMin , onCollapseToggle: onCollapseToggle  } = props;\n    let getPosition = (e)=>orientation === 'horizontal' ? e.clientX : e.clientY\n    ;\n    let getNextOffset = (e)=>{\n        let containerOffset = $ab71dadb03a6fb2e$export$622cea445a1c5b7d(containerRef.current, reverse, orientation);\n        let mouseOffset = getPosition(e);\n        let nextOffset = reverse ? containerOffset - mouseOffset : mouseOffset - containerOffset;\n        return nextOffset;\n    };\n    let dragging = $12uGp$useRef(false);\n    let prevPosition = $12uGp$useRef(0);\n    // Keep track of the current handlers in a ref so that the events can access them.\n    let handlers = $12uGp$useRef({\n        onPositionChange: onPositionChange,\n        onDrag: onDrag\n    });\n    handlers.current.onDrag = onDrag;\n    handlers.current.onPositionChange = onPositionChange;\n    let onMouseDragged = (e)=>{\n        e.preventDefault();\n        let nextOffset = getNextOffset(e);\n        if (!dragging.current) {\n            dragging.current = true;\n            if (handlers.current.onDrag) handlers.current.onDrag(true);\n            if (handlers.current.onPositionChange) handlers.current.onPositionChange(nextOffset);\n        }\n        if (prevPosition.current === nextOffset) return;\n        prevPosition.current = nextOffset;\n        if (onPositionChange) onPositionChange(nextOffset);\n    };\n    let onMouseUp = (e)=>{\n        const target = e.target;\n        dragging.current = false;\n        let nextOffset = getNextOffset(e);\n        if (handlers.current.onDrag) handlers.current.onDrag(false);\n        if (handlers.current.onPositionChange) handlers.current.onPositionChange(nextOffset);\n        $9cc09df9fd7676be$var$draggingElements.splice($9cc09df9fd7676be$var$draggingElements.indexOf(target), 1);\n        window.removeEventListener('mouseup', onMouseUp, false);\n        window.removeEventListener('mousemove', onMouseDragged, false);\n    };\n    let onMouseDown = (e)=>{\n        const target = e.currentTarget;\n        // If we're already handling dragging on a descendant with useDrag1D, then\n        // we don't want to handle the drag motion on this target as well.\n        if ($9cc09df9fd7676be$var$draggingElements.some((elt)=>target.contains(elt)\n        )) return;\n        $9cc09df9fd7676be$var$draggingElements.push(target);\n        window.addEventListener('mousemove', onMouseDragged, false);\n        window.addEventListener('mouseup', onMouseUp, false);\n    };\n    let onMouseEnter = ()=>{\n        if (onHover) onHover(true);\n    };\n    let onMouseOut = ()=>{\n        if (onHover) onHover(false);\n    };\n    let onKeyDown = (e)=>{\n        switch(e.key){\n            case 'Left':\n            case 'ArrowLeft':\n                if (orientation === 'horizontal') {\n                    e.preventDefault();\n                    if (onDecrement && !reverse) onDecrement();\n                    else if (onIncrement && reverse) onIncrement();\n                }\n                break;\n            case 'Up':\n            case 'ArrowUp':\n                if (orientation === 'vertical') {\n                    e.preventDefault();\n                    if (onDecrement && !reverse) onDecrement();\n                    else if (onIncrement && reverse) onIncrement();\n                }\n                break;\n            case 'Right':\n            case 'ArrowRight':\n                if (orientation === 'horizontal') {\n                    e.preventDefault();\n                    if (onIncrement && !reverse) onIncrement();\n                    else if (onDecrement && reverse) onDecrement();\n                }\n                break;\n            case 'Down':\n            case 'ArrowDown':\n                if (orientation === 'vertical') {\n                    e.preventDefault();\n                    if (onIncrement && !reverse) onIncrement();\n                    else if (onDecrement && reverse) onDecrement();\n                }\n                break;\n            case 'Home':\n                e.preventDefault();\n                if (onDecrementToMin) onDecrementToMin();\n                break;\n            case 'End':\n                e.preventDefault();\n                if (onIncrementToMax) onIncrementToMax();\n                break;\n            case 'Enter':\n                e.preventDefault();\n                if (onCollapseToggle) onCollapseToggle();\n                break;\n        }\n    };\n    return {\n        onMouseDown: onMouseDown,\n        onMouseEnter: onMouseEnter,\n        onMouseOut: onMouseOut,\n        onKeyDown: onKeyDown\n    };\n}\n\n\n\nfunction $03deb23ff14920c4$export$4eaf04e54aa8eed6() {\n    let globalListeners = $12uGp$useRef(new Map());\n    let addGlobalListener = $12uGp$useCallback((eventTarget, type, listener, options)=>{\n        // Make sure we remove the listener after it is called with the `once` option.\n        let fn = (options === null || options === void 0 ? void 0 : options.once) ? (...args)=>{\n            globalListeners.current.delete(listener);\n            listener(...args);\n        } : listener;\n        globalListeners.current.set(listener, {\n            type: type,\n            eventTarget: eventTarget,\n            fn: fn,\n            options: options\n        });\n        eventTarget.addEventListener(type, listener, options);\n    }, []);\n    let removeGlobalListener = $12uGp$useCallback((eventTarget, type, listener, options)=>{\n        var ref;\n        let fn = ((ref = globalListeners.current.get(listener)) === null || ref === void 0 ? void 0 : ref.fn) || listener;\n        eventTarget.removeEventListener(type, fn, options);\n        globalListeners.current.delete(listener);\n    }, []);\n    let removeAllGlobalListeners = $12uGp$useCallback(()=>{\n        globalListeners.current.forEach((value, key)=>{\n            removeGlobalListener(value.eventTarget, value.type, key, value.options);\n        });\n    }, [\n        removeGlobalListener\n    ]);\n    // eslint-disable-next-line arrow-body-style\n    $12uGp$useEffect(()=>{\n        return removeAllGlobalListeners;\n    }, [\n        removeAllGlobalListeners\n    ]);\n    return {\n        addGlobalListener: addGlobalListener,\n        removeGlobalListener: removeGlobalListener,\n        removeAllGlobalListeners: removeAllGlobalListeners\n    };\n}\n\n\n\nfunction $313b98861ee5dd6c$export$d6875122194c7b44(props, defaultLabel) {\n    let { id: id , 'aria-label': label , 'aria-labelledby': labelledBy  } = props;\n    // If there is both an aria-label and aria-labelledby,\n    // combine them by pointing to the element itself.\n    id = $bdb11010cef70236$export$f680877a34711e37(id);\n    if (labelledBy && label) {\n        let ids = new Set([\n            ...labelledBy.trim().split(/\\s+/),\n            id\n        ]);\n        labelledBy = [\n            ...ids\n        ].join(' ');\n    } else if (labelledBy) labelledBy = labelledBy.trim().split(/\\s+/).join(' ');\n    // If no labels are provided, use the default\n    if (!label && !labelledBy && defaultLabel) label = defaultLabel;\n    return {\n        id: id,\n        'aria-label': label,\n        'aria-labelledby': labelledBy\n    };\n}\n\n\n\n\nfunction $df56164dff5785e2$export$4338b53315abf666(forwardedRef) {\n    const objRef = $12uGp$useRef();\n    /**\n   * We're using `useLayoutEffect` here instead of `useEffect` because we want\n   * to make sure that the `ref` value is up to date before other places in the\n   * the execution cycle try to read it.\n   */ $f0a04ccd8dbdd83b$export$e5c5a5f917a5871c(()=>{\n        if (!forwardedRef) return;\n        if (typeof forwardedRef === 'function') forwardedRef(objRef.current);\n        else forwardedRef.current = objRef.current;\n    }, [\n        forwardedRef\n    ]);\n    return objRef;\n}\n\n\n\nfunction $4f58c5f72bcf79f7$export$496315a1608d9602(effect, dependencies) {\n    const isInitialMount = $12uGp$useRef(true);\n    $12uGp$useEffect(()=>{\n        if (isInitialMount.current) isInitialMount.current = false;\n        else effect();\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n    }, dependencies);\n}\n\n\n\n\nfunction $9daab02d461809db$var$hasResizeObserver() {\n    return typeof window.ResizeObserver !== 'undefined';\n}\nfunction $9daab02d461809db$export$683480f191c0e3ea(options) {\n    const { ref: ref , onResize: onResize  } = options;\n    $12uGp$useEffect(()=>{\n        let element = ref === null || ref === void 0 ? void 0 : ref.current;\n        if (!element) return;\n        if (!$9daab02d461809db$var$hasResizeObserver()) {\n            window.addEventListener('resize', onResize, false);\n            return ()=>{\n                window.removeEventListener('resize', onResize, false);\n            };\n        } else {\n            const resizeObserverInstance = new window.ResizeObserver((entries)=>{\n                if (!entries.length) return;\n                onResize();\n            });\n            resizeObserverInstance.observe(element);\n            return ()=>{\n                if (element) resizeObserverInstance.unobserve(element);\n            };\n        }\n    }, [\n        onResize,\n        ref\n    ]);\n}\n\n\n\nfunction $e7801be82b4b2a53$export$4debdb1a3f0fa79e(context, ref) {\n    $f0a04ccd8dbdd83b$export$e5c5a5f917a5871c(()=>{\n        if (context && context.ref && ref) {\n            context.ref.current = ref.current;\n            return ()=>{\n                context.ref.current = null;\n            };\n        }\n    }, [\n        context,\n        ref\n    ]);\n}\n\n\nfunction $62d8ded9296f3872$export$cfa2225e87938781(node) {\n    while(node && !$62d8ded9296f3872$var$isScrollable(node))node = node.parentElement;\n    return node || document.scrollingElement || document.documentElement;\n}\nfunction $62d8ded9296f3872$var$isScrollable(node) {\n    let style = window.getComputedStyle(node);\n    return /(auto|scroll)/.test(style.overflow + style.overflowX + style.overflowY);\n}\n\n\n\n// @ts-ignore\nlet $5df64b3807dc15ee$var$visualViewport = typeof window !== 'undefined' && window.visualViewport;\nfunction $5df64b3807dc15ee$export$d699905dd57c73ca() {\n    let [size1, setSize] = $12uGp$useState(()=>$5df64b3807dc15ee$var$getViewportSize()\n    );\n    $12uGp$useEffect(()=>{\n        // Use visualViewport api to track available height even on iOS virtual keyboard opening\n        let onResize = ()=>{\n            setSize((size)=>{\n                let newSize = $5df64b3807dc15ee$var$getViewportSize();\n                if (newSize.width === size.width && newSize.height === size.height) return size;\n                return newSize;\n            });\n        };\n        if (!$5df64b3807dc15ee$var$visualViewport) window.addEventListener('resize', onResize);\n        else $5df64b3807dc15ee$var$visualViewport.addEventListener('resize', onResize);\n        return ()=>{\n            if (!$5df64b3807dc15ee$var$visualViewport) window.removeEventListener('resize', onResize);\n            else $5df64b3807dc15ee$var$visualViewport.removeEventListener('resize', onResize);\n        };\n    }, []);\n    return size1;\n}\nfunction $5df64b3807dc15ee$var$getViewportSize() {\n    return {\n        width: ($5df64b3807dc15ee$var$visualViewport === null || $5df64b3807dc15ee$var$visualViewport === void 0 ? void 0 : $5df64b3807dc15ee$var$visualViewport.width) || window.innerWidth,\n        height: ($5df64b3807dc15ee$var$visualViewport === null || $5df64b3807dc15ee$var$visualViewport === void 0 ? void 0 : $5df64b3807dc15ee$var$visualViewport.height) || window.innerHeight\n    };\n}\n\n\n\n\nlet $ef06256079686ba0$var$descriptionId = 0;\nconst $ef06256079686ba0$var$descriptionNodes = new Map();\nfunction $ef06256079686ba0$export$f8aeda7b10753fa1(description) {\n    let [id1, setId] = $12uGp$useState(null);\n    $f0a04ccd8dbdd83b$export$e5c5a5f917a5871c(()=>{\n        if (!description) return;\n        let desc = $ef06256079686ba0$var$descriptionNodes.get(description);\n        if (!desc) {\n            let id = `react-aria-description-${$ef06256079686ba0$var$descriptionId++}`;\n            setId(id);\n            let node = document.createElement('div');\n            node.id = id;\n            node.style.display = 'none';\n            node.textContent = description;\n            document.body.appendChild(node);\n            desc = {\n                refCount: 0,\n                element: node\n            };\n            $ef06256079686ba0$var$descriptionNodes.set(description, desc);\n        } else setId(desc.element.id);\n        desc.refCount++;\n        return ()=>{\n            if (--desc.refCount === 0) {\n                desc.element.remove();\n                $ef06256079686ba0$var$descriptionNodes.delete(description);\n            }\n        };\n    }, [\n        description\n    ]);\n    return {\n        'aria-describedby': description ? id1 : undefined\n    };\n}\n\n\n/*\n * Copyright 2020 Adobe. All rights reserved.\n * This file is licensed to you under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License. You may obtain a copy\n * of the License at http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software distributed under\n * the License is distributed on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR REPRESENTATIONS\n * OF ANY KIND, either express or implied. See the License for the specific language\n * governing permissions and limitations under the License.\n */ function $c87311424ea30a05$var$testUserAgent(re) {\n    var ref;\n    if (typeof window === 'undefined' || window.navigator == null) return false;\n    return ((ref = window.navigator['userAgentData']) === null || ref === void 0 ? void 0 : ref.brands.some((brand)=>re.test(brand.brand)\n    )) || re.test(window.navigator.userAgent);\n}\nfunction $c87311424ea30a05$var$testPlatform(re) {\n    var ref;\n    return typeof window !== 'undefined' && window.navigator != null ? re.test(((ref = window.navigator['userAgentData']) === null || ref === void 0 ? void 0 : ref.platform) || window.navigator.platform) : false;\n}\nfunction $c87311424ea30a05$export$9ac100e40613ea10() {\n    return $c87311424ea30a05$var$testPlatform(/^Mac/i);\n}\nfunction $c87311424ea30a05$export$186c6964ca17d99() {\n    return $c87311424ea30a05$var$testPlatform(/^iPhone/i);\n}\nfunction $c87311424ea30a05$export$7bef049ce92e4224() {\n    return $c87311424ea30a05$var$testPlatform(/^iPad/i) || $c87311424ea30a05$export$9ac100e40613ea10() && navigator.maxTouchPoints > 1;\n}\nfunction $c87311424ea30a05$export$fedb369cb70207f1() {\n    return $c87311424ea30a05$export$186c6964ca17d99() || $c87311424ea30a05$export$7bef049ce92e4224();\n}\nfunction $c87311424ea30a05$export$e1865c3bedcd822b() {\n    return $c87311424ea30a05$export$9ac100e40613ea10() || $c87311424ea30a05$export$fedb369cb70207f1();\n}\nfunction $c87311424ea30a05$export$78551043582a6a98() {\n    return $c87311424ea30a05$var$testUserAgent(/AppleWebKit/i) && !$c87311424ea30a05$export$6446a186d09e379e();\n}\nfunction $c87311424ea30a05$export$6446a186d09e379e() {\n    return $c87311424ea30a05$var$testUserAgent(/Chrome/i);\n}\nfunction $c87311424ea30a05$export$a11b0059900ceec8() {\n    return $c87311424ea30a05$var$testUserAgent(/Android/i);\n}\n\n\n\nfunction $e9faafb641e167db$export$90fc3a17d93f704c(ref, event, handler1, options) {\n    let handlerRef = $12uGp$useRef(handler1);\n    handlerRef.current = handler1;\n    let isDisabled = handler1 == null;\n    $12uGp$useEffect(()=>{\n        if (isDisabled) return;\n        let element = ref.current;\n        let handler = (e)=>handlerRef.current.call(this, e)\n        ;\n        element.addEventListener(event, handler, options);\n        return ()=>{\n            element.removeEventListener(event, handler, options);\n        };\n    }, [\n        ref,\n        event,\n        options,\n        isDisabled\n    ]);\n}\n\n\n\n\nfunction $1dbecbe27a04f9af$export$14d238f342723f25(defaultValue) {\n    let [value, setValue] = $12uGp$useState(defaultValue);\n    let valueRef = $12uGp$useRef(value);\n    let effect = $12uGp$useRef(null);\n    valueRef.current = value;\n    // Store the function in a ref so we can always access the current version\n    // which has the proper `value` in scope.\n    let nextRef = $12uGp$useRef(null);\n    nextRef.current = ()=>{\n        // Run the generator to the next yield.\n        let newValue = effect.current.next();\n        // If the generator is done, reset the effect.\n        if (newValue.done) {\n            effect.current = null;\n            return;\n        }\n        // If the value is the same as the current value,\n        // then continue to the next yield. Otherwise,\n        // set the value in state and wait for the next layout effect.\n        if (value === newValue.value) nextRef.current();\n        else setValue(newValue.value);\n    };\n    $f0a04ccd8dbdd83b$export$e5c5a5f917a5871c(()=>{\n        // If there is an effect currently running, continue to the next yield.\n        if (effect.current) nextRef.current();\n    });\n    let queue = $12uGp$useCallback((fn)=>{\n        effect.current = fn(valueRef.current);\n        nextRef.current();\n    }, [\n        effect,\n        nextRef\n    ]);\n    return [\n        value,\n        queue\n    ];\n}\n\n\nfunction $2f04cbc44ee30ce0$export$53a0910f038337bd(scrollView, element) {\n    let offsetX = $2f04cbc44ee30ce0$var$relativeOffset(scrollView, element, 'left');\n    let offsetY = $2f04cbc44ee30ce0$var$relativeOffset(scrollView, element, 'top');\n    let width = element.offsetWidth;\n    let height = element.offsetHeight;\n    let x = scrollView.scrollLeft;\n    let y = scrollView.scrollTop;\n    let maxX = x + scrollView.offsetWidth;\n    let maxY = y + scrollView.offsetHeight;\n    if (offsetX <= x) x = offsetX;\n    else if (offsetX + width > maxX) x += offsetX + width - maxX;\n    if (offsetY <= y) y = offsetY;\n    else if (offsetY + height > maxY) y += offsetY + height - maxY;\n    scrollView.scrollLeft = x;\n    scrollView.scrollTop = y;\n}\n/**\n * Computes the offset left or top from child to ancestor by accumulating\n * offsetLeft or offsetTop through intervening offsetParents.\n */ function $2f04cbc44ee30ce0$var$relativeOffset(ancestor, child, axis) {\n    const prop = axis === 'left' ? 'offsetLeft' : 'offsetTop';\n    let sum = 0;\n    while(child.offsetParent){\n        sum += child[prop];\n        if (child.offsetParent === ancestor) break;\n        else if (child.offsetParent.contains(ancestor)) {\n            // If the ancestor is not `position:relative`, then we stop at\n            // _its_ offset parent, and we subtract off _its_ offset, so that\n            // we end up with the proper offset from child to ancestor.\n            sum -= ancestor[prop];\n            break;\n        }\n        child = child.offsetParent;\n    }\n    return sum;\n}\n\n\n\n\n\nexport {$bdb11010cef70236$export$f680877a34711e37 as useId, $bdb11010cef70236$export$cd8c9cb68f842629 as mergeIds, $bdb11010cef70236$export$b4cc09c592e8fdb8 as useSlotId, $ff5963eb1fccf552$export$e08e3b67e392101e as chain, $3ef42575df84b30b$export$9d1611c77c2fe928 as mergeProps, $5dc95899b306f630$export$c9058316764c140e as mergeRefs, $65484d02dcb7eb3e$export$457c3d6518dd4c6f as filterDOMProps, $7215afc6de606d6b$export$de79e2c695e052f3 as focusWithoutScrolling, $ab71dadb03a6fb2e$export$622cea445a1c5b7d as getOffset, $bbed8b41f857bcc0$export$24490316f764c430 as runAfterTransition, $9cc09df9fd7676be$export$7bbed75feba39706 as useDrag1D, $03deb23ff14920c4$export$4eaf04e54aa8eed6 as useGlobalListeners, $313b98861ee5dd6c$export$d6875122194c7b44 as useLabels, $df56164dff5785e2$export$4338b53315abf666 as useObjectRef, $4f58c5f72bcf79f7$export$496315a1608d9602 as useUpdateEffect, $f0a04ccd8dbdd83b$export$e5c5a5f917a5871c as useLayoutEffect, $9daab02d461809db$export$683480f191c0e3ea as useResizeObserver, $e7801be82b4b2a53$export$4debdb1a3f0fa79e as useSyncRef, $62d8ded9296f3872$export$cfa2225e87938781 as getScrollParent, $5df64b3807dc15ee$export$d699905dd57c73ca as useViewportSize, $ef06256079686ba0$export$f8aeda7b10753fa1 as useDescription, $c87311424ea30a05$export$9ac100e40613ea10 as isMac, $c87311424ea30a05$export$186c6964ca17d99 as isIPhone, $c87311424ea30a05$export$7bef049ce92e4224 as isIPad, $c87311424ea30a05$export$fedb369cb70207f1 as isIOS, $c87311424ea30a05$export$e1865c3bedcd822b as isAppleDevice, $c87311424ea30a05$export$78551043582a6a98 as isWebKit, $c87311424ea30a05$export$6446a186d09e379e as isChrome, $c87311424ea30a05$export$a11b0059900ceec8 as isAndroid, $e9faafb641e167db$export$90fc3a17d93f704c as useEvent, $1dbecbe27a04f9af$export$14d238f342723f25 as useValueEffect, $2f04cbc44ee30ce0$export$53a0910f038337bd as scrollIntoView, $4507461a1b870123$re_export$clamp as clamp, $4507461a1b870123$re_export$snapValueToStep as snapValueToStep};\n//# sourceMappingURL=module.js.map\n","export default {}","/* build: `node build.js modules=ALL exclude=gestures,accessors,erasing requirejs minifier=uglifyjs` */\n/*! Fabric.js Copyright 2008-2015, Printio (Juriy Zaytsev, Maxim Chernyak) */\n\nvar fabric = fabric || { version: '5.2.4' };\nif (typeof exports !== 'undefined') {\n  exports.fabric = fabric;\n}\n/* _AMD_START_ */\nelse if (typeof define === 'function' && define.amd) {\n  define([], function() { return fabric; });\n}\n/* _AMD_END_ */\nif (typeof document !== 'undefined' && typeof window !== 'undefined') {\n  if (document instanceof (typeof HTMLDocument !== 'undefined' ? HTMLDocument : Document)) {\n    fabric.document = document;\n  }\n  else {\n    fabric.document = document.implementation.createHTMLDocument('');\n  }\n  fabric.window = window;\n}\nelse {\n  // assume we're running under node.js when document/window are not present\n  var jsdom = require('jsdom');\n  var virtualWindow = new jsdom.JSDOM(\n    decodeURIComponent('%3C!DOCTYPE%20html%3E%3Chtml%3E%3Chead%3E%3C%2Fhead%3E%3Cbody%3E%3C%2Fbody%3E%3C%2Fhtml%3E'),\n    {\n      features: {\n        FetchExternalResources: ['img']\n      },\n      resources: 'usable'\n    }).window;\n  fabric.document = virtualWindow.document;\n  fabric.jsdomImplForWrapper = require('jsdom/lib/jsdom/living/generated/utils').implForWrapper;\n  fabric.nodeCanvas = require('jsdom/lib/jsdom/utils').Canvas;\n  fabric.window = virtualWindow;\n  DOMParser = fabric.window.DOMParser;\n}\n\n/**\n * True when in environment that supports touch events\n * @type boolean\n */\nfabric.isTouchSupported = 'ontouchstart' in fabric.window || 'ontouchstart' in fabric.document ||\n  (fabric.window && fabric.window.navigator && fabric.window.navigator.maxTouchPoints > 0);\n\n/**\n * True when in environment that's probably Node.js\n * @type boolean\n */\nfabric.isLikelyNode = typeof Buffer !== 'undefined' &&\n                      typeof window === 'undefined';\n\n/* _FROM_SVG_START_ */\n/**\n * Attributes parsed from all SVG elements\n * @type array\n */\nfabric.SHARED_ATTRIBUTES = [\n  'display',\n  'transform',\n  'fill', 'fill-opacity', 'fill-rule',\n  'opacity',\n  'stroke', 'stroke-dasharray', 'stroke-linecap', 'stroke-dashoffset',\n  'stroke-linejoin', 'stroke-miterlimit',\n  'stroke-opacity', 'stroke-width',\n  'id', 'paint-order', 'vector-effect',\n  'instantiated_by_use', 'clip-path',\n];\n/* _FROM_SVG_END_ */\n\n/**\n * Pixel per Inch as a default value set to 96. Can be changed for more realistic conversion.\n */\nfabric.DPI = 96;\nfabric.reNum = '(?:[-+]?(?:\\\\d+|\\\\d*\\\\.\\\\d+)(?:[eE][-+]?\\\\d+)?)';\nfabric.commaWsp = '(?:\\\\s+,?\\\\s*|,\\\\s*)';\nfabric.rePathCommand = /([-+]?((\\d+\\.\\d+)|((\\d+)|(\\.\\d+)))(?:[eE][-+]?\\d+)?)/ig;\nfabric.reNonWord = /[ \\n\\.,;!\\?\\-]/;\nfabric.fontPaths = { };\nfabric.iMatrix = [1, 0, 0, 1, 0, 0];\nfabric.svgNS = 'http://www.w3.org/2000/svg';\n\n/**\n * Pixel limit for cache canvases. 1Mpx , 4Mpx should be fine.\n * @since 1.7.14\n * @type Number\n * @default\n */\nfabric.perfLimitSizeTotal = 2097152;\n\n/**\n * Pixel limit for cache canvases width or height. IE fixes the maximum at 5000\n * @since 1.7.14\n * @type Number\n * @default\n */\nfabric.maxCacheSideLimit = 4096;\n\n/**\n * Lowest pixel limit for cache canvases, set at 256PX\n * @since 1.7.14\n * @type Number\n * @default\n */\nfabric.minCacheSideLimit = 256;\n\n/**\n * Cache Object for widths of chars in text rendering.\n */\nfabric.charWidthsCache = { };\n\n/**\n * if webgl is enabled and available, textureSize will determine the size\n * of the canvas backend\n * @since 2.0.0\n * @type Number\n * @default\n */\nfabric.textureSize = 2048;\n\n/**\n * When 'true', style information is not retained when copy/pasting text, making\n * pasted text use destination style.\n * Defaults to 'false'.\n * @type Boolean\n * @default\n */\nfabric.disableStyleCopyPaste = false;\n\n/**\n * Enable webgl for filtering picture is available\n * A filtering backend will be initialized, this will both take memory and\n * time since a default 2048x2048 canvas will be created for the gl context\n * @since 2.0.0\n * @type Boolean\n * @default\n */\nfabric.enableGLFiltering = true;\n\n/**\n * Device Pixel Ratio\n * @see https://developer.apple.com/library/safari/documentation/AudioVideo/Conceptual/HTML-canvas-guide/SettingUptheCanvas/SettingUptheCanvas.html\n */\nfabric.devicePixelRatio = fabric.window.devicePixelRatio ||\n                          fabric.window.webkitDevicePixelRatio ||\n                          fabric.window.mozDevicePixelRatio ||\n                          1;\n/**\n * Browser-specific constant to adjust CanvasRenderingContext2D.shadowBlur value,\n * which is unitless and not rendered equally across browsers.\n *\n * Values that work quite well (as of October 2017) are:\n * - Chrome: 1.5\n * - Edge: 1.75\n * - Firefox: 0.9\n * - Safari: 0.95\n *\n * @since 2.0.0\n * @type Number\n * @default 1\n */\nfabric.browserShadowBlurConstant = 1;\n\n/**\n * This object contains the result of arc to bezier conversion for faster retrieving if the same arc needs to be converted again.\n * It was an internal variable, is accessible since version 2.3.4\n */\nfabric.arcToSegmentsCache = { };\n\n/**\n * This object keeps the results of the boundsOfCurve calculation mapped by the joined arguments necessary to calculate it.\n * It does speed up calculation, if you parse and add always the same paths, but in case of heavy usage of freedrawing\n * you do not get any speed benefit and you get a big object in memory.\n * The object was a private variable before, while now is appended to the lib so that you have access to it and you\n * can eventually clear it.\n * It was an internal variable, is accessible since version 2.3.4\n */\nfabric.boundsOfCurveCache = { };\n\n/**\n * If disabled boundsOfCurveCache is not used. For apps that make heavy usage of pencil drawing probably disabling it is better\n * @default true\n */\nfabric.cachesBoundsOfCurve = true;\n\n/**\n * Skip performance testing of setupGLContext and force the use of putImageData that seems to be the one that works best on\n * Chrome + old hardware. if your users are experiencing empty images after filtering you may try to force this to true\n * this has to be set before instantiating the filtering backend ( before filtering the first image )\n * @type Boolean\n * @default false\n */\nfabric.forceGLPutImageData = false;\n\nfabric.initFilterBackend = function() {\n  if (fabric.enableGLFiltering && fabric.isWebglSupported && fabric.isWebglSupported(fabric.textureSize)) {\n    console.log('max texture size: ' + fabric.maxTextureSize);\n    return (new fabric.WebglFilterBackend({ tileSize: fabric.textureSize }));\n  }\n  else if (fabric.Canvas2dFilterBackend) {\n    return (new fabric.Canvas2dFilterBackend());\n  }\n};\n\n\nif (typeof document !== 'undefined' && typeof window !== 'undefined') {\n  // ensure globality even if entire library were function wrapped (as in Meteor.js packaging system)\n  window.fabric = fabric;\n}\n\n\n(function() {\n\n  /**\n   * @private\n   * @param {String} eventName\n   * @param {Function} handler\n   */\n  function _removeEventListener(eventName, handler) {\n    if (!this.__eventListeners[eventName]) {\n      return;\n    }\n    var eventListener = this.__eventListeners[eventName];\n    if (handler) {\n      eventListener[eventListener.indexOf(handler)] = false;\n    }\n    else {\n      fabric.util.array.fill(eventListener, false);\n    }\n  }\n\n  /**\n   * Observes specified event\n   * @memberOf fabric.Observable\n   * @alias on\n   * @param {String|Object} eventName Event name (eg. 'after:render') or object with key/value pairs (eg. {'after:render': handler, 'selection:cleared': handler})\n   * @param {Function} handler Function that receives a notification when an event of the specified type occurs\n   * @return {Self} thisArg\n   * @chainable\n   */\n  function on(eventName, handler) {\n    if (!this.__eventListeners) {\n      this.__eventListeners = { };\n    }\n    // one object with key/value pairs was passed\n    if (arguments.length === 1) {\n      for (var prop in eventName) {\n        this.on(prop, eventName[prop]);\n      }\n    }\n    else {\n      if (!this.__eventListeners[eventName]) {\n        this.__eventListeners[eventName] = [];\n      }\n      this.__eventListeners[eventName].push(handler);\n    }\n    return this;\n  }\n\n  function _once(eventName, handler) {\n    var _handler = function () {\n      handler.apply(this, arguments);\n      this.off(eventName, _handler);\n    }.bind(this);\n    this.on(eventName, _handler);\n  }\n\n  function once(eventName, handler) {\n    // one object with key/value pairs was passed\n    if (arguments.length === 1) {\n      for (var prop in eventName) {\n        _once.call(this, prop, eventName[prop]);\n      }\n    }\n    else {\n      _once.call(this, eventName, handler);\n    }\n    return this;\n  }\n\n  /**\n   * Stops event observing for a particular event handler. Calling this method\n   * without arguments removes all handlers for all events\n   * @memberOf fabric.Observable\n   * @alias off\n   * @param {String|Object} eventName Event name (eg. 'after:render') or object with key/value pairs (eg. {'after:render': handler, 'selection:cleared': handler})\n   * @param {Function} handler Function to be deleted from EventListeners\n   * @return {Self} thisArg\n   * @chainable\n   */\n  function off(eventName, handler) {\n    if (!this.__eventListeners) {\n      return this;\n    }\n\n    // remove all key/value pairs (event name -> event handler)\n    if (arguments.length === 0) {\n      for (eventName in this.__eventListeners) {\n        _removeEventListener.call(this, eventName);\n      }\n    }\n    // one object with key/value pairs was passed\n    else if (arguments.length === 1 && typeof arguments[0] === 'object') {\n      for (var prop in eventName) {\n        _removeEventListener.call(this, prop, eventName[prop]);\n      }\n    }\n    else {\n      _removeEventListener.call(this, eventName, handler);\n    }\n    return this;\n  }\n\n  /**\n   * Fires event with an optional options object\n   * @memberOf fabric.Observable\n   * @param {String} eventName Event name to fire\n   * @param {Object} [options] Options object\n   * @return {Self} thisArg\n   * @chainable\n   */\n  function fire(eventName, options) {\n    if (!this.__eventListeners) {\n      return this;\n    }\n\n    var listenersForEvent = this.__eventListeners[eventName];\n    if (!listenersForEvent) {\n      return this;\n    }\n\n    for (var i = 0, len = listenersForEvent.length; i < len; i++) {\n      listenersForEvent[i] && listenersForEvent[i].call(this, options || { });\n    }\n    this.__eventListeners[eventName] = listenersForEvent.filter(function(value) {\n      return value !== false;\n    });\n    return this;\n  }\n\n  /**\n   * @namespace fabric.Observable\n   * @tutorial {@link http://fabricjs.com/fabric-intro-part-2#events}\n   * @see {@link http://fabricjs.com/events|Events demo}\n   */\n  fabric.Observable = {\n    fire: fire,\n    on: on,\n    once: once,\n    off: off,\n  };\n})();\n\n\n/**\n * @namespace fabric.Collection\n */\nfabric.Collection = {\n\n  _objects: [],\n\n  /**\n   * Adds objects to collection, Canvas or Group, then renders canvas\n   * (if `renderOnAddRemove` is not `false`).\n   * in case of Group no changes to bounding box are made.\n   * Objects should be instances of (or inherit from) fabric.Object\n   * Use of this function is highly discouraged for groups.\n   * you can add a bunch of objects with the add method but then you NEED\n   * to run a addWithUpdate call for the Group class or position/bbox will be wrong.\n   * @param {...fabric.Object} object Zero or more fabric instances\n   * @return {Self} thisArg\n   * @chainable\n   */\n  add: function () {\n    this._objects.push.apply(this._objects, arguments);\n    if (this._onObjectAdded) {\n      for (var i = 0, length = arguments.length; i < length; i++) {\n        this._onObjectAdded(arguments[i]);\n      }\n    }\n    this.renderOnAddRemove && this.requestRenderAll();\n    return this;\n  },\n\n  /**\n   * Inserts an object into collection at specified index, then renders canvas (if `renderOnAddRemove` is not `false`)\n   * An object should be an instance of (or inherit from) fabric.Object\n   * Use of this function is highly discouraged for groups.\n   * you can add a bunch of objects with the insertAt method but then you NEED\n   * to run a addWithUpdate call for the Group class or position/bbox will be wrong.\n   * @param {Object} object Object to insert\n   * @param {Number} index Index to insert object at\n   * @param {Boolean} nonSplicing When `true`, no splicing (shifting) of objects occurs\n   * @return {Self} thisArg\n   * @chainable\n   */\n  insertAt: function (object, index, nonSplicing) {\n    var objects = this._objects;\n    if (nonSplicing) {\n      objects[index] = object;\n    }\n    else {\n      objects.splice(index, 0, object);\n    }\n    this._onObjectAdded && this._onObjectAdded(object);\n    this.renderOnAddRemove && this.requestRenderAll();\n    return this;\n  },\n\n  /**\n   * Removes objects from a collection, then renders canvas (if `renderOnAddRemove` is not `false`)\n   * @param {...fabric.Object} object Zero or more fabric instances\n   * @return {Self} thisArg\n   * @chainable\n   */\n  remove: function() {\n    var objects = this._objects,\n        index, somethingRemoved = false;\n\n    for (var i = 0, length = arguments.length; i < length; i++) {\n      index = objects.indexOf(arguments[i]);\n\n      // only call onObjectRemoved if an object was actually removed\n      if (index !== -1) {\n        somethingRemoved = true;\n        objects.splice(index, 1);\n        this._onObjectRemoved && this._onObjectRemoved(arguments[i]);\n      }\n    }\n\n    this.renderOnAddRemove && somethingRemoved && this.requestRenderAll();\n    return this;\n  },\n\n  /**\n   * Executes given function for each object in this group\n   * @param {Function} callback\n   *                   Callback invoked with current object as first argument,\n   *                   index - as second and an array of all objects - as third.\n   *                   Callback is invoked in a context of Global Object (e.g. `window`)\n   *                   when no `context` argument is given\n   *\n   * @param {Object} context Context (aka thisObject)\n   * @return {Self} thisArg\n   * @chainable\n   */\n  forEachObject: function(callback, context) {\n    var objects = this.getObjects();\n    for (var i = 0, len = objects.length; i < len; i++) {\n      callback.call(context, objects[i], i, objects);\n    }\n    return this;\n  },\n\n  /**\n   * Returns an array of children objects of this instance\n   * Type parameter introduced in 1.3.10\n   * since 2.3.5 this method return always a COPY of the array;\n   * @param {String} [type] When specified, only objects of this type are returned\n   * @return {Array}\n   */\n  getObjects: function(type) {\n    if (typeof type === 'undefined') {\n      return this._objects.concat();\n    }\n    return this._objects.filter(function(o) {\n      return o.type === type;\n    });\n  },\n\n  /**\n   * Returns object at specified index\n   * @param {Number} index\n   * @return {Self} thisArg\n   */\n  item: function (index) {\n    return this._objects[index];\n  },\n\n  /**\n   * Returns true if collection contains no objects\n   * @return {Boolean} true if collection is empty\n   */\n  isEmpty: function () {\n    return this._objects.length === 0;\n  },\n\n  /**\n   * Returns a size of a collection (i.e: length of an array containing its objects)\n   * @return {Number} Collection size\n   */\n  size: function() {\n    return this._objects.length;\n  },\n\n  /**\n   * Returns true if collection contains an object\n   * @param {Object} object Object to check against\n   * @param {Boolean} [deep=false] `true` to check all descendants, `false` to check only `_objects`\n   * @return {Boolean} `true` if collection contains an object\n   */\n  contains: function (object, deep) {\n    if (this._objects.indexOf(object) > -1) {\n      return true;\n    }\n    else if (deep) {\n      return this._objects.some(function (obj) {\n        return typeof obj.contains === 'function' && obj.contains(object, true);\n      });\n    }\n    return false;\n  },\n\n  /**\n   * Returns number representation of a collection complexity\n   * @return {Number} complexity\n   */\n  complexity: function () {\n    return this._objects.reduce(function (memo, current) {\n      memo += current.complexity ? current.complexity() : 0;\n      return memo;\n    }, 0);\n  }\n};\n\n\n/**\n * @namespace fabric.CommonMethods\n */\nfabric.CommonMethods = {\n\n  /**\n   * Sets object's properties from options\n   * @param {Object} [options] Options object\n   */\n  _setOptions: function(options) {\n    for (var prop in options) {\n      this.set(prop, options[prop]);\n    }\n  },\n\n  /**\n   * @private\n   * @param {Object} [filler] Options object\n   * @param {String} [property] property to set the Gradient to\n   */\n  _initGradient: function(filler, property) {\n    if (filler && filler.colorStops && !(filler instanceof fabric.Gradient)) {\n      this.set(property, new fabric.Gradient(filler));\n    }\n  },\n\n  /**\n   * @private\n   * @param {Object} [filler] Options object\n   * @param {String} [property] property to set the Pattern to\n   * @param {Function} [callback] callback to invoke after pattern load\n   */\n  _initPattern: function(filler, property, callback) {\n    if (filler && filler.source && !(filler instanceof fabric.Pattern)) {\n      this.set(property, new fabric.Pattern(filler, callback));\n    }\n    else {\n      callback && callback();\n    }\n  },\n\n  /**\n   * @private\n   */\n  _setObject: function(obj) {\n    for (var prop in obj) {\n      this._set(prop, obj[prop]);\n    }\n  },\n\n  /**\n   * Sets property to a given value. When changing position/dimension -related properties (left, top, scale, angle, etc.) `set` does not update position of object's borders/controls. If you need to update those, call `setCoords()`.\n   * @param {String|Object} key Property name or object (if object, iterate over the object properties)\n   * @param {Object|Function} value Property value (if function, the value is passed into it and its return value is used as a new one)\n   * @return {fabric.Object} thisArg\n   * @chainable\n   */\n  set: function(key, value) {\n    if (typeof key === 'object') {\n      this._setObject(key);\n    }\n    else {\n      this._set(key, value);\n    }\n    return this;\n  },\n\n  _set: function(key, value) {\n    this[key] = value;\n  },\n\n  /**\n   * Toggles specified property from `true` to `false` or from `false` to `true`\n   * @param {String} property Property to toggle\n   * @return {fabric.Object} thisArg\n   * @chainable\n   */\n  toggle: function(property) {\n    var value = this.get(property);\n    if (typeof value === 'boolean') {\n      this.set(property, !value);\n    }\n    return this;\n  },\n\n  /**\n   * Basic getter\n   * @param {String} property Property name\n   * @return {*} value of a property\n   */\n  get: function(property) {\n    return this[property];\n  }\n};\n\n\n(function(global) {\n\n  var sqrt = Math.sqrt,\n      atan2 = Math.atan2,\n      pow = Math.pow,\n      PiBy180 = Math.PI / 180,\n      PiBy2 = Math.PI / 2;\n\n  /**\n   * @namespace fabric.util\n   */\n  fabric.util = {\n\n    /**\n     * Calculate the cos of an angle, avoiding returning floats for known results\n     * @static\n     * @memberOf fabric.util\n     * @param {Number} angle the angle in radians or in degree\n     * @return {Number}\n     */\n    cos: function(angle) {\n      if (angle === 0) { return 1; }\n      if (angle < 0) {\n        // cos(a) = cos(-a)\n        angle = -angle;\n      }\n      var angleSlice = angle / PiBy2;\n      switch (angleSlice) {\n        case 1: case 3: return 0;\n        case 2: return -1;\n      }\n      return Math.cos(angle);\n    },\n\n    /**\n     * Calculate the sin of an angle, avoiding returning floats for known results\n     * @static\n     * @memberOf fabric.util\n     * @param {Number} angle the angle in radians or in degree\n     * @return {Number}\n     */\n    sin: function(angle) {\n      if (angle === 0) { return 0; }\n      var angleSlice = angle / PiBy2, sign = 1;\n      if (angle < 0) {\n        // sin(-a) = -sin(a)\n        sign = -1;\n      }\n      switch (angleSlice) {\n        case 1: return sign;\n        case 2: return 0;\n        case 3: return -sign;\n      }\n      return Math.sin(angle);\n    },\n\n    /**\n     * Removes value from an array.\n     * Presence of value (and its position in an array) is determined via `Array.prototype.indexOf`\n     * @static\n     * @memberOf fabric.util\n     * @param {Array} array\n     * @param {*} value\n     * @return {Array} original array\n     */\n    removeFromArray: function(array, value) {\n      var idx = array.indexOf(value);\n      if (idx !== -1) {\n        array.splice(idx, 1);\n      }\n      return array;\n    },\n\n    /**\n     * Returns random number between 2 specified ones.\n     * @static\n     * @memberOf fabric.util\n     * @param {Number} min lower limit\n     * @param {Number} max upper limit\n     * @return {Number} random value (between min and max)\n     */\n    getRandomInt: function(min, max) {\n      return Math.floor(Math.random() * (max - min + 1)) + min;\n    },\n\n    /**\n     * Transforms degrees to radians.\n     * @static\n     * @memberOf fabric.util\n     * @param {Number} degrees value in degrees\n     * @return {Number} value in radians\n     */\n    degreesToRadians: function(degrees) {\n      return degrees * PiBy180;\n    },\n\n    /**\n     * Transforms radians to degrees.\n     * @static\n     * @memberOf fabric.util\n     * @param {Number} radians value in radians\n     * @return {Number} value in degrees\n     */\n    radiansToDegrees: function(radians) {\n      return radians / PiBy180;\n    },\n\n    /**\n     * Rotates `point` around `origin` with `radians`\n     * @static\n     * @memberOf fabric.util\n     * @param {fabric.Point} point The point to rotate\n     * @param {fabric.Point} origin The origin of the rotation\n     * @param {Number} radians The radians of the angle for the rotation\n     * @return {fabric.Point} The new rotated point\n     */\n    rotatePoint: function(point, origin, radians) {\n      var newPoint = new fabric.Point(point.x - origin.x, point.y - origin.y),\n          v = fabric.util.rotateVector(newPoint, radians);\n      return new fabric.Point(v.x, v.y).addEquals(origin);\n    },\n\n    /**\n     * Rotates `vector` with `radians`\n     * @static\n     * @memberOf fabric.util\n     * @param {Object} vector The vector to rotate (x and y)\n     * @param {Number} radians The radians of the angle for the rotation\n     * @return {Object} The new rotated point\n     */\n    rotateVector: function(vector, radians) {\n      var sin = fabric.util.sin(radians),\n          cos = fabric.util.cos(radians),\n          rx = vector.x * cos - vector.y * sin,\n          ry = vector.x * sin + vector.y * cos;\n      return {\n        x: rx,\n        y: ry\n      };\n    },\n\n    /**\n     * Creates a vetor from points represented as a point\n     * @static\n     * @memberOf fabric.util\n     *\n     * @typedef {Object} Point\n     * @property {number} x\n     * @property {number} y\n     *\n     * @param {Point} from\n     * @param {Point} to\n     * @returns {Point} vector\n     */\n    createVector: function (from, to) {\n      return new fabric.Point(to.x - from.x, to.y - from.y);\n    },\n\n    /**\n     * Calculates angle between 2 vectors using dot product\n     * @static\n     * @memberOf fabric.util\n     * @param {Point} a\n     * @param {Point} b\n     * @returns the angle in radian between the vectors\n     */\n    calcAngleBetweenVectors: function (a, b) {\n      return Math.acos((a.x * b.x + a.y * b.y) / (Math.hypot(a.x, a.y) * Math.hypot(b.x, b.y)));\n    },\n\n    /**\n     * @static\n     * @memberOf fabric.util\n     * @param {Point} v\n     * @returns {Point} vector representing the unit vector of pointing to the direction of `v`\n     */\n    getHatVector: function (v) {\n      return new fabric.Point(v.x, v.y).multiply(1 / Math.hypot(v.x, v.y));\n    },\n\n    /**\n     * @static\n     * @memberOf fabric.util\n     * @param {Point} A\n     * @param {Point} B\n     * @param {Point} C\n     * @returns {{ vector: Point, angle: number }} vector representing the bisector of A and A's angle\n     */\n    getBisector: function (A, B, C) {\n      var AB = fabric.util.createVector(A, B), AC = fabric.util.createVector(A, C);\n      var alpha = fabric.util.calcAngleBetweenVectors(AB, AC);\n      //  check if alpha is relative to AB->BC\n      var ro = fabric.util.calcAngleBetweenVectors(fabric.util.rotateVector(AB, alpha), AC);\n      var phi = alpha * (ro === 0 ? 1 : -1) / 2;\n      return {\n        vector: fabric.util.getHatVector(fabric.util.rotateVector(AB, phi)),\n        angle: alpha\n      };\n    },\n\n    /**\n     * Project stroke width on points returning 2 projections for each point as follows:\n     * - `miter`: 2 points corresponding to the outer boundary and the inner boundary of stroke.\n     * - `bevel`: 2 points corresponding to the bevel boundaries, tangent to the bisector.\n     * - `round`: same as `bevel`\n     * Used to calculate object's bounding box\n     * @static\n     * @memberOf fabric.util\n     * @param {Point[]} points\n     * @param {Object} options\n     * @param {number} options.strokeWidth\n     * @param {'miter'|'bevel'|'round'} options.strokeLineJoin\n     * @param {number} options.strokeMiterLimit https://developer.mozilla.org/en-US/docs/Web/SVG/Attribute/stroke-miterlimit\n     * @param {boolean} options.strokeUniform\n     * @param {number} options.scaleX\n     * @param {number} options.scaleY\n     * @param {boolean} [openPath] whether the shape is open or not, affects the calculations of the first and last points\n     * @returns {fabric.Point[]} array of size 2n/4n of all suspected points\n     */\n    projectStrokeOnPoints: function (points, options, openPath) {\n      var coords = [], s = options.strokeWidth / 2,\n          strokeUniformScalar = options.strokeUniform ?\n            new fabric.Point(1 / options.scaleX, 1 / options.scaleY) : new fabric.Point(1, 1),\n          getStrokeHatVector = function (v) {\n            var scalar = s / (Math.hypot(v.x, v.y));\n            return new fabric.Point(v.x * scalar * strokeUniformScalar.x, v.y * scalar * strokeUniformScalar.y);\n          };\n      if (points.length <= 1) {return coords;}\n      points.forEach(function (p, index) {\n        var A = new fabric.Point(p.x, p.y), B, C;\n        if (index === 0) {\n          C = points[index + 1];\n          B = openPath ? getStrokeHatVector(fabric.util.createVector(C, A)).addEquals(A) : points[points.length - 1];\n        }\n        else if (index === points.length - 1) {\n          B = points[index - 1];\n          C = openPath ? getStrokeHatVector(fabric.util.createVector(B, A)).addEquals(A) : points[0];\n        }\n        else {\n          B = points[index - 1];\n          C = points[index + 1];\n        }\n        var bisector = fabric.util.getBisector(A, B, C),\n            bisectorVector = bisector.vector,\n            alpha = bisector.angle,\n            scalar,\n            miterVector;\n        if (options.strokeLineJoin === 'miter') {\n          scalar = -s / Math.sin(alpha / 2);\n          miterVector = new fabric.Point(\n            bisectorVector.x * scalar * strokeUniformScalar.x,\n            bisectorVector.y * scalar * strokeUniformScalar.y\n          );\n          if (Math.hypot(miterVector.x, miterVector.y) / s <= options.strokeMiterLimit) {\n            coords.push(A.add(miterVector));\n            coords.push(A.subtract(miterVector));\n            return;\n          }\n        }\n        scalar = -s * Math.SQRT2;\n        miterVector = new fabric.Point(\n          bisectorVector.x * scalar * strokeUniformScalar.x,\n          bisectorVector.y * scalar * strokeUniformScalar.y\n        );\n        coords.push(A.add(miterVector));\n        coords.push(A.subtract(miterVector));\n      });\n      return coords;\n    },\n\n    /**\n     * Apply transform t to point p\n     * @static\n     * @memberOf fabric.util\n     * @param  {fabric.Point} p The point to transform\n     * @param  {Array} t The transform\n     * @param  {Boolean} [ignoreOffset] Indicates that the offset should not be applied\n     * @return {fabric.Point} The transformed point\n     */\n    transformPoint: function(p, t, ignoreOffset) {\n      if (ignoreOffset) {\n        return new fabric.Point(\n          t[0] * p.x + t[2] * p.y,\n          t[1] * p.x + t[3] * p.y\n        );\n      }\n      return new fabric.Point(\n        t[0] * p.x + t[2] * p.y + t[4],\n        t[1] * p.x + t[3] * p.y + t[5]\n      );\n    },\n\n    /**\n     * Returns coordinates of points's bounding rectangle (left, top, width, height)\n     * @param {Array} points 4 points array\n     * @param {Array} [transform] an array of 6 numbers representing a 2x3 transform matrix\n     * @return {Object} Object with left, top, width, height properties\n     */\n    makeBoundingBoxFromPoints: function(points, transform) {\n      if (transform) {\n        for (var i = 0; i < points.length; i++) {\n          points[i] = fabric.util.transformPoint(points[i], transform);\n        }\n      }\n      var xPoints = [points[0].x, points[1].x, points[2].x, points[3].x],\n          minX = fabric.util.array.min(xPoints),\n          maxX = fabric.util.array.max(xPoints),\n          width = maxX - minX,\n          yPoints = [points[0].y, points[1].y, points[2].y, points[3].y],\n          minY = fabric.util.array.min(yPoints),\n          maxY = fabric.util.array.max(yPoints),\n          height = maxY - minY;\n\n      return {\n        left: minX,\n        top: minY,\n        width: width,\n        height: height\n      };\n    },\n\n    /**\n     * Invert transformation t\n     * @static\n     * @memberOf fabric.util\n     * @param {Array} t The transform\n     * @return {Array} The inverted transform\n     */\n    invertTransform: function(t) {\n      var a = 1 / (t[0] * t[3] - t[1] * t[2]),\n          r = [a * t[3], -a * t[1], -a * t[2], a * t[0]],\n          o = fabric.util.transformPoint({ x: t[4], y: t[5] }, r, true);\n      r[4] = -o.x;\n      r[5] = -o.y;\n      return r;\n    },\n\n    /**\n     * A wrapper around Number#toFixed, which contrary to native method returns number, not string.\n     * @static\n     * @memberOf fabric.util\n     * @param {Number|String} number number to operate on\n     * @param {Number} fractionDigits number of fraction digits to \"leave\"\n     * @return {Number}\n     */\n    toFixed: function(number, fractionDigits) {\n      return parseFloat(Number(number).toFixed(fractionDigits));\n    },\n\n    /**\n     * Converts from attribute value to pixel value if applicable.\n     * Returns converted pixels or original value not converted.\n     * @param {Number|String} value number to operate on\n     * @param {Number} fontSize\n     * @return {Number|String}\n     */\n    parseUnit: function(value, fontSize) {\n      var unit = /\\D{0,2}$/.exec(value),\n          number = parseFloat(value);\n      if (!fontSize) {\n        fontSize = fabric.Text.DEFAULT_SVG_FONT_SIZE;\n      }\n      switch (unit[0]) {\n        case 'mm':\n          return number * fabric.DPI / 25.4;\n\n        case 'cm':\n          return number * fabric.DPI / 2.54;\n\n        case 'in':\n          return number * fabric.DPI;\n\n        case 'pt':\n          return number * fabric.DPI / 72; // or * 4 / 3\n\n        case 'pc':\n          return number * fabric.DPI / 72 * 12; // or * 16\n\n        case 'em':\n          return number * fontSize;\n\n        default:\n          return number;\n      }\n    },\n\n    /**\n     * Function which always returns `false`.\n     * @static\n     * @memberOf fabric.util\n     * @return {Boolean}\n     */\n    falseFunction: function() {\n      return false;\n    },\n\n    /**\n     * Returns klass \"Class\" object of given namespace\n     * @memberOf fabric.util\n     * @param {String} type Type of object (eg. 'circle')\n     * @param {String} namespace Namespace to get klass \"Class\" object from\n     * @return {Object} klass \"Class\"\n     */\n    getKlass: function(type, namespace) {\n      // capitalize first letter only\n      type = fabric.util.string.camelize(type.charAt(0).toUpperCase() + type.slice(1));\n      return fabric.util.resolveNamespace(namespace)[type];\n    },\n\n    /**\n     * Returns array of attributes for given svg that fabric parses\n     * @memberOf fabric.util\n     * @param {String} type Type of svg element (eg. 'circle')\n     * @return {Array} string names of supported attributes\n     */\n    getSvgAttributes: function(type) {\n      var attributes = [\n        'instantiated_by_use',\n        'style',\n        'id',\n        'class'\n      ];\n      switch (type) {\n        case 'linearGradient':\n          attributes = attributes.concat(['x1', 'y1', 'x2', 'y2', 'gradientUnits', 'gradientTransform']);\n          break;\n        case 'radialGradient':\n          attributes = attributes.concat(['gradientUnits', 'gradientTransform', 'cx', 'cy', 'r', 'fx', 'fy', 'fr']);\n          break;\n        case 'stop':\n          attributes = attributes.concat(['offset', 'stop-color', 'stop-opacity']);\n          break;\n      }\n      return attributes;\n    },\n\n    /**\n     * Returns object of given namespace\n     * @memberOf fabric.util\n     * @param {String} namespace Namespace string e.g. 'fabric.Image.filter' or 'fabric'\n     * @return {Object} Object for given namespace (default fabric)\n     */\n    resolveNamespace: function(namespace) {\n      if (!namespace) {\n        return fabric;\n      }\n\n      var parts = namespace.split('.'),\n          len = parts.length, i,\n          obj = global || fabric.window;\n\n      for (i = 0; i < len; ++i) {\n        obj = obj[parts[i]];\n      }\n\n      return obj;\n    },\n\n    /**\n     * Loads image element from given url and passes it to a callback\n     * @memberOf fabric.util\n     * @param {String} url URL representing an image\n     * @param {Function} callback Callback; invoked with loaded image\n     * @param {*} [context] Context to invoke callback in\n     * @param {Object} [crossOrigin] crossOrigin value to set image element to\n     */\n    loadImage: function(url, callback, context, crossOrigin) {\n      if (!url) {\n        callback && callback.call(context, url);\n        return;\n      }\n\n      var img = fabric.util.createImage();\n\n      /** @ignore */\n      var onLoadCallback = function () {\n        callback && callback.call(context, img, false);\n        img = img.onload = img.onerror = null;\n      };\n\n      img.onload = onLoadCallback;\n      /** @ignore */\n      img.onerror = function() {\n        fabric.log('Error loading ' + img.src);\n        callback && callback.call(context, null, true);\n        img = img.onload = img.onerror = null;\n      };\n\n      // data-urls appear to be buggy with crossOrigin\n      // https://github.com/kangax/fabric.js/commit/d0abb90f1cd5c5ef9d2a94d3fb21a22330da3e0a#commitcomment-4513767\n      // see https://code.google.com/p/chromium/issues/detail?id=315152\n      //     https://bugzilla.mozilla.org/show_bug.cgi?id=935069\n      // crossOrigin null is the same as not set.\n      if (url.indexOf('data') !== 0 &&\n        crossOrigin !== undefined &&\n        crossOrigin !== null) {\n        img.crossOrigin = crossOrigin;\n      }\n\n      // IE10 / IE11-Fix: SVG contents from data: URI\n      // will only be available if the IMG is present\n      // in the DOM (and visible)\n      if (url.substring(0,14) === 'data:image/svg') {\n        img.onload = null;\n        fabric.util.loadImageInDom(img, onLoadCallback);\n      }\n\n      img.src = url;\n    },\n\n    /**\n     * Attaches SVG image with data: URL to the dom\n     * @memberOf fabric.util\n     * @param {Object} img Image object with data:image/svg src\n     * @param {Function} callback Callback; invoked with loaded image\n     * @return {Object} DOM element (div containing the SVG image)\n     */\n    loadImageInDom: function(img, onLoadCallback) {\n      var div = fabric.document.createElement('div');\n      div.style.width = div.style.height = '1px';\n      div.style.left = div.style.top = '-100%';\n      div.style.position = 'absolute';\n      div.appendChild(img);\n      fabric.document.querySelector('body').appendChild(div);\n      /**\n       * Wrap in function to:\n       *   1. Call existing callback\n       *   2. Cleanup DOM\n       */\n      img.onload = function () {\n        onLoadCallback();\n        div.parentNode.removeChild(div);\n        div = null;\n      };\n    },\n\n    /**\n     * Creates corresponding fabric instances from their object representations\n     * @static\n     * @memberOf fabric.util\n     * @param {Array} objects Objects to enliven\n     * @param {Function} callback Callback to invoke when all objects are created\n     * @param {String} namespace Namespace to get klass \"Class\" object from\n     * @param {Function} reviver Method for further parsing of object elements,\n     * called after each fabric object created.\n     */\n    enlivenObjects: function(objects, callback, namespace, reviver) {\n      objects = objects || [];\n\n      var enlivenedObjects = [],\n          numLoadedObjects = 0,\n          numTotalObjects = objects.length;\n\n      function onLoaded() {\n        if (++numLoadedObjects === numTotalObjects) {\n          callback && callback(enlivenedObjects.filter(function(obj) {\n            // filter out undefined objects (objects that gave error)\n            return obj;\n          }));\n        }\n      }\n\n      if (!numTotalObjects) {\n        callback && callback(enlivenedObjects);\n        return;\n      }\n\n      objects.forEach(function (o, index) {\n        // if sparse array\n        if (!o || !o.type) {\n          onLoaded();\n          return;\n        }\n        var klass = fabric.util.getKlass(o.type, namespace);\n        klass.fromObject(o, function (obj, error) {\n          error || (enlivenedObjects[index] = obj);\n          reviver && reviver(o, obj, error);\n          onLoaded();\n        });\n      });\n    },\n\n    /**\n     * Creates corresponding fabric instances residing in an object, e.g. `clipPath`\n     * @see {@link fabric.Object.ENLIVEN_PROPS}\n     * @param {Object} object\n     * @param {Object} [context] assign enlived props to this object (pass null to skip this)\n     * @param {(objects:fabric.Object[]) => void} callback\n     */\n    enlivenObjectEnlivables: function (object, context, callback) {\n      var enlivenProps = fabric.Object.ENLIVEN_PROPS.filter(function (key) { return !!object[key]; });\n      fabric.util.enlivenObjects(enlivenProps.map(function (key) { return object[key]; }), function (enlivedProps) {\n        var objects = {};\n        enlivenProps.forEach(function (key, index) {\n          objects[key] = enlivedProps[index];\n          context && (context[key] = enlivedProps[index]);\n        });\n        callback && callback(objects);\n      });\n    },\n\n    /**\n     * Create and wait for loading of patterns\n     * @static\n     * @memberOf fabric.util\n     * @param {Array} patterns Objects to enliven\n     * @param {Function} callback Callback to invoke when all objects are created\n     * called after each fabric object created.\n     */\n    enlivenPatterns: function(patterns, callback) {\n      patterns = patterns || [];\n\n      function onLoaded() {\n        if (++numLoadedPatterns === numPatterns) {\n          callback && callback(enlivenedPatterns);\n        }\n      }\n\n      var enlivenedPatterns = [],\n          numLoadedPatterns = 0,\n          numPatterns = patterns.length;\n\n      if (!numPatterns) {\n        callback && callback(enlivenedPatterns);\n        return;\n      }\n\n      patterns.forEach(function (p, index) {\n        if (p && p.source) {\n          new fabric.Pattern(p, function(pattern) {\n            enlivenedPatterns[index] = pattern;\n            onLoaded();\n          });\n        }\n        else {\n          enlivenedPatterns[index] = p;\n          onLoaded();\n        }\n      });\n    },\n\n    /**\n     * Groups SVG elements (usually those retrieved from SVG document)\n     * @static\n     * @memberOf fabric.util\n     * @param {Array} elements SVG elements to group\n     * @param {Object} [options] Options object\n     * @param {String} path Value to set sourcePath to\n     * @return {fabric.Object|fabric.Group}\n     */\n    groupSVGElements: function(elements, options, path) {\n      var object;\n      if (elements && elements.length === 1) {\n        if (typeof path !== 'undefined') {\n          elements[0].sourcePath = path;\n        }\n        return elements[0];\n      }\n      if (options) {\n        if (options.width && options.height) {\n          options.centerPoint = {\n            x: options.width / 2,\n            y: options.height / 2\n          };\n        }\n        else {\n          delete options.width;\n          delete options.height;\n        }\n      }\n      object = new fabric.Group(elements, options);\n      if (typeof path !== 'undefined') {\n        object.sourcePath = path;\n      }\n      return object;\n    },\n\n    /**\n     * Populates an object with properties of another object\n     * @static\n     * @memberOf fabric.util\n     * @param {Object} source Source object\n     * @param {Object} destination Destination object\n     * @return {Array} properties Properties names to include\n     */\n    populateWithProperties: function(source, destination, properties) {\n      if (properties && Array.isArray(properties)) {\n        for (var i = 0, len = properties.length; i < len; i++) {\n          if (properties[i] in source) {\n            destination[properties[i]] = source[properties[i]];\n          }\n        }\n      }\n    },\n\n    /**\n     * Creates canvas element\n     * @static\n     * @memberOf fabric.util\n     * @return {CanvasElement} initialized canvas element\n     */\n    createCanvasElement: function() {\n      return fabric.document.createElement('canvas');\n    },\n\n    /**\n     * Creates a canvas element that is a copy of another and is also painted\n     * @param {CanvasElement} canvas to copy size and content of\n     * @static\n     * @memberOf fabric.util\n     * @return {CanvasElement} initialized canvas element\n     */\n    copyCanvasElement: function(canvas) {\n      var newCanvas = fabric.util.createCanvasElement();\n      newCanvas.width = canvas.width;\n      newCanvas.height = canvas.height;\n      newCanvas.getContext('2d').drawImage(canvas, 0, 0);\n      return newCanvas;\n    },\n\n    /**\n     * since 2.6.0 moved from canvas instance to utility.\n     * @param {CanvasElement} canvasEl to copy size and content of\n     * @param {String} format 'jpeg' or 'png', in some browsers 'webp' is ok too\n     * @param {Number} quality <= 1 and > 0\n     * @static\n     * @memberOf fabric.util\n     * @return {String} data url\n     */\n    toDataURL: function(canvasEl, format, quality) {\n      return canvasEl.toDataURL('image/' + format, quality);\n    },\n\n    /**\n     * Creates image element (works on client and node)\n     * @static\n     * @memberOf fabric.util\n     * @return {HTMLImageElement} HTML image element\n     */\n    createImage: function() {\n      return fabric.document.createElement('img');\n    },\n\n    /**\n     * Multiply matrix A by matrix B to nest transformations\n     * @static\n     * @memberOf fabric.util\n     * @param  {Array} a First transformMatrix\n     * @param  {Array} b Second transformMatrix\n     * @param  {Boolean} is2x2 flag to multiply matrices as 2x2 matrices\n     * @return {Array} The product of the two transform matrices\n     */\n    multiplyTransformMatrices: function(a, b, is2x2) {\n      // Matrix multiply a * b\n      return [\n        a[0] * b[0] + a[2] * b[1],\n        a[1] * b[0] + a[3] * b[1],\n        a[0] * b[2] + a[2] * b[3],\n        a[1] * b[2] + a[3] * b[3],\n        is2x2 ? 0 : a[0] * b[4] + a[2] * b[5] + a[4],\n        is2x2 ? 0 : a[1] * b[4] + a[3] * b[5] + a[5]\n      ];\n    },\n\n    /**\n     * Decomposes standard 2x3 matrix into transform components\n     * @static\n     * @memberOf fabric.util\n     * @param  {Array} a transformMatrix\n     * @return {Object} Components of transform\n     */\n    qrDecompose: function(a) {\n      var angle = atan2(a[1], a[0]),\n          denom = pow(a[0], 2) + pow(a[1], 2),\n          scaleX = sqrt(denom),\n          scaleY = (a[0] * a[3] - a[2] * a[1]) / scaleX,\n          skewX = atan2(a[0] * a[2] + a[1] * a [3], denom);\n      return {\n        angle: angle / PiBy180,\n        scaleX: scaleX,\n        scaleY: scaleY,\n        skewX: skewX / PiBy180,\n        skewY: 0,\n        translateX: a[4],\n        translateY: a[5]\n      };\n    },\n\n    /**\n     * Returns a transform matrix starting from an object of the same kind of\n     * the one returned from qrDecompose, useful also if you want to calculate some\n     * transformations from an object that is not enlived yet\n     * @static\n     * @memberOf fabric.util\n     * @param  {Object} options\n     * @param  {Number} [options.angle] angle in degrees\n     * @return {Number[]} transform matrix\n     */\n    calcRotateMatrix: function(options) {\n      if (!options.angle) {\n        return fabric.iMatrix.concat();\n      }\n      var theta = fabric.util.degreesToRadians(options.angle),\n          cos = fabric.util.cos(theta),\n          sin = fabric.util.sin(theta);\n      return [cos, sin, -sin, cos, 0, 0];\n    },\n\n    /**\n     * Returns a transform matrix starting from an object of the same kind of\n     * the one returned from qrDecompose, useful also if you want to calculate some\n     * transformations from an object that is not enlived yet.\n     * is called DimensionsTransformMatrix because those properties are the one that influence\n     * the size of the resulting box of the object.\n     * @static\n     * @memberOf fabric.util\n     * @param  {Object} options\n     * @param  {Number} [options.scaleX]\n     * @param  {Number} [options.scaleY]\n     * @param  {Boolean} [options.flipX]\n     * @param  {Boolean} [options.flipY]\n     * @param  {Number} [options.skewX]\n     * @param  {Number} [options.skewY]\n     * @return {Number[]} transform matrix\n     */\n    calcDimensionsMatrix: function(options) {\n      var scaleX = typeof options.scaleX === 'undefined' ? 1 : options.scaleX,\n          scaleY = typeof options.scaleY === 'undefined' ? 1 : options.scaleY,\n          scaleMatrix = [\n            options.flipX ? -scaleX : scaleX,\n            0,\n            0,\n            options.flipY ? -scaleY : scaleY,\n            0,\n            0],\n          multiply = fabric.util.multiplyTransformMatrices,\n          degreesToRadians = fabric.util.degreesToRadians;\n      if (options.skewX) {\n        scaleMatrix = multiply(\n          scaleMatrix,\n          [1, 0, Math.tan(degreesToRadians(options.skewX)), 1],\n          true);\n      }\n      if (options.skewY) {\n        scaleMatrix = multiply(\n          scaleMatrix,\n          [1, Math.tan(degreesToRadians(options.skewY)), 0, 1],\n          true);\n      }\n      return scaleMatrix;\n    },\n\n    /**\n     * Returns a transform matrix starting from an object of the same kind of\n     * the one returned from qrDecompose, useful also if you want to calculate some\n     * transformations from an object that is not enlived yet\n     * @static\n     * @memberOf fabric.util\n     * @param  {Object} options\n     * @param  {Number} [options.angle]\n     * @param  {Number} [options.scaleX]\n     * @param  {Number} [options.scaleY]\n     * @param  {Boolean} [options.flipX]\n     * @param  {Boolean} [options.flipY]\n     * @param  {Number} [options.skewX]\n     * @param  {Number} [options.skewX]\n     * @param  {Number} [options.translateX]\n     * @param  {Number} [options.translateY]\n     * @return {Number[]} transform matrix\n     */\n    composeMatrix: function(options) {\n      var matrix = [1, 0, 0, 1, options.translateX || 0, options.translateY || 0],\n          multiply = fabric.util.multiplyTransformMatrices;\n      if (options.angle) {\n        matrix = multiply(matrix, fabric.util.calcRotateMatrix(options));\n      }\n      if (options.scaleX !== 1 || options.scaleY !== 1 ||\n          options.skewX || options.skewY || options.flipX || options.flipY) {\n        matrix = multiply(matrix, fabric.util.calcDimensionsMatrix(options));\n      }\n      return matrix;\n    },\n\n    /**\n     * reset an object transform state to neutral. Top and left are not accounted for\n     * @static\n     * @memberOf fabric.util\n     * @param  {fabric.Object} target object to transform\n     */\n    resetObjectTransform: function (target) {\n      target.scaleX = 1;\n      target.scaleY = 1;\n      target.skewX = 0;\n      target.skewY = 0;\n      target.flipX = false;\n      target.flipY = false;\n      target.rotate(0);\n    },\n\n    /**\n     * Extract Object transform values\n     * @static\n     * @memberOf fabric.util\n     * @param  {fabric.Object} target object to read from\n     * @return {Object} Components of transform\n     */\n    saveObjectTransform: function (target) {\n      return {\n        scaleX: target.scaleX,\n        scaleY: target.scaleY,\n        skewX: target.skewX,\n        skewY: target.skewY,\n        angle: target.angle,\n        left: target.left,\n        flipX: target.flipX,\n        flipY: target.flipY,\n        top: target.top\n      };\n    },\n\n    /**\n     * Returns true if context has transparent pixel\n     * at specified location (taking tolerance into account)\n     * @param {CanvasRenderingContext2D} ctx context\n     * @param {Number} x x coordinate\n     * @param {Number} y y coordinate\n     * @param {Number} tolerance Tolerance\n     */\n    isTransparent: function(ctx, x, y, tolerance) {\n\n      // If tolerance is > 0 adjust start coords to take into account.\n      // If moves off Canvas fix to 0\n      if (tolerance > 0) {\n        if (x > tolerance) {\n          x -= tolerance;\n        }\n        else {\n          x = 0;\n        }\n        if (y > tolerance) {\n          y -= tolerance;\n        }\n        else {\n          y = 0;\n        }\n      }\n\n      var _isTransparent = true, i, temp,\n          imageData = ctx.getImageData(x, y, (tolerance * 2) || 1, (tolerance * 2) || 1),\n          l = imageData.data.length;\n\n      // Split image data - for tolerance > 1, pixelDataSize = 4;\n      for (i = 3; i < l; i += 4) {\n        temp = imageData.data[i];\n        _isTransparent = temp <= 0;\n        if (_isTransparent === false) {\n          break; // Stop if colour found\n        }\n      }\n\n      imageData = null;\n\n      return _isTransparent;\n    },\n\n    /**\n     * Parse preserveAspectRatio attribute from element\n     * @param {string} attribute to be parsed\n     * @return {Object} an object containing align and meetOrSlice attribute\n     */\n    parsePreserveAspectRatioAttribute: function(attribute) {\n      var meetOrSlice = 'meet', alignX = 'Mid', alignY = 'Mid',\n          aspectRatioAttrs = attribute.split(' '), align;\n\n      if (aspectRatioAttrs && aspectRatioAttrs.length) {\n        meetOrSlice = aspectRatioAttrs.pop();\n        if (meetOrSlice !== 'meet' && meetOrSlice !== 'slice') {\n          align = meetOrSlice;\n          meetOrSlice = 'meet';\n        }\n        else if (aspectRatioAttrs.length) {\n          align = aspectRatioAttrs.pop();\n        }\n      }\n      //divide align in alignX and alignY\n      alignX = align !== 'none' ? align.slice(1, 4) : 'none';\n      alignY = align !== 'none' ? align.slice(5, 8) : 'none';\n      return {\n        meetOrSlice: meetOrSlice,\n        alignX: alignX,\n        alignY: alignY\n      };\n    },\n\n    /**\n     * Clear char widths cache for the given font family or all the cache if no\n     * fontFamily is specified.\n     * Use it if you know you are loading fonts in a lazy way and you are not waiting\n     * for custom fonts to load properly when adding text objects to the canvas.\n     * If a text object is added when its own font is not loaded yet, you will get wrong\n     * measurement and so wrong bounding boxes.\n     * After the font cache is cleared, either change the textObject text content or call\n     * initDimensions() to trigger a recalculation\n     * @memberOf fabric.util\n     * @param {String} [fontFamily] font family to clear\n     */\n    clearFabricFontCache: function(fontFamily) {\n      fontFamily = (fontFamily || '').toLowerCase();\n      if (!fontFamily) {\n        fabric.charWidthsCache = { };\n      }\n      else if (fabric.charWidthsCache[fontFamily]) {\n        delete fabric.charWidthsCache[fontFamily];\n      }\n    },\n\n    /**\n     * Given current aspect ratio, determines the max width and height that can\n     * respect the total allowed area for the cache.\n     * @memberOf fabric.util\n     * @param {Number} ar aspect ratio\n     * @param {Number} maximumArea Maximum area you want to achieve\n     * @return {Object.x} Limited dimensions by X\n     * @return {Object.y} Limited dimensions by Y\n     */\n    limitDimsByArea: function(ar, maximumArea) {\n      var roughWidth = Math.sqrt(maximumArea * ar),\n          perfLimitSizeY = Math.floor(maximumArea / roughWidth);\n      return { x: Math.floor(roughWidth), y: perfLimitSizeY };\n    },\n\n    capValue: function(min, value, max) {\n      return Math.max(min, Math.min(value, max));\n    },\n\n    /**\n     * Finds the scale for the object source to fit inside the object destination,\n     * keeping aspect ratio intact.\n     * respect the total allowed area for the cache.\n     * @memberOf fabric.util\n     * @param {Object | fabric.Object} source\n     * @param {Number} source.height natural unscaled height of the object\n     * @param {Number} source.width natural unscaled width of the object\n     * @param {Object | fabric.Object} destination\n     * @param {Number} destination.height natural unscaled height of the object\n     * @param {Number} destination.width natural unscaled width of the object\n     * @return {Number} scale factor to apply to source to fit into destination\n     */\n    findScaleToFit: function(source, destination) {\n      return Math.min(destination.width / source.width, destination.height / source.height);\n    },\n\n    /**\n     * Finds the scale for the object source to cover entirely the object destination,\n     * keeping aspect ratio intact.\n     * respect the total allowed area for the cache.\n     * @memberOf fabric.util\n     * @param {Object | fabric.Object} source\n     * @param {Number} source.height natural unscaled height of the object\n     * @param {Number} source.width natural unscaled width of the object\n     * @param {Object | fabric.Object} destination\n     * @param {Number} destination.height natural unscaled height of the object\n     * @param {Number} destination.width natural unscaled width of the object\n     * @return {Number} scale factor to apply to source to cover destination\n     */\n    findScaleToCover: function(source, destination) {\n      return Math.max(destination.width / source.width, destination.height / source.height);\n    },\n\n    /**\n     * given an array of 6 number returns something like `\"matrix(...numbers)\"`\n     * @memberOf fabric.util\n     * @param {Array} transform an array with 6 numbers\n     * @return {String} transform matrix for svg\n     * @return {Object.y} Limited dimensions by Y\n     */\n    matrixToSVG: function(transform) {\n      return 'matrix(' + transform.map(function(value) {\n        return fabric.util.toFixed(value, fabric.Object.NUM_FRACTION_DIGITS);\n      }).join(' ') + ')';\n    },\n\n    /**\n     * given an object and a transform, apply the inverse transform to the object,\n     * this is equivalent to remove from that object that transformation, so that\n     * added in a space with the removed transform, the object will be the same as before.\n     * Removing from an object a transform that scale by 2 is like scaling it by 1/2.\n     * Removing from an object a transfrom that rotate by 30deg is like rotating by 30deg\n     * in the opposite direction.\n     * This util is used to add objects inside transformed groups or nested groups.\n     * @memberOf fabric.util\n     * @param {fabric.Object} object the object you want to transform\n     * @param {Array} transform the destination transform\n     */\n    removeTransformFromObject: function(object, transform) {\n      var inverted = fabric.util.invertTransform(transform),\n          finalTransform = fabric.util.multiplyTransformMatrices(inverted, object.calcOwnMatrix());\n      fabric.util.applyTransformToObject(object, finalTransform);\n    },\n\n    /**\n     * given an object and a transform, apply the transform to the object.\n     * this is equivalent to change the space where the object is drawn.\n     * Adding to an object a transform that scale by 2 is like scaling it by 2.\n     * This is used when removing an object from an active selection for example.\n     * @memberOf fabric.util\n     * @param {fabric.Object} object the object you want to transform\n     * @param {Array} transform the destination transform\n     */\n    addTransformToObject: function(object, transform) {\n      fabric.util.applyTransformToObject(\n        object,\n        fabric.util.multiplyTransformMatrices(transform, object.calcOwnMatrix())\n      );\n    },\n\n    /**\n     * discard an object transform state and apply the one from the matrix.\n     * @memberOf fabric.util\n     * @param {fabric.Object} object the object you want to transform\n     * @param {Array} transform the destination transform\n     */\n    applyTransformToObject: function(object, transform) {\n      var options = fabric.util.qrDecompose(transform),\n          center = new fabric.Point(options.translateX, options.translateY);\n      object.flipX = false;\n      object.flipY = false;\n      object.set('scaleX', options.scaleX);\n      object.set('scaleY', options.scaleY);\n      object.skewX = options.skewX;\n      object.skewY = options.skewY;\n      object.angle = options.angle;\n      object.setPositionByOrigin(center, 'center', 'center');\n    },\n\n    /**\n     * given a width and height, return the size of the bounding box\n     * that can contains the box with width/height with applied transform\n     * described in options.\n     * Use to calculate the boxes around objects for controls.\n     * @memberOf fabric.util\n     * @param {Number} width\n     * @param {Number} height\n     * @param {Object} options\n     * @param {Number} options.scaleX\n     * @param {Number} options.scaleY\n     * @param {Number} options.skewX\n     * @param {Number} options.skewY\n     * @return {Object.x} width of containing\n     * @return {Object.y} height of containing\n     */\n    sizeAfterTransform: function(width, height, options) {\n      var dimX = width / 2, dimY = height / 2,\n          points = [\n            {\n              x: -dimX,\n              y: -dimY\n            },\n            {\n              x: dimX,\n              y: -dimY\n            },\n            {\n              x: -dimX,\n              y: dimY\n            },\n            {\n              x: dimX,\n              y: dimY\n            }],\n          transformMatrix = fabric.util.calcDimensionsMatrix(options),\n          bbox = fabric.util.makeBoundingBoxFromPoints(points, transformMatrix);\n      return {\n        x: bbox.width,\n        y: bbox.height,\n      };\n    },\n\n    /**\n     * Merges 2 clip paths into one visually equal clip path\n     *\n     * **IMPORTANT**:\\\n     * Does **NOT** clone the arguments, clone them proir if necessary.\n     *\n     * Creates a wrapper (group) that contains one clip path and is clipped by the other so content is kept where both overlap.\n     * Use this method if both the clip paths may have nested clip paths of their own, so assigning one to the other's clip path property is not possible.\n     *\n     * In order to handle the `inverted` property we follow logic described in the following cases:\\\n     * **(1)** both clip paths are inverted - the clip paths pass the inverted prop to the wrapper and loose it themselves.\\\n     * **(2)** one is inverted and the other isn't - the wrapper shouldn't become inverted and the inverted clip path must clip the non inverted one to produce an identical visual effect.\\\n     * **(3)** both clip paths are not inverted - wrapper and clip paths remain unchanged.\n     *\n     * @memberOf fabric.util\n     * @param {fabric.Object} c1\n     * @param {fabric.Object} c2\n     * @returns {fabric.Object} merged clip path\n     */\n    mergeClipPaths: function (c1, c2) {\n      var a = c1, b = c2;\n      if (a.inverted && !b.inverted) {\n        //  case (2)\n        a = c2;\n        b = c1;\n      }\n      //  `b` becomes `a`'s clip path so we transform `b` to `a` coordinate plane\n      fabric.util.applyTransformToObject(\n        b,\n        fabric.util.multiplyTransformMatrices(\n          fabric.util.invertTransform(a.calcTransformMatrix()),\n          b.calcTransformMatrix()\n        )\n      );\n      //  assign the `inverted` prop to the wrapping group\n      var inverted = a.inverted && b.inverted;\n      if (inverted) {\n        //  case (1)\n        a.inverted = b.inverted = false;\n      }\n      return new fabric.Group([a], { clipPath: b, inverted: inverted });\n    },\n\n    /**\n     * @memberOf fabric.util\n     * @param {Object} prevStyle first style to compare\n     * @param {Object} thisStyle second style to compare\n     * @param {boolean} forTextSpans whether to check overline, underline, and line-through properties\n     * @return {boolean} true if the style changed\n     */\n    hasStyleChanged: function(prevStyle, thisStyle, forTextSpans) {\n      forTextSpans = forTextSpans || false;\n      return (prevStyle.fill !== thisStyle.fill ||\n              prevStyle.stroke !== thisStyle.stroke ||\n              prevStyle.strokeWidth !== thisStyle.strokeWidth ||\n              prevStyle.fontSize !== thisStyle.fontSize ||\n              prevStyle.fontFamily !== thisStyle.fontFamily ||\n              prevStyle.fontWeight !== thisStyle.fontWeight ||\n              prevStyle.fontStyle !== thisStyle.fontStyle ||\n              prevStyle.deltaY !== thisStyle.deltaY) ||\n              (forTextSpans &&\n                (prevStyle.overline !== thisStyle.overline ||\n                prevStyle.underline !== thisStyle.underline ||\n                prevStyle.linethrough !== thisStyle.linethrough));\n    },\n\n    /**\n     * Returns the array form of a text object's inline styles property with styles grouped in ranges\n     * rather than per character. This format is less verbose, and is better suited for storage\n     * so it is used in serialization (not during runtime).\n     * @memberOf fabric.util\n     * @param {object} styles per character styles for a text object\n     * @param {String} text the text string that the styles are applied to\n     * @return {{start: number, end: number, style: object}[]}\n     */\n    stylesToArray: function(styles, text) {\n      // clone style structure to prevent mutation\n      var styles = fabric.util.object.clone(styles, true),\n          textLines = text.split('\\n'),\n          charIndex = -1, prevStyle = {}, stylesArray = [];\n      //loop through each textLine\n      for (var i = 0; i < textLines.length; i++) {\n        if (!styles[i]) {\n          //no styles exist for this line, so add the line's length to the charIndex total\n          charIndex += textLines[i].length;\n          continue;\n        }\n        //loop through each character of the current line\n        for (var c = 0; c < textLines[i].length; c++) {\n          charIndex++;\n          var thisStyle = styles[i][c];\n          //check if style exists for this character\n          if (thisStyle) {\n            var styleChanged = fabric.util.hasStyleChanged(prevStyle, thisStyle, true);\n            if (styleChanged) {\n              stylesArray.push({\n                start: charIndex,\n                end: charIndex + 1,\n                style: thisStyle\n              });\n            }\n            else {\n              //if style is the same as previous character, increase end index\n              stylesArray[stylesArray.length - 1].end++;\n            }\n          }\n          prevStyle = thisStyle || {};\n        }\n      }\n      return stylesArray;\n    },\n\n    /**\n     * Returns the object form of the styles property with styles that are assigned per\n     * character rather than grouped by range. This format is more verbose, and is\n     * only used during runtime (not for serialization/storage)\n     * @memberOf fabric.util\n     * @param {Array} styles the serialized form of a text object's styles\n     * @param {String} text the text string that the styles are applied to\n     * @return {Object}\n     */\n    stylesFromArray: function(styles, text) {\n      if (!Array.isArray(styles)) {\n        return styles;\n      }\n      var textLines = text.split('\\n'),\n          charIndex = -1, styleIndex = 0, stylesObject = {};\n      //loop through each textLine\n      for (var i = 0; i < textLines.length; i++) {\n        //loop through each character of the current line\n        for (var c = 0; c < textLines[i].length; c++) {\n          charIndex++;\n          //check if there's a style collection that includes the current character\n          if (styles[styleIndex]\n            && styles[styleIndex].start <= charIndex\n            && charIndex < styles[styleIndex].end) {\n            //create object for line index if it doesn't exist\n            stylesObject[i] = stylesObject[i] || {};\n            //assign a style at this character's index\n            stylesObject[i][c] = Object.assign({}, styles[styleIndex].style);\n            //if character is at the end of the current style collection, move to the next\n            if (charIndex === styles[styleIndex].end - 1) {\n              styleIndex++;\n            }\n          }\n        }\n      }\n      return stylesObject;\n    }\n  };\n})(typeof exports !== 'undefined' ? exports : this);\n\n\n(function() {\n  var _join = Array.prototype.join,\n      commandLengths = {\n        m: 2,\n        l: 2,\n        h: 1,\n        v: 1,\n        c: 6,\n        s: 4,\n        q: 4,\n        t: 2,\n        a: 7\n      },\n      repeatedCommands = {\n        m: 'l',\n        M: 'L'\n      };\n  function segmentToBezier(th2, th3, cosTh, sinTh, rx, ry, cx1, cy1, mT, fromX, fromY) {\n    var costh2 = fabric.util.cos(th2),\n        sinth2 = fabric.util.sin(th2),\n        costh3 = fabric.util.cos(th3),\n        sinth3 = fabric.util.sin(th3),\n        toX = cosTh * rx * costh3 - sinTh * ry * sinth3 + cx1,\n        toY = sinTh * rx * costh3 + cosTh * ry * sinth3 + cy1,\n        cp1X = fromX + mT * ( -cosTh * rx * sinth2 - sinTh * ry * costh2),\n        cp1Y = fromY + mT * ( -sinTh * rx * sinth2 + cosTh * ry * costh2),\n        cp2X = toX + mT * ( cosTh * rx * sinth3 + sinTh * ry * costh3),\n        cp2Y = toY + mT * ( sinTh * rx * sinth3 - cosTh * ry * costh3);\n\n    return ['C',\n      cp1X, cp1Y,\n      cp2X, cp2Y,\n      toX, toY\n    ];\n  }\n\n  /* Adapted from http://dxr.mozilla.org/mozilla-central/source/content/svg/content/src/nsSVGPathDataParser.cpp\n   * by Andrea Bogazzi code is under MPL. if you don't have a copy of the license you can take it here\n   * http://mozilla.org/MPL/2.0/\n   */\n  function arcToSegments(toX, toY, rx, ry, large, sweep, rotateX) {\n    var PI = Math.PI, th = rotateX * PI / 180,\n        sinTh = fabric.util.sin(th),\n        cosTh = fabric.util.cos(th),\n        fromX = 0, fromY = 0;\n\n    rx = Math.abs(rx);\n    ry = Math.abs(ry);\n\n    var px = -cosTh * toX * 0.5 - sinTh * toY * 0.5,\n        py = -cosTh * toY * 0.5 + sinTh * toX * 0.5,\n        rx2 = rx * rx, ry2 = ry * ry, py2 = py * py, px2 = px * px,\n        pl = rx2 * ry2 - rx2 * py2 - ry2 * px2,\n        root = 0;\n\n    if (pl < 0) {\n      var s = Math.sqrt(1 - pl / (rx2 * ry2));\n      rx *= s;\n      ry *= s;\n    }\n    else {\n      root = (large === sweep ? -1.0 : 1.0) *\n              Math.sqrt( pl / (rx2 * py2 + ry2 * px2));\n    }\n\n    var cx = root * rx * py / ry,\n        cy = -root * ry * px / rx,\n        cx1 = cosTh * cx - sinTh * cy + toX * 0.5,\n        cy1 = sinTh * cx + cosTh * cy + toY * 0.5,\n        mTheta = calcVectorAngle(1, 0, (px - cx) / rx, (py - cy) / ry),\n        dtheta = calcVectorAngle((px - cx) / rx, (py - cy) / ry, (-px - cx) / rx, (-py - cy) / ry);\n\n    if (sweep === 0 && dtheta > 0) {\n      dtheta -= 2 * PI;\n    }\n    else if (sweep === 1 && dtheta < 0) {\n      dtheta += 2 * PI;\n    }\n\n    // Convert into cubic bezier segments <= 90deg\n    var segments = Math.ceil(Math.abs(dtheta / PI * 2)),\n        result = [], mDelta = dtheta / segments,\n        mT = 8 / 3 * Math.sin(mDelta / 4) * Math.sin(mDelta / 4) / Math.sin(mDelta / 2),\n        th3 = mTheta + mDelta;\n\n    for (var i = 0; i < segments; i++) {\n      result[i] = segmentToBezier(mTheta, th3, cosTh, sinTh, rx, ry, cx1, cy1, mT, fromX, fromY);\n      fromX = result[i][5];\n      fromY = result[i][6];\n      mTheta = th3;\n      th3 += mDelta;\n    }\n    return result;\n  }\n\n  /*\n   * Private\n   */\n  function calcVectorAngle(ux, uy, vx, vy) {\n    var ta = Math.atan2(uy, ux),\n        tb = Math.atan2(vy, vx);\n    if (tb >= ta) {\n      return tb - ta;\n    }\n    else {\n      return 2 * Math.PI - (ta - tb);\n    }\n  }\n\n  /**\n   * Calculate bounding box of a beziercurve\n   * @param {Number} x0 starting point\n   * @param {Number} y0\n   * @param {Number} x1 first control point\n   * @param {Number} y1\n   * @param {Number} x2 secondo control point\n   * @param {Number} y2\n   * @param {Number} x3 end of bezier\n   * @param {Number} y3\n   */\n  // taken from http://jsbin.com/ivomiq/56/edit  no credits available for that.\n  // TODO: can we normalize this with the starting points set at 0 and then translated the bbox?\n  function getBoundsOfCurve(x0, y0, x1, y1, x2, y2, x3, y3) {\n    var argsString;\n    if (fabric.cachesBoundsOfCurve) {\n      argsString = _join.call(arguments);\n      if (fabric.boundsOfCurveCache[argsString]) {\n        return fabric.boundsOfCurveCache[argsString];\n      }\n    }\n\n    var sqrt = Math.sqrt,\n        min = Math.min, max = Math.max,\n        abs = Math.abs, tvalues = [],\n        bounds = [[], []],\n        a, b, c, t, t1, t2, b2ac, sqrtb2ac;\n\n    b = 6 * x0 - 12 * x1 + 6 * x2;\n    a = -3 * x0 + 9 * x1 - 9 * x2 + 3 * x3;\n    c = 3 * x1 - 3 * x0;\n\n    for (var i = 0; i < 2; ++i) {\n      if (i > 0) {\n        b = 6 * y0 - 12 * y1 + 6 * y2;\n        a = -3 * y0 + 9 * y1 - 9 * y2 + 3 * y3;\n        c = 3 * y1 - 3 * y0;\n      }\n\n      if (abs(a) < 1e-12) {\n        if (abs(b) < 1e-12) {\n          continue;\n        }\n        t = -c / b;\n        if (0 < t && t < 1) {\n          tvalues.push(t);\n        }\n        continue;\n      }\n      b2ac = b * b - 4 * c * a;\n      if (b2ac < 0) {\n        continue;\n      }\n      sqrtb2ac = sqrt(b2ac);\n      t1 = (-b + sqrtb2ac) / (2 * a);\n      if (0 < t1 && t1 < 1) {\n        tvalues.push(t1);\n      }\n      t2 = (-b - sqrtb2ac) / (2 * a);\n      if (0 < t2 && t2 < 1) {\n        tvalues.push(t2);\n      }\n    }\n\n    var x, y, j = tvalues.length, jlen = j, mt;\n    while (j--) {\n      t = tvalues[j];\n      mt = 1 - t;\n      x = (mt * mt * mt * x0) + (3 * mt * mt * t * x1) + (3 * mt * t * t * x2) + (t * t * t * x3);\n      bounds[0][j] = x;\n\n      y = (mt * mt * mt * y0) + (3 * mt * mt * t * y1) + (3 * mt * t * t * y2) + (t * t * t * y3);\n      bounds[1][j] = y;\n    }\n\n    bounds[0][jlen] = x0;\n    bounds[1][jlen] = y0;\n    bounds[0][jlen + 1] = x3;\n    bounds[1][jlen + 1] = y3;\n    var result = [\n      {\n        x: min.apply(null, bounds[0]),\n        y: min.apply(null, bounds[1])\n      },\n      {\n        x: max.apply(null, bounds[0]),\n        y: max.apply(null, bounds[1])\n      }\n    ];\n    if (fabric.cachesBoundsOfCurve) {\n      fabric.boundsOfCurveCache[argsString] = result;\n    }\n    return result;\n  }\n\n  /**\n   * Converts arc to a bunch of bezier curves\n   * @param {Number} fx starting point x\n   * @param {Number} fy starting point y\n   * @param {Array} coords Arc command\n   */\n  function fromArcToBeziers(fx, fy, coords) {\n    var rx = coords[1],\n        ry = coords[2],\n        rot = coords[3],\n        large = coords[4],\n        sweep = coords[5],\n        tx = coords[6],\n        ty = coords[7],\n        segsNorm = arcToSegments(tx - fx, ty - fy, rx, ry, large, sweep, rot);\n\n    for (var i = 0, len = segsNorm.length; i < len; i++) {\n      segsNorm[i][1] += fx;\n      segsNorm[i][2] += fy;\n      segsNorm[i][3] += fx;\n      segsNorm[i][4] += fy;\n      segsNorm[i][5] += fx;\n      segsNorm[i][6] += fy;\n    }\n    return segsNorm;\n  };\n\n  /**\n   * This function take a parsed SVG path and make it simpler for fabricJS logic.\n   * simplification consist of: only UPPERCASE absolute commands ( relative converted to absolute )\n   * S converted in C, T converted in Q, A converted in C.\n   * @param {Array} path the array of commands of a parsed svg path for fabric.Path\n   * @return {Array} the simplified array of commands of a parsed svg path for fabric.Path\n   */\n  function makePathSimpler(path) {\n    // x and y represent the last point of the path. the previous command point.\n    // we add them to each relative command to make it an absolute comment.\n    // we also swap the v V h H with L, because are easier to transform.\n    var x = 0, y = 0, len = path.length,\n        // x1 and y1 represent the last point of the subpath. the subpath is started with\n        // m or M command. When a z or Z command is drawn, x and y need to be resetted to\n        // the last x1 and y1.\n        x1 = 0, y1 = 0, current, i, converted,\n        // previous will host the letter of the previous command, to handle S and T.\n        // controlX and controlY will host the previous reflected control point\n        destinationPath = [], previous, controlX, controlY;\n    for (i = 0; i < len; ++i) {\n      converted = false;\n      current = path[i].slice(0);\n      switch (current[0]) { // first letter\n        case 'l': // lineto, relative\n          current[0] = 'L';\n          current[1] += x;\n          current[2] += y;\n          // falls through\n        case 'L':\n          x = current[1];\n          y = current[2];\n          break;\n        case 'h': // horizontal lineto, relative\n          current[1] += x;\n          // falls through\n        case 'H':\n          current[0] = 'L';\n          current[2] = y;\n          x = current[1];\n          break;\n        case 'v': // vertical lineto, relative\n          current[1] += y;\n          // falls through\n        case 'V':\n          current[0] = 'L';\n          y = current[1];\n          current[1] = x;\n          current[2] = y;\n          break;\n        case 'm': // moveTo, relative\n          current[0] = 'M';\n          current[1] += x;\n          current[2] += y;\n          // falls through\n        case 'M':\n          x = current[1];\n          y = current[2];\n          x1 = current[1];\n          y1 = current[2];\n          break;\n        case 'c': // bezierCurveTo, relative\n          current[0] = 'C';\n          current[1] += x;\n          current[2] += y;\n          current[3] += x;\n          current[4] += y;\n          current[5] += x;\n          current[6] += y;\n          // falls through\n        case 'C':\n          controlX = current[3];\n          controlY = current[4];\n          x = current[5];\n          y = current[6];\n          break;\n        case 's': // shorthand cubic bezierCurveTo, relative\n          current[0] = 'S';\n          current[1] += x;\n          current[2] += y;\n          current[3] += x;\n          current[4] += y;\n          // falls through\n        case 'S':\n          // would be sScC but since we are swapping sSc for C, we check just that.\n          if (previous === 'C') {\n            // calculate reflection of previous control points\n            controlX = 2 * x - controlX;\n            controlY = 2 * y - controlY;\n          }\n          else {\n            // If there is no previous command or if the previous command was not a C, c, S, or s,\n            // the control point is coincident with the current point\n            controlX = x;\n            controlY = y;\n          }\n          x = current[3];\n          y = current[4];\n          current[0] = 'C';\n          current[5] = current[3];\n          current[6] = current[4];\n          current[3] = current[1];\n          current[4] = current[2];\n          current[1] = controlX;\n          current[2] = controlY;\n          // current[3] and current[4] are NOW the second control point.\n          // we keep it for the next reflection.\n          controlX = current[3];\n          controlY = current[4];\n          break;\n        case 'q': // quadraticCurveTo, relative\n          current[0] = 'Q';\n          current[1] += x;\n          current[2] += y;\n          current[3] += x;\n          current[4] += y;\n          // falls through\n        case 'Q':\n          controlX = current[1];\n          controlY = current[2];\n          x = current[3];\n          y = current[4];\n          break;\n        case 't': // shorthand quadraticCurveTo, relative\n          current[0] = 'T';\n          current[1] += x;\n          current[2] += y;\n          // falls through\n        case 'T':\n          if (previous === 'Q') {\n            // calculate reflection of previous control point\n            controlX = 2 * x - controlX;\n            controlY = 2 * y - controlY;\n          }\n          else {\n            // If there is no previous command or if the previous command was not a Q, q, T or t,\n            // assume the control point is coincident with the current point\n            controlX = x;\n            controlY = y;\n          }\n          current[0] = 'Q';\n          x = current[1];\n          y = current[2];\n          current[1] = controlX;\n          current[2] = controlY;\n          current[3] = x;\n          current[4] = y;\n          break;\n        case 'a':\n          current[0] = 'A';\n          current[6] += x;\n          current[7] += y;\n          // falls through\n        case 'A':\n          converted = true;\n          destinationPath = destinationPath.concat(fromArcToBeziers(x, y, current));\n          x = current[6];\n          y = current[7];\n          break;\n        case 'z':\n        case 'Z':\n          x = x1;\n          y = y1;\n          break;\n        default:\n      }\n      if (!converted) {\n        destinationPath.push(current);\n      }\n      previous = current[0];\n    }\n    return destinationPath;\n  };\n\n  /**\n   * Calc length from point x1,y1 to x2,y2\n   * @param {Number} x1 starting point x\n   * @param {Number} y1 starting point y\n   * @param {Number} x2 starting point x\n   * @param {Number} y2 starting point y\n   * @return {Number} length of segment\n   */\n  function calcLineLength(x1, y1, x2, y2) {\n    return Math.sqrt((x2 - x1) * (x2 - x1) + (y2 - y1) * (y2 - y1));\n  }\n\n  // functions for the Cubic beizer\n  // taken from: https://github.com/konvajs/konva/blob/7.0.5/src/shapes/Path.ts#L350\n  function CB1(t) {\n    return t * t * t;\n  }\n  function CB2(t) {\n    return 3 * t * t * (1 - t);\n  }\n  function CB3(t) {\n    return 3 * t * (1 - t) * (1 - t);\n  }\n  function CB4(t) {\n    return (1 - t) * (1 - t) * (1 - t);\n  }\n\n  function getPointOnCubicBezierIterator(p1x, p1y, p2x, p2y, p3x, p3y, p4x, p4y) {\n    return function(pct) {\n      var c1 = CB1(pct), c2 = CB2(pct), c3 = CB3(pct), c4 = CB4(pct);\n      return {\n        x: p4x * c1 + p3x * c2 + p2x * c3 + p1x * c4,\n        y: p4y * c1 + p3y * c2 + p2y * c3 + p1y * c4\n      };\n    };\n  }\n\n  function getTangentCubicIterator(p1x, p1y, p2x, p2y, p3x, p3y, p4x, p4y) {\n    return function (pct) {\n      var invT = 1 - pct,\n          tangentX = (3 * invT * invT * (p2x - p1x)) + (6 * invT * pct * (p3x - p2x)) +\n          (3 * pct * pct * (p4x - p3x)),\n          tangentY = (3 * invT * invT * (p2y - p1y)) + (6 * invT * pct * (p3y - p2y)) +\n          (3 * pct * pct * (p4y - p3y));\n      return Math.atan2(tangentY, tangentX);\n    };\n  }\n\n  function QB1(t) {\n    return t * t;\n  }\n\n  function QB2(t) {\n    return 2 * t * (1 - t);\n  }\n\n  function QB3(t) {\n    return (1 - t) * (1 - t);\n  }\n\n  function getPointOnQuadraticBezierIterator(p1x, p1y, p2x, p2y, p3x, p3y) {\n    return function(pct) {\n      var c1 = QB1(pct), c2 = QB2(pct), c3 = QB3(pct);\n      return {\n        x: p3x * c1 + p2x * c2 + p1x * c3,\n        y: p3y * c1 + p2y * c2 + p1y * c3\n      };\n    };\n  }\n\n  function getTangentQuadraticIterator(p1x, p1y, p2x, p2y, p3x, p3y) {\n    return function (pct) {\n      var invT = 1 - pct,\n          tangentX = (2 * invT * (p2x - p1x)) + (2 * pct * (p3x - p2x)),\n          tangentY = (2 * invT * (p2y - p1y)) + (2 * pct * (p3y - p2y));\n      return Math.atan2(tangentY, tangentX);\n    };\n  }\n\n\n  // this will run over a path segment ( a cubic or quadratic segment) and approximate it\n  // with 100 segemnts. This will good enough to calculate the length of the curve\n  function pathIterator(iterator, x1, y1) {\n    var tempP = { x: x1, y: y1 }, p, tmpLen = 0, perc;\n    for (perc = 1; perc <= 100; perc += 1) {\n      p = iterator(perc / 100);\n      tmpLen += calcLineLength(tempP.x, tempP.y, p.x, p.y);\n      tempP = p;\n    }\n    return tmpLen;\n  }\n\n  /**\n   * Given a pathInfo, and a distance in pixels, find the percentage from 0 to 1\n   * that correspond to that pixels run over the path.\n   * The percentage will be then used to find the correct point on the canvas for the path.\n   * @param {Array} segInfo fabricJS collection of information on a parsed path\n   * @param {Number} distance from starting point, in pixels.\n   * @return {Object} info object with x and y ( the point on canvas ) and angle, the tangent on that point;\n   */\n  function findPercentageForDistance(segInfo, distance) {\n    var perc = 0, tmpLen = 0, iterator = segInfo.iterator, tempP = { x: segInfo.x, y: segInfo.y },\n        p, nextLen, nextStep = 0.01, angleFinder = segInfo.angleFinder, lastPerc;\n    // nextStep > 0.0001 covers 0.00015625 that 1/64th of 1/100\n    // the path\n    while (tmpLen < distance && nextStep > 0.0001) {\n      p = iterator(perc);\n      lastPerc = perc;\n      nextLen = calcLineLength(tempP.x, tempP.y, p.x, p.y);\n      // compare tmpLen each cycle with distance, decide next perc to test.\n      if ((nextLen + tmpLen) > distance) {\n        // we discard this step and we make smaller steps.\n        perc -= nextStep;\n        nextStep /= 2;\n      }\n      else {\n        tempP = p;\n        perc += nextStep;\n        tmpLen += nextLen;\n      }\n    }\n    p.angle = angleFinder(lastPerc);\n    return p;\n  }\n\n  /**\n   * Run over a parsed and simplifed path and extrac some informations.\n   * informations are length of each command and starting point\n   * @param {Array} path fabricJS parsed path commands\n   * @return {Array} path commands informations\n   */\n  function getPathSegmentsInfo(path) {\n    var totalLength = 0, len = path.length, current,\n        //x2 and y2 are the coords of segment start\n        //x1 and y1 are the coords of the current point\n        x1 = 0, y1 = 0, x2 = 0, y2 = 0, info = [], iterator, tempInfo, angleFinder;\n    for (var i = 0; i < len; i++) {\n      current = path[i];\n      tempInfo = {\n        x: x1,\n        y: y1,\n        command: current[0],\n      };\n      switch (current[0]) { //first letter\n        case 'M':\n          tempInfo.length = 0;\n          x2 = x1 = current[1];\n          y2 = y1 = current[2];\n          break;\n        case 'L':\n          tempInfo.length = calcLineLength(x1, y1, current[1], current[2]);\n          x1 = current[1];\n          y1 = current[2];\n          break;\n        case 'C':\n          iterator = getPointOnCubicBezierIterator(\n            x1,\n            y1,\n            current[1],\n            current[2],\n            current[3],\n            current[4],\n            current[5],\n            current[6]\n          );\n          angleFinder = getTangentCubicIterator(\n            x1,\n            y1,\n            current[1],\n            current[2],\n            current[3],\n            current[4],\n            current[5],\n            current[6]\n          );\n          tempInfo.iterator = iterator;\n          tempInfo.angleFinder = angleFinder;\n          tempInfo.length = pathIterator(iterator, x1, y1);\n          x1 = current[5];\n          y1 = current[6];\n          break;\n        case 'Q':\n          iterator = getPointOnQuadraticBezierIterator(\n            x1,\n            y1,\n            current[1],\n            current[2],\n            current[3],\n            current[4]\n          );\n          angleFinder = getTangentQuadraticIterator(\n            x1,\n            y1,\n            current[1],\n            current[2],\n            current[3],\n            current[4]\n          );\n          tempInfo.iterator = iterator;\n          tempInfo.angleFinder = angleFinder;\n          tempInfo.length = pathIterator(iterator, x1, y1);\n          x1 = current[3];\n          y1 = current[4];\n          break;\n        case 'Z':\n        case 'z':\n          // we add those in order to ease calculations later\n          tempInfo.destX = x2;\n          tempInfo.destY = y2;\n          tempInfo.length = calcLineLength(x1, y1, x2, y2);\n          x1 = x2;\n          y1 = y2;\n          break;\n      }\n      totalLength += tempInfo.length;\n      info.push(tempInfo);\n    }\n    info.push({ length: totalLength, x: x1, y: y1 });\n    return info;\n  }\n\n  function getPointOnPath(path, distance, infos) {\n    if (!infos) {\n      infos = getPathSegmentsInfo(path);\n    }\n    var i = 0;\n    while ((distance - infos[i].length > 0) && i < (infos.length - 2)) {\n      distance -= infos[i].length;\n      i++;\n    }\n    // var distance = infos[infos.length - 1] * perc;\n    var segInfo = infos[i], segPercent = distance / segInfo.length,\n        command = segInfo.command, segment = path[i], info;\n\n    switch (command) {\n      case 'M':\n        return { x: segInfo.x, y: segInfo.y, angle: 0 };\n      case 'Z':\n      case 'z':\n        info = new fabric.Point(segInfo.x, segInfo.y).lerp(\n          new fabric.Point(segInfo.destX, segInfo.destY),\n          segPercent\n        );\n        info.angle = Math.atan2(segInfo.destY - segInfo.y, segInfo.destX - segInfo.x);\n        return info;\n      case 'L':\n        info = new fabric.Point(segInfo.x, segInfo.y).lerp(\n          new fabric.Point(segment[1], segment[2]),\n          segPercent\n        );\n        info.angle = Math.atan2(segment[2] - segInfo.y, segment[1] - segInfo.x);\n        return info;\n      case 'C':\n        return findPercentageForDistance(segInfo, distance);\n      case 'Q':\n        return findPercentageForDistance(segInfo, distance);\n    }\n  }\n\n  /**\n   *\n   * @param {string} pathString\n   * @return {(string|number)[][]} An array of SVG path commands\n   * @example <caption>Usage</caption>\n   * parsePath('M 3 4 Q 3 5 2 1 4 0 Q 9 12 2 1 4 0') === [\n   *   ['M', 3, 4],\n   *   ['Q', 3, 5, 2, 1, 4, 0],\n   *   ['Q', 9, 12, 2, 1, 4, 0],\n   * ];\n   *\n   */\n  function parsePath(pathString) {\n    var result = [],\n        coords = [],\n        currentPath,\n        parsed,\n        re = fabric.rePathCommand,\n        rNumber = '[-+]?(?:\\\\d*\\\\.\\\\d+|\\\\d+\\\\.?)(?:[eE][-+]?\\\\d+)?\\\\s*',\n        rNumberCommaWsp = '(' + rNumber + ')' + fabric.commaWsp,\n        rFlagCommaWsp = '([01])' + fabric.commaWsp + '?',\n        rArcSeq = rNumberCommaWsp + '?' + rNumberCommaWsp + '?' + rNumberCommaWsp + rFlagCommaWsp + rFlagCommaWsp +\n          rNumberCommaWsp + '?(' + rNumber + ')',\n        regArcArgumentSequence = new RegExp(rArcSeq, 'g'),\n        match,\n        coordsStr,\n        // one of commands (m,M,l,L,q,Q,c,C,etc.) followed by non-command characters (i.e. command values)\n        path;\n    if (!pathString || !pathString.match) {\n      return result;\n    }\n    path = pathString.match(/[mzlhvcsqta][^mzlhvcsqta]*/gi);\n\n    for (var i = 0, coordsParsed, len = path.length; i < len; i++) {\n      currentPath = path[i];\n\n      coordsStr = currentPath.slice(1).trim();\n      coords.length = 0;\n\n      var command = currentPath.charAt(0);\n      coordsParsed = [command];\n\n      if (command.toLowerCase() === 'a') {\n        // arcs have special flags that apparently don't require spaces so handle special\n        for (var args; (args = regArcArgumentSequence.exec(coordsStr));) {\n          for (var j = 1; j < args.length; j++) {\n            coords.push(args[j]);\n          }\n        }\n      }\n      else {\n        while ((match = re.exec(coordsStr))) {\n          coords.push(match[0]);\n        }\n      }\n\n      for (var j = 0, jlen = coords.length; j < jlen; j++) {\n        parsed = parseFloat(coords[j]);\n        if (!isNaN(parsed)) {\n          coordsParsed.push(parsed);\n        }\n      }\n\n      var commandLength = commandLengths[command.toLowerCase()],\n          repeatedCommand = repeatedCommands[command] || command;\n\n      if (coordsParsed.length - 1 > commandLength) {\n        for (var k = 1, klen = coordsParsed.length; k < klen; k += commandLength) {\n          result.push([command].concat(coordsParsed.slice(k, k + commandLength)));\n          command = repeatedCommand;\n        }\n      }\n      else {\n        result.push(coordsParsed);\n      }\n    }\n\n    return result;\n  };\n\n  /**\n   *\n   * Converts points to a smooth SVG path\n   * @param {{ x: number,y: number }[]} points Array of points\n   * @param {number} [correction] Apply a correction to the path (usually we use `width / 1000`). If value is undefined 0 is used as the correction value.\n   * @return {(string|number)[][]} An array of SVG path commands\n   */\n  function getSmoothPathFromPoints(points, correction) {\n    var path = [], i,\n        p1 = new fabric.Point(points[0].x, points[0].y),\n        p2 = new fabric.Point(points[1].x, points[1].y),\n        len = points.length, multSignX = 1, multSignY = 0, manyPoints = len > 2;\n    correction = correction || 0;\n\n    if (manyPoints) {\n      multSignX = points[2].x < p2.x ? -1 : points[2].x === p2.x ? 0 : 1;\n      multSignY = points[2].y < p2.y ? -1 : points[2].y === p2.y ? 0 : 1;\n    }\n    path.push(['M', p1.x - multSignX * correction, p1.y - multSignY * correction]);\n    for (i = 1; i < len; i++) {\n      if (!p1.eq(p2)) {\n        var midPoint = p1.midPointFrom(p2);\n        // p1 is our bezier control point\n        // midpoint is our endpoint\n        // start point is p(i-1) value.\n        path.push(['Q', p1.x, p1.y, midPoint.x, midPoint.y]);\n      }\n      p1 = points[i];\n      if ((i + 1) < points.length) {\n        p2 = points[i + 1];\n      }\n    }\n    if (manyPoints) {\n      multSignX = p1.x > points[i - 2].x ? 1 : p1.x === points[i - 2].x ? 0 : -1;\n      multSignY = p1.y > points[i - 2].y ? 1 : p1.y === points[i - 2].y ? 0 : -1;\n    }\n    path.push(['L', p1.x + multSignX * correction, p1.y + multSignY * correction]);\n    return path;\n  }\n  /**\n   * Transform a path by transforming each segment.\n   * it has to be a simplified path or it won't work.\n   * WARNING: this depends from pathOffset for correct operation\n   * @param {Array} path fabricJS parsed and simplified path commands\n   * @param {Array} transform matrix that represent the transformation\n   * @param {Object} [pathOffset] the fabric.Path pathOffset\n   * @param {Number} pathOffset.x\n   * @param {Number} pathOffset.y\n   * @returns {Array} the transformed path\n   */\n  function transformPath(path, transform, pathOffset) {\n    if (pathOffset) {\n      transform = fabric.util.multiplyTransformMatrices(\n        transform,\n        [1, 0, 0, 1, -pathOffset.x, -pathOffset.y]\n      );\n    }\n    return path.map(function(pathSegment) {\n      var newSegment = pathSegment.slice(0), point = {};\n      for (var i = 1; i < pathSegment.length - 1; i += 2) {\n        point.x = pathSegment[i];\n        point.y = pathSegment[i + 1];\n        point = fabric.util.transformPoint(point, transform);\n        newSegment[i] = point.x;\n        newSegment[i + 1] = point.y;\n      }\n      return newSegment;\n    });\n  }\n\n  /**\n   * Join path commands to go back to svg format\n   * @param {Array} pathData fabricJS parsed path commands\n   * @return {String} joined path 'M 0 0 L 20 30'\n   */\n  fabric.util.joinPath = function(pathData) {\n    return pathData.map(function (segment) { return segment.join(' '); }).join(' ');\n  };\n  fabric.util.parsePath = parsePath;\n  fabric.util.makePathSimpler = makePathSimpler;\n  fabric.util.getSmoothPathFromPoints = getSmoothPathFromPoints;\n  fabric.util.getPathSegmentsInfo = getPathSegmentsInfo;\n  fabric.util.getBoundsOfCurve = getBoundsOfCurve;\n  fabric.util.getPointOnPath = getPointOnPath;\n  fabric.util.transformPath = transformPath;\n})();\n\n\n(function() {\n\n  var slice = Array.prototype.slice;\n\n  /**\n   * Invokes method on all items in a given array\n   * @memberOf fabric.util.array\n   * @param {Array} array Array to iterate over\n   * @param {String} method Name of a method to invoke\n   * @return {Array}\n   */\n  function invoke(array, method) {\n    var args = slice.call(arguments, 2), result = [];\n    for (var i = 0, len = array.length; i < len; i++) {\n      result[i] = args.length ? array[i][method].apply(array[i], args) : array[i][method].call(array[i]);\n    }\n    return result;\n  }\n\n  /**\n   * Finds maximum value in array (not necessarily \"first\" one)\n   * @memberOf fabric.util.array\n   * @param {Array} array Array to iterate over\n   * @param {String} byProperty\n   * @return {*}\n   */\n  function max(array, byProperty) {\n    return find(array, byProperty, function(value1, value2) {\n      return value1 >= value2;\n    });\n  }\n\n  /**\n   * Finds minimum value in array (not necessarily \"first\" one)\n   * @memberOf fabric.util.array\n   * @param {Array} array Array to iterate over\n   * @param {String} byProperty\n   * @return {*}\n   */\n  function min(array, byProperty) {\n    return find(array, byProperty, function(value1, value2) {\n      return value1 < value2;\n    });\n  }\n\n  /**\n   * @private\n   */\n  function fill(array, value) {\n    var k = array.length;\n    while (k--) {\n      array[k] = value;\n    }\n    return array;\n  }\n\n  /**\n   * @private\n   */\n  function find(array, byProperty, condition) {\n    if (!array || array.length === 0) {\n      return;\n    }\n\n    var i = array.length - 1,\n        result = byProperty ? array[i][byProperty] : array[i];\n    if (byProperty) {\n      while (i--) {\n        if (condition(array[i][byProperty], result)) {\n          result = array[i][byProperty];\n        }\n      }\n    }\n    else {\n      while (i--) {\n        if (condition(array[i], result)) {\n          result = array[i];\n        }\n      }\n    }\n    return result;\n  }\n\n  /**\n   * @namespace fabric.util.array\n   */\n  fabric.util.array = {\n    fill: fill,\n    invoke: invoke,\n    min: min,\n    max: max\n  };\n\n})();\n\n\n(function() {\n  /**\n   * Copies all enumerable properties of one js object to another\n   * this does not and cannot compete with generic utils.\n   * Does not clone or extend fabric.Object subclasses.\n   * This is mostly for internal use and has extra handling for fabricJS objects\n   * it skips the canvas and group properties in deep cloning.\n   * @memberOf fabric.util.object\n   * @param {Object} destination Where to copy to\n   * @param {Object} source Where to copy from\n   * @param {Boolean} [deep] Whether to extend nested objects\n   * @return {Object}\n   */\n\n  function extend(destination, source, deep) {\n    // JScript DontEnum bug is not taken care of\n    // the deep clone is for internal use, is not meant to avoid\n    // javascript traps or cloning html element or self referenced objects.\n    if (deep) {\n      if (!fabric.isLikelyNode && source instanceof Element) {\n        // avoid cloning deep images, canvases,\n        destination = source;\n      }\n      else if (source instanceof Array) {\n        destination = [];\n        for (var i = 0, len = source.length; i < len; i++) {\n          destination[i] = extend({ }, source[i], deep);\n        }\n      }\n      else if (source && typeof source === 'object') {\n        for (var property in source) {\n          if (property === 'canvas' || property === 'group') {\n            // we do not want to clone this props at all.\n            // we want to keep the keys in the copy\n            destination[property] = null;\n          }\n          else if (source.hasOwnProperty(property)) {\n            destination[property] = extend({ }, source[property], deep);\n          }\n        }\n      }\n      else {\n        // this sounds odd for an extend but is ok for recursive use\n        destination = source;\n      }\n    }\n    else {\n      for (var property in source) {\n        destination[property] = source[property];\n      }\n    }\n    return destination;\n  }\n\n  /**\n   * Creates an empty object and copies all enumerable properties of another object to it\n   * This method is mostly for internal use, and not intended for duplicating shapes in canvas. \n   * @memberOf fabric.util.object\n   * @param {Object} object Object to clone\n   * @param {Boolean} [deep] Whether to clone nested objects\n   * @return {Object}\n   */\n\n  //TODO: this function return an empty object if you try to clone null\n  function clone(object, deep) {\n    return extend({ }, object, deep);\n  }\n\n  /** @namespace fabric.util.object */\n  fabric.util.object = {\n    extend: extend,\n    clone: clone\n  };\n  fabric.util.object.extend(fabric.util, fabric.Observable);\n})();\n\n\n(function() {\n\n  /**\n   * Camelizes a string\n   * @memberOf fabric.util.string\n   * @param {String} string String to camelize\n   * @return {String} Camelized version of a string\n   */\n  function camelize(string) {\n    return string.replace(/-+(.)?/g, function(match, character) {\n      return character ? character.toUpperCase() : '';\n    });\n  }\n\n  /**\n   * Capitalizes a string\n   * @memberOf fabric.util.string\n   * @param {String} string String to capitalize\n   * @param {Boolean} [firstLetterOnly] If true only first letter is capitalized\n   * and other letters stay untouched, if false first letter is capitalized\n   * and other letters are converted to lowercase.\n   * @return {String} Capitalized version of a string\n   */\n  function capitalize(string, firstLetterOnly) {\n    return string.charAt(0).toUpperCase() +\n      (firstLetterOnly ? string.slice(1) : string.slice(1).toLowerCase());\n  }\n\n  /**\n   * Escapes XML in a string\n   * @memberOf fabric.util.string\n   * @param {String} string String to escape\n   * @return {String} Escaped version of a string\n   */\n  function escapeXml(string) {\n    return string.replace(/&/g, '&amp;')\n      .replace(/\"/g, '&quot;')\n      .replace(/'/g, '&apos;')\n      .replace(/</g, '&lt;')\n      .replace(/>/g, '&gt;');\n  }\n\n  /**\n   * Divide a string in the user perceived single units\n   * @memberOf fabric.util.string\n   * @param {String} textstring String to escape\n   * @return {Array} array containing the graphemes\n   */\n  function graphemeSplit(textstring) {\n    var i = 0, chr, graphemes = [];\n    for (i = 0, chr; i < textstring.length; i++) {\n      if ((chr = getWholeChar(textstring, i)) === false) {\n        continue;\n      }\n      graphemes.push(chr);\n    }\n    return graphemes;\n  }\n\n  // taken from mdn in the charAt doc page.\n  function getWholeChar(str, i) {\n    var code = str.charCodeAt(i);\n\n    if (isNaN(code)) {\n      return ''; // Position not found\n    }\n    if (code < 0xD800 || code > 0xDFFF) {\n      return str.charAt(i);\n    }\n\n    // High surrogate (could change last hex to 0xDB7F to treat high private\n    // surrogates as single characters)\n    if (0xD800 <= code && code <= 0xDBFF) {\n      if (str.length <= (i + 1)) {\n        throw 'High surrogate without following low surrogate';\n      }\n      var next = str.charCodeAt(i + 1);\n      if (0xDC00 > next || next > 0xDFFF) {\n        throw 'High surrogate without following low surrogate';\n      }\n      return str.charAt(i) + str.charAt(i + 1);\n    }\n    // Low surrogate (0xDC00 <= code && code <= 0xDFFF)\n    if (i === 0) {\n      throw 'Low surrogate without preceding high surrogate';\n    }\n    var prev = str.charCodeAt(i - 1);\n\n    // (could change last hex to 0xDB7F to treat high private\n    // surrogates as single characters)\n    if (0xD800 > prev || prev > 0xDBFF) {\n      throw 'Low surrogate without preceding high surrogate';\n    }\n    // We can pass over low surrogates now as the second component\n    // in a pair which we have already processed\n    return false;\n  }\n\n\n  /**\n   * String utilities\n   * @namespace fabric.util.string\n   */\n  fabric.util.string = {\n    camelize: camelize,\n    capitalize: capitalize,\n    escapeXml: escapeXml,\n    graphemeSplit: graphemeSplit\n  };\n})();\n\n\n(function() {\n\n  var slice = Array.prototype.slice, emptyFunction = function() { },\n\n      IS_DONTENUM_BUGGY = (function() {\n        for (var p in { toString: 1 }) {\n          if (p === 'toString') {\n            return false;\n          }\n        }\n        return true;\n      })(),\n\n      /** @ignore */\n      addMethods = function(klass, source, parent) {\n        for (var property in source) {\n\n          if (property in klass.prototype &&\n              typeof klass.prototype[property] === 'function' &&\n              (source[property] + '').indexOf('callSuper') > -1) {\n\n            klass.prototype[property] = (function(property) {\n              return function() {\n\n                var superclass = this.constructor.superclass;\n                this.constructor.superclass = parent;\n                var returnValue = source[property].apply(this, arguments);\n                this.constructor.superclass = superclass;\n\n                if (property !== 'initialize') {\n                  return returnValue;\n                }\n              };\n            })(property);\n          }\n          else {\n            klass.prototype[property] = source[property];\n          }\n\n          if (IS_DONTENUM_BUGGY) {\n            if (source.toString !== Object.prototype.toString) {\n              klass.prototype.toString = source.toString;\n            }\n            if (source.valueOf !== Object.prototype.valueOf) {\n              klass.prototype.valueOf = source.valueOf;\n            }\n          }\n        }\n      };\n\n  function Subclass() { }\n\n  function callSuper(methodName) {\n    var parentMethod = null,\n        _this = this;\n\n    // climb prototype chain to find method not equal to callee's method\n    while (_this.constructor.superclass) {\n      var superClassMethod = _this.constructor.superclass.prototype[methodName];\n      if (_this[methodName] !== superClassMethod) {\n        parentMethod = superClassMethod;\n        break;\n      }\n      // eslint-disable-next-line\n      _this = _this.constructor.superclass.prototype;\n    }\n\n    if (!parentMethod) {\n      return console.log('tried to callSuper ' + methodName + ', method not found in prototype chain', this);\n    }\n\n    return (arguments.length > 1)\n      ? parentMethod.apply(this, slice.call(arguments, 1))\n      : parentMethod.call(this);\n  }\n\n  /**\n   * Helper for creation of \"classes\".\n   * @memberOf fabric.util\n   * @param {Function} [parent] optional \"Class\" to inherit from\n   * @param {Object} [properties] Properties shared by all instances of this class\n   *                  (be careful modifying objects defined here as this would affect all instances)\n   */\n  function createClass() {\n    var parent = null,\n        properties = slice.call(arguments, 0);\n\n    if (typeof properties[0] === 'function') {\n      parent = properties.shift();\n    }\n    function klass() {\n      this.initialize.apply(this, arguments);\n    }\n\n    klass.superclass = parent;\n    klass.subclasses = [];\n\n    if (parent) {\n      Subclass.prototype = parent.prototype;\n      klass.prototype = new Subclass();\n      parent.subclasses.push(klass);\n    }\n    for (var i = 0, length = properties.length; i < length; i++) {\n      addMethods(klass, properties[i], parent);\n    }\n    if (!klass.prototype.initialize) {\n      klass.prototype.initialize = emptyFunction;\n    }\n    klass.prototype.constructor = klass;\n    klass.prototype.callSuper = callSuper;\n    return klass;\n  }\n\n  fabric.util.createClass = createClass;\n})();\n\n\n(function () {\n  // since ie11 can use addEventListener but they do not support options, i need to check\n  var couldUseAttachEvent = !!fabric.document.createElement('div').attachEvent,\n      touchEvents = ['touchstart', 'touchmove', 'touchend'];\n  /**\n   * Adds an event listener to an element\n   * @function\n   * @memberOf fabric.util\n   * @param {HTMLElement} element\n   * @param {String} eventName\n   * @param {Function} handler\n   */\n  fabric.util.addListener = function(element, eventName, handler, options) {\n    element && element.addEventListener(eventName, handler, couldUseAttachEvent ? false : options);\n  };\n\n  /**\n   * Removes an event listener from an element\n   * @function\n   * @memberOf fabric.util\n   * @param {HTMLElement} element\n   * @param {String} eventName\n   * @param {Function} handler\n   */\n  fabric.util.removeListener = function(element, eventName, handler, options) {\n    element && element.removeEventListener(eventName, handler, couldUseAttachEvent ? false : options);\n  };\n\n  function getTouchInfo(event) {\n    var touchProp = event.changedTouches;\n    if (touchProp && touchProp[0]) {\n      return touchProp[0];\n    }\n    return event;\n  }\n\n  fabric.util.getPointer = function(event) {\n    var element = event.target,\n        scroll = fabric.util.getScrollLeftTop(element),\n        _evt = getTouchInfo(event);\n    return {\n      x: _evt.clientX + scroll.left,\n      y: _evt.clientY + scroll.top\n    };\n  };\n\n  fabric.util.isTouchEvent = function(event) {\n    return touchEvents.indexOf(event.type) > -1 || event.pointerType === 'touch';\n  };\n})();\n\n\n(function () {\n\n  /**\n   * Cross-browser wrapper for setting element's style\n   * @memberOf fabric.util\n   * @param {HTMLElement} element\n   * @param {Object} styles\n   * @return {HTMLElement} Element that was passed as a first argument\n   */\n  function setStyle(element, styles) {\n    var elementStyle = element.style;\n    if (!elementStyle) {\n      return element;\n    }\n    if (typeof styles === 'string') {\n      element.style.cssText += ';' + styles;\n      return styles.indexOf('opacity') > -1\n        ? setOpacity(element, styles.match(/opacity:\\s*(\\d?\\.?\\d*)/)[1])\n        : element;\n    }\n    for (var property in styles) {\n      if (property === 'opacity') {\n        setOpacity(element, styles[property]);\n      }\n      else {\n        var normalizedProperty = (property === 'float' || property === 'cssFloat')\n          ? (typeof elementStyle.styleFloat === 'undefined' ? 'cssFloat' : 'styleFloat')\n          : property;\n        elementStyle.setProperty(normalizedProperty, styles[property]);\n      }\n    }\n    return element;\n  }\n\n  var parseEl = fabric.document.createElement('div'),\n      supportsOpacity = typeof parseEl.style.opacity === 'string',\n      supportsFilters = typeof parseEl.style.filter === 'string',\n      reOpacity = /alpha\\s*\\(\\s*opacity\\s*=\\s*([^\\)]+)\\)/,\n\n      /** @ignore */\n      setOpacity = function (element) { return element; };\n\n  if (supportsOpacity) {\n    /** @ignore */\n    setOpacity = function(element, value) {\n      element.style.opacity = value;\n      return element;\n    };\n  }\n  else if (supportsFilters) {\n    /** @ignore */\n    setOpacity = function(element, value) {\n      var es = element.style;\n      if (element.currentStyle && !element.currentStyle.hasLayout) {\n        es.zoom = 1;\n      }\n      if (reOpacity.test(es.filter)) {\n        value = value >= 0.9999 ? '' : ('alpha(opacity=' + (value * 100) + ')');\n        es.filter = es.filter.replace(reOpacity, value);\n      }\n      else {\n        es.filter += ' alpha(opacity=' + (value * 100) + ')';\n      }\n      return element;\n    };\n  }\n\n  fabric.util.setStyle = setStyle;\n\n})();\n\n\n(function() {\n\n  var _slice = Array.prototype.slice;\n\n  /**\n   * Takes id and returns an element with that id (if one exists in a document)\n   * @memberOf fabric.util\n   * @param {String|HTMLElement} id\n   * @return {HTMLElement|null}\n   */\n  function getById(id) {\n    return typeof id === 'string' ? fabric.document.getElementById(id) : id;\n  }\n\n  var sliceCanConvertNodelists,\n      /**\n       * Converts an array-like object (e.g. arguments or NodeList) to an array\n       * @memberOf fabric.util\n       * @param {Object} arrayLike\n       * @return {Array}\n       */\n      toArray = function(arrayLike) {\n        return _slice.call(arrayLike, 0);\n      };\n\n  try {\n    sliceCanConvertNodelists = toArray(fabric.document.childNodes) instanceof Array;\n  }\n  catch (err) { }\n\n  if (!sliceCanConvertNodelists) {\n    toArray = function(arrayLike) {\n      var arr = new Array(arrayLike.length), i = arrayLike.length;\n      while (i--) {\n        arr[i] = arrayLike[i];\n      }\n      return arr;\n    };\n  }\n\n  /**\n   * Creates specified element with specified attributes\n   * @memberOf fabric.util\n   * @param {String} tagName Type of an element to create\n   * @param {Object} [attributes] Attributes to set on an element\n   * @return {HTMLElement} Newly created element\n   */\n  function makeElement(tagName, attributes) {\n    var el = fabric.document.createElement(tagName);\n    for (var prop in attributes) {\n      if (prop === 'class') {\n        el.className = attributes[prop];\n      }\n      else if (prop === 'for') {\n        el.htmlFor = attributes[prop];\n      }\n      else {\n        el.setAttribute(prop, attributes[prop]);\n      }\n    }\n    return el;\n  }\n\n  /**\n   * Adds class to an element\n   * @memberOf fabric.util\n   * @param {HTMLElement} element Element to add class to\n   * @param {String} className Class to add to an element\n   */\n  function addClass(element, className) {\n    if (element && (' ' + element.className + ' ').indexOf(' ' + className + ' ') === -1) {\n      element.className += (element.className ? ' ' : '') + className;\n    }\n  }\n\n  /**\n   * Wraps element with another element\n   * @memberOf fabric.util\n   * @param {HTMLElement} element Element to wrap\n   * @param {HTMLElement|String} wrapper Element to wrap with\n   * @param {Object} [attributes] Attributes to set on a wrapper\n   * @return {HTMLElement} wrapper\n   */\n  function wrapElement(element, wrapper, attributes) {\n    if (typeof wrapper === 'string') {\n      wrapper = makeElement(wrapper, attributes);\n    }\n    if (element.parentNode) {\n      element.parentNode.replaceChild(wrapper, element);\n    }\n    wrapper.appendChild(element);\n    return wrapper;\n  }\n\n  /**\n   * Returns element scroll offsets\n   * @memberOf fabric.util\n   * @param {HTMLElement} element Element to operate on\n   * @return {Object} Object with left/top values\n   */\n  function getScrollLeftTop(element) {\n\n    var left = 0,\n        top = 0,\n        docElement = fabric.document.documentElement,\n        body = fabric.document.body || {\n          scrollLeft: 0, scrollTop: 0\n        };\n\n    // While loop checks (and then sets element to) .parentNode OR .host\n    //  to account for ShadowDOM. We still want to traverse up out of ShadowDOM,\n    //  but the .parentNode of a root ShadowDOM node will always be null, instead\n    //  it should be accessed through .host. See http://stackoverflow.com/a/24765528/4383938\n    while (element && (element.parentNode || element.host)) {\n\n      // Set element to element parent, or 'host' in case of ShadowDOM\n      element = element.parentNode || element.host;\n\n      if (element === fabric.document) {\n        left = body.scrollLeft || docElement.scrollLeft || 0;\n        top = body.scrollTop ||  docElement.scrollTop || 0;\n      }\n      else {\n        left += element.scrollLeft || 0;\n        top += element.scrollTop || 0;\n      }\n\n      if (element.nodeType === 1 && element.style.position === 'fixed') {\n        break;\n      }\n    }\n\n    return { left: left, top: top };\n  }\n\n  /**\n   * Returns offset for a given element\n   * @function\n   * @memberOf fabric.util\n   * @param {HTMLElement} element Element to get offset for\n   * @return {Object} Object with \"left\" and \"top\" properties\n   */\n  function getElementOffset(element) {\n    var docElem,\n        doc = element && element.ownerDocument,\n        box = { left: 0, top: 0 },\n        offset = { left: 0, top: 0 },\n        scrollLeftTop,\n        offsetAttributes = {\n          borderLeftWidth: 'left',\n          borderTopWidth:  'top',\n          paddingLeft:     'left',\n          paddingTop:      'top'\n        };\n\n    if (!doc) {\n      return offset;\n    }\n\n    for (var attr in offsetAttributes) {\n      offset[offsetAttributes[attr]] += parseInt(getElementStyle(element, attr), 10) || 0;\n    }\n\n    docElem = doc.documentElement;\n    if ( typeof element.getBoundingClientRect !== 'undefined' ) {\n      box = element.getBoundingClientRect();\n    }\n\n    scrollLeftTop = getScrollLeftTop(element);\n\n    return {\n      left: box.left + scrollLeftTop.left - (docElem.clientLeft || 0) + offset.left,\n      top: box.top + scrollLeftTop.top - (docElem.clientTop || 0)  + offset.top\n    };\n  }\n\n  /**\n   * Returns style attribute value of a given element\n   * @memberOf fabric.util\n   * @param {HTMLElement} element Element to get style attribute for\n   * @param {String} attr Style attribute to get for element\n   * @return {String} Style attribute value of the given element.\n   */\n  var getElementStyle;\n  if (fabric.document.defaultView && fabric.document.defaultView.getComputedStyle) {\n    getElementStyle = function(element, attr) {\n      var style = fabric.document.defaultView.getComputedStyle(element, null);\n      return style ? style[attr] : undefined;\n    };\n  }\n  else {\n    getElementStyle = function(element, attr) {\n      var value = element.style[attr];\n      if (!value && element.currentStyle) {\n        value = element.currentStyle[attr];\n      }\n      return value;\n    };\n  }\n\n  (function () {\n    var style = fabric.document.documentElement.style,\n        selectProp = 'userSelect' in style\n          ? 'userSelect'\n          : 'MozUserSelect' in style\n            ? 'MozUserSelect'\n            : 'WebkitUserSelect' in style\n              ? 'WebkitUserSelect'\n              : 'KhtmlUserSelect' in style\n                ? 'KhtmlUserSelect'\n                : '';\n\n    /**\n     * Makes element unselectable\n     * @memberOf fabric.util\n     * @param {HTMLElement} element Element to make unselectable\n     * @return {HTMLElement} Element that was passed in\n     */\n    function makeElementUnselectable(element) {\n      if (typeof element.onselectstart !== 'undefined') {\n        element.onselectstart = fabric.util.falseFunction;\n      }\n      if (selectProp) {\n        element.style[selectProp] = 'none';\n      }\n      else if (typeof element.unselectable === 'string') {\n        element.unselectable = 'on';\n      }\n      return element;\n    }\n\n    /**\n     * Makes element selectable\n     * @memberOf fabric.util\n     * @param {HTMLElement} element Element to make selectable\n     * @return {HTMLElement} Element that was passed in\n     */\n    function makeElementSelectable(element) {\n      if (typeof element.onselectstart !== 'undefined') {\n        element.onselectstart = null;\n      }\n      if (selectProp) {\n        element.style[selectProp] = '';\n      }\n      else if (typeof element.unselectable === 'string') {\n        element.unselectable = '';\n      }\n      return element;\n    }\n\n    fabric.util.makeElementUnselectable = makeElementUnselectable;\n    fabric.util.makeElementSelectable = makeElementSelectable;\n  })();\n\n  function getNodeCanvas(element) {\n    var impl = fabric.jsdomImplForWrapper(element);\n    return impl._canvas || impl._image;\n  };\n\n  function cleanUpJsdomNode(element) {\n    if (!fabric.isLikelyNode) {\n      return;\n    }\n    var impl = fabric.jsdomImplForWrapper(element);\n    if (impl) {\n      impl._image = null;\n      impl._canvas = null;\n      // unsure if necessary\n      impl._currentSrc = null;\n      impl._attributes = null;\n      impl._classList = null;\n    }\n  }\n\n  function setImageSmoothing(ctx, value) {\n    ctx.imageSmoothingEnabled = ctx.imageSmoothingEnabled || ctx.webkitImageSmoothingEnabled\n      || ctx.mozImageSmoothingEnabled || ctx.msImageSmoothingEnabled || ctx.oImageSmoothingEnabled;\n    ctx.imageSmoothingEnabled = value;\n  }\n\n  /**\n   * setImageSmoothing sets the context imageSmoothingEnabled property.\n   * Used by canvas and by ImageObject.\n   * @memberOf fabric.util\n   * @since 4.0.0\n   * @param {HTMLRenderingContext2D} ctx to set on\n   * @param {Boolean} value true or false\n   */\n  fabric.util.setImageSmoothing = setImageSmoothing;\n  fabric.util.getById = getById;\n  fabric.util.toArray = toArray;\n  fabric.util.addClass = addClass;\n  fabric.util.makeElement = makeElement;\n  fabric.util.wrapElement = wrapElement;\n  fabric.util.getScrollLeftTop = getScrollLeftTop;\n  fabric.util.getElementOffset = getElementOffset;\n  fabric.util.getNodeCanvas = getNodeCanvas;\n  fabric.util.cleanUpJsdomNode = cleanUpJsdomNode;\n\n})();\n\n\n(function() {\n\n  function addParamToUrl(url, param) {\n    return url + (/\\?/.test(url) ? '&' : '?') + param;\n  }\n\n  function emptyFn() { }\n\n  /**\n   * Cross-browser abstraction for sending XMLHttpRequest\n   * @memberOf fabric.util\n   * @param {String} url URL to send XMLHttpRequest to\n   * @param {Object} [options] Options object\n   * @param {String} [options.method=\"GET\"]\n   * @param {String} [options.parameters] parameters to append to url in GET or in body\n   * @param {String} [options.body] body to send with POST or PUT request\n   * @param {Function} options.onComplete Callback to invoke when request is completed\n   * @return {XMLHttpRequest} request\n   */\n  function request(url, options) {\n    options || (options = { });\n\n    var method = options.method ? options.method.toUpperCase() : 'GET',\n        onComplete = options.onComplete || function() { },\n        xhr = new fabric.window.XMLHttpRequest(),\n        body = options.body || options.parameters;\n\n    /** @ignore */\n    xhr.onreadystatechange = function() {\n      if (xhr.readyState === 4) {\n        onComplete(xhr);\n        xhr.onreadystatechange = emptyFn;\n      }\n    };\n\n    if (method === 'GET') {\n      body = null;\n      if (typeof options.parameters === 'string') {\n        url = addParamToUrl(url, options.parameters);\n      }\n    }\n\n    xhr.open(method, url, true);\n\n    if (method === 'POST' || method === 'PUT') {\n      xhr.setRequestHeader('Content-Type', 'application/x-www-form-urlencoded');\n    }\n\n    xhr.send(body);\n    return xhr;\n  }\n\n  fabric.util.request = request;\n})();\n\n\n/**\n * Wrapper around `console.log` (when available)\n * @param {*} [values] Values to log\n */\nfabric.log = console.log;\n\n/**\n * Wrapper around `console.warn` (when available)\n * @param {*} [values] Values to log as a warning\n */\nfabric.warn = console.warn;\n\n\n(function () {\n\n  var extend = fabric.util.object.extend,\n      clone = fabric.util.object.clone;\n\n  /**\n   * @typedef {Object} AnimationOptions\n   * Animation of a value or list of values.\n   * When using lists, think of something like this:\n   * fabric.util.animate({\n   *   startValue: [1, 2, 3],\n   *   endValue: [2, 4, 6],\n   *   onChange: function([a, b, c]) {\n   *     canvas.zoomToPoint({x: b, y: c}, a)\n   *     canvas.renderAll()\n   *   }\n   * });\n   * @example\n   * @property {Function} [onChange] Callback; invoked on every value change\n   * @property {Function} [onComplete] Callback; invoked when value change is completed\n   * @example\n   * // Note: startValue, endValue, and byValue must match the type\n   * var animationOptions = { startValue: 0, endValue: 1, byValue: 0.25 }\n   * var animationOptions = { startValue: [0, 1], endValue: [1, 2], byValue: [0.25, 0.25] }\n   * @property {number | number[]} [startValue=0] Starting value\n   * @property {number | number[]} [endValue=100] Ending value\n   * @property {number | number[]} [byValue=100] Value to modify the property by\n   * @property {Function} [easing] Easing function\n   * @property {Number} [duration=500] Duration of change (in ms)\n   * @property {Function} [abort] Additional function with logic. If returns true, animation aborts.\n   *\n   * @typedef {() => void} CancelFunction\n   *\n   * @typedef {Object} AnimationCurrentState\n   * @property {number | number[]} currentValue value in range [`startValue`, `endValue`]\n   * @property {number} completionRate value in range [0, 1]\n   * @property {number} durationRate value in range [0, 1]\n   *\n   * @typedef {(AnimationOptions & AnimationCurrentState & { cancel: CancelFunction }} AnimationContext\n   */\n\n  /**\n   * Array holding all running animations\n   * @memberof fabric\n   * @type {AnimationContext[]}\n   */\n  var RUNNING_ANIMATIONS = [];\n  fabric.util.object.extend(RUNNING_ANIMATIONS, {\n\n    /**\n     * cancel all running animations at the next requestAnimFrame\n     * @returns {AnimationContext[]}\n     */\n    cancelAll: function () {\n      var animations = this.splice(0);\n      animations.forEach(function (animation) {\n        animation.cancel();\n      });\n      return animations;\n    },\n\n    /**\n     * cancel all running animations attached to canvas at the next requestAnimFrame\n     * @param {fabric.Canvas} canvas\n     * @returns {AnimationContext[]}\n     */\n    cancelByCanvas: function (canvas) {\n      if (!canvas) {\n        return [];\n      }\n      var cancelled = this.filter(function (animation) {\n        return typeof animation.target === 'object' && animation.target.canvas === canvas;\n      });\n      cancelled.forEach(function (animation) {\n        animation.cancel();\n      });\n      return cancelled;\n    },\n\n    /**\n     * cancel all running animations for target at the next requestAnimFrame\n     * @param {*} target\n     * @returns {AnimationContext[]}\n     */\n    cancelByTarget: function (target) {\n      var cancelled = this.findAnimationsByTarget(target);\n      cancelled.forEach(function (animation) {\n        animation.cancel();\n      });\n      return cancelled;\n    },\n\n    /**\n     *\n     * @param {CancelFunction} cancelFunc the function returned by animate\n     * @returns {number}\n     */\n    findAnimationIndex: function (cancelFunc) {\n      return this.indexOf(this.findAnimation(cancelFunc));\n    },\n\n    /**\n     *\n     * @param {CancelFunction} cancelFunc the function returned by animate\n     * @returns {AnimationContext | undefined} animation's options object\n     */\n    findAnimation: function (cancelFunc) {\n      return this.find(function (animation) {\n        return animation.cancel === cancelFunc;\n      });\n    },\n\n    /**\n     *\n     * @param {*} target the object that is assigned to the target property of the animation context\n     * @returns {AnimationContext[]} array of animation options object associated with target\n     */\n    findAnimationsByTarget: function (target) {\n      if (!target) {\n        return [];\n      }\n      return this.filter(function (animation) {\n        return animation.target === target;\n      });\n    }\n  });\n\n  function noop() {\n    return false;\n  }\n\n  function defaultEasing(t, b, c, d) {\n    return -c * Math.cos(t / d * (Math.PI / 2)) + c + b;\n  }\n\n  /**\n   * Changes value from one to another within certain period of time, invoking callbacks as value is being changed.\n   * @memberOf fabric.util\n   * @param {AnimationOptions} [options] Animation options\n   * @example\n   * // Note: startValue, endValue, and byValue must match the type\n   * fabric.util.animate({ startValue: 0, endValue: 1, byValue: 0.25 })\n   * fabric.util.animate({ startValue: [0, 1], endValue: [1, 2], byValue: [0.25, 0.25] })\n   * @returns {CancelFunction} cancel function\n   */\n  function animate(options) {\n    options || (options = {});\n    var cancel = false,\n        context,\n        removeFromRegistry = function () {\n          var index = fabric.runningAnimations.indexOf(context);\n          return index > -1 && fabric.runningAnimations.splice(index, 1)[0];\n        };\n\n    context = extend(clone(options), {\n      cancel: function () {\n        cancel = true;\n        return removeFromRegistry();\n      },\n      currentValue: 'startValue' in options ? options.startValue : 0,\n      completionRate: 0,\n      durationRate: 0\n    });\n    fabric.runningAnimations.push(context);\n\n    requestAnimFrame(function(timestamp) {\n      var start = timestamp || +new Date(),\n          duration = options.duration || 500,\n          finish = start + duration, time,\n          onChange = options.onChange || noop,\n          abort = options.abort || noop,\n          onComplete = options.onComplete || noop,\n          easing = options.easing || defaultEasing,\n          isMany = 'startValue' in options ? options.startValue.length > 0 : false,\n          startValue = 'startValue' in options ? options.startValue : 0,\n          endValue = 'endValue' in options ? options.endValue : 100,\n          byValue = options.byValue || (isMany ? startValue.map(function(value, i) {\n            return endValue[i] - startValue[i];\n          }) : endValue - startValue);\n\n      options.onStart && options.onStart();\n\n      (function tick(ticktime) {\n        time = ticktime || +new Date();\n        var currentTime = time > finish ? duration : (time - start),\n            timePerc = currentTime / duration,\n            current = isMany ? startValue.map(function(_value, i) {\n              return easing(currentTime, startValue[i], byValue[i], duration);\n            }) : easing(currentTime, startValue, byValue, duration),\n            valuePerc = isMany ? Math.abs((current[0] - startValue[0]) / byValue[0])\n              : Math.abs((current - startValue) / byValue);\n        //  update context\n        context.currentValue = isMany ? current.slice() : current;\n        context.completionRate = valuePerc;\n        context.durationRate = timePerc;\n        if (cancel) {\n          return;\n        }\n        if (abort(current, valuePerc, timePerc)) {\n          removeFromRegistry();\n          return;\n        }\n        if (time > finish) {\n          //  update context\n          context.currentValue = isMany ? endValue.slice() : endValue;\n          context.completionRate = 1;\n          context.durationRate = 1;\n          //  execute callbacks\n          onChange(isMany ? endValue.slice() : endValue, 1, 1);\n          onComplete(endValue, 1, 1);\n          removeFromRegistry();\n          return;\n        }\n        else {\n          onChange(current, valuePerc, timePerc);\n          requestAnimFrame(tick);\n        }\n      })(start);\n    });\n\n    return context.cancel;\n  }\n\n  var _requestAnimFrame = fabric.window.requestAnimationFrame       ||\n                          fabric.window.webkitRequestAnimationFrame ||\n                          fabric.window.mozRequestAnimationFrame    ||\n                          fabric.window.oRequestAnimationFrame      ||\n                          fabric.window.msRequestAnimationFrame     ||\n                          function(callback) {\n                            return fabric.window.setTimeout(callback, 1000 / 60);\n                          };\n\n  var _cancelAnimFrame = fabric.window.cancelAnimationFrame || fabric.window.clearTimeout;\n\n  /**\n   * requestAnimationFrame polyfill based on http://paulirish.com/2011/requestanimationframe-for-smart-animating/\n   * In order to get a precise start time, `requestAnimFrame` should be called as an entry into the method\n   * @memberOf fabric.util\n   * @param {Function} callback Callback to invoke\n   * @param {DOMElement} element optional Element to associate with animation\n   */\n  function requestAnimFrame() {\n    return _requestAnimFrame.apply(fabric.window, arguments);\n  }\n\n  function cancelAnimFrame() {\n    return _cancelAnimFrame.apply(fabric.window, arguments);\n  }\n\n  fabric.util.animate = animate;\n  fabric.util.requestAnimFrame = requestAnimFrame;\n  fabric.util.cancelAnimFrame = cancelAnimFrame;\n  fabric.runningAnimations = RUNNING_ANIMATIONS;\n})();\n\n\n(function() {\n  // Calculate an in-between color. Returns a \"rgba()\" string.\n  // Credit: Edwin Martin <edwin@bitstorm.org>\n  //         http://www.bitstorm.org/jquery/color-animation/jquery.animate-colors.js\n  function calculateColor(begin, end, pos) {\n    var color = 'rgba('\n        + parseInt((begin[0] + pos * (end[0] - begin[0])), 10) + ','\n        + parseInt((begin[1] + pos * (end[1] - begin[1])), 10) + ','\n        + parseInt((begin[2] + pos * (end[2] - begin[2])), 10);\n\n    color += ',' + (begin && end ? parseFloat(begin[3] + pos * (end[3] - begin[3])) : 1);\n    color += ')';\n    return color;\n  }\n\n  /**\n   * Changes the color from one to another within certain period of time, invoking callbacks as value is being changed.\n   * @memberOf fabric.util\n   * @param {String} fromColor The starting color in hex or rgb(a) format.\n   * @param {String} toColor The starting color in hex or rgb(a) format.\n   * @param {Number} [duration] Duration of change (in ms).\n   * @param {Object} [options] Animation options\n   * @param {Function} [options.onChange] Callback; invoked on every value change\n   * @param {Function} [options.onComplete] Callback; invoked when value change is completed\n   * @param {Function} [options.colorEasing] Easing function. Note that this function only take two arguments (currentTime, duration). Thus the regular animation easing functions cannot be used.\n   * @param {Function} [options.abort] Additional function with logic. If returns true, onComplete is called.\n   * @returns {Function} abort function\n   */\n  function animateColor(fromColor, toColor, duration, options) {\n    var startColor = new fabric.Color(fromColor).getSource(),\n        endColor = new fabric.Color(toColor).getSource(),\n        originalOnComplete = options.onComplete,\n        originalOnChange = options.onChange;\n    options = options || {};\n\n    return fabric.util.animate(fabric.util.object.extend(options, {\n      duration: duration || 500,\n      startValue: startColor,\n      endValue: endColor,\n      byValue: endColor,\n      easing: function (currentTime, startValue, byValue, duration) {\n        var posValue = options.colorEasing\n          ? options.colorEasing(currentTime, duration)\n          : 1 - Math.cos(currentTime / duration * (Math.PI / 2));\n        return calculateColor(startValue, byValue, posValue);\n      },\n      // has to take in account for color restoring;\n      onComplete: function(current, valuePerc, timePerc) {\n        if (originalOnComplete) {\n          return originalOnComplete(\n            calculateColor(endColor, endColor, 0),\n            valuePerc,\n            timePerc\n          );\n        }\n      },\n      onChange: function(current, valuePerc, timePerc) {\n        if (originalOnChange) {\n          if (Array.isArray(current)) {\n            return originalOnChange(\n              calculateColor(current, current, 0),\n              valuePerc,\n              timePerc\n            );\n          }\n          originalOnChange(current, valuePerc, timePerc);\n        }\n      }\n    }));\n  }\n\n  fabric.util.animateColor = animateColor;\n\n})();\n\n\n(function() {\n\n  function normalize(a, c, p, s) {\n    if (a < Math.abs(c)) {\n      a = c;\n      s = p / 4;\n    }\n    else {\n      //handle the 0/0 case:\n      if (c === 0 && a === 0) {\n        s = p / (2 * Math.PI) * Math.asin(1);\n      }\n      else {\n        s = p / (2 * Math.PI) * Math.asin(c / a);\n      }\n    }\n    return { a: a, c: c, p: p, s: s };\n  }\n\n  function elastic(opts, t, d) {\n    return opts.a *\n      Math.pow(2, 10 * (t -= 1)) *\n      Math.sin( (t * d - opts.s) * (2 * Math.PI) / opts.p );\n  }\n\n  /**\n   * Cubic easing out\n   * @memberOf fabric.util.ease\n   */\n  function easeOutCubic(t, b, c, d) {\n    return c * ((t = t / d - 1) * t * t + 1) + b;\n  }\n\n  /**\n   * Cubic easing in and out\n   * @memberOf fabric.util.ease\n   */\n  function easeInOutCubic(t, b, c, d) {\n    t /= d / 2;\n    if (t < 1) {\n      return c / 2 * t * t * t + b;\n    }\n    return c / 2 * ((t -= 2) * t * t + 2) + b;\n  }\n\n  /**\n   * Quartic easing in\n   * @memberOf fabric.util.ease\n   */\n  function easeInQuart(t, b, c, d) {\n    return c * (t /= d) * t * t * t + b;\n  }\n\n  /**\n   * Quartic easing out\n   * @memberOf fabric.util.ease\n   */\n  function easeOutQuart(t, b, c, d) {\n    return -c * ((t = t / d - 1) * t * t * t - 1) + b;\n  }\n\n  /**\n   * Quartic easing in and out\n   * @memberOf fabric.util.ease\n   */\n  function easeInOutQuart(t, b, c, d) {\n    t /= d / 2;\n    if (t < 1) {\n      return c / 2 * t * t * t * t + b;\n    }\n    return -c / 2 * ((t -= 2) * t * t * t - 2) + b;\n  }\n\n  /**\n   * Quintic easing in\n   * @memberOf fabric.util.ease\n   */\n  function easeInQuint(t, b, c, d) {\n    return c * (t /= d) * t * t * t * t + b;\n  }\n\n  /**\n   * Quintic easing out\n   * @memberOf fabric.util.ease\n   */\n  function easeOutQuint(t, b, c, d) {\n    return c * ((t = t / d - 1) * t * t * t * t + 1) + b;\n  }\n\n  /**\n   * Quintic easing in and out\n   * @memberOf fabric.util.ease\n   */\n  function easeInOutQuint(t, b, c, d) {\n    t /= d / 2;\n    if (t < 1) {\n      return c / 2 * t * t * t * t * t + b;\n    }\n    return c / 2 * ((t -= 2) * t * t * t * t + 2) + b;\n  }\n\n  /**\n   * Sinusoidal easing in\n   * @memberOf fabric.util.ease\n   */\n  function easeInSine(t, b, c, d) {\n    return -c * Math.cos(t / d * (Math.PI / 2)) + c + b;\n  }\n\n  /**\n   * Sinusoidal easing out\n   * @memberOf fabric.util.ease\n   */\n  function easeOutSine(t, b, c, d) {\n    return c * Math.sin(t / d * (Math.PI / 2)) + b;\n  }\n\n  /**\n   * Sinusoidal easing in and out\n   * @memberOf fabric.util.ease\n   */\n  function easeInOutSine(t, b, c, d) {\n    return -c / 2 * (Math.cos(Math.PI * t / d) - 1) + b;\n  }\n\n  /**\n   * Exponential easing in\n   * @memberOf fabric.util.ease\n   */\n  function easeInExpo(t, b, c, d) {\n    return (t === 0) ? b : c * Math.pow(2, 10 * (t / d - 1)) + b;\n  }\n\n  /**\n   * Exponential easing out\n   * @memberOf fabric.util.ease\n   */\n  function easeOutExpo(t, b, c, d) {\n    return (t === d) ? b + c : c * (-Math.pow(2, -10 * t / d) + 1) + b;\n  }\n\n  /**\n   * Exponential easing in and out\n   * @memberOf fabric.util.ease\n   */\n  function easeInOutExpo(t, b, c, d) {\n    if (t === 0) {\n      return b;\n    }\n    if (t === d) {\n      return b + c;\n    }\n    t /= d / 2;\n    if (t < 1) {\n      return c / 2 * Math.pow(2, 10 * (t - 1)) + b;\n    }\n    return c / 2 * (-Math.pow(2, -10 * --t) + 2) + b;\n  }\n\n  /**\n   * Circular easing in\n   * @memberOf fabric.util.ease\n   */\n  function easeInCirc(t, b, c, d) {\n    return -c * (Math.sqrt(1 - (t /= d) * t) - 1) + b;\n  }\n\n  /**\n   * Circular easing out\n   * @memberOf fabric.util.ease\n   */\n  function easeOutCirc(t, b, c, d) {\n    return c * Math.sqrt(1 - (t = t / d - 1) * t) + b;\n  }\n\n  /**\n   * Circular easing in and out\n   * @memberOf fabric.util.ease\n   */\n  function easeInOutCirc(t, b, c, d) {\n    t /= d / 2;\n    if (t < 1) {\n      return -c / 2 * (Math.sqrt(1 - t * t) - 1) + b;\n    }\n    return c / 2 * (Math.sqrt(1 - (t -= 2) * t) + 1) + b;\n  }\n\n  /**\n   * Elastic easing in\n   * @memberOf fabric.util.ease\n   */\n  function easeInElastic(t, b, c, d) {\n    var s = 1.70158, p = 0, a = c;\n    if (t === 0) {\n      return b;\n    }\n    t /= d;\n    if (t === 1) {\n      return b + c;\n    }\n    if (!p) {\n      p = d * 0.3;\n    }\n    var opts = normalize(a, c, p, s);\n    return -elastic(opts, t, d) + b;\n  }\n\n  /**\n   * Elastic easing out\n   * @memberOf fabric.util.ease\n   */\n  function easeOutElastic(t, b, c, d) {\n    var s = 1.70158, p = 0, a = c;\n    if (t === 0) {\n      return b;\n    }\n    t /= d;\n    if (t === 1) {\n      return b + c;\n    }\n    if (!p) {\n      p = d * 0.3;\n    }\n    var opts = normalize(a, c, p, s);\n    return opts.a * Math.pow(2, -10 * t) * Math.sin((t * d - opts.s) * (2 * Math.PI) / opts.p ) + opts.c + b;\n  }\n\n  /**\n   * Elastic easing in and out\n   * @memberOf fabric.util.ease\n   */\n  function easeInOutElastic(t, b, c, d) {\n    var s = 1.70158, p = 0, a = c;\n    if (t === 0) {\n      return b;\n    }\n    t /= d / 2;\n    if (t === 2) {\n      return b + c;\n    }\n    if (!p) {\n      p = d * (0.3 * 1.5);\n    }\n    var opts = normalize(a, c, p, s);\n    if (t < 1) {\n      return -0.5 * elastic(opts, t, d) + b;\n    }\n    return opts.a * Math.pow(2, -10 * (t -= 1)) *\n      Math.sin((t * d - opts.s) * (2 * Math.PI) / opts.p ) * 0.5 + opts.c + b;\n  }\n\n  /**\n   * Backwards easing in\n   * @memberOf fabric.util.ease\n   */\n  function easeInBack(t, b, c, d, s) {\n    if (s === undefined) {\n      s = 1.70158;\n    }\n    return c * (t /= d) * t * ((s + 1) * t - s) + b;\n  }\n\n  /**\n   * Backwards easing out\n   * @memberOf fabric.util.ease\n   */\n  function easeOutBack(t, b, c, d, s) {\n    if (s === undefined) {\n      s = 1.70158;\n    }\n    return c * ((t = t / d - 1) * t * ((s + 1) * t + s) + 1) + b;\n  }\n\n  /**\n   * Backwards easing in and out\n   * @memberOf fabric.util.ease\n   */\n  function easeInOutBack(t, b, c, d, s) {\n    if (s === undefined) {\n      s = 1.70158;\n    }\n    t /= d / 2;\n    if (t < 1) {\n      return c / 2 * (t * t * (((s *= (1.525)) + 1) * t - s)) + b;\n    }\n    return c / 2 * ((t -= 2) * t * (((s *= (1.525)) + 1) * t + s) + 2) + b;\n  }\n\n  /**\n   * Bouncing easing in\n   * @memberOf fabric.util.ease\n   */\n  function easeInBounce(t, b, c, d) {\n    return c - easeOutBounce (d - t, 0, c, d) + b;\n  }\n\n  /**\n   * Bouncing easing out\n   * @memberOf fabric.util.ease\n   */\n  function easeOutBounce(t, b, c, d) {\n    if ((t /= d) < (1 / 2.75)) {\n      return c * (7.5625 * t * t) + b;\n    }\n    else if (t < (2 / 2.75)) {\n      return c * (7.5625 * (t -= (1.5 / 2.75)) * t + 0.75) + b;\n    }\n    else if (t < (2.5 / 2.75)) {\n      return c * (7.5625 * (t -= (2.25 / 2.75)) * t + 0.9375) + b;\n    }\n    else {\n      return c * (7.5625 * (t -= (2.625 / 2.75)) * t + 0.984375) + b;\n    }\n  }\n\n  /**\n   * Bouncing easing in and out\n   * @memberOf fabric.util.ease\n   */\n  function easeInOutBounce(t, b, c, d) {\n    if (t < d / 2) {\n      return easeInBounce (t * 2, 0, c, d) * 0.5 + b;\n    }\n    return easeOutBounce(t * 2 - d, 0, c, d) * 0.5 + c * 0.5 + b;\n  }\n\n  /**\n   * Easing functions\n   * See <a href=\"http://gizma.com/easing/\">Easing Equations by Robert Penner</a>\n   * @namespace fabric.util.ease\n   */\n  fabric.util.ease = {\n\n    /**\n     * Quadratic easing in\n     * @memberOf fabric.util.ease\n     */\n    easeInQuad: function(t, b, c, d) {\n      return c * (t /= d) * t + b;\n    },\n\n    /**\n     * Quadratic easing out\n     * @memberOf fabric.util.ease\n     */\n    easeOutQuad: function(t, b, c, d) {\n      return -c * (t /= d) * (t - 2) + b;\n    },\n\n    /**\n     * Quadratic easing in and out\n     * @memberOf fabric.util.ease\n     */\n    easeInOutQuad: function(t, b, c, d) {\n      t /= (d / 2);\n      if (t < 1) {\n        return c / 2 * t * t + b;\n      }\n      return -c / 2 * ((--t) * (t - 2) - 1) + b;\n    },\n\n    /**\n     * Cubic easing in\n     * @memberOf fabric.util.ease\n     */\n    easeInCubic: function(t, b, c, d) {\n      return c * (t /= d) * t * t + b;\n    },\n\n    easeOutCubic: easeOutCubic,\n    easeInOutCubic: easeInOutCubic,\n    easeInQuart: easeInQuart,\n    easeOutQuart: easeOutQuart,\n    easeInOutQuart: easeInOutQuart,\n    easeInQuint: easeInQuint,\n    easeOutQuint: easeOutQuint,\n    easeInOutQuint: easeInOutQuint,\n    easeInSine: easeInSine,\n    easeOutSine: easeOutSine,\n    easeInOutSine: easeInOutSine,\n    easeInExpo: easeInExpo,\n    easeOutExpo: easeOutExpo,\n    easeInOutExpo: easeInOutExpo,\n    easeInCirc: easeInCirc,\n    easeOutCirc: easeOutCirc,\n    easeInOutCirc: easeInOutCirc,\n    easeInElastic: easeInElastic,\n    easeOutElastic: easeOutElastic,\n    easeInOutElastic: easeInOutElastic,\n    easeInBack: easeInBack,\n    easeOutBack: easeOutBack,\n    easeInOutBack: easeInOutBack,\n    easeInBounce: easeInBounce,\n    easeOutBounce: easeOutBounce,\n    easeInOutBounce: easeInOutBounce\n  };\n\n})();\n\n\n(function(global) {\n\n  'use strict';\n\n  /**\n   * @name fabric\n   * @namespace\n   */\n\n  var fabric = global.fabric || (global.fabric = { }),\n      extend = fabric.util.object.extend,\n      clone = fabric.util.object.clone,\n      toFixed = fabric.util.toFixed,\n      parseUnit = fabric.util.parseUnit,\n      multiplyTransformMatrices = fabric.util.multiplyTransformMatrices,\n\n      svgValidTagNames = ['path', 'circle', 'polygon', 'polyline', 'ellipse', 'rect', 'line',\n        'image', 'text'],\n      svgViewBoxElements = ['symbol', 'image', 'marker', 'pattern', 'view', 'svg'],\n      svgInvalidAncestors = ['pattern', 'defs', 'symbol', 'metadata', 'clipPath', 'mask', 'desc'],\n      svgValidParents = ['symbol', 'g', 'a', 'svg', 'clipPath', 'defs'],\n\n      attributesMap = {\n        cx:                   'left',\n        x:                    'left',\n        r:                    'radius',\n        cy:                   'top',\n        y:                    'top',\n        display:              'visible',\n        visibility:           'visible',\n        transform:            'transformMatrix',\n        'fill-opacity':       'fillOpacity',\n        'fill-rule':          'fillRule',\n        'font-family':        'fontFamily',\n        'font-size':          'fontSize',\n        'font-style':         'fontStyle',\n        'font-weight':        'fontWeight',\n        'letter-spacing':     'charSpacing',\n        'paint-order':        'paintFirst',\n        'stroke-dasharray':   'strokeDashArray',\n        'stroke-dashoffset':  'strokeDashOffset',\n        'stroke-linecap':     'strokeLineCap',\n        'stroke-linejoin':    'strokeLineJoin',\n        'stroke-miterlimit':  'strokeMiterLimit',\n        'stroke-opacity':     'strokeOpacity',\n        'stroke-width':       'strokeWidth',\n        'text-decoration':    'textDecoration',\n        'text-anchor':        'textAnchor',\n        opacity:              'opacity',\n        'clip-path':          'clipPath',\n        'clip-rule':          'clipRule',\n        'vector-effect':      'strokeUniform',\n        'image-rendering':    'imageSmoothing',\n      },\n\n      colorAttributes = {\n        stroke: 'strokeOpacity',\n        fill:   'fillOpacity'\n      },\n\n      fSize = 'font-size', cPath = 'clip-path';\n\n  fabric.svgValidTagNamesRegEx = getSvgRegex(svgValidTagNames);\n  fabric.svgViewBoxElementsRegEx = getSvgRegex(svgViewBoxElements);\n  fabric.svgInvalidAncestorsRegEx = getSvgRegex(svgInvalidAncestors);\n  fabric.svgValidParentsRegEx = getSvgRegex(svgValidParents);\n\n  fabric.cssRules = { };\n  fabric.gradientDefs = { };\n  fabric.clipPaths = { };\n\n  function normalizeAttr(attr) {\n    // transform attribute names\n    if (attr in attributesMap) {\n      return attributesMap[attr];\n    }\n    return attr;\n  }\n\n  function normalizeValue(attr, value, parentAttributes, fontSize) {\n    var isArray = Array.isArray(value), parsed;\n\n    if ((attr === 'fill' || attr === 'stroke') && value === 'none') {\n      value = '';\n    }\n    else if (attr === 'strokeUniform') {\n      return (value === 'non-scaling-stroke');\n    }\n    else if (attr === 'strokeDashArray') {\n      if (value === 'none') {\n        value = null;\n      }\n      else {\n        value = value.replace(/,/g, ' ').split(/\\s+/).map(parseFloat);\n      }\n    }\n    else if (attr === 'transformMatrix') {\n      if (parentAttributes && parentAttributes.transformMatrix) {\n        value = multiplyTransformMatrices(\n          parentAttributes.transformMatrix, fabric.parseTransformAttribute(value));\n      }\n      else {\n        value = fabric.parseTransformAttribute(value);\n      }\n    }\n    else if (attr === 'visible') {\n      value = value !== 'none' && value !== 'hidden';\n      // display=none on parent element always takes precedence over child element\n      if (parentAttributes && parentAttributes.visible === false) {\n        value = false;\n      }\n    }\n    else if (attr === 'opacity') {\n      value = parseFloat(value);\n      if (parentAttributes && typeof parentAttributes.opacity !== 'undefined') {\n        value *= parentAttributes.opacity;\n      }\n    }\n    else if (attr === 'textAnchor' /* text-anchor */) {\n      value = value === 'start' ? 'left' : value === 'end' ? 'right' : 'center';\n    }\n    else if (attr === 'charSpacing') {\n      // parseUnit returns px and we convert it to em\n      parsed = parseUnit(value, fontSize) / fontSize * 1000;\n    }\n    else if (attr === 'paintFirst') {\n      var fillIndex = value.indexOf('fill');\n      var strokeIndex = value.indexOf('stroke');\n      var value = 'fill';\n      if (fillIndex > -1 && strokeIndex > -1 && strokeIndex < fillIndex) {\n        value = 'stroke';\n      }\n      else if (fillIndex === -1 && strokeIndex > -1) {\n        value = 'stroke';\n      }\n    }\n    else if (attr === 'href' || attr === 'xlink:href' || attr === 'font') {\n      return value;\n    }\n    else if (attr === 'imageSmoothing') {\n      return (value === 'optimizeQuality');\n    }\n    else {\n      parsed = isArray ? value.map(parseUnit) : parseUnit(value, fontSize);\n    }\n\n    return (!isArray && isNaN(parsed) ? value : parsed);\n  }\n\n  /**\n    * @private\n    */\n  function getSvgRegex(arr) {\n    return new RegExp('^(' + arr.join('|') + ')\\\\b', 'i');\n  }\n\n  /**\n   * @private\n   * @param {Object} attributes Array of attributes to parse\n   */\n  function _setStrokeFillOpacity(attributes) {\n    for (var attr in colorAttributes) {\n\n      if (typeof attributes[colorAttributes[attr]] === 'undefined' || attributes[attr] === '') {\n        continue;\n      }\n\n      if (typeof attributes[attr] === 'undefined') {\n        if (!fabric.Object.prototype[attr]) {\n          continue;\n        }\n        attributes[attr] = fabric.Object.prototype[attr];\n      }\n\n      if (attributes[attr].indexOf('url(') === 0) {\n        continue;\n      }\n\n      var color = new fabric.Color(attributes[attr]);\n      attributes[attr] = color.setAlpha(toFixed(color.getAlpha() * attributes[colorAttributes[attr]], 2)).toRgba();\n    }\n    return attributes;\n  }\n\n  /**\n   * @private\n   */\n  function _getMultipleNodes(doc, nodeNames) {\n    var nodeName, nodeArray = [], nodeList, i, len;\n    for (i = 0, len = nodeNames.length; i < len; i++) {\n      nodeName = nodeNames[i];\n      nodeList = doc.getElementsByTagName(nodeName);\n      nodeArray = nodeArray.concat(Array.prototype.slice.call(nodeList));\n    }\n    return nodeArray;\n  }\n\n  /**\n   * Parses \"transform\" attribute, returning an array of values\n   * @static\n   * @function\n   * @memberOf fabric\n   * @param {String} attributeValue String containing attribute value\n   * @return {Array} Array of 6 elements representing transformation matrix\n   */\n  fabric.parseTransformAttribute = (function() {\n    function rotateMatrix(matrix, args) {\n      var cos = fabric.util.cos(args[0]), sin = fabric.util.sin(args[0]),\n          x = 0, y = 0;\n      if (args.length === 3) {\n        x = args[1];\n        y = args[2];\n      }\n\n      matrix[0] = cos;\n      matrix[1] = sin;\n      matrix[2] = -sin;\n      matrix[3] = cos;\n      matrix[4] = x - (cos * x - sin * y);\n      matrix[5] = y - (sin * x + cos * y);\n    }\n\n    function scaleMatrix(matrix, args) {\n      var multiplierX = args[0],\n          multiplierY = (args.length === 2) ? args[1] : args[0];\n\n      matrix[0] = multiplierX;\n      matrix[3] = multiplierY;\n    }\n\n    function skewMatrix(matrix, args, pos) {\n      matrix[pos] = Math.tan(fabric.util.degreesToRadians(args[0]));\n    }\n\n    function translateMatrix(matrix, args) {\n      matrix[4] = args[0];\n      if (args.length === 2) {\n        matrix[5] = args[1];\n      }\n    }\n\n    // identity matrix\n    var iMatrix = fabric.iMatrix,\n\n        // == begin transform regexp\n        number = fabric.reNum,\n\n        commaWsp = fabric.commaWsp,\n\n        skewX = '(?:(skewX)\\\\s*\\\\(\\\\s*(' + number + ')\\\\s*\\\\))',\n\n        skewY = '(?:(skewY)\\\\s*\\\\(\\\\s*(' + number + ')\\\\s*\\\\))',\n\n        rotate = '(?:(rotate)\\\\s*\\\\(\\\\s*(' + number + ')(?:' +\n                    commaWsp + '(' + number + ')' +\n                    commaWsp + '(' + number + '))?\\\\s*\\\\))',\n\n        scale = '(?:(scale)\\\\s*\\\\(\\\\s*(' + number + ')(?:' +\n                    commaWsp + '(' + number + '))?\\\\s*\\\\))',\n\n        translate = '(?:(translate)\\\\s*\\\\(\\\\s*(' + number + ')(?:' +\n                    commaWsp + '(' + number + '))?\\\\s*\\\\))',\n\n        matrix = '(?:(matrix)\\\\s*\\\\(\\\\s*' +\n                  '(' + number + ')' + commaWsp +\n                  '(' + number + ')' + commaWsp +\n                  '(' + number + ')' + commaWsp +\n                  '(' + number + ')' + commaWsp +\n                  '(' + number + ')' + commaWsp +\n                  '(' + number + ')' +\n                  '\\\\s*\\\\))',\n\n        transform = '(?:' +\n                    matrix + '|' +\n                    translate + '|' +\n                    scale + '|' +\n                    rotate + '|' +\n                    skewX + '|' +\n                    skewY +\n                    ')',\n\n        transforms = '(?:' + transform + '(?:' + commaWsp + '*' + transform + ')*' + ')',\n\n        transformList = '^\\\\s*(?:' + transforms + '?)\\\\s*$',\n\n        // http://www.w3.org/TR/SVG/coords.html#TransformAttribute\n        reTransformList = new RegExp(transformList),\n        // == end transform regexp\n\n        reTransform = new RegExp(transform, 'g');\n\n    return function(attributeValue) {\n\n      // start with identity matrix\n      var matrix = iMatrix.concat(),\n          matrices = [];\n\n      // return if no argument was given or\n      // an argument does not match transform attribute regexp\n      if (!attributeValue || (attributeValue && !reTransformList.test(attributeValue))) {\n        return matrix;\n      }\n\n      attributeValue.replace(reTransform, function(match) {\n\n        var m = new RegExp(transform).exec(match).filter(function (match) {\n              // match !== '' && match != null\n              return (!!match);\n            }),\n            operation = m[1],\n            args = m.slice(2).map(parseFloat);\n\n        switch (operation) {\n          case 'translate':\n            translateMatrix(matrix, args);\n            break;\n          case 'rotate':\n            args[0] = fabric.util.degreesToRadians(args[0]);\n            rotateMatrix(matrix, args);\n            break;\n          case 'scale':\n            scaleMatrix(matrix, args);\n            break;\n          case 'skewX':\n            skewMatrix(matrix, args, 2);\n            break;\n          case 'skewY':\n            skewMatrix(matrix, args, 1);\n            break;\n          case 'matrix':\n            matrix = args;\n            break;\n        }\n\n        // snapshot current matrix into matrices array\n        matrices.push(matrix.concat());\n        // reset\n        matrix = iMatrix.concat();\n      });\n\n      var combinedMatrix = matrices[0];\n      while (matrices.length > 1) {\n        matrices.shift();\n        combinedMatrix = fabric.util.multiplyTransformMatrices(combinedMatrix, matrices[0]);\n      }\n      return combinedMatrix;\n    };\n  })();\n\n  /**\n   * @private\n   */\n  function parseStyleString(style, oStyle) {\n    var attr, value;\n    style.replace(/;\\s*$/, '').split(';').forEach(function (chunk) {\n      var pair = chunk.split(':');\n\n      attr = pair[0].trim().toLowerCase();\n      value =  pair[1].trim();\n\n      oStyle[attr] = value;\n    });\n  }\n\n  /**\n   * @private\n   */\n  function parseStyleObject(style, oStyle) {\n    var attr, value;\n    for (var prop in style) {\n      if (typeof style[prop] === 'undefined') {\n        continue;\n      }\n\n      attr = prop.toLowerCase();\n      value = style[prop];\n\n      oStyle[attr] = value;\n    }\n  }\n\n  /**\n   * @private\n   */\n  function getGlobalStylesForElement(element, svgUid) {\n    var styles = { };\n    for (var rule in fabric.cssRules[svgUid]) {\n      if (elementMatchesRule(element, rule.split(' '))) {\n        for (var property in fabric.cssRules[svgUid][rule]) {\n          styles[property] = fabric.cssRules[svgUid][rule][property];\n        }\n      }\n    }\n    return styles;\n  }\n\n  /**\n   * @private\n   */\n  function elementMatchesRule(element, selectors) {\n    var firstMatching, parentMatching = true;\n    //start from rightmost selector.\n    firstMatching = selectorMatches(element, selectors.pop());\n    if (firstMatching && selectors.length) {\n      parentMatching = doesSomeParentMatch(element, selectors);\n    }\n    return firstMatching && parentMatching && (selectors.length === 0);\n  }\n\n  function doesSomeParentMatch(element, selectors) {\n    var selector, parentMatching = true;\n    while (element.parentNode && element.parentNode.nodeType === 1 && selectors.length) {\n      if (parentMatching) {\n        selector = selectors.pop();\n      }\n      element = element.parentNode;\n      parentMatching = selectorMatches(element, selector);\n    }\n    return selectors.length === 0;\n  }\n\n  /**\n   * @private\n   */\n  function selectorMatches(element, selector) {\n    var nodeName = element.nodeName,\n        classNames = element.getAttribute('class'),\n        id = element.getAttribute('id'), matcher, i;\n    // i check if a selector matches slicing away part from it.\n    // if i get empty string i should match\n    matcher = new RegExp('^' + nodeName, 'i');\n    selector = selector.replace(matcher, '');\n    if (id && selector.length) {\n      matcher = new RegExp('#' + id + '(?![a-zA-Z\\\\-]+)', 'i');\n      selector = selector.replace(matcher, '');\n    }\n    if (classNames && selector.length) {\n      classNames = classNames.split(' ');\n      for (i = classNames.length; i--;) {\n        matcher = new RegExp('\\\\.' + classNames[i] + '(?![a-zA-Z\\\\-]+)', 'i');\n        selector = selector.replace(matcher, '');\n      }\n    }\n    return selector.length === 0;\n  }\n\n  /**\n   * @private\n   * to support IE8 missing getElementById on SVGdocument and on node xmlDOM\n   */\n  function elementById(doc, id) {\n    var el;\n    doc.getElementById && (el = doc.getElementById(id));\n    if (el) {\n      return el;\n    }\n    var node, i, len, nodelist = doc.getElementsByTagName('*');\n    for (i = 0, len = nodelist.length; i < len; i++) {\n      node = nodelist[i];\n      if (id === node.getAttribute('id')) {\n        return node;\n      }\n    }\n  }\n\n  /**\n   * @private\n   */\n  function parseUseDirectives(doc) {\n    var nodelist = _getMultipleNodes(doc, ['use', 'svg:use']), i = 0;\n    while (nodelist.length && i < nodelist.length) {\n      var el = nodelist[i],\n          xlinkAttribute = el.getAttribute('xlink:href') || el.getAttribute('href');\n\n      if (xlinkAttribute === null) {\n        return;\n      }\n\n      var xlink = xlinkAttribute.slice(1),\n          x = el.getAttribute('x') || 0,\n          y = el.getAttribute('y') || 0,\n          el2 = elementById(doc, xlink).cloneNode(true),\n          currentTrans = (el2.getAttribute('transform') || '') + ' translate(' + x + ', ' + y + ')',\n          parentNode,\n          oldLength = nodelist.length, attr,\n          j,\n          attrs,\n          len,\n          namespace = fabric.svgNS;\n\n      applyViewboxTransform(el2);\n      if (/^svg$/i.test(el2.nodeName)) {\n        var el3 = el2.ownerDocument.createElementNS(namespace, 'g');\n        for (j = 0, attrs = el2.attributes, len = attrs.length; j < len; j++) {\n          attr = attrs.item(j);\n          el3.setAttributeNS(namespace, attr.nodeName, attr.nodeValue);\n        }\n        // el2.firstChild != null\n        while (el2.firstChild) {\n          el3.appendChild(el2.firstChild);\n        }\n        el2 = el3;\n      }\n\n      for (j = 0, attrs = el.attributes, len = attrs.length; j < len; j++) {\n        attr = attrs.item(j);\n        if (attr.nodeName === 'x' || attr.nodeName === 'y' ||\n          attr.nodeName === 'xlink:href' || attr.nodeName === 'href') {\n          continue;\n        }\n\n        if (attr.nodeName === 'transform') {\n          currentTrans = attr.nodeValue + ' ' + currentTrans;\n        }\n        else {\n          el2.setAttribute(attr.nodeName, attr.nodeValue);\n        }\n      }\n\n      el2.setAttribute('transform', currentTrans);\n      el2.setAttribute('instantiated_by_use', '1');\n      el2.removeAttribute('id');\n      parentNode = el.parentNode;\n      parentNode.replaceChild(el2, el);\n      // some browsers do not shorten nodelist after replaceChild (IE8)\n      if (nodelist.length === oldLength) {\n        i++;\n      }\n    }\n  }\n\n  // http://www.w3.org/TR/SVG/coords.html#ViewBoxAttribute\n  // matches, e.g.: +14.56e-12, etc.\n  var reViewBoxAttrValue = new RegExp(\n    '^' +\n    '\\\\s*(' + fabric.reNum + '+)\\\\s*,?' +\n    '\\\\s*(' + fabric.reNum + '+)\\\\s*,?' +\n    '\\\\s*(' + fabric.reNum + '+)\\\\s*,?' +\n    '\\\\s*(' + fabric.reNum + '+)\\\\s*' +\n    '$'\n  );\n\n  /**\n   * Add a <g> element that envelop all child elements and makes the viewbox transformMatrix descend on all elements\n   */\n  function applyViewboxTransform(element) {\n    if (!fabric.svgViewBoxElementsRegEx.test(element.nodeName)) {\n      return {};\n    }\n    var viewBoxAttr = element.getAttribute('viewBox'),\n        scaleX = 1,\n        scaleY = 1,\n        minX = 0,\n        minY = 0,\n        viewBoxWidth, viewBoxHeight, matrix, el,\n        widthAttr = element.getAttribute('width'),\n        heightAttr = element.getAttribute('height'),\n        x = element.getAttribute('x') || 0,\n        y = element.getAttribute('y') || 0,\n        preserveAspectRatio = element.getAttribute('preserveAspectRatio') || '',\n        missingViewBox = (!viewBoxAttr || !(viewBoxAttr = viewBoxAttr.match(reViewBoxAttrValue))),\n        missingDimAttr = (!widthAttr || !heightAttr || widthAttr === '100%' || heightAttr === '100%'),\n        toBeParsed = missingViewBox && missingDimAttr,\n        parsedDim = { }, translateMatrix = '', widthDiff = 0, heightDiff = 0;\n\n    parsedDim.width = 0;\n    parsedDim.height = 0;\n    parsedDim.toBeParsed = toBeParsed;\n\n    if (missingViewBox) {\n      if (((x || y) && element.parentNode && element.parentNode.nodeName !== '#document')) {\n        translateMatrix = ' translate(' + parseUnit(x) + ' ' + parseUnit(y) + ') ';\n        matrix = (element.getAttribute('transform') || '') + translateMatrix;\n        element.setAttribute('transform', matrix);\n        element.removeAttribute('x');\n        element.removeAttribute('y');\n      }\n    }\n\n    if (toBeParsed) {\n      return parsedDim;\n    }\n\n    if (missingViewBox) {\n      parsedDim.width = parseUnit(widthAttr);\n      parsedDim.height = parseUnit(heightAttr);\n      // set a transform for elements that have x y and are inner(only) SVGs\n      return parsedDim;\n    }\n    minX = -parseFloat(viewBoxAttr[1]);\n    minY = -parseFloat(viewBoxAttr[2]);\n    viewBoxWidth = parseFloat(viewBoxAttr[3]);\n    viewBoxHeight = parseFloat(viewBoxAttr[4]);\n    parsedDim.minX = minX;\n    parsedDim.minY = minY;\n    parsedDim.viewBoxWidth = viewBoxWidth;\n    parsedDim.viewBoxHeight = viewBoxHeight;\n    if (!missingDimAttr) {\n      parsedDim.width = parseUnit(widthAttr);\n      parsedDim.height = parseUnit(heightAttr);\n      scaleX = parsedDim.width / viewBoxWidth;\n      scaleY = parsedDim.height / viewBoxHeight;\n    }\n    else {\n      parsedDim.width = viewBoxWidth;\n      parsedDim.height = viewBoxHeight;\n    }\n\n    // default is to preserve aspect ratio\n    preserveAspectRatio = fabric.util.parsePreserveAspectRatioAttribute(preserveAspectRatio);\n    if (preserveAspectRatio.alignX !== 'none') {\n      //translate all container for the effect of Mid, Min, Max\n      if (preserveAspectRatio.meetOrSlice === 'meet') {\n        scaleY = scaleX = (scaleX > scaleY ? scaleY : scaleX);\n        // calculate additional translation to move the viewbox\n      }\n      if (preserveAspectRatio.meetOrSlice === 'slice') {\n        scaleY = scaleX = (scaleX > scaleY ? scaleX : scaleY);\n        // calculate additional translation to move the viewbox\n      }\n      widthDiff = parsedDim.width - viewBoxWidth * scaleX;\n      heightDiff = parsedDim.height - viewBoxHeight * scaleX;\n      if (preserveAspectRatio.alignX === 'Mid') {\n        widthDiff /= 2;\n      }\n      if (preserveAspectRatio.alignY === 'Mid') {\n        heightDiff /= 2;\n      }\n      if (preserveAspectRatio.alignX === 'Min') {\n        widthDiff = 0;\n      }\n      if (preserveAspectRatio.alignY === 'Min') {\n        heightDiff = 0;\n      }\n    }\n\n    if (scaleX === 1 && scaleY === 1 && minX === 0 && minY === 0 && x === 0 && y === 0) {\n      return parsedDim;\n    }\n    if ((x || y) && element.parentNode.nodeName !== '#document') {\n      translateMatrix = ' translate(' + parseUnit(x) + ' ' + parseUnit(y) + ') ';\n    }\n\n    matrix = translateMatrix + ' matrix(' + scaleX +\n                  ' 0' +\n                  ' 0 ' +\n                  scaleY + ' ' +\n                  (minX * scaleX + widthDiff) + ' ' +\n                  (minY * scaleY + heightDiff) + ') ';\n    // seems unused.\n    // parsedDim.viewboxTransform = fabric.parseTransformAttribute(matrix);\n    if (element.nodeName === 'svg') {\n      el = element.ownerDocument.createElementNS(fabric.svgNS, 'g');\n      // element.firstChild != null\n      while (element.firstChild) {\n        el.appendChild(element.firstChild);\n      }\n      element.appendChild(el);\n    }\n    else {\n      el = element;\n      el.removeAttribute('x');\n      el.removeAttribute('y');\n      matrix = el.getAttribute('transform') + matrix;\n    }\n    el.setAttribute('transform', matrix);\n    return parsedDim;\n  }\n\n  function hasAncestorWithNodeName(element, nodeName) {\n    while (element && (element = element.parentNode)) {\n      if (element.nodeName && nodeName.test(element.nodeName.replace('svg:', ''))\n        && !element.getAttribute('instantiated_by_use')) {\n        return true;\n      }\n    }\n    return false;\n  }\n\n  /**\n   * Parses an SVG document, converts it to an array of corresponding fabric.* instances and passes them to a callback\n   * @static\n   * @function\n   * @memberOf fabric\n   * @param {SVGDocument} doc SVG document to parse\n   * @param {Function} callback Callback to call when parsing is finished;\n   * It's being passed an array of elements (parsed from a document).\n   * @param {Function} [reviver] Method for further parsing of SVG elements, called after each fabric object created.\n   * @param {Object} [parsingOptions] options for parsing document\n   * @param {String} [parsingOptions.crossOrigin] crossOrigin settings\n   */\n  fabric.parseSVGDocument = function(doc, callback, reviver, parsingOptions) {\n    if (!doc) {\n      return;\n    }\n\n    parseUseDirectives(doc);\n\n    var svgUid =  fabric.Object.__uid++, i, len,\n        options = applyViewboxTransform(doc),\n        descendants = fabric.util.toArray(doc.getElementsByTagName('*'));\n    options.crossOrigin = parsingOptions && parsingOptions.crossOrigin;\n    options.svgUid = svgUid;\n\n    if (descendants.length === 0 && fabric.isLikelyNode) {\n      // we're likely in node, where \"o3-xml\" library fails to gEBTN(\"*\")\n      // https://github.com/ajaxorg/node-o3-xml/issues/21\n      descendants = doc.selectNodes('//*[name(.)!=\"svg\"]');\n      var arr = [];\n      for (i = 0, len = descendants.length; i < len; i++) {\n        arr[i] = descendants[i];\n      }\n      descendants = arr;\n    }\n\n    var elements = descendants.filter(function(el) {\n      applyViewboxTransform(el);\n      return fabric.svgValidTagNamesRegEx.test(el.nodeName.replace('svg:', '')) &&\n            !hasAncestorWithNodeName(el, fabric.svgInvalidAncestorsRegEx); // http://www.w3.org/TR/SVG/struct.html#DefsElement\n    });\n    if (!elements || (elements && !elements.length)) {\n      callback && callback([], {});\n      return;\n    }\n    var clipPaths = { };\n    descendants.filter(function(el) {\n      return el.nodeName.replace('svg:', '') === 'clipPath';\n    }).forEach(function(el) {\n      var id = el.getAttribute('id');\n      clipPaths[id] = fabric.util.toArray(el.getElementsByTagName('*')).filter(function(el) {\n        return fabric.svgValidTagNamesRegEx.test(el.nodeName.replace('svg:', ''));\n      });\n    });\n    fabric.gradientDefs[svgUid] = fabric.getGradientDefs(doc);\n    fabric.cssRules[svgUid] = fabric.getCSSRules(doc);\n    fabric.clipPaths[svgUid] = clipPaths;\n    // Precedence of rules:   style > class > attribute\n    fabric.parseElements(elements, function(instances, elements) {\n      if (callback) {\n        callback(instances, options, elements, descendants);\n        delete fabric.gradientDefs[svgUid];\n        delete fabric.cssRules[svgUid];\n        delete fabric.clipPaths[svgUid];\n      }\n    }, clone(options), reviver, parsingOptions);\n  };\n\n  function recursivelyParseGradientsXlink(doc, gradient) {\n    var gradientsAttrs = ['gradientTransform', 'x1', 'x2', 'y1', 'y2', 'gradientUnits', 'cx', 'cy', 'r', 'fx', 'fy'],\n        xlinkAttr = 'xlink:href',\n        xLink = gradient.getAttribute(xlinkAttr).slice(1),\n        referencedGradient = elementById(doc, xLink);\n    if (referencedGradient && referencedGradient.getAttribute(xlinkAttr)) {\n      recursivelyParseGradientsXlink(doc, referencedGradient);\n    }\n    gradientsAttrs.forEach(function(attr) {\n      if (referencedGradient && !gradient.hasAttribute(attr) && referencedGradient.hasAttribute(attr)) {\n        gradient.setAttribute(attr, referencedGradient.getAttribute(attr));\n      }\n    });\n    if (!gradient.children.length) {\n      var referenceClone = referencedGradient.cloneNode(true);\n      while (referenceClone.firstChild) {\n        gradient.appendChild(referenceClone.firstChild);\n      }\n    }\n    gradient.removeAttribute(xlinkAttr);\n  }\n\n  var reFontDeclaration = new RegExp(\n    '(normal|italic)?\\\\s*(normal|small-caps)?\\\\s*' +\n    '(normal|bold|bolder|lighter|100|200|300|400|500|600|700|800|900)?\\\\s*(' +\n      fabric.reNum +\n    '(?:px|cm|mm|em|pt|pc|in)*)(?:\\\\/(normal|' + fabric.reNum + '))?\\\\s+(.*)');\n\n  extend(fabric, {\n    /**\n     * Parses a short font declaration, building adding its properties to a style object\n     * @static\n     * @function\n     * @memberOf fabric\n     * @param {String} value font declaration\n     * @param {Object} oStyle definition\n     */\n    parseFontDeclaration: function(value, oStyle) {\n      var match = value.match(reFontDeclaration);\n\n      if (!match) {\n        return;\n      }\n      var fontStyle = match[1],\n          // font variant is not used\n          // fontVariant = match[2],\n          fontWeight = match[3],\n          fontSize = match[4],\n          lineHeight = match[5],\n          fontFamily = match[6];\n\n      if (fontStyle) {\n        oStyle.fontStyle = fontStyle;\n      }\n      if (fontWeight) {\n        oStyle.fontWeight = isNaN(parseFloat(fontWeight)) ? fontWeight : parseFloat(fontWeight);\n      }\n      if (fontSize) {\n        oStyle.fontSize = parseUnit(fontSize);\n      }\n      if (fontFamily) {\n        oStyle.fontFamily = fontFamily;\n      }\n      if (lineHeight) {\n        oStyle.lineHeight = lineHeight === 'normal' ? 1 : lineHeight;\n      }\n    },\n\n    /**\n     * Parses an SVG document, returning all of the gradient declarations found in it\n     * @static\n     * @function\n     * @memberOf fabric\n     * @param {SVGDocument} doc SVG document to parse\n     * @return {Object} Gradient definitions; key corresponds to element id, value -- to gradient definition element\n     */\n    getGradientDefs: function(doc) {\n      var tagArray = [\n            'linearGradient',\n            'radialGradient',\n            'svg:linearGradient',\n            'svg:radialGradient'],\n          elList = _getMultipleNodes(doc, tagArray),\n          el, j = 0, gradientDefs = { };\n      j = elList.length;\n      while (j--) {\n        el = elList[j];\n        if (el.getAttribute('xlink:href')) {\n          recursivelyParseGradientsXlink(doc, el);\n        }\n        gradientDefs[el.getAttribute('id')] = el;\n      }\n      return gradientDefs;\n    },\n\n    /**\n     * Returns an object of attributes' name/value, given element and an array of attribute names;\n     * Parses parent \"g\" nodes recursively upwards.\n     * @static\n     * @memberOf fabric\n     * @param {DOMElement} element Element to parse\n     * @param {Array} attributes Array of attributes to parse\n     * @return {Object} object containing parsed attributes' names/values\n     */\n    parseAttributes: function(element, attributes, svgUid) {\n\n      if (!element) {\n        return;\n      }\n\n      var value,\n          parentAttributes = { },\n          fontSize, parentFontSize;\n\n      if (typeof svgUid === 'undefined') {\n        svgUid = element.getAttribute('svgUid');\n      }\n      // if there's a parent container (`g` or `a` or `symbol` node), parse its attributes recursively upwards\n      if (element.parentNode && fabric.svgValidParentsRegEx.test(element.parentNode.nodeName)) {\n        parentAttributes = fabric.parseAttributes(element.parentNode, attributes, svgUid);\n      }\n\n      var ownAttributes = attributes.reduce(function(memo, attr) {\n        value = element.getAttribute(attr);\n        if (value) { // eslint-disable-line\n          memo[attr] = value;\n        }\n        return memo;\n      }, { });\n      // add values parsed from style, which take precedence over attributes\n      // (see: http://www.w3.org/TR/SVG/styling.html#UsingPresentationAttributes)\n      var cssAttrs = extend(\n        getGlobalStylesForElement(element, svgUid),\n        fabric.parseStyleAttribute(element)\n      );\n      ownAttributes = extend(\n        ownAttributes,\n        cssAttrs\n      );\n      if (cssAttrs[cPath]) {\n        element.setAttribute(cPath, cssAttrs[cPath]);\n      }\n      fontSize = parentFontSize = parentAttributes.fontSize || fabric.Text.DEFAULT_SVG_FONT_SIZE;\n      if (ownAttributes[fSize]) {\n        // looks like the minimum should be 9px when dealing with ems. this is what looks like in browsers.\n        ownAttributes[fSize] = fontSize = parseUnit(ownAttributes[fSize], parentFontSize);\n      }\n\n      var normalizedAttr, normalizedValue, normalizedStyle = {};\n      for (var attr in ownAttributes) {\n        normalizedAttr = normalizeAttr(attr);\n        normalizedValue = normalizeValue(normalizedAttr, ownAttributes[attr], parentAttributes, fontSize);\n        normalizedStyle[normalizedAttr] = normalizedValue;\n      }\n      if (normalizedStyle && normalizedStyle.font) {\n        fabric.parseFontDeclaration(normalizedStyle.font, normalizedStyle);\n      }\n      var mergedAttrs = extend(parentAttributes, normalizedStyle);\n      return fabric.svgValidParentsRegEx.test(element.nodeName) ? mergedAttrs : _setStrokeFillOpacity(mergedAttrs);\n    },\n\n    /**\n     * Transforms an array of svg elements to corresponding fabric.* instances\n     * @static\n     * @memberOf fabric\n     * @param {Array} elements Array of elements to parse\n     * @param {Function} callback Being passed an array of fabric instances (transformed from SVG elements)\n     * @param {Object} [options] Options object\n     * @param {Function} [reviver] Method for further parsing of SVG elements, called after each fabric object created.\n     */\n    parseElements: function(elements, callback, options, reviver, parsingOptions) {\n      new fabric.ElementsParser(elements, callback, options, reviver, parsingOptions).parse();\n    },\n\n    /**\n     * Parses \"style\" attribute, retuning an object with values\n     * @static\n     * @memberOf fabric\n     * @param {SVGElement} element Element to parse\n     * @return {Object} Objects with values parsed from style attribute of an element\n     */\n    parseStyleAttribute: function(element) {\n      var oStyle = { },\n          style = element.getAttribute('style');\n\n      if (!style) {\n        return oStyle;\n      }\n\n      if (typeof style === 'string') {\n        parseStyleString(style, oStyle);\n      }\n      else {\n        parseStyleObject(style, oStyle);\n      }\n\n      return oStyle;\n    },\n\n    /**\n     * Parses \"points\" attribute, returning an array of values\n     * @static\n     * @memberOf fabric\n     * @param {String} points points attribute string\n     * @return {Array} array of points\n     */\n    parsePointsAttribute: function(points) {\n\n      // points attribute is required and must not be empty\n      if (!points) {\n        return null;\n      }\n\n      // replace commas with whitespace and remove bookending whitespace\n      points = points.replace(/,/g, ' ').trim();\n\n      points = points.split(/\\s+/);\n      var parsedPoints = [], i, len;\n\n      for (i = 0, len = points.length; i < len; i += 2) {\n        parsedPoints.push({\n          x: parseFloat(points[i]),\n          y: parseFloat(points[i + 1])\n        });\n      }\n\n      // odd number of points is an error\n      // if (parsedPoints.length % 2 !== 0) {\n      //   return null;\n      // }\n\n      return parsedPoints;\n    },\n\n    /**\n     * Returns CSS rules for a given SVG document\n     * @static\n     * @function\n     * @memberOf fabric\n     * @param {SVGDocument} doc SVG document to parse\n     * @return {Object} CSS rules of this document\n     */\n    getCSSRules: function(doc) {\n      var styles = doc.getElementsByTagName('style'), i, len,\n          allRules = { }, rules;\n\n      // very crude parsing of style contents\n      for (i = 0, len = styles.length; i < len; i++) {\n        var styleContents = styles[i].textContent;\n\n        // remove comments\n        styleContents = styleContents.replace(/\\/\\*[\\s\\S]*?\\*\\//g, '');\n        if (styleContents.trim() === '') {\n          continue;\n        }\n        // recovers all the rule in this form `body { style code... }`\n        // rules = styleContents.match(/[^{]*\\{[\\s\\S]*?\\}/g);\n        rules = styleContents.split('}');\n        // remove empty rules.\n        rules = rules.filter(function(rule) { return rule.trim(); });\n        // at this point we have hopefully an array of rules `body { style code... `\n        // eslint-disable-next-line no-loop-func\n        rules.forEach(function(rule) {\n\n          var match = rule.split('{'),\n              ruleObj = { }, declaration = match[1].trim(),\n              propertyValuePairs = declaration.split(';').filter(function(pair) { return pair.trim(); });\n\n          for (i = 0, len = propertyValuePairs.length; i < len; i++) {\n            var pair = propertyValuePairs[i].split(':'),\n                property = pair[0].trim(),\n                value = pair[1].trim();\n            ruleObj[property] = value;\n          }\n          rule = match[0].trim();\n          rule.split(',').forEach(function(_rule) {\n            _rule = _rule.replace(/^svg/i, '').trim();\n            if (_rule === '') {\n              return;\n            }\n            if (allRules[_rule]) {\n              fabric.util.object.extend(allRules[_rule], ruleObj);\n            }\n            else {\n              allRules[_rule] = fabric.util.object.clone(ruleObj);\n            }\n          });\n        });\n      }\n      return allRules;\n    },\n\n    /**\n     * Takes url corresponding to an SVG document, and parses it into a set of fabric objects.\n     * Note that SVG is fetched via XMLHttpRequest, so it needs to conform to SOP (Same Origin Policy)\n     * @memberOf fabric\n     * @param {String} url\n     * @param {Function} callback\n     * @param {Function} [reviver] Method for further parsing of SVG elements, called after each fabric object created.\n     * @param {Object} [options] Object containing options for parsing\n     * @param {String} [options.crossOrigin] crossOrigin crossOrigin setting to use for external resources\n     */\n    loadSVGFromURL: function(url, callback, reviver, options) {\n\n      url = url.replace(/^\\n\\s*/, '').trim();\n      new fabric.util.request(url, {\n        method: 'get',\n        onComplete: onComplete\n      });\n\n      function onComplete(r) {\n\n        var xml = r.responseXML;\n        if (!xml || !xml.documentElement) {\n          callback && callback(null);\n          return false;\n        }\n\n        fabric.parseSVGDocument(xml.documentElement, function (results, _options, elements, allElements) {\n          callback && callback(results, _options, elements, allElements);\n        }, reviver, options);\n      }\n    },\n\n    /**\n     * Takes string corresponding to an SVG document, and parses it into a set of fabric objects\n     * @memberOf fabric\n     * @param {String} string\n     * @param {Function} callback\n     * @param {Function} [reviver] Method for further parsing of SVG elements, called after each fabric object created.\n     * @param {Object} [options] Object containing options for parsing\n     * @param {String} [options.crossOrigin] crossOrigin crossOrigin setting to use for external resources\n     */\n    loadSVGFromString: function(string, callback, reviver, options) {\n      var parser = new fabric.window.DOMParser(),\n          doc = parser.parseFromString(string.trim(), 'text/xml');\n      fabric.parseSVGDocument(doc.documentElement, function (results, _options, elements, allElements) {\n        callback(results, _options, elements, allElements);\n      }, reviver, options);\n    }\n  });\n\n})(typeof exports !== 'undefined' ? exports : this);\n\n\nfabric.ElementsParser = function(elements, callback, options, reviver, parsingOptions, doc) {\n  this.elements = elements;\n  this.callback = callback;\n  this.options = options;\n  this.reviver = reviver;\n  this.svgUid = (options && options.svgUid) || 0;\n  this.parsingOptions = parsingOptions;\n  this.regexUrl = /^url\\(['\"]?#([^'\"]+)['\"]?\\)/g;\n  this.doc = doc;\n};\n\n(function(proto) {\n  proto.parse = function() {\n    this.instances = new Array(this.elements.length);\n    this.numElements = this.elements.length;\n    this.createObjects();\n  };\n\n  proto.createObjects = function() {\n    var _this = this;\n    this.elements.forEach(function(element, i) {\n      element.setAttribute('svgUid', _this.svgUid);\n      _this.createObject(element, i);\n    });\n  };\n\n  proto.findTag = function(el) {\n    return fabric[fabric.util.string.capitalize(el.tagName.replace('svg:', ''))];\n  };\n\n  proto.createObject = function(el, index) {\n    var klass = this.findTag(el);\n    if (klass && klass.fromElement) {\n      try {\n        klass.fromElement(el, this.createCallback(index, el), this.options);\n      }\n      catch (err) {\n        fabric.log(err);\n      }\n    }\n    else {\n      this.checkIfDone();\n    }\n  };\n\n  proto.createCallback = function(index, el) {\n    var _this = this;\n    return function(obj) {\n      var _options;\n      _this.resolveGradient(obj, el, 'fill');\n      _this.resolveGradient(obj, el, 'stroke');\n      if (obj instanceof fabric.Image && obj._originalElement) {\n        _options = obj.parsePreserveAspectRatioAttribute(el);\n      }\n      obj._removeTransformMatrix(_options);\n      _this.resolveClipPath(obj, el);\n      _this.reviver && _this.reviver(el, obj);\n      _this.instances[index] = obj;\n      _this.checkIfDone();\n    };\n  };\n\n  proto.extractPropertyDefinition = function(obj, property, storage) {\n    var value = obj[property], regex = this.regexUrl;\n    if (!regex.test(value)) {\n      return;\n    }\n    regex.lastIndex = 0;\n    var id = regex.exec(value)[1];\n    regex.lastIndex = 0;\n    return fabric[storage][this.svgUid][id];\n  };\n\n  proto.resolveGradient = function(obj, el, property) {\n    var gradientDef = this.extractPropertyDefinition(obj, property, 'gradientDefs');\n    if (gradientDef) {\n      var opacityAttr = el.getAttribute(property + '-opacity');\n      var gradient = fabric.Gradient.fromElement(gradientDef, obj, opacityAttr, this.options);\n      obj.set(property, gradient);\n    }\n  };\n\n  proto.createClipPathCallback = function(obj, container) {\n    return function(_newObj) {\n      _newObj._removeTransformMatrix();\n      _newObj.fillRule = _newObj.clipRule;\n      container.push(_newObj);\n    };\n  };\n\n  proto.resolveClipPath = function(obj, usingElement) {\n    var clipPath = this.extractPropertyDefinition(obj, 'clipPath', 'clipPaths'),\n        element, klass, objTransformInv, container, gTransform, options;\n    if (clipPath) {\n      container = [];\n      objTransformInv = fabric.util.invertTransform(obj.calcTransformMatrix());\n      // move the clipPath tag as sibling to the real element that is using it\n      var clipPathTag = clipPath[0].parentNode;\n      var clipPathOwner = usingElement;\n      while (clipPathOwner.parentNode && clipPathOwner.getAttribute('clip-path') !== obj.clipPath) {\n        clipPathOwner = clipPathOwner.parentNode;\n      }\n      clipPathOwner.parentNode.appendChild(clipPathTag);\n      for (var i = 0; i < clipPath.length; i++) {\n        element = clipPath[i];\n        klass = this.findTag(element);\n        klass.fromElement(\n          element,\n          this.createClipPathCallback(obj, container),\n          this.options\n        );\n      }\n      if (container.length === 1) {\n        clipPath = container[0];\n      }\n      else {\n        clipPath = new fabric.Group(container);\n      }\n      gTransform = fabric.util.multiplyTransformMatrices(\n        objTransformInv,\n        clipPath.calcTransformMatrix()\n      );\n      if (clipPath.clipPath) {\n        this.resolveClipPath(clipPath, clipPathOwner);\n      }\n      var options = fabric.util.qrDecompose(gTransform);\n      clipPath.flipX = false;\n      clipPath.flipY = false;\n      clipPath.set('scaleX', options.scaleX);\n      clipPath.set('scaleY', options.scaleY);\n      clipPath.angle = options.angle;\n      clipPath.skewX = options.skewX;\n      clipPath.skewY = 0;\n      clipPath.setPositionByOrigin({ x: options.translateX, y: options.translateY }, 'center', 'center');\n      obj.clipPath = clipPath;\n    }\n    else {\n      // if clip-path does not resolve to any element, delete the property.\n      delete obj.clipPath;\n    }\n  };\n\n  proto.checkIfDone = function() {\n    if (--this.numElements === 0) {\n      this.instances = this.instances.filter(function(el) {\n        // eslint-disable-next-line no-eq-null, eqeqeq\n        return el != null;\n      });\n      this.callback(this.instances, this.elements);\n    }\n  };\n})(fabric.ElementsParser.prototype);\n\n\n(function(global) {\n\n  'use strict';\n\n  /* Adaptation of work of Kevin Lindsey (kevin@kevlindev.com) */\n\n  var fabric = global.fabric || (global.fabric = { });\n\n  if (fabric.Point) {\n    fabric.warn('fabric.Point is already defined');\n    return;\n  }\n\n  fabric.Point = Point;\n\n  /**\n   * Point class\n   * @class fabric.Point\n   * @memberOf fabric\n   * @constructor\n   * @param {Number} x\n   * @param {Number} y\n   * @return {fabric.Point} thisArg\n   */\n  function Point(x, y) {\n    this.x = x;\n    this.y = y;\n  }\n\n  Point.prototype = /** @lends fabric.Point.prototype */ {\n\n    type: 'point',\n\n    constructor: Point,\n\n    /**\n     * Adds another point to this one and returns another one\n     * @param {fabric.Point} that\n     * @return {fabric.Point} new Point instance with added values\n     */\n    add: function (that) {\n      return new Point(this.x + that.x, this.y + that.y);\n    },\n\n    /**\n     * Adds another point to this one\n     * @param {fabric.Point} that\n     * @return {fabric.Point} thisArg\n     * @chainable\n     */\n    addEquals: function (that) {\n      this.x += that.x;\n      this.y += that.y;\n      return this;\n    },\n\n    /**\n     * Adds value to this point and returns a new one\n     * @param {Number} scalar\n     * @return {fabric.Point} new Point with added value\n     */\n    scalarAdd: function (scalar) {\n      return new Point(this.x + scalar, this.y + scalar);\n    },\n\n    /**\n     * Adds value to this point\n     * @param {Number} scalar\n     * @return {fabric.Point} thisArg\n     * @chainable\n     */\n    scalarAddEquals: function (scalar) {\n      this.x += scalar;\n      this.y += scalar;\n      return this;\n    },\n\n    /**\n     * Subtracts another point from this point and returns a new one\n     * @param {fabric.Point} that\n     * @return {fabric.Point} new Point object with subtracted values\n     */\n    subtract: function (that) {\n      return new Point(this.x - that.x, this.y - that.y);\n    },\n\n    /**\n     * Subtracts another point from this point\n     * @param {fabric.Point} that\n     * @return {fabric.Point} thisArg\n     * @chainable\n     */\n    subtractEquals: function (that) {\n      this.x -= that.x;\n      this.y -= that.y;\n      return this;\n    },\n\n    /**\n     * Subtracts value from this point and returns a new one\n     * @param {Number} scalar\n     * @return {fabric.Point}\n     */\n    scalarSubtract: function (scalar) {\n      return new Point(this.x - scalar, this.y - scalar);\n    },\n\n    /**\n     * Subtracts value from this point\n     * @param {Number} scalar\n     * @return {fabric.Point} thisArg\n     * @chainable\n     */\n    scalarSubtractEquals: function (scalar) {\n      this.x -= scalar;\n      this.y -= scalar;\n      return this;\n    },\n\n    /**\n     * Multiplies this point by a value and returns a new one\n     * TODO: rename in scalarMultiply in 2.0\n     * @param {Number} scalar\n     * @return {fabric.Point}\n     */\n    multiply: function (scalar) {\n      return new Point(this.x * scalar, this.y * scalar);\n    },\n\n    /**\n     * Multiplies this point by a value\n     * TODO: rename in scalarMultiplyEquals in 2.0\n     * @param {Number} scalar\n     * @return {fabric.Point} thisArg\n     * @chainable\n     */\n    multiplyEquals: function (scalar) {\n      this.x *= scalar;\n      this.y *= scalar;\n      return this;\n    },\n\n    /**\n     * Divides this point by a value and returns a new one\n     * TODO: rename in scalarDivide in 2.0\n     * @param {Number} scalar\n     * @return {fabric.Point}\n     */\n    divide: function (scalar) {\n      return new Point(this.x / scalar, this.y / scalar);\n    },\n\n    /**\n     * Divides this point by a value\n     * TODO: rename in scalarDivideEquals in 2.0\n     * @param {Number} scalar\n     * @return {fabric.Point} thisArg\n     * @chainable\n     */\n    divideEquals: function (scalar) {\n      this.x /= scalar;\n      this.y /= scalar;\n      return this;\n    },\n\n    /**\n     * Returns true if this point is equal to another one\n     * @param {fabric.Point} that\n     * @return {Boolean}\n     */\n    eq: function (that) {\n      return (this.x === that.x && this.y === that.y);\n    },\n\n    /**\n     * Returns true if this point is less than another one\n     * @param {fabric.Point} that\n     * @return {Boolean}\n     */\n    lt: function (that) {\n      return (this.x < that.x && this.y < that.y);\n    },\n\n    /**\n     * Returns true if this point is less than or equal to another one\n     * @param {fabric.Point} that\n     * @return {Boolean}\n     */\n    lte: function (that) {\n      return (this.x <= that.x && this.y <= that.y);\n    },\n\n    /**\n\n     * Returns true if this point is greater another one\n     * @param {fabric.Point} that\n     * @return {Boolean}\n     */\n    gt: function (that) {\n      return (this.x > that.x && this.y > that.y);\n    },\n\n    /**\n     * Returns true if this point is greater than or equal to another one\n     * @param {fabric.Point} that\n     * @return {Boolean}\n     */\n    gte: function (that) {\n      return (this.x >= that.x && this.y >= that.y);\n    },\n\n    /**\n     * Returns new point which is the result of linear interpolation with this one and another one\n     * @param {fabric.Point} that\n     * @param {Number} t , position of interpolation, between 0 and 1 default 0.5\n     * @return {fabric.Point}\n     */\n    lerp: function (that, t) {\n      if (typeof t === 'undefined') {\n        t = 0.5;\n      }\n      t = Math.max(Math.min(1, t), 0);\n      return new Point(this.x + (that.x - this.x) * t, this.y + (that.y - this.y) * t);\n    },\n\n    /**\n     * Returns distance from this point and another one\n     * @param {fabric.Point} that\n     * @return {Number}\n     */\n    distanceFrom: function (that) {\n      var dx = this.x - that.x,\n          dy = this.y - that.y;\n      return Math.sqrt(dx * dx + dy * dy);\n    },\n\n    /**\n     * Returns the point between this point and another one\n     * @param {fabric.Point} that\n     * @return {fabric.Point}\n     */\n    midPointFrom: function (that) {\n      return this.lerp(that);\n    },\n\n    /**\n     * Returns a new point which is the min of this and another one\n     * @param {fabric.Point} that\n     * @return {fabric.Point}\n     */\n    min: function (that) {\n      return new Point(Math.min(this.x, that.x), Math.min(this.y, that.y));\n    },\n\n    /**\n     * Returns a new point which is the max of this and another one\n     * @param {fabric.Point} that\n     * @return {fabric.Point}\n     */\n    max: function (that) {\n      return new Point(Math.max(this.x, that.x), Math.max(this.y, that.y));\n    },\n\n    /**\n     * Returns string representation of this point\n     * @return {String}\n     */\n    toString: function () {\n      return this.x + ',' + this.y;\n    },\n\n    /**\n     * Sets x/y of this point\n     * @param {Number} x\n     * @param {Number} y\n     * @chainable\n     */\n    setXY: function (x, y) {\n      this.x = x;\n      this.y = y;\n      return this;\n    },\n\n    /**\n     * Sets x of this point\n     * @param {Number} x\n     * @chainable\n     */\n    setX: function (x) {\n      this.x = x;\n      return this;\n    },\n\n    /**\n     * Sets y of this point\n     * @param {Number} y\n     * @chainable\n     */\n    setY: function (y) {\n      this.y = y;\n      return this;\n    },\n\n    /**\n     * Sets x/y of this point from another point\n     * @param {fabric.Point} that\n     * @chainable\n     */\n    setFromPoint: function (that) {\n      this.x = that.x;\n      this.y = that.y;\n      return this;\n    },\n\n    /**\n     * Swaps x/y of this point and another point\n     * @param {fabric.Point} that\n     */\n    swap: function (that) {\n      var x = this.x,\n          y = this.y;\n      this.x = that.x;\n      this.y = that.y;\n      that.x = x;\n      that.y = y;\n    },\n\n    /**\n     * return a cloned instance of the point\n     * @return {fabric.Point}\n     */\n    clone: function () {\n      return new Point(this.x, this.y);\n    }\n  };\n\n})(typeof exports !== 'undefined' ? exports : this);\n\n\n(function(global) {\n\n  'use strict';\n\n  /* Adaptation of work of Kevin Lindsey (kevin@kevlindev.com) */\n  var fabric = global.fabric || (global.fabric = { });\n\n  if (fabric.Intersection) {\n    fabric.warn('fabric.Intersection is already defined');\n    return;\n  }\n\n  /**\n   * Intersection class\n   * @class fabric.Intersection\n   * @memberOf fabric\n   * @constructor\n   */\n  function Intersection(status) {\n    this.status = status;\n    this.points = [];\n  }\n\n  fabric.Intersection = Intersection;\n\n  fabric.Intersection.prototype = /** @lends fabric.Intersection.prototype */ {\n\n    constructor: Intersection,\n\n    /**\n     * Appends a point to intersection\n     * @param {fabric.Point} point\n     * @return {fabric.Intersection} thisArg\n     * @chainable\n     */\n    appendPoint: function (point) {\n      this.points.push(point);\n      return this;\n    },\n\n    /**\n     * Appends points to intersection\n     * @param {Array} points\n     * @return {fabric.Intersection} thisArg\n     * @chainable\n     */\n    appendPoints: function (points) {\n      this.points = this.points.concat(points);\n      return this;\n    }\n  };\n\n  /**\n   * Checks if one line intersects another\n   * TODO: rename in intersectSegmentSegment\n   * @static\n   * @param {fabric.Point} a1\n   * @param {fabric.Point} a2\n   * @param {fabric.Point} b1\n   * @param {fabric.Point} b2\n   * @return {fabric.Intersection}\n   */\n  fabric.Intersection.intersectLineLine = function (a1, a2, b1, b2) {\n    var result,\n        uaT = (b2.x - b1.x) * (a1.y - b1.y) - (b2.y - b1.y) * (a1.x - b1.x),\n        ubT = (a2.x - a1.x) * (a1.y - b1.y) - (a2.y - a1.y) * (a1.x - b1.x),\n        uB = (b2.y - b1.y) * (a2.x - a1.x) - (b2.x - b1.x) * (a2.y - a1.y);\n    if (uB !== 0) {\n      var ua = uaT / uB,\n          ub = ubT / uB;\n      if (0 <= ua && ua <= 1 && 0 <= ub && ub <= 1) {\n        result = new Intersection('Intersection');\n        result.appendPoint(new fabric.Point(a1.x + ua * (a2.x - a1.x), a1.y + ua * (a2.y - a1.y)));\n      }\n      else {\n        result = new Intersection();\n      }\n    }\n    else {\n      if (uaT === 0 || ubT === 0) {\n        result = new Intersection('Coincident');\n      }\n      else {\n        result = new Intersection('Parallel');\n      }\n    }\n    return result;\n  };\n\n  /**\n   * Checks if line intersects polygon\n   * TODO: rename in intersectSegmentPolygon\n   * fix detection of coincident\n   * @static\n   * @param {fabric.Point} a1\n   * @param {fabric.Point} a2\n   * @param {Array} points\n   * @return {fabric.Intersection}\n   */\n  fabric.Intersection.intersectLinePolygon = function(a1, a2, points) {\n    var result = new Intersection(),\n        length = points.length,\n        b1, b2, inter, i;\n\n    for (i = 0; i < length; i++) {\n      b1 = points[i];\n      b2 = points[(i + 1) % length];\n      inter = Intersection.intersectLineLine(a1, a2, b1, b2);\n\n      result.appendPoints(inter.points);\n    }\n    if (result.points.length > 0) {\n      result.status = 'Intersection';\n    }\n    return result;\n  };\n\n  /**\n   * Checks if polygon intersects another polygon\n   * @static\n   * @param {Array} points1\n   * @param {Array} points2\n   * @return {fabric.Intersection}\n   */\n  fabric.Intersection.intersectPolygonPolygon = function (points1, points2) {\n    var result = new Intersection(),\n        length = points1.length, i;\n\n    for (i = 0; i < length; i++) {\n      var a1 = points1[i],\n          a2 = points1[(i + 1) % length],\n          inter = Intersection.intersectLinePolygon(a1, a2, points2);\n\n      result.appendPoints(inter.points);\n    }\n    if (result.points.length > 0) {\n      result.status = 'Intersection';\n    }\n    return result;\n  };\n\n  /**\n   * Checks if polygon intersects rectangle\n   * @static\n   * @param {Array} points\n   * @param {fabric.Point} r1\n   * @param {fabric.Point} r2\n   * @return {fabric.Intersection}\n   */\n  fabric.Intersection.intersectPolygonRectangle = function (points, r1, r2) {\n    var min = r1.min(r2),\n        max = r1.max(r2),\n        topRight = new fabric.Point(max.x, min.y),\n        bottomLeft = new fabric.Point(min.x, max.y),\n        inter1 = Intersection.intersectLinePolygon(min, topRight, points),\n        inter2 = Intersection.intersectLinePolygon(topRight, max, points),\n        inter3 = Intersection.intersectLinePolygon(max, bottomLeft, points),\n        inter4 = Intersection.intersectLinePolygon(bottomLeft, min, points),\n        result = new Intersection();\n\n    result.appendPoints(inter1.points);\n    result.appendPoints(inter2.points);\n    result.appendPoints(inter3.points);\n    result.appendPoints(inter4.points);\n\n    if (result.points.length > 0) {\n      result.status = 'Intersection';\n    }\n    return result;\n  };\n\n})(typeof exports !== 'undefined' ? exports : this);\n\n\n(function(global) {\n\n  'use strict';\n\n  var fabric = global.fabric || (global.fabric = { });\n\n  if (fabric.Color) {\n    fabric.warn('fabric.Color is already defined.');\n    return;\n  }\n\n  /**\n   * Color class\n   * The purpose of {@link fabric.Color} is to abstract and encapsulate common color operations;\n   * {@link fabric.Color} is a constructor and creates instances of {@link fabric.Color} objects.\n   *\n   * @class fabric.Color\n   * @param {String} color optional in hex or rgb(a) or hsl format or from known color list\n   * @return {fabric.Color} thisArg\n   * @tutorial {@link http://fabricjs.com/fabric-intro-part-2/#colors}\n   */\n  function Color(color) {\n    if (!color) {\n      this.setSource([0, 0, 0, 1]);\n    }\n    else {\n      this._tryParsingColor(color);\n    }\n  }\n\n  fabric.Color = Color;\n\n  fabric.Color.prototype = /** @lends fabric.Color.prototype */ {\n\n    /**\n     * @private\n     * @param {String|Array} color Color value to parse\n     */\n    _tryParsingColor: function(color) {\n      var source;\n\n      if (color in Color.colorNameMap) {\n        color = Color.colorNameMap[color];\n      }\n\n      if (color === 'transparent') {\n        source = [255, 255, 255, 0];\n      }\n\n      if (!source) {\n        source = Color.sourceFromHex(color);\n      }\n      if (!source) {\n        source = Color.sourceFromRgb(color);\n      }\n      if (!source) {\n        source = Color.sourceFromHsl(color);\n      }\n      if (!source) {\n        //if color is not recognize let's make black as canvas does\n        source = [0, 0, 0, 1];\n      }\n      if (source) {\n        this.setSource(source);\n      }\n    },\n\n    /**\n     * Adapted from <a href=\"https://rawgithub.com/mjijackson/mjijackson.github.com/master/2008/02/rgb-to-hsl-and-rgb-to-hsv-color-model-conversion-algorithms-in-javascript.html\">https://github.com/mjijackson</a>\n     * @private\n     * @param {Number} r Red color value\n     * @param {Number} g Green color value\n     * @param {Number} b Blue color value\n     * @return {Array} Hsl color\n     */\n    _rgbToHsl: function(r, g, b) {\n      r /= 255; g /= 255; b /= 255;\n\n      var h, s, l,\n          max = fabric.util.array.max([r, g, b]),\n          min = fabric.util.array.min([r, g, b]);\n\n      l = (max + min) / 2;\n\n      if (max === min) {\n        h = s = 0; // achromatic\n      }\n      else {\n        var d = max - min;\n        s = l > 0.5 ? d / (2 - max - min) : d / (max + min);\n        switch (max) {\n          case r:\n            h = (g - b) / d + (g < b ? 6 : 0);\n            break;\n          case g:\n            h = (b - r) / d + 2;\n            break;\n          case b:\n            h = (r - g) / d + 4;\n            break;\n        }\n        h /= 6;\n      }\n\n      return [\n        Math.round(h * 360),\n        Math.round(s * 100),\n        Math.round(l * 100)\n      ];\n    },\n\n    /**\n     * Returns source of this color (where source is an array representation; ex: [200, 200, 100, 1])\n     * @return {Array}\n     */\n    getSource: function() {\n      return this._source;\n    },\n\n    /**\n     * Sets source of this color (where source is an array representation; ex: [200, 200, 100, 1])\n     * @param {Array} source\n     */\n    setSource: function(source) {\n      this._source = source;\n    },\n\n    /**\n     * Returns color representation in RGB format\n     * @return {String} ex: rgb(0-255,0-255,0-255)\n     */\n    toRgb: function() {\n      var source = this.getSource();\n      return 'rgb(' + source[0] + ',' + source[1] + ',' + source[2] + ')';\n    },\n\n    /**\n     * Returns color representation in RGBA format\n     * @return {String} ex: rgba(0-255,0-255,0-255,0-1)\n     */\n    toRgba: function() {\n      var source = this.getSource();\n      return 'rgba(' + source[0] + ',' + source[1] + ',' + source[2] + ',' + source[3] + ')';\n    },\n\n    /**\n     * Returns color representation in HSL format\n     * @return {String} ex: hsl(0-360,0%-100%,0%-100%)\n     */\n    toHsl: function() {\n      var source = this.getSource(),\n          hsl = this._rgbToHsl(source[0], source[1], source[2]);\n\n      return 'hsl(' + hsl[0] + ',' + hsl[1] + '%,' + hsl[2] + '%)';\n    },\n\n    /**\n     * Returns color representation in HSLA format\n     * @return {String} ex: hsla(0-360,0%-100%,0%-100%,0-1)\n     */\n    toHsla: function() {\n      var source = this.getSource(),\n          hsl = this._rgbToHsl(source[0], source[1], source[2]);\n\n      return 'hsla(' + hsl[0] + ',' + hsl[1] + '%,' + hsl[2] + '%,' + source[3] + ')';\n    },\n\n    /**\n     * Returns color representation in HEX format\n     * @return {String} ex: FF5555\n     */\n    toHex: function() {\n      var source = this.getSource(), r, g, b;\n\n      r = source[0].toString(16);\n      r = (r.length === 1) ? ('0' + r) : r;\n\n      g = source[1].toString(16);\n      g = (g.length === 1) ? ('0' + g) : g;\n\n      b = source[2].toString(16);\n      b = (b.length === 1) ? ('0' + b) : b;\n\n      return r.toUpperCase() + g.toUpperCase() + b.toUpperCase();\n    },\n\n    /**\n     * Returns color representation in HEXA format\n     * @return {String} ex: FF5555CC\n     */\n    toHexa: function() {\n      var source = this.getSource(), a;\n\n      a = Math.round(source[3] * 255);\n      a = a.toString(16);\n      a = (a.length === 1) ? ('0' + a) : a;\n\n      return this.toHex() + a.toUpperCase();\n    },\n\n    /**\n     * Gets value of alpha channel for this color\n     * @return {Number} 0-1\n     */\n    getAlpha: function() {\n      return this.getSource()[3];\n    },\n\n    /**\n     * Sets value of alpha channel for this color\n     * @param {Number} alpha Alpha value 0-1\n     * @return {fabric.Color} thisArg\n     */\n    setAlpha: function(alpha) {\n      var source = this.getSource();\n      source[3] = alpha;\n      this.setSource(source);\n      return this;\n    },\n\n    /**\n     * Transforms color to its grayscale representation\n     * @return {fabric.Color} thisArg\n     */\n    toGrayscale: function() {\n      var source = this.getSource(),\n          average = parseInt((source[0] * 0.3 + source[1] * 0.59 + source[2] * 0.11).toFixed(0), 10),\n          currentAlpha = source[3];\n      this.setSource([average, average, average, currentAlpha]);\n      return this;\n    },\n\n    /**\n     * Transforms color to its black and white representation\n     * @param {Number} threshold\n     * @return {fabric.Color} thisArg\n     */\n    toBlackWhite: function(threshold) {\n      var source = this.getSource(),\n          average = (source[0] * 0.3 + source[1] * 0.59 + source[2] * 0.11).toFixed(0),\n          currentAlpha = source[3];\n\n      threshold = threshold || 127;\n\n      average = (Number(average) < Number(threshold)) ? 0 : 255;\n      this.setSource([average, average, average, currentAlpha]);\n      return this;\n    },\n\n    /**\n     * Overlays color with another color\n     * @param {String|fabric.Color} otherColor\n     * @return {fabric.Color} thisArg\n     */\n    overlayWith: function(otherColor) {\n      if (!(otherColor instanceof Color)) {\n        otherColor = new Color(otherColor);\n      }\n\n      var result = [],\n          alpha = this.getAlpha(),\n          otherAlpha = 0.5,\n          source = this.getSource(),\n          otherSource = otherColor.getSource(), i;\n\n      for (i = 0; i < 3; i++) {\n        result.push(Math.round((source[i] * (1 - otherAlpha)) + (otherSource[i] * otherAlpha)));\n      }\n\n      result[3] = alpha;\n      this.setSource(result);\n      return this;\n    }\n  };\n\n  /**\n   * Regex matching color in RGB or RGBA formats (ex: rgb(0, 0, 0), rgba(255, 100, 10, 0.5), rgba( 255 , 100 , 10 , 0.5 ), rgb(1,1,1), rgba(100%, 60%, 10%, 0.5))\n   * @static\n   * @field\n   * @memberOf fabric.Color\n   */\n  // eslint-disable-next-line max-len\n  fabric.Color.reRGBa = /^rgba?\\(\\s*(\\d{1,3}(?:\\.\\d+)?\\%?)\\s*,\\s*(\\d{1,3}(?:\\.\\d+)?\\%?)\\s*,\\s*(\\d{1,3}(?:\\.\\d+)?\\%?)\\s*(?:\\s*,\\s*((?:\\d*\\.?\\d+)?)\\s*)?\\)$/i;\n\n  /**\n   * Regex matching color in HSL or HSLA formats (ex: hsl(200, 80%, 10%), hsla(300, 50%, 80%, 0.5), hsla( 300 , 50% , 80% , 0.5 ))\n   * @static\n   * @field\n   * @memberOf fabric.Color\n   */\n  fabric.Color.reHSLa = /^hsla?\\(\\s*(\\d{1,3})\\s*,\\s*(\\d{1,3}\\%)\\s*,\\s*(\\d{1,3}\\%)\\s*(?:\\s*,\\s*(\\d+(?:\\.\\d+)?)\\s*)?\\)$/i;\n\n  /**\n   * Regex matching color in HEX format (ex: #FF5544CC, #FF5555, 010155, aff)\n   * @static\n   * @field\n   * @memberOf fabric.Color\n   */\n  fabric.Color.reHex = /^#?([0-9a-f]{8}|[0-9a-f]{6}|[0-9a-f]{4}|[0-9a-f]{3})$/i;\n\n  /**\n   * Map of the 148 color names with HEX code\n   * @static\n   * @field\n   * @memberOf fabric.Color\n   * @see: https://www.w3.org/TR/css3-color/#svg-color\n   */\n  fabric.Color.colorNameMap = {\n    aliceblue:            '#F0F8FF',\n    antiquewhite:         '#FAEBD7',\n    aqua:                 '#00FFFF',\n    aquamarine:           '#7FFFD4',\n    azure:                '#F0FFFF',\n    beige:                '#F5F5DC',\n    bisque:               '#FFE4C4',\n    black:                '#000000',\n    blanchedalmond:       '#FFEBCD',\n    blue:                 '#0000FF',\n    blueviolet:           '#8A2BE2',\n    brown:                '#A52A2A',\n    burlywood:            '#DEB887',\n    cadetblue:            '#5F9EA0',\n    chartreuse:           '#7FFF00',\n    chocolate:            '#D2691E',\n    coral:                '#FF7F50',\n    cornflowerblue:       '#6495ED',\n    cornsilk:             '#FFF8DC',\n    crimson:              '#DC143C',\n    cyan:                 '#00FFFF',\n    darkblue:             '#00008B',\n    darkcyan:             '#008B8B',\n    darkgoldenrod:        '#B8860B',\n    darkgray:             '#A9A9A9',\n    darkgrey:             '#A9A9A9',\n    darkgreen:            '#006400',\n    darkkhaki:            '#BDB76B',\n    darkmagenta:          '#8B008B',\n    darkolivegreen:       '#556B2F',\n    darkorange:           '#FF8C00',\n    darkorchid:           '#9932CC',\n    darkred:              '#8B0000',\n    darksalmon:           '#E9967A',\n    darkseagreen:         '#8FBC8F',\n    darkslateblue:        '#483D8B',\n    darkslategray:        '#2F4F4F',\n    darkslategrey:        '#2F4F4F',\n    darkturquoise:        '#00CED1',\n    darkviolet:           '#9400D3',\n    deeppink:             '#FF1493',\n    deepskyblue:          '#00BFFF',\n    dimgray:              '#696969',\n    dimgrey:              '#696969',\n    dodgerblue:           '#1E90FF',\n    firebrick:            '#B22222',\n    floralwhite:          '#FFFAF0',\n    forestgreen:          '#228B22',\n    fuchsia:              '#FF00FF',\n    gainsboro:            '#DCDCDC',\n    ghostwhite:           '#F8F8FF',\n    gold:                 '#FFD700',\n    goldenrod:            '#DAA520',\n    gray:                 '#808080',\n    grey:                 '#808080',\n    green:                '#008000',\n    greenyellow:          '#ADFF2F',\n    honeydew:             '#F0FFF0',\n    hotpink:              '#FF69B4',\n    indianred:            '#CD5C5C',\n    indigo:               '#4B0082',\n    ivory:                '#FFFFF0',\n    khaki:                '#F0E68C',\n    lavender:             '#E6E6FA',\n    lavenderblush:        '#FFF0F5',\n    lawngreen:            '#7CFC00',\n    lemonchiffon:         '#FFFACD',\n    lightblue:            '#ADD8E6',\n    lightcoral:           '#F08080',\n    lightcyan:            '#E0FFFF',\n    lightgoldenrodyellow: '#FAFAD2',\n    lightgray:            '#D3D3D3',\n    lightgrey:            '#D3D3D3',\n    lightgreen:           '#90EE90',\n    lightpink:            '#FFB6C1',\n    lightsalmon:          '#FFA07A',\n    lightseagreen:        '#20B2AA',\n    lightskyblue:         '#87CEFA',\n    lightslategray:       '#778899',\n    lightslategrey:       '#778899',\n    lightsteelblue:       '#B0C4DE',\n    lightyellow:          '#FFFFE0',\n    lime:                 '#00FF00',\n    limegreen:            '#32CD32',\n    linen:                '#FAF0E6',\n    magenta:              '#FF00FF',\n    maroon:               '#800000',\n    mediumaquamarine:     '#66CDAA',\n    mediumblue:           '#0000CD',\n    mediumorchid:         '#BA55D3',\n    mediumpurple:         '#9370DB',\n    mediumseagreen:       '#3CB371',\n    mediumslateblue:      '#7B68EE',\n    mediumspringgreen:    '#00FA9A',\n    mediumturquoise:      '#48D1CC',\n    mediumvioletred:      '#C71585',\n    midnightblue:         '#191970',\n    mintcream:            '#F5FFFA',\n    mistyrose:            '#FFE4E1',\n    moccasin:             '#FFE4B5',\n    navajowhite:          '#FFDEAD',\n    navy:                 '#000080',\n    oldlace:              '#FDF5E6',\n    olive:                '#808000',\n    olivedrab:            '#6B8E23',\n    orange:               '#FFA500',\n    orangered:            '#FF4500',\n    orchid:               '#DA70D6',\n    palegoldenrod:        '#EEE8AA',\n    palegreen:            '#98FB98',\n    paleturquoise:        '#AFEEEE',\n    palevioletred:        '#DB7093',\n    papayawhip:           '#FFEFD5',\n    peachpuff:            '#FFDAB9',\n    peru:                 '#CD853F',\n    pink:                 '#FFC0CB',\n    plum:                 '#DDA0DD',\n    powderblue:           '#B0E0E6',\n    purple:               '#800080',\n    rebeccapurple:        '#663399',\n    red:                  '#FF0000',\n    rosybrown:            '#BC8F8F',\n    royalblue:            '#4169E1',\n    saddlebrown:          '#8B4513',\n    salmon:               '#FA8072',\n    sandybrown:           '#F4A460',\n    seagreen:             '#2E8B57',\n    seashell:             '#FFF5EE',\n    sienna:               '#A0522D',\n    silver:               '#C0C0C0',\n    skyblue:              '#87CEEB',\n    slateblue:            '#6A5ACD',\n    slategray:            '#708090',\n    slategrey:            '#708090',\n    snow:                 '#FFFAFA',\n    springgreen:          '#00FF7F',\n    steelblue:            '#4682B4',\n    tan:                  '#D2B48C',\n    teal:                 '#008080',\n    thistle:              '#D8BFD8',\n    tomato:               '#FF6347',\n    turquoise:            '#40E0D0',\n    violet:               '#EE82EE',\n    wheat:                '#F5DEB3',\n    white:                '#FFFFFF',\n    whitesmoke:           '#F5F5F5',\n    yellow:               '#FFFF00',\n    yellowgreen:          '#9ACD32'\n  };\n\n  /**\n   * @private\n   * @param {Number} p\n   * @param {Number} q\n   * @param {Number} t\n   * @return {Number}\n   */\n  function hue2rgb(p, q, t) {\n    if (t < 0) {\n      t += 1;\n    }\n    if (t > 1) {\n      t -= 1;\n    }\n    if (t < 1 / 6) {\n      return p + (q - p) * 6 * t;\n    }\n    if (t < 1 / 2) {\n      return q;\n    }\n    if (t < 2 / 3) {\n      return p + (q - p) * (2 / 3 - t) * 6;\n    }\n    return p;\n  }\n\n  /**\n   * Returns new color object, when given a color in RGB format\n   * @memberOf fabric.Color\n   * @param {String} color Color value ex: rgb(0-255,0-255,0-255)\n   * @return {fabric.Color}\n   */\n  fabric.Color.fromRgb = function(color) {\n    return Color.fromSource(Color.sourceFromRgb(color));\n  };\n\n  /**\n   * Returns array representation (ex: [100, 100, 200, 1]) of a color that's in RGB or RGBA format\n   * @memberOf fabric.Color\n   * @param {String} color Color value ex: rgb(0-255,0-255,0-255), rgb(0%-100%,0%-100%,0%-100%)\n   * @return {Array} source\n   */\n  fabric.Color.sourceFromRgb = function(color) {\n    var match = color.match(Color.reRGBa);\n    if (match) {\n      var r = parseInt(match[1], 10) / (/%$/.test(match[1]) ? 100 : 1) * (/%$/.test(match[1]) ? 255 : 1),\n          g = parseInt(match[2], 10) / (/%$/.test(match[2]) ? 100 : 1) * (/%$/.test(match[2]) ? 255 : 1),\n          b = parseInt(match[3], 10) / (/%$/.test(match[3]) ? 100 : 1) * (/%$/.test(match[3]) ? 255 : 1);\n\n      return [\n        parseInt(r, 10),\n        parseInt(g, 10),\n        parseInt(b, 10),\n        match[4] ? parseFloat(match[4]) : 1\n      ];\n    }\n  };\n\n  /**\n   * Returns new color object, when given a color in RGBA format\n   * @static\n   * @function\n   * @memberOf fabric.Color\n   * @param {String} color\n   * @return {fabric.Color}\n   */\n  fabric.Color.fromRgba = Color.fromRgb;\n\n  /**\n   * Returns new color object, when given a color in HSL format\n   * @param {String} color Color value ex: hsl(0-260,0%-100%,0%-100%)\n   * @memberOf fabric.Color\n   * @return {fabric.Color}\n   */\n  fabric.Color.fromHsl = function(color) {\n    return Color.fromSource(Color.sourceFromHsl(color));\n  };\n\n  /**\n   * Returns array representation (ex: [100, 100, 200, 1]) of a color that's in HSL or HSLA format.\n   * Adapted from <a href=\"https://rawgithub.com/mjijackson/mjijackson.github.com/master/2008/02/rgb-to-hsl-and-rgb-to-hsv-color-model-conversion-algorithms-in-javascript.html\">https://github.com/mjijackson</a>\n   * @memberOf fabric.Color\n   * @param {String} color Color value ex: hsl(0-360,0%-100%,0%-100%) or hsla(0-360,0%-100%,0%-100%, 0-1)\n   * @return {Array} source\n   * @see http://http://www.w3.org/TR/css3-color/#hsl-color\n   */\n  fabric.Color.sourceFromHsl = function(color) {\n    var match = color.match(Color.reHSLa);\n    if (!match) {\n      return;\n    }\n\n    var h = (((parseFloat(match[1]) % 360) + 360) % 360) / 360,\n        s = parseFloat(match[2]) / (/%$/.test(match[2]) ? 100 : 1),\n        l = parseFloat(match[3]) / (/%$/.test(match[3]) ? 100 : 1),\n        r, g, b;\n\n    if (s === 0) {\n      r = g = b = l;\n    }\n    else {\n      var q = l <= 0.5 ? l * (s + 1) : l + s - l * s,\n          p = l * 2 - q;\n\n      r = hue2rgb(p, q, h + 1 / 3);\n      g = hue2rgb(p, q, h);\n      b = hue2rgb(p, q, h - 1 / 3);\n    }\n\n    return [\n      Math.round(r * 255),\n      Math.round(g * 255),\n      Math.round(b * 255),\n      match[4] ? parseFloat(match[4]) : 1\n    ];\n  };\n\n  /**\n   * Returns new color object, when given a color in HSLA format\n   * @static\n   * @function\n   * @memberOf fabric.Color\n   * @param {String} color\n   * @return {fabric.Color}\n   */\n  fabric.Color.fromHsla = Color.fromHsl;\n\n  /**\n   * Returns new color object, when given a color in HEX format\n   * @static\n   * @memberOf fabric.Color\n   * @param {String} color Color value ex: FF5555\n   * @return {fabric.Color}\n   */\n  fabric.Color.fromHex = function(color) {\n    return Color.fromSource(Color.sourceFromHex(color));\n  };\n\n  /**\n   * Returns array representation (ex: [100, 100, 200, 1]) of a color that's in HEX format\n   * @static\n   * @memberOf fabric.Color\n   * @param {String} color ex: FF5555 or FF5544CC (RGBa)\n   * @return {Array} source\n   */\n  fabric.Color.sourceFromHex = function(color) {\n    if (color.match(Color.reHex)) {\n      var value = color.slice(color.indexOf('#') + 1),\n          isShortNotation = (value.length === 3 || value.length === 4),\n          isRGBa = (value.length === 8 || value.length === 4),\n          r = isShortNotation ? (value.charAt(0) + value.charAt(0)) : value.substring(0, 2),\n          g = isShortNotation ? (value.charAt(1) + value.charAt(1)) : value.substring(2, 4),\n          b = isShortNotation ? (value.charAt(2) + value.charAt(2)) : value.substring(4, 6),\n          a = isRGBa ? (isShortNotation ? (value.charAt(3) + value.charAt(3)) : value.substring(6, 8)) : 'FF';\n\n      return [\n        parseInt(r, 16),\n        parseInt(g, 16),\n        parseInt(b, 16),\n        parseFloat((parseInt(a, 16) / 255).toFixed(2))\n      ];\n    }\n  };\n\n  /**\n   * Returns new color object, when given color in array representation (ex: [200, 100, 100, 0.5])\n   * @static\n   * @memberOf fabric.Color\n   * @param {Array} source\n   * @return {fabric.Color}\n   */\n  fabric.Color.fromSource = function(source) {\n    var oColor = new Color();\n    oColor.setSource(source);\n    return oColor;\n  };\n\n})(typeof exports !== 'undefined' ? exports : this);\n\n\n(function(global) {\n\n  'use strict';\n\n  var fabric = global.fabric || (global.fabric = { }),\n      scaleMap = ['e', 'se', 's', 'sw', 'w', 'nw', 'n', 'ne', 'e'],\n      skewMap = ['ns', 'nesw', 'ew', 'nwse'],\n      controls = {},\n      LEFT = 'left', TOP = 'top', RIGHT = 'right', BOTTOM = 'bottom', CENTER = 'center',\n      opposite = {\n        top: BOTTOM,\n        bottom: TOP,\n        left: RIGHT,\n        right: LEFT,\n        center: CENTER,\n      }, radiansToDegrees = fabric.util.radiansToDegrees,\n      sign = (Math.sign || function(x) { return ((x > 0) - (x < 0)) || +x; });\n\n  /**\n   * Combine control position and object angle to find the control direction compared\n   * to the object center.\n   * @param {fabric.Object} fabricObject the fabric object for which we are rendering controls\n   * @param {fabric.Control} control the control class\n   * @return {Number} 0 - 7 a quadrant number\n   */\n  function findCornerQuadrant(fabricObject, control) {\n    var cornerAngle = fabricObject.angle + radiansToDegrees(Math.atan2(control.y, control.x)) + 360;\n    return Math.round((cornerAngle % 360) / 45);\n  }\n\n  function fireEvent(eventName, options) {\n    var target = options.transform.target,\n        canvas = target.canvas,\n        canvasOptions = fabric.util.object.clone(options);\n    canvasOptions.target = target;\n    canvas && canvas.fire('object:' + eventName, canvasOptions);\n    target.fire(eventName, options);\n  }\n\n  /**\n   * Inspect event and fabricObject properties to understand if the scaling action\n   * @param {Event} eventData from the user action\n   * @param {fabric.Object} fabricObject the fabric object about to scale\n   * @return {Boolean} true if scale is proportional\n   */\n  function scaleIsProportional(eventData, fabricObject) {\n    var canvas = fabricObject.canvas, uniScaleKey = canvas.uniScaleKey,\n        uniformIsToggled = eventData[uniScaleKey];\n    return (canvas.uniformScaling && !uniformIsToggled) ||\n    (!canvas.uniformScaling && uniformIsToggled);\n  }\n\n  /**\n   * Checks if transform is centered\n   * @param {Object} transform transform data\n   * @return {Boolean} true if transform is centered\n   */\n  function isTransformCentered(transform) {\n    return transform.originX === CENTER && transform.originY === CENTER;\n  }\n\n  /**\n   * Inspect fabricObject to understand if the current scaling action is allowed\n   * @param {fabric.Object} fabricObject the fabric object about to scale\n   * @param {String} by 'x' or 'y' or ''\n   * @param {Boolean} scaleProportionally true if we are trying to scale proportionally\n   * @return {Boolean} true if scaling is not allowed at current conditions\n   */\n  function scalingIsForbidden(fabricObject, by, scaleProportionally) {\n    var lockX = fabricObject.lockScalingX, lockY = fabricObject.lockScalingY;\n    if (lockX && lockY) {\n      return true;\n    }\n    if (!by && (lockX || lockY) && scaleProportionally) {\n      return true;\n    }\n    if (lockX && by === 'x') {\n      return true;\n    }\n    if (lockY && by === 'y') {\n      return true;\n    }\n    return false;\n  }\n\n  /**\n   * return the correct cursor style for the scale action\n   * @param {Event} eventData the javascript event that is causing the scale\n   * @param {fabric.Control} control the control that is interested in the action\n   * @param {fabric.Object} fabricObject the fabric object that is interested in the action\n   * @return {String} a valid css string for the cursor\n   */\n  function scaleCursorStyleHandler(eventData, control, fabricObject) {\n    var notAllowed = 'not-allowed',\n        scaleProportionally = scaleIsProportional(eventData, fabricObject),\n        by = '';\n    if (control.x !== 0 && control.y === 0) {\n      by = 'x';\n    }\n    else if (control.x === 0 && control.y !== 0) {\n      by = 'y';\n    }\n    if (scalingIsForbidden(fabricObject, by, scaleProportionally)) {\n      return notAllowed;\n    }\n    var n = findCornerQuadrant(fabricObject, control);\n    return scaleMap[n] + '-resize';\n  }\n\n  /**\n   * return the correct cursor style for the skew action\n   * @param {Event} eventData the javascript event that is causing the scale\n   * @param {fabric.Control} control the control that is interested in the action\n   * @param {fabric.Object} fabricObject the fabric object that is interested in the action\n   * @return {String} a valid css string for the cursor\n   */\n  function skewCursorStyleHandler(eventData, control, fabricObject) {\n    var notAllowed = 'not-allowed';\n    if (control.x !== 0 && fabricObject.lockSkewingY) {\n      return notAllowed;\n    }\n    if (control.y !== 0 && fabricObject.lockSkewingX) {\n      return notAllowed;\n    }\n    var n = findCornerQuadrant(fabricObject, control) % 4;\n    return skewMap[n] + '-resize';\n  }\n\n  /**\n   * Combine skew and scale style handlers to cover fabric standard use case\n   * @param {Event} eventData the javascript event that is causing the scale\n   * @param {fabric.Control} control the control that is interested in the action\n   * @param {fabric.Object} fabricObject the fabric object that is interested in the action\n   * @return {String} a valid css string for the cursor\n   */\n  function scaleSkewCursorStyleHandler(eventData, control, fabricObject) {\n    if (eventData[fabricObject.canvas.altActionKey]) {\n      return controls.skewCursorStyleHandler(eventData, control, fabricObject);\n    }\n    return controls.scaleCursorStyleHandler(eventData, control, fabricObject);\n  }\n\n  /**\n   * Inspect event, control and fabricObject to return the correct action name\n   * @param {Event} eventData the javascript event that is causing the scale\n   * @param {fabric.Control} control the control that is interested in the action\n   * @param {fabric.Object} fabricObject the fabric object that is interested in the action\n   * @return {String} an action name\n   */\n  function scaleOrSkewActionName(eventData, control, fabricObject) {\n    var isAlternative = eventData[fabricObject.canvas.altActionKey];\n    if (control.x === 0) {\n      // then is scaleY or skewX\n      return isAlternative ? 'skewX' : 'scaleY';\n    }\n    if (control.y === 0) {\n      // then is scaleY or skewX\n      return isAlternative ? 'skewY' : 'scaleX';\n    }\n  }\n\n  /**\n   * Find the correct style for the control that is used for rotation.\n   * this function is very simple and it just take care of not-allowed or standard cursor\n   * @param {Event} eventData the javascript event that is causing the scale\n   * @param {fabric.Control} control the control that is interested in the action\n   * @param {fabric.Object} fabricObject the fabric object that is interested in the action\n   * @return {String} a valid css string for the cursor\n   */\n  function rotationStyleHandler(eventData, control, fabricObject) {\n    if (fabricObject.lockRotation) {\n      return 'not-allowed';\n    }\n    return control.cursorStyle;\n  }\n\n  function commonEventInfo(eventData, transform, x, y) {\n    return {\n      e: eventData,\n      transform: transform,\n      pointer: {\n        x: x,\n        y: y,\n      }\n    };\n  }\n\n  /**\n   * Wrap an action handler with saving/restoring object position on the transform.\n   * this is the code that permits to objects to keep their position while transforming.\n   * @param {Function} actionHandler the function to wrap\n   * @return {Function} a function with an action handler signature\n   */\n  function wrapWithFixedAnchor(actionHandler) {\n    return function(eventData, transform, x, y) {\n      var target = transform.target, centerPoint = target.getCenterPoint(),\n          constraint = target.translateToOriginPoint(centerPoint, transform.originX, transform.originY),\n          actionPerformed = actionHandler(eventData, transform, x, y);\n      target.setPositionByOrigin(constraint, transform.originX, transform.originY);\n      return actionPerformed;\n    };\n  }\n\n  /**\n   * Wrap an action handler with firing an event if the action is performed\n   * @param {Function} actionHandler the function to wrap\n   * @return {Function} a function with an action handler signature\n   */\n  function wrapWithFireEvent(eventName, actionHandler) {\n    return function(eventData, transform, x, y) {\n      var actionPerformed = actionHandler(eventData, transform, x, y);\n      if (actionPerformed) {\n        fireEvent(eventName, commonEventInfo(eventData, transform, x, y));\n      }\n      return actionPerformed;\n    };\n  }\n\n  /**\n   * Transforms a point described by x and y in a distance from the top left corner of the object\n   * bounding box.\n   * @param {Object} transform\n   * @param {String} originX\n   * @param {String} originY\n   * @param {number} x\n   * @param {number} y\n   * @return {Fabric.Point} the normalized point\n   */\n  function getLocalPoint(transform, originX, originY, x, y) {\n    var target = transform.target,\n        control = target.controls[transform.corner],\n        zoom = target.canvas.getZoom(),\n        padding = target.padding / zoom,\n        localPoint = target.toLocalPoint(new fabric.Point(x, y), originX, originY);\n    if (localPoint.x >= padding) {\n      localPoint.x -= padding;\n    }\n    if (localPoint.x <= -padding) {\n      localPoint.x += padding;\n    }\n    if (localPoint.y >= padding) {\n      localPoint.y -= padding;\n    }\n    if (localPoint.y <= padding) {\n      localPoint.y += padding;\n    }\n    localPoint.x -= control.offsetX;\n    localPoint.y -= control.offsetY;\n    return localPoint;\n  }\n\n  /**\n   * Detect if the fabric object is flipped on one side.\n   * @param {fabric.Object} target\n   * @return {Boolean} true if one flip, but not two.\n   */\n  function targetHasOneFlip(target) {\n    return target.flipX !== target.flipY;\n  }\n\n  /**\n   * Utility function to compensate the scale factor when skew is applied on both axes\n   * @private\n   */\n  function compensateScaleForSkew(target, oppositeSkew, scaleToCompensate, axis, reference) {\n    if (target[oppositeSkew] !== 0) {\n      var newDim = target._getTransformedDimensions()[axis];\n      var newValue = reference / newDim * target[scaleToCompensate];\n      target.set(scaleToCompensate, newValue);\n    }\n  }\n\n  /**\n   * Action handler for skewing on the X axis\n   * @private\n   */\n  function skewObjectX(eventData, transform, x, y) {\n    var target = transform.target,\n        // find how big the object would be, if there was no skewX. takes in account scaling\n        dimNoSkew = target._getTransformedDimensions(0, target.skewY),\n        localPoint = getLocalPoint(transform, transform.originX, transform.originY, x, y),\n        // the mouse is in the center of the object, and we want it to stay there.\n        // so the object will grow twice as much as the mouse.\n        // this makes the skew growth to localPoint * 2 - dimNoSkew.\n        totalSkewSize = Math.abs(localPoint.x * 2) - dimNoSkew.x,\n        currentSkew = target.skewX, newSkew;\n    if (totalSkewSize < 2) {\n      // let's make it easy to go back to position 0.\n      newSkew = 0;\n    }\n    else {\n      newSkew = radiansToDegrees(\n        Math.atan2((totalSkewSize / target.scaleX), (dimNoSkew.y / target.scaleY))\n      );\n      // now we have to find the sign of the skew.\n      // it mostly depend on the origin of transformation.\n      if (transform.originX === LEFT && transform.originY === BOTTOM) {\n        newSkew = -newSkew;\n      }\n      if (transform.originX === RIGHT && transform.originY === TOP) {\n        newSkew = -newSkew;\n      }\n      if (targetHasOneFlip(target)) {\n        newSkew = -newSkew;\n      }\n    }\n    var hasSkewed = currentSkew !== newSkew;\n    if (hasSkewed) {\n      var dimBeforeSkewing = target._getTransformedDimensions().y;\n      target.set('skewX', newSkew);\n      compensateScaleForSkew(target, 'skewY', 'scaleY', 'y', dimBeforeSkewing);\n    }\n    return hasSkewed;\n  }\n\n  /**\n   * Action handler for skewing on the Y axis\n   * @private\n   */\n  function skewObjectY(eventData, transform, x, y) {\n    var target = transform.target,\n        // find how big the object would be, if there was no skewX. takes in account scaling\n        dimNoSkew = target._getTransformedDimensions(target.skewX, 0),\n        localPoint = getLocalPoint(transform, transform.originX, transform.originY, x, y),\n        // the mouse is in the center of the object, and we want it to stay there.\n        // so the object will grow twice as much as the mouse.\n        // this makes the skew growth to localPoint * 2 - dimNoSkew.\n        totalSkewSize = Math.abs(localPoint.y * 2) - dimNoSkew.y,\n        currentSkew = target.skewY, newSkew;\n    if (totalSkewSize < 2) {\n      // let's make it easy to go back to position 0.\n      newSkew = 0;\n    }\n    else {\n      newSkew = radiansToDegrees(\n        Math.atan2((totalSkewSize / target.scaleY), (dimNoSkew.x / target.scaleX))\n      );\n      // now we have to find the sign of the skew.\n      // it mostly depend on the origin of transformation.\n      if (transform.originX === LEFT && transform.originY === BOTTOM) {\n        newSkew = -newSkew;\n      }\n      if (transform.originX === RIGHT && transform.originY === TOP) {\n        newSkew = -newSkew;\n      }\n      if (targetHasOneFlip(target)) {\n        newSkew = -newSkew;\n      }\n    }\n    var hasSkewed = currentSkew !== newSkew;\n    if (hasSkewed) {\n      var dimBeforeSkewing = target._getTransformedDimensions().x;\n      target.set('skewY', newSkew);\n      compensateScaleForSkew(target, 'skewX', 'scaleX', 'x', dimBeforeSkewing);\n    }\n    return hasSkewed;\n  }\n\n  /**\n   * Wrapped Action handler for skewing on the Y axis, takes care of the\n   * skew direction and determine the correct transform origin for the anchor point\n   * @param {Event} eventData javascript event that is doing the transform\n   * @param {Object} transform javascript object containing a series of information around the current transform\n   * @param {number} x current mouse x position, canvas normalized\n   * @param {number} y current mouse y position, canvas normalized\n   * @return {Boolean} true if some change happened\n   */\n  function skewHandlerX(eventData, transform, x, y) {\n    // step1 figure out and change transform origin.\n    // if skewX > 0 and originY bottom we anchor on right\n    // if skewX > 0 and originY top we anchor on left\n    // if skewX < 0 and originY bottom we anchor on left\n    // if skewX < 0 and originY top we anchor on right\n    // if skewX is 0, we look for mouse position to understand where are we going.\n    var target = transform.target, currentSkew = target.skewX, originX, originY = transform.originY;\n    if (target.lockSkewingX) {\n      return false;\n    }\n    if (currentSkew === 0) {\n      var localPointFromCenter = getLocalPoint(transform, CENTER, CENTER, x, y);\n      if (localPointFromCenter.x > 0) {\n        // we are pulling right, anchor left;\n        originX = LEFT;\n      }\n      else {\n        // we are pulling right, anchor right\n        originX = RIGHT;\n      }\n    }\n    else {\n      if (currentSkew > 0) {\n        originX = originY === TOP ? LEFT : RIGHT;\n      }\n      if (currentSkew < 0) {\n        originX = originY === TOP ? RIGHT : LEFT;\n      }\n      // is the object flipped on one side only? swap the origin.\n      if (targetHasOneFlip(target)) {\n        originX = originX === LEFT ? RIGHT : LEFT;\n      }\n    }\n\n    // once we have the origin, we find the anchor point\n    transform.originX = originX;\n    var finalHandler = wrapWithFireEvent('skewing', wrapWithFixedAnchor(skewObjectX));\n    return finalHandler(eventData, transform, x, y);\n  }\n\n  /**\n   * Wrapped Action handler for skewing on the Y axis, takes care of the\n   * skew direction and determine the correct transform origin for the anchor point\n   * @param {Event} eventData javascript event that is doing the transform\n   * @param {Object} transform javascript object containing a series of information around the current transform\n   * @param {number} x current mouse x position, canvas normalized\n   * @param {number} y current mouse y position, canvas normalized\n   * @return {Boolean} true if some change happened\n   */\n  function skewHandlerY(eventData, transform, x, y) {\n    // step1 figure out and change transform origin.\n    // if skewY > 0 and originX left we anchor on top\n    // if skewY > 0 and originX right we anchor on bottom\n    // if skewY < 0 and originX left we anchor on bottom\n    // if skewY < 0 and originX right we anchor on top\n    // if skewY is 0, we look for mouse position to understand where are we going.\n    var target = transform.target, currentSkew = target.skewY, originY, originX = transform.originX;\n    if (target.lockSkewingY) {\n      return false;\n    }\n    if (currentSkew === 0) {\n      var localPointFromCenter = getLocalPoint(transform, CENTER, CENTER, x, y);\n      if (localPointFromCenter.y > 0) {\n        // we are pulling down, anchor up;\n        originY = TOP;\n      }\n      else {\n        // we are pulling up, anchor down\n        originY = BOTTOM;\n      }\n    }\n    else {\n      if (currentSkew > 0) {\n        originY = originX === LEFT ? TOP : BOTTOM;\n      }\n      if (currentSkew < 0) {\n        originY = originX === LEFT ? BOTTOM : TOP;\n      }\n      // is the object flipped on one side only? swap the origin.\n      if (targetHasOneFlip(target)) {\n        originY = originY === TOP ? BOTTOM : TOP;\n      }\n    }\n\n    // once we have the origin, we find the anchor point\n    transform.originY = originY;\n    var finalHandler = wrapWithFireEvent('skewing', wrapWithFixedAnchor(skewObjectY));\n    return finalHandler(eventData, transform, x, y);\n  }\n\n  /**\n   * Action handler for rotation and snapping, without anchor point.\n   * Needs to be wrapped with `wrapWithFixedAnchor` to be effective\n   * @param {Event} eventData javascript event that is doing the transform\n   * @param {Object} transform javascript object containing a series of information around the current transform\n   * @param {number} x current mouse x position, canvas normalized\n   * @param {number} y current mouse y position, canvas normalized\n   * @return {Boolean} true if some change happened\n   * @private\n   */\n  function rotationWithSnapping(eventData, transform, x, y) {\n    var t = transform,\n        target = t.target,\n        pivotPoint = target.translateToOriginPoint(target.getCenterPoint(), t.originX, t.originY);\n\n    if (target.lockRotation) {\n      return false;\n    }\n\n    var lastAngle = Math.atan2(t.ey - pivotPoint.y, t.ex - pivotPoint.x),\n        curAngle = Math.atan2(y - pivotPoint.y, x - pivotPoint.x),\n        angle = radiansToDegrees(curAngle - lastAngle + t.theta),\n        hasRotated = true;\n\n    if (target.snapAngle > 0) {\n      var snapAngle  = target.snapAngle,\n          snapThreshold  = target.snapThreshold || snapAngle,\n          rightAngleLocked = Math.ceil(angle / snapAngle) * snapAngle,\n          leftAngleLocked = Math.floor(angle / snapAngle) * snapAngle;\n\n      if (Math.abs(angle - leftAngleLocked) < snapThreshold) {\n        angle = leftAngleLocked;\n      }\n      else if (Math.abs(angle - rightAngleLocked) < snapThreshold) {\n        angle = rightAngleLocked;\n      }\n    }\n\n    // normalize angle to positive value\n    if (angle < 0) {\n      angle = 360 + angle;\n    }\n    angle %= 360;\n\n    hasRotated = target.angle !== angle;\n    target.angle = angle;\n    return hasRotated;\n  }\n\n  /**\n   * Basic scaling logic, reused with different constrain for scaling X,Y, freely or equally.\n   * Needs to be wrapped with `wrapWithFixedAnchor` to be effective\n   * @param {Event} eventData javascript event that is doing the transform\n   * @param {Object} transform javascript object containing a series of information around the current transform\n   * @param {number} x current mouse x position, canvas normalized\n   * @param {number} y current mouse y position, canvas normalized\n   * @param {Object} options additional information for scaling\n   * @param {String} options.by 'x', 'y', 'equally' or '' to indicate type of scaling\n   * @return {Boolean} true if some change happened\n   * @private\n   */\n  function scaleObject(eventData, transform, x, y, options) {\n    options = options || {};\n    var target = transform.target,\n        lockScalingX = target.lockScalingX, lockScalingY = target.lockScalingY,\n        by = options.by, newPoint, scaleX, scaleY, dim,\n        scaleProportionally = scaleIsProportional(eventData, target),\n        forbidScaling = scalingIsForbidden(target, by, scaleProportionally),\n        signX, signY, gestureScale = transform.gestureScale;\n\n    if (forbidScaling) {\n      return false;\n    }\n    if (gestureScale) {\n      scaleX = transform.scaleX * gestureScale;\n      scaleY = transform.scaleY * gestureScale;\n    }\n    else {\n      newPoint = getLocalPoint(transform, transform.originX, transform.originY, x, y);\n      // use of sign: We use sign to detect change of direction of an action. sign usually change when\n      // we cross the origin point with the mouse. So a scale flip for example. There is an issue when scaling\n      // by center and scaling using one middle control ( default: mr, mt, ml, mb), the mouse movement can easily\n      // cross many time the origin point and flip the object. so we need a way to filter out the noise.\n      // This ternary here should be ok to filter out X scaling when we want Y only and vice versa.\n      signX = by !== 'y' ? sign(newPoint.x) : 1;\n      signY = by !== 'x' ? sign(newPoint.y) : 1;\n      if (!transform.signX) {\n        transform.signX = signX;\n      }\n      if (!transform.signY) {\n        transform.signY = signY;\n      }\n\n      if (target.lockScalingFlip &&\n        (transform.signX !== signX || transform.signY !== signY)\n      ) {\n        return false;\n      }\n\n      dim = target._getTransformedDimensions();\n      // missing detection of flip and logic to switch the origin\n      if (scaleProportionally && !by) {\n        // uniform scaling\n        var distance = Math.abs(newPoint.x) + Math.abs(newPoint.y),\n            original = transform.original,\n            originalDistance = Math.abs(dim.x * original.scaleX / target.scaleX) +\n              Math.abs(dim.y * original.scaleY / target.scaleY),\n            scale = distance / originalDistance;\n        scaleX = original.scaleX * scale;\n        scaleY = original.scaleY * scale;\n      }\n      else {\n        scaleX = Math.abs(newPoint.x * target.scaleX / dim.x);\n        scaleY = Math.abs(newPoint.y * target.scaleY / dim.y);\n      }\n      // if we are scaling by center, we need to double the scale\n      if (isTransformCentered(transform)) {\n        scaleX *= 2;\n        scaleY *= 2;\n      }\n      if (transform.signX !== signX && by !== 'y') {\n        transform.originX = opposite[transform.originX];\n        scaleX *= -1;\n        transform.signX = signX;\n      }\n      if (transform.signY !== signY && by !== 'x') {\n        transform.originY = opposite[transform.originY];\n        scaleY *= -1;\n        transform.signY = signY;\n      }\n    }\n    // minScale is taken are in the setter.\n    var oldScaleX = target.scaleX, oldScaleY = target.scaleY;\n    if (!by) {\n      !lockScalingX && target.set('scaleX', scaleX);\n      !lockScalingY && target.set('scaleY', scaleY);\n    }\n    else {\n      // forbidden cases already handled on top here.\n      by === 'x' && target.set('scaleX', scaleX);\n      by === 'y' && target.set('scaleY', scaleY);\n    }\n    return oldScaleX !== target.scaleX || oldScaleY !== target.scaleY;\n  }\n\n  /**\n   * Generic scaling logic, to scale from corners either equally or freely.\n   * Needs to be wrapped with `wrapWithFixedAnchor` to be effective\n   * @param {Event} eventData javascript event that is doing the transform\n   * @param {Object} transform javascript object containing a series of information around the current transform\n   * @param {number} x current mouse x position, canvas normalized\n   * @param {number} y current mouse y position, canvas normalized\n   * @return {Boolean} true if some change happened\n   */\n  function scaleObjectFromCorner(eventData, transform, x, y) {\n    return scaleObject(eventData, transform, x, y);\n  }\n\n  /**\n   * Scaling logic for the X axis.\n   * Needs to be wrapped with `wrapWithFixedAnchor` to be effective\n   * @param {Event} eventData javascript event that is doing the transform\n   * @param {Object} transform javascript object containing a series of information around the current transform\n   * @param {number} x current mouse x position, canvas normalized\n   * @param {number} y current mouse y position, canvas normalized\n   * @return {Boolean} true if some change happened\n   */\n  function scaleObjectX(eventData, transform, x, y) {\n    return scaleObject(eventData, transform, x, y , { by: 'x' });\n  }\n\n  /**\n   * Scaling logic for the Y axis.\n   * Needs to be wrapped with `wrapWithFixedAnchor` to be effective\n   * @param {Event} eventData javascript event that is doing the transform\n   * @param {Object} transform javascript object containing a series of information around the current transform\n   * @param {number} x current mouse x position, canvas normalized\n   * @param {number} y current mouse y position, canvas normalized\n   * @return {Boolean} true if some change happened\n   */\n  function scaleObjectY(eventData, transform, x, y) {\n    return scaleObject(eventData, transform, x, y , { by: 'y' });\n  }\n\n  /**\n   * Composed action handler to either scale Y or skew X\n   * Needs to be wrapped with `wrapWithFixedAnchor` to be effective\n   * @param {Event} eventData javascript event that is doing the transform\n   * @param {Object} transform javascript object containing a series of information around the current transform\n   * @param {number} x current mouse x position, canvas normalized\n   * @param {number} y current mouse y position, canvas normalized\n   * @return {Boolean} true if some change happened\n   */\n  function scalingYOrSkewingX(eventData, transform, x, y) {\n    // ok some safety needed here.\n    if (eventData[transform.target.canvas.altActionKey]) {\n      return controls.skewHandlerX(eventData, transform, x, y);\n    }\n    return controls.scalingY(eventData, transform, x, y);\n  }\n\n  /**\n   * Composed action handler to either scale X or skew Y\n   * Needs to be wrapped with `wrapWithFixedAnchor` to be effective\n   * @param {Event} eventData javascript event that is doing the transform\n   * @param {Object} transform javascript object containing a series of information around the current transform\n   * @param {number} x current mouse x position, canvas normalized\n   * @param {number} y current mouse y position, canvas normalized\n   * @return {Boolean} true if some change happened\n   */\n  function scalingXOrSkewingY(eventData, transform, x, y) {\n    // ok some safety needed here.\n    if (eventData[transform.target.canvas.altActionKey]) {\n      return controls.skewHandlerY(eventData, transform, x, y);\n    }\n    return controls.scalingX(eventData, transform, x, y);\n  }\n\n  /**\n   * Action handler to change textbox width\n   * Needs to be wrapped with `wrapWithFixedAnchor` to be effective\n   * @param {Event} eventData javascript event that is doing the transform\n   * @param {Object} transform javascript object containing a series of information around the current transform\n   * @param {number} x current mouse x position, canvas normalized\n   * @param {number} y current mouse y position, canvas normalized\n   * @return {Boolean} true if some change happened\n   */\n  function changeWidth(eventData, transform, x, y) {\n    var target = transform.target, localPoint = getLocalPoint(transform, transform.originX, transform.originY, x, y),\n        strokePadding = target.strokeWidth / (target.strokeUniform ? target.scaleX : 1),\n        multiplier = isTransformCentered(transform) ? 2 : 1,\n        oldWidth = target.width,\n        newWidth = Math.abs(localPoint.x * multiplier / target.scaleX) - strokePadding;\n    target.set('width', Math.max(newWidth, 0));\n    return oldWidth !== newWidth;\n  }\n\n  /**\n   * Action handler\n   * @private\n   * @param {Event} eventData javascript event that is doing the transform\n   * @param {Object} transform javascript object containing a series of information around the current transform\n   * @param {number} x current mouse x position, canvas normalized\n   * @param {number} y current mouse y position, canvas normalized\n   * @return {Boolean} true if the translation occurred\n   */\n  function dragHandler(eventData, transform, x, y) {\n    var target = transform.target,\n        newLeft = x - transform.offsetX,\n        newTop = y - transform.offsetY,\n        moveX = !target.get('lockMovementX') && target.left !== newLeft,\n        moveY = !target.get('lockMovementY') && target.top !== newTop;\n    moveX && target.set('left', newLeft);\n    moveY && target.set('top', newTop);\n    if (moveX || moveY) {\n      fireEvent('moving', commonEventInfo(eventData, transform, x, y));\n    }\n    return moveX || moveY;\n  }\n\n  controls.scaleCursorStyleHandler = scaleCursorStyleHandler;\n  controls.skewCursorStyleHandler = skewCursorStyleHandler;\n  controls.scaleSkewCursorStyleHandler = scaleSkewCursorStyleHandler;\n  controls.rotationWithSnapping = wrapWithFireEvent('rotating', wrapWithFixedAnchor(rotationWithSnapping));\n  controls.scalingEqually = wrapWithFireEvent('scaling', wrapWithFixedAnchor( scaleObjectFromCorner));\n  controls.scalingX = wrapWithFireEvent('scaling', wrapWithFixedAnchor(scaleObjectX));\n  controls.scalingY = wrapWithFireEvent('scaling', wrapWithFixedAnchor(scaleObjectY));\n  controls.scalingYOrSkewingX = scalingYOrSkewingX;\n  controls.scalingXOrSkewingY = scalingXOrSkewingY;\n  controls.changeWidth = wrapWithFireEvent('resizing', wrapWithFixedAnchor(changeWidth));\n  controls.skewHandlerX = skewHandlerX;\n  controls.skewHandlerY = skewHandlerY;\n  controls.dragHandler = dragHandler;\n  controls.scaleOrSkewActionName = scaleOrSkewActionName;\n  controls.rotationStyleHandler = rotationStyleHandler;\n  controls.fireEvent = fireEvent;\n  controls.wrapWithFixedAnchor = wrapWithFixedAnchor;\n  controls.wrapWithFireEvent = wrapWithFireEvent;\n  controls.getLocalPoint = getLocalPoint;\n  fabric.controlsUtils = controls;\n\n})(typeof exports !== 'undefined' ? exports : this);\n\n\n(function(global) {\n\n  'use strict';\n\n  var fabric = global.fabric || (global.fabric = { }),\n      degreesToRadians = fabric.util.degreesToRadians,\n      controls = fabric.controlsUtils;\n\n  /**\n   * Render a round control, as per fabric features.\n   * This function is written to respect object properties like transparentCorners, cornerSize\n   * cornerColor, cornerStrokeColor\n   * plus the addition of offsetY and offsetX.\n   * @param {CanvasRenderingContext2D} ctx context to render on\n   * @param {Number} left x coordinate where the control center should be\n   * @param {Number} top y coordinate where the control center should be\n   * @param {Object} styleOverride override for fabric.Object controls style\n   * @param {fabric.Object} fabricObject the fabric object for which we are rendering controls\n   */\n  function renderCircleControl (ctx, left, top, styleOverride, fabricObject) {\n    styleOverride = styleOverride || {};\n    var xSize = this.sizeX || styleOverride.cornerSize || fabricObject.cornerSize,\n        ySize = this.sizeY || styleOverride.cornerSize || fabricObject.cornerSize,\n        transparentCorners = typeof styleOverride.transparentCorners !== 'undefined' ?\n          styleOverride.transparentCorners : fabricObject.transparentCorners,\n        methodName = transparentCorners ? 'stroke' : 'fill',\n        stroke = !transparentCorners && (styleOverride.cornerStrokeColor || fabricObject.cornerStrokeColor),\n        myLeft = left,\n        myTop = top, size;\n    ctx.save();\n    ctx.fillStyle = styleOverride.cornerColor || fabricObject.cornerColor;\n    ctx.strokeStyle = styleOverride.cornerStrokeColor || fabricObject.cornerStrokeColor;\n    // as soon as fabric react v5, remove ie11, use proper ellipse code.\n    if (xSize > ySize) {\n      size = xSize;\n      ctx.scale(1.0, ySize / xSize);\n      myTop = top * xSize / ySize;\n    }\n    else if (ySize > xSize) {\n      size = ySize;\n      ctx.scale(xSize / ySize, 1.0);\n      myLeft = left * ySize / xSize;\n    }\n    else {\n      size = xSize;\n    }\n    // this is still wrong\n    ctx.lineWidth = 1;\n    ctx.beginPath();\n    ctx.arc(myLeft, myTop, size / 2, 0, 2 * Math.PI, false);\n    ctx[methodName]();\n    if (stroke) {\n      ctx.stroke();\n    }\n    ctx.restore();\n  }\n\n  /**\n   * Render a square control, as per fabric features.\n   * This function is written to respect object properties like transparentCorners, cornerSize\n   * cornerColor, cornerStrokeColor\n   * plus the addition of offsetY and offsetX.\n   * @param {CanvasRenderingContext2D} ctx context to render on\n   * @param {Number} left x coordinate where the control center should be\n   * @param {Number} top y coordinate where the control center should be\n   * @param {Object} styleOverride override for fabric.Object controls style\n   * @param {fabric.Object} fabricObject the fabric object for which we are rendering controls\n   */\n  function renderSquareControl(ctx, left, top, styleOverride, fabricObject) {\n    styleOverride = styleOverride || {};\n    var xSize = this.sizeX || styleOverride.cornerSize || fabricObject.cornerSize,\n        ySize = this.sizeY || styleOverride.cornerSize || fabricObject.cornerSize,\n        transparentCorners = typeof styleOverride.transparentCorners !== 'undefined' ?\n          styleOverride.transparentCorners : fabricObject.transparentCorners,\n        methodName = transparentCorners ? 'stroke' : 'fill',\n        stroke = !transparentCorners && (\n          styleOverride.cornerStrokeColor || fabricObject.cornerStrokeColor\n        ), xSizeBy2 = xSize / 2, ySizeBy2 = ySize / 2;\n    ctx.save();\n    ctx.fillStyle = styleOverride.cornerColor || fabricObject.cornerColor;\n    ctx.strokeStyle = styleOverride.cornerStrokeColor || fabricObject.cornerStrokeColor;\n    // this is still wrong\n    ctx.lineWidth = 1;\n    ctx.translate(left, top);\n    ctx.rotate(degreesToRadians(fabricObject.angle));\n    // this does not work, and fixed with ( && ) does not make sense.\n    // to have real transparent corners we need the controls on upperCanvas\n    // transparentCorners || ctx.clearRect(-xSizeBy2, -ySizeBy2, xSize, ySize);\n    ctx[methodName + 'Rect'](-xSizeBy2, -ySizeBy2, xSize, ySize);\n    if (stroke) {\n      ctx.strokeRect(-xSizeBy2, -ySizeBy2, xSize, ySize);\n    }\n    ctx.restore();\n  }\n\n  controls.renderCircleControl = renderCircleControl;\n  controls.renderSquareControl = renderSquareControl;\n\n})(typeof exports !== 'undefined' ? exports : this);\n\n\n(function(global) {\n\n  'use strict';\n\n  var fabric = global.fabric || (global.fabric = { });\n\n  function Control(options) {\n    for (var i in options) {\n      this[i] = options[i];\n    }\n  }\n\n  fabric.Control = Control;\n\n  fabric.Control.prototype = /** @lends fabric.Control.prototype */ {\n\n    /**\n     * keep track of control visibility.\n     * mainly for backward compatibility.\n     * if you do not want to see a control, you can remove it\n     * from the controlset.\n     * @type {Boolean}\n     * @default true\n     */\n    visible: true,\n\n    /**\n     * Name of the action that the control will likely execute.\n     * This is optional. FabricJS uses to identify what the user is doing for some\n     * extra optimizations. If you are writing a custom control and you want to know\n     * somewhere else in the code what is going on, you can use this string here.\n     * you can also provide a custom getActionName if your control run multiple actions\n     * depending on some external state.\n     * default to scale since is the most common, used on 4 corners by default\n     * @type {String}\n     * @default 'scale'\n     */\n    actionName: 'scale',\n\n    /**\n     * Drawing angle of the control.\n     * NOT used for now, but name marked as needed for internal logic\n     * example: to reuse the same drawing function for different rotated controls\n     * @type {Number}\n     * @default 0\n     */\n    angle: 0,\n\n    /**\n     * Relative position of the control. X\n     * 0,0 is the center of the Object, while -0.5 (left) or 0.5 (right) are the extremities\n     * of the bounding box.\n     * @type {Number}\n     * @default 0\n     */\n    x: 0,\n\n    /**\n     * Relative position of the control. Y\n     * 0,0 is the center of the Object, while -0.5 (top) or 0.5 (bottom) are the extremities\n     * of the bounding box.\n     * @type {Number}\n     * @default 0\n     */\n    y: 0,\n\n    /**\n     * Horizontal offset of the control from the defined position. In pixels\n     * Positive offset moves the control to the right, negative to the left.\n     * It used when you want to have position of control that does not scale with\n     * the bounding box. Example: rotation control is placed at x:0, y: 0.5 on\n     * the boundindbox, with an offset of 30 pixels vertically. Those 30 pixels will\n     * stay 30 pixels no matter how the object is big. Another example is having 2\n     * controls in the corner, that stay in the same position when the object scale.\n     * of the bounding box.\n     * @type {Number}\n     * @default 0\n     */\n    offsetX: 0,\n\n    /**\n     * Vertical offset of the control from the defined position. In pixels\n     * Positive offset moves the control to the bottom, negative to the top.\n     * @type {Number}\n     * @default 0\n     */\n    offsetY: 0,\n\n    /**\n     * Sets the length of the control. If null, defaults to object's cornerSize.\n     * Expects both sizeX and sizeY to be set when set.\n     * @type {?Number}\n     * @default null\n     */\n    sizeX: null,\n\n    /**\n     * Sets the height of the control. If null, defaults to object's cornerSize.\n     * Expects both sizeX and sizeY to be set when set.\n     * @type {?Number}\n     * @default null\n     */\n    sizeY: null,\n\n    /**\n     * Sets the length of the touch area of the control. If null, defaults to object's touchCornerSize.\n     * Expects both touchSizeX and touchSizeY to be set when set.\n     * @type {?Number}\n     * @default null\n     */\n    touchSizeX: null,\n\n    /**\n     * Sets the height of the touch area of the control. If null, defaults to object's touchCornerSize.\n     * Expects both touchSizeX and touchSizeY to be set when set.\n     * @type {?Number}\n     * @default null\n     */\n    touchSizeY: null,\n\n    /**\n     * Css cursor style to display when the control is hovered.\n     * if the method `cursorStyleHandler` is provided, this property is ignored.\n     * @type {String}\n     * @default 'crosshair'\n     */\n    cursorStyle: 'crosshair',\n\n    /**\n     * If controls has an offsetY or offsetX, draw a line that connects\n     * the control to the bounding box\n     * @type {Boolean}\n     * @default false\n     */\n    withConnection: false,\n\n    /**\n     * The control actionHandler, provide one to handle action ( control being moved )\n     * @param {Event} eventData the native mouse event\n     * @param {Object} transformData properties of the current transform\n     * @param {Number} x x position of the cursor\n     * @param {Number} y y position of the cursor\n     * @return {Boolean} true if the action/event modified the object\n     */\n    actionHandler: function(/* eventData, transformData, x, y */) { },\n\n    /**\n     * The control handler for mouse down, provide one to handle mouse down on control\n     * @param {Event} eventData the native mouse event\n     * @param {Object} transformData properties of the current transform\n     * @param {Number} x x position of the cursor\n     * @param {Number} y y position of the cursor\n     * @return {Boolean} true if the action/event modified the object\n     */\n    mouseDownHandler: function(/* eventData, transformData, x, y */) { },\n\n    /**\n     * The control mouseUpHandler, provide one to handle an effect on mouse up.\n     * @param {Event} eventData the native mouse event\n     * @param {Object} transformData properties of the current transform\n     * @param {Number} x x position of the cursor\n     * @param {Number} y y position of the cursor\n     * @return {Boolean} true if the action/event modified the object\n     */\n    mouseUpHandler: function(/* eventData, transformData, x, y */) { },\n\n    /**\n     * Returns control actionHandler\n     * @param {Event} eventData the native mouse event\n     * @param {fabric.Object} fabricObject on which the control is displayed\n     * @param {fabric.Control} control control for which the action handler is being asked\n     * @return {Function} the action handler\n     */\n    getActionHandler: function(/* eventData, fabricObject, control */) {\n      return this.actionHandler;\n    },\n\n    /**\n     * Returns control mouseDown handler\n     * @param {Event} eventData the native mouse event\n     * @param {fabric.Object} fabricObject on which the control is displayed\n     * @param {fabric.Control} control control for which the action handler is being asked\n     * @return {Function} the action handler\n     */\n    getMouseDownHandler: function(/* eventData, fabricObject, control */) {\n      return this.mouseDownHandler;\n    },\n\n    /**\n     * Returns control mouseUp handler\n     * @param {Event} eventData the native mouse event\n     * @param {fabric.Object} fabricObject on which the control is displayed\n     * @param {fabric.Control} control control for which the action handler is being asked\n     * @return {Function} the action handler\n     */\n    getMouseUpHandler: function(/* eventData, fabricObject, control */) {\n      return this.mouseUpHandler;\n    },\n\n    /**\n     * Returns control cursorStyle for css using cursorStyle. If you need a more elaborate\n     * function you can pass one in the constructor\n     * the cursorStyle property\n     * @param {Event} eventData the native mouse event\n     * @param {fabric.Control} control the current control ( likely this)\n     * @param {fabric.Object} object on which the control is displayed\n     * @return {String}\n     */\n    cursorStyleHandler: function(eventData, control /* fabricObject */) {\n      return control.cursorStyle;\n    },\n\n    /**\n     * Returns the action name. The basic implementation just return the actionName property.\n     * @param {Event} eventData the native mouse event\n     * @param {fabric.Control} control the current control ( likely this)\n     * @param {fabric.Object} object on which the control is displayed\n     * @return {String}\n     */\n    getActionName: function(eventData, control /* fabricObject */) {\n      return control.actionName;\n    },\n\n    /**\n     * Returns controls visibility\n     * @param {fabric.Object} object on which the control is displayed\n     * @param {String} controlKey key where the control is memorized on the\n     * @return {Boolean}\n     */\n    getVisibility: function(fabricObject, controlKey) {\n      var objectVisibility = fabricObject._controlsVisibility;\n      if (objectVisibility && typeof objectVisibility[controlKey] !== 'undefined') {\n        return objectVisibility[controlKey];\n      }\n      return this.visible;\n    },\n\n    /**\n     * Sets controls visibility\n     * @param {Boolean} visibility for the object\n     * @return {Void}\n     */\n    setVisibility: function(visibility /* name, fabricObject */) {\n      this.visible = visibility;\n    },\n\n\n    positionHandler: function(dim, finalMatrix /*, fabricObject, currentControl */) {\n      var point = fabric.util.transformPoint({\n        x: this.x * dim.x + this.offsetX,\n        y: this.y * dim.y + this.offsetY }, finalMatrix);\n      return point;\n    },\n\n    /**\n     * Returns the coords for this control based on object values.\n     * @param {Number} objectAngle angle from the fabric object holding the control\n     * @param {Number} objectCornerSize cornerSize from the fabric object holding the control (or touchCornerSize if\n     *   isTouch is true)\n     * @param {Number} centerX x coordinate where the control center should be\n     * @param {Number} centerY y coordinate where the control center should be\n     * @param {boolean} isTouch true if touch corner, false if normal corner\n     */\n    calcCornerCoords: function(objectAngle, objectCornerSize, centerX, centerY, isTouch) {\n      var cosHalfOffset,\n          sinHalfOffset,\n          cosHalfOffsetComp,\n          sinHalfOffsetComp,\n          xSize = (isTouch) ? this.touchSizeX : this.sizeX,\n          ySize = (isTouch) ? this.touchSizeY : this.sizeY;\n      if (xSize && ySize && xSize !== ySize) {\n        // handle rectangular corners\n        var controlTriangleAngle = Math.atan2(ySize, xSize);\n        var cornerHypotenuse = Math.sqrt(xSize * xSize + ySize * ySize) / 2;\n        var newTheta = controlTriangleAngle - fabric.util.degreesToRadians(objectAngle);\n        var newThetaComp = Math.PI / 2 - controlTriangleAngle - fabric.util.degreesToRadians(objectAngle);\n        cosHalfOffset = cornerHypotenuse * fabric.util.cos(newTheta);\n        sinHalfOffset = cornerHypotenuse * fabric.util.sin(newTheta);\n        // use complementary angle for two corners\n        cosHalfOffsetComp = cornerHypotenuse * fabric.util.cos(newThetaComp);\n        sinHalfOffsetComp = cornerHypotenuse * fabric.util.sin(newThetaComp);\n      }\n      else {\n        // handle square corners\n        // use default object corner size unless size is defined\n        var cornerSize = (xSize && ySize) ? xSize : objectCornerSize;\n        /* 0.7071067812 stands for sqrt(2)/2 */\n        cornerHypotenuse = cornerSize * 0.7071067812;\n        // complementary angles are equal since they're both 45 degrees\n        var newTheta = fabric.util.degreesToRadians(45 - objectAngle);\n        cosHalfOffset = cosHalfOffsetComp = cornerHypotenuse * fabric.util.cos(newTheta);\n        sinHalfOffset = sinHalfOffsetComp = cornerHypotenuse * fabric.util.sin(newTheta);\n      }\n\n      return {\n        tl: {\n          x: centerX - sinHalfOffsetComp,\n          y: centerY - cosHalfOffsetComp,\n        },\n        tr: {\n          x: centerX + cosHalfOffset,\n          y: centerY - sinHalfOffset,\n        },\n        bl: {\n          x: centerX - cosHalfOffset,\n          y: centerY + sinHalfOffset,\n        },\n        br: {\n          x: centerX + sinHalfOffsetComp,\n          y: centerY + cosHalfOffsetComp,\n        },\n      };\n    },\n\n    /**\n    * Render function for the control.\n    * When this function runs the context is unscaled. unrotate. Just retina scaled.\n    * all the functions will have to translate to the point left,top before starting Drawing\n    * if they want to draw a control where the position is detected.\n    * left and top are the result of the positionHandler function\n    * @param {RenderingContext2D} ctx the context where the control will be drawn\n    * @param {Number} left position of the canvas where we are about to render the control.\n    * @param {Number} top position of the canvas where we are about to render the control.\n    * @param {Object} styleOverride\n    * @param {fabric.Object} fabricObject the object where the control is about to be rendered\n    */\n    render: function(ctx, left, top, styleOverride, fabricObject) {\n      styleOverride = styleOverride || {};\n      switch (styleOverride.cornerStyle || fabricObject.cornerStyle) {\n        case 'circle':\n          fabric.controlsUtils.renderCircleControl.call(this, ctx, left, top, styleOverride, fabricObject);\n          break;\n        default:\n          fabric.controlsUtils.renderSquareControl.call(this, ctx, left, top, styleOverride, fabricObject);\n      }\n    },\n  };\n\n})(typeof exports !== 'undefined' ? exports : this);\n\n\n(function() {\n\n  /* _FROM_SVG_START_ */\n  function getColorStop(el, multiplier) {\n    var style = el.getAttribute('style'),\n        offset = el.getAttribute('offset') || 0,\n        color, colorAlpha, opacity, i;\n\n    // convert percents to absolute values\n    offset = parseFloat(offset) / (/%$/.test(offset) ? 100 : 1);\n    offset = offset < 0 ? 0 : offset > 1 ? 1 : offset;\n    if (style) {\n      var keyValuePairs = style.split(/\\s*;\\s*/);\n\n      if (keyValuePairs[keyValuePairs.length - 1] === '') {\n        keyValuePairs.pop();\n      }\n\n      for (i = keyValuePairs.length; i--; ) {\n\n        var split = keyValuePairs[i].split(/\\s*:\\s*/),\n            key = split[0].trim(),\n            value = split[1].trim();\n\n        if (key === 'stop-color') {\n          color = value;\n        }\n        else if (key === 'stop-opacity') {\n          opacity = value;\n        }\n      }\n    }\n\n    if (!color) {\n      color = el.getAttribute('stop-color') || 'rgb(0,0,0)';\n    }\n    if (!opacity) {\n      opacity = el.getAttribute('stop-opacity');\n    }\n\n    color = new fabric.Color(color);\n    colorAlpha = color.getAlpha();\n    opacity = isNaN(parseFloat(opacity)) ? 1 : parseFloat(opacity);\n    opacity *= colorAlpha * multiplier;\n\n    return {\n      offset: offset,\n      color: color.toRgb(),\n      opacity: opacity\n    };\n  }\n\n  function getLinearCoords(el) {\n    return {\n      x1: el.getAttribute('x1') || 0,\n      y1: el.getAttribute('y1') || 0,\n      x2: el.getAttribute('x2') || '100%',\n      y2: el.getAttribute('y2') || 0\n    };\n  }\n\n  function getRadialCoords(el) {\n    return {\n      x1: el.getAttribute('fx') || el.getAttribute('cx') || '50%',\n      y1: el.getAttribute('fy') || el.getAttribute('cy') || '50%',\n      r1: 0,\n      x2: el.getAttribute('cx') || '50%',\n      y2: el.getAttribute('cy') || '50%',\n      r2: el.getAttribute('r') || '50%'\n    };\n  }\n  /* _FROM_SVG_END_ */\n\n  var clone = fabric.util.object.clone;\n\n  /**\n   * Gradient class\n   * @class fabric.Gradient\n   * @tutorial {@link http://fabricjs.com/fabric-intro-part-2#gradients}\n   * @see {@link fabric.Gradient#initialize} for constructor definition\n   */\n  fabric.Gradient = fabric.util.createClass(/** @lends fabric.Gradient.prototype */ {\n\n    /**\n     * Horizontal offset for aligning gradients coming from SVG when outside pathgroups\n     * @type Number\n     * @default 0\n     */\n    offsetX: 0,\n\n    /**\n     * Vertical offset for aligning gradients coming from SVG when outside pathgroups\n     * @type Number\n     * @default 0\n     */\n    offsetY: 0,\n\n    /**\n     * A transform matrix to apply to the gradient before painting.\n     * Imported from svg gradients, is not applied with the current transform in the center.\n     * Before this transform is applied, the origin point is at the top left corner of the object\n     * plus the addition of offsetY and offsetX.\n     * @type Number[]\n     * @default null\n     */\n    gradientTransform: null,\n\n    /**\n     * coordinates units for coords.\n     * If `pixels`, the number of coords are in the same unit of width / height.\n     * If set as `percentage` the coords are still a number, but 1 means 100% of width\n     * for the X and 100% of the height for the y. It can be bigger than 1 and negative.\n     * allowed values pixels or percentage.\n     * @type String\n     * @default 'pixels'\n     */\n    gradientUnits: 'pixels',\n\n    /**\n     * Gradient type linear or radial\n     * @type String\n     * @default 'pixels'\n     */\n    type: 'linear',\n\n    /**\n     * Constructor\n     * @param {Object} options Options object with type, coords, gradientUnits and colorStops\n     * @param {Object} [options.type] gradient type linear or radial\n     * @param {Object} [options.gradientUnits] gradient units\n     * @param {Object} [options.offsetX] SVG import compatibility\n     * @param {Object} [options.offsetY] SVG import compatibility\n     * @param {Object[]} options.colorStops contains the colorstops.\n     * @param {Object} options.coords contains the coords of the gradient\n     * @param {Number} [options.coords.x1] X coordiante of the first point for linear or of the focal point for radial\n     * @param {Number} [options.coords.y1] Y coordiante of the first point for linear or of the focal point for radial\n     * @param {Number} [options.coords.x2] X coordiante of the second point for linear or of the center point for radial\n     * @param {Number} [options.coords.y2] Y coordiante of the second point for linear or of the center point for radial\n     * @param {Number} [options.coords.r1] only for radial gradient, radius of the inner circle\n     * @param {Number} [options.coords.r2] only for radial gradient, radius of the external circle\n     * @return {fabric.Gradient} thisArg\n     */\n    initialize: function(options) {\n      options || (options = { });\n      options.coords || (options.coords = { });\n\n      var coords, _this = this;\n\n      // sets everything, then coords and colorstops get sets again\n      Object.keys(options).forEach(function(option) {\n        _this[option] = options[option];\n      });\n\n      if (this.id) {\n        this.id += '_' + fabric.Object.__uid++;\n      }\n      else {\n        this.id = fabric.Object.__uid++;\n      }\n\n      coords = {\n        x1: options.coords.x1 || 0,\n        y1: options.coords.y1 || 0,\n        x2: options.coords.x2 || 0,\n        y2: options.coords.y2 || 0\n      };\n\n      if (this.type === 'radial') {\n        coords.r1 = options.coords.r1 || 0;\n        coords.r2 = options.coords.r2 || 0;\n      }\n\n      this.coords = coords;\n      this.colorStops = options.colorStops.slice();\n    },\n\n    /**\n     * Adds another colorStop\n     * @param {Object} colorStop Object with offset and color\n     * @return {fabric.Gradient} thisArg\n     */\n    addColorStop: function(colorStops) {\n      for (var position in colorStops) {\n        var color = new fabric.Color(colorStops[position]);\n        this.colorStops.push({\n          offset: parseFloat(position),\n          color: color.toRgb(),\n          opacity: color.getAlpha()\n        });\n      }\n      return this;\n    },\n\n    /**\n     * Returns object representation of a gradient\n     * @param {Array} [propertiesToInclude] Any properties that you might want to additionally include in the output\n     * @return {Object}\n     */\n    toObject: function(propertiesToInclude) {\n      var object = {\n        type: this.type,\n        coords: this.coords,\n        colorStops: this.colorStops,\n        offsetX: this.offsetX,\n        offsetY: this.offsetY,\n        gradientUnits: this.gradientUnits,\n        gradientTransform: this.gradientTransform ? this.gradientTransform.concat() : this.gradientTransform\n      };\n      fabric.util.populateWithProperties(this, object, propertiesToInclude);\n\n      return object;\n    },\n\n    /* _TO_SVG_START_ */\n    /**\n     * Returns SVG representation of an gradient\n     * @param {Object} object Object to create a gradient for\n     * @return {String} SVG representation of an gradient (linear/radial)\n     */\n    toSVG: function(object, options) {\n      var coords = clone(this.coords, true), i, len, options = options || {},\n          markup, commonAttributes, colorStops = clone(this.colorStops, true),\n          needsSwap = coords.r1 > coords.r2,\n          transform = this.gradientTransform ? this.gradientTransform.concat() : fabric.iMatrix.concat(),\n          offsetX = -this.offsetX, offsetY = -this.offsetY,\n          withViewport = !!options.additionalTransform,\n          gradientUnits = this.gradientUnits === 'pixels' ? 'userSpaceOnUse' : 'objectBoundingBox';\n      // colorStops must be sorted ascending\n      colorStops.sort(function(a, b) {\n        return a.offset - b.offset;\n      });\n\n      if (gradientUnits === 'objectBoundingBox') {\n        offsetX /= object.width;\n        offsetY /= object.height;\n      }\n      else {\n        offsetX += object.width / 2;\n        offsetY += object.height / 2;\n      }\n      if (object.type === 'path' && this.gradientUnits !== 'percentage') {\n        offsetX -= object.pathOffset.x;\n        offsetY -= object.pathOffset.y;\n      }\n\n\n      transform[4] -= offsetX;\n      transform[5] -= offsetY;\n\n      commonAttributes = 'id=\"SVGID_' + this.id +\n                     '\" gradientUnits=\"' + gradientUnits + '\"';\n      commonAttributes += ' gradientTransform=\"' + (withViewport ?\n        options.additionalTransform + ' ' : '') + fabric.util.matrixToSVG(transform) + '\" ';\n\n      if (this.type === 'linear') {\n        markup = [\n          '<linearGradient ',\n          commonAttributes,\n          ' x1=\"', coords.x1,\n          '\" y1=\"', coords.y1,\n          '\" x2=\"', coords.x2,\n          '\" y2=\"', coords.y2,\n          '\">\\n'\n        ];\n      }\n      else if (this.type === 'radial') {\n        // svg radial gradient has just 1 radius. the biggest.\n        markup = [\n          '<radialGradient ',\n          commonAttributes,\n          ' cx=\"', needsSwap ? coords.x1 : coords.x2,\n          '\" cy=\"', needsSwap ? coords.y1 : coords.y2,\n          '\" r=\"', needsSwap ? coords.r1 : coords.r2,\n          '\" fx=\"', needsSwap ? coords.x2 : coords.x1,\n          '\" fy=\"', needsSwap ? coords.y2 : coords.y1,\n          '\">\\n'\n        ];\n      }\n\n      if (this.type === 'radial') {\n        if (needsSwap) {\n          // svg goes from internal to external radius. if radius are inverted, swap color stops.\n          colorStops = colorStops.concat();\n          colorStops.reverse();\n          for (i = 0, len = colorStops.length; i < len; i++) {\n            colorStops[i].offset = 1 - colorStops[i].offset;\n          }\n        }\n        var minRadius = Math.min(coords.r1, coords.r2);\n        if (minRadius > 0) {\n          // i have to shift all colorStops and add new one in 0.\n          var maxRadius = Math.max(coords.r1, coords.r2),\n              percentageShift = minRadius / maxRadius;\n          for (i = 0, len = colorStops.length; i < len; i++) {\n            colorStops[i].offset += percentageShift * (1 - colorStops[i].offset);\n          }\n        }\n      }\n\n      for (i = 0, len = colorStops.length; i < len; i++) {\n        var colorStop = colorStops[i];\n        markup.push(\n          '<stop ',\n          'offset=\"', (colorStop.offset * 100) + '%',\n          '\" style=\"stop-color:', colorStop.color,\n          (typeof colorStop.opacity !== 'undefined' ? ';stop-opacity: ' + colorStop.opacity : ';'),\n          '\"/>\\n'\n        );\n      }\n\n      markup.push((this.type === 'linear' ? '</linearGradient>\\n' : '</radialGradient>\\n'));\n\n      return markup.join('');\n    },\n    /* _TO_SVG_END_ */\n\n    /**\n     * Returns an instance of CanvasGradient\n     * @param {CanvasRenderingContext2D} ctx Context to render on\n     * @return {CanvasGradient}\n     */\n    toLive: function(ctx) {\n      var gradient, coords = fabric.util.object.clone(this.coords), i, len;\n\n      if (!this.type) {\n        return;\n      }\n\n      if (this.type === 'linear') {\n        gradient = ctx.createLinearGradient(\n          coords.x1, coords.y1, coords.x2, coords.y2);\n      }\n      else if (this.type === 'radial') {\n        gradient = ctx.createRadialGradient(\n          coords.x1, coords.y1, coords.r1, coords.x2, coords.y2, coords.r2);\n      }\n\n      for (i = 0, len = this.colorStops.length; i < len; i++) {\n        var color = this.colorStops[i].color,\n            opacity = this.colorStops[i].opacity,\n            offset = this.colorStops[i].offset;\n\n        if (typeof opacity !== 'undefined') {\n          color = new fabric.Color(color).setAlpha(opacity).toRgba();\n        }\n        gradient.addColorStop(offset, color);\n      }\n\n      return gradient;\n    }\n  });\n\n  fabric.util.object.extend(fabric.Gradient, {\n\n    /* _FROM_SVG_START_ */\n    /**\n     * Returns {@link fabric.Gradient} instance from an SVG element\n     * @static\n     * @memberOf fabric.Gradient\n     * @param {SVGGradientElement} el SVG gradient element\n     * @param {fabric.Object} instance\n     * @param {String} opacityAttr A fill-opacity or stroke-opacity attribute to multiply to each stop's opacity.\n     * @param {Object} svgOptions an object containing the size of the SVG in order to parse correctly gradients\n     * that uses gradientUnits as 'userSpaceOnUse' and percentages.\n     * @param {Object.number} viewBoxWidth width part of the viewBox attribute on svg\n     * @param {Object.number} viewBoxHeight height part of the viewBox attribute on svg\n     * @param {Object.number} width width part of the svg tag if viewBox is not specified\n     * @param {Object.number} height height part of the svg tag if viewBox is not specified\n     * @return {fabric.Gradient} Gradient instance\n     * @see http://www.w3.org/TR/SVG/pservers.html#LinearGradientElement\n     * @see http://www.w3.org/TR/SVG/pservers.html#RadialGradientElement\n     */\n    fromElement: function(el, instance, opacityAttr, svgOptions) {\n      /**\n       *  @example:\n       *\n       *  <linearGradient id=\"linearGrad1\">\n       *    <stop offset=\"0%\" stop-color=\"white\"/>\n       *    <stop offset=\"100%\" stop-color=\"black\"/>\n       *  </linearGradient>\n       *\n       *  OR\n       *\n       *  <linearGradient id=\"linearGrad2\">\n       *    <stop offset=\"0\" style=\"stop-color:rgb(255,255,255)\"/>\n       *    <stop offset=\"1\" style=\"stop-color:rgb(0,0,0)\"/>\n       *  </linearGradient>\n       *\n       *  OR\n       *\n       *  <radialGradient id=\"radialGrad1\">\n       *    <stop offset=\"0%\" stop-color=\"white\" stop-opacity=\"1\" />\n       *    <stop offset=\"50%\" stop-color=\"black\" stop-opacity=\"0.5\" />\n       *    <stop offset=\"100%\" stop-color=\"white\" stop-opacity=\"1\" />\n       *  </radialGradient>\n       *\n       *  OR\n       *\n       *  <radialGradient id=\"radialGrad2\">\n       *    <stop offset=\"0\" stop-color=\"rgb(255,255,255)\" />\n       *    <stop offset=\"0.5\" stop-color=\"rgb(0,0,0)\" />\n       *    <stop offset=\"1\" stop-color=\"rgb(255,255,255)\" />\n       *  </radialGradient>\n       *\n       */\n\n      var multiplier = parseFloat(opacityAttr) / (/%$/.test(opacityAttr) ? 100 : 1);\n      multiplier = multiplier < 0 ? 0 : multiplier > 1 ? 1 : multiplier;\n      if (isNaN(multiplier)) {\n        multiplier = 1;\n      }\n\n      var colorStopEls = el.getElementsByTagName('stop'),\n          type,\n          gradientUnits = el.getAttribute('gradientUnits') === 'userSpaceOnUse' ?\n            'pixels' : 'percentage',\n          gradientTransform = el.getAttribute('gradientTransform') || '',\n          colorStops = [],\n          coords, i, offsetX = 0, offsetY = 0,\n          transformMatrix;\n      if (el.nodeName === 'linearGradient' || el.nodeName === 'LINEARGRADIENT') {\n        type = 'linear';\n        coords = getLinearCoords(el);\n      }\n      else {\n        type = 'radial';\n        coords = getRadialCoords(el);\n      }\n\n      for (i = colorStopEls.length; i--; ) {\n        colorStops.push(getColorStop(colorStopEls[i], multiplier));\n      }\n\n      transformMatrix = fabric.parseTransformAttribute(gradientTransform);\n\n      __convertPercentUnitsToValues(instance, coords, svgOptions, gradientUnits);\n\n      if (gradientUnits === 'pixels') {\n        offsetX = -instance.left;\n        offsetY = -instance.top;\n      }\n\n      var gradient = new fabric.Gradient({\n        id: el.getAttribute('id'),\n        type: type,\n        coords: coords,\n        colorStops: colorStops,\n        gradientUnits: gradientUnits,\n        gradientTransform: transformMatrix,\n        offsetX: offsetX,\n        offsetY: offsetY,\n      });\n\n      return gradient;\n    }\n    /* _FROM_SVG_END_ */\n  });\n\n  /**\n   * @private\n   */\n  function __convertPercentUnitsToValues(instance, options, svgOptions, gradientUnits) {\n    var propValue, finalValue;\n    Object.keys(options).forEach(function(prop) {\n      propValue = options[prop];\n      if (propValue === 'Infinity') {\n        finalValue = 1;\n      }\n      else if (propValue === '-Infinity') {\n        finalValue = 0;\n      }\n      else {\n        finalValue = parseFloat(options[prop], 10);\n        if (typeof propValue === 'string' && /^(\\d+\\.\\d+)%|(\\d+)%$/.test(propValue)) {\n          finalValue *= 0.01;\n          if (gradientUnits === 'pixels') {\n            // then we need to fix those percentages here in svg parsing\n            if (prop === 'x1' || prop === 'x2' || prop === 'r2') {\n              finalValue *= svgOptions.viewBoxWidth || svgOptions.width;\n            }\n            if (prop === 'y1' || prop === 'y2') {\n              finalValue *= svgOptions.viewBoxHeight || svgOptions.height;\n            }\n          }\n        }\n      }\n      options[prop] = finalValue;\n    });\n  }\n})();\n\n\n(function() {\n\n  'use strict';\n\n  var toFixed = fabric.util.toFixed;\n\n  /**\n   * Pattern class\n   * @class fabric.Pattern\n   * @see {@link http://fabricjs.com/patterns|Pattern demo}\n   * @see {@link http://fabricjs.com/dynamic-patterns|DynamicPattern demo}\n   * @see {@link fabric.Pattern#initialize} for constructor definition\n   */\n\n\n  fabric.Pattern = fabric.util.createClass(/** @lends fabric.Pattern.prototype */ {\n\n    /**\n     * Repeat property of a pattern (one of repeat, repeat-x, repeat-y or no-repeat)\n     * @type String\n     * @default\n     */\n    repeat: 'repeat',\n\n    /**\n     * Pattern horizontal offset from object's left/top corner\n     * @type Number\n     * @default\n     */\n    offsetX: 0,\n\n    /**\n     * Pattern vertical offset from object's left/top corner\n     * @type Number\n     * @default\n     */\n    offsetY: 0,\n\n    /**\n     * crossOrigin value (one of \"\", \"anonymous\", \"use-credentials\")\n     * @see https://developer.mozilla.org/en-US/docs/HTML/CORS_settings_attributes\n     * @type String\n     * @default\n     */\n    crossOrigin: '',\n\n    /**\n     * transform matrix to change the pattern, imported from svgs.\n     * @type Array\n     * @default\n     */\n    patternTransform: null,\n\n    /**\n     * Constructor\n     * @param {Object} [options] Options object\n     * @param {Function} [callback] function to invoke after callback init.\n     * @return {fabric.Pattern} thisArg\n     */\n    initialize: function(options, callback) {\n      options || (options = { });\n\n      this.id = fabric.Object.__uid++;\n      this.setOptions(options);\n      if (!options.source || (options.source && typeof options.source !== 'string')) {\n        callback && callback(this);\n        return;\n      }\n      else {\n        // img src string\n        var _this = this;\n        this.source = fabric.util.createImage();\n        fabric.util.loadImage(options.source, function(img, isError) {\n          _this.source = img;\n          callback && callback(_this, isError);\n        }, null, this.crossOrigin);\n      }\n    },\n\n    /**\n     * Returns object representation of a pattern\n     * @param {Array} [propertiesToInclude] Any properties that you might want to additionally include in the output\n     * @return {Object} Object representation of a pattern instance\n     */\n    toObject: function(propertiesToInclude) {\n      var NUM_FRACTION_DIGITS = fabric.Object.NUM_FRACTION_DIGITS,\n          source, object;\n\n      // <img> element\n      if (typeof this.source.src === 'string') {\n        source = this.source.src;\n      }\n      // <canvas> element\n      else if (typeof this.source === 'object' && this.source.toDataURL) {\n        source = this.source.toDataURL();\n      }\n\n      object = {\n        type: 'pattern',\n        source: source,\n        repeat: this.repeat,\n        crossOrigin: this.crossOrigin,\n        offsetX: toFixed(this.offsetX, NUM_FRACTION_DIGITS),\n        offsetY: toFixed(this.offsetY, NUM_FRACTION_DIGITS),\n        patternTransform: this.patternTransform ? this.patternTransform.concat() : null\n      };\n      fabric.util.populateWithProperties(this, object, propertiesToInclude);\n\n      return object;\n    },\n\n    /* _TO_SVG_START_ */\n    /**\n     * Returns SVG representation of a pattern\n     * @param {fabric.Object} object\n     * @return {String} SVG representation of a pattern\n     */\n    toSVG: function(object) {\n      var patternSource = typeof this.source === 'function' ? this.source() : this.source,\n          patternWidth = patternSource.width / object.width,\n          patternHeight = patternSource.height / object.height,\n          patternOffsetX = this.offsetX / object.width,\n          patternOffsetY = this.offsetY / object.height,\n          patternImgSrc = '';\n      if (this.repeat === 'repeat-x' || this.repeat === 'no-repeat') {\n        patternHeight = 1;\n        if (patternOffsetY) {\n          patternHeight += Math.abs(patternOffsetY);\n        }\n      }\n      if (this.repeat === 'repeat-y' || this.repeat === 'no-repeat') {\n        patternWidth = 1;\n        if (patternOffsetX) {\n          patternWidth += Math.abs(patternOffsetX);\n        }\n\n      }\n      if (patternSource.src) {\n        patternImgSrc = patternSource.src;\n      }\n      else if (patternSource.toDataURL) {\n        patternImgSrc = patternSource.toDataURL();\n      }\n\n      return '<pattern id=\"SVGID_' + this.id +\n                    '\" x=\"' + patternOffsetX +\n                    '\" y=\"' + patternOffsetY +\n                    '\" width=\"' + patternWidth +\n                    '\" height=\"' + patternHeight + '\">\\n' +\n               '<image x=\"0\" y=\"0\"' +\n                      ' width=\"' + patternSource.width +\n                      '\" height=\"' + patternSource.height +\n                      '\" xlink:href=\"' + patternImgSrc +\n               '\"></image>\\n' +\n             '</pattern>\\n';\n    },\n    /* _TO_SVG_END_ */\n\n    setOptions: function(options) {\n      for (var prop in options) {\n        this[prop] = options[prop];\n      }\n    },\n\n    /**\n     * Returns an instance of CanvasPattern\n     * @param {CanvasRenderingContext2D} ctx Context to create pattern\n     * @return {CanvasPattern}\n     */\n    toLive: function(ctx) {\n      var source = this.source;\n      // if the image failed to load, return, and allow rest to continue loading\n      if (!source) {\n        return '';\n      }\n\n      // if an image\n      if (typeof source.src !== 'undefined') {\n        if (!source.complete) {\n          return '';\n        }\n        if (source.naturalWidth === 0 || source.naturalHeight === 0) {\n          return '';\n        }\n      }\n      return ctx.createPattern(source, this.repeat);\n    }\n  });\n})();\n\n\n(function(global) {\n\n  'use strict';\n\n  var fabric = global.fabric || (global.fabric = { }),\n      toFixed = fabric.util.toFixed;\n\n  if (fabric.Shadow) {\n    fabric.warn('fabric.Shadow is already defined.');\n    return;\n  }\n\n  /**\n   * Shadow class\n   * @class fabric.Shadow\n   * @see {@link http://fabricjs.com/shadows|Shadow demo}\n   * @see {@link fabric.Shadow#initialize} for constructor definition\n   */\n  fabric.Shadow = fabric.util.createClass(/** @lends fabric.Shadow.prototype */ {\n\n    /**\n     * Shadow color\n     * @type String\n     * @default\n     */\n    color: 'rgb(0,0,0)',\n\n    /**\n     * Shadow blur\n     * @type Number\n     */\n    blur: 0,\n\n    /**\n     * Shadow horizontal offset\n     * @type Number\n     * @default\n     */\n    offsetX: 0,\n\n    /**\n     * Shadow vertical offset\n     * @type Number\n     * @default\n     */\n    offsetY: 0,\n\n    /**\n     * Whether the shadow should affect stroke operations\n     * @type Boolean\n     * @default\n     */\n    affectStroke: false,\n\n    /**\n     * Indicates whether toObject should include default values\n     * @type Boolean\n     * @default\n     */\n    includeDefaultValues: true,\n\n    /**\n     * When `false`, the shadow will scale with the object.\n     * When `true`, the shadow's offsetX, offsetY, and blur will not be affected by the object's scale.\n     * default to false\n     * @type Boolean\n     * @default\n     */\n    nonScaling: false,\n\n    /**\n     * Constructor\n     * @param {Object|String} [options] Options object with any of color, blur, offsetX, offsetY properties or string (e.g. \"rgba(0,0,0,0.2) 2px 2px 10px\")\n     * @return {fabric.Shadow} thisArg\n     */\n    initialize: function(options) {\n\n      if (typeof options === 'string') {\n        options = this._parseShadow(options);\n      }\n\n      for (var prop in options) {\n        this[prop] = options[prop];\n      }\n\n      this.id = fabric.Object.__uid++;\n    },\n\n    /**\n     * @private\n     * @param {String} shadow Shadow value to parse\n     * @return {Object} Shadow object with color, offsetX, offsetY and blur\n     */\n    _parseShadow: function(shadow) {\n      var shadowStr = shadow.trim(),\n          offsetsAndBlur = fabric.Shadow.reOffsetsAndBlur.exec(shadowStr) || [],\n          color = shadowStr.replace(fabric.Shadow.reOffsetsAndBlur, '') || 'rgb(0,0,0)';\n\n      return {\n        color: color.trim(),\n        offsetX: parseFloat(offsetsAndBlur[1], 10) || 0,\n        offsetY: parseFloat(offsetsAndBlur[2], 10) || 0,\n        blur: parseFloat(offsetsAndBlur[3], 10) || 0\n      };\n    },\n\n    /**\n     * Returns a string representation of an instance\n     * @see http://www.w3.org/TR/css-text-decor-3/#text-shadow\n     * @return {String} Returns CSS3 text-shadow declaration\n     */\n    toString: function() {\n      return [this.offsetX, this.offsetY, this.blur, this.color].join('px ');\n    },\n\n    /* _TO_SVG_START_ */\n    /**\n     * Returns SVG representation of a shadow\n     * @param {fabric.Object} object\n     * @return {String} SVG representation of a shadow\n     */\n    toSVG: function(object) {\n      var fBoxX = 40, fBoxY = 40, NUM_FRACTION_DIGITS = fabric.Object.NUM_FRACTION_DIGITS,\n          offset = fabric.util.rotateVector(\n            { x: this.offsetX, y: this.offsetY },\n            fabric.util.degreesToRadians(-object.angle)),\n          BLUR_BOX = 20, color = new fabric.Color(this.color);\n\n      if (object.width && object.height) {\n        //http://www.w3.org/TR/SVG/filters.html#FilterEffectsRegion\n        // we add some extra space to filter box to contain the blur ( 20 )\n        fBoxX = toFixed((Math.abs(offset.x) + this.blur) / object.width, NUM_FRACTION_DIGITS) * 100 + BLUR_BOX;\n        fBoxY = toFixed((Math.abs(offset.y) + this.blur) / object.height, NUM_FRACTION_DIGITS) * 100 + BLUR_BOX;\n      }\n      if (object.flipX) {\n        offset.x *= -1;\n      }\n      if (object.flipY) {\n        offset.y *= -1;\n      }\n\n      return (\n        '<filter id=\"SVGID_' + this.id + '\" y=\"-' + fBoxY + '%\" height=\"' + (100 + 2 * fBoxY) + '%\" ' +\n          'x=\"-' + fBoxX + '%\" width=\"' + (100 + 2 * fBoxX) + '%\" ' + '>\\n' +\n          '\\t<feGaussianBlur in=\"SourceAlpha\" stdDeviation=\"' +\n            toFixed(this.blur ? this.blur / 2 : 0, NUM_FRACTION_DIGITS) + '\"></feGaussianBlur>\\n' +\n          '\\t<feOffset dx=\"' + toFixed(offset.x, NUM_FRACTION_DIGITS) +\n          '\" dy=\"' + toFixed(offset.y, NUM_FRACTION_DIGITS) + '\" result=\"oBlur\" ></feOffset>\\n' +\n          '\\t<feFlood flood-color=\"' + color.toRgb() + '\" flood-opacity=\"' + color.getAlpha() + '\"/>\\n' +\n          '\\t<feComposite in2=\"oBlur\" operator=\"in\" />\\n' +\n          '\\t<feMerge>\\n' +\n            '\\t\\t<feMergeNode></feMergeNode>\\n' +\n            '\\t\\t<feMergeNode in=\"SourceGraphic\"></feMergeNode>\\n' +\n          '\\t</feMerge>\\n' +\n        '</filter>\\n');\n    },\n    /* _TO_SVG_END_ */\n\n    /**\n     * Returns object representation of a shadow\n     * @return {Object} Object representation of a shadow instance\n     */\n    toObject: function() {\n      if (this.includeDefaultValues) {\n        return {\n          color: this.color,\n          blur: this.blur,\n          offsetX: this.offsetX,\n          offsetY: this.offsetY,\n          affectStroke: this.affectStroke,\n          nonScaling: this.nonScaling\n        };\n      }\n      var obj = { }, proto = fabric.Shadow.prototype;\n\n      ['color', 'blur', 'offsetX', 'offsetY', 'affectStroke', 'nonScaling'].forEach(function(prop) {\n        if (this[prop] !== proto[prop]) {\n          obj[prop] = this[prop];\n        }\n      }, this);\n\n      return obj;\n    }\n  });\n\n  /**\n   * Regex matching shadow offsetX, offsetY and blur (ex: \"2px 2px 10px rgba(0,0,0,0.2)\", \"rgb(0,255,0) 2px 2px\")\n   * @static\n   * @field\n   * @memberOf fabric.Shadow\n   */\n  // eslint-disable-next-line max-len\n  fabric.Shadow.reOffsetsAndBlur = /(?:\\s|^)(-?\\d+(?:\\.\\d*)?(?:px)?(?:\\s?|$))?(-?\\d+(?:\\.\\d*)?(?:px)?(?:\\s?|$))?(\\d+(?:\\.\\d*)?(?:px)?)?(?:\\s?|$)(?:$|\\s)/;\n\n})(typeof exports !== 'undefined' ? exports : this);\n\n\n(function () {\n\n  'use strict';\n\n  if (fabric.StaticCanvas) {\n    fabric.warn('fabric.StaticCanvas is already defined.');\n    return;\n  }\n\n  // aliases for faster resolution\n  var extend = fabric.util.object.extend,\n      getElementOffset = fabric.util.getElementOffset,\n      removeFromArray = fabric.util.removeFromArray,\n      toFixed = fabric.util.toFixed,\n      transformPoint = fabric.util.transformPoint,\n      invertTransform = fabric.util.invertTransform,\n      getNodeCanvas = fabric.util.getNodeCanvas,\n      createCanvasElement = fabric.util.createCanvasElement,\n\n      CANVAS_INIT_ERROR = new Error('Could not initialize `canvas` element');\n\n  /**\n   * Static canvas class\n   * @class fabric.StaticCanvas\n   * @mixes fabric.Collection\n   * @mixes fabric.Observable\n   * @see {@link http://fabricjs.com/static_canvas|StaticCanvas demo}\n   * @see {@link fabric.StaticCanvas#initialize} for constructor definition\n   * @fires before:render\n   * @fires after:render\n   * @fires canvas:cleared\n   * @fires object:added\n   * @fires object:removed\n   */\n  fabric.StaticCanvas = fabric.util.createClass(fabric.CommonMethods, /** @lends fabric.StaticCanvas.prototype */ {\n\n    /**\n     * Constructor\n     * @param {HTMLElement | String} el &lt;canvas> element to initialize instance on\n     * @param {Object} [options] Options object\n     * @return {Object} thisArg\n     */\n    initialize: function(el, options) {\n      options || (options = { });\n      this.renderAndResetBound = this.renderAndReset.bind(this);\n      this.requestRenderAllBound = this.requestRenderAll.bind(this);\n      this._initStatic(el, options);\n    },\n\n    /**\n     * Background color of canvas instance.\n     * Should be set via {@link fabric.StaticCanvas#setBackgroundColor}.\n     * @type {(String|fabric.Pattern)}\n     * @default\n     */\n    backgroundColor: '',\n\n    /**\n     * Background image of canvas instance.\n     * since 2.4.0 image caching is active, please when putting an image as background, add to the\n     * canvas property a reference to the canvas it is on. Otherwise the image cannot detect the zoom\n     * vale. As an alternative you can disable image objectCaching\n     * @type fabric.Image\n     * @default\n     */\n    backgroundImage: null,\n\n    /**\n     * Overlay color of canvas instance.\n     * Should be set via {@link fabric.StaticCanvas#setOverlayColor}\n     * @since 1.3.9\n     * @type {(String|fabric.Pattern)}\n     * @default\n     */\n    overlayColor: '',\n\n    /**\n     * Overlay image of canvas instance.\n     * since 2.4.0 image caching is active, please when putting an image as overlay, add to the\n     * canvas property a reference to the canvas it is on. Otherwise the image cannot detect the zoom\n     * vale. As an alternative you can disable image objectCaching\n     * @type fabric.Image\n     * @default\n     */\n    overlayImage: null,\n\n    /**\n     * Indicates whether toObject/toDatalessObject should include default values\n     * if set to false, takes precedence over the object value.\n     * @type Boolean\n     * @default\n     */\n    includeDefaultValues: true,\n\n    /**\n     * Indicates whether objects' state should be saved\n     * @type Boolean\n     * @default\n     */\n    stateful: false,\n\n    /**\n     * Indicates whether {@link fabric.Collection.add}, {@link fabric.Collection.insertAt} and {@link fabric.Collection.remove},\n     * {@link fabric.StaticCanvas.moveTo}, {@link fabric.StaticCanvas.clear} and many more, should also re-render canvas.\n     * Disabling this option will not give a performance boost when adding/removing a lot of objects to/from canvas at once\n     * since the renders are quequed and executed one per frame.\n     * Disabling is suggested anyway and managing the renders of the app manually is not a big effort ( canvas.requestRenderAll() )\n     * Left default to true to do not break documentation and old app, fiddles.\n     * @type Boolean\n     * @default\n     */\n    renderOnAddRemove: true,\n\n    /**\n     * Indicates whether object controls (borders/controls) are rendered above overlay image\n     * @type Boolean\n     * @default\n     */\n    controlsAboveOverlay: false,\n\n    /**\n     * Indicates whether the browser can be scrolled when using a touchscreen and dragging on the canvas\n     * @type Boolean\n     * @default\n     */\n    allowTouchScrolling: false,\n\n    /**\n     * Indicates whether this canvas will use image smoothing, this is on by default in browsers\n     * @type Boolean\n     * @default\n     */\n    imageSmoothingEnabled: true,\n\n    /**\n     * The transformation (a Canvas 2D API transform matrix) which focuses the viewport\n     * @type Array\n     * @example <caption>Default transform</caption>\n     * canvas.viewportTransform = [1, 0, 0, 1, 0, 0];\n     * @example <caption>Scale by 70% and translate toward bottom-right by 50, without skewing</caption>\n     * canvas.viewportTransform = [0.7, 0, 0, 0.7, 50, 50];\n     * @default\n     */\n    viewportTransform: fabric.iMatrix.concat(),\n\n    /**\n     * if set to false background image is not affected by viewport transform\n     * @since 1.6.3\n     * @type Boolean\n     * @default\n     */\n    backgroundVpt: true,\n\n    /**\n     * if set to false overlya image is not affected by viewport transform\n     * @since 1.6.3\n     * @type Boolean\n     * @default\n     */\n    overlayVpt: true,\n\n    /**\n     * When true, canvas is scaled by devicePixelRatio for better rendering on retina screens\n     * @type Boolean\n     * @default\n     */\n    enableRetinaScaling: true,\n\n    /**\n     * Describe canvas element extension over design\n     * properties are tl,tr,bl,br.\n     * if canvas is not zoomed/panned those points are the four corner of canvas\n     * if canvas is viewportTransformed you those points indicate the extension\n     * of canvas element in plain untrasformed coordinates\n     * The coordinates get updated with @method calcViewportBoundaries.\n     * @memberOf fabric.StaticCanvas.prototype\n     */\n    vptCoords: { },\n\n    /**\n     * Based on vptCoords and object.aCoords, skip rendering of objects that\n     * are not included in current viewport.\n     * May greatly help in applications with crowded canvas and use of zoom/pan\n     * If One of the corner of the bounding box of the object is on the canvas\n     * the objects get rendered.\n     * @memberOf fabric.StaticCanvas.prototype\n     * @type Boolean\n     * @default\n     */\n    skipOffscreen: true,\n\n    /**\n     * a fabricObject that, without stroke define a clipping area with their shape. filled in black\n     * the clipPath object gets used when the canvas has rendered, and the context is placed in the\n     * top left corner of the canvas.\n     * clipPath will clip away controls, if you do not want this to happen use controlsAboveOverlay = true\n     * @type fabric.Object\n     */\n    clipPath: undefined,\n\n    /**\n     * @private\n     * @param {HTMLElement | String} el &lt;canvas> element to initialize instance on\n     * @param {Object} [options] Options object\n     */\n    _initStatic: function(el, options) {\n      var cb = this.requestRenderAllBound;\n      this._objects = [];\n      this._createLowerCanvas(el);\n      this._initOptions(options);\n      // only initialize retina scaling once\n      if (!this.interactive) {\n        this._initRetinaScaling();\n      }\n\n      if (options.overlayImage) {\n        this.setOverlayImage(options.overlayImage, cb);\n      }\n      if (options.backgroundImage) {\n        this.setBackgroundImage(options.backgroundImage, cb);\n      }\n      if (options.backgroundColor) {\n        this.setBackgroundColor(options.backgroundColor, cb);\n      }\n      if (options.overlayColor) {\n        this.setOverlayColor(options.overlayColor, cb);\n      }\n      this.calcOffset();\n    },\n\n    /**\n     * @private\n     */\n    _isRetinaScaling: function() {\n      return (fabric.devicePixelRatio > 1 && this.enableRetinaScaling);\n    },\n\n    /**\n     * @private\n     * @return {Number} retinaScaling if applied, otherwise 1;\n     */\n    getRetinaScaling: function() {\n      return this._isRetinaScaling() ? Math.max(1, fabric.devicePixelRatio) : 1;\n    },\n\n    /**\n     * @private\n     */\n    _initRetinaScaling: function() {\n      if (!this._isRetinaScaling()) {\n        return;\n      }\n      var scaleRatio = fabric.devicePixelRatio;\n      this.__initRetinaScaling(scaleRatio, this.lowerCanvasEl, this.contextContainer);\n      if (this.upperCanvasEl) {\n        this.__initRetinaScaling(scaleRatio, this.upperCanvasEl, this.contextTop);\n      }\n    },\n\n    __initRetinaScaling: function(scaleRatio, canvas, context) {\n      canvas.setAttribute('width', this.width * scaleRatio);\n      canvas.setAttribute('height', this.height * scaleRatio);\n      context.scale(scaleRatio, scaleRatio);\n    },\n\n\n    /**\n     * Calculates canvas element offset relative to the document\n     * This method is also attached as \"resize\" event handler of window\n     * @return {fabric.Canvas} instance\n     * @chainable\n     */\n    calcOffset: function () {\n      this._offset = getElementOffset(this.lowerCanvasEl);\n      return this;\n    },\n\n    /**\n     * Sets {@link fabric.StaticCanvas#overlayImage|overlay image} for this canvas\n     * @param {(fabric.Image|String)} image fabric.Image instance or URL of an image to set overlay to\n     * @param {Function} callback callback to invoke when image is loaded and set as an overlay\n     * @param {Object} [options] Optional options to set for the {@link fabric.Image|overlay image}.\n     * @return {fabric.Canvas} thisArg\n     * @chainable\n     * @see {@link http://jsfiddle.net/fabricjs/MnzHT/|jsFiddle demo}\n     * @example <caption>Normal overlayImage with left/top = 0</caption>\n     * canvas.setOverlayImage('http://fabricjs.com/assets/jail_cell_bars.png', canvas.renderAll.bind(canvas), {\n     *   // Needed to position overlayImage at 0/0\n     *   originX: 'left',\n     *   originY: 'top'\n     * });\n     * @example <caption>overlayImage with different properties</caption>\n     * canvas.setOverlayImage('http://fabricjs.com/assets/jail_cell_bars.png', canvas.renderAll.bind(canvas), {\n     *   opacity: 0.5,\n     *   angle: 45,\n     *   left: 400,\n     *   top: 400,\n     *   originX: 'left',\n     *   originY: 'top'\n     * });\n     * @example <caption>Stretched overlayImage #1 - width/height correspond to canvas width/height</caption>\n     * fabric.Image.fromURL('http://fabricjs.com/assets/jail_cell_bars.png', function(img, isError) {\n     *    img.set({width: canvas.width, height: canvas.height, originX: 'left', originY: 'top'});\n     *    canvas.setOverlayImage(img, canvas.renderAll.bind(canvas));\n     * });\n     * @example <caption>Stretched overlayImage #2 - width/height correspond to canvas width/height</caption>\n     * canvas.setOverlayImage('http://fabricjs.com/assets/jail_cell_bars.png', canvas.renderAll.bind(canvas), {\n     *   width: canvas.width,\n     *   height: canvas.height,\n     *   // Needed to position overlayImage at 0/0\n     *   originX: 'left',\n     *   originY: 'top'\n     * });\n     * @example <caption>overlayImage loaded from cross-origin</caption>\n     * canvas.setOverlayImage('http://fabricjs.com/assets/jail_cell_bars.png', canvas.renderAll.bind(canvas), {\n     *   opacity: 0.5,\n     *   angle: 45,\n     *   left: 400,\n     *   top: 400,\n     *   originX: 'left',\n     *   originY: 'top',\n     *   crossOrigin: 'anonymous'\n     * });\n     */\n    setOverlayImage: function (image, callback, options) {\n      return this.__setBgOverlayImage('overlayImage', image, callback, options);\n    },\n\n    /**\n     * Sets {@link fabric.StaticCanvas#backgroundImage|background image} for this canvas\n     * @param {(fabric.Image|String)} image fabric.Image instance or URL of an image to set background to\n     * @param {Function} callback Callback to invoke when image is loaded and set as background\n     * @param {Object} [options] Optional options to set for the {@link fabric.Image|background image}.\n     * @return {fabric.Canvas} thisArg\n     * @chainable\n     * @see {@link http://jsfiddle.net/djnr8o7a/28/|jsFiddle demo}\n     * @example <caption>Normal backgroundImage with left/top = 0</caption>\n     * canvas.setBackgroundImage('http://fabricjs.com/assets/honey_im_subtle.png', canvas.renderAll.bind(canvas), {\n     *   // Needed to position backgroundImage at 0/0\n     *   originX: 'left',\n     *   originY: 'top'\n     * });\n     * @example <caption>backgroundImage with different properties</caption>\n     * canvas.setBackgroundImage('http://fabricjs.com/assets/honey_im_subtle.png', canvas.renderAll.bind(canvas), {\n     *   opacity: 0.5,\n     *   angle: 45,\n     *   left: 400,\n     *   top: 400,\n     *   originX: 'left',\n     *   originY: 'top'\n     * });\n     * @example <caption>Stretched backgroundImage #1 - width/height correspond to canvas width/height</caption>\n     * fabric.Image.fromURL('http://fabricjs.com/assets/honey_im_subtle.png', function(img, isError) {\n     *    img.set({width: canvas.width, height: canvas.height, originX: 'left', originY: 'top'});\n     *    canvas.setBackgroundImage(img, canvas.renderAll.bind(canvas));\n     * });\n     * @example <caption>Stretched backgroundImage #2 - width/height correspond to canvas width/height</caption>\n     * canvas.setBackgroundImage('http://fabricjs.com/assets/honey_im_subtle.png', canvas.renderAll.bind(canvas), {\n     *   width: canvas.width,\n     *   height: canvas.height,\n     *   // Needed to position backgroundImage at 0/0\n     *   originX: 'left',\n     *   originY: 'top'\n     * });\n     * @example <caption>backgroundImage loaded from cross-origin</caption>\n     * canvas.setBackgroundImage('http://fabricjs.com/assets/honey_im_subtle.png', canvas.renderAll.bind(canvas), {\n     *   opacity: 0.5,\n     *   angle: 45,\n     *   left: 400,\n     *   top: 400,\n     *   originX: 'left',\n     *   originY: 'top',\n     *   crossOrigin: 'anonymous'\n     * });\n     */\n    // TODO: fix stretched examples\n    setBackgroundImage: function (image, callback, options) {\n      return this.__setBgOverlayImage('backgroundImage', image, callback, options);\n    },\n\n    /**\n     * Sets {@link fabric.StaticCanvas#overlayColor|foreground color} for this canvas\n     * @param {(String|fabric.Pattern)} overlayColor Color or pattern to set foreground color to\n     * @param {Function} callback Callback to invoke when foreground color is set\n     * @return {fabric.Canvas} thisArg\n     * @chainable\n     * @see {@link http://jsfiddle.net/fabricjs/pB55h/|jsFiddle demo}\n     * @example <caption>Normal overlayColor - color value</caption>\n     * canvas.setOverlayColor('rgba(255, 73, 64, 0.6)', canvas.renderAll.bind(canvas));\n     * @example <caption>fabric.Pattern used as overlayColor</caption>\n     * canvas.setOverlayColor({\n     *   source: 'http://fabricjs.com/assets/escheresque_ste.png'\n     * }, canvas.renderAll.bind(canvas));\n     * @example <caption>fabric.Pattern used as overlayColor with repeat and offset</caption>\n     * canvas.setOverlayColor({\n     *   source: 'http://fabricjs.com/assets/escheresque_ste.png',\n     *   repeat: 'repeat',\n     *   offsetX: 200,\n     *   offsetY: 100\n     * }, canvas.renderAll.bind(canvas));\n     */\n    setOverlayColor: function(overlayColor, callback) {\n      return this.__setBgOverlayColor('overlayColor', overlayColor, callback);\n    },\n\n    /**\n     * Sets {@link fabric.StaticCanvas#backgroundColor|background color} for this canvas\n     * @param {(String|fabric.Pattern)} backgroundColor Color or pattern to set background color to\n     * @param {Function} callback Callback to invoke when background color is set\n     * @return {fabric.Canvas} thisArg\n     * @chainable\n     * @see {@link http://jsfiddle.net/fabricjs/hXzvk/|jsFiddle demo}\n     * @example <caption>Normal backgroundColor - color value</caption>\n     * canvas.setBackgroundColor('rgba(255, 73, 64, 0.6)', canvas.renderAll.bind(canvas));\n     * @example <caption>fabric.Pattern used as backgroundColor</caption>\n     * canvas.setBackgroundColor({\n     *   source: 'http://fabricjs.com/assets/escheresque_ste.png'\n     * }, canvas.renderAll.bind(canvas));\n     * @example <caption>fabric.Pattern used as backgroundColor with repeat and offset</caption>\n     * canvas.setBackgroundColor({\n     *   source: 'http://fabricjs.com/assets/escheresque_ste.png',\n     *   repeat: 'repeat',\n     *   offsetX: 200,\n     *   offsetY: 100\n     * }, canvas.renderAll.bind(canvas));\n     */\n    setBackgroundColor: function(backgroundColor, callback) {\n      return this.__setBgOverlayColor('backgroundColor', backgroundColor, callback);\n    },\n\n    /**\n     * @private\n     * @param {String} property Property to set ({@link fabric.StaticCanvas#backgroundImage|backgroundImage}\n     * or {@link fabric.StaticCanvas#overlayImage|overlayImage})\n     * @param {(fabric.Image|String|null)} image fabric.Image instance, URL of an image or null to set background or overlay to\n     * @param {Function} callback Callback to invoke when image is loaded and set as background or overlay. The first argument is the created image, the second argument is a flag indicating whether an error occurred or not.\n     * @param {Object} [options] Optional options to set for the {@link fabric.Image|image}.\n     */\n    __setBgOverlayImage: function(property, image, callback, options) {\n      if (typeof image === 'string') {\n        fabric.util.loadImage(image, function(img, isError) {\n          if (img) {\n            var instance = new fabric.Image(img, options);\n            this[property] = instance;\n            instance.canvas = this;\n          }\n          callback && callback(img, isError);\n        }, this, options && options.crossOrigin);\n      }\n      else {\n        options && image.setOptions(options);\n        this[property] = image;\n        image && (image.canvas = this);\n        callback && callback(image, false);\n      }\n\n      return this;\n    },\n\n    /**\n     * @private\n     * @param {String} property Property to set ({@link fabric.StaticCanvas#backgroundColor|backgroundColor}\n     * or {@link fabric.StaticCanvas#overlayColor|overlayColor})\n     * @param {(Object|String|null)} color Object with pattern information, color value or null\n     * @param {Function} [callback] Callback is invoked when color is set\n     */\n    __setBgOverlayColor: function(property, color, callback) {\n      this[property] = color;\n      this._initGradient(color, property);\n      this._initPattern(color, property, callback);\n      return this;\n    },\n\n    /**\n     * @private\n     */\n    _createCanvasElement: function() {\n      var element = createCanvasElement();\n      if (!element) {\n        throw CANVAS_INIT_ERROR;\n      }\n      if (!element.style) {\n        element.style = { };\n      }\n      if (typeof element.getContext === 'undefined') {\n        throw CANVAS_INIT_ERROR;\n      }\n      return element;\n    },\n\n    /**\n     * @private\n     * @param {Object} [options] Options object\n     */\n    _initOptions: function (options) {\n      var lowerCanvasEl = this.lowerCanvasEl;\n      this._setOptions(options);\n\n      this.width = this.width || parseInt(lowerCanvasEl.width, 10) || 0;\n      this.height = this.height || parseInt(lowerCanvasEl.height, 10) || 0;\n\n      if (!this.lowerCanvasEl.style) {\n        return;\n      }\n\n      lowerCanvasEl.width = this.width;\n      lowerCanvasEl.height = this.height;\n\n      lowerCanvasEl.style.width = this.width + 'px';\n      lowerCanvasEl.style.height = this.height + 'px';\n\n      this.viewportTransform = this.viewportTransform.slice();\n    },\n\n    /**\n     * Creates a bottom canvas\n     * @private\n     * @param {HTMLElement} [canvasEl]\n     */\n    _createLowerCanvas: function (canvasEl) {\n      // canvasEl === 'HTMLCanvasElement' does not work on jsdom/node\n      if (canvasEl && canvasEl.getContext) {\n        this.lowerCanvasEl = canvasEl;\n      }\n      else {\n        this.lowerCanvasEl = fabric.util.getById(canvasEl) || this._createCanvasElement();\n      }\n\n      fabric.util.addClass(this.lowerCanvasEl, 'lower-canvas');\n      this._originalCanvasStyle = this.lowerCanvasEl.style;\n      if (this.interactive) {\n        this._applyCanvasStyle(this.lowerCanvasEl);\n      }\n\n      this.contextContainer = this.lowerCanvasEl.getContext('2d');\n    },\n\n    /**\n     * Returns canvas width (in px)\n     * @return {Number}\n     */\n    getWidth: function () {\n      return this.width;\n    },\n\n    /**\n     * Returns canvas height (in px)\n     * @return {Number}\n     */\n    getHeight: function () {\n      return this.height;\n    },\n\n    /**\n     * Sets width of this canvas instance\n     * @param {Number|String} value                         Value to set width to\n     * @param {Object}        [options]                     Options object\n     * @param {Boolean}       [options.backstoreOnly=false] Set the given dimensions only as canvas backstore dimensions\n     * @param {Boolean}       [options.cssOnly=false]       Set the given dimensions only as css dimensions\n     * @return {fabric.Canvas} instance\n     * @chainable true\n     */\n    setWidth: function (value, options) {\n      return this.setDimensions({ width: value }, options);\n    },\n\n    /**\n     * Sets height of this canvas instance\n     * @param {Number|String} value                         Value to set height to\n     * @param {Object}        [options]                     Options object\n     * @param {Boolean}       [options.backstoreOnly=false] Set the given dimensions only as canvas backstore dimensions\n     * @param {Boolean}       [options.cssOnly=false]       Set the given dimensions only as css dimensions\n     * @return {fabric.Canvas} instance\n     * @chainable true\n     */\n    setHeight: function (value, options) {\n      return this.setDimensions({ height: value }, options);\n    },\n\n    /**\n     * Sets dimensions (width, height) of this canvas instance. when options.cssOnly flag active you should also supply the unit of measure (px/%/em)\n     * @param {Object}        dimensions                    Object with width/height properties\n     * @param {Number|String} [dimensions.width]            Width of canvas element\n     * @param {Number|String} [dimensions.height]           Height of canvas element\n     * @param {Object}        [options]                     Options object\n     * @param {Boolean}       [options.backstoreOnly=false] Set the given dimensions only as canvas backstore dimensions\n     * @param {Boolean}       [options.cssOnly=false]       Set the given dimensions only as css dimensions\n     * @return {fabric.Canvas} thisArg\n     * @chainable\n     */\n    setDimensions: function (dimensions, options) {\n      var cssValue;\n\n      options = options || {};\n\n      for (var prop in dimensions) {\n        cssValue = dimensions[prop];\n\n        if (!options.cssOnly) {\n          this._setBackstoreDimension(prop, dimensions[prop]);\n          cssValue += 'px';\n          this.hasLostContext = true;\n        }\n\n        if (!options.backstoreOnly) {\n          this._setCssDimension(prop, cssValue);\n        }\n      }\n      if (this._isCurrentlyDrawing) {\n        this.freeDrawingBrush && this.freeDrawingBrush._setBrushStyles(this.contextTop);\n      }\n      this._initRetinaScaling();\n      this.calcOffset();\n\n      if (!options.cssOnly) {\n        this.requestRenderAll();\n      }\n\n      return this;\n    },\n\n    /**\n     * Helper for setting width/height\n     * @private\n     * @param {String} prop property (width|height)\n     * @param {Number} value value to set property to\n     * @return {fabric.Canvas} instance\n     * @chainable true\n     */\n    _setBackstoreDimension: function (prop, value) {\n      this.lowerCanvasEl[prop] = value;\n\n      if (this.upperCanvasEl) {\n        this.upperCanvasEl[prop] = value;\n      }\n\n      if (this.cacheCanvasEl) {\n        this.cacheCanvasEl[prop] = value;\n      }\n\n      this[prop] = value;\n\n      return this;\n    },\n\n    /**\n     * Helper for setting css width/height\n     * @private\n     * @param {String} prop property (width|height)\n     * @param {String} value value to set property to\n     * @return {fabric.Canvas} instance\n     * @chainable true\n     */\n    _setCssDimension: function (prop, value) {\n      this.lowerCanvasEl.style[prop] = value;\n\n      if (this.upperCanvasEl) {\n        this.upperCanvasEl.style[prop] = value;\n      }\n\n      if (this.wrapperEl) {\n        this.wrapperEl.style[prop] = value;\n      }\n\n      return this;\n    },\n\n    /**\n     * Returns canvas zoom level\n     * @return {Number}\n     */\n    getZoom: function () {\n      return this.viewportTransform[0];\n    },\n\n    /**\n     * Sets viewport transformation of this canvas instance\n     * @param {Array} vpt a Canvas 2D API transform matrix\n     * @return {fabric.Canvas} instance\n     * @chainable true\n     */\n    setViewportTransform: function (vpt) {\n      var activeObject = this._activeObject,\n          backgroundObject = this.backgroundImage,\n          overlayObject = this.overlayImage,\n          object, i, len;\n      this.viewportTransform = vpt;\n      for (i = 0, len = this._objects.length; i < len; i++) {\n        object = this._objects[i];\n        object.group || object.setCoords(true);\n      }\n      if (activeObject) {\n        activeObject.setCoords();\n      }\n      if (backgroundObject) {\n        backgroundObject.setCoords(true);\n      }\n      if (overlayObject) {\n        overlayObject.setCoords(true);\n      }\n      this.calcViewportBoundaries();\n      this.renderOnAddRemove && this.requestRenderAll();\n      return this;\n    },\n\n    /**\n     * Sets zoom level of this canvas instance, the zoom centered around point\n     * meaning that following zoom to point with the same point will have the visual\n     * effect of the zoom originating from that point. The point won't move.\n     * It has nothing to do with canvas center or visual center of the viewport.\n     * @param {fabric.Point} point to zoom with respect to\n     * @param {Number} value to set zoom to, less than 1 zooms out\n     * @return {fabric.Canvas} instance\n     * @chainable true\n     */\n    zoomToPoint: function (point, value) {\n      // TODO: just change the scale, preserve other transformations\n      var before = point, vpt = this.viewportTransform.slice(0);\n      point = transformPoint(point, invertTransform(this.viewportTransform));\n      vpt[0] = value;\n      vpt[3] = value;\n      var after = transformPoint(point, vpt);\n      vpt[4] += before.x - after.x;\n      vpt[5] += before.y - after.y;\n      return this.setViewportTransform(vpt);\n    },\n\n    /**\n     * Sets zoom level of this canvas instance\n     * @param {Number} value to set zoom to, less than 1 zooms out\n     * @return {fabric.Canvas} instance\n     * @chainable true\n     */\n    setZoom: function (value) {\n      this.zoomToPoint(new fabric.Point(0, 0), value);\n      return this;\n    },\n\n    /**\n     * Pan viewport so as to place point at top left corner of canvas\n     * @param {fabric.Point} point to move to\n     * @return {fabric.Canvas} instance\n     * @chainable true\n     */\n    absolutePan: function (point) {\n      var vpt = this.viewportTransform.slice(0);\n      vpt[4] = -point.x;\n      vpt[5] = -point.y;\n      return this.setViewportTransform(vpt);\n    },\n\n    /**\n     * Pans viewpoint relatively\n     * @param {fabric.Point} point (position vector) to move by\n     * @return {fabric.Canvas} instance\n     * @chainable true\n     */\n    relativePan: function (point) {\n      return this.absolutePan(new fabric.Point(\n        -point.x - this.viewportTransform[4],\n        -point.y - this.viewportTransform[5]\n      ));\n    },\n\n    /**\n     * Returns &lt;canvas> element corresponding to this instance\n     * @return {HTMLCanvasElement}\n     */\n    getElement: function () {\n      return this.lowerCanvasEl;\n    },\n\n    /**\n     * @private\n     * @param {fabric.Object} obj Object that was added\n     */\n    _onObjectAdded: function(obj) {\n      this.stateful && obj.setupState();\n      obj._set('canvas', this);\n      obj.setCoords();\n      this.fire('object:added', { target: obj });\n      obj.fire('added');\n    },\n\n    /**\n     * @private\n     * @param {fabric.Object} obj Object that was removed\n     */\n    _onObjectRemoved: function(obj) {\n      this.fire('object:removed', { target: obj });\n      obj.fire('removed');\n      delete obj.canvas;\n    },\n\n    /**\n     * Clears specified context of canvas element\n     * @param {CanvasRenderingContext2D} ctx Context to clear\n     * @return {fabric.Canvas} thisArg\n     * @chainable\n     */\n    clearContext: function(ctx) {\n      ctx.clearRect(0, 0, this.width, this.height);\n      return this;\n    },\n\n    /**\n     * Returns context of canvas where objects are drawn\n     * @return {CanvasRenderingContext2D}\n     */\n    getContext: function () {\n      return this.contextContainer;\n    },\n\n    /**\n     * Clears all contexts (background, main, top) of an instance\n     * @return {fabric.Canvas} thisArg\n     * @chainable\n     */\n    clear: function () {\n      this.remove.apply(this, this.getObjects());\n      this.backgroundImage = null;\n      this.overlayImage = null;\n      this.backgroundColor = '';\n      this.overlayColor = '';\n      if (this._hasITextHandlers) {\n        this.off('mouse:up', this._mouseUpITextHandler);\n        this._iTextInstances = null;\n        this._hasITextHandlers = false;\n      }\n      this.clearContext(this.contextContainer);\n      this.fire('canvas:cleared');\n      this.renderOnAddRemove && this.requestRenderAll();\n      return this;\n    },\n\n    /**\n     * Renders the canvas\n     * @return {fabric.Canvas} instance\n     * @chainable\n     */\n    renderAll: function () {\n      var canvasToDrawOn = this.contextContainer;\n      this.renderCanvas(canvasToDrawOn, this._objects);\n      return this;\n    },\n\n    /**\n     * Function created to be instance bound at initialization\n     * used in requestAnimationFrame rendering\n     * Let the fabricJS call it. If you call it manually you could have more\n     * animationFrame stacking on to of each other\n     * for an imperative rendering, use canvas.renderAll\n     * @private\n     * @return {fabric.Canvas} instance\n     * @chainable\n     */\n    renderAndReset: function() {\n      this.isRendering = 0;\n      this.renderAll();\n    },\n\n    /**\n     * Append a renderAll request to next animation frame.\n     * unless one is already in progress, in that case nothing is done\n     * a boolean flag will avoid appending more.\n     * @return {fabric.Canvas} instance\n     * @chainable\n     */\n    requestRenderAll: function () {\n      if (!this.isRendering) {\n        this.isRendering = fabric.util.requestAnimFrame(this.renderAndResetBound);\n      }\n      return this;\n    },\n\n    /**\n     * Calculate the position of the 4 corner of canvas with current viewportTransform.\n     * helps to determinate when an object is in the current rendering viewport using\n     * object absolute coordinates ( aCoords )\n     * @return {Object} points.tl\n     * @chainable\n     */\n    calcViewportBoundaries: function() {\n      var points = { }, width = this.width, height = this.height,\n          iVpt = invertTransform(this.viewportTransform);\n      points.tl = transformPoint({ x: 0, y: 0 }, iVpt);\n      points.br = transformPoint({ x: width, y: height }, iVpt);\n      points.tr = new fabric.Point(points.br.x, points.tl.y);\n      points.bl = new fabric.Point(points.tl.x, points.br.y);\n      this.vptCoords = points;\n      return points;\n    },\n\n    cancelRequestedRender: function() {\n      if (this.isRendering) {\n        fabric.util.cancelAnimFrame(this.isRendering);\n        this.isRendering = 0;\n      }\n    },\n\n    /**\n     * Renders background, objects, overlay and controls.\n     * @param {CanvasRenderingContext2D} ctx\n     * @param {Array} objects to render\n     * @return {fabric.Canvas} instance\n     * @chainable\n     */\n    renderCanvas: function(ctx, objects) {\n      var v = this.viewportTransform, path = this.clipPath;\n      this.cancelRequestedRender();\n      this.calcViewportBoundaries();\n      this.clearContext(ctx);\n      fabric.util.setImageSmoothing(ctx, this.imageSmoothingEnabled);\n      this.fire('before:render', { ctx: ctx, });\n      this._renderBackground(ctx);\n\n      ctx.save();\n      //apply viewport transform once for all rendering process\n      ctx.transform(v[0], v[1], v[2], v[3], v[4], v[5]);\n      this._renderObjects(ctx, objects);\n      ctx.restore();\n      if (!this.controlsAboveOverlay && this.interactive) {\n        this.drawControls(ctx);\n      }\n      if (path) {\n        path.canvas = this;\n        // needed to setup a couple of variables\n        path.shouldCache();\n        path._transformDone = true;\n        path.renderCache({ forClipping: true });\n        this.drawClipPathOnCanvas(ctx);\n      }\n      this._renderOverlay(ctx);\n      if (this.controlsAboveOverlay && this.interactive) {\n        this.drawControls(ctx);\n      }\n      this.fire('after:render', { ctx: ctx, });\n    },\n\n    /**\n     * Paint the cached clipPath on the lowerCanvasEl\n     * @param {CanvasRenderingContext2D} ctx Context to render on\n     */\n    drawClipPathOnCanvas: function(ctx) {\n      var v = this.viewportTransform, path = this.clipPath;\n      ctx.save();\n      ctx.transform(v[0], v[1], v[2], v[3], v[4], v[5]);\n      // DEBUG: uncomment this line, comment the following\n      // ctx.globalAlpha = 0.4;\n      ctx.globalCompositeOperation = 'destination-in';\n      path.transform(ctx);\n      ctx.scale(1 / path.zoomX, 1 / path.zoomY);\n      ctx.drawImage(path._cacheCanvas, -path.cacheTranslationX, -path.cacheTranslationY);\n      ctx.restore();\n    },\n\n    /**\n     * @private\n     * @param {CanvasRenderingContext2D} ctx Context to render on\n     * @param {Array} objects to render\n     */\n    _renderObjects: function(ctx, objects) {\n      var i, len;\n      for (i = 0, len = objects.length; i < len; ++i) {\n        objects[i] && objects[i].render(ctx);\n      }\n    },\n\n    /**\n     * @private\n     * @param {CanvasRenderingContext2D} ctx Context to render on\n     * @param {string} property 'background' or 'overlay'\n     */\n    _renderBackgroundOrOverlay: function(ctx, property) {\n      var fill = this[property + 'Color'], object = this[property + 'Image'],\n          v = this.viewportTransform, needsVpt = this[property + 'Vpt'];\n      if (!fill && !object) {\n        return;\n      }\n      if (fill) {\n        ctx.save();\n        ctx.beginPath();\n        ctx.moveTo(0, 0);\n        ctx.lineTo(this.width, 0);\n        ctx.lineTo(this.width, this.height);\n        ctx.lineTo(0, this.height);\n        ctx.closePath();\n        ctx.fillStyle = fill.toLive\n          ? fill.toLive(ctx, this)\n          : fill;\n        if (needsVpt) {\n          ctx.transform(v[0], v[1], v[2], v[3], v[4], v[5]);\n        }\n        ctx.transform(1, 0, 0, 1, fill.offsetX || 0, fill.offsetY || 0);\n        var m = fill.gradientTransform || fill.patternTransform;\n        m && ctx.transform(m[0], m[1], m[2], m[3], m[4], m[5]);\n        ctx.fill();\n        ctx.restore();\n      }\n      if (object) {\n        ctx.save();\n        if (needsVpt) {\n          ctx.transform(v[0], v[1], v[2], v[3], v[4], v[5]);\n        }\n        object.render(ctx);\n        ctx.restore();\n      }\n    },\n\n    /**\n     * @private\n     * @param {CanvasRenderingContext2D} ctx Context to render on\n     */\n    _renderBackground: function(ctx) {\n      this._renderBackgroundOrOverlay(ctx, 'background');\n    },\n\n    /**\n     * @private\n     * @param {CanvasRenderingContext2D} ctx Context to render on\n     */\n    _renderOverlay: function(ctx) {\n      this._renderBackgroundOrOverlay(ctx, 'overlay');\n    },\n\n    /**\n     * Returns coordinates of a center of canvas.\n     * Returned value is an object with top and left properties\n     * @return {Object} object with \"top\" and \"left\" number values\n     * @deprecated migrate to `getCenterPoint`\n     */\n    getCenter: function () {\n      return {\n        top: this.height / 2,\n        left: this.width / 2\n      };\n    },\n\n    /**\n     * Returns coordinates of a center of canvas.\n     * @return {fabric.Point} \n     */\n    getCenterPoint: function () {\n      return new fabric.Point(this.width / 2, this.height / 2);\n    },\n\n    /**\n     * Centers object horizontally in the canvas\n     * @param {fabric.Object} object Object to center horizontally\n     * @return {fabric.Canvas} thisArg\n     */\n    centerObjectH: function (object) {\n      return this._centerObject(object, new fabric.Point(this.getCenterPoint().x, object.getCenterPoint().y));\n    },\n\n    /**\n     * Centers object vertically in the canvas\n     * @param {fabric.Object} object Object to center vertically\n     * @return {fabric.Canvas} thisArg\n     * @chainable\n     */\n    centerObjectV: function (object) {\n      return this._centerObject(object, new fabric.Point(object.getCenterPoint().x, this.getCenterPoint().y));\n    },\n\n    /**\n     * Centers object vertically and horizontally in the canvas\n     * @param {fabric.Object} object Object to center vertically and horizontally\n     * @return {fabric.Canvas} thisArg\n     * @chainable\n     */\n    centerObject: function(object) {\n      var center = this.getCenterPoint();\n      return this._centerObject(object, center);\n    },\n\n    /**\n     * Centers object vertically and horizontally in the viewport\n     * @param {fabric.Object} object Object to center vertically and horizontally\n     * @return {fabric.Canvas} thisArg\n     * @chainable\n     */\n    viewportCenterObject: function(object) {\n      var vpCenter = this.getVpCenter();\n      return this._centerObject(object, vpCenter);\n    },\n\n    /**\n     * Centers object horizontally in the viewport, object.top is unchanged\n     * @param {fabric.Object} object Object to center vertically and horizontally\n     * @return {fabric.Canvas} thisArg\n     * @chainable\n     */\n    viewportCenterObjectH: function(object) {\n      var vpCenter = this.getVpCenter();\n      this._centerObject(object, new fabric.Point(vpCenter.x, object.getCenterPoint().y));\n      return this;\n    },\n\n    /**\n     * Centers object Vertically in the viewport, object.top is unchanged\n     * @param {fabric.Object} object Object to center vertically and horizontally\n     * @return {fabric.Canvas} thisArg\n     * @chainable\n     */\n    viewportCenterObjectV: function(object) {\n      var vpCenter = this.getVpCenter();\n\n      return this._centerObject(object, new fabric.Point(object.getCenterPoint().x, vpCenter.y));\n    },\n\n    /**\n     * Calculate the point in canvas that correspond to the center of actual viewport.\n     * @return {fabric.Point} vpCenter, viewport center\n     * @chainable\n     */\n    getVpCenter: function() {\n      var center = this.getCenterPoint(),\n          iVpt = invertTransform(this.viewportTransform);\n      return transformPoint(center, iVpt);\n    },\n\n    /**\n     * @private\n     * @param {fabric.Object} object Object to center\n     * @param {fabric.Point} center Center point\n     * @return {fabric.Canvas} thisArg\n     * @chainable\n     */\n    _centerObject: function(object, center) {\n      object.setPositionByOrigin(center, 'center', 'center');\n      object.setCoords();\n      this.renderOnAddRemove && this.requestRenderAll();\n      return this;\n    },\n\n    /**\n     * Returns dataless JSON representation of canvas\n     * @param {Array} [propertiesToInclude] Any properties that you might want to additionally include in the output\n     * @return {String} json string\n     */\n    toDatalessJSON: function (propertiesToInclude) {\n      return this.toDatalessObject(propertiesToInclude);\n    },\n\n    /**\n     * Returns object representation of canvas\n     * @param {Array} [propertiesToInclude] Any properties that you might want to additionally include in the output\n     * @return {Object} object representation of an instance\n     */\n    toObject: function (propertiesToInclude) {\n      return this._toObjectMethod('toObject', propertiesToInclude);\n    },\n\n    /**\n     * Returns dataless object representation of canvas\n     * @param {Array} [propertiesToInclude] Any properties that you might want to additionally include in the output\n     * @return {Object} object representation of an instance\n     */\n    toDatalessObject: function (propertiesToInclude) {\n      return this._toObjectMethod('toDatalessObject', propertiesToInclude);\n    },\n\n    /**\n     * @private\n     */\n    _toObjectMethod: function (methodName, propertiesToInclude) {\n\n      var clipPath = this.clipPath, data = {\n        version: fabric.version,\n        objects: this._toObjects(methodName, propertiesToInclude),\n      };\n      if (clipPath && !clipPath.excludeFromExport) {\n        data.clipPath = this._toObject(this.clipPath, methodName, propertiesToInclude);\n      }\n      extend(data, this.__serializeBgOverlay(methodName, propertiesToInclude));\n\n      fabric.util.populateWithProperties(this, data, propertiesToInclude);\n\n      return data;\n    },\n\n    /**\n     * @private\n     */\n    _toObjects: function(methodName, propertiesToInclude) {\n      return this._objects.filter(function(object) {\n        return !object.excludeFromExport;\n      }).map(function(instance) {\n        return this._toObject(instance, methodName, propertiesToInclude);\n      }, this);\n    },\n\n    /**\n     * @private\n     */\n    _toObject: function(instance, methodName, propertiesToInclude) {\n      var originalValue;\n\n      if (!this.includeDefaultValues) {\n        originalValue = instance.includeDefaultValues;\n        instance.includeDefaultValues = false;\n      }\n\n      var object = instance[methodName](propertiesToInclude);\n      if (!this.includeDefaultValues) {\n        instance.includeDefaultValues = originalValue;\n      }\n      return object;\n    },\n\n    /**\n     * @private\n     */\n    __serializeBgOverlay: function(methodName, propertiesToInclude) {\n      var data = {}, bgImage = this.backgroundImage, overlayImage = this.overlayImage,\n          bgColor = this.backgroundColor, overlayColor = this.overlayColor;\n\n      if (bgColor && bgColor.toObject) {\n        if (!bgColor.excludeFromExport) {\n          data.background = bgColor.toObject(propertiesToInclude);\n        }\n      }\n      else if (bgColor) {\n        data.background = bgColor;\n      }\n\n      if (overlayColor && overlayColor.toObject) {\n        if (!overlayColor.excludeFromExport) {\n          data.overlay = overlayColor.toObject(propertiesToInclude);\n        }\n      }\n      else if (overlayColor) {\n        data.overlay = overlayColor;\n      }\n\n      if (bgImage && !bgImage.excludeFromExport) {\n        data.backgroundImage = this._toObject(bgImage, methodName, propertiesToInclude);\n      }\n      if (overlayImage && !overlayImage.excludeFromExport) {\n        data.overlayImage = this._toObject(overlayImage, methodName, propertiesToInclude);\n      }\n\n      return data;\n    },\n\n    /* _TO_SVG_START_ */\n    /**\n     * When true, getSvgTransform() will apply the StaticCanvas.viewportTransform to the SVG transformation. When true,\n     * a zoomed canvas will then produce zoomed SVG output.\n     * @type Boolean\n     * @default\n     */\n    svgViewportTransformation: true,\n\n    /**\n     * Returns SVG representation of canvas\n     * @function\n     * @param {Object} [options] Options object for SVG output\n     * @param {Boolean} [options.suppressPreamble=false] If true xml tag is not included\n     * @param {Object} [options.viewBox] SVG viewbox object\n     * @param {Number} [options.viewBox.x] x-coordinate of viewbox\n     * @param {Number} [options.viewBox.y] y-coordinate of viewbox\n     * @param {Number} [options.viewBox.width] Width of viewbox\n     * @param {Number} [options.viewBox.height] Height of viewbox\n     * @param {String} [options.encoding=UTF-8] Encoding of SVG output\n     * @param {String} [options.width] desired width of svg with or without units\n     * @param {String} [options.height] desired height of svg with or without units\n     * @param {Function} [reviver] Method for further parsing of svg elements, called after each fabric object converted into svg representation.\n     * @return {String} SVG string\n     * @tutorial {@link http://fabricjs.com/fabric-intro-part-3#serialization}\n     * @see {@link http://jsfiddle.net/fabricjs/jQ3ZZ/|jsFiddle demo}\n     * @example <caption>Normal SVG output</caption>\n     * var svg = canvas.toSVG();\n     * @example <caption>SVG output without preamble (without &lt;?xml ../>)</caption>\n     * var svg = canvas.toSVG({suppressPreamble: true});\n     * @example <caption>SVG output with viewBox attribute</caption>\n     * var svg = canvas.toSVG({\n     *   viewBox: {\n     *     x: 100,\n     *     y: 100,\n     *     width: 200,\n     *     height: 300\n     *   }\n     * });\n     * @example <caption>SVG output with different encoding (default: UTF-8)</caption>\n     * var svg = canvas.toSVG({encoding: 'ISO-8859-1'});\n     * @example <caption>Modify SVG output with reviver function</caption>\n     * var svg = canvas.toSVG(null, function(svg) {\n     *   return svg.replace('stroke-dasharray: ; stroke-linecap: butt; stroke-linejoin: miter; stroke-miterlimit: 10; ', '');\n     * });\n     */\n    toSVG: function(options, reviver) {\n      options || (options = { });\n      options.reviver = reviver;\n      var markup = [];\n\n      this._setSVGPreamble(markup, options);\n      this._setSVGHeader(markup, options);\n      if (this.clipPath) {\n        markup.push('<g clip-path=\"url(#' + this.clipPath.clipPathId + ')\" >\\n');\n      }\n      this._setSVGBgOverlayColor(markup, 'background');\n      this._setSVGBgOverlayImage(markup, 'backgroundImage', reviver);\n      this._setSVGObjects(markup, reviver);\n      if (this.clipPath) {\n        markup.push('</g>\\n');\n      }\n      this._setSVGBgOverlayColor(markup, 'overlay');\n      this._setSVGBgOverlayImage(markup, 'overlayImage', reviver);\n\n      markup.push('</svg>');\n\n      return markup.join('');\n    },\n\n    /**\n     * @private\n     */\n    _setSVGPreamble: function(markup, options) {\n      if (options.suppressPreamble) {\n        return;\n      }\n      markup.push(\n        '<?xml version=\"1.0\" encoding=\"', (options.encoding || 'UTF-8'), '\" standalone=\"no\" ?>\\n',\n        '<!DOCTYPE svg PUBLIC \"-//W3C//DTD SVG 1.1//EN\" ',\n        '\"http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd\">\\n'\n      );\n    },\n\n    /**\n     * @private\n     */\n    _setSVGHeader: function(markup, options) {\n      var width = options.width || this.width,\n          height = options.height || this.height,\n          vpt, viewBox = 'viewBox=\"0 0 ' + this.width + ' ' + this.height + '\" ',\n          NUM_FRACTION_DIGITS = fabric.Object.NUM_FRACTION_DIGITS;\n\n      if (options.viewBox) {\n        viewBox = 'viewBox=\"' +\n                options.viewBox.x + ' ' +\n                options.viewBox.y + ' ' +\n                options.viewBox.width + ' ' +\n                options.viewBox.height + '\" ';\n      }\n      else {\n        if (this.svgViewportTransformation) {\n          vpt = this.viewportTransform;\n          viewBox = 'viewBox=\"' +\n                  toFixed(-vpt[4] / vpt[0], NUM_FRACTION_DIGITS) + ' ' +\n                  toFixed(-vpt[5] / vpt[3], NUM_FRACTION_DIGITS) + ' ' +\n                  toFixed(this.width / vpt[0], NUM_FRACTION_DIGITS) + ' ' +\n                  toFixed(this.height / vpt[3], NUM_FRACTION_DIGITS) + '\" ';\n        }\n      }\n\n      markup.push(\n        '<svg ',\n        'xmlns=\"http://www.w3.org/2000/svg\" ',\n        'xmlns:xlink=\"http://www.w3.org/1999/xlink\" ',\n        'version=\"1.1\" ',\n        'width=\"', width, '\" ',\n        'height=\"', height, '\" ',\n        viewBox,\n        'xml:space=\"preserve\">\\n',\n        '<desc>Created with Fabric.js ', fabric.version, '</desc>\\n',\n        '<defs>\\n',\n        this.createSVGFontFacesMarkup(),\n        this.createSVGRefElementsMarkup(),\n        this.createSVGClipPathMarkup(options),\n        '</defs>\\n'\n      );\n    },\n\n    createSVGClipPathMarkup: function(options) {\n      var clipPath = this.clipPath;\n      if (clipPath) {\n        clipPath.clipPathId = 'CLIPPATH_' + fabric.Object.__uid++;\n        return  '<clipPath id=\"' + clipPath.clipPathId + '\" >\\n' +\n          this.clipPath.toClipPathSVG(options.reviver) +\n          '</clipPath>\\n';\n      }\n      return '';\n    },\n\n    /**\n     * Creates markup containing SVG referenced elements like patterns, gradients etc.\n     * @return {String}\n     */\n    createSVGRefElementsMarkup: function() {\n      var _this = this,\n          markup = ['background', 'overlay'].map(function(prop) {\n            var fill = _this[prop + 'Color'];\n            if (fill && fill.toLive) {\n              var shouldTransform = _this[prop + 'Vpt'], vpt = _this.viewportTransform,\n                  object = {\n                    width: _this.width / (shouldTransform ? vpt[0] : 1),\n                    height: _this.height / (shouldTransform ? vpt[3] : 1)\n                  };\n              return fill.toSVG(\n                object,\n                { additionalTransform: shouldTransform ? fabric.util.matrixToSVG(vpt) : '' }\n              );\n            }\n          });\n      return markup.join('');\n    },\n\n    /**\n     * Creates markup containing SVG font faces,\n     * font URLs for font faces must be collected by developers\n     * and are not extracted from the DOM by fabricjs\n     * @param {Array} objects Array of fabric objects\n     * @return {String}\n     */\n    createSVGFontFacesMarkup: function() {\n      var markup = '', fontList = { }, obj, fontFamily,\n          style, row, rowIndex, _char, charIndex, i, len,\n          fontPaths = fabric.fontPaths, objects = [];\n\n      this._objects.forEach(function add(object) {\n        objects.push(object);\n        if (object._objects) {\n          object._objects.forEach(add);\n        }\n      });\n\n      for (i = 0, len = objects.length; i < len; i++) {\n        obj = objects[i];\n        fontFamily = obj.fontFamily;\n        if (obj.type.indexOf('text') === -1 || fontList[fontFamily] || !fontPaths[fontFamily]) {\n          continue;\n        }\n        fontList[fontFamily] = true;\n        if (!obj.styles) {\n          continue;\n        }\n        style = obj.styles;\n        for (rowIndex in style) {\n          row = style[rowIndex];\n          for (charIndex in row) {\n            _char = row[charIndex];\n            fontFamily = _char.fontFamily;\n            if (!fontList[fontFamily] && fontPaths[fontFamily]) {\n              fontList[fontFamily] = true;\n            }\n          }\n        }\n      }\n\n      for (var j in fontList) {\n        markup += [\n          '\\t\\t@font-face {\\n',\n          '\\t\\t\\tfont-family: \\'', j, '\\';\\n',\n          '\\t\\t\\tsrc: url(\\'', fontPaths[j], '\\');\\n',\n          '\\t\\t}\\n'\n        ].join('');\n      }\n\n      if (markup) {\n        markup = [\n          '\\t<style type=\"text/css\">',\n          '<![CDATA[\\n',\n          markup,\n          ']]>',\n          '</style>\\n'\n        ].join('');\n      }\n\n      return markup;\n    },\n\n    /**\n     * @private\n     */\n    _setSVGObjects: function(markup, reviver) {\n      var instance, i, len, objects = this._objects;\n      for (i = 0, len = objects.length; i < len; i++) {\n        instance = objects[i];\n        if (instance.excludeFromExport) {\n          continue;\n        }\n        this._setSVGObject(markup, instance, reviver);\n      }\n    },\n\n    /**\n     * @private\n     */\n    _setSVGObject: function(markup, instance, reviver) {\n      markup.push(instance.toSVG(reviver));\n    },\n\n    /**\n     * @private\n     */\n    _setSVGBgOverlayImage: function(markup, property, reviver) {\n      if (this[property] && !this[property].excludeFromExport && this[property].toSVG) {\n        markup.push(this[property].toSVG(reviver));\n      }\n    },\n\n    /**\n     * @private\n     */\n    _setSVGBgOverlayColor: function(markup, property) {\n      var filler = this[property + 'Color'], vpt = this.viewportTransform, finalWidth = this.width,\n          finalHeight = this.height;\n      if (!filler) {\n        return;\n      }\n      if (filler.toLive) {\n        var repeat = filler.repeat, iVpt = fabric.util.invertTransform(vpt), shouldInvert = this[property + 'Vpt'],\n            additionalTransform = shouldInvert ? fabric.util.matrixToSVG(iVpt) : '';\n        markup.push(\n          '<rect transform=\"' + additionalTransform + ' translate(', finalWidth / 2, ',', finalHeight / 2, ')\"',\n          ' x=\"', filler.offsetX - finalWidth / 2,\n          '\" y=\"', filler.offsetY - finalHeight / 2, '\" ',\n          'width=\"',\n          (repeat === 'repeat-y' || repeat === 'no-repeat'\n            ? filler.source.width\n            : finalWidth ),\n          '\" height=\"',\n          (repeat === 'repeat-x' || repeat === 'no-repeat'\n            ? filler.source.height\n            : finalHeight),\n          '\" fill=\"url(#SVGID_' + filler.id + ')\"',\n          '></rect>\\n'\n        );\n      }\n      else {\n        markup.push(\n          '<rect x=\"0\" y=\"0\" width=\"100%\" height=\"100%\" ',\n          'fill=\"', filler, '\"',\n          '></rect>\\n'\n        );\n      }\n    },\n    /* _TO_SVG_END_ */\n\n    /**\n     * Moves an object or the objects of a multiple selection\n     * to the bottom of the stack of drawn objects\n     * @param {fabric.Object} object Object to send to back\n     * @return {fabric.Canvas} thisArg\n     * @chainable\n     */\n    sendToBack: function (object) {\n      if (!object) {\n        return this;\n      }\n      var activeSelection = this._activeObject,\n          i, obj, objs;\n      if (object === activeSelection && object.type === 'activeSelection') {\n        objs = activeSelection._objects;\n        for (i = objs.length; i--;) {\n          obj = objs[i];\n          removeFromArray(this._objects, obj);\n          this._objects.unshift(obj);\n        }\n      }\n      else {\n        removeFromArray(this._objects, object);\n        this._objects.unshift(object);\n      }\n      this.renderOnAddRemove && this.requestRenderAll();\n      return this;\n    },\n\n    /**\n     * Moves an object or the objects of a multiple selection\n     * to the top of the stack of drawn objects\n     * @param {fabric.Object} object Object to send\n     * @return {fabric.Canvas} thisArg\n     * @chainable\n     */\n    bringToFront: function (object) {\n      if (!object) {\n        return this;\n      }\n      var activeSelection = this._activeObject,\n          i, obj, objs;\n      if (object === activeSelection && object.type === 'activeSelection') {\n        objs = activeSelection._objects;\n        for (i = 0; i < objs.length; i++) {\n          obj = objs[i];\n          removeFromArray(this._objects, obj);\n          this._objects.push(obj);\n        }\n      }\n      else {\n        removeFromArray(this._objects, object);\n        this._objects.push(object);\n      }\n      this.renderOnAddRemove && this.requestRenderAll();\n      return this;\n    },\n\n    /**\n     * Moves an object or a selection down in stack of drawn objects\n     * An optional parameter, intersecting allows to move the object in behind\n     * the first intersecting object. Where intersection is calculated with\n     * bounding box. If no intersection is found, there will not be change in the\n     * stack.\n     * @param {fabric.Object} object Object to send\n     * @param {Boolean} [intersecting] If `true`, send object behind next lower intersecting object\n     * @return {fabric.Canvas} thisArg\n     * @chainable\n     */\n    sendBackwards: function (object, intersecting) {\n      if (!object) {\n        return this;\n      }\n      var activeSelection = this._activeObject,\n          i, obj, idx, newIdx, objs, objsMoved = 0;\n\n      if (object === activeSelection && object.type === 'activeSelection') {\n        objs = activeSelection._objects;\n        for (i = 0; i < objs.length; i++) {\n          obj = objs[i];\n          idx = this._objects.indexOf(obj);\n          if (idx > 0 + objsMoved) {\n            newIdx = idx - 1;\n            removeFromArray(this._objects, obj);\n            this._objects.splice(newIdx, 0, obj);\n          }\n          objsMoved++;\n        }\n      }\n      else {\n        idx = this._objects.indexOf(object);\n        if (idx !== 0) {\n          // if object is not on the bottom of stack\n          newIdx = this._findNewLowerIndex(object, idx, intersecting);\n          removeFromArray(this._objects, object);\n          this._objects.splice(newIdx, 0, object);\n        }\n      }\n      this.renderOnAddRemove && this.requestRenderAll();\n      return this;\n    },\n\n    /**\n     * @private\n     */\n    _findNewLowerIndex: function(object, idx, intersecting) {\n      var newIdx, i;\n\n      if (intersecting) {\n        newIdx = idx;\n\n        // traverse down the stack looking for the nearest intersecting object\n        for (i = idx - 1; i >= 0; --i) {\n\n          var isIntersecting = object.intersectsWithObject(this._objects[i]) ||\n                               object.isContainedWithinObject(this._objects[i]) ||\n                               this._objects[i].isContainedWithinObject(object);\n\n          if (isIntersecting) {\n            newIdx = i;\n            break;\n          }\n        }\n      }\n      else {\n        newIdx = idx - 1;\n      }\n\n      return newIdx;\n    },\n\n    /**\n     * Moves an object or a selection up in stack of drawn objects\n     * An optional parameter, intersecting allows to move the object in front\n     * of the first intersecting object. Where intersection is calculated with\n     * bounding box. If no intersection is found, there will not be change in the\n     * stack.\n     * @param {fabric.Object} object Object to send\n     * @param {Boolean} [intersecting] If `true`, send object in front of next upper intersecting object\n     * @return {fabric.Canvas} thisArg\n     * @chainable\n     */\n    bringForward: function (object, intersecting) {\n      if (!object) {\n        return this;\n      }\n      var activeSelection = this._activeObject,\n          i, obj, idx, newIdx, objs, objsMoved = 0;\n\n      if (object === activeSelection && object.type === 'activeSelection') {\n        objs = activeSelection._objects;\n        for (i = objs.length; i--;) {\n          obj = objs[i];\n          idx = this._objects.indexOf(obj);\n          if (idx < this._objects.length - 1 - objsMoved) {\n            newIdx = idx + 1;\n            removeFromArray(this._objects, obj);\n            this._objects.splice(newIdx, 0, obj);\n          }\n          objsMoved++;\n        }\n      }\n      else {\n        idx = this._objects.indexOf(object);\n        if (idx !== this._objects.length - 1) {\n          // if object is not on top of stack (last item in an array)\n          newIdx = this._findNewUpperIndex(object, idx, intersecting);\n          removeFromArray(this._objects, object);\n          this._objects.splice(newIdx, 0, object);\n        }\n      }\n      this.renderOnAddRemove && this.requestRenderAll();\n      return this;\n    },\n\n    /**\n     * @private\n     */\n    _findNewUpperIndex: function(object, idx, intersecting) {\n      var newIdx, i, len;\n\n      if (intersecting) {\n        newIdx = idx;\n\n        // traverse up the stack looking for the nearest intersecting object\n        for (i = idx + 1, len = this._objects.length; i < len; ++i) {\n\n          var isIntersecting = object.intersectsWithObject(this._objects[i]) ||\n                               object.isContainedWithinObject(this._objects[i]) ||\n                               this._objects[i].isContainedWithinObject(object);\n\n          if (isIntersecting) {\n            newIdx = i;\n            break;\n          }\n        }\n      }\n      else {\n        newIdx = idx + 1;\n      }\n\n      return newIdx;\n    },\n\n    /**\n     * Moves an object to specified level in stack of drawn objects\n     * @param {fabric.Object} object Object to send\n     * @param {Number} index Position to move to\n     * @return {fabric.Canvas} thisArg\n     * @chainable\n     */\n    moveTo: function (object, index) {\n      removeFromArray(this._objects, object);\n      this._objects.splice(index, 0, object);\n      return this.renderOnAddRemove && this.requestRenderAll();\n    },\n\n    /**\n     * Clears a canvas element and dispose objects\n     * @return {fabric.Canvas} thisArg\n     * @chainable\n     */\n    dispose: function () {\n      // cancel eventually ongoing renders\n      if (this.isRendering) {\n        fabric.util.cancelAnimFrame(this.isRendering);\n        this.isRendering = 0;\n      }\n      this.forEachObject(function(object) {\n        object.dispose && object.dispose();\n      });\n      this._objects = [];\n      if (this.backgroundImage && this.backgroundImage.dispose) {\n        this.backgroundImage.dispose();\n      }\n      this.backgroundImage = null;\n      if (this.overlayImage && this.overlayImage.dispose) {\n        this.overlayImage.dispose();\n      }\n      this.overlayImage = null;\n      this._iTextInstances = null;\n      this.contextContainer = null;\n      // restore canvas style\n      this.lowerCanvasEl.classList.remove('lower-canvas');\n      fabric.util.setStyle(this.lowerCanvasEl, this._originalCanvasStyle);\n      delete this._originalCanvasStyle;\n      // restore canvas size to original size in case retina scaling was applied\n      this.lowerCanvasEl.setAttribute('width', this.width);\n      this.lowerCanvasEl.setAttribute('height', this.height);\n      fabric.util.cleanUpJsdomNode(this.lowerCanvasEl);\n      this.lowerCanvasEl = undefined;\n      return this;\n    },\n\n    /**\n     * Returns a string representation of an instance\n     * @return {String} string representation of an instance\n     */\n    toString: function () {\n      return '#<fabric.Canvas (' + this.complexity() + '): ' +\n               '{ objects: ' + this._objects.length + ' }>';\n    }\n  });\n\n  extend(fabric.StaticCanvas.prototype, fabric.Observable);\n  extend(fabric.StaticCanvas.prototype, fabric.Collection);\n  extend(fabric.StaticCanvas.prototype, fabric.DataURLExporter);\n\n  extend(fabric.StaticCanvas, /** @lends fabric.StaticCanvas */ {\n\n    /**\n     * @static\n     * @type String\n     * @default\n     */\n    EMPTY_JSON: '{\"objects\": [], \"background\": \"white\"}',\n\n    /**\n     * Provides a way to check support of some of the canvas methods\n     * (either those of HTMLCanvasElement itself, or rendering context)\n     *\n     * @param {String} methodName Method to check support for;\n     *                            Could be one of \"setLineDash\"\n     * @return {Boolean | null} `true` if method is supported (or at least exists),\n     *                          `null` if canvas element or context can not be initialized\n     */\n    supports: function (methodName) {\n      var el = createCanvasElement();\n\n      if (!el || !el.getContext) {\n        return null;\n      }\n\n      var ctx = el.getContext('2d');\n      if (!ctx) {\n        return null;\n      }\n\n      switch (methodName) {\n\n        case 'setLineDash':\n          return typeof ctx.setLineDash !== 'undefined';\n\n        default:\n          return null;\n      }\n    }\n  });\n\n  /**\n   * Returns Object representation of canvas\n   * this alias is provided because if you call JSON.stringify on an instance,\n   * the toJSON object will be invoked if it exists.\n   * Having a toJSON method means you can do JSON.stringify(myCanvas)\n   * @function\n   * @param {Array} [propertiesToInclude] Any properties that you might want to additionally include in the output\n   * @return {Object} JSON compatible object\n   * @tutorial {@link http://fabricjs.com/fabric-intro-part-3#serialization}\n   * @see {@link http://jsfiddle.net/fabricjs/pec86/|jsFiddle demo}\n   * @example <caption>JSON without additional properties</caption>\n   * var json = canvas.toJSON();\n   * @example <caption>JSON with additional properties included</caption>\n   * var json = canvas.toJSON(['lockMovementX', 'lockMovementY', 'lockRotation', 'lockScalingX', 'lockScalingY']);\n   * @example <caption>JSON without default values</caption>\n   * canvas.includeDefaultValues = false;\n   * var json = canvas.toJSON();\n   */\n  fabric.StaticCanvas.prototype.toJSON = fabric.StaticCanvas.prototype.toObject;\n\n  if (fabric.isLikelyNode) {\n    fabric.StaticCanvas.prototype.createPNGStream = function() {\n      var impl = getNodeCanvas(this.lowerCanvasEl);\n      return impl && impl.createPNGStream();\n    };\n    fabric.StaticCanvas.prototype.createJPEGStream = function(opts) {\n      var impl = getNodeCanvas(this.lowerCanvasEl);\n      return impl && impl.createJPEGStream(opts);\n    };\n  }\n})();\n\n\n/**\n * BaseBrush class\n * @class fabric.BaseBrush\n * @see {@link http://fabricjs.com/freedrawing|Freedrawing demo}\n */\nfabric.BaseBrush = fabric.util.createClass(/** @lends fabric.BaseBrush.prototype */ {\n\n  /**\n   * Color of a brush\n   * @type String\n   * @default\n   */\n  color: 'rgb(0, 0, 0)',\n\n  /**\n   * Width of a brush, has to be a Number, no string literals\n   * @type Number\n   * @default\n   */\n  width: 1,\n\n  /**\n   * Shadow object representing shadow of this shape.\n   * <b>Backwards incompatibility note:</b> This property replaces \"shadowColor\" (String), \"shadowOffsetX\" (Number),\n   * \"shadowOffsetY\" (Number) and \"shadowBlur\" (Number) since v1.2.12\n   * @type fabric.Shadow\n   * @default\n   */\n  shadow: null,\n\n  /**\n   * Line endings style of a brush (one of \"butt\", \"round\", \"square\")\n   * @type String\n   * @default\n   */\n  strokeLineCap: 'round',\n\n  /**\n   * Corner style of a brush (one of \"bevel\", \"round\", \"miter\")\n   * @type String\n   * @default\n   */\n  strokeLineJoin: 'round',\n\n  /**\n   * Maximum miter length (used for strokeLineJoin = \"miter\") of a brush's\n   * @type Number\n   * @default\n   */\n  strokeMiterLimit:         10,\n\n  /**\n   * Stroke Dash Array.\n   * @type Array\n   * @default\n   */\n  strokeDashArray: null,\n\n  /**\n   * When `true`, the free drawing is limited to the whiteboard size. Default to false.\n   * @type Boolean\n   * @default false\n  */\n\n  limitedToCanvasSize: false,\n\n\n  /**\n   * Sets brush styles\n   * @private\n   * @param {CanvasRenderingContext2D} ctx\n   */\n  _setBrushStyles: function (ctx) {\n    ctx.strokeStyle = this.color;\n    ctx.lineWidth = this.width;\n    ctx.lineCap = this.strokeLineCap;\n    ctx.miterLimit = this.strokeMiterLimit;\n    ctx.lineJoin = this.strokeLineJoin;\n    ctx.setLineDash(this.strokeDashArray || []);\n  },\n\n  /**\n   * Sets the transformation on given context\n   * @param {RenderingContext2d} ctx context to render on\n   * @private\n   */\n  _saveAndTransform: function(ctx) {\n    var v = this.canvas.viewportTransform;\n    ctx.save();\n    ctx.transform(v[0], v[1], v[2], v[3], v[4], v[5]);\n  },\n\n  /**\n   * Sets brush shadow styles\n   * @private\n   */\n  _setShadow: function() {\n    if (!this.shadow) {\n      return;\n    }\n\n    var canvas = this.canvas,\n        shadow = this.shadow,\n        ctx = canvas.contextTop,\n        zoom = canvas.getZoom();\n    if (canvas && canvas._isRetinaScaling()) {\n      zoom *= fabric.devicePixelRatio;\n    }\n\n    ctx.shadowColor = shadow.color;\n    ctx.shadowBlur = shadow.blur * zoom;\n    ctx.shadowOffsetX = shadow.offsetX * zoom;\n    ctx.shadowOffsetY = shadow.offsetY * zoom;\n  },\n\n  needsFullRender: function() {\n    var color = new fabric.Color(this.color);\n    return color.getAlpha() < 1 || !!this.shadow;\n  },\n\n  /**\n   * Removes brush shadow styles\n   * @private\n   */\n  _resetShadow: function() {\n    var ctx = this.canvas.contextTop;\n\n    ctx.shadowColor = '';\n    ctx.shadowBlur = ctx.shadowOffsetX = ctx.shadowOffsetY = 0;\n  },\n\n  /**\n   * Check is pointer is outside canvas boundaries\n   * @param {Object} pointer\n   * @private\n  */\n  _isOutSideCanvas: function(pointer) {\n    return pointer.x < 0 || pointer.x > this.canvas.getWidth() || pointer.y < 0 || pointer.y > this.canvas.getHeight();\n  }\n});\n\n\n(function() {\n  /**\n   * PencilBrush class\n   * @class fabric.PencilBrush\n   * @extends fabric.BaseBrush\n   */\n  fabric.PencilBrush = fabric.util.createClass(fabric.BaseBrush, /** @lends fabric.PencilBrush.prototype */ {\n\n    /**\n     * Discard points that are less than `decimate` pixel distant from each other\n     * @type Number\n     * @default 0.4\n     */\n    decimate: 0.4,\n\n    /**\n     * Draws a straight line between last recorded point to current pointer\n     * Used for `shift` functionality\n     *\n     * @type boolean\n     * @default false\n     */\n    drawStraightLine: false,\n\n    /**\n     * The event modifier key that makes the brush draw a straight line.\n     * If `null` or 'none' or any other string that is not a modifier key the feature is disabled.\n     * @type {'altKey' | 'shiftKey' | 'ctrlKey' | 'none' | undefined | null}\n     */\n    straightLineKey: 'shiftKey',\n\n    /**\n     * Constructor\n     * @param {fabric.Canvas} canvas\n     * @return {fabric.PencilBrush} Instance of a pencil brush\n     */\n    initialize: function(canvas) {\n      this.canvas = canvas;\n      this._points = [];\n    },\n\n    needsFullRender: function () {\n      return this.callSuper('needsFullRender') || this._hasStraightLine;\n    },\n\n    /**\n     * Invoked inside on mouse down and mouse move\n     * @param {Object} pointer\n     */\n    _drawSegment: function (ctx, p1, p2) {\n      var midPoint = p1.midPointFrom(p2);\n      ctx.quadraticCurveTo(p1.x, p1.y, midPoint.x, midPoint.y);\n      return midPoint;\n    },\n\n    /**\n     * Invoked on mouse down\n     * @param {Object} pointer\n     */\n    onMouseDown: function(pointer, options) {\n      if (!this.canvas._isMainEvent(options.e)) {\n        return;\n      }\n      this.drawStraightLine = options.e[this.straightLineKey];\n      this._prepareForDrawing(pointer);\n      // capture coordinates immediately\n      // this allows to draw dots (when movement never occurs)\n      this._captureDrawingPath(pointer);\n      this._render();\n    },\n\n    /**\n     * Invoked on mouse move\n     * @param {Object} pointer\n     */\n    onMouseMove: function(pointer, options) {\n      if (!this.canvas._isMainEvent(options.e)) {\n        return;\n      }\n      this.drawStraightLine = options.e[this.straightLineKey];\n      if (this.limitedToCanvasSize === true && this._isOutSideCanvas(pointer)) {\n        return;\n      }\n      if (this._captureDrawingPath(pointer) && this._points.length > 1) {\n        if (this.needsFullRender()) {\n          // redraw curve\n          // clear top canvas\n          this.canvas.clearContext(this.canvas.contextTop);\n          this._render();\n        }\n        else {\n          var points = this._points, length = points.length, ctx = this.canvas.contextTop;\n          // draw the curve update\n          this._saveAndTransform(ctx);\n          if (this.oldEnd) {\n            ctx.beginPath();\n            ctx.moveTo(this.oldEnd.x, this.oldEnd.y);\n          }\n          this.oldEnd = this._drawSegment(ctx, points[length - 2], points[length - 1], true);\n          ctx.stroke();\n          ctx.restore();\n        }\n      }\n    },\n\n    /**\n     * Invoked on mouse up\n     */\n    onMouseUp: function(options) {\n      if (!this.canvas._isMainEvent(options.e)) {\n        return true;\n      }\n      this.drawStraightLine = false;\n      this.oldEnd = undefined;\n      this._finalizeAndAddPath();\n      return false;\n    },\n\n    /**\n     * @private\n     * @param {Object} pointer Actual mouse position related to the canvas.\n     */\n    _prepareForDrawing: function(pointer) {\n\n      var p = new fabric.Point(pointer.x, pointer.y);\n\n      this._reset();\n      this._addPoint(p);\n      this.canvas.contextTop.moveTo(p.x, p.y);\n    },\n\n    /**\n     * @private\n     * @param {fabric.Point} point Point to be added to points array\n     */\n    _addPoint: function(point) {\n      if (this._points.length > 1 && point.eq(this._points[this._points.length - 1])) {\n        return false;\n      }\n      if (this.drawStraightLine && this._points.length > 1) {\n        this._hasStraightLine = true;\n        this._points.pop();\n      }\n      this._points.push(point);\n      return true;\n    },\n\n    /**\n     * Clear points array and set contextTop canvas style.\n     * @private\n     */\n    _reset: function() {\n      this._points = [];\n      this._setBrushStyles(this.canvas.contextTop);\n      this._setShadow();\n      this._hasStraightLine = false;\n    },\n\n    /**\n     * @private\n     * @param {Object} pointer Actual mouse position related to the canvas.\n     */\n    _captureDrawingPath: function(pointer) {\n      var pointerPoint = new fabric.Point(pointer.x, pointer.y);\n      return this._addPoint(pointerPoint);\n    },\n\n    /**\n     * Draw a smooth path on the topCanvas using quadraticCurveTo\n     * @private\n     * @param {CanvasRenderingContext2D} [ctx]\n     */\n    _render: function(ctx) {\n      var i, len,\n          p1 = this._points[0],\n          p2 = this._points[1];\n      ctx = ctx || this.canvas.contextTop;\n      this._saveAndTransform(ctx);\n      ctx.beginPath();\n      //if we only have 2 points in the path and they are the same\n      //it means that the user only clicked the canvas without moving the mouse\n      //then we should be drawing a dot. A path isn't drawn between two identical dots\n      //that's why we set them apart a bit\n      if (this._points.length === 2 && p1.x === p2.x && p1.y === p2.y) {\n        var width = this.width / 1000;\n        p1 = new fabric.Point(p1.x, p1.y);\n        p2 = new fabric.Point(p2.x, p2.y);\n        p1.x -= width;\n        p2.x += width;\n      }\n      ctx.moveTo(p1.x, p1.y);\n\n      for (i = 1, len = this._points.length; i < len; i++) {\n        // we pick the point between pi + 1 & pi + 2 as the\n        // end point and p1 as our control point.\n        this._drawSegment(ctx, p1, p2);\n        p1 = this._points[i];\n        p2 = this._points[i + 1];\n      }\n      // Draw last line as a straight line while\n      // we wait for the next point to be able to calculate\n      // the bezier control point\n      ctx.lineTo(p1.x, p1.y);\n      ctx.stroke();\n      ctx.restore();\n    },\n\n    /**\n     * Converts points to SVG path\n     * @param {Array} points Array of points\n     * @return {(string|number)[][]} SVG path commands\n     */\n    convertPointsToSVGPath: function (points) {\n      var correction = this.width / 1000;\n      return fabric.util.getSmoothPathFromPoints(points, correction);\n    },\n\n    /**\n     * @private\n     * @param {(string|number)[][]} pathData SVG path commands\n     * @returns {boolean}\n     */\n    _isEmptySVGPath: function (pathData) {\n      var pathString = fabric.util.joinPath(pathData);\n      return pathString === 'M 0 0 Q 0 0 0 0 L 0 0';\n    },\n\n    /**\n     * Creates fabric.Path object to add on canvas\n     * @param {(string|number)[][]} pathData Path data\n     * @return {fabric.Path} Path to add on canvas\n     */\n    createPath: function(pathData) {\n      var path = new fabric.Path(pathData, {\n        fill: null,\n        stroke: this.color,\n        strokeWidth: this.width,\n        strokeLineCap: this.strokeLineCap,\n        strokeMiterLimit: this.strokeMiterLimit,\n        strokeLineJoin: this.strokeLineJoin,\n        strokeDashArray: this.strokeDashArray,\n      });\n      if (this.shadow) {\n        this.shadow.affectStroke = true;\n        path.shadow = new fabric.Shadow(this.shadow);\n      }\n\n      return path;\n    },\n\n    /**\n     * Decimate points array with the decimate value\n     */\n    decimatePoints: function(points, distance) {\n      if (points.length <= 2) {\n        return points;\n      }\n      var zoom = this.canvas.getZoom(), adjustedDistance = Math.pow(distance / zoom, 2),\n          i, l = points.length - 1, lastPoint = points[0], newPoints = [lastPoint],\n          cDistance;\n      for (i = 1; i < l - 1; i++) {\n        cDistance = Math.pow(lastPoint.x - points[i].x, 2) + Math.pow(lastPoint.y - points[i].y, 2);\n        if (cDistance >= adjustedDistance) {\n          lastPoint = points[i];\n          newPoints.push(lastPoint);\n        }\n      }\n      /**\n       * Add the last point from the original line to the end of the array.\n       * This ensures decimate doesn't delete the last point on the line, and ensures the line is > 1 point.\n       */\n      newPoints.push(points[l]);\n      return newPoints;\n    },\n\n    /**\n     * On mouseup after drawing the path on contextTop canvas\n     * we use the points captured to create an new fabric path object\n     * and add it to the fabric canvas.\n     */\n    _finalizeAndAddPath: function() {\n      var ctx = this.canvas.contextTop;\n      ctx.closePath();\n      if (this.decimate) {\n        this._points = this.decimatePoints(this._points, this.decimate);\n      }\n      var pathData = this.convertPointsToSVGPath(this._points);\n      if (this._isEmptySVGPath(pathData)) {\n        // do not create 0 width/height paths, as they are\n        // rendered inconsistently across browsers\n        // Firefox 4, for example, renders a dot,\n        // whereas Chrome 10 renders nothing\n        this.canvas.requestRenderAll();\n        return;\n      }\n\n      var path = this.createPath(pathData);\n      this.canvas.clearContext(this.canvas.contextTop);\n      this.canvas.fire('before:path:created', { path: path });\n      this.canvas.add(path);\n      this.canvas.requestRenderAll();\n      path.setCoords();\n      this._resetShadow();\n\n\n      // fire event 'path' created\n      this.canvas.fire('path:created', { path: path });\n    }\n  });\n})();\n\n\n/**\n * CircleBrush class\n * @class fabric.CircleBrush\n */\nfabric.CircleBrush = fabric.util.createClass(fabric.BaseBrush, /** @lends fabric.CircleBrush.prototype */ {\n\n  /**\n   * Width of a brush\n   * @type Number\n   * @default\n   */\n  width: 10,\n\n  /**\n   * Constructor\n   * @param {fabric.Canvas} canvas\n   * @return {fabric.CircleBrush} Instance of a circle brush\n   */\n  initialize: function(canvas) {\n    this.canvas = canvas;\n    this.points = [];\n  },\n\n  /**\n   * Invoked inside on mouse down and mouse move\n   * @param {Object} pointer\n   */\n  drawDot: function(pointer) {\n    var point = this.addPoint(pointer),\n        ctx = this.canvas.contextTop;\n    this._saveAndTransform(ctx);\n    this.dot(ctx, point);\n    ctx.restore();\n  },\n\n  dot: function(ctx, point) {\n    ctx.fillStyle = point.fill;\n    ctx.beginPath();\n    ctx.arc(point.x, point.y, point.radius, 0, Math.PI * 2, false);\n    ctx.closePath();\n    ctx.fill();\n  },\n\n  /**\n   * Invoked on mouse down\n   */\n  onMouseDown: function(pointer) {\n    this.points.length = 0;\n    this.canvas.clearContext(this.canvas.contextTop);\n    this._setShadow();\n    this.drawDot(pointer);\n  },\n\n  /**\n   * Render the full state of the brush\n   * @private\n   */\n  _render: function() {\n    var ctx  = this.canvas.contextTop, i, len,\n        points = this.points;\n    this._saveAndTransform(ctx);\n    for (i = 0, len = points.length; i < len; i++) {\n      this.dot(ctx, points[i]);\n    }\n    ctx.restore();\n  },\n\n  /**\n   * Invoked on mouse move\n   * @param {Object} pointer\n   */\n  onMouseMove: function(pointer) {\n    if (this.limitedToCanvasSize === true && this._isOutSideCanvas(pointer)) {\n      return;\n    }\n    if (this.needsFullRender()) {\n      this.canvas.clearContext(this.canvas.contextTop);\n      this.addPoint(pointer);\n      this._render();\n    }\n    else {\n      this.drawDot(pointer);\n    }\n  },\n\n  /**\n   * Invoked on mouse up\n   */\n  onMouseUp: function() {\n    var originalRenderOnAddRemove = this.canvas.renderOnAddRemove, i, len;\n    this.canvas.renderOnAddRemove = false;\n\n    var circles = [];\n\n    for (i = 0, len = this.points.length; i < len; i++) {\n      var point = this.points[i],\n          circle = new fabric.Circle({\n            radius: point.radius,\n            left: point.x,\n            top: point.y,\n            originX: 'center',\n            originY: 'center',\n            fill: point.fill\n          });\n\n      this.shadow && (circle.shadow = new fabric.Shadow(this.shadow));\n\n      circles.push(circle);\n    }\n    var group = new fabric.Group(circles);\n    group.canvas = this.canvas;\n\n    this.canvas.fire('before:path:created', { path: group });\n    this.canvas.add(group);\n    this.canvas.fire('path:created', { path: group });\n\n    this.canvas.clearContext(this.canvas.contextTop);\n    this._resetShadow();\n    this.canvas.renderOnAddRemove = originalRenderOnAddRemove;\n    this.canvas.requestRenderAll();\n  },\n\n  /**\n   * @param {Object} pointer\n   * @return {fabric.Point} Just added pointer point\n   */\n  addPoint: function(pointer) {\n    var pointerPoint = new fabric.Point(pointer.x, pointer.y),\n\n        circleRadius = fabric.util.getRandomInt(\n          Math.max(0, this.width - 20), this.width + 20) / 2,\n\n        circleColor = new fabric.Color(this.color)\n          .setAlpha(fabric.util.getRandomInt(0, 100) / 100)\n          .toRgba();\n\n    pointerPoint.radius = circleRadius;\n    pointerPoint.fill = circleColor;\n\n    this.points.push(pointerPoint);\n\n    return pointerPoint;\n  }\n});\n\n\n/**\n * SprayBrush class\n * @class fabric.SprayBrush\n */\nfabric.SprayBrush = fabric.util.createClass( fabric.BaseBrush, /** @lends fabric.SprayBrush.prototype */ {\n\n  /**\n   * Width of a spray\n   * @type Number\n   * @default\n   */\n  width:              10,\n\n  /**\n   * Density of a spray (number of dots per chunk)\n   * @type Number\n   * @default\n   */\n  density:            20,\n\n  /**\n   * Width of spray dots\n   * @type Number\n   * @default\n   */\n  dotWidth:           1,\n\n  /**\n   * Width variance of spray dots\n   * @type Number\n   * @default\n   */\n  dotWidthVariance:   1,\n\n  /**\n   * Whether opacity of a dot should be random\n   * @type Boolean\n   * @default\n   */\n  randomOpacity:        false,\n\n  /**\n   * Whether overlapping dots (rectangles) should be removed (for performance reasons)\n   * @type Boolean\n   * @default\n   */\n  optimizeOverlapping:  true,\n\n  /**\n   * Constructor\n   * @param {fabric.Canvas} canvas\n   * @return {fabric.SprayBrush} Instance of a spray brush\n   */\n  initialize: function(canvas) {\n    this.canvas = canvas;\n    this.sprayChunks = [];\n  },\n\n  /**\n   * Invoked on mouse down\n   * @param {Object} pointer\n   */\n  onMouseDown: function(pointer) {\n    this.sprayChunks.length = 0;\n    this.canvas.clearContext(this.canvas.contextTop);\n    this._setShadow();\n\n    this.addSprayChunk(pointer);\n    this.render(this.sprayChunkPoints);\n  },\n\n  /**\n   * Invoked on mouse move\n   * @param {Object} pointer\n   */\n  onMouseMove: function(pointer) {\n    if (this.limitedToCanvasSize === true && this._isOutSideCanvas(pointer)) {\n      return;\n    }\n    this.addSprayChunk(pointer);\n    this.render(this.sprayChunkPoints);\n  },\n\n  /**\n   * Invoked on mouse up\n   */\n  onMouseUp: function() {\n    var originalRenderOnAddRemove = this.canvas.renderOnAddRemove;\n    this.canvas.renderOnAddRemove = false;\n\n    var rects = [];\n\n    for (var i = 0, ilen = this.sprayChunks.length; i < ilen; i++) {\n      var sprayChunk = this.sprayChunks[i];\n\n      for (var j = 0, jlen = sprayChunk.length; j < jlen; j++) {\n\n        var rect = new fabric.Rect({\n          width: sprayChunk[j].width,\n          height: sprayChunk[j].width,\n          left: sprayChunk[j].x + 1,\n          top: sprayChunk[j].y + 1,\n          originX: 'center',\n          originY: 'center',\n          fill: this.color\n        });\n        rects.push(rect);\n      }\n    }\n\n    if (this.optimizeOverlapping) {\n      rects = this._getOptimizedRects(rects);\n    }\n\n    var group = new fabric.Group(rects);\n    this.shadow && group.set('shadow', new fabric.Shadow(this.shadow));\n    this.canvas.fire('before:path:created', { path: group });\n    this.canvas.add(group);\n    this.canvas.fire('path:created', { path: group });\n\n    this.canvas.clearContext(this.canvas.contextTop);\n    this._resetShadow();\n    this.canvas.renderOnAddRemove = originalRenderOnAddRemove;\n    this.canvas.requestRenderAll();\n  },\n\n  /**\n   * @private\n   * @param {Array} rects\n   */\n  _getOptimizedRects: function(rects) {\n\n    // avoid creating duplicate rects at the same coordinates\n    var uniqueRects = { }, key, i, len;\n\n    for (i = 0, len = rects.length; i < len; i++) {\n      key = rects[i].left + '' + rects[i].top;\n      if (!uniqueRects[key]) {\n        uniqueRects[key] = rects[i];\n      }\n    }\n    var uniqueRectsArray = [];\n    for (key in uniqueRects) {\n      uniqueRectsArray.push(uniqueRects[key]);\n    }\n\n    return uniqueRectsArray;\n  },\n\n  /**\n   * Render new chunk of spray brush\n   */\n  render: function(sprayChunk) {\n    var ctx = this.canvas.contextTop, i, len;\n    ctx.fillStyle = this.color;\n\n    this._saveAndTransform(ctx);\n\n    for (i = 0, len = sprayChunk.length; i < len; i++) {\n      var point = sprayChunk[i];\n      if (typeof point.opacity !== 'undefined') {\n        ctx.globalAlpha = point.opacity;\n      }\n      ctx.fillRect(point.x, point.y, point.width, point.width);\n    }\n    ctx.restore();\n  },\n\n  /**\n   * Render all spray chunks\n   */\n  _render: function() {\n    var ctx = this.canvas.contextTop, i, ilen;\n    ctx.fillStyle = this.color;\n\n    this._saveAndTransform(ctx);\n\n    for (i = 0, ilen = this.sprayChunks.length; i < ilen; i++) {\n      this.render(this.sprayChunks[i]);\n    }\n    ctx.restore();\n  },\n\n  /**\n   * @param {Object} pointer\n   */\n  addSprayChunk: function(pointer) {\n    this.sprayChunkPoints = [];\n\n    var x, y, width, radius = this.width / 2, i;\n\n    for (i = 0; i < this.density; i++) {\n\n      x = fabric.util.getRandomInt(pointer.x - radius, pointer.x + radius);\n      y = fabric.util.getRandomInt(pointer.y - radius, pointer.y + radius);\n\n      if (this.dotWidthVariance) {\n        width = fabric.util.getRandomInt(\n          // bottom clamp width to 1\n          Math.max(1, this.dotWidth - this.dotWidthVariance),\n          this.dotWidth + this.dotWidthVariance);\n      }\n      else {\n        width = this.dotWidth;\n      }\n\n      var point = new fabric.Point(x, y);\n      point.width = width;\n\n      if (this.randomOpacity) {\n        point.opacity = fabric.util.getRandomInt(0, 100) / 100;\n      }\n\n      this.sprayChunkPoints.push(point);\n    }\n\n    this.sprayChunks.push(this.sprayChunkPoints);\n  }\n});\n\n\n/**\n * PatternBrush class\n * @class fabric.PatternBrush\n * @extends fabric.BaseBrush\n */\nfabric.PatternBrush = fabric.util.createClass(fabric.PencilBrush, /** @lends fabric.PatternBrush.prototype */ {\n\n  getPatternSrc: function() {\n\n    var dotWidth = 20,\n        dotDistance = 5,\n        patternCanvas = fabric.util.createCanvasElement(),\n        patternCtx = patternCanvas.getContext('2d');\n\n    patternCanvas.width = patternCanvas.height = dotWidth + dotDistance;\n\n    patternCtx.fillStyle = this.color;\n    patternCtx.beginPath();\n    patternCtx.arc(dotWidth / 2, dotWidth / 2, dotWidth / 2, 0, Math.PI * 2, false);\n    patternCtx.closePath();\n    patternCtx.fill();\n\n    return patternCanvas;\n  },\n\n  getPatternSrcFunction: function() {\n    return String(this.getPatternSrc).replace('this.color', '\"' + this.color + '\"');\n  },\n\n  /**\n   * Creates \"pattern\" instance property\n   * @param {CanvasRenderingContext2D} ctx\n   */\n  getPattern: function(ctx) {\n    return ctx.createPattern(this.source || this.getPatternSrc(), 'repeat');\n  },\n\n  /**\n   * Sets brush styles\n   * @param {CanvasRenderingContext2D} ctx\n   */\n  _setBrushStyles: function(ctx) {\n    this.callSuper('_setBrushStyles', ctx);\n    ctx.strokeStyle = this.getPattern(ctx);\n  },\n\n  /**\n   * Creates path\n   */\n  createPath: function(pathData) {\n    var path = this.callSuper('createPath', pathData),\n        topLeft = path._getLeftTopCoords().scalarAdd(path.strokeWidth / 2);\n\n    path.stroke = new fabric.Pattern({\n      source: this.source || this.getPatternSrcFunction(),\n      offsetX: -topLeft.x,\n      offsetY: -topLeft.y\n    });\n    return path;\n  }\n});\n\n\n(function() {\n\n  var getPointer = fabric.util.getPointer,\n      degreesToRadians = fabric.util.degreesToRadians,\n      isTouchEvent = fabric.util.isTouchEvent;\n\n  /**\n   * Canvas class\n   * @class fabric.Canvas\n   * @extends fabric.StaticCanvas\n   * @tutorial {@link http://fabricjs.com/fabric-intro-part-1#canvas}\n   * @see {@link fabric.Canvas#initialize} for constructor definition\n   *\n   * @fires object:modified at the end of a transform or any change when statefull is true\n   * @fires object:rotating while an object is being rotated from the control\n   * @fires object:scaling while an object is being scaled by controls\n   * @fires object:moving while an object is being dragged\n   * @fires object:skewing while an object is being skewed from the controls\n   *\n   * @fires before:transform before a transform is is started\n   * @fires before:selection:cleared\n   * @fires selection:cleared\n   * @fires selection:updated\n   * @fires selection:created\n   *\n   * @fires path:created after a drawing operation ends and the path is added\n   * @fires mouse:down\n   * @fires mouse:move\n   * @fires mouse:up\n   * @fires mouse:down:before  on mouse down, before the inner fabric logic runs\n   * @fires mouse:move:before on mouse move, before the inner fabric logic runs\n   * @fires mouse:up:before on mouse up, before the inner fabric logic runs\n   * @fires mouse:over\n   * @fires mouse:out\n   * @fires mouse:dblclick whenever a native dbl click event fires on the canvas.\n   *\n   * @fires dragover\n   * @fires dragenter\n   * @fires dragleave\n   * @fires drop:before before drop event. same native event. This is added to handle edge cases\n   * @fires drop\n   * @fires after:render at the end of the render process, receives the context in the callback\n   * @fires before:render at start the render process, receives the context in the callback\n   *\n   */\n  fabric.Canvas = fabric.util.createClass(fabric.StaticCanvas, /** @lends fabric.Canvas.prototype */ {\n\n    /**\n     * Constructor\n     * @param {HTMLElement | String} el &lt;canvas> element to initialize instance on\n     * @param {Object} [options] Options object\n     * @return {Object} thisArg\n     */\n    initialize: function(el, options) {\n      options || (options = { });\n      this.renderAndResetBound = this.renderAndReset.bind(this);\n      this.requestRenderAllBound = this.requestRenderAll.bind(this);\n      this._initStatic(el, options);\n      this._initInteractive();\n      this._createCacheCanvas();\n    },\n\n    /**\n     * When true, objects can be transformed by one side (unproportionally)\n     * when dragged on the corners that normally would not do that.\n     * @type Boolean\n     * @default\n     * @since fabric 4.0 // changed name and default value\n     */\n    uniformScaling:      true,\n\n    /**\n     * Indicates which key switches uniform scaling.\n     * values: 'altKey', 'shiftKey', 'ctrlKey'.\n     * If `null` or 'none' or any other string that is not a modifier key\n     * feature is disabled.\n     * totally wrong named. this sounds like `uniform scaling`\n     * if Canvas.uniformScaling is true, pressing this will set it to false\n     * and viceversa.\n     * @since 1.6.2\n     * @type String\n     * @default\n     */\n    uniScaleKey:           'shiftKey',\n\n    /**\n     * When true, objects use center point as the origin of scale transformation.\n     * <b>Backwards incompatibility note:</b> This property replaces \"centerTransform\" (Boolean).\n     * @since 1.3.4\n     * @type Boolean\n     * @default\n     */\n    centeredScaling:        false,\n\n    /**\n     * When true, objects use center point as the origin of rotate transformation.\n     * <b>Backwards incompatibility note:</b> This property replaces \"centerTransform\" (Boolean).\n     * @since 1.3.4\n     * @type Boolean\n     * @default\n     */\n    centeredRotation:       false,\n\n    /**\n     * Indicates which key enable centered Transform\n     * values: 'altKey', 'shiftKey', 'ctrlKey'.\n     * If `null` or 'none' or any other string that is not a modifier key\n     * feature is disabled feature disabled.\n     * @since 1.6.2\n     * @type String\n     * @default\n     */\n    centeredKey:           'altKey',\n\n    /**\n     * Indicates which key enable alternate action on corner\n     * values: 'altKey', 'shiftKey', 'ctrlKey'.\n     * If `null` or 'none' or any other string that is not a modifier key\n     * feature is disabled feature disabled.\n     * @since 1.6.2\n     * @type String\n     * @default\n     */\n    altActionKey:           'shiftKey',\n\n    /**\n     * Indicates that canvas is interactive. This property should not be changed.\n     * @type Boolean\n     * @default\n     */\n    interactive:            true,\n\n    /**\n     * Indicates whether group selection should be enabled\n     * @type Boolean\n     * @default\n     */\n    selection:              true,\n\n    /**\n     * Indicates which key or keys enable multiple click selection\n     * Pass value as a string or array of strings\n     * values: 'altKey', 'shiftKey', 'ctrlKey'.\n     * If `null` or empty or containing any other string that is not a modifier key\n     * feature is disabled.\n     * @since 1.6.2\n     * @type String|Array\n     * @default\n     */\n    selectionKey:           'shiftKey',\n\n    /**\n     * Indicates which key enable alternative selection\n     * in case of target overlapping with active object\n     * values: 'altKey', 'shiftKey', 'ctrlKey'.\n     * For a series of reason that come from the general expectations on how\n     * things should work, this feature works only for preserveObjectStacking true.\n     * If `null` or 'none' or any other string that is not a modifier key\n     * feature is disabled.\n     * @since 1.6.5\n     * @type null|String\n     * @default\n     */\n    altSelectionKey:           null,\n\n    /**\n     * Color of selection\n     * @type String\n     * @default\n     */\n    selectionColor:         'rgba(100, 100, 255, 0.3)', // blue\n\n    /**\n     * Default dash array pattern\n     * If not empty the selection border is dashed\n     * @type Array\n     */\n    selectionDashArray:     [],\n\n    /**\n     * Color of the border of selection (usually slightly darker than color of selection itself)\n     * @type String\n     * @default\n     */\n    selectionBorderColor:   'rgba(255, 255, 255, 0.3)',\n\n    /**\n     * Width of a line used in object/group selection\n     * @type Number\n     * @default\n     */\n    selectionLineWidth:     1,\n\n    /**\n     * Select only shapes that are fully contained in the dragged selection rectangle.\n     * @type Boolean\n     * @default\n     */\n    selectionFullyContained: false,\n\n    /**\n     * Default cursor value used when hovering over an object on canvas\n     * @type String\n     * @default\n     */\n    hoverCursor:            'move',\n\n    /**\n     * Default cursor value used when moving an object on canvas\n     * @type String\n     * @default\n     */\n    moveCursor:             'move',\n\n    /**\n     * Default cursor value used for the entire canvas\n     * @type String\n     * @default\n     */\n    defaultCursor:          'default',\n\n    /**\n     * Cursor value used during free drawing\n     * @type String\n     * @default\n     */\n    freeDrawingCursor:      'crosshair',\n\n    /**\n     * Cursor value used for disabled elements ( corners with disabled action )\n     * @type String\n     * @since 2.0.0\n     * @default\n     */\n    notAllowedCursor:         'not-allowed',\n\n    /**\n     * Default element class that's given to wrapper (div) element of canvas\n     * @type String\n     * @default\n     */\n    containerClass:         'canvas-container',\n\n    /**\n     * When true, object detection happens on per-pixel basis rather than on per-bounding-box\n     * @type Boolean\n     * @default\n     */\n    perPixelTargetFind:     false,\n\n    /**\n     * Number of pixels around target pixel to tolerate (consider active) during object detection\n     * @type Number\n     * @default\n     */\n    targetFindTolerance:    0,\n\n    /**\n     * When true, target detection is skipped. Target detection will return always undefined.\n     * click selection won't work anymore, events will fire with no targets.\n     * if something is selected before setting it to true, it will be deselected at the first click.\n     * area selection will still work. check the `selection` property too.\n     * if you deactivate both, you should look into staticCanvas.\n     * @type Boolean\n     * @default\n     */\n    skipTargetFind:         false,\n\n    /**\n     * When true, mouse events on canvas (mousedown/mousemove/mouseup) result in free drawing.\n     * After mousedown, mousemove creates a shape,\n     * and then mouseup finalizes it and adds an instance of `fabric.Path` onto canvas.\n     * @tutorial {@link http://fabricjs.com/fabric-intro-part-4#free_drawing}\n     * @type Boolean\n     * @default\n     */\n    isDrawingMode:          false,\n\n    /**\n     * Indicates whether objects should remain in current stack position when selected.\n     * When false objects are brought to top and rendered as part of the selection group\n     * @type Boolean\n     * @default\n     */\n    preserveObjectStacking: false,\n\n    /**\n     * Indicates the angle that an object will lock to while rotating.\n     * @type Number\n     * @since 1.6.7\n     * @default\n     */\n    snapAngle: 0,\n\n    /**\n     * Indicates the distance from the snapAngle the rotation will lock to the snapAngle.\n     * When `null`, the snapThreshold will default to the snapAngle.\n     * @type null|Number\n     * @since 1.6.7\n     * @default\n     */\n    snapThreshold: null,\n\n    /**\n     * Indicates if the right click on canvas can output the context menu or not\n     * @type Boolean\n     * @since 1.6.5\n     * @default\n     */\n    stopContextMenu: false,\n\n    /**\n     * Indicates if the canvas can fire right click events\n     * @type Boolean\n     * @since 1.6.5\n     * @default\n     */\n    fireRightClick: false,\n\n    /**\n     * Indicates if the canvas can fire middle click events\n     * @type Boolean\n     * @since 1.7.8\n     * @default\n     */\n    fireMiddleClick: false,\n\n    /**\n     * Keep track of the subTargets for Mouse Events\n     * @type fabric.Object[]\n     */\n    targets: [],\n\n    /**\n     * When the option is enabled, PointerEvent is used instead of MouseEvent.\n     * @type Boolean\n     * @default\n     */\n    enablePointerEvents: false,\n\n    /**\n     * Keep track of the hovered target\n     * @type fabric.Object\n     * @private\n     */\n    _hoveredTarget: null,\n\n    /**\n     * hold the list of nested targets hovered\n     * @type fabric.Object[]\n     * @private\n     */\n    _hoveredTargets: [],\n\n    /**\n     * @private\n     */\n    _initInteractive: function() {\n      this._currentTransform = null;\n      this._groupSelector = null;\n      this._initWrapperElement();\n      this._createUpperCanvas();\n      this._initEventListeners();\n\n      this._initRetinaScaling();\n\n      this.freeDrawingBrush = fabric.PencilBrush && new fabric.PencilBrush(this);\n\n      this.calcOffset();\n    },\n\n    /**\n     * Divides objects in two groups, one to render immediately\n     * and one to render as activeGroup.\n     * @return {Array} objects to render immediately and pushes the other in the activeGroup.\n     */\n    _chooseObjectsToRender: function() {\n      var activeObjects = this.getActiveObjects(),\n          object, objsToRender, activeGroupObjects;\n\n      if (activeObjects.length > 0 && !this.preserveObjectStacking) {\n        objsToRender = [];\n        activeGroupObjects = [];\n        for (var i = 0, length = this._objects.length; i < length; i++) {\n          object = this._objects[i];\n          if (activeObjects.indexOf(object) === -1 ) {\n            objsToRender.push(object);\n          }\n          else {\n            activeGroupObjects.push(object);\n          }\n        }\n        if (activeObjects.length > 1) {\n          this._activeObject._objects = activeGroupObjects;\n        }\n        objsToRender.push.apply(objsToRender, activeGroupObjects);\n      }\n      else {\n        objsToRender = this._objects;\n      }\n      return objsToRender;\n    },\n\n    /**\n     * Renders both the top canvas and the secondary container canvas.\n     * @return {fabric.Canvas} instance\n     * @chainable\n     */\n    renderAll: function () {\n      if (this.contextTopDirty && !this._groupSelector && !this.isDrawingMode) {\n        this.clearContext(this.contextTop);\n        this.contextTopDirty = false;\n      }\n      if (this.hasLostContext) {\n        this.renderTopLayer(this.contextTop);\n        this.hasLostContext = false;\n      }\n      var canvasToDrawOn = this.contextContainer;\n      this.renderCanvas(canvasToDrawOn, this._chooseObjectsToRender());\n      return this;\n    },\n\n    renderTopLayer: function(ctx) {\n      ctx.save();\n      if (this.isDrawingMode && this._isCurrentlyDrawing) {\n        this.freeDrawingBrush && this.freeDrawingBrush._render();\n        this.contextTopDirty = true;\n      }\n      // we render the top context - last object\n      if (this.selection && this._groupSelector) {\n        this._drawSelection(ctx);\n        this.contextTopDirty = true;\n      }\n      ctx.restore();\n    },\n\n    /**\n     * Method to render only the top canvas.\n     * Also used to render the group selection box.\n     * @return {fabric.Canvas} thisArg\n     * @chainable\n     */\n    renderTop: function () {\n      var ctx = this.contextTop;\n      this.clearContext(ctx);\n      this.renderTopLayer(ctx);\n      this.fire('after:render');\n      return this;\n    },\n\n    /**\n     * @private\n     */\n    _normalizePointer: function (object, pointer) {\n      var m = object.calcTransformMatrix(),\n          invertedM = fabric.util.invertTransform(m),\n          vptPointer = this.restorePointerVpt(pointer);\n      return fabric.util.transformPoint(vptPointer, invertedM);\n    },\n\n    /**\n     * Returns true if object is transparent at a certain location\n     * @param {fabric.Object} target Object to check\n     * @param {Number} x Left coordinate\n     * @param {Number} y Top coordinate\n     * @return {Boolean}\n     */\n    isTargetTransparent: function (target, x, y) {\n      // in case the target is the activeObject, we cannot execute this optimization\n      // because we need to draw controls too.\n      if (target.shouldCache() && target._cacheCanvas && target !== this._activeObject) {\n        var normalizedPointer = this._normalizePointer(target, {x: x, y: y}),\n            targetRelativeX = Math.max(target.cacheTranslationX + (normalizedPointer.x * target.zoomX), 0),\n            targetRelativeY = Math.max(target.cacheTranslationY + (normalizedPointer.y * target.zoomY), 0);\n\n        var isTransparent = fabric.util.isTransparent(\n          target._cacheContext, Math.round(targetRelativeX), Math.round(targetRelativeY), this.targetFindTolerance);\n\n        return isTransparent;\n      }\n\n      var ctx = this.contextCache,\n          originalColor = target.selectionBackgroundColor, v = this.viewportTransform;\n\n      target.selectionBackgroundColor = '';\n\n      this.clearContext(ctx);\n\n      ctx.save();\n      ctx.transform(v[0], v[1], v[2], v[3], v[4], v[5]);\n      target.render(ctx);\n      ctx.restore();\n\n      target.selectionBackgroundColor = originalColor;\n\n      var isTransparent = fabric.util.isTransparent(\n        ctx, x, y, this.targetFindTolerance);\n\n      return isTransparent;\n    },\n\n    /**\n     * takes an event and determines if selection key has been pressed\n     * @private\n     * @param {Event} e Event object\n     */\n    _isSelectionKeyPressed: function(e) {\n      var selectionKeyPressed = false;\n\n      if (Array.isArray(this.selectionKey)) {\n        selectionKeyPressed = !!this.selectionKey.find(function(key) { return e[key] === true; });\n      }\n      else {\n        selectionKeyPressed = e[this.selectionKey];\n      }\n\n      return selectionKeyPressed;\n    },\n\n    /**\n     * @private\n     * @param {Event} e Event object\n     * @param {fabric.Object} target\n     */\n    _shouldClearSelection: function (e, target) {\n      var activeObjects = this.getActiveObjects(),\n          activeObject = this._activeObject;\n\n      return (\n        !target\n        ||\n        (target &&\n          activeObject &&\n          activeObjects.length > 1 &&\n          activeObjects.indexOf(target) === -1 &&\n          activeObject !== target &&\n          !this._isSelectionKeyPressed(e))\n        ||\n        (target && !target.evented)\n        ||\n        (target &&\n          !target.selectable &&\n          activeObject &&\n          activeObject !== target)\n      );\n    },\n\n    /**\n     * centeredScaling from object can't override centeredScaling from canvas.\n     * this should be fixed, since object setting should take precedence over canvas.\n     * also this should be something that will be migrated in the control properties.\n     * as ability to define the origin of the transformation that the control provide.\n     * @private\n     * @param {fabric.Object} target\n     * @param {String} action\n     * @param {Boolean} altKey\n     */\n    _shouldCenterTransform: function (target, action, altKey) {\n      if (!target) {\n        return;\n      }\n\n      var centerTransform;\n\n      if (action === 'scale' || action === 'scaleX' || action === 'scaleY' || action === 'resizing') {\n        centerTransform = this.centeredScaling || target.centeredScaling;\n      }\n      else if (action === 'rotate') {\n        centerTransform = this.centeredRotation || target.centeredRotation;\n      }\n\n      return centerTransform ? !altKey : altKey;\n    },\n\n    /**\n     * should disappear before release 4.0\n     * @private\n     */\n    _getOriginFromCorner: function(target, corner) {\n      var origin = {\n        x: target.originX,\n        y: target.originY\n      };\n\n      if (corner === 'ml' || corner === 'tl' || corner === 'bl') {\n        origin.x = 'right';\n      }\n      else if (corner === 'mr' || corner === 'tr' || corner === 'br') {\n        origin.x = 'left';\n      }\n\n      if (corner === 'tl' || corner === 'mt' || corner === 'tr') {\n        origin.y = 'bottom';\n      }\n      else if (corner === 'bl' || corner === 'mb' || corner === 'br') {\n        origin.y = 'top';\n      }\n      return origin;\n    },\n\n    /**\n     * @private\n     * @param {Boolean} alreadySelected true if target is already selected\n     * @param {String} corner a string representing the corner ml, mr, tl ...\n     * @param {Event} e Event object\n     * @param {fabric.Object} [target] inserted back to help overriding. Unused\n     */\n    _getActionFromCorner: function(alreadySelected, corner, e, target) {\n      if (!corner || !alreadySelected) {\n        return 'drag';\n      }\n      var control = target.controls[corner];\n      return control.getActionName(e, control, target);\n    },\n\n    /**\n     * @private\n     * @param {Event} e Event object\n     * @param {fabric.Object} target\n     */\n    _setupCurrentTransform: function (e, target, alreadySelected) {\n      if (!target) {\n        return;\n      }\n\n      var pointer = this.getPointer(e), corner = target.__corner,\n          control = target.controls[corner],\n          actionHandler = (alreadySelected && corner) ?\n            control.getActionHandler(e, target, control) : fabric.controlsUtils.dragHandler,\n          action = this._getActionFromCorner(alreadySelected, corner, e, target),\n          origin = this._getOriginFromCorner(target, corner),\n          altKey = e[this.centeredKey],\n          transform = {\n            target: target,\n            action: action,\n            actionHandler: actionHandler,\n            corner: corner,\n            scaleX: target.scaleX,\n            scaleY: target.scaleY,\n            skewX: target.skewX,\n            skewY: target.skewY,\n            // used by transation\n            offsetX: pointer.x - target.left,\n            offsetY: pointer.y - target.top,\n            originX: origin.x,\n            originY: origin.y,\n            ex: pointer.x,\n            ey: pointer.y,\n            lastX: pointer.x,\n            lastY: pointer.y,\n            // unsure they are useful anymore.\n            // left: target.left,\n            // top: target.top,\n            theta: degreesToRadians(target.angle),\n            // end of unsure\n            width: target.width * target.scaleX,\n            shiftKey: e.shiftKey,\n            altKey: altKey,\n            original: fabric.util.saveObjectTransform(target),\n          };\n\n      if (this._shouldCenterTransform(target, action, altKey)) {\n        transform.originX = 'center';\n        transform.originY = 'center';\n      }\n      transform.original.originX = origin.x;\n      transform.original.originY = origin.y;\n      this._currentTransform = transform;\n      this._beforeTransform(e);\n    },\n\n    /**\n     * Set the cursor type of the canvas element\n     * @param {String} value Cursor type of the canvas element.\n     * @see http://www.w3.org/TR/css3-ui/#cursor\n     */\n    setCursor: function (value) {\n      this.upperCanvasEl.style.cursor = value;\n    },\n\n    /**\n     * @private\n     * @param {CanvasRenderingContext2D} ctx to draw the selection on\n     */\n    _drawSelection: function (ctx) {\n      var selector = this._groupSelector,\n          viewportStart = new fabric.Point(selector.ex, selector.ey),\n          start = fabric.util.transformPoint(viewportStart, this.viewportTransform),\n          viewportExtent = new fabric.Point(selector.ex + selector.left, selector.ey + selector.top),\n          extent = fabric.util.transformPoint(viewportExtent, this.viewportTransform),\n          minX = Math.min(start.x, extent.x),\n          minY = Math.min(start.y, extent.y),\n          maxX = Math.max(start.x, extent.x),\n          maxY = Math.max(start.y, extent.y),\n          strokeOffset = this.selectionLineWidth / 2;\n\n      if (this.selectionColor) {\n        ctx.fillStyle = this.selectionColor;\n        ctx.fillRect(minX, minY, maxX - minX, maxY - minY);\n      }\n\n      if (!this.selectionLineWidth || !this.selectionBorderColor) {\n        return;\n      }\n      ctx.lineWidth = this.selectionLineWidth;\n      ctx.strokeStyle = this.selectionBorderColor;\n\n      minX += strokeOffset;\n      minY += strokeOffset;\n      maxX -= strokeOffset;\n      maxY -= strokeOffset;\n      // selection border\n      fabric.Object.prototype._setLineDash.call(this, ctx, this.selectionDashArray);\n      ctx.strokeRect(minX, minY, maxX - minX, maxY - minY);\n    },\n\n    /**\n     * Method that determines what object we are clicking on\n     * the skipGroup parameter is for internal use, is needed for shift+click action\n     * 11/09/2018 TODO: would be cool if findTarget could discern between being a full target\n     * or the outside part of the corner.\n     * @param {Event} e mouse event\n     * @param {Boolean} skipGroup when true, activeGroup is skipped and only objects are traversed through\n     * @return {fabric.Object} the target found\n     */\n    findTarget: function (e, skipGroup) {\n      if (this.skipTargetFind) {\n        return;\n      }\n\n      var ignoreZoom = true,\n          pointer = this.getPointer(e, ignoreZoom),\n          activeObject = this._activeObject,\n          aObjects = this.getActiveObjects(),\n          activeTarget, activeTargetSubs,\n          isTouch = isTouchEvent(e),\n          shouldLookForActive = (aObjects.length > 1 && !skipGroup) || aObjects.length === 1;\n\n      // first check current group (if one exists)\n      // active group does not check sub targets like normal groups.\n      // if active group just exits.\n      this.targets = [];\n\n      // if we hit the corner of an activeObject, let's return that.\n      if (shouldLookForActive && activeObject._findTargetCorner(pointer, isTouch)) {\n        return activeObject;\n      }\n      if (aObjects.length > 1 && !skipGroup && activeObject === this._searchPossibleTargets([activeObject], pointer)) {\n        return activeObject;\n      }\n      if (aObjects.length === 1 &&\n        activeObject === this._searchPossibleTargets([activeObject], pointer)) {\n        if (!this.preserveObjectStacking) {\n          return activeObject;\n        }\n        else {\n          activeTarget = activeObject;\n          activeTargetSubs = this.targets;\n          this.targets = [];\n        }\n      }\n      var target = this._searchPossibleTargets(this._objects, pointer);\n      if (e[this.altSelectionKey] && target && activeTarget && target !== activeTarget) {\n        target = activeTarget;\n        this.targets = activeTargetSubs;\n      }\n      return target;\n    },\n\n    /**\n     * Checks point is inside the object.\n     * @param {Object} [pointer] x,y object of point coordinates we want to check.\n     * @param {fabric.Object} obj Object to test against\n     * @param {Object} [globalPointer] x,y object of point coordinates relative to canvas used to search per pixel target.\n     * @return {Boolean} true if point is contained within an area of given object\n     * @private\n     */\n    _checkTarget: function(pointer, obj, globalPointer) {\n      if (obj &&\n          obj.visible &&\n          obj.evented &&\n          // http://www.geog.ubc.ca/courses/klink/gis.notes/ncgia/u32.html\n          // http://idav.ucdavis.edu/~okreylos/TAship/Spring2000/PointInPolygon.html\n          obj.containsPoint(pointer)\n      ) {\n        if ((this.perPixelTargetFind || obj.perPixelTargetFind) && !obj.isEditing) {\n          var isTransparent = this.isTargetTransparent(obj, globalPointer.x, globalPointer.y);\n          if (!isTransparent) {\n            return true;\n          }\n        }\n        else {\n          return true;\n        }\n      }\n    },\n\n    /**\n     * Function used to search inside objects an object that contains pointer in bounding box or that contains pointerOnCanvas when painted\n     * @param {Array} [objects] objects array to look into\n     * @param {Object} [pointer] x,y object of point coordinates we want to check.\n     * @return {fabric.Object} object that contains pointer\n     * @private\n     */\n    _searchPossibleTargets: function(objects, pointer) {\n      // Cache all targets where their bounding box contains point.\n      var target, i = objects.length, subTarget;\n      // Do not check for currently grouped objects, since we check the parent group itself.\n      // until we call this function specifically to search inside the activeGroup\n      while (i--) {\n        var objToCheck = objects[i];\n        var pointerToUse = objToCheck.group ?\n          this._normalizePointer(objToCheck.group, pointer) : pointer;\n        if (this._checkTarget(pointerToUse, objToCheck, pointer)) {\n          target = objects[i];\n          if (target.subTargetCheck && target instanceof fabric.Group) {\n            subTarget = this._searchPossibleTargets(target._objects, pointer);\n            subTarget && this.targets.push(subTarget);\n          }\n          break;\n        }\n      }\n      return target;\n    },\n\n    /**\n     * Returns pointer coordinates without the effect of the viewport\n     * @param {Object} pointer with \"x\" and \"y\" number values\n     * @return {Object} object with \"x\" and \"y\" number values\n     */\n    restorePointerVpt: function(pointer) {\n      return fabric.util.transformPoint(\n        pointer,\n        fabric.util.invertTransform(this.viewportTransform)\n      );\n    },\n\n    /**\n     * Returns pointer coordinates relative to canvas.\n     * Can return coordinates with or without viewportTransform.\n     * ignoreZoom false gives back coordinates that represent\n     * the point clicked on canvas element.\n     * ignoreZoom true gives back coordinates after being processed\n     * by the viewportTransform ( sort of coordinates of what is displayed\n     * on the canvas where you are clicking.\n     * ignoreZoom true = HTMLElement coordinates relative to top,left\n     * ignoreZoom false, default = fabric space coordinates, the same used for shape position\n     * To interact with your shapes top and left you want to use ignoreZoom true\n     * most of the time, while ignoreZoom false will give you coordinates\n     * compatible with the object.oCoords system.\n     * of the time.\n     * @param {Event} e\n     * @param {Boolean} ignoreZoom\n     * @return {Object} object with \"x\" and \"y\" number values\n     */\n    getPointer: function (e, ignoreZoom) {\n      // return cached values if we are in the event processing chain\n      if (this._absolutePointer && !ignoreZoom) {\n        return this._absolutePointer;\n      }\n      if (this._pointer && ignoreZoom) {\n        return this._pointer;\n      }\n\n      var pointer = getPointer(e),\n          upperCanvasEl = this.upperCanvasEl,\n          bounds = upperCanvasEl.getBoundingClientRect(),\n          boundsWidth = bounds.width || 0,\n          boundsHeight = bounds.height || 0,\n          cssScale;\n\n      if (!boundsWidth || !boundsHeight ) {\n        if ('top' in bounds && 'bottom' in bounds) {\n          boundsHeight = Math.abs( bounds.top - bounds.bottom );\n        }\n        if ('right' in bounds && 'left' in bounds) {\n          boundsWidth = Math.abs( bounds.right - bounds.left );\n        }\n      }\n\n      this.calcOffset();\n      pointer.x = pointer.x - this._offset.left;\n      pointer.y = pointer.y - this._offset.top;\n      if (!ignoreZoom) {\n        pointer = this.restorePointerVpt(pointer);\n      }\n\n      var retinaScaling = this.getRetinaScaling();\n      if (retinaScaling !== 1) {\n        pointer.x /= retinaScaling;\n        pointer.y /= retinaScaling;\n      }\n\n      if (boundsWidth === 0 || boundsHeight === 0) {\n        // If bounds are not available (i.e. not visible), do not apply scale.\n        cssScale = { width: 1, height: 1 };\n      }\n      else {\n        cssScale = {\n          width: upperCanvasEl.width / boundsWidth,\n          height: upperCanvasEl.height / boundsHeight\n        };\n      }\n\n      return {\n        x: pointer.x * cssScale.width,\n        y: pointer.y * cssScale.height\n      };\n    },\n\n    /**\n     * @private\n     * @throws {CANVAS_INIT_ERROR} If canvas can not be initialized\n     */\n    _createUpperCanvas: function () {\n      var lowerCanvasClass = this.lowerCanvasEl.className.replace(/\\s*lower-canvas\\s*/, ''),\n          lowerCanvasEl = this.lowerCanvasEl, upperCanvasEl = this.upperCanvasEl;\n\n      // there is no need to create a new upperCanvas element if we have already one.\n      if (upperCanvasEl) {\n        upperCanvasEl.className = '';\n      }\n      else {\n        upperCanvasEl = this._createCanvasElement();\n        this.upperCanvasEl = upperCanvasEl;\n      }\n      fabric.util.addClass(upperCanvasEl, 'upper-canvas ' + lowerCanvasClass);\n\n      this.wrapperEl.appendChild(upperCanvasEl);\n\n      this._copyCanvasStyle(lowerCanvasEl, upperCanvasEl);\n      this._applyCanvasStyle(upperCanvasEl);\n      this.contextTop = upperCanvasEl.getContext('2d');\n    },\n\n    /**\n     * Returns context of top canvas where interactions are drawn\n     * @returns {CanvasRenderingContext2D}\n     */\n    getTopContext: function () {\n      return this.contextTop;\n    },\n\n    /**\n     * @private\n     */\n    _createCacheCanvas: function () {\n      this.cacheCanvasEl = this._createCanvasElement();\n      this.cacheCanvasEl.setAttribute('width', this.width);\n      this.cacheCanvasEl.setAttribute('height', this.height);\n      this.contextCache = this.cacheCanvasEl.getContext('2d');\n    },\n\n    /**\n     * @private\n     */\n    _initWrapperElement: function () {\n      this.wrapperEl = fabric.util.wrapElement(this.lowerCanvasEl, 'div', {\n        'class': this.containerClass\n      });\n      fabric.util.setStyle(this.wrapperEl, {\n        width: this.width + 'px',\n        height: this.height + 'px',\n        position: 'relative'\n      });\n      fabric.util.makeElementUnselectable(this.wrapperEl);\n    },\n\n    /**\n     * @private\n     * @param {HTMLElement} element canvas element to apply styles on\n     */\n    _applyCanvasStyle: function (element) {\n      var width = this.width || element.width,\n          height = this.height || element.height;\n\n      fabric.util.setStyle(element, {\n        position: 'absolute',\n        width: width + 'px',\n        height: height + 'px',\n        left: 0,\n        top: 0,\n        'touch-action': this.allowTouchScrolling ? 'manipulation' : 'none',\n        '-ms-touch-action': this.allowTouchScrolling ? 'manipulation' : 'none'\n      });\n      element.width = width;\n      element.height = height;\n      fabric.util.makeElementUnselectable(element);\n    },\n\n    /**\n     * Copy the entire inline style from one element (fromEl) to another (toEl)\n     * @private\n     * @param {Element} fromEl Element style is copied from\n     * @param {Element} toEl Element copied style is applied to\n     */\n    _copyCanvasStyle: function (fromEl, toEl) {\n      toEl.style.cssText = fromEl.style.cssText;\n    },\n\n    /**\n     * Returns context of canvas where object selection is drawn\n     * @return {CanvasRenderingContext2D}\n     */\n    getSelectionContext: function() {\n      return this.contextTop;\n    },\n\n    /**\n     * Returns &lt;canvas> element on which object selection is drawn\n     * @return {HTMLCanvasElement}\n     */\n    getSelectionElement: function () {\n      return this.upperCanvasEl;\n    },\n\n    /**\n     * Returns currently active object\n     * @return {fabric.Object} active object\n     */\n    getActiveObject: function () {\n      return this._activeObject;\n    },\n\n    /**\n     * Returns an array with the current selected objects\n     * @return {fabric.Object} active object\n     */\n    getActiveObjects: function () {\n      var active = this._activeObject;\n      if (active) {\n        if (active.type === 'activeSelection' && active._objects) {\n          return active._objects.slice(0);\n        }\n        else {\n          return [active];\n        }\n      }\n      return [];\n    },\n\n    /**\n     * @private\n     * @param {fabric.Object} obj Object that was removed\n     */\n    _onObjectRemoved: function(obj) {\n      // removing active object should fire \"selection:cleared\" events\n      if (obj === this._activeObject) {\n        this.fire('before:selection:cleared', { target: obj });\n        this._discardActiveObject();\n        this.fire('selection:cleared', { target: obj });\n        obj.fire('deselected');\n      }\n      if (obj === this._hoveredTarget){\n        this._hoveredTarget = null;\n        this._hoveredTargets = [];\n      }\n      this.callSuper('_onObjectRemoved', obj);\n    },\n\n    /**\n     * @private\n     * Compares the old activeObject with the current one and fires correct events\n     * @param {fabric.Object} obj old activeObject\n     */\n    _fireSelectionEvents: function(oldObjects, e) {\n      var somethingChanged = false, objects = this.getActiveObjects(),\n          added = [], removed = [];\n      oldObjects.forEach(function(oldObject) {\n        if (objects.indexOf(oldObject) === -1) {\n          somethingChanged = true;\n          oldObject.fire('deselected', {\n            e: e,\n            target: oldObject\n          });\n          removed.push(oldObject);\n        }\n      });\n      objects.forEach(function(object) {\n        if (oldObjects.indexOf(object) === -1) {\n          somethingChanged = true;\n          object.fire('selected', {\n            e: e,\n            target: object\n          });\n          added.push(object);\n        }\n      });\n      if (oldObjects.length > 0 && objects.length > 0) {\n        somethingChanged && this.fire('selection:updated', {\n          e: e,\n          selected: added,\n          deselected: removed,\n        });\n      }\n      else if (objects.length > 0) {\n        this.fire('selection:created', {\n          e: e,\n          selected: added,\n        });\n      }\n      else if (oldObjects.length > 0) {\n        this.fire('selection:cleared', {\n          e: e,\n          deselected: removed,\n        });\n      }\n    },\n\n    /**\n     * Sets given object as the only active object on canvas\n     * @param {fabric.Object} object Object to set as an active one\n     * @param {Event} [e] Event (passed along when firing \"object:selected\")\n     * @return {fabric.Canvas} thisArg\n     * @chainable\n     */\n    setActiveObject: function (object, e) {\n      var currentActives = this.getActiveObjects();\n      this._setActiveObject(object, e);\n      this._fireSelectionEvents(currentActives, e);\n      return this;\n    },\n\n    /**\n     * This is a private method for now.\n     * This is supposed to be equivalent to setActiveObject but without firing\n     * any event. There is commitment to have this stay this way.\n     * This is the functional part of setActiveObject.\n     * @private\n     * @param {Object} object to set as active\n     * @param {Event} [e] Event (passed along when firing \"object:selected\")\n     * @return {Boolean} true if the selection happened\n     */\n    _setActiveObject: function(object, e) {\n      if (this._activeObject === object) {\n        return false;\n      }\n      if (!this._discardActiveObject(e, object)) {\n        return false;\n      }\n      if (object.onSelect({ e: e })) {\n        return false;\n      }\n      this._activeObject = object;\n      return true;\n    },\n\n    /**\n     * This is a private method for now.\n     * This is supposed to be equivalent to discardActiveObject but without firing\n     * any events. There is commitment to have this stay this way.\n     * This is the functional part of discardActiveObject.\n     * @param {Event} [e] Event (passed along when firing \"object:deselected\")\n     * @param {Object} object to set as active\n     * @return {Boolean} true if the selection happened\n     * @private\n     */\n    _discardActiveObject: function(e, object) {\n      var obj = this._activeObject;\n      if (obj) {\n        // onDeselect return TRUE to cancel selection;\n        if (obj.onDeselect({ e: e, object: object })) {\n          return false;\n        }\n        this._activeObject = null;\n      }\n      return true;\n    },\n\n    /**\n     * Discards currently active object and fire events. If the function is called by fabric\n     * as a consequence of a mouse event, the event is passed as a parameter and\n     * sent to the fire function for the custom events. When used as a method the\n     * e param does not have any application.\n     * @param {event} e\n     * @return {fabric.Canvas} thisArg\n     * @chainable\n     */\n    discardActiveObject: function (e) {\n      var currentActives = this.getActiveObjects(), activeObject = this.getActiveObject();\n      if (currentActives.length) {\n        this.fire('before:selection:cleared', { target: activeObject, e: e });\n      }\n      this._discardActiveObject(e);\n      this._fireSelectionEvents(currentActives, e);\n      return this;\n    },\n\n    /**\n     * Clears a canvas element and removes all event listeners\n     * @return {fabric.Canvas} thisArg\n     * @chainable\n     */\n    dispose: function () {\n      var wrapper = this.wrapperEl;\n      this.removeListeners();\n      wrapper.removeChild(this.upperCanvasEl);\n      wrapper.removeChild(this.lowerCanvasEl);\n      this.contextCache = null;\n      this.contextTop = null;\n      ['upperCanvasEl', 'cacheCanvasEl'].forEach((function(element) {\n        fabric.util.cleanUpJsdomNode(this[element]);\n        this[element] = undefined;\n      }).bind(this));\n      if (wrapper.parentNode) {\n        wrapper.parentNode.replaceChild(this.lowerCanvasEl, this.wrapperEl);\n      }\n      delete this.wrapperEl;\n      fabric.StaticCanvas.prototype.dispose.call(this);\n      return this;\n    },\n\n    /**\n     * Clears all contexts (background, main, top) of an instance\n     * @return {fabric.Canvas} thisArg\n     * @chainable\n     */\n    clear: function () {\n      // this.discardActiveGroup();\n      this.discardActiveObject();\n      this.clearContext(this.contextTop);\n      return this.callSuper('clear');\n    },\n\n    /**\n     * Draws objects' controls (borders/controls)\n     * @param {CanvasRenderingContext2D} ctx Context to render controls on\n     */\n    drawControls: function(ctx) {\n      var activeObject = this._activeObject;\n\n      if (activeObject) {\n        activeObject._renderControls(ctx);\n      }\n    },\n\n    /**\n     * @private\n     */\n    _toObject: function(instance, methodName, propertiesToInclude) {\n      //If the object is part of the current selection group, it should\n      //be transformed appropriately\n      //i.e. it should be serialised as it would appear if the selection group\n      //were to be destroyed.\n      var originalProperties = this._realizeGroupTransformOnObject(instance),\n          object = this.callSuper('_toObject', instance, methodName, propertiesToInclude);\n      //Undo the damage we did by changing all of its properties\n      this._unwindGroupTransformOnObject(instance, originalProperties);\n      return object;\n    },\n\n    /**\n     * Realises an object's group transformation on it\n     * @private\n     * @param {fabric.Object} [instance] the object to transform (gets mutated)\n     * @returns the original values of instance which were changed\n     */\n    _realizeGroupTransformOnObject: function(instance) {\n      if (instance.group && instance.group.type === 'activeSelection' && this._activeObject === instance.group) {\n        var layoutProps = ['angle', 'flipX', 'flipY', 'left', 'scaleX', 'scaleY', 'skewX', 'skewY', 'top'];\n        //Copy all the positionally relevant properties across now\n        var originalValues = {};\n        layoutProps.forEach(function(prop) {\n          originalValues[prop] = instance[prop];\n        });\n        fabric.util.addTransformToObject(instance, this._activeObject.calcOwnMatrix());\n        return originalValues;\n      }\n      else {\n        return null;\n      }\n    },\n\n    /**\n     * Restores the changed properties of instance\n     * @private\n     * @param {fabric.Object} [instance] the object to un-transform (gets mutated)\n     * @param {Object} [originalValues] the original values of instance, as returned by _realizeGroupTransformOnObject\n     */\n    _unwindGroupTransformOnObject: function(instance, originalValues) {\n      if (originalValues) {\n        instance.set(originalValues);\n      }\n    },\n\n    /**\n     * @private\n     */\n    _setSVGObject: function(markup, instance, reviver) {\n      //If the object is in a selection group, simulate what would happen to that\n      //object when the group is deselected\n      var originalProperties = this._realizeGroupTransformOnObject(instance);\n      this.callSuper('_setSVGObject', markup, instance, reviver);\n      this._unwindGroupTransformOnObject(instance, originalProperties);\n    },\n\n    setViewportTransform: function (vpt) {\n      if (this.renderOnAddRemove && this._activeObject && this._activeObject.isEditing) {\n        this._activeObject.clearContextTop();\n      }\n      fabric.StaticCanvas.prototype.setViewportTransform.call(this, vpt);\n    }\n  });\n\n  // copying static properties manually to work around Opera's bug,\n  // where \"prototype\" property is enumerable and overrides existing prototype\n  for (var prop in fabric.StaticCanvas) {\n    if (prop !== 'prototype') {\n      fabric.Canvas[prop] = fabric.StaticCanvas[prop];\n    }\n  }\n})();\n\n\n(function() {\n\n  var addListener = fabric.util.addListener,\n      removeListener = fabric.util.removeListener,\n      RIGHT_CLICK = 3, MIDDLE_CLICK = 2, LEFT_CLICK = 1,\n      addEventOptions = { passive: false };\n\n  function checkClick(e, value) {\n    return e.button && (e.button === value - 1);\n  }\n\n  fabric.util.object.extend(fabric.Canvas.prototype, /** @lends fabric.Canvas.prototype */ {\n\n    /**\n     * Contains the id of the touch event that owns the fabric transform\n     * @type Number\n     * @private\n     */\n    mainTouchId: null,\n\n    /**\n     * Adds mouse listeners to canvas\n     * @private\n     */\n    _initEventListeners: function () {\n      // in case we initialized the class twice. This should not happen normally\n      // but in some kind of applications where the canvas element may be changed\n      // this is a workaround to having double listeners.\n      this.removeListeners();\n      this._bindEvents();\n      this.addOrRemove(addListener, 'add');\n    },\n\n    /**\n     * return an event prefix pointer or mouse.\n     * @private\n     */\n    _getEventPrefix: function () {\n      return this.enablePointerEvents ? 'pointer' : 'mouse';\n    },\n\n    addOrRemove: function(functor, eventjsFunctor) {\n      var canvasElement = this.upperCanvasEl,\n          eventTypePrefix = this._getEventPrefix();\n      functor(fabric.window, 'resize', this._onResize);\n      functor(canvasElement, eventTypePrefix + 'down', this._onMouseDown);\n      functor(canvasElement, eventTypePrefix + 'move', this._onMouseMove, addEventOptions);\n      functor(canvasElement, eventTypePrefix + 'out', this._onMouseOut);\n      functor(canvasElement, eventTypePrefix + 'enter', this._onMouseEnter);\n      functor(canvasElement, 'wheel', this._onMouseWheel);\n      functor(canvasElement, 'contextmenu', this._onContextMenu);\n      functor(canvasElement, 'dblclick', this._onDoubleClick);\n      functor(canvasElement, 'dragover', this._onDragOver);\n      functor(canvasElement, 'dragenter', this._onDragEnter);\n      functor(canvasElement, 'dragleave', this._onDragLeave);\n      functor(canvasElement, 'drop', this._onDrop);\n      if (!this.enablePointerEvents) {\n        functor(canvasElement, 'touchstart', this._onTouchStart, addEventOptions);\n      }\n      if (typeof eventjs !== 'undefined' && eventjsFunctor in eventjs) {\n        eventjs[eventjsFunctor](canvasElement, 'gesture', this._onGesture);\n        eventjs[eventjsFunctor](canvasElement, 'drag', this._onDrag);\n        eventjs[eventjsFunctor](canvasElement, 'orientation', this._onOrientationChange);\n        eventjs[eventjsFunctor](canvasElement, 'shake', this._onShake);\n        eventjs[eventjsFunctor](canvasElement, 'longpress', this._onLongPress);\n      }\n    },\n\n    /**\n     * Removes all event listeners\n     */\n    removeListeners: function() {\n      this.addOrRemove(removeListener, 'remove');\n      // if you dispose on a mouseDown, before mouse up, you need to clean document to...\n      var eventTypePrefix = this._getEventPrefix();\n      removeListener(fabric.document, eventTypePrefix + 'up', this._onMouseUp);\n      removeListener(fabric.document, 'touchend', this._onTouchEnd, addEventOptions);\n      removeListener(fabric.document, eventTypePrefix + 'move', this._onMouseMove, addEventOptions);\n      removeListener(fabric.document, 'touchmove', this._onMouseMove, addEventOptions);\n    },\n\n    /**\n     * @private\n     */\n    _bindEvents: function() {\n      if (this.eventsBound) {\n        // for any reason we pass here twice we do not want to bind events twice.\n        return;\n      }\n      this._onMouseDown = this._onMouseDown.bind(this);\n      this._onTouchStart = this._onTouchStart.bind(this);\n      this._onMouseMove = this._onMouseMove.bind(this);\n      this._onMouseUp = this._onMouseUp.bind(this);\n      this._onTouchEnd = this._onTouchEnd.bind(this);\n      this._onResize = this._onResize.bind(this);\n      this._onGesture = this._onGesture.bind(this);\n      this._onDrag = this._onDrag.bind(this);\n      this._onShake = this._onShake.bind(this);\n      this._onLongPress = this._onLongPress.bind(this);\n      this._onOrientationChange = this._onOrientationChange.bind(this);\n      this._onMouseWheel = this._onMouseWheel.bind(this);\n      this._onMouseOut = this._onMouseOut.bind(this);\n      this._onMouseEnter = this._onMouseEnter.bind(this);\n      this._onContextMenu = this._onContextMenu.bind(this);\n      this._onDoubleClick = this._onDoubleClick.bind(this);\n      this._onDragOver = this._onDragOver.bind(this);\n      this._onDragEnter = this._simpleEventHandler.bind(this, 'dragenter');\n      this._onDragLeave = this._simpleEventHandler.bind(this, 'dragleave');\n      this._onDrop = this._onDrop.bind(this);\n      this.eventsBound = true;\n    },\n\n    /**\n     * @private\n     * @param {Event} [e] Event object fired on Event.js gesture\n     * @param {Event} [self] Inner Event object\n     */\n    _onGesture: function(e, self) {\n      this.__onTransformGesture && this.__onTransformGesture(e, self);\n    },\n\n    /**\n     * @private\n     * @param {Event} [e] Event object fired on Event.js drag\n     * @param {Event} [self] Inner Event object\n     */\n    _onDrag: function(e, self) {\n      this.__onDrag && this.__onDrag(e, self);\n    },\n\n    /**\n     * @private\n     * @param {Event} [e] Event object fired on wheel event\n     */\n    _onMouseWheel: function(e) {\n      this.__onMouseWheel(e);\n    },\n\n    /**\n     * @private\n     * @param {Event} e Event object fired on mousedown\n     */\n    _onMouseOut: function(e) {\n      var target = this._hoveredTarget;\n      this.fire('mouse:out', { target: target, e: e });\n      this._hoveredTarget = null;\n      target && target.fire('mouseout', { e: e });\n\n      var _this = this;\n      this._hoveredTargets.forEach(function(_target){\n        _this.fire('mouse:out', { target: target, e: e });\n        _target && target.fire('mouseout', { e: e });\n      });\n      this._hoveredTargets = [];\n    },\n\n    /**\n     * @private\n     * @param {Event} e Event object fired on mouseenter\n     */\n    _onMouseEnter: function(e) {\n      // This find target and consequent 'mouse:over' is used to\n      // clear old instances on hovered target.\n      // calling findTarget has the side effect of killing target.__corner.\n      // as a short term fix we are not firing this if we are currently transforming.\n      // as a long term fix we need to separate the action of finding a target with the\n      // side effects we added to it.\n      if (!this._currentTransform && !this.findTarget(e)) {\n        this.fire('mouse:over', { target: null, e: e });\n        this._hoveredTarget = null;\n        this._hoveredTargets = [];\n      }\n    },\n\n    /**\n     * @private\n     * @param {Event} [e] Event object fired on Event.js orientation change\n     * @param {Event} [self] Inner Event object\n     */\n    _onOrientationChange: function(e, self) {\n      this.__onOrientationChange && this.__onOrientationChange(e, self);\n    },\n\n    /**\n     * @private\n     * @param {Event} [e] Event object fired on Event.js shake\n     * @param {Event} [self] Inner Event object\n     */\n    _onShake: function(e, self) {\n      this.__onShake && this.__onShake(e, self);\n    },\n\n    /**\n     * @private\n     * @param {Event} [e] Event object fired on Event.js shake\n     * @param {Event} [self] Inner Event object\n     */\n    _onLongPress: function(e, self) {\n      this.__onLongPress && this.__onLongPress(e, self);\n    },\n\n    /**\n     * prevent default to allow drop event to be fired\n     * @private\n     * @param {Event} [e] Event object fired on Event.js shake\n     */\n    _onDragOver: function(e) {\n      e.preventDefault();\n      var target = this._simpleEventHandler('dragover', e);\n      this._fireEnterLeaveEvents(target, e);\n    },\n\n    /**\n     * `drop:before` is a an event that allow you to schedule logic\n     * before the `drop` event. Prefer `drop` event always, but if you need\n     * to run some drop-disabling logic on an event, since there is no way\n     * to handle event handlers ordering, use `drop:before`\n     * @param {Event} e\n     */\n    _onDrop: function (e) {\n      this._simpleEventHandler('drop:before', e);\n      return this._simpleEventHandler('drop', e);\n    },\n\n    /**\n     * @private\n     * @param {Event} e Event object fired on mousedown\n     */\n    _onContextMenu: function (e) {\n      if (this.stopContextMenu) {\n        e.stopPropagation();\n        e.preventDefault();\n      }\n      return false;\n    },\n\n    /**\n     * @private\n     * @param {Event} e Event object fired on mousedown\n     */\n    _onDoubleClick: function (e) {\n      this._cacheTransformEventData(e);\n      this._handleEvent(e, 'dblclick');\n      this._resetTransformEventData(e);\n    },\n\n    /**\n     * Return a the id of an event.\n     * returns either the pointerId or the identifier or 0 for the mouse event\n     * @private\n     * @param {Event} evt Event object\n     */\n    getPointerId: function(evt) {\n      var changedTouches = evt.changedTouches;\n\n      if (changedTouches) {\n        return changedTouches[0] && changedTouches[0].identifier;\n      }\n\n      if (this.enablePointerEvents) {\n        return evt.pointerId;\n      }\n\n      return -1;\n    },\n\n    /**\n     * Determines if an event has the id of the event that is considered main\n     * @private\n     * @param {evt} event Event object\n     */\n    _isMainEvent: function(evt) {\n      if (evt.isPrimary === true) {\n        return true;\n      }\n      if (evt.isPrimary === false) {\n        return false;\n      }\n      if (evt.type === 'touchend' && evt.touches.length === 0) {\n        return true;\n      }\n      if (evt.changedTouches) {\n        return evt.changedTouches[0].identifier === this.mainTouchId;\n      }\n      return true;\n    },\n\n    /**\n     * @private\n     * @param {Event} e Event object fired on mousedown\n     */\n    _onTouchStart: function(e) {\n      e.preventDefault();\n      if (this.mainTouchId === null) {\n        this.mainTouchId = this.getPointerId(e);\n      }\n      this.__onMouseDown(e);\n      this._resetTransformEventData();\n      var canvasElement = this.upperCanvasEl,\n          eventTypePrefix = this._getEventPrefix();\n      addListener(fabric.document, 'touchend', this._onTouchEnd, addEventOptions);\n      addListener(fabric.document, 'touchmove', this._onMouseMove, addEventOptions);\n      // Unbind mousedown to prevent double triggers from touch devices\n      removeListener(canvasElement, eventTypePrefix + 'down', this._onMouseDown);\n    },\n\n    /**\n     * @private\n     * @param {Event} e Event object fired on mousedown\n     */\n    _onMouseDown: function (e) {\n      this.__onMouseDown(e);\n      this._resetTransformEventData();\n      var canvasElement = this.upperCanvasEl,\n          eventTypePrefix = this._getEventPrefix();\n      removeListener(canvasElement, eventTypePrefix + 'move', this._onMouseMove, addEventOptions);\n      addListener(fabric.document, eventTypePrefix + 'up', this._onMouseUp);\n      addListener(fabric.document, eventTypePrefix + 'move', this._onMouseMove, addEventOptions);\n    },\n\n    /**\n     * @private\n     * @param {Event} e Event object fired on mousedown\n     */\n    _onTouchEnd: function(e) {\n      if (e.touches.length > 0) {\n        // if there are still touches stop here\n        return;\n      }\n      this.__onMouseUp(e);\n      this._resetTransformEventData();\n      this.mainTouchId = null;\n      var eventTypePrefix = this._getEventPrefix();\n      removeListener(fabric.document, 'touchend', this._onTouchEnd, addEventOptions);\n      removeListener(fabric.document, 'touchmove', this._onMouseMove, addEventOptions);\n      var _this = this;\n      if (this._willAddMouseDown) {\n        clearTimeout(this._willAddMouseDown);\n      }\n      this._willAddMouseDown = setTimeout(function() {\n        // Wait 400ms before rebinding mousedown to prevent double triggers\n        // from touch devices\n        addListener(_this.upperCanvasEl, eventTypePrefix + 'down', _this._onMouseDown);\n        _this._willAddMouseDown = 0;\n      }, 400);\n    },\n\n    /**\n     * @private\n     * @param {Event} e Event object fired on mouseup\n     */\n    _onMouseUp: function (e) {\n      this.__onMouseUp(e);\n      this._resetTransformEventData();\n      var canvasElement = this.upperCanvasEl,\n          eventTypePrefix = this._getEventPrefix();\n      if (this._isMainEvent(e)) {\n        removeListener(fabric.document, eventTypePrefix + 'up', this._onMouseUp);\n        removeListener(fabric.document, eventTypePrefix + 'move', this._onMouseMove, addEventOptions);\n        addListener(canvasElement, eventTypePrefix + 'move', this._onMouseMove, addEventOptions);\n      }\n    },\n\n    /**\n     * @private\n     * @param {Event} e Event object fired on mousemove\n     */\n    _onMouseMove: function (e) {\n      !this.allowTouchScrolling && e.preventDefault && e.preventDefault();\n      this.__onMouseMove(e);\n    },\n\n    /**\n     * @private\n     */\n    _onResize: function () {\n      this.calcOffset();\n    },\n\n    /**\n     * Decides whether the canvas should be redrawn in mouseup and mousedown events.\n     * @private\n     * @param {Object} target\n     */\n    _shouldRender: function(target) {\n      var activeObject = this._activeObject;\n\n      if (\n        !!activeObject !== !!target ||\n        (activeObject && target && (activeObject !== target))\n      ) {\n        // this covers: switch of target, from target to no target, selection of target\n        // multiSelection with key and mouse\n        return true;\n      }\n      else if (activeObject && activeObject.isEditing) {\n        // if we mouse up/down over a editing textbox a cursor change,\n        // there is no need to re render\n        return false;\n      }\n      return false;\n    },\n\n    /**\n     * Method that defines the actions when mouse is released on canvas.\n     * The method resets the currentTransform parameters, store the image corner\n     * position in the image object and render the canvas on top.\n     * @private\n     * @param {Event} e Event object fired on mouseup\n     */\n    __onMouseUp: function (e) {\n      var target, transform = this._currentTransform,\n          groupSelector = this._groupSelector, shouldRender = false,\n          isClick = (!groupSelector || (groupSelector.left === 0 && groupSelector.top === 0));\n      this._cacheTransformEventData(e);\n      target = this._target;\n      this._handleEvent(e, 'up:before');\n      // if right/middle click just fire events and return\n      // target undefined will make the _handleEvent search the target\n      if (checkClick(e, RIGHT_CLICK)) {\n        if (this.fireRightClick) {\n          this._handleEvent(e, 'up', RIGHT_CLICK, isClick);\n        }\n        return;\n      }\n\n      if (checkClick(e, MIDDLE_CLICK)) {\n        if (this.fireMiddleClick) {\n          this._handleEvent(e, 'up', MIDDLE_CLICK, isClick);\n        }\n        this._resetTransformEventData();\n        return;\n      }\n\n      if (this.isDrawingMode && this._isCurrentlyDrawing) {\n        this._onMouseUpInDrawingMode(e);\n        return;\n      }\n\n      if (!this._isMainEvent(e)) {\n        return;\n      }\n      if (transform) {\n        this._finalizeCurrentTransform(e);\n        shouldRender = transform.actionPerformed;\n      }\n      if (!isClick) {\n        var targetWasActive = target === this._activeObject;\n        this._maybeGroupObjects(e);\n        if (!shouldRender) {\n          shouldRender = (\n            this._shouldRender(target) ||\n            (!targetWasActive && target === this._activeObject)\n          );\n        }\n      }\n      var corner, pointer;\n      if (target) {\n        corner = target._findTargetCorner(\n          this.getPointer(e, true),\n          fabric.util.isTouchEvent(e)\n        );\n        if (target.selectable && target !== this._activeObject && target.activeOn === 'up') {\n          this.setActiveObject(target, e);\n          shouldRender = true;\n        }\n        else {\n          var control = target.controls[corner],\n              mouseUpHandler = control && control.getMouseUpHandler(e, target, control);\n          if (mouseUpHandler) {\n            pointer = this.getPointer(e);\n            mouseUpHandler(e, transform, pointer.x, pointer.y);\n          }\n        }\n        target.isMoving = false;\n      }\n      // if we are ending up a transform on a different control or a new object\n      // fire the original mouse up from the corner that started the transform\n      if (transform && (transform.target !== target || transform.corner !== corner)) {\n        var originalControl = transform.target && transform.target.controls[transform.corner],\n            originalMouseUpHandler = originalControl && originalControl.getMouseUpHandler(e, target, control);\n        pointer = pointer || this.getPointer(e);\n        originalMouseUpHandler && originalMouseUpHandler(e, transform, pointer.x, pointer.y);\n      }\n      this._setCursorFromEvent(e, target);\n      this._handleEvent(e, 'up', LEFT_CLICK, isClick);\n      this._groupSelector = null;\n      this._currentTransform = null;\n      // reset the target information about which corner is selected\n      target && (target.__corner = 0);\n      if (shouldRender) {\n        this.requestRenderAll();\n      }\n      else if (!isClick) {\n        this.renderTop();\n      }\n    },\n\n    /**\n     * @private\n     * Handle event firing for target and subtargets\n     * @param {Event} e event from mouse\n     * @param {String} eventType event to fire (up, down or move)\n     * @return {Fabric.Object} target return the the target found, for internal reasons.\n     */\n    _simpleEventHandler: function(eventType, e) {\n      var target = this.findTarget(e),\n          targets = this.targets,\n          options = {\n            e: e,\n            target: target,\n            subTargets: targets,\n          };\n      this.fire(eventType, options);\n      target && target.fire(eventType, options);\n      if (!targets) {\n        return target;\n      }\n      for (var i = 0; i < targets.length; i++) {\n        targets[i].fire(eventType, options);\n      }\n      return target;\n    },\n\n    /**\n     * @private\n     * Handle event firing for target and subtargets\n     * @param {Event} e event from mouse\n     * @param {String} eventType event to fire (up, down or move)\n     * @param {fabric.Object} targetObj receiving event\n     * @param {Number} [button] button used in the event 1 = left, 2 = middle, 3 = right\n     * @param {Boolean} isClick for left button only, indicates that the mouse up happened without move.\n     */\n    _handleEvent: function(e, eventType, button, isClick) {\n      var target = this._target,\n          targets = this.targets || [],\n          options = {\n            e: e,\n            target: target,\n            subTargets: targets,\n            button: button || LEFT_CLICK,\n            isClick: isClick || false,\n            pointer: this._pointer,\n            absolutePointer: this._absolutePointer,\n            transform: this._currentTransform\n          };\n      if (eventType === 'up') {\n        options.currentTarget = this.findTarget(e);\n        options.currentSubTargets = this.targets;\n      }\n      this.fire('mouse:' + eventType, options);\n      target && target.fire('mouse' + eventType, options);\n      for (var i = 0; i < targets.length; i++) {\n        targets[i].fire('mouse' + eventType, options);\n      }\n    },\n\n    /**\n     * @private\n     * @param {Event} e send the mouse event that generate the finalize down, so it can be used in the event\n     */\n    _finalizeCurrentTransform: function(e) {\n\n      var transform = this._currentTransform,\n          target = transform.target,\n          options = {\n            e: e,\n            target: target,\n            transform: transform,\n            action: transform.action,\n          };\n\n      if (target._scaling) {\n        target._scaling = false;\n      }\n\n      target.setCoords();\n\n      if (transform.actionPerformed || (this.stateful && target.hasStateChanged())) {\n        this._fire('modified', options);\n      }\n    },\n\n    /**\n     * @private\n     * @param {Event} e Event object fired on mousedown\n     */\n    _onMouseDownInDrawingMode: function(e) {\n      this._isCurrentlyDrawing = true;\n      if (this.getActiveObject()) {\n        this.discardActiveObject(e).requestRenderAll();\n      }\n      var pointer = this.getPointer(e);\n      this.freeDrawingBrush.onMouseDown(pointer, { e: e, pointer: pointer });\n      this._handleEvent(e, 'down');\n    },\n\n    /**\n     * @private\n     * @param {Event} e Event object fired on mousemove\n     */\n    _onMouseMoveInDrawingMode: function(e) {\n      if (this._isCurrentlyDrawing) {\n        var pointer = this.getPointer(e);\n        this.freeDrawingBrush.onMouseMove(pointer, { e: e, pointer: pointer });\n      }\n      this.setCursor(this.freeDrawingCursor);\n      this._handleEvent(e, 'move');\n    },\n\n    /**\n     * @private\n     * @param {Event} e Event object fired on mouseup\n     */\n    _onMouseUpInDrawingMode: function(e) {\n      var pointer = this.getPointer(e);\n      this._isCurrentlyDrawing = this.freeDrawingBrush.onMouseUp({ e: e, pointer: pointer });\n      this._handleEvent(e, 'up');\n    },\n\n    /**\n     * Method that defines the actions when mouse is clicked on canvas.\n     * The method inits the currentTransform parameters and renders all the\n     * canvas so the current image can be placed on the top canvas and the rest\n     * in on the container one.\n     * @private\n     * @param {Event} e Event object fired on mousedown\n     */\n    __onMouseDown: function (e) {\n      this._cacheTransformEventData(e);\n      this._handleEvent(e, 'down:before');\n      var target = this._target;\n      // if right click just fire events\n      if (checkClick(e, RIGHT_CLICK)) {\n        if (this.fireRightClick) {\n          this._handleEvent(e, 'down', RIGHT_CLICK);\n        }\n        return;\n      }\n\n      if (checkClick(e, MIDDLE_CLICK)) {\n        if (this.fireMiddleClick) {\n          this._handleEvent(e, 'down', MIDDLE_CLICK);\n        }\n        return;\n      }\n\n      if (this.isDrawingMode) {\n        this._onMouseDownInDrawingMode(e);\n        return;\n      }\n\n      if (!this._isMainEvent(e)) {\n        return;\n      }\n\n      // ignore if some object is being transformed at this moment\n      if (this._currentTransform) {\n        return;\n      }\n\n      var pointer = this._pointer;\n      // save pointer for check in __onMouseUp event\n      this._previousPointer = pointer;\n      var shouldRender = this._shouldRender(target),\n          shouldGroup = this._shouldGroup(e, target);\n      if (this._shouldClearSelection(e, target)) {\n        this.discardActiveObject(e);\n      }\n      else if (shouldGroup) {\n        this._handleGrouping(e, target);\n        target = this._activeObject;\n      }\n\n      if (this.selection && (!target ||\n        (!target.selectable && !target.isEditing && target !== this._activeObject))) {\n        this._groupSelector = {\n          ex: this._absolutePointer.x,\n          ey: this._absolutePointer.y,\n          top: 0,\n          left: 0\n        };\n      }\n\n      if (target) {\n        var alreadySelected = target === this._activeObject;\n        if (target.selectable && target.activeOn === 'down') {\n          this.setActiveObject(target, e);\n        }\n        var corner = target._findTargetCorner(\n          this.getPointer(e, true),\n          fabric.util.isTouchEvent(e)\n        );\n        target.__corner = corner;\n        if (target === this._activeObject && (corner || !shouldGroup)) {\n          this._setupCurrentTransform(e, target, alreadySelected);\n          var control = target.controls[corner],\n              pointer = this.getPointer(e),\n              mouseDownHandler = control && control.getMouseDownHandler(e, target, control);\n          if (mouseDownHandler) {\n            mouseDownHandler(e, this._currentTransform, pointer.x, pointer.y);\n          }\n        }\n      }\n      this._handleEvent(e, 'down');\n      // we must renderAll so that we update the visuals\n      (shouldRender || shouldGroup) && this.requestRenderAll();\n    },\n\n    /**\n     * reset cache form common information needed during event processing\n     * @private\n     */\n    _resetTransformEventData: function() {\n      this._target = null;\n      this._pointer = null;\n      this._absolutePointer = null;\n    },\n\n    /**\n     * Cache common information needed during event processing\n     * @private\n     * @param {Event} e Event object fired on event\n     */\n    _cacheTransformEventData: function(e) {\n      // reset in order to avoid stale caching\n      this._resetTransformEventData();\n      this._pointer = this.getPointer(e, true);\n      this._absolutePointer = this.restorePointerVpt(this._pointer);\n      this._target = this._currentTransform ? this._currentTransform.target : this.findTarget(e) || null;\n    },\n\n    /**\n     * @private\n     */\n    _beforeTransform: function(e) {\n      var t = this._currentTransform;\n      this.stateful && t.target.saveState();\n      this.fire('before:transform', {\n        e: e,\n        transform: t,\n      });\n    },\n\n    /**\n     * Method that defines the actions when mouse is hovering the canvas.\n     * The currentTransform parameter will define whether the user is rotating/scaling/translating\n     * an image or neither of them (only hovering). A group selection is also possible and would cancel\n     * all any other type of action.\n     * In case of an image transformation only the top canvas will be rendered.\n     * @private\n     * @param {Event} e Event object fired on mousemove\n     */\n    __onMouseMove: function (e) {\n      this._handleEvent(e, 'move:before');\n      this._cacheTransformEventData(e);\n      var target, pointer;\n\n      if (this.isDrawingMode) {\n        this._onMouseMoveInDrawingMode(e);\n        return;\n      }\n\n      if (!this._isMainEvent(e)) {\n        return;\n      }\n\n      var groupSelector = this._groupSelector;\n\n      // We initially clicked in an empty area, so we draw a box for multiple selection\n      if (groupSelector) {\n        pointer = this._absolutePointer;\n\n        groupSelector.left = pointer.x - groupSelector.ex;\n        groupSelector.top = pointer.y - groupSelector.ey;\n\n        this.renderTop();\n      }\n      else if (!this._currentTransform) {\n        target = this.findTarget(e) || null;\n        this._setCursorFromEvent(e, target);\n        this._fireOverOutEvents(target, e);\n      }\n      else {\n        this._transformObject(e);\n      }\n      this._handleEvent(e, 'move');\n      this._resetTransformEventData();\n    },\n\n    /**\n     * Manage the mouseout, mouseover events for the fabric object on the canvas\n     * @param {Fabric.Object} target the target where the target from the mousemove event\n     * @param {Event} e Event object fired on mousemove\n     * @private\n     */\n    _fireOverOutEvents: function(target, e) {\n      var _hoveredTarget = this._hoveredTarget,\n          _hoveredTargets = this._hoveredTargets, targets = this.targets,\n          length = Math.max(_hoveredTargets.length, targets.length);\n\n      this.fireSyntheticInOutEvents(target, e, {\n        oldTarget: _hoveredTarget,\n        evtOut: 'mouseout',\n        canvasEvtOut: 'mouse:out',\n        evtIn: 'mouseover',\n        canvasEvtIn: 'mouse:over',\n      });\n      for (var i = 0; i < length; i++){\n        this.fireSyntheticInOutEvents(targets[i], e, {\n          oldTarget: _hoveredTargets[i],\n          evtOut: 'mouseout',\n          evtIn: 'mouseover',\n        });\n      }\n      this._hoveredTarget = target;\n      this._hoveredTargets = this.targets.concat();\n    },\n\n    /**\n     * Manage the dragEnter, dragLeave events for the fabric objects on the canvas\n     * @param {Fabric.Object} target the target where the target from the onDrag event\n     * @param {Event} e Event object fired on ondrag\n     * @private\n     */\n    _fireEnterLeaveEvents: function(target, e) {\n      var _draggedoverTarget = this._draggedoverTarget,\n          _hoveredTargets = this._hoveredTargets, targets = this.targets,\n          length = Math.max(_hoveredTargets.length, targets.length);\n\n      this.fireSyntheticInOutEvents(target, e, {\n        oldTarget: _draggedoverTarget,\n        evtOut: 'dragleave',\n        evtIn: 'dragenter',\n      });\n      for (var i = 0; i < length; i++) {\n        this.fireSyntheticInOutEvents(targets[i], e, {\n          oldTarget: _hoveredTargets[i],\n          evtOut: 'dragleave',\n          evtIn: 'dragenter',\n        });\n      }\n      this._draggedoverTarget = target;\n    },\n\n    /**\n     * Manage the synthetic in/out events for the fabric objects on the canvas\n     * @param {Fabric.Object} target the target where the target from the supported events\n     * @param {Event} e Event object fired\n     * @param {Object} config configuration for the function to work\n     * @param {String} config.targetName property on the canvas where the old target is stored\n     * @param {String} [config.canvasEvtOut] name of the event to fire at canvas level for out\n     * @param {String} config.evtOut name of the event to fire for out\n     * @param {String} [config.canvasEvtIn] name of the event to fire at canvas level for in\n     * @param {String} config.evtIn name of the event to fire for in\n     * @private\n     */\n    fireSyntheticInOutEvents: function(target, e, config) {\n      var inOpt, outOpt, oldTarget = config.oldTarget, outFires, inFires,\n          targetChanged = oldTarget !== target, canvasEvtIn = config.canvasEvtIn, canvasEvtOut = config.canvasEvtOut;\n      if (targetChanged) {\n        inOpt = { e: e, target: target, previousTarget: oldTarget };\n        outOpt = { e: e, target: oldTarget, nextTarget: target };\n      }\n      inFires = target && targetChanged;\n      outFires = oldTarget && targetChanged;\n      if (outFires) {\n        canvasEvtOut && this.fire(canvasEvtOut, outOpt);\n        oldTarget.fire(config.evtOut, outOpt);\n      }\n      if (inFires) {\n        canvasEvtIn && this.fire(canvasEvtIn, inOpt);\n        target.fire(config.evtIn, inOpt);\n      }\n    },\n\n    /**\n     * Method that defines actions when an Event Mouse Wheel\n     * @param {Event} e Event object fired on mouseup\n     */\n    __onMouseWheel: function(e) {\n      this._cacheTransformEventData(e);\n      this._handleEvent(e, 'wheel');\n      this._resetTransformEventData();\n    },\n\n    /**\n     * @private\n     * @param {Event} e Event fired on mousemove\n     */\n    _transformObject: function(e) {\n      var pointer = this.getPointer(e),\n          transform = this._currentTransform;\n\n      transform.reset = false;\n      transform.shiftKey = e.shiftKey;\n      transform.altKey = e[this.centeredKey];\n\n      this._performTransformAction(e, transform, pointer);\n      transform.actionPerformed && this.requestRenderAll();\n    },\n\n    /**\n     * @private\n     */\n    _performTransformAction: function(e, transform, pointer) {\n      var x = pointer.x,\n          y = pointer.y,\n          action = transform.action,\n          actionPerformed = false,\n          actionHandler = transform.actionHandler;\n          // this object could be created from the function in the control handlers\n\n\n      if (actionHandler) {\n        actionPerformed = actionHandler(e, transform, x, y);\n      }\n      if (action === 'drag' && actionPerformed) {\n        transform.target.isMoving = true;\n        this.setCursor(transform.target.moveCursor || this.moveCursor);\n      }\n      transform.actionPerformed = transform.actionPerformed || actionPerformed;\n    },\n\n    /**\n     * @private\n     */\n    _fire: fabric.controlsUtils.fireEvent,\n\n    /**\n     * Sets the cursor depending on where the canvas is being hovered.\n     * Note: very buggy in Opera\n     * @param {Event} e Event object\n     * @param {Object} target Object that the mouse is hovering, if so.\n     */\n    _setCursorFromEvent: function (e, target) {\n      if (!target) {\n        this.setCursor(this.defaultCursor);\n        return false;\n      }\n      var hoverCursor = target.hoverCursor || this.hoverCursor,\n          activeSelection = this._activeObject && this._activeObject.type === 'activeSelection' ?\n            this._activeObject : null,\n          // only show proper corner when group selection is not active\n          corner = (!activeSelection || !activeSelection.contains(target))\n          // here we call findTargetCorner always with undefined for the touch parameter.\n          // we assume that if you are using a cursor you do not need to interact with\n          // the bigger touch area.\n                    && target._findTargetCorner(this.getPointer(e, true));\n\n      if (!corner) {\n        if (target.subTargetCheck){\n          // hoverCursor should come from top-most subTarget,\n          // so we walk the array backwards\n          this.targets.concat().reverse().map(function(_target){\n            hoverCursor = _target.hoverCursor || hoverCursor;\n          });\n        }\n        this.setCursor(hoverCursor);\n      }\n      else {\n        this.setCursor(this.getCornerCursor(corner, target, e));\n      }\n    },\n\n    /**\n     * @private\n     */\n    getCornerCursor: function(corner, target, e) {\n      var control = target.controls[corner];\n      return control.cursorStyleHandler(e, control, target);\n    }\n  });\n})();\n\n\n(function() {\n\n  var min = Math.min,\n      max = Math.max;\n\n  fabric.util.object.extend(fabric.Canvas.prototype, /** @lends fabric.Canvas.prototype */ {\n\n    /**\n     * @private\n     * @param {Event} e Event object\n     * @param {fabric.Object} target\n     * @return {Boolean}\n     */\n    _shouldGroup: function(e, target) {\n      var activeObject = this._activeObject;\n      return activeObject && this._isSelectionKeyPressed(e) && target && target.selectable && this.selection &&\n            (activeObject !== target || activeObject.type === 'activeSelection') && !target.onSelect({ e: e });\n    },\n\n    /**\n     * @private\n     * @param {Event} e Event object\n     * @param {fabric.Object} target\n     */\n    _handleGrouping: function (e, target) {\n      var activeObject = this._activeObject;\n      // avoid multi select when shift click on a corner\n      if (activeObject.__corner) {\n        return;\n      }\n      if (target === activeObject) {\n        // if it's a group, find target again, using activeGroup objects\n        target = this.findTarget(e, true);\n        // if even object is not found or we are on activeObjectCorner, bail out\n        if (!target || !target.selectable) {\n          return;\n        }\n      }\n      if (activeObject && activeObject.type === 'activeSelection') {\n        this._updateActiveSelection(target, e);\n      }\n      else {\n        this._createActiveSelection(target, e);\n      }\n    },\n\n    /**\n     * @private\n     */\n    _updateActiveSelection: function(target, e) {\n      var activeSelection = this._activeObject,\n          currentActiveObjects = activeSelection._objects.slice(0);\n      if (activeSelection.contains(target)) {\n        activeSelection.removeWithUpdate(target);\n        this._hoveredTarget = target;\n        this._hoveredTargets = this.targets.concat();\n        if (activeSelection.size() === 1) {\n          // activate last remaining object\n          this._setActiveObject(activeSelection.item(0), e);\n        }\n      }\n      else {\n        activeSelection.addWithUpdate(target);\n        this._hoveredTarget = activeSelection;\n        this._hoveredTargets = this.targets.concat();\n      }\n      this._fireSelectionEvents(currentActiveObjects, e);\n    },\n\n    /**\n     * @private\n     */\n    _createActiveSelection: function(target, e) {\n      var currentActives = this.getActiveObjects(), group = this._createGroup(target);\n      this._hoveredTarget = group;\n      // ISSUE 4115: should we consider subTargets here?\n      // this._hoveredTargets = [];\n      // this._hoveredTargets = this.targets.concat();\n      this._setActiveObject(group, e);\n      this._fireSelectionEvents(currentActives, e);\n    },\n\n    /**\n     * @private\n     * @param {Object} target\n     */\n    _createGroup: function(target) {\n      var objects = this._objects,\n          isActiveLower = objects.indexOf(this._activeObject) < objects.indexOf(target),\n          groupObjects = isActiveLower\n            ? [this._activeObject, target]\n            : [target, this._activeObject];\n      this._activeObject.isEditing && this._activeObject.exitEditing();\n      return new fabric.ActiveSelection(groupObjects, {\n        canvas: this\n      });\n    },\n\n    /**\n     * @private\n     * @param {Event} e mouse event\n     */\n    _groupSelectedObjects: function (e) {\n\n      var group = this._collectObjects(e),\n          aGroup;\n\n      // do not create group for 1 element only\n      if (group.length === 1) {\n        this.setActiveObject(group[0], e);\n      }\n      else if (group.length > 1) {\n        aGroup = new fabric.ActiveSelection(group.reverse(), {\n          canvas: this\n        });\n        this.setActiveObject(aGroup, e);\n      }\n    },\n\n    /**\n     * @private\n     */\n    _collectObjects: function(e) {\n      var group = [],\n          currentObject,\n          x1 = this._groupSelector.ex,\n          y1 = this._groupSelector.ey,\n          x2 = x1 + this._groupSelector.left,\n          y2 = y1 + this._groupSelector.top,\n          selectionX1Y1 = new fabric.Point(min(x1, x2), min(y1, y2)),\n          selectionX2Y2 = new fabric.Point(max(x1, x2), max(y1, y2)),\n          allowIntersect = !this.selectionFullyContained,\n          isClick = x1 === x2 && y1 === y2;\n      // we iterate reverse order to collect top first in case of click.\n      for (var i = this._objects.length; i--; ) {\n        currentObject = this._objects[i];\n\n        if (!currentObject || !currentObject.selectable || !currentObject.visible) {\n          continue;\n        }\n\n        if ((allowIntersect && currentObject.intersectsWithRect(selectionX1Y1, selectionX2Y2, true)) ||\n            currentObject.isContainedWithinRect(selectionX1Y1, selectionX2Y2, true) ||\n            (allowIntersect && currentObject.containsPoint(selectionX1Y1, null, true)) ||\n            (allowIntersect && currentObject.containsPoint(selectionX2Y2, null, true))\n        ) {\n          group.push(currentObject);\n          // only add one object if it's a click\n          if (isClick) {\n            break;\n          }\n        }\n      }\n\n      if (group.length > 1) {\n        group = group.filter(function(object) {\n          return !object.onSelect({ e: e });\n        });\n      }\n\n      return group;\n    },\n\n    /**\n     * @private\n     */\n    _maybeGroupObjects: function(e) {\n      if (this.selection && this._groupSelector) {\n        this._groupSelectedObjects(e);\n      }\n      this.setCursor(this.defaultCursor);\n      // clear selection and current transformation\n      this._groupSelector = null;\n    }\n  });\n\n})();\n\n\n(function () {\n  fabric.util.object.extend(fabric.StaticCanvas.prototype, /** @lends fabric.StaticCanvas.prototype */ {\n\n    /**\n     * Exports canvas element to a dataurl image. Note that when multiplier is used, cropping is scaled appropriately\n     * @param {Object} [options] Options object\n     * @param {String} [options.format=png] The format of the output image. Either \"jpeg\" or \"png\"\n     * @param {Number} [options.quality=1] Quality level (0..1). Only used for jpeg.\n     * @param {Number} [options.multiplier=1] Multiplier to scale by, to have consistent\n     * @param {Number} [options.left] Cropping left offset. Introduced in v1.2.14\n     * @param {Number} [options.top] Cropping top offset. Introduced in v1.2.14\n     * @param {Number} [options.width] Cropping width. Introduced in v1.2.14\n     * @param {Number} [options.height] Cropping height. Introduced in v1.2.14\n     * @param {Boolean} [options.enableRetinaScaling] Enable retina scaling for clone image. Introduce in 2.0.0\n     * @return {String} Returns a data: URL containing a representation of the object in the format specified by options.format\n     * @see {@link http://jsfiddle.net/fabricjs/NfZVb/|jsFiddle demo}\n     * @example <caption>Generate jpeg dataURL with lower quality</caption>\n     * var dataURL = canvas.toDataURL({\n     *   format: 'jpeg',\n     *   quality: 0.8\n     * });\n     * @example <caption>Generate cropped png dataURL (clipping of canvas)</caption>\n     * var dataURL = canvas.toDataURL({\n     *   format: 'png',\n     *   left: 100,\n     *   top: 100,\n     *   width: 200,\n     *   height: 200\n     * });\n     * @example <caption>Generate double scaled png dataURL</caption>\n     * var dataURL = canvas.toDataURL({\n     *   format: 'png',\n     *   multiplier: 2\n     * });\n     */\n    toDataURL: function (options) {\n      options || (options = { });\n\n      var format = options.format || 'png',\n          quality = options.quality || 1,\n          multiplier = (options.multiplier || 1) * (options.enableRetinaScaling ? this.getRetinaScaling() : 1),\n          canvasEl = this.toCanvasElement(multiplier, options);\n      return fabric.util.toDataURL(canvasEl, format, quality);\n    },\n\n    /**\n     * Create a new HTMLCanvas element painted with the current canvas content.\n     * No need to resize the actual one or repaint it.\n     * Will transfer object ownership to a new canvas, paint it, and set everything back.\n     * This is an intermediary step used to get to a dataUrl but also it is useful to\n     * create quick image copies of a canvas without passing for the dataUrl string\n     * @param {Number} [multiplier] a zoom factor.\n     * @param {Object} [cropping] Cropping informations\n     * @param {Number} [cropping.left] Cropping left offset.\n     * @param {Number} [cropping.top] Cropping top offset.\n     * @param {Number} [cropping.width] Cropping width.\n     * @param {Number} [cropping.height] Cropping height.\n     */\n    toCanvasElement: function(multiplier, cropping) {\n      multiplier = multiplier || 1;\n      cropping = cropping || { };\n      var scaledWidth = (cropping.width || this.width) * multiplier,\n          scaledHeight = (cropping.height || this.height) * multiplier,\n          zoom = this.getZoom(),\n          originalWidth = this.width,\n          originalHeight = this.height,\n          newZoom = zoom * multiplier,\n          vp = this.viewportTransform,\n          translateX = (vp[4] - (cropping.left || 0)) * multiplier,\n          translateY = (vp[5] - (cropping.top || 0)) * multiplier,\n          originalInteractive = this.interactive,\n          newVp = [newZoom, 0, 0, newZoom, translateX, translateY],\n          originalRetina = this.enableRetinaScaling,\n          canvasEl = fabric.util.createCanvasElement(),\n          originalContextTop = this.contextTop;\n      canvasEl.width = scaledWidth;\n      canvasEl.height = scaledHeight;\n      this.contextTop = null;\n      this.enableRetinaScaling = false;\n      this.interactive = false;\n      this.viewportTransform = newVp;\n      this.width = scaledWidth;\n      this.height = scaledHeight;\n      this.calcViewportBoundaries();\n      this.renderCanvas(canvasEl.getContext('2d'), this._objects);\n      this.viewportTransform = vp;\n      this.width = originalWidth;\n      this.height = originalHeight;\n      this.calcViewportBoundaries();\n      this.interactive = originalInteractive;\n      this.enableRetinaScaling = originalRetina;\n      this.contextTop = originalContextTop;\n      return canvasEl;\n    },\n  });\n\n})();\n\n\nfabric.util.object.extend(fabric.StaticCanvas.prototype, /** @lends fabric.StaticCanvas.prototype */ {\n  /**\n   * Populates canvas with data from the specified JSON.\n   * JSON format must conform to the one of {@link fabric.Canvas#toJSON}\n   * @param {String|Object} json JSON string or object\n   * @param {Function} callback Callback, invoked when json is parsed\n   *                            and corresponding objects (e.g: {@link fabric.Image})\n   *                            are initialized\n   * @param {Function} [reviver] Method for further parsing of JSON elements, called after each fabric object created.\n   * @return {fabric.Canvas} instance\n   * @chainable\n   * @tutorial {@link http://fabricjs.com/fabric-intro-part-3#deserialization}\n   * @see {@link http://jsfiddle.net/fabricjs/fmgXt/|jsFiddle demo}\n   * @example <caption>loadFromJSON</caption>\n   * canvas.loadFromJSON(json, canvas.renderAll.bind(canvas));\n   * @example <caption>loadFromJSON with reviver</caption>\n   * canvas.loadFromJSON(json, canvas.renderAll.bind(canvas), function(o, object) {\n   *   // `o` = json object\n   *   // `object` = fabric.Object instance\n   *   // ... do some stuff ...\n   * });\n   */\n  loadFromJSON: function (json, callback, reviver) {\n    if (!json) {\n      return;\n    }\n\n    // serialize if it wasn't already\n    var serialized = (typeof json === 'string')\n      ? JSON.parse(json)\n      : fabric.util.object.clone(json);\n\n    var _this = this,\n        clipPath = serialized.clipPath,\n        renderOnAddRemove = this.renderOnAddRemove;\n\n    this.renderOnAddRemove = false;\n\n    delete serialized.clipPath;\n\n    this._enlivenObjects(serialized.objects, function (enlivenedObjects) {\n      _this.clear();\n      _this._setBgOverlay(serialized, function () {\n        if (clipPath) {\n          _this._enlivenObjects([clipPath], function (enlivenedCanvasClip) {\n            _this.clipPath = enlivenedCanvasClip[0];\n            _this.__setupCanvas.call(_this, serialized, enlivenedObjects, renderOnAddRemove, callback);\n          });\n        }\n        else {\n          _this.__setupCanvas.call(_this, serialized, enlivenedObjects, renderOnAddRemove, callback);\n        }\n      });\n    }, reviver);\n    return this;\n  },\n\n  /**\n   * @private\n   * @param {Object} serialized Object with background and overlay information\n   * @param {Array} restored canvas objects\n   * @param {Function} cached renderOnAddRemove callback\n   * @param {Function} callback Invoked after all background and overlay images/patterns loaded\n   */\n  __setupCanvas: function(serialized, enlivenedObjects, renderOnAddRemove, callback) {\n    var _this = this;\n    enlivenedObjects.forEach(function(obj, index) {\n      // we splice the array just in case some custom classes restored from JSON\n      // will add more object to canvas at canvas init.\n      _this.insertAt(obj, index);\n    });\n    this.renderOnAddRemove = renderOnAddRemove;\n    // remove parts i cannot set as options\n    delete serialized.objects;\n    delete serialized.backgroundImage;\n    delete serialized.overlayImage;\n    delete serialized.background;\n    delete serialized.overlay;\n    // this._initOptions does too many things to just\n    // call it. Normally loading an Object from JSON\n    // create the Object instance. Here the Canvas is\n    // already an instance and we are just loading things over it\n    this._setOptions(serialized);\n    this.renderAll();\n    callback && callback();\n  },\n\n  /**\n   * @private\n   * @param {Object} serialized Object with background and overlay information\n   * @param {Function} callback Invoked after all background and overlay images/patterns loaded\n   */\n  _setBgOverlay: function(serialized, callback) {\n    var loaded = {\n      backgroundColor: false,\n      overlayColor: false,\n      backgroundImage: false,\n      overlayImage: false\n    };\n\n    if (!serialized.backgroundImage && !serialized.overlayImage && !serialized.background && !serialized.overlay) {\n      callback && callback();\n      return;\n    }\n\n    var cbIfLoaded = function () {\n      if (loaded.backgroundImage && loaded.overlayImage && loaded.backgroundColor && loaded.overlayColor) {\n        callback && callback();\n      }\n    };\n\n    this.__setBgOverlay('backgroundImage', serialized.backgroundImage, loaded, cbIfLoaded);\n    this.__setBgOverlay('overlayImage', serialized.overlayImage, loaded, cbIfLoaded);\n    this.__setBgOverlay('backgroundColor', serialized.background, loaded, cbIfLoaded);\n    this.__setBgOverlay('overlayColor', serialized.overlay, loaded, cbIfLoaded);\n  },\n\n  /**\n   * @private\n   * @param {String} property Property to set (backgroundImage, overlayImage, backgroundColor, overlayColor)\n   * @param {(Object|String)} value Value to set\n   * @param {Object} loaded Set loaded property to true if property is set\n   * @param {Object} callback Callback function to invoke after property is set\n   */\n  __setBgOverlay: function(property, value, loaded, callback) {\n    var _this = this;\n\n    if (!value) {\n      loaded[property] = true;\n      callback && callback();\n      return;\n    }\n\n    if (property === 'backgroundImage' || property === 'overlayImage') {\n      fabric.util.enlivenObjects([value], function(enlivedObject){\n        _this[property] = enlivedObject[0];\n        loaded[property] = true;\n        callback && callback();\n      });\n    }\n    else {\n      this['set' + fabric.util.string.capitalize(property, true)](value, function() {\n        loaded[property] = true;\n        callback && callback();\n      });\n    }\n  },\n\n  /**\n   * @private\n   * @param {Array} objects\n   * @param {Function} callback\n   * @param {Function} [reviver]\n   */\n  _enlivenObjects: function (objects, callback, reviver) {\n    if (!objects || objects.length === 0) {\n      callback && callback([]);\n      return;\n    }\n\n    fabric.util.enlivenObjects(objects, function(enlivenedObjects) {\n      callback && callback(enlivenedObjects);\n    }, null, reviver);\n  },\n\n  /**\n   * @private\n   * @param {String} format\n   * @param {Function} callback\n   */\n  _toDataURL: function (format, callback) {\n    this.clone(function (clone) {\n      callback(clone.toDataURL(format));\n    });\n  },\n\n  /**\n   * @private\n   * @param {String} format\n   * @param {Number} multiplier\n   * @param {Function} callback\n   */\n  _toDataURLWithMultiplier: function (format, multiplier, callback) {\n    this.clone(function (clone) {\n      callback(clone.toDataURLWithMultiplier(format, multiplier));\n    });\n  },\n\n  /**\n   * Clones canvas instance\n   * @param {Object} [callback] Receives cloned instance as a first argument\n   * @param {Array} [properties] Array of properties to include in the cloned canvas and children\n   */\n  clone: function (callback, properties) {\n    var data = JSON.stringify(this.toJSON(properties));\n    this.cloneWithoutData(function(clone) {\n      clone.loadFromJSON(data, function() {\n        callback && callback(clone);\n      });\n    });\n  },\n\n  /**\n   * Clones canvas instance without cloning existing data.\n   * This essentially copies canvas dimensions, clipping properties, etc.\n   * but leaves data empty (so that you can populate it with your own)\n   * @param {Object} [callback] Receives cloned instance as a first argument\n   */\n  cloneWithoutData: function(callback) {\n    var el = fabric.util.createCanvasElement();\n\n    el.width = this.width;\n    el.height = this.height;\n\n    var clone = new fabric.Canvas(el);\n    if (this.backgroundImage) {\n      clone.setBackgroundImage(this.backgroundImage.src, function() {\n        clone.renderAll();\n        callback && callback(clone);\n      });\n      clone.backgroundImageOpacity = this.backgroundImageOpacity;\n      clone.backgroundImageStretch = this.backgroundImageStretch;\n    }\n    else {\n      callback && callback(clone);\n    }\n  }\n});\n\n\n(function(global) {\n\n  'use strict';\n\n  var fabric = global.fabric || (global.fabric = { }),\n      extend = fabric.util.object.extend,\n      clone = fabric.util.object.clone,\n      toFixed = fabric.util.toFixed,\n      capitalize = fabric.util.string.capitalize,\n      degreesToRadians = fabric.util.degreesToRadians,\n      objectCaching = !fabric.isLikelyNode,\n      ALIASING_LIMIT = 2;\n\n  if (fabric.Object) {\n    return;\n  }\n\n  /**\n   * Root object class from which all 2d shape classes inherit from\n   * @class fabric.Object\n   * @tutorial {@link http://fabricjs.com/fabric-intro-part-1#objects}\n   * @see {@link fabric.Object#initialize} for constructor definition\n   *\n   * @fires added\n   * @fires removed\n   *\n   * @fires selected\n   * @fires deselected\n   * @fires modified\n   * @fires modified\n   * @fires moved\n   * @fires scaled\n   * @fires rotated\n   * @fires skewed\n   *\n   * @fires rotating\n   * @fires scaling\n   * @fires moving\n   * @fires skewing\n   *\n   * @fires mousedown\n   * @fires mouseup\n   * @fires mouseover\n   * @fires mouseout\n   * @fires mousewheel\n   * @fires mousedblclick\n   *\n   * @fires dragover\n   * @fires dragenter\n   * @fires dragleave\n   * @fires drop\n   */\n  fabric.Object = fabric.util.createClass(fabric.CommonMethods, /** @lends fabric.Object.prototype */ {\n\n    /**\n     * Type of an object (rect, circle, path, etc.).\n     * Note that this property is meant to be read-only and not meant to be modified.\n     * If you modify, certain parts of Fabric (such as JSON loading) won't work correctly.\n     * @type String\n     * @default\n     */\n    type:                     'object',\n\n    /**\n     * Horizontal origin of transformation of an object (one of \"left\", \"right\", \"center\")\n     * See http://jsfiddle.net/1ow02gea/244/ on how originX/originY affect objects in groups\n     * @type String\n     * @default\n     */\n    originX:                  'left',\n\n    /**\n     * Vertical origin of transformation of an object (one of \"top\", \"bottom\", \"center\")\n     * See http://jsfiddle.net/1ow02gea/244/ on how originX/originY affect objects in groups\n     * @type String\n     * @default\n     */\n    originY:                  'top',\n\n    /**\n     * Top position of an object. Note that by default it's relative to object top. You can change this by setting originY={top/center/bottom}\n     * @type Number\n     * @default\n     */\n    top:                      0,\n\n    /**\n     * Left position of an object. Note that by default it's relative to object left. You can change this by setting originX={left/center/right}\n     * @type Number\n     * @default\n     */\n    left:                     0,\n\n    /**\n     * Object width\n     * @type Number\n     * @default\n     */\n    width:                    0,\n\n    /**\n     * Object height\n     * @type Number\n     * @default\n     */\n    height:                   0,\n\n    /**\n     * Object scale factor (horizontal)\n     * @type Number\n     * @default\n     */\n    scaleX:                   1,\n\n    /**\n     * Object scale factor (vertical)\n     * @type Number\n     * @default\n     */\n    scaleY:                   1,\n\n    /**\n     * When true, an object is rendered as flipped horizontally\n     * @type Boolean\n     * @default\n     */\n    flipX:                    false,\n\n    /**\n     * When true, an object is rendered as flipped vertically\n     * @type Boolean\n     * @default\n     */\n    flipY:                    false,\n\n    /**\n     * Opacity of an object\n     * @type Number\n     * @default\n     */\n    opacity:                  1,\n\n    /**\n     * Angle of rotation of an object (in degrees)\n     * @type Number\n     * @default\n     */\n    angle:                    0,\n\n    /**\n     * Angle of skew on x axes of an object (in degrees)\n     * @type Number\n     * @default\n     */\n    skewX:                    0,\n\n    /**\n     * Angle of skew on y axes of an object (in degrees)\n     * @type Number\n     * @default\n     */\n    skewY:                    0,\n\n    /**\n     * Size of object's controlling corners (in pixels)\n     * @type Number\n     * @default\n     */\n    cornerSize:               13,\n\n    /**\n     * Size of object's controlling corners when touch interaction is detected\n     * @type Number\n     * @default\n     */\n    touchCornerSize:               24,\n\n    /**\n     * When true, object's controlling corners are rendered as transparent inside (i.e. stroke instead of fill)\n     * @type Boolean\n     * @default\n     */\n    transparentCorners:       true,\n\n    /**\n     * Default cursor value used when hovering over this object on canvas\n     * @type String\n     * @default\n     */\n    hoverCursor:              null,\n\n    /**\n     * Default cursor value used when moving this object on canvas\n     * @type String\n     * @default\n     */\n    moveCursor:               null,\n\n    /**\n     * Padding between object and its controlling borders (in pixels)\n     * @type Number\n     * @default\n     */\n    padding:                  0,\n\n    /**\n     * Color of controlling borders of an object (when it's active)\n     * @type String\n     * @default\n     */\n    borderColor:              'rgb(178,204,255)',\n\n    /**\n     * Array specifying dash pattern of an object's borders (hasBorder must be true)\n     * @since 1.6.2\n     * @type Array\n     */\n    borderDashArray:          null,\n\n    /**\n     * Color of controlling corners of an object (when it's active)\n     * @type String\n     * @default\n     */\n    cornerColor:              'rgb(178,204,255)',\n\n    /**\n     * Color of controlling corners of an object (when it's active and transparentCorners false)\n     * @since 1.6.2\n     * @type String\n     * @default\n     */\n    cornerStrokeColor:        null,\n\n    /**\n     * Specify style of control, 'rect' or 'circle'\n     * @since 1.6.2\n     * @type String\n     */\n    cornerStyle:          'rect',\n\n    /**\n     * Array specifying dash pattern of an object's control (hasBorder must be true)\n     * @since 1.6.2\n     * @type Array\n     */\n    cornerDashArray:          null,\n\n    /**\n     * When true, this object will use center point as the origin of transformation\n     * when being scaled via the controls.\n     * <b>Backwards incompatibility note:</b> This property replaces \"centerTransform\" (Boolean).\n     * @since 1.3.4\n     * @type Boolean\n     * @default\n     */\n    centeredScaling:          false,\n\n    /**\n     * When true, this object will use center point as the origin of transformation\n     * when being rotated via the controls.\n     * <b>Backwards incompatibility note:</b> This property replaces \"centerTransform\" (Boolean).\n     * @since 1.3.4\n     * @type Boolean\n     * @default\n     */\n    centeredRotation:         true,\n\n    /**\n     * Color of object's fill\n     * takes css colors https://www.w3.org/TR/css-color-3/\n     * @type String\n     * @default\n     */\n    fill:                     'rgb(0,0,0)',\n\n    /**\n     * Fill rule used to fill an object\n     * accepted values are nonzero, evenodd\n     * <b>Backwards incompatibility note:</b> This property was used for setting globalCompositeOperation until v1.4.12 (use `fabric.Object#globalCompositeOperation` instead)\n     * @type String\n     * @default\n     */\n    fillRule:                 'nonzero',\n\n    /**\n     * Composite rule used for canvas globalCompositeOperation\n     * @type String\n     * @default\n     */\n    globalCompositeOperation: 'source-over',\n\n    /**\n     * Background color of an object.\n     * takes css colors https://www.w3.org/TR/css-color-3/\n     * @type String\n     * @default\n     */\n    backgroundColor:          '',\n\n    /**\n     * Selection Background color of an object. colored layer behind the object when it is active.\n     * does not mix good with globalCompositeOperation methods.\n     * @type String\n     * @default\n     */\n    selectionBackgroundColor:          '',\n\n    /**\n     * When defined, an object is rendered via stroke and this property specifies its color\n     * takes css colors https://www.w3.org/TR/css-color-3/\n     * @type String\n     * @default\n     */\n    stroke:                   null,\n\n    /**\n     * Width of a stroke used to render this object\n     * @type Number\n     * @default\n     */\n    strokeWidth:              1,\n\n    /**\n     * Array specifying dash pattern of an object's stroke (stroke must be defined)\n     * @type Array\n     */\n    strokeDashArray:          null,\n\n    /**\n     * Line offset of an object's stroke\n     * @type Number\n     * @default\n     */\n    strokeDashOffset: 0,\n\n    /**\n     * Line endings style of an object's stroke (one of \"butt\", \"round\", \"square\")\n     * @type String\n     * @default\n     */\n    strokeLineCap:            'butt',\n\n    /**\n     * Corner style of an object's stroke (one of \"bevel\", \"round\", \"miter\")\n     * @type String\n     * @default\n     */\n    strokeLineJoin:           'miter',\n\n    /**\n     * Maximum miter length (used for strokeLineJoin = \"miter\") of an object's stroke\n     * @type Number\n     * @default\n     */\n    strokeMiterLimit:         4,\n\n    /**\n     * Shadow object representing shadow of this shape\n     * @type fabric.Shadow\n     * @default\n     */\n    shadow:                   null,\n\n    /**\n     * Opacity of object's controlling borders when object is active and moving\n     * @type Number\n     * @default\n     */\n    borderOpacityWhenMoving:  0.4,\n\n    /**\n     * Scale factor of object's controlling borders\n     * bigger number will make a thicker border\n     * border is 1, so this is basically a border thickness\n     * since there is no way to change the border itself.\n     * @type Number\n     * @default\n     */\n    borderScaleFactor:        1,\n\n    /**\n     * Minimum allowed scale value of an object\n     * @type Number\n     * @default\n     */\n    minScaleLimit:            0,\n\n    /**\n     * When set to `false`, an object can not be selected for modification (using either point-click-based or group-based selection).\n     * But events still fire on it.\n     * @type Boolean\n     * @default\n     */\n    selectable:               true,\n\n    /**\n     * When set to `false`, an object can not be a target of events. All events propagate through it. Introduced in v1.3.4\n     * @type Boolean\n     * @default\n     */\n    evented:                  true,\n\n    /**\n     * When set to `false`, an object is not rendered on canvas\n     * @type Boolean\n     * @default\n     */\n    visible:                  true,\n\n    /**\n     * When set to `false`, object's controls are not displayed and can not be used to manipulate object\n     * @type Boolean\n     * @default\n     */\n    hasControls:              true,\n\n    /**\n     * When set to `false`, object's controlling borders are not rendered\n     * @type Boolean\n     * @default\n     */\n    hasBorders:               true,\n\n    /**\n     * When set to `true`, objects are \"found\" on canvas on per-pixel basis rather than according to bounding box\n     * @type Boolean\n     * @default\n     */\n    perPixelTargetFind:       false,\n\n    /**\n     * When `false`, default object's values are not included in its serialization\n     * @type Boolean\n     * @default\n     */\n    includeDefaultValues:     true,\n\n    /**\n     * When `true`, object horizontal movement is locked\n     * @type Boolean\n     * @default\n     */\n    lockMovementX:            false,\n\n    /**\n     * When `true`, object vertical movement is locked\n     * @type Boolean\n     * @default\n     */\n    lockMovementY:            false,\n\n    /**\n     * When `true`, object rotation is locked\n     * @type Boolean\n     * @default\n     */\n    lockRotation:             false,\n\n    /**\n     * When `true`, object horizontal scaling is locked\n     * @type Boolean\n     * @default\n     */\n    lockScalingX:             false,\n\n    /**\n     * When `true`, object vertical scaling is locked\n     * @type Boolean\n     * @default\n     */\n    lockScalingY:             false,\n\n    /**\n     * When `true`, object horizontal skewing is locked\n     * @type Boolean\n     * @default\n     */\n    lockSkewingX:             false,\n\n    /**\n     * When `true`, object vertical skewing is locked\n     * @type Boolean\n     * @default\n     */\n    lockSkewingY:             false,\n\n    /**\n     * When `true`, object cannot be flipped by scaling into negative values\n     * @type Boolean\n     * @default\n     */\n    lockScalingFlip:          false,\n\n    /**\n     * When `true`, object is not exported in OBJECT/JSON\n     * @since 1.6.3\n     * @type Boolean\n     * @default\n     */\n    excludeFromExport:        false,\n\n    /**\n     * When `true`, object is cached on an additional canvas.\n     * When `false`, object is not cached unless necessary ( clipPath )\n     * default to true\n     * @since 1.7.0\n     * @type Boolean\n     * @default true\n     */\n    objectCaching:            objectCaching,\n\n    /**\n     * When `true`, object properties are checked for cache invalidation. In some particular\n     * situation you may want this to be disabled ( spray brush, very big, groups)\n     * or if your application does not allow you to modify properties for groups child you want\n     * to disable it for groups.\n     * default to false\n     * since 1.7.0\n     * @type Boolean\n     * @default false\n     */\n    statefullCache:            false,\n\n    /**\n     * When `true`, cache does not get updated during scaling. The picture will get blocky if scaled\n     * too much and will be redrawn with correct details at the end of scaling.\n     * this setting is performance and application dependant.\n     * default to true\n     * since 1.7.0\n     * @type Boolean\n     * @default true\n     */\n    noScaleCache:              true,\n\n    /**\n     * When `false`, the stoke width will scale with the object.\n     * When `true`, the stroke will always match the exact pixel size entered for stroke width.\n     * this Property does not work on Text classes or drawing call that uses strokeText,fillText methods\n     * default to false\n     * @since 2.6.0\n     * @type Boolean\n     * @default false\n     * @type Boolean\n     * @default false\n     */\n    strokeUniform:              false,\n\n    /**\n     * When set to `true`, object's cache will be rerendered next render call.\n     * since 1.7.0\n     * @type Boolean\n     * @default true\n     */\n    dirty:                true,\n\n    /**\n     * keeps the value of the last hovered corner during mouse move.\n     * 0 is no corner, or 'mt', 'ml', 'mtr' etc..\n     * It should be private, but there is no harm in using it as\n     * a read-only property.\n     * @type number|string|any\n     * @default 0\n     */\n    __corner: 0,\n\n    /**\n     * Determines if the fill or the stroke is drawn first (one of \"fill\" or \"stroke\")\n     * @type String\n     * @default\n     */\n    paintFirst:           'fill',\n\n    /**\n     * When 'down', object is set to active on mousedown/touchstart\n     * When 'up', object is set to active on mouseup/touchend\n     * Experimental. Let's see if this breaks anything before supporting officially\n     * @private\n     * since 4.4.0\n     * @type String\n     * @default 'down'\n     */\n    activeOn:           'down',\n\n    /**\n     * List of properties to consider when checking if state\n     * of an object is changed (fabric.Object#hasStateChanged)\n     * as well as for history (undo/redo) purposes\n     * @type Array\n     */\n    stateProperties: (\n      'top left width height scaleX scaleY flipX flipY originX originY transformMatrix ' +\n      'stroke strokeWidth strokeDashArray strokeLineCap strokeDashOffset strokeLineJoin strokeMiterLimit ' +\n      'angle opacity fill globalCompositeOperation shadow visible backgroundColor ' +\n      'skewX skewY fillRule paintFirst clipPath strokeUniform'\n    ).split(' '),\n\n    /**\n     * List of properties to consider when checking if cache needs refresh\n     * Those properties are checked by statefullCache ON ( or lazy mode if we want ) or from single\n     * calls to Object.set(key, value). If the key is in this list, the object is marked as dirty\n     * and refreshed at the next render\n     * @type Array\n     */\n    cacheProperties: (\n      'fill stroke strokeWidth strokeDashArray width height paintFirst strokeUniform' +\n      ' strokeLineCap strokeDashOffset strokeLineJoin strokeMiterLimit backgroundColor clipPath'\n    ).split(' '),\n\n    /**\n     * List of properties to consider for animating colors.\n     * @type Array\n     */\n    colorProperties: (\n      'fill stroke backgroundColor'\n    ).split(' '),\n\n    /**\n     * a fabricObject that, without stroke define a clipping area with their shape. filled in black\n     * the clipPath object gets used when the object has rendered, and the context is placed in the center\n     * of the object cacheCanvas.\n     * If you want 0,0 of a clipPath to align with an object center, use clipPath.originX/Y to 'center'\n     * @type fabric.Object\n     */\n    clipPath: undefined,\n\n    /**\n     * Meaningful ONLY when the object is used as clipPath.\n     * if true, the clipPath will make the object clip to the outside of the clipPath\n     * since 2.4.0\n     * @type boolean\n     * @default false\n     */\n    inverted: false,\n\n    /**\n     * Meaningful ONLY when the object is used as clipPath.\n     * if true, the clipPath will have its top and left relative to canvas, and will\n     * not be influenced by the object transform. This will make the clipPath relative\n     * to the canvas, but clipping just a particular object.\n     * WARNING this is beta, this feature may change or be renamed.\n     * since 2.4.0\n     * @type boolean\n     * @default false\n     */\n    absolutePositioned: false,\n\n    /**\n     * Constructor\n     * @param {Object} [options] Options object\n     */\n    initialize: function(options) {\n      if (options) {\n        this.setOptions(options);\n      }\n    },\n\n    /**\n     * Create a the canvas used to keep the cached copy of the object\n     * @private\n     */\n    _createCacheCanvas: function() {\n      this._cacheProperties = {};\n      this._cacheCanvas = fabric.util.createCanvasElement();\n      this._cacheContext = this._cacheCanvas.getContext('2d');\n      this._updateCacheCanvas();\n      // if canvas gets created, is empty, so dirty.\n      this.dirty = true;\n    },\n\n    /**\n     * Limit the cache dimensions so that X * Y do not cross fabric.perfLimitSizeTotal\n     * and each side do not cross fabric.cacheSideLimit\n     * those numbers are configurable so that you can get as much detail as you want\n     * making bargain with performances.\n     * @param {Object} dims\n     * @param {Object} dims.width width of canvas\n     * @param {Object} dims.height height of canvas\n     * @param {Object} dims.zoomX zoomX zoom value to unscale the canvas before drawing cache\n     * @param {Object} dims.zoomY zoomY zoom value to unscale the canvas before drawing cache\n     * @return {Object}.width width of canvas\n     * @return {Object}.height height of canvas\n     * @return {Object}.zoomX zoomX zoom value to unscale the canvas before drawing cache\n     * @return {Object}.zoomY zoomY zoom value to unscale the canvas before drawing cache\n     */\n    _limitCacheSize: function(dims) {\n      var perfLimitSizeTotal = fabric.perfLimitSizeTotal,\n          width = dims.width, height = dims.height,\n          max = fabric.maxCacheSideLimit, min = fabric.minCacheSideLimit;\n      if (width <= max && height <= max && width * height <= perfLimitSizeTotal) {\n        if (width < min) {\n          dims.width = min;\n        }\n        if (height < min) {\n          dims.height = min;\n        }\n        return dims;\n      }\n      var ar = width / height, limitedDims = fabric.util.limitDimsByArea(ar, perfLimitSizeTotal),\n          capValue = fabric.util.capValue,\n          x = capValue(min, limitedDims.x, max),\n          y = capValue(min, limitedDims.y, max);\n      if (width > x) {\n        dims.zoomX /= width / x;\n        dims.width = x;\n        dims.capped = true;\n      }\n      if (height > y) {\n        dims.zoomY /= height / y;\n        dims.height = y;\n        dims.capped = true;\n      }\n      return dims;\n    },\n\n    /**\n     * Return the dimension and the zoom level needed to create a cache canvas\n     * big enough to host the object to be cached.\n     * @private\n     * @return {Object}.x width of object to be cached\n     * @return {Object}.y height of object to be cached\n     * @return {Object}.width width of canvas\n     * @return {Object}.height height of canvas\n     * @return {Object}.zoomX zoomX zoom value to unscale the canvas before drawing cache\n     * @return {Object}.zoomY zoomY zoom value to unscale the canvas before drawing cache\n     */\n    _getCacheCanvasDimensions: function() {\n      var objectScale = this.getTotalObjectScaling(),\n          // caculate dimensions without skewing\n          dim = this._getTransformedDimensions(0, 0),\n          neededX = dim.x * objectScale.scaleX / this.scaleX,\n          neededY = dim.y * objectScale.scaleY / this.scaleY;\n      return {\n        // for sure this ALIASING_LIMIT is slightly creating problem\n        // in situation in which the cache canvas gets an upper limit\n        // also objectScale contains already scaleX and scaleY\n        width: neededX + ALIASING_LIMIT,\n        height: neededY + ALIASING_LIMIT,\n        zoomX: objectScale.scaleX,\n        zoomY: objectScale.scaleY,\n        x: neededX,\n        y: neededY\n      };\n    },\n\n    /**\n     * Update width and height of the canvas for cache\n     * returns true or false if canvas needed resize.\n     * @private\n     * @return {Boolean} true if the canvas has been resized\n     */\n    _updateCacheCanvas: function() {\n      var targetCanvas = this.canvas;\n      if (this.noScaleCache && targetCanvas && targetCanvas._currentTransform) {\n        var target = targetCanvas._currentTransform.target,\n            action = targetCanvas._currentTransform.action;\n        if (this === target && action.slice && action.slice(0, 5) === 'scale') {\n          return false;\n        }\n      }\n      var canvas = this._cacheCanvas,\n          dims = this._limitCacheSize(this._getCacheCanvasDimensions()),\n          minCacheSize = fabric.minCacheSideLimit,\n          width = dims.width, height = dims.height, drawingWidth, drawingHeight,\n          zoomX = dims.zoomX, zoomY = dims.zoomY,\n          dimensionsChanged = width !== this.cacheWidth || height !== this.cacheHeight,\n          zoomChanged = this.zoomX !== zoomX || this.zoomY !== zoomY,\n          shouldRedraw = dimensionsChanged || zoomChanged,\n          additionalWidth = 0, additionalHeight = 0, shouldResizeCanvas = false;\n      if (dimensionsChanged) {\n        var canvasWidth = this._cacheCanvas.width,\n            canvasHeight = this._cacheCanvas.height,\n            sizeGrowing = width > canvasWidth || height > canvasHeight,\n            sizeShrinking = (width < canvasWidth * 0.9 || height < canvasHeight * 0.9) &&\n              canvasWidth > minCacheSize && canvasHeight > minCacheSize;\n        shouldResizeCanvas = sizeGrowing || sizeShrinking;\n        if (sizeGrowing && !dims.capped && (width > minCacheSize || height > minCacheSize)) {\n          additionalWidth = width * 0.1;\n          additionalHeight = height * 0.1;\n        }\n      }\n      if (this instanceof fabric.Text && this.path) {\n        shouldRedraw = true;\n        shouldResizeCanvas = true;\n        additionalWidth += this.getHeightOfLine(0) * this.zoomX;\n        additionalHeight += this.getHeightOfLine(0) * this.zoomY;\n      }\n      if (shouldRedraw) {\n        if (shouldResizeCanvas) {\n          canvas.width = Math.ceil(width + additionalWidth);\n          canvas.height = Math.ceil(height + additionalHeight);\n        }\n        else {\n          this._cacheContext.setTransform(1, 0, 0, 1, 0, 0);\n          this._cacheContext.clearRect(0, 0, canvas.width, canvas.height);\n        }\n        drawingWidth = dims.x / 2;\n        drawingHeight = dims.y / 2;\n        this.cacheTranslationX = Math.round(canvas.width / 2 - drawingWidth) + drawingWidth;\n        this.cacheTranslationY = Math.round(canvas.height / 2 - drawingHeight) + drawingHeight;\n        this.cacheWidth = width;\n        this.cacheHeight = height;\n        this._cacheContext.translate(this.cacheTranslationX, this.cacheTranslationY);\n        this._cacheContext.scale(zoomX, zoomY);\n        this.zoomX = zoomX;\n        this.zoomY = zoomY;\n        return true;\n      }\n      return false;\n    },\n\n    /**\n     * Sets object's properties from options\n     * @param {Object} [options] Options object\n     */\n    setOptions: function(options) {\n      this._setOptions(options);\n      this._initGradient(options.fill, 'fill');\n      this._initGradient(options.stroke, 'stroke');\n      this._initPattern(options.fill, 'fill');\n      this._initPattern(options.stroke, 'stroke');\n    },\n\n    /**\n     * Transforms context when rendering an object\n     * @param {CanvasRenderingContext2D} ctx Context\n     */\n    transform: function(ctx) {\n      var needFullTransform = (this.group && !this.group._transformDone) ||\n         (this.group && this.canvas && ctx === this.canvas.contextTop);\n      var m = this.calcTransformMatrix(!needFullTransform);\n      ctx.transform(m[0], m[1], m[2], m[3], m[4], m[5]);\n    },\n\n    /**\n     * Returns an object representation of an instance\n     * @param {Array} [propertiesToInclude] Any properties that you might want to additionally include in the output\n     * @return {Object} Object representation of an instance\n     */\n    toObject: function(propertiesToInclude) {\n      var NUM_FRACTION_DIGITS = fabric.Object.NUM_FRACTION_DIGITS,\n\n          object = {\n            type:                     this.type,\n            version:                  fabric.version,\n            originX:                  this.originX,\n            originY:                  this.originY,\n            left:                     toFixed(this.left, NUM_FRACTION_DIGITS),\n            top:                      toFixed(this.top, NUM_FRACTION_DIGITS),\n            width:                    toFixed(this.width, NUM_FRACTION_DIGITS),\n            height:                   toFixed(this.height, NUM_FRACTION_DIGITS),\n            fill:                     (this.fill && this.fill.toObject) ? this.fill.toObject() : this.fill,\n            stroke:                   (this.stroke && this.stroke.toObject) ? this.stroke.toObject() : this.stroke,\n            strokeWidth:              toFixed(this.strokeWidth, NUM_FRACTION_DIGITS),\n            strokeDashArray:          this.strokeDashArray ? this.strokeDashArray.concat() : this.strokeDashArray,\n            strokeLineCap:            this.strokeLineCap,\n            strokeDashOffset:         this.strokeDashOffset,\n            strokeLineJoin:           this.strokeLineJoin,\n            strokeUniform:            this.strokeUniform,\n            strokeMiterLimit:         toFixed(this.strokeMiterLimit, NUM_FRACTION_DIGITS),\n            scaleX:                   toFixed(this.scaleX, NUM_FRACTION_DIGITS),\n            scaleY:                   toFixed(this.scaleY, NUM_FRACTION_DIGITS),\n            angle:                    toFixed(this.angle, NUM_FRACTION_DIGITS),\n            flipX:                    this.flipX,\n            flipY:                    this.flipY,\n            opacity:                  toFixed(this.opacity, NUM_FRACTION_DIGITS),\n            shadow:                   (this.shadow && this.shadow.toObject) ? this.shadow.toObject() : this.shadow,\n            visible:                  this.visible,\n            backgroundColor:          this.backgroundColor,\n            fillRule:                 this.fillRule,\n            paintFirst:               this.paintFirst,\n            globalCompositeOperation: this.globalCompositeOperation,\n            skewX:                    toFixed(this.skewX, NUM_FRACTION_DIGITS),\n            skewY:                    toFixed(this.skewY, NUM_FRACTION_DIGITS),\n          };\n\n      if (this.clipPath && !this.clipPath.excludeFromExport) {\n        object.clipPath = this.clipPath.toObject(propertiesToInclude);\n        object.clipPath.inverted = this.clipPath.inverted;\n        object.clipPath.absolutePositioned = this.clipPath.absolutePositioned;\n      }\n\n      fabric.util.populateWithProperties(this, object, propertiesToInclude);\n      if (!this.includeDefaultValues) {\n        object = this._removeDefaultValues(object);\n      }\n\n      return object;\n    },\n\n    /**\n     * Returns (dataless) object representation of an instance\n     * @param {Array} [propertiesToInclude] Any properties that you might want to additionally include in the output\n     * @return {Object} Object representation of an instance\n     */\n    toDatalessObject: function(propertiesToInclude) {\n      // will be overwritten by subclasses\n      return this.toObject(propertiesToInclude);\n    },\n\n    /**\n     * @private\n     * @param {Object} object\n     */\n    _removeDefaultValues: function(object) {\n      var prototype = fabric.util.getKlass(object.type).prototype,\n          stateProperties = prototype.stateProperties;\n      stateProperties.forEach(function(prop) {\n        if (prop === 'left' || prop === 'top') {\n          return;\n        }\n        if (object[prop] === prototype[prop]) {\n          delete object[prop];\n        }\n        // basically a check for [] === []\n        if (Array.isArray(object[prop]) && Array.isArray(prototype[prop])\n          && object[prop].length === 0 && prototype[prop].length === 0) {\n          delete object[prop];\n        }\n      });\n\n      return object;\n    },\n\n    /**\n     * Returns a string representation of an instance\n     * @return {String}\n     */\n    toString: function() {\n      return '#<fabric.' + capitalize(this.type) + '>';\n    },\n\n    /**\n     * Return the object scale factor counting also the group scaling\n     * @return {Object} object with scaleX and scaleY properties\n     */\n    getObjectScaling: function() {\n      // if the object is a top level one, on the canvas, we go for simple aritmetic\n      // otherwise the complex method with angles will return approximations and decimals\n      // and will likely kill the cache when not needed\n      // https://github.com/fabricjs/fabric.js/issues/7157\n      if (!this.group) {\n        return {\n          scaleX: this.scaleX,\n          scaleY: this.scaleY,\n        };\n      }\n      // if we are inside a group total zoom calculation is complex, we defer to generic matrices\n      var options = fabric.util.qrDecompose(this.calcTransformMatrix());\n      return { scaleX: Math.abs(options.scaleX), scaleY: Math.abs(options.scaleY) };\n    },\n\n    /**\n     * Return the object scale factor counting also the group scaling, zoom and retina\n     * @return {Object} object with scaleX and scaleY properties\n     */\n    getTotalObjectScaling: function() {\n      var scale = this.getObjectScaling(), scaleX = scale.scaleX, scaleY = scale.scaleY;\n      if (this.canvas) {\n        var zoom = this.canvas.getZoom();\n        var retina = this.canvas.getRetinaScaling();\n        scaleX *= zoom * retina;\n        scaleY *= zoom * retina;\n      }\n      return { scaleX: scaleX, scaleY: scaleY };\n    },\n\n    /**\n     * Return the object opacity counting also the group property\n     * @return {Number}\n     */\n    getObjectOpacity: function() {\n      var opacity = this.opacity;\n      if (this.group) {\n        opacity *= this.group.getObjectOpacity();\n      }\n      return opacity;\n    },\n\n    /**\n     * @private\n     * @param {String} key\n     * @param {*} value\n     * @return {fabric.Object} thisArg\n     */\n    _set: function(key, value) {\n      var shouldConstrainValue = (key === 'scaleX' || key === 'scaleY'),\n          isChanged = this[key] !== value, groupNeedsUpdate = false;\n\n      if (shouldConstrainValue) {\n        value = this._constrainScale(value);\n      }\n      if (key === 'scaleX' && value < 0) {\n        this.flipX = !this.flipX;\n        value *= -1;\n      }\n      else if (key === 'scaleY' && value < 0) {\n        this.flipY = !this.flipY;\n        value *= -1;\n      }\n      else if (key === 'shadow' && value && !(value instanceof fabric.Shadow)) {\n        value = new fabric.Shadow(value);\n      }\n      else if (key === 'dirty' && this.group) {\n        this.group.set('dirty', value);\n      }\n\n      this[key] = value;\n\n      if (isChanged) {\n        groupNeedsUpdate = this.group && this.group.isOnACache();\n        if (this.cacheProperties.indexOf(key) > -1) {\n          this.dirty = true;\n          groupNeedsUpdate && this.group.set('dirty', true);\n        }\n        else if (groupNeedsUpdate && this.stateProperties.indexOf(key) > -1) {\n          this.group.set('dirty', true);\n        }\n      }\n      return this;\n    },\n\n    /**\n     * This callback function is called by the parent group of an object every\n     * time a non-delegated property changes on the group. It is passed the key\n     * and value as parameters. Not adding in this function's signature to avoid\n     * Travis build error about unused variables.\n     */\n    setOnGroup: function() {\n      // implemented by sub-classes, as needed.\n    },\n\n    /**\n     * Retrieves viewportTransform from Object's canvas if possible\n     * @method getViewportTransform\n     * @memberOf fabric.Object.prototype\n     * @return {Array}\n     */\n    getViewportTransform: function() {\n      if (this.canvas && this.canvas.viewportTransform) {\n        return this.canvas.viewportTransform;\n      }\n      return fabric.iMatrix.concat();\n    },\n\n    /*\n     * @private\n     * return if the object would be visible in rendering\n     * @memberOf fabric.Object.prototype\n     * @return {Boolean}\n     */\n    isNotVisible: function() {\n      return this.opacity === 0 ||\n        (!this.width && !this.height && this.strokeWidth === 0) ||\n        !this.visible;\n    },\n\n    /**\n     * Renders an object on a specified context\n     * @param {CanvasRenderingContext2D} ctx Context to render on\n     */\n    render: function(ctx) {\n      // do not render if width/height are zeros or object is not visible\n      if (this.isNotVisible()) {\n        return;\n      }\n      if (this.canvas && this.canvas.skipOffscreen && !this.group && !this.isOnScreen()) {\n        return;\n      }\n      ctx.save();\n      this._setupCompositeOperation(ctx);\n      this.drawSelectionBackground(ctx);\n      this.transform(ctx);\n      this._setOpacity(ctx);\n      this._setShadow(ctx, this);\n      if (this.shouldCache()) {\n        this.renderCache();\n        this.drawCacheOnCanvas(ctx);\n      }\n      else {\n        this._removeCacheCanvas();\n        this.dirty = false;\n        this.drawObject(ctx);\n        if (this.objectCaching && this.statefullCache) {\n          this.saveState({ propertySet: 'cacheProperties' });\n        }\n      }\n      ctx.restore();\n    },\n\n    renderCache: function(options) {\n      options = options || {};\n      if (!this._cacheCanvas || !this._cacheContext) {\n        this._createCacheCanvas();\n      }\n      if (this.isCacheDirty()) {\n        this.statefullCache && this.saveState({ propertySet: 'cacheProperties' });\n        this.drawObject(this._cacheContext, options.forClipping);\n        this.dirty = false;\n      }\n    },\n\n    /**\n     * Remove cacheCanvas and its dimensions from the objects\n     */\n    _removeCacheCanvas: function() {\n      this._cacheCanvas = null;\n      this._cacheContext = null;\n      this.cacheWidth = 0;\n      this.cacheHeight = 0;\n    },\n\n    /**\n     * return true if the object will draw a stroke\n     * Does not consider text styles. This is just a shortcut used at rendering time\n     * We want it to be an approximation and be fast.\n     * wrote to avoid extra caching, it has to return true when stroke happens,\n     * can guess when it will not happen at 100% chance, does not matter if it misses\n     * some use case where the stroke is invisible.\n     * @since 3.0.0\n     * @returns Boolean\n     */\n    hasStroke: function() {\n      return this.stroke && this.stroke !== 'transparent' && this.strokeWidth !== 0;\n    },\n\n    /**\n     * return true if the object will draw a fill\n     * Does not consider text styles. This is just a shortcut used at rendering time\n     * We want it to be an approximation and be fast.\n     * wrote to avoid extra caching, it has to return true when fill happens,\n     * can guess when it will not happen at 100% chance, does not matter if it misses\n     * some use case where the fill is invisible.\n     * @since 3.0.0\n     * @returns Boolean\n     */\n    hasFill: function() {\n      return this.fill && this.fill !== 'transparent';\n    },\n\n    /**\n     * When set to `true`, force the object to have its own cache, even if it is inside a group\n     * it may be needed when your object behave in a particular way on the cache and always needs\n     * its own isolated canvas to render correctly.\n     * Created to be overridden\n     * since 1.7.12\n     * @returns Boolean\n     */\n    needsItsOwnCache: function() {\n      if (this.paintFirst === 'stroke' &&\n        this.hasFill() && this.hasStroke() && typeof this.shadow === 'object') {\n        return true;\n      }\n      if (this.clipPath) {\n        return true;\n      }\n      return false;\n    },\n\n    /**\n     * Decide if the object should cache or not. Create its own cache level\n     * objectCaching is a global flag, wins over everything\n     * needsItsOwnCache should be used when the object drawing method requires\n     * a cache step. None of the fabric classes requires it.\n     * Generally you do not cache objects in groups because the group outside is cached.\n     * Read as: cache if is needed, or if the feature is enabled but we are not already caching.\n     * @return {Boolean}\n     */\n    shouldCache: function() {\n      this.ownCaching = this.needsItsOwnCache() || (\n        this.objectCaching &&\n        (!this.group || !this.group.isOnACache())\n      );\n      return this.ownCaching;\n    },\n\n    /**\n     * Check if this object or a child object will cast a shadow\n     * used by Group.shouldCache to know if child has a shadow recursively\n     * @return {Boolean}\n     */\n    willDrawShadow: function() {\n      return !!this.shadow && (this.shadow.offsetX !== 0 || this.shadow.offsetY !== 0);\n    },\n\n    /**\n     * Execute the drawing operation for an object clipPath\n     * @param {CanvasRenderingContext2D} ctx Context to render on\n     * @param {fabric.Object} clipPath\n     */\n    drawClipPathOnCache: function(ctx, clipPath) {\n      ctx.save();\n      // DEBUG: uncomment this line, comment the following\n      // ctx.globalAlpha = 0.4\n      if (clipPath.inverted) {\n        ctx.globalCompositeOperation = 'destination-out';\n      }\n      else {\n        ctx.globalCompositeOperation = 'destination-in';\n      }\n      //ctx.scale(1 / 2, 1 / 2);\n      if (clipPath.absolutePositioned) {\n        var m = fabric.util.invertTransform(this.calcTransformMatrix());\n        ctx.transform(m[0], m[1], m[2], m[3], m[4], m[5]);\n      }\n      clipPath.transform(ctx);\n      ctx.scale(1 / clipPath.zoomX, 1 / clipPath.zoomY);\n      ctx.drawImage(clipPath._cacheCanvas, -clipPath.cacheTranslationX, -clipPath.cacheTranslationY);\n      ctx.restore();\n    },\n\n    /**\n     * Execute the drawing operation for an object on a specified context\n     * @param {CanvasRenderingContext2D} ctx Context to render on\n     */\n    drawObject: function(ctx, forClipping) {\n      var originalFill = this.fill, originalStroke = this.stroke;\n      if (forClipping) {\n        this.fill = 'black';\n        this.stroke = '';\n        this._setClippingProperties(ctx);\n      }\n      else {\n        this._renderBackground(ctx);\n      }\n      this._render(ctx);\n      this._drawClipPath(ctx, this.clipPath);\n      this.fill = originalFill;\n      this.stroke = originalStroke;\n    },\n\n    /**\n     * Prepare clipPath state and cache and draw it on instance's cache\n     * @param {CanvasRenderingContext2D} ctx\n     * @param {fabric.Object} clipPath\n     */\n    _drawClipPath: function (ctx, clipPath) {\n      if (!clipPath) { return; }\n      // needed to setup a couple of variables\n      // path canvas gets overridden with this one.\n      // TODO find a better solution?\n      clipPath.canvas = this.canvas;\n      clipPath.shouldCache();\n      clipPath._transformDone = true;\n      clipPath.renderCache({ forClipping: true });\n      this.drawClipPathOnCache(ctx, clipPath);\n    },\n\n    /**\n     * Paint the cached copy of the object on the target context.\n     * @param {CanvasRenderingContext2D} ctx Context to render on\n     */\n    drawCacheOnCanvas: function(ctx) {\n      ctx.scale(1 / this.zoomX, 1 / this.zoomY);\n      ctx.drawImage(this._cacheCanvas, -this.cacheTranslationX, -this.cacheTranslationY);\n    },\n\n    /**\n     * Check if cache is dirty\n     * @param {Boolean} skipCanvas skip canvas checks because this object is painted\n     * on parent canvas.\n     */\n    isCacheDirty: function(skipCanvas) {\n      if (this.isNotVisible()) {\n        return false;\n      }\n      if (this._cacheCanvas && this._cacheContext && !skipCanvas && this._updateCacheCanvas()) {\n        // in this case the context is already cleared.\n        return true;\n      }\n      else {\n        if (this.dirty ||\n          (this.clipPath && this.clipPath.absolutePositioned) ||\n          (this.statefullCache && this.hasStateChanged('cacheProperties'))\n        ) {\n          if (this._cacheCanvas && this._cacheContext && !skipCanvas) {\n            var width = this.cacheWidth / this.zoomX;\n            var height = this.cacheHeight / this.zoomY;\n            this._cacheContext.clearRect(-width / 2, -height / 2, width, height);\n          }\n          return true;\n        }\n      }\n      return false;\n    },\n\n    /**\n     * Draws a background for the object big as its untransformed dimensions\n     * @private\n     * @param {CanvasRenderingContext2D} ctx Context to render on\n     */\n    _renderBackground: function(ctx) {\n      if (!this.backgroundColor) {\n        return;\n      }\n      var dim = this._getNonTransformedDimensions();\n      ctx.fillStyle = this.backgroundColor;\n\n      ctx.fillRect(\n        -dim.x / 2,\n        -dim.y / 2,\n        dim.x,\n        dim.y\n      );\n      // if there is background color no other shadows\n      // should be casted\n      this._removeShadow(ctx);\n    },\n\n    /**\n     * @private\n     * @param {CanvasRenderingContext2D} ctx Context to render on\n     */\n    _setOpacity: function(ctx) {\n      if (this.group && !this.group._transformDone) {\n        ctx.globalAlpha = this.getObjectOpacity();\n      }\n      else {\n        ctx.globalAlpha *= this.opacity;\n      }\n    },\n\n    _setStrokeStyles: function(ctx, decl) {\n      var stroke = decl.stroke;\n      if (stroke) {\n        ctx.lineWidth = decl.strokeWidth;\n        ctx.lineCap = decl.strokeLineCap;\n        ctx.lineDashOffset = decl.strokeDashOffset;\n        ctx.lineJoin = decl.strokeLineJoin;\n        ctx.miterLimit = decl.strokeMiterLimit;\n        if (stroke.toLive) {\n          if (stroke.gradientUnits === 'percentage' || stroke.gradientTransform || stroke.patternTransform) {\n            // need to transform gradient in a pattern.\n            // this is a slow process. If you are hitting this codepath, and the object\n            // is not using caching, you should consider switching it on.\n            // we need a canvas as big as the current object caching canvas.\n            this._applyPatternForTransformedGradient(ctx, stroke);\n          }\n          else {\n            // is a simple gradient or pattern\n            ctx.strokeStyle = stroke.toLive(ctx, this);\n            this._applyPatternGradientTransform(ctx, stroke);\n          }\n        }\n        else {\n          // is a color\n          ctx.strokeStyle = decl.stroke;\n        }\n      }\n    },\n\n    _setFillStyles: function(ctx, decl) {\n      var fill = decl.fill;\n      if (fill) {\n        if (fill.toLive) {\n          ctx.fillStyle = fill.toLive(ctx, this);\n          this._applyPatternGradientTransform(ctx, decl.fill);\n        }\n        else {\n          ctx.fillStyle = fill;\n        }\n      }\n    },\n\n    _setClippingProperties: function(ctx) {\n      ctx.globalAlpha = 1;\n      ctx.strokeStyle = 'transparent';\n      ctx.fillStyle = '#000000';\n    },\n\n    /**\n     * @private\n     * Sets line dash\n     * @param {CanvasRenderingContext2D} ctx Context to set the dash line on\n     * @param {Array} dashArray array representing dashes\n     */\n    _setLineDash: function(ctx, dashArray) {\n      if (!dashArray || dashArray.length === 0) {\n        return;\n      }\n      // Spec requires the concatenation of two copies the dash list when the number of elements is odd\n      if (1 & dashArray.length) {\n        dashArray.push.apply(dashArray, dashArray);\n      }\n      ctx.setLineDash(dashArray);\n    },\n\n    /**\n     * Renders controls and borders for the object\n     * the context here is not transformed\n     * @param {CanvasRenderingContext2D} ctx Context to render on\n     * @param {Object} [styleOverride] properties to override the object style\n     */\n    _renderControls: function(ctx, styleOverride) {\n      var vpt = this.getViewportTransform(),\n          matrix = this.calcTransformMatrix(),\n          options, drawBorders, drawControls;\n      styleOverride = styleOverride || { };\n      drawBorders = typeof styleOverride.hasBorders !== 'undefined' ? styleOverride.hasBorders : this.hasBorders;\n      drawControls = typeof styleOverride.hasControls !== 'undefined' ? styleOverride.hasControls : this.hasControls;\n      matrix = fabric.util.multiplyTransformMatrices(vpt, matrix);\n      options = fabric.util.qrDecompose(matrix);\n      ctx.save();\n      ctx.translate(options.translateX, options.translateY);\n      ctx.lineWidth = 1 * this.borderScaleFactor;\n      if (!this.group) {\n        ctx.globalAlpha = this.isMoving ? this.borderOpacityWhenMoving : 1;\n      }\n      if (this.flipX) {\n        options.angle -= 180;\n      }\n      ctx.rotate(degreesToRadians(this.group ? options.angle : this.angle));\n      if (styleOverride.forActiveSelection || this.group) {\n        drawBorders && this.drawBordersInGroup(ctx, options, styleOverride);\n      }\n      else {\n        drawBorders && this.drawBorders(ctx, styleOverride);\n      }\n      drawControls && this.drawControls(ctx, styleOverride);\n      ctx.restore();\n    },\n\n    /**\n     * @private\n     * @param {CanvasRenderingContext2D} ctx Context to render on\n     */\n    _setShadow: function(ctx) {\n      if (!this.shadow) {\n        return;\n      }\n\n      var shadow = this.shadow, canvas = this.canvas, scaling,\n          multX = (canvas && canvas.viewportTransform[0]) || 1,\n          multY = (canvas && canvas.viewportTransform[3]) || 1;\n      if (shadow.nonScaling) {\n        scaling = { scaleX: 1, scaleY: 1 };\n      }\n      else {\n        scaling = this.getObjectScaling();\n      }\n      if (canvas && canvas._isRetinaScaling()) {\n        multX *= fabric.devicePixelRatio;\n        multY *= fabric.devicePixelRatio;\n      }\n      ctx.shadowColor = shadow.color;\n      ctx.shadowBlur = shadow.blur * fabric.browserShadowBlurConstant *\n        (multX + multY) * (scaling.scaleX + scaling.scaleY) / 4;\n      ctx.shadowOffsetX = shadow.offsetX * multX * scaling.scaleX;\n      ctx.shadowOffsetY = shadow.offsetY * multY * scaling.scaleY;\n    },\n\n    /**\n     * @private\n     * @param {CanvasRenderingContext2D} ctx Context to render on\n     */\n    _removeShadow: function(ctx) {\n      if (!this.shadow) {\n        return;\n      }\n\n      ctx.shadowColor = '';\n      ctx.shadowBlur = ctx.shadowOffsetX = ctx.shadowOffsetY = 0;\n    },\n\n    /**\n     * @private\n     * @param {CanvasRenderingContext2D} ctx Context to render on\n     * @param {Object} filler fabric.Pattern or fabric.Gradient\n     * @return {Object} offset.offsetX offset for text rendering\n     * @return {Object} offset.offsetY offset for text rendering\n     */\n    _applyPatternGradientTransform: function(ctx, filler) {\n      if (!filler || !filler.toLive) {\n        return { offsetX: 0, offsetY: 0 };\n      }\n      var t = filler.gradientTransform || filler.patternTransform;\n      var offsetX = -this.width / 2 + filler.offsetX || 0,\n          offsetY = -this.height / 2 + filler.offsetY || 0;\n\n      if (filler.gradientUnits === 'percentage') {\n        ctx.transform(this.width, 0, 0, this.height, offsetX, offsetY);\n      }\n      else {\n        ctx.transform(1, 0, 0, 1, offsetX, offsetY);\n      }\n      if (t) {\n        ctx.transform(t[0], t[1], t[2], t[3], t[4], t[5]);\n      }\n      return { offsetX: offsetX, offsetY: offsetY };\n    },\n\n    /**\n     * @private\n     * @param {CanvasRenderingContext2D} ctx Context to render on\n     */\n    _renderPaintInOrder: function(ctx) {\n      if (this.paintFirst === 'stroke') {\n        this._renderStroke(ctx);\n        this._renderFill(ctx);\n      }\n      else {\n        this._renderFill(ctx);\n        this._renderStroke(ctx);\n      }\n    },\n\n    /**\n     * @private\n     * function that actually render something on the context.\n     * empty here to allow Obects to work on tests to benchmark fabric functionalites\n     * not related to rendering\n     * @param {CanvasRenderingContext2D} ctx Context to render on\n     */\n    _render: function(/* ctx */) {\n\n    },\n\n    /**\n     * @private\n     * @param {CanvasRenderingContext2D} ctx Context to render on\n     */\n    _renderFill: function(ctx) {\n      if (!this.fill) {\n        return;\n      }\n\n      ctx.save();\n      this._setFillStyles(ctx, this);\n      if (this.fillRule === 'evenodd') {\n        ctx.fill('evenodd');\n      }\n      else {\n        ctx.fill();\n      }\n      ctx.restore();\n    },\n\n    /**\n     * @private\n     * @param {CanvasRenderingContext2D} ctx Context to render on\n     */\n    _renderStroke: function(ctx) {\n      if (!this.stroke || this.strokeWidth === 0) {\n        return;\n      }\n\n      if (this.shadow && !this.shadow.affectStroke) {\n        this._removeShadow(ctx);\n      }\n\n      ctx.save();\n      if (this.strokeUniform && this.group) {\n        var scaling = this.getObjectScaling();\n        ctx.scale(1 / scaling.scaleX, 1 / scaling.scaleY);\n      }\n      else if (this.strokeUniform) {\n        ctx.scale(1 / this.scaleX, 1 / this.scaleY);\n      }\n      this._setLineDash(ctx, this.strokeDashArray);\n      this._setStrokeStyles(ctx, this);\n      ctx.stroke();\n      ctx.restore();\n    },\n\n    /**\n     * This function try to patch the missing gradientTransform on canvas gradients.\n     * transforming a context to transform the gradient, is going to transform the stroke too.\n     * we want to transform the gradient but not the stroke operation, so we create\n     * a transformed gradient on a pattern and then we use the pattern instead of the gradient.\n     * this method has drwabacks: is slow, is in low resolution, needs a patch for when the size\n     * is limited.\n     * @private\n     * @param {CanvasRenderingContext2D} ctx Context to render on\n     * @param {fabric.Gradient} filler a fabric gradient instance\n     */\n    _applyPatternForTransformedGradient: function(ctx, filler) {\n      var dims = this._limitCacheSize(this._getCacheCanvasDimensions()),\n          pCanvas = fabric.util.createCanvasElement(), pCtx, retinaScaling = this.canvas.getRetinaScaling(),\n          width = dims.x / this.scaleX / retinaScaling, height = dims.y / this.scaleY / retinaScaling;\n      pCanvas.width = width;\n      pCanvas.height = height;\n      pCtx = pCanvas.getContext('2d');\n      pCtx.beginPath(); pCtx.moveTo(0, 0); pCtx.lineTo(width, 0); pCtx.lineTo(width, height);\n      pCtx.lineTo(0, height); pCtx.closePath();\n      pCtx.translate(width / 2, height / 2);\n      pCtx.scale(\n        dims.zoomX / this.scaleX / retinaScaling,\n        dims.zoomY / this.scaleY / retinaScaling\n      );\n      this._applyPatternGradientTransform(pCtx, filler);\n      pCtx.fillStyle = filler.toLive(ctx);\n      pCtx.fill();\n      ctx.translate(-this.width / 2 - this.strokeWidth / 2, -this.height / 2 - this.strokeWidth / 2);\n      ctx.scale(\n        retinaScaling * this.scaleX / dims.zoomX,\n        retinaScaling * this.scaleY / dims.zoomY\n      );\n      ctx.strokeStyle = pCtx.createPattern(pCanvas, 'no-repeat');\n    },\n\n    /**\n     * This function is an helper for svg import. it returns the center of the object in the svg\n     * untransformed coordinates\n     * @private\n     * @return {Object} center point from element coordinates\n     */\n    _findCenterFromElement: function() {\n      return { x: this.left + this.width / 2, y: this.top + this.height / 2 };\n    },\n\n    /**\n     * This function is an helper for svg import. it decompose the transformMatrix\n     * and assign properties to object.\n     * untransformed coordinates\n     * @private\n     * @chainable\n     */\n    _assignTransformMatrixProps: function() {\n      if (this.transformMatrix) {\n        var options = fabric.util.qrDecompose(this.transformMatrix);\n        this.flipX = false;\n        this.flipY = false;\n        this.set('scaleX', options.scaleX);\n        this.set('scaleY', options.scaleY);\n        this.angle = options.angle;\n        this.skewX = options.skewX;\n        this.skewY = 0;\n      }\n    },\n\n    /**\n     * This function is an helper for svg import. it removes the transform matrix\n     * and set to object properties that fabricjs can handle\n     * @private\n     * @param {Object} preserveAspectRatioOptions\n     * @return {thisArg}\n     */\n    _removeTransformMatrix: function(preserveAspectRatioOptions) {\n      var center = this._findCenterFromElement();\n      if (this.transformMatrix) {\n        this._assignTransformMatrixProps();\n        center = fabric.util.transformPoint(center, this.transformMatrix);\n      }\n      this.transformMatrix = null;\n      if (preserveAspectRatioOptions) {\n        this.scaleX *= preserveAspectRatioOptions.scaleX;\n        this.scaleY *= preserveAspectRatioOptions.scaleY;\n        this.cropX = preserveAspectRatioOptions.cropX;\n        this.cropY = preserveAspectRatioOptions.cropY;\n        center.x += preserveAspectRatioOptions.offsetLeft;\n        center.y += preserveAspectRatioOptions.offsetTop;\n        this.width = preserveAspectRatioOptions.width;\n        this.height = preserveAspectRatioOptions.height;\n      }\n      this.setPositionByOrigin(center, 'center', 'center');\n    },\n\n    /**\n     * Clones an instance, using a callback method will work for every object.\n     * @param {Function} callback Callback is invoked with a clone as a first argument\n     * @param {Array} [propertiesToInclude] Any properties that you might want to additionally include in the output\n     */\n    clone: function(callback, propertiesToInclude) {\n      var objectForm = this.toObject(propertiesToInclude);\n      if (this.constructor.fromObject) {\n        this.constructor.fromObject(objectForm, callback);\n      }\n      else {\n        fabric.Object._fromObject('Object', objectForm, callback);\n      }\n    },\n\n    /**\n     * Creates an instance of fabric.Image out of an object\n     * makes use of toCanvasElement.\n     * Once this method was based on toDataUrl and loadImage, so it also had a quality\n     * and format option. toCanvasElement is faster and produce no loss of quality.\n     * If you need to get a real Jpeg or Png from an object, using toDataURL is the right way to do it.\n     * toCanvasElement and then toBlob from the obtained canvas is also a good option.\n     * This method is sync now, but still support the callback because we did not want to break.\n     * When fabricJS 5.0 will be planned, this will probably be changed to not have a callback.\n     * @param {Function} callback callback, invoked with an instance as a first argument\n     * @param {Object} [options] for clone as image, passed to toDataURL\n     * @param {Number} [options.multiplier=1] Multiplier to scale by\n     * @param {Number} [options.left] Cropping left offset. Introduced in v1.2.14\n     * @param {Number} [options.top] Cropping top offset. Introduced in v1.2.14\n     * @param {Number} [options.width] Cropping width. Introduced in v1.2.14\n     * @param {Number} [options.height] Cropping height. Introduced in v1.2.14\n     * @param {Boolean} [options.enableRetinaScaling] Enable retina scaling for clone image. Introduce in 1.6.4\n     * @param {Boolean} [options.withoutTransform] Remove current object transform ( no scale , no angle, no flip, no skew ). Introduced in 2.3.4\n     * @param {Boolean} [options.withoutShadow] Remove current object shadow. Introduced in 2.4.2\n     * @return {fabric.Object} thisArg\n     */\n    cloneAsImage: function(callback, options) {\n      var canvasEl = this.toCanvasElement(options);\n      if (callback) {\n        callback(new fabric.Image(canvasEl));\n      }\n      return this;\n    },\n\n    /**\n     * Converts an object into a HTMLCanvas element\n     * @param {Object} options Options object\n     * @param {Number} [options.multiplier=1] Multiplier to scale by\n     * @param {Number} [options.left] Cropping left offset. Introduced in v1.2.14\n     * @param {Number} [options.top] Cropping top offset. Introduced in v1.2.14\n     * @param {Number} [options.width] Cropping width. Introduced in v1.2.14\n     * @param {Number} [options.height] Cropping height. Introduced in v1.2.14\n     * @param {Boolean} [options.enableRetinaScaling] Enable retina scaling for clone image. Introduce in 1.6.4\n     * @param {Boolean} [options.withoutTransform] Remove current object transform ( no scale , no angle, no flip, no skew ). Introduced in 2.3.4\n     * @param {Boolean} [options.withoutShadow] Remove current object shadow. Introduced in 2.4.2\n     * @return {HTMLCanvasElement} Returns DOM element <canvas> with the fabric.Object\n     */\n    toCanvasElement: function(options) {\n      options || (options = { });\n\n      var utils = fabric.util, origParams = utils.saveObjectTransform(this),\n          originalGroup = this.group,\n          originalShadow = this.shadow, abs = Math.abs,\n          multiplier = (options.multiplier || 1) * (options.enableRetinaScaling ? fabric.devicePixelRatio : 1);\n      delete this.group;\n      if (options.withoutTransform) {\n        utils.resetObjectTransform(this);\n      }\n      if (options.withoutShadow) {\n        this.shadow = null;\n      }\n\n      var el = fabric.util.createCanvasElement(),\n          // skip canvas zoom and calculate with setCoords now.\n          boundingRect = this.getBoundingRect(true, true),\n          shadow = this.shadow, scaling,\n          shadowOffset = { x: 0, y: 0 }, shadowBlur,\n          width, height;\n\n      if (shadow) {\n        shadowBlur = shadow.blur;\n        if (shadow.nonScaling) {\n          scaling = { scaleX: 1, scaleY: 1 };\n        }\n        else {\n          scaling = this.getObjectScaling();\n        }\n        // consider non scaling shadow.\n        shadowOffset.x = 2 * Math.round(abs(shadow.offsetX) + shadowBlur) * (abs(scaling.scaleX));\n        shadowOffset.y = 2 * Math.round(abs(shadow.offsetY) + shadowBlur) * (abs(scaling.scaleY));\n      }\n      width = boundingRect.width + shadowOffset.x;\n      height = boundingRect.height + shadowOffset.y;\n      // if the current width/height is not an integer\n      // we need to make it so.\n      el.width = Math.ceil(width);\n      el.height = Math.ceil(height);\n      var canvas = new fabric.StaticCanvas(el, {\n        enableRetinaScaling: false,\n        renderOnAddRemove: false,\n        skipOffscreen: false,\n      });\n      if (options.format === 'jpeg') {\n        canvas.backgroundColor = '#fff';\n      }\n      this.setPositionByOrigin(new fabric.Point(canvas.width / 2, canvas.height / 2), 'center', 'center');\n\n      var originalCanvas = this.canvas;\n      canvas.add(this);\n      var canvasEl = canvas.toCanvasElement(multiplier || 1, options);\n      this.shadow = originalShadow;\n      this.set('canvas', originalCanvas);\n      if (originalGroup) {\n        this.group = originalGroup;\n      }\n      this.set(origParams).setCoords();\n      // canvas.dispose will call image.dispose that will nullify the elements\n      // since this canvas is a simple element for the process, we remove references\n      // to objects in this way in order to avoid object trashing.\n      canvas._objects = [];\n      canvas.dispose();\n      canvas = null;\n\n      return canvasEl;\n    },\n\n    /**\n     * Converts an object into a data-url-like string\n     * @param {Object} options Options object\n     * @param {String} [options.format=png] The format of the output image. Either \"jpeg\" or \"png\"\n     * @param {Number} [options.quality=1] Quality level (0..1). Only used for jpeg.\n     * @param {Number} [options.multiplier=1] Multiplier to scale by\n     * @param {Number} [options.left] Cropping left offset. Introduced in v1.2.14\n     * @param {Number} [options.top] Cropping top offset. Introduced in v1.2.14\n     * @param {Number} [options.width] Cropping width. Introduced in v1.2.14\n     * @param {Number} [options.height] Cropping height. Introduced in v1.2.14\n     * @param {Boolean} [options.enableRetinaScaling] Enable retina scaling for clone image. Introduce in 1.6.4\n     * @param {Boolean} [options.withoutTransform] Remove current object transform ( no scale , no angle, no flip, no skew ). Introduced in 2.3.4\n     * @param {Boolean} [options.withoutShadow] Remove current object shadow. Introduced in 2.4.2\n     * @return {String} Returns a data: URL containing a representation of the object in the format specified by options.format\n     */\n    toDataURL: function(options) {\n      options || (options = { });\n      return fabric.util.toDataURL(this.toCanvasElement(options), options.format || 'png', options.quality || 1);\n    },\n\n    /**\n     * Returns true if specified type is identical to the type of an instance\n     * @param {String} type Type to check against\n     * @return {Boolean}\n     */\n    isType: function(type) {\n      return arguments.length > 1 ? Array.from(arguments).includes(this.type) : this.type === type;\n    },\n\n    /**\n     * Returns complexity of an instance\n     * @return {Number} complexity of this instance (is 1 unless subclassed)\n     */\n    complexity: function() {\n      return 1;\n    },\n\n    /**\n     * Returns a JSON representation of an instance\n     * @param {Array} [propertiesToInclude] Any properties that you might want to additionally include in the output\n     * @return {Object} JSON\n     */\n    toJSON: function(propertiesToInclude) {\n      // delegate, not alias\n      return this.toObject(propertiesToInclude);\n    },\n\n    /**\n     * Sets \"angle\" of an instance with centered rotation\n     * @param {Number} angle Angle value (in degrees)\n     * @return {fabric.Object} thisArg\n     * @chainable\n     */\n    rotate: function(angle) {\n      var shouldCenterOrigin = (this.originX !== 'center' || this.originY !== 'center') && this.centeredRotation;\n\n      if (shouldCenterOrigin) {\n        this._setOriginToCenter();\n      }\n\n      this.set('angle', angle);\n\n      if (shouldCenterOrigin) {\n        this._resetOrigin();\n      }\n\n      return this;\n    },\n\n    /**\n     * Centers object horizontally on canvas to which it was added last.\n     * You might need to call `setCoords` on an object after centering, to update controls area.\n     * @return {fabric.Object} thisArg\n     * @chainable\n     */\n    centerH: function () {\n      this.canvas && this.canvas.centerObjectH(this);\n      return this;\n    },\n\n    /**\n     * Centers object horizontally on current viewport of canvas to which it was added last.\n     * You might need to call `setCoords` on an object after centering, to update controls area.\n     * @return {fabric.Object} thisArg\n     * @chainable\n     */\n    viewportCenterH: function () {\n      this.canvas && this.canvas.viewportCenterObjectH(this);\n      return this;\n    },\n\n    /**\n     * Centers object vertically on canvas to which it was added last.\n     * You might need to call `setCoords` on an object after centering, to update controls area.\n     * @return {fabric.Object} thisArg\n     * @chainable\n     */\n    centerV: function () {\n      this.canvas && this.canvas.centerObjectV(this);\n      return this;\n    },\n\n    /**\n     * Centers object vertically on current viewport of canvas to which it was added last.\n     * You might need to call `setCoords` on an object after centering, to update controls area.\n     * @return {fabric.Object} thisArg\n     * @chainable\n     */\n    viewportCenterV: function () {\n      this.canvas && this.canvas.viewportCenterObjectV(this);\n      return this;\n    },\n\n    /**\n     * Centers object vertically and horizontally on canvas to which is was added last\n     * You might need to call `setCoords` on an object after centering, to update controls area.\n     * @return {fabric.Object} thisArg\n     * @chainable\n     */\n    center: function () {\n      this.canvas && this.canvas.centerObject(this);\n      return this;\n    },\n\n    /**\n     * Centers object on current viewport of canvas to which it was added last.\n     * You might need to call `setCoords` on an object after centering, to update controls area.\n     * @return {fabric.Object} thisArg\n     * @chainable\n     */\n    viewportCenter: function () {\n      this.canvas && this.canvas.viewportCenterObject(this);\n      return this;\n    },\n\n    /**\n     * Returns coordinates of a pointer relative to an object\n     * @param {Event} e Event to operate upon\n     * @param {Object} [pointer] Pointer to operate upon (instead of event)\n     * @return {Object} Coordinates of a pointer (x, y)\n     */\n    getLocalPointer: function(e, pointer) {\n      pointer = pointer || this.canvas.getPointer(e);\n      var pClicked = new fabric.Point(pointer.x, pointer.y),\n          objectLeftTop = this._getLeftTopCoords();\n      if (this.angle) {\n        pClicked = fabric.util.rotatePoint(\n          pClicked, objectLeftTop, degreesToRadians(-this.angle));\n      }\n      return {\n        x: pClicked.x - objectLeftTop.x,\n        y: pClicked.y - objectLeftTop.y\n      };\n    },\n\n    /**\n     * Sets canvas globalCompositeOperation for specific object\n     * custom composition operation for the particular object can be specified using globalCompositeOperation property\n     * @param {CanvasRenderingContext2D} ctx Rendering canvas context\n     */\n    _setupCompositeOperation: function (ctx) {\n      if (this.globalCompositeOperation) {\n        ctx.globalCompositeOperation = this.globalCompositeOperation;\n      }\n    },\n\n    /**\n     * cancel instance's running animations\n     * override if necessary to dispose artifacts such as `clipPath`\n     */\n    dispose: function () {\n      if (fabric.runningAnimations) {\n        fabric.runningAnimations.cancelByTarget(this);\n      }\n    }\n  });\n\n  fabric.util.createAccessors && fabric.util.createAccessors(fabric.Object);\n\n  extend(fabric.Object.prototype, fabric.Observable);\n\n  /**\n   * Defines the number of fraction digits to use when serializing object values.\n   * You can use it to increase/decrease precision of such values like left, top, scaleX, scaleY, etc.\n   * @static\n   * @memberOf fabric.Object\n   * @constant\n   * @type Number\n   */\n  fabric.Object.NUM_FRACTION_DIGITS = 2;\n\n  /**\n   * Defines which properties should be enlivened from the object passed to {@link fabric.Object._fromObject}\n   * @static\n   * @memberOf fabric.Object\n   * @constant\n   * @type string[]\n   */\n  fabric.Object.ENLIVEN_PROPS = ['clipPath'];\n\n  fabric.Object._fromObject = function(className, object, callback, extraParam) {\n    var klass = fabric[className];\n    object = clone(object, true);\n    fabric.util.enlivenPatterns([object.fill, object.stroke], function(patterns) {\n      if (typeof patterns[0] !== 'undefined') {\n        object.fill = patterns[0];\n      }\n      if (typeof patterns[1] !== 'undefined') {\n        object.stroke = patterns[1];\n      }\n      fabric.util.enlivenObjectEnlivables(object, object, function () {\n        var instance = extraParam ? new klass(object[extraParam], object) : new klass(object);\n        callback && callback(instance);\n      });\n    });\n  };\n\n  /**\n   * Unique id used internally when creating SVG elements\n   * @static\n   * @memberOf fabric.Object\n   * @type Number\n   */\n  fabric.Object.__uid = 0;\n})(typeof exports !== 'undefined' ? exports : this);\n\n\n(function() {\n\n  var degreesToRadians = fabric.util.degreesToRadians,\n      originXOffset = {\n        left: -0.5,\n        center: 0,\n        right: 0.5\n      },\n      originYOffset = {\n        top: -0.5,\n        center: 0,\n        bottom: 0.5\n      };\n\n  fabric.util.object.extend(fabric.Object.prototype, /** @lends fabric.Object.prototype */ {\n\n    /**\n     * Translates the coordinates from a set of origin to another (based on the object's dimensions)\n     * @param {fabric.Point} point The point which corresponds to the originX and originY params\n     * @param {String} fromOriginX Horizontal origin: 'left', 'center' or 'right'\n     * @param {String} fromOriginY Vertical origin: 'top', 'center' or 'bottom'\n     * @param {String} toOriginX Horizontal origin: 'left', 'center' or 'right'\n     * @param {String} toOriginY Vertical origin: 'top', 'center' or 'bottom'\n     * @return {fabric.Point}\n     */\n    translateToGivenOrigin: function(point, fromOriginX, fromOriginY, toOriginX, toOriginY) {\n      var x = point.x,\n          y = point.y,\n          offsetX, offsetY, dim;\n\n      if (typeof fromOriginX === 'string') {\n        fromOriginX = originXOffset[fromOriginX];\n      }\n      else {\n        fromOriginX -= 0.5;\n      }\n\n      if (typeof toOriginX === 'string') {\n        toOriginX = originXOffset[toOriginX];\n      }\n      else {\n        toOriginX -= 0.5;\n      }\n\n      offsetX = toOriginX - fromOriginX;\n\n      if (typeof fromOriginY === 'string') {\n        fromOriginY = originYOffset[fromOriginY];\n      }\n      else {\n        fromOriginY -= 0.5;\n      }\n\n      if (typeof toOriginY === 'string') {\n        toOriginY = originYOffset[toOriginY];\n      }\n      else {\n        toOriginY -= 0.5;\n      }\n\n      offsetY = toOriginY - fromOriginY;\n\n      if (offsetX || offsetY) {\n        dim = this._getTransformedDimensions();\n        x = point.x + offsetX * dim.x;\n        y = point.y + offsetY * dim.y;\n      }\n\n      return new fabric.Point(x, y);\n    },\n\n    /**\n     * Translates the coordinates from origin to center coordinates (based on the object's dimensions)\n     * @param {fabric.Point} point The point which corresponds to the originX and originY params\n     * @param {String} originX Horizontal origin: 'left', 'center' or 'right'\n     * @param {String} originY Vertical origin: 'top', 'center' or 'bottom'\n     * @return {fabric.Point}\n     */\n    translateToCenterPoint: function(point, originX, originY) {\n      var p = this.translateToGivenOrigin(point, originX, originY, 'center', 'center');\n      if (this.angle) {\n        return fabric.util.rotatePoint(p, point, degreesToRadians(this.angle));\n      }\n      return p;\n    },\n\n    /**\n     * Translates the coordinates from center to origin coordinates (based on the object's dimensions)\n     * @param {fabric.Point} center The point which corresponds to center of the object\n     * @param {String} originX Horizontal origin: 'left', 'center' or 'right'\n     * @param {String} originY Vertical origin: 'top', 'center' or 'bottom'\n     * @return {fabric.Point}\n     */\n    translateToOriginPoint: function(center, originX, originY) {\n      var p = this.translateToGivenOrigin(center, 'center', 'center', originX, originY);\n      if (this.angle) {\n        return fabric.util.rotatePoint(p, center, degreesToRadians(this.angle));\n      }\n      return p;\n    },\n\n    /**\n     * Returns the real center coordinates of the object\n     * @return {fabric.Point}\n     */\n    getCenterPoint: function() {\n      var leftTop = new fabric.Point(this.left, this.top);\n      return this.translateToCenterPoint(leftTop, this.originX, this.originY);\n    },\n\n    /**\n     * Returns the coordinates of the object based on center coordinates\n     * @param {fabric.Point} point The point which corresponds to the originX and originY params\n     * @return {fabric.Point}\n     */\n    // getOriginPoint: function(center) {\n    //   return this.translateToOriginPoint(center, this.originX, this.originY);\n    // },\n\n    /**\n     * Returns the coordinates of the object as if it has a different origin\n     * @param {String} originX Horizontal origin: 'left', 'center' or 'right'\n     * @param {String} originY Vertical origin: 'top', 'center' or 'bottom'\n     * @return {fabric.Point}\n     */\n    getPointByOrigin: function(originX, originY) {\n      var center = this.getCenterPoint();\n      return this.translateToOriginPoint(center, originX, originY);\n    },\n\n    /**\n     * Returns the point in local coordinates\n     * @param {fabric.Point} point The point relative to the global coordinate system\n     * @param {String} originX Horizontal origin: 'left', 'center' or 'right'\n     * @param {String} originY Vertical origin: 'top', 'center' or 'bottom'\n     * @return {fabric.Point}\n     */\n    toLocalPoint: function(point, originX, originY) {\n      var center = this.getCenterPoint(),\n          p, p2;\n\n      if (typeof originX !== 'undefined' && typeof originY !== 'undefined' ) {\n        p = this.translateToGivenOrigin(center, 'center', 'center', originX, originY);\n      }\n      else {\n        p = new fabric.Point(this.left, this.top);\n      }\n\n      p2 = new fabric.Point(point.x, point.y);\n      if (this.angle) {\n        p2 = fabric.util.rotatePoint(p2, center, -degreesToRadians(this.angle));\n      }\n      return p2.subtractEquals(p);\n    },\n\n    /**\n     * Returns the point in global coordinates\n     * @param {fabric.Point} The point relative to the local coordinate system\n     * @return {fabric.Point}\n     */\n    // toGlobalPoint: function(point) {\n    //   return fabric.util.rotatePoint(point, this.getCenterPoint(), degreesToRadians(this.angle)).addEquals(new fabric.Point(this.left, this.top));\n    // },\n\n    /**\n     * Sets the position of the object taking into consideration the object's origin\n     * @param {fabric.Point} pos The new position of the object\n     * @param {String} originX Horizontal origin: 'left', 'center' or 'right'\n     * @param {String} originY Vertical origin: 'top', 'center' or 'bottom'\n     * @return {void}\n     */\n    setPositionByOrigin: function(pos, originX, originY) {\n      var center = this.translateToCenterPoint(pos, originX, originY),\n          position = this.translateToOriginPoint(center, this.originX, this.originY);\n      this.set('left', position.x);\n      this.set('top', position.y);\n    },\n\n    /**\n     * @param {String} to One of 'left', 'center', 'right'\n     */\n    adjustPosition: function(to) {\n      var angle = degreesToRadians(this.angle),\n          hypotFull = this.getScaledWidth(),\n          xFull = fabric.util.cos(angle) * hypotFull,\n          yFull = fabric.util.sin(angle) * hypotFull,\n          offsetFrom, offsetTo;\n\n      //TODO: this function does not consider mixed situation like top, center.\n      if (typeof this.originX === 'string') {\n        offsetFrom = originXOffset[this.originX];\n      }\n      else {\n        offsetFrom = this.originX - 0.5;\n      }\n      if (typeof to === 'string') {\n        offsetTo = originXOffset[to];\n      }\n      else {\n        offsetTo = to - 0.5;\n      }\n      this.left += xFull * (offsetTo - offsetFrom);\n      this.top += yFull * (offsetTo - offsetFrom);\n      this.setCoords();\n      this.originX = to;\n    },\n\n    /**\n     * Sets the origin/position of the object to it's center point\n     * @private\n     * @return {void}\n     */\n    _setOriginToCenter: function() {\n      this._originalOriginX = this.originX;\n      this._originalOriginY = this.originY;\n\n      var center = this.getCenterPoint();\n\n      this.originX = 'center';\n      this.originY = 'center';\n\n      this.left = center.x;\n      this.top = center.y;\n    },\n\n    /**\n     * Resets the origin/position of the object to it's original origin\n     * @private\n     * @return {void}\n     */\n    _resetOrigin: function() {\n      var originPoint = this.translateToOriginPoint(\n        this.getCenterPoint(),\n        this._originalOriginX,\n        this._originalOriginY);\n\n      this.originX = this._originalOriginX;\n      this.originY = this._originalOriginY;\n\n      this.left = originPoint.x;\n      this.top = originPoint.y;\n\n      this._originalOriginX = null;\n      this._originalOriginY = null;\n    },\n\n    /**\n     * @private\n     */\n    _getLeftTopCoords: function() {\n      return this.translateToOriginPoint(this.getCenterPoint(), 'left', 'top');\n    },\n  });\n\n})();\n\n\n(function() {\n\n  function arrayFromCoords(coords) {\n    return [\n      new fabric.Point(coords.tl.x, coords.tl.y),\n      new fabric.Point(coords.tr.x, coords.tr.y),\n      new fabric.Point(coords.br.x, coords.br.y),\n      new fabric.Point(coords.bl.x, coords.bl.y)\n    ];\n  }\n\n  var util = fabric.util,\n      degreesToRadians = util.degreesToRadians,\n      multiplyMatrices = util.multiplyTransformMatrices,\n      transformPoint = util.transformPoint;\n\n  util.object.extend(fabric.Object.prototype, /** @lends fabric.Object.prototype */ {\n\n    /**\n     * Describe object's corner position in canvas element coordinates.\n     * properties are depending on control keys and padding the main controls.\n     * each property is an object with x, y and corner.\n     * The `corner` property contains in a similar manner the 4 points of the\n     * interactive area of the corner.\n     * The coordinates depends from the controls positionHandler and are used\n     * to draw and locate controls\n     * @memberOf fabric.Object.prototype\n     */\n    oCoords: null,\n\n    /**\n     * Describe object's corner position in canvas object absolute coordinates\n     * properties are tl,tr,bl,br and describe the four main corner.\n     * each property is an object with x, y, instance of Fabric.Point.\n     * The coordinates depends from this properties: width, height, scaleX, scaleY\n     * skewX, skewY, angle, strokeWidth, top, left.\n     * Those coordinates are useful to understand where an object is. They get updated\n     * with oCoords but they do not need to be updated when zoom or panning change.\n     * The coordinates get updated with @method setCoords.\n     * You can calculate them without updating with @method calcACoords();\n     * @memberOf fabric.Object.prototype\n     */\n    aCoords: null,\n\n    /**\n     * Describe object's corner position in canvas element coordinates.\n     * includes padding. Used of object detection.\n     * set and refreshed with setCoords.\n     * @memberOf fabric.Object.prototype\n     */\n    lineCoords: null,\n\n    /**\n     * storage for object transform matrix\n     */\n    ownMatrixCache: null,\n\n    /**\n     * storage for object full transform matrix\n     */\n    matrixCache: null,\n\n    /**\n     * custom controls interface\n     * controls are added by default_controls.js\n     */\n    controls: { },\n\n    /**\n     * return correct set of coordinates for intersection\n     * this will return either aCoords or lineCoords.\n     * @param {Boolean} absolute will return aCoords if true or lineCoords\n     * @return {Object} {tl, tr, br, bl} points\n     */\n    _getCoords: function(absolute, calculate) {\n      if (calculate) {\n        return (absolute ? this.calcACoords() : this.calcLineCoords());\n      }\n      if (!this.aCoords || !this.lineCoords) {\n        this.setCoords(true);\n      }\n      return (absolute ? this.aCoords : this.lineCoords);\n    },\n\n    /**\n     * return correct set of coordinates for intersection\n     * this will return either aCoords or lineCoords.\n     * The coords are returned in an array.\n     * @return {Array} [tl, tr, br, bl] of points\n     */\n    getCoords: function(absolute, calculate) {\n      return arrayFromCoords(this._getCoords(absolute, calculate));\n    },\n\n    /**\n     * Checks if object intersects with an area formed by 2 points\n     * @param {Object} pointTL top-left point of area\n     * @param {Object} pointBR bottom-right point of area\n     * @param {Boolean} [absolute] use coordinates without viewportTransform\n     * @param {Boolean} [calculate] use coordinates of current position instead of .oCoords\n     * @return {Boolean} true if object intersects with an area formed by 2 points\n     */\n    intersectsWithRect: function(pointTL, pointBR, absolute, calculate) {\n      var coords = this.getCoords(absolute, calculate),\n          intersection = fabric.Intersection.intersectPolygonRectangle(\n            coords,\n            pointTL,\n            pointBR\n          );\n      return intersection.status === 'Intersection';\n    },\n\n    /**\n     * Checks if object intersects with another object\n     * @param {Object} other Object to test\n     * @param {Boolean} [absolute] use coordinates without viewportTransform\n     * @param {Boolean} [calculate] use coordinates of current position instead of .oCoords\n     * @return {Boolean} true if object intersects with another object\n     */\n    intersectsWithObject: function(other, absolute, calculate) {\n      var intersection = fabric.Intersection.intersectPolygonPolygon(\n        this.getCoords(absolute, calculate),\n        other.getCoords(absolute, calculate)\n      );\n\n      return intersection.status === 'Intersection'\n        || other.isContainedWithinObject(this, absolute, calculate)\n        || this.isContainedWithinObject(other, absolute, calculate);\n    },\n\n    /**\n     * Checks if object is fully contained within area of another object\n     * @param {Object} other Object to test\n     * @param {Boolean} [absolute] use coordinates without viewportTransform\n     * @param {Boolean} [calculate] use coordinates of current position instead of .oCoords\n     * @return {Boolean} true if object is fully contained within area of another object\n     */\n    isContainedWithinObject: function(other, absolute, calculate) {\n      var points = this.getCoords(absolute, calculate),\n          otherCoords = absolute ? other.aCoords : other.lineCoords,\n          i = 0, lines = other._getImageLines(otherCoords);\n      for (; i < 4; i++) {\n        if (!other.containsPoint(points[i], lines)) {\n          return false;\n        }\n      }\n      return true;\n    },\n\n    /**\n     * Checks if object is fully contained within area formed by 2 points\n     * @param {Object} pointTL top-left point of area\n     * @param {Object} pointBR bottom-right point of area\n     * @param {Boolean} [absolute] use coordinates without viewportTransform\n     * @param {Boolean} [calculate] use coordinates of current position instead of .oCoords\n     * @return {Boolean} true if object is fully contained within area formed by 2 points\n     */\n    isContainedWithinRect: function(pointTL, pointBR, absolute, calculate) {\n      var boundingRect = this.getBoundingRect(absolute, calculate);\n\n      return (\n        boundingRect.left >= pointTL.x &&\n        boundingRect.left + boundingRect.width <= pointBR.x &&\n        boundingRect.top >= pointTL.y &&\n        boundingRect.top + boundingRect.height <= pointBR.y\n      );\n    },\n\n    /**\n     * Checks if point is inside the object\n     * @param {fabric.Point} point Point to check against\n     * @param {Object} [lines] object returned from @method _getImageLines\n     * @param {Boolean} [absolute] use coordinates without viewportTransform\n     * @param {Boolean} [calculate] use coordinates of current position instead of .oCoords\n     * @return {Boolean} true if point is inside the object\n     */\n    containsPoint: function(point, lines, absolute, calculate) {\n      var coords = this._getCoords(absolute, calculate),\n          lines = lines || this._getImageLines(coords),\n          xPoints = this._findCrossPoints(point, lines);\n      // if xPoints is odd then point is inside the object\n      return (xPoints !== 0 && xPoints % 2 === 1);\n    },\n\n    /**\n     * Checks if object is contained within the canvas with current viewportTransform\n     * the check is done stopping at first point that appears on screen\n     * @param {Boolean} [calculate] use coordinates of current position instead of .aCoords\n     * @return {Boolean} true if object is fully or partially contained within canvas\n     */\n    isOnScreen: function(calculate) {\n      if (!this.canvas) {\n        return false;\n      }\n      var pointTL = this.canvas.vptCoords.tl, pointBR = this.canvas.vptCoords.br;\n      var points = this.getCoords(true, calculate);\n      // if some point is on screen, the object is on screen.\n      if (points.some(function(point) {\n        return point.x <= pointBR.x && point.x >= pointTL.x &&\n        point.y <= pointBR.y && point.y >= pointTL.y;\n      })) {\n        return true;\n      }\n      // no points on screen, check intersection with absolute coordinates\n      if (this.intersectsWithRect(pointTL, pointBR, true, calculate)) {\n        return true;\n      }\n      return this._containsCenterOfCanvas(pointTL, pointBR, calculate);\n    },\n\n    /**\n     * Checks if the object contains the midpoint between canvas extremities\n     * Does not make sense outside the context of isOnScreen and isPartiallyOnScreen\n     * @private\n     * @param {Fabric.Point} pointTL Top Left point\n     * @param {Fabric.Point} pointBR Top Right point\n     * @param {Boolean} calculate use coordinates of current position instead of .oCoords\n     * @return {Boolean} true if the object contains the point\n     */\n    _containsCenterOfCanvas: function(pointTL, pointBR, calculate) {\n      // worst case scenario the object is so big that contains the screen\n      var centerPoint = { x: (pointTL.x + pointBR.x) / 2, y: (pointTL.y + pointBR.y) / 2 };\n      if (this.containsPoint(centerPoint, null, true, calculate)) {\n        return true;\n      }\n      return false;\n    },\n\n    /**\n     * Checks if object is partially contained within the canvas with current viewportTransform\n     * @param {Boolean} [calculate] use coordinates of current position instead of .oCoords\n     * @return {Boolean} true if object is partially contained within canvas\n     */\n    isPartiallyOnScreen: function(calculate) {\n      if (!this.canvas) {\n        return false;\n      }\n      var pointTL = this.canvas.vptCoords.tl, pointBR = this.canvas.vptCoords.br;\n      if (this.intersectsWithRect(pointTL, pointBR, true, calculate)) {\n        return true;\n      }\n      var allPointsAreOutside = this.getCoords(true, calculate).every(function(point) {\n        return (point.x >= pointBR.x || point.x <= pointTL.x) &&\n        (point.y >= pointBR.y || point.y <= pointTL.y);\n      });\n      return allPointsAreOutside && this._containsCenterOfCanvas(pointTL, pointBR, calculate);\n    },\n\n    /**\n     * Method that returns an object with the object edges in it, given the coordinates of the corners\n     * @private\n     * @param {Object} oCoords Coordinates of the object corners\n     */\n    _getImageLines: function(oCoords) {\n\n      var lines = {\n        topline: {\n          o: oCoords.tl,\n          d: oCoords.tr\n        },\n        rightline: {\n          o: oCoords.tr,\n          d: oCoords.br\n        },\n        bottomline: {\n          o: oCoords.br,\n          d: oCoords.bl\n        },\n        leftline: {\n          o: oCoords.bl,\n          d: oCoords.tl\n        }\n      };\n\n      // // debugging\n      // if (this.canvas.contextTop) {\n      //   this.canvas.contextTop.fillRect(lines.bottomline.d.x, lines.bottomline.d.y, 2, 2);\n      //   this.canvas.contextTop.fillRect(lines.bottomline.o.x, lines.bottomline.o.y, 2, 2);\n      //\n      //   this.canvas.contextTop.fillRect(lines.leftline.d.x, lines.leftline.d.y, 2, 2);\n      //   this.canvas.contextTop.fillRect(lines.leftline.o.x, lines.leftline.o.y, 2, 2);\n      //\n      //   this.canvas.contextTop.fillRect(lines.topline.d.x, lines.topline.d.y, 2, 2);\n      //   this.canvas.contextTop.fillRect(lines.topline.o.x, lines.topline.o.y, 2, 2);\n      //\n      //   this.canvas.contextTop.fillRect(lines.rightline.d.x, lines.rightline.d.y, 2, 2);\n      //   this.canvas.contextTop.fillRect(lines.rightline.o.x, lines.rightline.o.y, 2, 2);\n      // }\n\n      return lines;\n    },\n\n    /**\n     * Helper method to determine how many cross points are between the 4 object edges\n     * and the horizontal line determined by a point on canvas\n     * @private\n     * @param {fabric.Point} point Point to check\n     * @param {Object} lines Coordinates of the object being evaluated\n     */\n    // remove yi, not used but left code here just in case.\n    _findCrossPoints: function(point, lines) {\n      var b1, b2, a1, a2, xi, // yi,\n          xcount = 0,\n          iLine;\n\n      for (var lineKey in lines) {\n        iLine = lines[lineKey];\n        // optimisation 1: line below point. no cross\n        if ((iLine.o.y < point.y) && (iLine.d.y < point.y)) {\n          continue;\n        }\n        // optimisation 2: line above point. no cross\n        if ((iLine.o.y >= point.y) && (iLine.d.y >= point.y)) {\n          continue;\n        }\n        // optimisation 3: vertical line case\n        if ((iLine.o.x === iLine.d.x) && (iLine.o.x >= point.x)) {\n          xi = iLine.o.x;\n          // yi = point.y;\n        }\n        // calculate the intersection point\n        else {\n          b1 = 0;\n          b2 = (iLine.d.y - iLine.o.y) / (iLine.d.x - iLine.o.x);\n          a1 = point.y - b1 * point.x;\n          a2 = iLine.o.y - b2 * iLine.o.x;\n\n          xi = -(a1 - a2) / (b1 - b2);\n          // yi = a1 + b1 * xi;\n        }\n        // dont count xi < point.x cases\n        if (xi >= point.x) {\n          xcount += 1;\n        }\n        // optimisation 4: specific for square images\n        if (xcount === 2) {\n          break;\n        }\n      }\n      return xcount;\n    },\n\n    /**\n     * Returns coordinates of object's bounding rectangle (left, top, width, height)\n     * the box is intended as aligned to axis of canvas.\n     * @param {Boolean} [absolute] use coordinates without viewportTransform\n     * @param {Boolean} [calculate] use coordinates of current position instead of .oCoords / .aCoords\n     * @return {Object} Object with left, top, width, height properties\n     */\n    getBoundingRect: function(absolute, calculate) {\n      var coords = this.getCoords(absolute, calculate);\n      return util.makeBoundingBoxFromPoints(coords);\n    },\n\n    /**\n     * Returns width of an object's bounding box counting transformations\n     * before 2.0 it was named getWidth();\n     * @return {Number} width value\n     */\n    getScaledWidth: function() {\n      return this._getTransformedDimensions().x;\n    },\n\n    /**\n     * Returns height of an object bounding box counting transformations\n     * before 2.0 it was named getHeight();\n     * @return {Number} height value\n     */\n    getScaledHeight: function() {\n      return this._getTransformedDimensions().y;\n    },\n\n    /**\n     * Makes sure the scale is valid and modifies it if necessary\n     * @private\n     * @param {Number} value\n     * @return {Number}\n     */\n    _constrainScale: function(value) {\n      if (Math.abs(value) < this.minScaleLimit) {\n        if (value < 0) {\n          return -this.minScaleLimit;\n        }\n        else {\n          return this.minScaleLimit;\n        }\n      }\n      else if (value === 0) {\n        return 0.0001;\n      }\n      return value;\n    },\n\n    /**\n     * Scales an object (equally by x and y)\n     * @param {Number} value Scale factor\n     * @return {fabric.Object} thisArg\n     * @chainable\n     */\n    scale: function(value) {\n      this._set('scaleX', value);\n      this._set('scaleY', value);\n      return this.setCoords();\n    },\n\n    /**\n     * Scales an object to a given width, with respect to bounding box (scaling by x/y equally)\n     * @param {Number} value New width value\n     * @param {Boolean} absolute ignore viewport\n     * @return {fabric.Object} thisArg\n     * @chainable\n     */\n    scaleToWidth: function(value, absolute) {\n      // adjust to bounding rect factor so that rotated shapes would fit as well\n      var boundingRectFactor = this.getBoundingRect(absolute).width / this.getScaledWidth();\n      return this.scale(value / this.width / boundingRectFactor);\n    },\n\n    /**\n     * Scales an object to a given height, with respect to bounding box (scaling by x/y equally)\n     * @param {Number} value New height value\n     * @param {Boolean} absolute ignore viewport\n     * @return {fabric.Object} thisArg\n     * @chainable\n     */\n    scaleToHeight: function(value, absolute) {\n      // adjust to bounding rect factor so that rotated shapes would fit as well\n      var boundingRectFactor = this.getBoundingRect(absolute).height / this.getScaledHeight();\n      return this.scale(value / this.height / boundingRectFactor);\n    },\n\n    calcLineCoords: function() {\n      var vpt = this.getViewportTransform(),\n          padding = this.padding, angle = degreesToRadians(this.angle),\n          cos = util.cos(angle), sin = util.sin(angle),\n          cosP = cos * padding, sinP = sin * padding, cosPSinP = cosP + sinP,\n          cosPMinusSinP = cosP - sinP, aCoords = this.calcACoords();\n\n      var lineCoords = {\n        tl: transformPoint(aCoords.tl, vpt),\n        tr: transformPoint(aCoords.tr, vpt),\n        bl: transformPoint(aCoords.bl, vpt),\n        br: transformPoint(aCoords.br, vpt),\n      };\n\n      if (padding) {\n        lineCoords.tl.x -= cosPMinusSinP;\n        lineCoords.tl.y -= cosPSinP;\n        lineCoords.tr.x += cosPSinP;\n        lineCoords.tr.y -= cosPMinusSinP;\n        lineCoords.bl.x -= cosPSinP;\n        lineCoords.bl.y += cosPMinusSinP;\n        lineCoords.br.x += cosPMinusSinP;\n        lineCoords.br.y += cosPSinP;\n      }\n\n      return lineCoords;\n    },\n\n    calcOCoords: function() {\n      var rotateMatrix = this._calcRotateMatrix(),\n          translateMatrix = this._calcTranslateMatrix(),\n          vpt = this.getViewportTransform(),\n          startMatrix = multiplyMatrices(vpt, translateMatrix),\n          finalMatrix = multiplyMatrices(startMatrix, rotateMatrix),\n          finalMatrix = multiplyMatrices(finalMatrix, [1 / vpt[0], 0, 0, 1 / vpt[3], 0, 0]),\n          dim = this._calculateCurrentDimensions(),\n          coords = {};\n      this.forEachControl(function(control, key, fabricObject) {\n        coords[key] = control.positionHandler(dim, finalMatrix, fabricObject);\n      });\n\n      // debug code\n      // var canvas = this.canvas;\n      // setTimeout(function() {\n      //   canvas.contextTop.clearRect(0, 0, 700, 700);\n      //   canvas.contextTop.fillStyle = 'green';\n      //   Object.keys(coords).forEach(function(key) {\n      //     var control = coords[key];\n      //     canvas.contextTop.fillRect(control.x, control.y, 3, 3);\n      //   });\n      // }, 50);\n      return coords;\n    },\n\n    calcACoords: function() {\n      var rotateMatrix = this._calcRotateMatrix(),\n          translateMatrix = this._calcTranslateMatrix(),\n          finalMatrix = multiplyMatrices(translateMatrix, rotateMatrix),\n          dim = this._getTransformedDimensions(),\n          w = dim.x / 2, h = dim.y / 2;\n      return {\n        // corners\n        tl: transformPoint({ x: -w, y: -h }, finalMatrix),\n        tr: transformPoint({ x: w, y: -h }, finalMatrix),\n        bl: transformPoint({ x: -w, y: h }, finalMatrix),\n        br: transformPoint({ x: w, y: h }, finalMatrix)\n      };\n    },\n\n    /**\n     * Sets corner and controls position coordinates based on current angle, width and height, left and top.\n     * oCoords are used to find the corners\n     * aCoords are used to quickly find an object on the canvas\n     * lineCoords are used to quickly find object during pointer events.\n     * See {@link https://github.com/fabricjs/fabric.js/wiki/When-to-call-setCoords} and {@link http://fabricjs.com/fabric-gotchas}\n     *\n     * @param {Boolean} [skipCorners] skip calculation of oCoords.\n     * @return {fabric.Object} thisArg\n     * @chainable\n     */\n    setCoords: function(skipCorners) {\n      this.aCoords = this.calcACoords();\n      // in case we are in a group, for how the inner group target check works,\n      // lineCoords are exactly aCoords. Since the vpt gets absorbed by the normalized pointer.\n      this.lineCoords = this.group ? this.aCoords : this.calcLineCoords();\n      if (skipCorners) {\n        return this;\n      }\n      // set coordinates of the draggable boxes in the corners used to scale/rotate the image\n      this.oCoords = this.calcOCoords();\n      this._setCornerCoords && this._setCornerCoords();\n      return this;\n    },\n\n    /**\n     * calculate rotation matrix of an object\n     * @return {Array} rotation matrix for the object\n     */\n    _calcRotateMatrix: function() {\n      return util.calcRotateMatrix(this);\n    },\n\n    /**\n     * calculate the translation matrix for an object transform\n     * @return {Array} rotation matrix for the object\n     */\n    _calcTranslateMatrix: function() {\n      var center = this.getCenterPoint();\n      return [1, 0, 0, 1, center.x, center.y];\n    },\n\n    transformMatrixKey: function(skipGroup) {\n      var sep = '_', prefix = '';\n      if (!skipGroup && this.group) {\n        prefix = this.group.transformMatrixKey(skipGroup) + sep;\n      };\n      return prefix + this.top + sep + this.left + sep + this.scaleX + sep + this.scaleY +\n        sep + this.skewX + sep + this.skewY + sep + this.angle + sep + this.originX + sep + this.originY +\n        sep + this.width + sep + this.height + sep + this.strokeWidth + this.flipX + this.flipY;\n    },\n\n    /**\n     * calculate transform matrix that represents the current transformations from the\n     * object's properties.\n     * @param {Boolean} [skipGroup] return transform matrix for object not counting parent transformations\n     * There are some situation in which this is useful to avoid the fake rotation.\n     * @return {Array} transform matrix for the object\n     */\n    calcTransformMatrix: function(skipGroup) {\n      var matrix = this.calcOwnMatrix();\n      if (skipGroup || !this.group) {\n        return matrix;\n      }\n      var key = this.transformMatrixKey(skipGroup), cache = this.matrixCache || (this.matrixCache = {});\n      if (cache.key === key) {\n        return cache.value;\n      }\n      if (this.group) {\n        matrix = multiplyMatrices(this.group.calcTransformMatrix(false), matrix);\n      }\n      cache.key = key;\n      cache.value = matrix;\n      return matrix;\n    },\n\n    /**\n     * calculate transform matrix that represents the current transformations from the\n     * object's properties, this matrix does not include the group transformation\n     * @return {Array} transform matrix for the object\n     */\n    calcOwnMatrix: function() {\n      var key = this.transformMatrixKey(true), cache = this.ownMatrixCache || (this.ownMatrixCache = {});\n      if (cache.key === key) {\n        return cache.value;\n      }\n      var tMatrix = this._calcTranslateMatrix(),\n          options = {\n            angle: this.angle,\n            translateX: tMatrix[4],\n            translateY: tMatrix[5],\n            scaleX: this.scaleX,\n            scaleY: this.scaleY,\n            skewX: this.skewX,\n            skewY: this.skewY,\n            flipX: this.flipX,\n            flipY: this.flipY,\n          };\n      cache.key = key;\n      cache.value = util.composeMatrix(options);\n      return cache.value;\n    },\n\n    /*\n     * Calculate object dimensions from its properties\n     * @private\n     * @return {Object} .x width dimension\n     * @return {Object} .y height dimension\n     */\n    _getNonTransformedDimensions: function() {\n      var strokeWidth = this.strokeWidth,\n          w = this.width + strokeWidth,\n          h = this.height + strokeWidth;\n      return { x: w, y: h };\n    },\n\n    /*\n     * Calculate object bounding box dimensions from its properties scale, skew.\n     * @param {Number} skewX, a value to override current skewX\n     * @param {Number} skewY, a value to override current skewY\n     * @private\n     * @return {Object} .x width dimension\n     * @return {Object} .y height dimension\n     */\n    _getTransformedDimensions: function(skewX, skewY) {\n      if (typeof skewX === 'undefined') {\n        skewX = this.skewX;\n      }\n      if (typeof skewY === 'undefined') {\n        skewY = this.skewY;\n      }\n      var dimensions, dimX, dimY,\n          noSkew = skewX === 0 && skewY === 0;\n\n      if (this.strokeUniform) {\n        dimX = this.width;\n        dimY = this.height;\n      }\n      else {\n        dimensions = this._getNonTransformedDimensions();\n        dimX = dimensions.x;\n        dimY = dimensions.y;\n      }\n      if (noSkew) {\n        return this._finalizeDimensions(dimX * this.scaleX, dimY * this.scaleY);\n      }\n      var bbox = util.sizeAfterTransform(dimX, dimY, {\n        scaleX: this.scaleX,\n        scaleY: this.scaleY,\n        skewX: skewX,\n        skewY: skewY,\n      });\n      return this._finalizeDimensions(bbox.x, bbox.y);\n    },\n\n    /*\n     * Calculate object bounding box dimensions from its properties scale, skew.\n     * @param Number width width of the bbox\n     * @param Number height height of the bbox\n     * @private\n     * @return {Object} .x finalized width dimension\n     * @return {Object} .y finalized height dimension\n     */\n    _finalizeDimensions: function(width, height) {\n      return this.strokeUniform ?\n        { x: width + this.strokeWidth, y: height + this.strokeWidth }\n        :\n        { x: width, y: height };\n    },\n\n    /*\n     * Calculate object dimensions for controls box, including padding and canvas zoom.\n     * and active selection\n     * private\n     */\n    _calculateCurrentDimensions: function()  {\n      var vpt = this.getViewportTransform(),\n          dim = this._getTransformedDimensions(),\n          p = transformPoint(dim, vpt, true);\n      return p.scalarAdd(2 * this.padding);\n    },\n  });\n})();\n\n\nfabric.util.object.extend(fabric.Object.prototype, /** @lends fabric.Object.prototype */ {\n\n  /**\n   * Moves an object to the bottom of the stack of drawn objects\n   * @return {fabric.Object} thisArg\n   * @chainable\n   */\n  sendToBack: function() {\n    if (this.group) {\n      fabric.StaticCanvas.prototype.sendToBack.call(this.group, this);\n    }\n    else if (this.canvas) {\n      this.canvas.sendToBack(this);\n    }\n    return this;\n  },\n\n  /**\n   * Moves an object to the top of the stack of drawn objects\n   * @return {fabric.Object} thisArg\n   * @chainable\n   */\n  bringToFront: function() {\n    if (this.group) {\n      fabric.StaticCanvas.prototype.bringToFront.call(this.group, this);\n    }\n    else if (this.canvas) {\n      this.canvas.bringToFront(this);\n    }\n    return this;\n  },\n\n  /**\n   * Moves an object down in stack of drawn objects\n   * @param {Boolean} [intersecting] If `true`, send object behind next lower intersecting object\n   * @return {fabric.Object} thisArg\n   * @chainable\n   */\n  sendBackwards: function(intersecting) {\n    if (this.group) {\n      fabric.StaticCanvas.prototype.sendBackwards.call(this.group, this, intersecting);\n    }\n    else if (this.canvas) {\n      this.canvas.sendBackwards(this, intersecting);\n    }\n    return this;\n  },\n\n  /**\n   * Moves an object up in stack of drawn objects\n   * @param {Boolean} [intersecting] If `true`, send object in front of next upper intersecting object\n   * @return {fabric.Object} thisArg\n   * @chainable\n   */\n  bringForward: function(intersecting) {\n    if (this.group) {\n      fabric.StaticCanvas.prototype.bringForward.call(this.group, this, intersecting);\n    }\n    else if (this.canvas) {\n      this.canvas.bringForward(this, intersecting);\n    }\n    return this;\n  },\n\n  /**\n   * Moves an object to specified level in stack of drawn objects\n   * @param {Number} index New position of object\n   * @return {fabric.Object} thisArg\n   * @chainable\n   */\n  moveTo: function(index) {\n    if (this.group && this.group.type !== 'activeSelection') {\n      fabric.StaticCanvas.prototype.moveTo.call(this.group, this, index);\n    }\n    else if (this.canvas) {\n      this.canvas.moveTo(this, index);\n    }\n    return this;\n  }\n});\n\n\n/* _TO_SVG_START_ */\n(function() {\n  function getSvgColorString(prop, value) {\n    if (!value) {\n      return prop + ': none; ';\n    }\n    else if (value.toLive) {\n      return prop + ': url(#SVGID_' + value.id + '); ';\n    }\n    else {\n      var color = new fabric.Color(value),\n          str = prop + ': ' + color.toRgb() + '; ',\n          opacity = color.getAlpha();\n      if (opacity !== 1) {\n        //change the color in rgb + opacity\n        str += prop + '-opacity: ' + opacity.toString() + '; ';\n      }\n      return str;\n    }\n  }\n\n  var toFixed = fabric.util.toFixed;\n\n  fabric.util.object.extend(fabric.Object.prototype, /** @lends fabric.Object.prototype */ {\n    /**\n     * Returns styles-string for svg-export\n     * @param {Boolean} skipShadow a boolean to skip shadow filter output\n     * @return {String}\n     */\n    getSvgStyles: function(skipShadow) {\n\n      var fillRule = this.fillRule ? this.fillRule : 'nonzero',\n          strokeWidth = this.strokeWidth ? this.strokeWidth : '0',\n          strokeDashArray = this.strokeDashArray ? this.strokeDashArray.join(' ') : 'none',\n          strokeDashOffset = this.strokeDashOffset ? this.strokeDashOffset : '0',\n          strokeLineCap = this.strokeLineCap ? this.strokeLineCap : 'butt',\n          strokeLineJoin = this.strokeLineJoin ? this.strokeLineJoin : 'miter',\n          strokeMiterLimit = this.strokeMiterLimit ? this.strokeMiterLimit : '4',\n          opacity = typeof this.opacity !== 'undefined' ? this.opacity : '1',\n          visibility = this.visible ? '' : ' visibility: hidden;',\n          filter = skipShadow ? '' : this.getSvgFilter(),\n          fill = getSvgColorString('fill', this.fill),\n          stroke = getSvgColorString('stroke', this.stroke);\n\n      return [\n        stroke,\n        'stroke-width: ', strokeWidth, '; ',\n        'stroke-dasharray: ', strokeDashArray, '; ',\n        'stroke-linecap: ', strokeLineCap, '; ',\n        'stroke-dashoffset: ', strokeDashOffset, '; ',\n        'stroke-linejoin: ', strokeLineJoin, '; ',\n        'stroke-miterlimit: ', strokeMiterLimit, '; ',\n        fill,\n        'fill-rule: ', fillRule, '; ',\n        'opacity: ', opacity, ';',\n        filter,\n        visibility\n      ].join('');\n    },\n\n    /**\n     * Returns styles-string for svg-export\n     * @param {Object} style the object from which to retrieve style properties\n     * @param {Boolean} useWhiteSpace a boolean to include an additional attribute in the style.\n     * @return {String}\n     */\n    getSvgSpanStyles: function(style, useWhiteSpace) {\n      var term = '; ';\n      var fontFamily = style.fontFamily ?\n        'font-family: ' + (((style.fontFamily.indexOf('\\'') === -1 && style.fontFamily.indexOf('\"') === -1) ?\n          '\\'' + style.fontFamily  + '\\'' : style.fontFamily)) + term : '';\n      var strokeWidth = style.strokeWidth ? 'stroke-width: ' + style.strokeWidth + term : '',\n          fontFamily = fontFamily,\n          fontSize = style.fontSize ? 'font-size: ' + style.fontSize + 'px' + term : '',\n          fontStyle = style.fontStyle ? 'font-style: ' + style.fontStyle + term : '',\n          fontWeight = style.fontWeight ? 'font-weight: ' + style.fontWeight + term : '',\n          fill = style.fill ? getSvgColorString('fill', style.fill) : '',\n          stroke = style.stroke ? getSvgColorString('stroke', style.stroke) : '',\n          textDecoration = this.getSvgTextDecoration(style),\n          deltaY = style.deltaY ? 'baseline-shift: ' + (-style.deltaY) + '; ' : '';\n      if (textDecoration) {\n        textDecoration = 'text-decoration: ' + textDecoration + term;\n      }\n\n      return [\n        stroke,\n        strokeWidth,\n        fontFamily,\n        fontSize,\n        fontStyle,\n        fontWeight,\n        textDecoration,\n        fill,\n        deltaY,\n        useWhiteSpace ? 'white-space: pre; ' : ''\n      ].join('');\n    },\n\n    /**\n     * Returns text-decoration property for svg-export\n     * @param {Object} style the object from which to retrieve style properties\n     * @return {String}\n     */\n    getSvgTextDecoration: function(style) {\n      return ['overline', 'underline', 'line-through'].filter(function(decoration) {\n        return style[decoration.replace('-', '')];\n      }).join(' ');\n    },\n\n    /**\n     * Returns filter for svg shadow\n     * @return {String}\n     */\n    getSvgFilter: function() {\n      return this.shadow ? 'filter: url(#SVGID_' + this.shadow.id + ');' : '';\n    },\n\n    /**\n     * Returns id attribute for svg output\n     * @return {String}\n     */\n    getSvgCommons: function() {\n      return [\n        this.id ? 'id=\"' + this.id + '\" ' : '',\n        this.clipPath ? 'clip-path=\"url(#' + this.clipPath.clipPathId + ')\" ' : '',\n      ].join('');\n    },\n\n    /**\n     * Returns transform-string for svg-export\n     * @param {Boolean} use the full transform or the single object one.\n     * @return {String}\n     */\n    getSvgTransform: function(full, additionalTransform) {\n      var transform = full ? this.calcTransformMatrix() : this.calcOwnMatrix(),\n          svgTransform = 'transform=\"' + fabric.util.matrixToSVG(transform);\n      return svgTransform +\n        (additionalTransform || '') + '\" ';\n    },\n\n    _setSVGBg: function(textBgRects) {\n      if (this.backgroundColor) {\n        var NUM_FRACTION_DIGITS = fabric.Object.NUM_FRACTION_DIGITS;\n        textBgRects.push(\n          '\\t\\t<rect ',\n          this._getFillAttributes(this.backgroundColor),\n          ' x=\"',\n          toFixed(-this.width / 2, NUM_FRACTION_DIGITS),\n          '\" y=\"',\n          toFixed(-this.height / 2, NUM_FRACTION_DIGITS),\n          '\" width=\"',\n          toFixed(this.width, NUM_FRACTION_DIGITS),\n          '\" height=\"',\n          toFixed(this.height, NUM_FRACTION_DIGITS),\n          '\"></rect>\\n');\n      }\n    },\n\n    /**\n     * Returns svg representation of an instance\n     * @param {Function} [reviver] Method for further parsing of svg representation.\n     * @return {String} svg representation of an instance\n     */\n    toSVG: function(reviver) {\n      return this._createBaseSVGMarkup(this._toSVG(reviver), { reviver: reviver });\n    },\n\n    /**\n     * Returns svg clipPath representation of an instance\n     * @param {Function} [reviver] Method for further parsing of svg representation.\n     * @return {String} svg representation of an instance\n     */\n    toClipPathSVG: function(reviver) {\n      return '\\t' + this._createBaseClipPathSVGMarkup(this._toSVG(reviver), { reviver: reviver });\n    },\n\n    /**\n     * @private\n     */\n    _createBaseClipPathSVGMarkup: function(objectMarkup, options) {\n      options = options || {};\n      var reviver = options.reviver,\n          additionalTransform = options.additionalTransform || '',\n          commonPieces = [\n            this.getSvgTransform(true, additionalTransform),\n            this.getSvgCommons(),\n          ].join(''),\n          // insert commons in the markup, style and svgCommons\n          index = objectMarkup.indexOf('COMMON_PARTS');\n      objectMarkup[index] = commonPieces;\n      return reviver ? reviver(objectMarkup.join('')) : objectMarkup.join('');\n    },\n\n    /**\n     * @private\n     */\n    _createBaseSVGMarkup: function(objectMarkup, options) {\n      options = options || {};\n      var noStyle = options.noStyle,\n          reviver = options.reviver,\n          styleInfo = noStyle ? '' : 'style=\"' + this.getSvgStyles() + '\" ',\n          shadowInfo = options.withShadow ? 'style=\"' + this.getSvgFilter() + '\" ' : '',\n          clipPath = this.clipPath,\n          vectorEffect = this.strokeUniform ? 'vector-effect=\"non-scaling-stroke\" ' : '',\n          absoluteClipPath = clipPath && clipPath.absolutePositioned,\n          stroke = this.stroke, fill = this.fill, shadow = this.shadow,\n          commonPieces, markup = [], clipPathMarkup,\n          // insert commons in the markup, style and svgCommons\n          index = objectMarkup.indexOf('COMMON_PARTS'),\n          additionalTransform = options.additionalTransform;\n      if (clipPath) {\n        clipPath.clipPathId = 'CLIPPATH_' + fabric.Object.__uid++;\n        clipPathMarkup = '<clipPath id=\"' + clipPath.clipPathId + '\" >\\n' +\n          clipPath.toClipPathSVG(reviver) +\n          '</clipPath>\\n';\n      }\n      if (absoluteClipPath) {\n        markup.push(\n          '<g ', shadowInfo, this.getSvgCommons(), ' >\\n'\n        );\n      }\n      markup.push(\n        '<g ',\n        this.getSvgTransform(false),\n        !absoluteClipPath ? shadowInfo + this.getSvgCommons() : '',\n        ' >\\n'\n      );\n      commonPieces = [\n        styleInfo,\n        vectorEffect,\n        noStyle ? '' : this.addPaintOrder(), ' ',\n        additionalTransform ? 'transform=\"' + additionalTransform + '\" ' : '',\n      ].join('');\n      objectMarkup[index] = commonPieces;\n      if (fill && fill.toLive) {\n        markup.push(fill.toSVG(this));\n      }\n      if (stroke && stroke.toLive) {\n        markup.push(stroke.toSVG(this));\n      }\n      if (shadow) {\n        markup.push(shadow.toSVG(this));\n      }\n      if (clipPath) {\n        markup.push(clipPathMarkup);\n      }\n      markup.push(objectMarkup.join(''));\n      markup.push('</g>\\n');\n      absoluteClipPath && markup.push('</g>\\n');\n      return reviver ? reviver(markup.join('')) : markup.join('');\n    },\n\n    addPaintOrder: function() {\n      return this.paintFirst !== 'fill' ? ' paint-order=\"' + this.paintFirst + '\" ' : '';\n    }\n  });\n})();\n/* _TO_SVG_END_ */\n\n\n(function() {\n\n  var extend = fabric.util.object.extend,\n      originalSet = 'stateProperties';\n\n  /*\n    Depends on `stateProperties`\n  */\n  function saveProps(origin, destination, props) {\n    var tmpObj = { }, deep = true;\n    props.forEach(function(prop) {\n      tmpObj[prop] = origin[prop];\n    });\n\n    extend(origin[destination], tmpObj, deep);\n  }\n\n  function _isEqual(origValue, currentValue, firstPass) {\n    if (origValue === currentValue) {\n      // if the objects are identical, return\n      return true;\n    }\n    else if (Array.isArray(origValue)) {\n      if (!Array.isArray(currentValue) || origValue.length !== currentValue.length) {\n        return false;\n      }\n      for (var i = 0, len = origValue.length; i < len; i++) {\n        if (!_isEqual(origValue[i], currentValue[i])) {\n          return false;\n        }\n      }\n      return true;\n    }\n    else if (origValue && typeof origValue === 'object') {\n      var keys = Object.keys(origValue), key;\n      if (!currentValue ||\n          typeof currentValue !== 'object' ||\n          (!firstPass && keys.length !== Object.keys(currentValue).length)\n      ) {\n        return false;\n      }\n      for (var i = 0, len = keys.length; i < len; i++) {\n        key = keys[i];\n        // since clipPath is in the statefull cache list and the clipPath objects\n        // would be iterated as an object, this would lead to possible infinite recursion\n        // we do not want to compare those.\n        if (key === 'canvas' || key === 'group') {\n          continue;\n        }\n        if (!_isEqual(origValue[key], currentValue[key])) {\n          return false;\n        }\n      }\n      return true;\n    }\n  }\n\n\n  fabric.util.object.extend(fabric.Object.prototype, /** @lends fabric.Object.prototype */ {\n\n    /**\n     * Returns true if object state (one of its state properties) was changed\n     * @param {String} [propertySet] optional name for the set of property we want to save\n     * @return {Boolean} true if instance' state has changed since `{@link fabric.Object#saveState}` was called\n     */\n    hasStateChanged: function(propertySet) {\n      propertySet = propertySet || originalSet;\n      var dashedPropertySet = '_' + propertySet;\n      if (Object.keys(this[dashedPropertySet]).length < this[propertySet].length) {\n        return true;\n      }\n      return !_isEqual(this[dashedPropertySet], this, true);\n    },\n\n    /**\n     * Saves state of an object\n     * @param {Object} [options] Object with additional `stateProperties` array to include when saving state\n     * @return {fabric.Object} thisArg\n     */\n    saveState: function(options) {\n      var propertySet = options && options.propertySet || originalSet,\n          destination = '_' + propertySet;\n      if (!this[destination]) {\n        return this.setupState(options);\n      }\n      saveProps(this, destination, this[propertySet]);\n      if (options && options.stateProperties) {\n        saveProps(this, destination, options.stateProperties);\n      }\n      return this;\n    },\n\n    /**\n     * Setups state of an object\n     * @param {Object} [options] Object with additional `stateProperties` array to include when saving state\n     * @return {fabric.Object} thisArg\n     */\n    setupState: function(options) {\n      options = options || { };\n      var propertySet = options.propertySet || originalSet;\n      options.propertySet = propertySet;\n      this['_' + propertySet] = { };\n      this.saveState(options);\n      return this;\n    }\n  });\n})();\n\n\n(function() {\n\n  var degreesToRadians = fabric.util.degreesToRadians;\n\n  fabric.util.object.extend(fabric.Object.prototype, /** @lends fabric.Object.prototype */ {\n    /**\n     * Determines which corner has been clicked\n     * @private\n     * @param {Object} pointer The pointer indicating the mouse position\n     * @return {String|Boolean} corner code (tl, tr, bl, br, etc.), or false if nothing is found\n     */\n    _findTargetCorner: function(pointer, forTouch) {\n      // objects in group, anykind, are not self modificable,\n      // must not return an hovered corner.\n      if (!this.hasControls || this.group || (!this.canvas || this.canvas._activeObject !== this)) {\n        return false;\n      }\n\n      var ex = pointer.x,\n          ey = pointer.y,\n          xPoints,\n          lines, keys = Object.keys(this.oCoords),\n          j = keys.length - 1, i;\n      this.__corner = 0;\n\n      // cycle in reverse order so we pick first the one on top\n      for (; j >= 0; j--) {\n        i = keys[j];\n        if (!this.isControlVisible(i)) {\n          continue;\n        }\n\n        lines = this._getImageLines(forTouch ? this.oCoords[i].touchCorner : this.oCoords[i].corner);\n        // // debugging\n        //\n        // this.canvas.contextTop.fillRect(lines.bottomline.d.x, lines.bottomline.d.y, 2, 2);\n        // this.canvas.contextTop.fillRect(lines.bottomline.o.x, lines.bottomline.o.y, 2, 2);\n        //\n        // this.canvas.contextTop.fillRect(lines.leftline.d.x, lines.leftline.d.y, 2, 2);\n        // this.canvas.contextTop.fillRect(lines.leftline.o.x, lines.leftline.o.y, 2, 2);\n        //\n        // this.canvas.contextTop.fillRect(lines.topline.d.x, lines.topline.d.y, 2, 2);\n        // this.canvas.contextTop.fillRect(lines.topline.o.x, lines.topline.o.y, 2, 2);\n        //\n        // this.canvas.contextTop.fillRect(lines.rightline.d.x, lines.rightline.d.y, 2, 2);\n        // this.canvas.contextTop.fillRect(lines.rightline.o.x, lines.rightline.o.y, 2, 2);\n\n        xPoints = this._findCrossPoints({ x: ex, y: ey }, lines);\n        if (xPoints !== 0 && xPoints % 2 === 1) {\n          this.__corner = i;\n          return i;\n        }\n      }\n      return false;\n    },\n\n    /**\n     * Calls a function for each control. The function gets called,\n     * with the control, the object that is calling the iterator and the control's key\n     * @param {Function} fn function to iterate over the controls over\n     */\n    forEachControl: function(fn) {\n      for (var i in this.controls) {\n        fn(this.controls[i], i, this);\n      };\n    },\n\n    /**\n     * Sets the coordinates of the draggable boxes in the corners of\n     * the image used to scale/rotate it.\n     * note: if we would switch to ROUND corner area, all of this would disappear.\n     * everything would resolve to a single point and a pythagorean theorem for the distance\n     * @private\n     */\n    _setCornerCoords: function() {\n      var coords = this.oCoords;\n\n      for (var control in coords) {\n        var controlObject = this.controls[control];\n        coords[control].corner = controlObject.calcCornerCoords(\n          this.angle, this.cornerSize, coords[control].x, coords[control].y, false);\n        coords[control].touchCorner = controlObject.calcCornerCoords(\n          this.angle, this.touchCornerSize, coords[control].x, coords[control].y, true);\n      }\n    },\n\n    /**\n     * Draws a colored layer behind the object, inside its selection borders.\n     * Requires public options: padding, selectionBackgroundColor\n     * this function is called when the context is transformed\n     * has checks to be skipped when the object is on a staticCanvas\n     * @param {CanvasRenderingContext2D} ctx Context to draw on\n     * @return {fabric.Object} thisArg\n     * @chainable\n     */\n    drawSelectionBackground: function(ctx) {\n      if (!this.selectionBackgroundColor ||\n        (this.canvas && !this.canvas.interactive) ||\n        (this.canvas && this.canvas._activeObject !== this)\n      ) {\n        return this;\n      }\n      ctx.save();\n      var center = this.getCenterPoint(), wh = this._calculateCurrentDimensions(),\n          vpt = this.canvas.viewportTransform;\n      ctx.translate(center.x, center.y);\n      ctx.scale(1 / vpt[0], 1 / vpt[3]);\n      ctx.rotate(degreesToRadians(this.angle));\n      ctx.fillStyle = this.selectionBackgroundColor;\n      ctx.fillRect(-wh.x / 2, -wh.y / 2, wh.x, wh.y);\n      ctx.restore();\n      return this;\n    },\n\n    /**\n     * Draws borders of an object's bounding box.\n     * Requires public properties: width, height\n     * Requires public options: padding, borderColor\n     * @param {CanvasRenderingContext2D} ctx Context to draw on\n     * @param {Object} styleOverride object to override the object style\n     * @return {fabric.Object} thisArg\n     * @chainable\n     */\n    drawBorders: function(ctx, styleOverride) {\n      styleOverride = styleOverride || {};\n      var wh = this._calculateCurrentDimensions(),\n          strokeWidth = this.borderScaleFactor,\n          width = wh.x + strokeWidth,\n          height = wh.y + strokeWidth,\n          hasControls = typeof styleOverride.hasControls !== 'undefined' ?\n            styleOverride.hasControls : this.hasControls,\n          shouldStroke = false;\n\n      ctx.save();\n      ctx.strokeStyle = styleOverride.borderColor || this.borderColor;\n      this._setLineDash(ctx, styleOverride.borderDashArray || this.borderDashArray);\n\n      ctx.strokeRect(\n        -width / 2,\n        -height / 2,\n        width,\n        height\n      );\n\n      if (hasControls) {\n        ctx.beginPath();\n        this.forEachControl(function(control, key, fabricObject) {\n          // in this moment, the ctx is centered on the object.\n          // width and height of the above function are the size of the bbox.\n          if (control.withConnection && control.getVisibility(fabricObject, key)) {\n            // reset movement for each control\n            shouldStroke = true;\n            ctx.moveTo(control.x * width, control.y * height);\n            ctx.lineTo(\n              control.x * width + control.offsetX,\n              control.y * height + control.offsetY\n            );\n          }\n        });\n        if (shouldStroke) {\n          ctx.stroke();\n        }\n      }\n      ctx.restore();\n      return this;\n    },\n\n    /**\n     * Draws borders of an object's bounding box when it is inside a group.\n     * Requires public properties: width, height\n     * Requires public options: padding, borderColor\n     * @param {CanvasRenderingContext2D} ctx Context to draw on\n     * @param {object} options object representing current object parameters\n     * @param {Object} styleOverride object to override the object style\n     * @return {fabric.Object} thisArg\n     * @chainable\n     */\n    drawBordersInGroup: function(ctx, options, styleOverride) {\n      styleOverride = styleOverride || {};\n      var bbox = fabric.util.sizeAfterTransform(this.width, this.height, options),\n          strokeWidth = this.strokeWidth,\n          strokeUniform = this.strokeUniform,\n          borderScaleFactor = this.borderScaleFactor,\n          width =\n            bbox.x + strokeWidth * (strokeUniform ? this.canvas.getZoom() : options.scaleX) + borderScaleFactor,\n          height =\n            bbox.y + strokeWidth * (strokeUniform ? this.canvas.getZoom() : options.scaleY) + borderScaleFactor;\n      ctx.save();\n      this._setLineDash(ctx, styleOverride.borderDashArray || this.borderDashArray);\n      ctx.strokeStyle = styleOverride.borderColor || this.borderColor;\n      ctx.strokeRect(\n        -width / 2,\n        -height / 2,\n        width,\n        height\n      );\n\n      ctx.restore();\n      return this;\n    },\n\n    /**\n     * Draws corners of an object's bounding box.\n     * Requires public properties: width, height\n     * Requires public options: cornerSize, padding\n     * @param {CanvasRenderingContext2D} ctx Context to draw on\n     * @param {Object} styleOverride object to override the object style\n     * @return {fabric.Object} thisArg\n     * @chainable\n     */\n    drawControls: function(ctx, styleOverride) {\n      styleOverride = styleOverride || {};\n      ctx.save();\n      var retinaScaling = this.canvas.getRetinaScaling(), matrix, p;\n      ctx.setTransform(retinaScaling, 0, 0, retinaScaling, 0, 0);\n      ctx.strokeStyle = ctx.fillStyle = styleOverride.cornerColor || this.cornerColor;\n      if (!this.transparentCorners) {\n        ctx.strokeStyle = styleOverride.cornerStrokeColor || this.cornerStrokeColor;\n      }\n      this._setLineDash(ctx, styleOverride.cornerDashArray || this.cornerDashArray);\n      this.setCoords();\n      if (this.group) {\n        // fabricJS does not really support drawing controls inside groups,\n        // this piece of code here helps having at least the control in places.\n        // If an application needs to show some objects as selected because of some UI state\n        // can still call Object._renderControls() on any object they desire, independently of groups.\n        // using no padding, circular controls and hiding the rotating cursor is higly suggested,\n        matrix = this.group.calcTransformMatrix();\n      }\n      this.forEachControl(function(control, key, fabricObject) {\n        p = fabricObject.oCoords[key];\n        if (control.getVisibility(fabricObject, key)) {\n          if (matrix) {\n            p = fabric.util.transformPoint(p, matrix);\n          }\n          control.render(ctx, p.x, p.y, styleOverride, fabricObject);\n        }\n      });\n      ctx.restore();\n\n      return this;\n    },\n\n    /**\n     * Returns true if the specified control is visible, false otherwise.\n     * @param {String} controlKey The key of the control. Possible values are 'tl', 'tr', 'br', 'bl', 'ml', 'mt', 'mr', 'mb', 'mtr'.\n     * @returns {Boolean} true if the specified control is visible, false otherwise\n     */\n    isControlVisible: function(controlKey) {\n      return this.controls[controlKey] && this.controls[controlKey].getVisibility(this, controlKey);\n    },\n\n    /**\n     * Sets the visibility of the specified control.\n     * @param {String} controlKey The key of the control. Possible values are 'tl', 'tr', 'br', 'bl', 'ml', 'mt', 'mr', 'mb', 'mtr'.\n     * @param {Boolean} visible true to set the specified control visible, false otherwise\n     * @return {fabric.Object} thisArg\n     * @chainable\n     */\n    setControlVisible: function(controlKey, visible) {\n      if (!this._controlsVisibility) {\n        this._controlsVisibility = {};\n      }\n      this._controlsVisibility[controlKey] = visible;\n      return this;\n    },\n\n    /**\n     * Sets the visibility state of object controls.\n     * @param {Object} [options] Options object\n     * @param {Boolean} [options.bl] true to enable the bottom-left control, false to disable it\n     * @param {Boolean} [options.br] true to enable the bottom-right control, false to disable it\n     * @param {Boolean} [options.mb] true to enable the middle-bottom control, false to disable it\n     * @param {Boolean} [options.ml] true to enable the middle-left control, false to disable it\n     * @param {Boolean} [options.mr] true to enable the middle-right control, false to disable it\n     * @param {Boolean} [options.mt] true to enable the middle-top control, false to disable it\n     * @param {Boolean} [options.tl] true to enable the top-left control, false to disable it\n     * @param {Boolean} [options.tr] true to enable the top-right control, false to disable it\n     * @param {Boolean} [options.mtr] true to enable the middle-top-rotate control, false to disable it\n     * @return {fabric.Object} thisArg\n     * @chainable\n     */\n    setControlsVisibility: function(options) {\n      options || (options = { });\n\n      for (var p in options) {\n        this.setControlVisible(p, options[p]);\n      }\n      return this;\n    },\n\n\n    /**\n     * This callback function is called every time _discardActiveObject or _setActiveObject\n     * try to to deselect this object. If the function returns true, the process is cancelled\n     * @param {Object} [options] options sent from the upper functions\n     * @param {Event} [options.e] event if the process is generated by an event\n     */\n    onDeselect: function() {\n      // implemented by sub-classes, as needed.\n    },\n\n\n    /**\n     * This callback function is called every time _discardActiveObject or _setActiveObject\n     * try to to select this object. If the function returns true, the process is cancelled\n     * @param {Object} [options] options sent from the upper functions\n     * @param {Event} [options.e] event if the process is generated by an event\n     */\n    onSelect: function() {\n      // implemented by sub-classes, as needed.\n    }\n  });\n})();\n\n\nfabric.util.object.extend(fabric.StaticCanvas.prototype, /** @lends fabric.StaticCanvas.prototype */ {\n\n  /**\n   * Animation duration (in ms) for fx* methods\n   * @type Number\n   * @default\n   */\n  FX_DURATION: 500,\n\n  /**\n   * Centers object horizontally with animation.\n   * @param {fabric.Object} object Object to center\n   * @param {Object} [callbacks] Callbacks object with optional \"onComplete\" and/or \"onChange\" properties\n   * @param {Function} [callbacks.onComplete] Invoked on completion\n   * @param {Function} [callbacks.onChange] Invoked on every step of animation\n   * @return {fabric.AnimationContext} context\n   */\n  fxCenterObjectH: function (object, callbacks) {\n    callbacks = callbacks || { };\n\n    var empty = function() { },\n        onComplete = callbacks.onComplete || empty,\n        onChange = callbacks.onChange || empty,\n        _this = this;\n\n    return fabric.util.animate({\n      target: this,\n      startValue: object.left,\n      endValue: this.getCenterPoint().x,\n      duration: this.FX_DURATION,\n      onChange: function(value) {\n        object.set('left', value);\n        _this.requestRenderAll();\n        onChange();\n      },\n      onComplete: function() {\n        object.setCoords();\n        onComplete();\n      }\n    });\n  },\n\n  /**\n   * Centers object vertically with animation.\n   * @param {fabric.Object} object Object to center\n   * @param {Object} [callbacks] Callbacks object with optional \"onComplete\" and/or \"onChange\" properties\n   * @param {Function} [callbacks.onComplete] Invoked on completion\n   * @param {Function} [callbacks.onChange] Invoked on every step of animation\n   * @return {fabric.AnimationContext} context\n   */\n  fxCenterObjectV: function (object, callbacks) {\n    callbacks = callbacks || { };\n\n    var empty = function() { },\n        onComplete = callbacks.onComplete || empty,\n        onChange = callbacks.onChange || empty,\n        _this = this;\n\n    return fabric.util.animate({\n      target: this,\n      startValue: object.top,\n      endValue: this.getCenterPoint().y,\n      duration: this.FX_DURATION,\n      onChange: function(value) {\n        object.set('top', value);\n        _this.requestRenderAll();\n        onChange();\n      },\n      onComplete: function() {\n        object.setCoords();\n        onComplete();\n      }\n    });\n  },\n\n  /**\n   * Same as `fabric.Canvas#remove` but animated\n   * @param {fabric.Object} object Object to remove\n   * @param {Object} [callbacks] Callbacks object with optional \"onComplete\" and/or \"onChange\" properties\n   * @param {Function} [callbacks.onComplete] Invoked on completion\n   * @param {Function} [callbacks.onChange] Invoked on every step of animation\n   * @return {fabric.AnimationContext} context\n   */\n  fxRemove: function (object, callbacks) {\n    callbacks = callbacks || { };\n\n    var empty = function() { },\n        onComplete = callbacks.onComplete || empty,\n        onChange = callbacks.onChange || empty,\n        _this = this;\n\n    return fabric.util.animate({\n      target: this,\n      startValue: object.opacity,\n      endValue: 0,\n      duration: this.FX_DURATION,\n      onChange: function(value) {\n        object.set('opacity', value);\n        _this.requestRenderAll();\n        onChange();\n      },\n      onComplete: function () {\n        _this.remove(object);\n        onComplete();\n      }\n    });\n  }\n});\n\nfabric.util.object.extend(fabric.Object.prototype, /** @lends fabric.Object.prototype */ {\n  /**\n   * Animates object's properties\n   * @param {String|Object} property Property to animate (if string) or properties to animate (if object)\n   * @param {Number|Object} value Value to animate property to (if string was given first) or options object\n   * @return {fabric.Object} thisArg\n   * @tutorial {@link http://fabricjs.com/fabric-intro-part-2#animation}\n   * @return {fabric.AnimationContext | fabric.AnimationContext[]} animation context (or an array if passed multiple properties)\n   *\n   * As object — multiple properties\n   *\n   * object.animate({ left: ..., top: ... });\n   * object.animate({ left: ..., top: ... }, { duration: ... });\n   *\n   * As string — one property\n   *\n   * object.animate('left', ...);\n   * object.animate('left', { duration: ... });\n   *\n   */\n  animate: function () {\n    if (arguments[0] && typeof arguments[0] === 'object') {\n      var propsToAnimate = [], prop, skipCallbacks, out = [];\n      for (prop in arguments[0]) {\n        propsToAnimate.push(prop);\n      }\n      for (var i = 0, len = propsToAnimate.length; i < len; i++) {\n        prop = propsToAnimate[i];\n        skipCallbacks = i !== len - 1;\n        out.push(this._animate(prop, arguments[0][prop], arguments[1], skipCallbacks));\n      }\n      return out;\n    }\n    else {\n      return this._animate.apply(this, arguments);\n    }\n  },\n\n  /**\n   * @private\n   * @param {String} property Property to animate\n   * @param {String} to Value to animate to\n   * @param {Object} [options] Options object\n   * @param {Boolean} [skipCallbacks] When true, callbacks like onchange and oncomplete are not invoked\n   */\n  _animate: function(property, to, options, skipCallbacks) {\n    var _this = this, propPair;\n\n    to = to.toString();\n\n    if (!options) {\n      options = { };\n    }\n    else {\n      options = fabric.util.object.clone(options);\n    }\n\n    if (~property.indexOf('.')) {\n      propPair = property.split('.');\n    }\n\n    var propIsColor =\n      _this.colorProperties.indexOf(property) > -1 ||\n      (propPair && _this.colorProperties.indexOf(propPair[1]) > -1);\n\n    var currentValue = propPair\n      ? this.get(propPair[0])[propPair[1]]\n      : this.get(property);\n\n    if (!('from' in options)) {\n      options.from = currentValue;\n    }\n\n    if (!propIsColor) {\n      if (~to.indexOf('=')) {\n        to = currentValue + parseFloat(to.replace('=', ''));\n      }\n      else {\n        to = parseFloat(to);\n      }\n    }\n\n    var _options = {\n      target: this,\n      startValue: options.from,\n      endValue: to,\n      byValue: options.by,\n      easing: options.easing,\n      duration: options.duration,\n      abort: options.abort && function(value, valueProgress, timeProgress) {\n        return options.abort.call(_this, value, valueProgress, timeProgress);\n      },\n      onChange: function (value, valueProgress, timeProgress) {\n        if (propPair) {\n          _this[propPair[0]][propPair[1]] = value;\n        }\n        else {\n          _this.set(property, value);\n        }\n        if (skipCallbacks) {\n          return;\n        }\n        options.onChange && options.onChange(value, valueProgress, timeProgress);\n      },\n      onComplete: function (value, valueProgress, timeProgress) {\n        if (skipCallbacks) {\n          return;\n        }\n\n        _this.setCoords();\n        options.onComplete && options.onComplete(value, valueProgress, timeProgress);\n      }\n    };\n\n    if (propIsColor) {\n      return fabric.util.animateColor(_options.startValue, _options.endValue, _options.duration, _options);\n    }\n    else {\n      return fabric.util.animate(_options);\n    }\n  }\n});\n\n\n(function(global) {\n\n  'use strict';\n\n  var fabric = global.fabric || (global.fabric = { }),\n      extend = fabric.util.object.extend,\n      clone = fabric.util.object.clone,\n      coordProps = { x1: 1, x2: 1, y1: 1, y2: 1 };\n\n  if (fabric.Line) {\n    fabric.warn('fabric.Line is already defined');\n    return;\n  }\n\n  /**\n   * Line class\n   * @class fabric.Line\n   * @extends fabric.Object\n   * @see {@link fabric.Line#initialize} for constructor definition\n   */\n  fabric.Line = fabric.util.createClass(fabric.Object, /** @lends fabric.Line.prototype */ {\n\n    /**\n     * Type of an object\n     * @type String\n     * @default\n     */\n    type: 'line',\n\n    /**\n     * x value or first line edge\n     * @type Number\n     * @default\n     */\n    x1: 0,\n\n    /**\n     * y value or first line edge\n     * @type Number\n     * @default\n     */\n    y1: 0,\n\n    /**\n     * x value or second line edge\n     * @type Number\n     * @default\n     */\n    x2: 0,\n\n    /**\n     * y value or second line edge\n     * @type Number\n     * @default\n     */\n    y2: 0,\n\n    cacheProperties: fabric.Object.prototype.cacheProperties.concat('x1', 'x2', 'y1', 'y2'),\n\n    /**\n     * Constructor\n     * @param {Array} [points] Array of points\n     * @param {Object} [options] Options object\n     * @return {fabric.Line} thisArg\n     */\n    initialize: function(points, options) {\n      if (!points) {\n        points = [0, 0, 0, 0];\n      }\n\n      this.callSuper('initialize', options);\n\n      this.set('x1', points[0]);\n      this.set('y1', points[1]);\n      this.set('x2', points[2]);\n      this.set('y2', points[3]);\n\n      this._setWidthHeight(options);\n    },\n\n    /**\n     * @private\n     * @param {Object} [options] Options\n     */\n    _setWidthHeight: function(options) {\n      options || (options = { });\n\n      this.width = Math.abs(this.x2 - this.x1);\n      this.height = Math.abs(this.y2 - this.y1);\n\n      this.left = 'left' in options\n        ? options.left\n        : this._getLeftToOriginX();\n\n      this.top = 'top' in options\n        ? options.top\n        : this._getTopToOriginY();\n    },\n\n    /**\n     * @private\n     * @param {String} key\n     * @param {*} value\n     */\n    _set: function(key, value) {\n      this.callSuper('_set', key, value);\n      if (typeof coordProps[key] !== 'undefined') {\n        this._setWidthHeight();\n      }\n      return this;\n    },\n\n    /**\n     * @private\n     * @return {Number} leftToOriginX Distance from left edge of canvas to originX of Line.\n     */\n    _getLeftToOriginX: makeEdgeToOriginGetter(\n      { // property names\n        origin: 'originX',\n        axis1: 'x1',\n        axis2: 'x2',\n        dimension: 'width'\n      },\n      { // possible values of origin\n        nearest: 'left',\n        center: 'center',\n        farthest: 'right'\n      }\n    ),\n\n    /**\n     * @private\n     * @return {Number} topToOriginY Distance from top edge of canvas to originY of Line.\n     */\n    _getTopToOriginY: makeEdgeToOriginGetter(\n      { // property names\n        origin: 'originY',\n        axis1: 'y1',\n        axis2: 'y2',\n        dimension: 'height'\n      },\n      { // possible values of origin\n        nearest: 'top',\n        center: 'center',\n        farthest: 'bottom'\n      }\n    ),\n\n    /**\n     * @private\n     * @param {CanvasRenderingContext2D} ctx Context to render on\n     */\n    _render: function(ctx) {\n      ctx.beginPath();\n\n\n      var p = this.calcLinePoints();\n      ctx.moveTo(p.x1, p.y1);\n      ctx.lineTo(p.x2, p.y2);\n\n      ctx.lineWidth = this.strokeWidth;\n\n      // TODO: test this\n      // make sure setting \"fill\" changes color of a line\n      // (by copying fillStyle to strokeStyle, since line is stroked, not filled)\n      var origStrokeStyle = ctx.strokeStyle;\n      ctx.strokeStyle = this.stroke || ctx.fillStyle;\n      this.stroke && this._renderStroke(ctx);\n      ctx.strokeStyle = origStrokeStyle;\n    },\n\n    /**\n     * This function is an helper for svg import. it returns the center of the object in the svg\n     * untransformed coordinates\n     * @private\n     * @return {Object} center point from element coordinates\n     */\n    _findCenterFromElement: function() {\n      return {\n        x: (this.x1 + this.x2) / 2,\n        y: (this.y1 + this.y2) / 2,\n      };\n    },\n\n    /**\n     * Returns object representation of an instance\n     * @method toObject\n     * @param {Array} [propertiesToInclude] Any properties that you might want to additionally include in the output\n     * @return {Object} object representation of an instance\n     */\n    toObject: function(propertiesToInclude) {\n      return extend(this.callSuper('toObject', propertiesToInclude), this.calcLinePoints());\n    },\n\n    /*\n     * Calculate object dimensions from its properties\n     * @private\n     */\n    _getNonTransformedDimensions: function() {\n      var dim = this.callSuper('_getNonTransformedDimensions');\n      if (this.strokeLineCap === 'butt') {\n        if (this.width === 0) {\n          dim.y -= this.strokeWidth;\n        }\n        if (this.height === 0) {\n          dim.x -= this.strokeWidth;\n        }\n      }\n      return dim;\n    },\n\n    /**\n     * Recalculates line points given width and height\n     * @private\n     */\n    calcLinePoints: function() {\n      var xMult = this.x1 <= this.x2 ? -1 : 1,\n          yMult = this.y1 <= this.y2 ? -1 : 1,\n          x1 = (xMult * this.width * 0.5),\n          y1 = (yMult * this.height * 0.5),\n          x2 = (xMult * this.width * -0.5),\n          y2 = (yMult * this.height * -0.5);\n\n      return {\n        x1: x1,\n        x2: x2,\n        y1: y1,\n        y2: y2\n      };\n    },\n\n    /* _TO_SVG_START_ */\n    /**\n     * Returns svg representation of an instance\n     * @return {Array} an array of strings with the specific svg representation\n     * of the instance\n     */\n    _toSVG: function() {\n      var p = this.calcLinePoints();\n      return [\n        '<line ', 'COMMON_PARTS',\n        'x1=\"', p.x1,\n        '\" y1=\"', p.y1,\n        '\" x2=\"', p.x2,\n        '\" y2=\"', p.y2,\n        '\" />\\n'\n      ];\n    },\n    /* _TO_SVG_END_ */\n  });\n\n  /* _FROM_SVG_START_ */\n  /**\n   * List of attribute names to account for when parsing SVG element (used by {@link fabric.Line.fromElement})\n   * @static\n   * @memberOf fabric.Line\n   * @see http://www.w3.org/TR/SVG/shapes.html#LineElement\n   */\n  fabric.Line.ATTRIBUTE_NAMES = fabric.SHARED_ATTRIBUTES.concat('x1 y1 x2 y2'.split(' '));\n\n  /**\n   * Returns fabric.Line instance from an SVG element\n   * @static\n   * @memberOf fabric.Line\n   * @param {SVGElement} element Element to parse\n   * @param {Object} [options] Options object\n   * @param {Function} [callback] callback function invoked after parsing\n   */\n  fabric.Line.fromElement = function(element, callback, options) {\n    options = options || { };\n    var parsedAttributes = fabric.parseAttributes(element, fabric.Line.ATTRIBUTE_NAMES),\n        points = [\n          parsedAttributes.x1 || 0,\n          parsedAttributes.y1 || 0,\n          parsedAttributes.x2 || 0,\n          parsedAttributes.y2 || 0\n        ];\n    callback(new fabric.Line(points, extend(parsedAttributes, options)));\n  };\n  /* _FROM_SVG_END_ */\n\n  /**\n   * Returns fabric.Line instance from an object representation\n   * @static\n   * @memberOf fabric.Line\n   * @param {Object} object Object to create an instance from\n   * @param {function} [callback] invoked with new instance as first argument\n   */\n  fabric.Line.fromObject = function(object, callback) {\n    function _callback(instance) {\n      delete instance.points;\n      callback && callback(instance);\n    };\n    var options = clone(object, true);\n    options.points = [object.x1, object.y1, object.x2, object.y2];\n    fabric.Object._fromObject('Line', options, _callback, 'points');\n  };\n\n  /**\n   * Produces a function that calculates distance from canvas edge to Line origin.\n   */\n  function makeEdgeToOriginGetter(propertyNames, originValues) {\n    var origin = propertyNames.origin,\n        axis1 = propertyNames.axis1,\n        axis2 = propertyNames.axis2,\n        dimension = propertyNames.dimension,\n        nearest = originValues.nearest,\n        center = originValues.center,\n        farthest = originValues.farthest;\n\n    return function() {\n      switch (this.get(origin)) {\n        case nearest:\n          return Math.min(this.get(axis1), this.get(axis2));\n        case center:\n          return Math.min(this.get(axis1), this.get(axis2)) + (0.5 * this.get(dimension));\n        case farthest:\n          return Math.max(this.get(axis1), this.get(axis2));\n      }\n    };\n\n  }\n\n})(typeof exports !== 'undefined' ? exports : this);\n\n\n(function(global) {\n\n  'use strict';\n\n  var fabric = global.fabric || (global.fabric = { }),\n      degreesToRadians = fabric.util.degreesToRadians;\n\n  if (fabric.Circle) {\n    fabric.warn('fabric.Circle is already defined.');\n    return;\n  }\n\n  /**\n   * Circle class\n   * @class fabric.Circle\n   * @extends fabric.Object\n   * @see {@link fabric.Circle#initialize} for constructor definition\n   */\n  fabric.Circle = fabric.util.createClass(fabric.Object, /** @lends fabric.Circle.prototype */ {\n\n    /**\n     * Type of an object\n     * @type String\n     * @default\n     */\n    type: 'circle',\n\n    /**\n     * Radius of this circle\n     * @type Number\n     * @default\n     */\n    radius: 0,\n\n    /**\n     * degrees of start of the circle.\n     * probably will change to degrees in next major version\n     * @type Number 0 - 359\n     * @default 0\n     */\n    startAngle: 0,\n\n    /**\n     * End angle of the circle\n     * probably will change to degrees in next major version\n     * @type Number 1 - 360\n     * @default 360\n     */\n    endAngle: 360,\n\n    cacheProperties: fabric.Object.prototype.cacheProperties.concat('radius', 'startAngle', 'endAngle'),\n\n    /**\n     * @private\n     * @param {String} key\n     * @param {*} value\n     * @return {fabric.Circle} thisArg\n     */\n    _set: function(key, value) {\n      this.callSuper('_set', key, value);\n\n      if (key === 'radius') {\n        this.setRadius(value);\n      }\n\n      return this;\n    },\n\n    /**\n     * Returns object representation of an instance\n     * @param {Array} [propertiesToInclude] Any properties that you might want to additionally include in the output\n     * @return {Object} object representation of an instance\n     */\n    toObject: function(propertiesToInclude) {\n      return this.callSuper('toObject', ['radius', 'startAngle', 'endAngle'].concat(propertiesToInclude));\n    },\n\n    /* _TO_SVG_START_ */\n\n    /**\n     * Returns svg representation of an instance\n     * @return {Array} an array of strings with the specific svg representation\n     * of the instance\n     */\n    _toSVG: function() {\n      var svgString, x = 0, y = 0,\n          angle = (this.endAngle - this.startAngle) % 360;\n\n      if (angle === 0) {\n        svgString = [\n          '<circle ', 'COMMON_PARTS',\n          'cx=\"' + x + '\" cy=\"' + y + '\" ',\n          'r=\"', this.radius,\n          '\" />\\n'\n        ];\n      }\n      else {\n        var start = degreesToRadians(this.startAngle),\n            end = degreesToRadians(this.endAngle),\n            radius = this.radius,\n            startX = fabric.util.cos(start) * radius,\n            startY = fabric.util.sin(start) * radius,\n            endX = fabric.util.cos(end) * radius,\n            endY = fabric.util.sin(end) * radius,\n            largeFlag = angle > 180 ? '1' : '0';\n        svgString = [\n          '<path d=\"M ' + startX + ' ' + startY,\n          ' A ' + radius + ' ' + radius,\n          ' 0 ', +largeFlag + ' 1', ' ' + endX + ' ' + endY,\n          '\" ', 'COMMON_PARTS', ' />\\n'\n        ];\n      }\n      return svgString;\n    },\n    /* _TO_SVG_END_ */\n\n    /**\n     * @private\n     * @param {CanvasRenderingContext2D} ctx context to render on\n     */\n    _render: function(ctx) {\n      ctx.beginPath();\n      ctx.arc(\n        0,\n        0,\n        this.radius,\n        degreesToRadians(this.startAngle),\n        degreesToRadians(this.endAngle),\n        false\n      );\n      this._renderPaintInOrder(ctx);\n    },\n\n    /**\n     * Returns horizontal radius of an object (according to how an object is scaled)\n     * @return {Number}\n     */\n    getRadiusX: function() {\n      return this.get('radius') * this.get('scaleX');\n    },\n\n    /**\n     * Returns vertical radius of an object (according to how an object is scaled)\n     * @return {Number}\n     */\n    getRadiusY: function() {\n      return this.get('radius') * this.get('scaleY');\n    },\n\n    /**\n     * Sets radius of an object (and updates width accordingly)\n     * @return {fabric.Circle} thisArg\n     */\n    setRadius: function(value) {\n      this.radius = value;\n      return this.set('width', value * 2).set('height', value * 2);\n    },\n  });\n\n  /* _FROM_SVG_START_ */\n  /**\n   * List of attribute names to account for when parsing SVG element (used by {@link fabric.Circle.fromElement})\n   * @static\n   * @memberOf fabric.Circle\n   * @see: http://www.w3.org/TR/SVG/shapes.html#CircleElement\n   */\n  fabric.Circle.ATTRIBUTE_NAMES = fabric.SHARED_ATTRIBUTES.concat('cx cy r'.split(' '));\n\n  /**\n   * Returns {@link fabric.Circle} instance from an SVG element\n   * @static\n   * @memberOf fabric.Circle\n   * @param {SVGElement} element Element to parse\n   * @param {Function} [callback] Options callback invoked after parsing is finished\n   * @param {Object} [options] Options object\n   * @throws {Error} If value of `r` attribute is missing or invalid\n   */\n  fabric.Circle.fromElement = function(element, callback) {\n    var parsedAttributes = fabric.parseAttributes(element, fabric.Circle.ATTRIBUTE_NAMES);\n\n    if (!isValidRadius(parsedAttributes)) {\n      throw new Error('value of `r` attribute is required and can not be negative');\n    }\n\n    parsedAttributes.left = (parsedAttributes.left || 0) - parsedAttributes.radius;\n    parsedAttributes.top = (parsedAttributes.top || 0) - parsedAttributes.radius;\n    callback(new fabric.Circle(parsedAttributes));\n  };\n\n  /**\n   * @private\n   */\n  function isValidRadius(attributes) {\n    return (('radius' in attributes) && (attributes.radius >= 0));\n  }\n  /* _FROM_SVG_END_ */\n\n  /**\n   * Returns {@link fabric.Circle} instance from an object representation\n   * @static\n   * @memberOf fabric.Circle\n   * @param {Object} object Object to create an instance from\n   * @param {function} [callback] invoked with new instance as first argument\n   * @return {void}\n   */\n  fabric.Circle.fromObject = function(object, callback) {\n    fabric.Object._fromObject('Circle', object, callback);\n  };\n\n})(typeof exports !== 'undefined' ? exports : this);\n\n\n(function(global) {\n\n  'use strict';\n\n  var fabric = global.fabric || (global.fabric = { });\n\n  if (fabric.Triangle) {\n    fabric.warn('fabric.Triangle is already defined');\n    return;\n  }\n\n  /**\n   * Triangle class\n   * @class fabric.Triangle\n   * @extends fabric.Object\n   * @return {fabric.Triangle} thisArg\n   * @see {@link fabric.Triangle#initialize} for constructor definition\n   */\n  fabric.Triangle = fabric.util.createClass(fabric.Object, /** @lends fabric.Triangle.prototype */ {\n\n    /**\n     * Type of an object\n     * @type String\n     * @default\n     */\n    type: 'triangle',\n\n    /**\n     * Width is set to 100 to compensate the old initialize code that was setting it to 100\n     * @type Number\n     * @default\n     */\n    width: 100,\n\n    /**\n     * Height is set to 100 to compensate the old initialize code that was setting it to 100\n     * @type Number\n     * @default\n     */\n    height: 100,\n\n    /**\n     * @private\n     * @param {CanvasRenderingContext2D} ctx Context to render on\n     */\n    _render: function(ctx) {\n      var widthBy2 = this.width / 2,\n          heightBy2 = this.height / 2;\n\n      ctx.beginPath();\n      ctx.moveTo(-widthBy2, heightBy2);\n      ctx.lineTo(0, -heightBy2);\n      ctx.lineTo(widthBy2, heightBy2);\n      ctx.closePath();\n\n      this._renderPaintInOrder(ctx);\n    },\n\n    /* _TO_SVG_START_ */\n    /**\n     * Returns svg representation of an instance\n     * @return {Array} an array of strings with the specific svg representation\n     * of the instance\n     */\n    _toSVG: function() {\n      var widthBy2 = this.width / 2,\n          heightBy2 = this.height / 2,\n          points = [\n            -widthBy2 + ' ' + heightBy2,\n            '0 ' + -heightBy2,\n            widthBy2 + ' ' + heightBy2\n          ].join(',');\n      return [\n        '<polygon ', 'COMMON_PARTS',\n        'points=\"', points,\n        '\" />'\n      ];\n    },\n    /* _TO_SVG_END_ */\n  });\n\n  /**\n   * Returns {@link fabric.Triangle} instance from an object representation\n   * @static\n   * @memberOf fabric.Triangle\n   * @param {Object} object Object to create an instance from\n   * @param {function} [callback] invoked with new instance as first argument\n   */\n  fabric.Triangle.fromObject = function(object, callback) {\n    return fabric.Object._fromObject('Triangle', object, callback);\n  };\n\n})(typeof exports !== 'undefined' ? exports : this);\n\n\n(function(global) {\n\n  'use strict';\n\n  var fabric = global.fabric || (global.fabric = { }),\n      piBy2   = Math.PI * 2;\n\n  if (fabric.Ellipse) {\n    fabric.warn('fabric.Ellipse is already defined.');\n    return;\n  }\n\n  /**\n   * Ellipse class\n   * @class fabric.Ellipse\n   * @extends fabric.Object\n   * @return {fabric.Ellipse} thisArg\n   * @see {@link fabric.Ellipse#initialize} for constructor definition\n   */\n  fabric.Ellipse = fabric.util.createClass(fabric.Object, /** @lends fabric.Ellipse.prototype */ {\n\n    /**\n     * Type of an object\n     * @type String\n     * @default\n     */\n    type: 'ellipse',\n\n    /**\n     * Horizontal radius\n     * @type Number\n     * @default\n     */\n    rx:   0,\n\n    /**\n     * Vertical radius\n     * @type Number\n     * @default\n     */\n    ry:   0,\n\n    cacheProperties: fabric.Object.prototype.cacheProperties.concat('rx', 'ry'),\n\n    /**\n     * Constructor\n     * @param {Object} [options] Options object\n     * @return {fabric.Ellipse} thisArg\n     */\n    initialize: function(options) {\n      this.callSuper('initialize', options);\n      this.set('rx', options && options.rx || 0);\n      this.set('ry', options && options.ry || 0);\n    },\n\n    /**\n     * @private\n     * @param {String} key\n     * @param {*} value\n     * @return {fabric.Ellipse} thisArg\n     */\n    _set: function(key, value) {\n      this.callSuper('_set', key, value);\n      switch (key) {\n\n        case 'rx':\n          this.rx = value;\n          this.set('width', value * 2);\n          break;\n\n        case 'ry':\n          this.ry = value;\n          this.set('height', value * 2);\n          break;\n\n      }\n      return this;\n    },\n\n    /**\n     * Returns horizontal radius of an object (according to how an object is scaled)\n     * @return {Number}\n     */\n    getRx: function() {\n      return this.get('rx') * this.get('scaleX');\n    },\n\n    /**\n     * Returns Vertical radius of an object (according to how an object is scaled)\n     * @return {Number}\n     */\n    getRy: function() {\n      return this.get('ry') * this.get('scaleY');\n    },\n\n    /**\n     * Returns object representation of an instance\n     * @param {Array} [propertiesToInclude] Any properties that you might want to additionally include in the output\n     * @return {Object} object representation of an instance\n     */\n    toObject: function(propertiesToInclude) {\n      return this.callSuper('toObject', ['rx', 'ry'].concat(propertiesToInclude));\n    },\n\n    /* _TO_SVG_START_ */\n    /**\n     * Returns svg representation of an instance\n     * @return {Array} an array of strings with the specific svg representation\n     * of the instance\n     */\n    _toSVG: function() {\n      return [\n        '<ellipse ', 'COMMON_PARTS',\n        'cx=\"0\" cy=\"0\" ',\n        'rx=\"', this.rx,\n        '\" ry=\"', this.ry,\n        '\" />\\n'\n      ];\n    },\n    /* _TO_SVG_END_ */\n\n    /**\n     * @private\n     * @param {CanvasRenderingContext2D} ctx context to render on\n     */\n    _render: function(ctx) {\n      ctx.beginPath();\n      ctx.save();\n      ctx.transform(1, 0, 0, this.ry / this.rx, 0, 0);\n      ctx.arc(\n        0,\n        0,\n        this.rx,\n        0,\n        piBy2,\n        false);\n      ctx.restore();\n      this._renderPaintInOrder(ctx);\n    },\n  });\n\n  /* _FROM_SVG_START_ */\n  /**\n   * List of attribute names to account for when parsing SVG element (used by {@link fabric.Ellipse.fromElement})\n   * @static\n   * @memberOf fabric.Ellipse\n   * @see http://www.w3.org/TR/SVG/shapes.html#EllipseElement\n   */\n  fabric.Ellipse.ATTRIBUTE_NAMES = fabric.SHARED_ATTRIBUTES.concat('cx cy rx ry'.split(' '));\n\n  /**\n   * Returns {@link fabric.Ellipse} instance from an SVG element\n   * @static\n   * @memberOf fabric.Ellipse\n   * @param {SVGElement} element Element to parse\n   * @param {Function} [callback] Options callback invoked after parsing is finished\n   * @return {fabric.Ellipse}\n   */\n  fabric.Ellipse.fromElement = function(element, callback) {\n\n    var parsedAttributes = fabric.parseAttributes(element, fabric.Ellipse.ATTRIBUTE_NAMES);\n\n    parsedAttributes.left = (parsedAttributes.left || 0) - parsedAttributes.rx;\n    parsedAttributes.top = (parsedAttributes.top || 0) - parsedAttributes.ry;\n    callback(new fabric.Ellipse(parsedAttributes));\n  };\n  /* _FROM_SVG_END_ */\n\n  /**\n   * Returns {@link fabric.Ellipse} instance from an object representation\n   * @static\n   * @memberOf fabric.Ellipse\n   * @param {Object} object Object to create an instance from\n   * @param {function} [callback] invoked with new instance as first argument\n   * @return {void}\n   */\n  fabric.Ellipse.fromObject = function(object, callback) {\n    fabric.Object._fromObject('Ellipse', object, callback);\n  };\n\n})(typeof exports !== 'undefined' ? exports : this);\n\n\n(function(global) {\n\n  'use strict';\n\n  var fabric = global.fabric || (global.fabric = { }),\n      extend = fabric.util.object.extend;\n\n  if (fabric.Rect) {\n    fabric.warn('fabric.Rect is already defined');\n    return;\n  }\n\n  /**\n   * Rectangle class\n   * @class fabric.Rect\n   * @extends fabric.Object\n   * @return {fabric.Rect} thisArg\n   * @see {@link fabric.Rect#initialize} for constructor definition\n   */\n  fabric.Rect = fabric.util.createClass(fabric.Object, /** @lends fabric.Rect.prototype */ {\n\n    /**\n     * List of properties to consider when checking if state of an object is changed ({@link fabric.Object#hasStateChanged})\n     * as well as for history (undo/redo) purposes\n     * @type Array\n     */\n    stateProperties: fabric.Object.prototype.stateProperties.concat('rx', 'ry'),\n\n    /**\n     * Type of an object\n     * @type String\n     * @default\n     */\n    type: 'rect',\n\n    /**\n     * Horizontal border radius\n     * @type Number\n     * @default\n     */\n    rx:   0,\n\n    /**\n     * Vertical border radius\n     * @type Number\n     * @default\n     */\n    ry:   0,\n\n    cacheProperties: fabric.Object.prototype.cacheProperties.concat('rx', 'ry'),\n\n    /**\n     * Constructor\n     * @param {Object} [options] Options object\n     * @return {Object} thisArg\n     */\n    initialize: function(options) {\n      this.callSuper('initialize', options);\n      this._initRxRy();\n    },\n\n    /**\n     * Initializes rx/ry attributes\n     * @private\n     */\n    _initRxRy: function() {\n      if (this.rx && !this.ry) {\n        this.ry = this.rx;\n      }\n      else if (this.ry && !this.rx) {\n        this.rx = this.ry;\n      }\n    },\n\n    /**\n     * @private\n     * @param {CanvasRenderingContext2D} ctx Context to render on\n     */\n    _render: function(ctx) {\n\n      // 1x1 case (used in spray brush) optimization was removed because\n      // with caching and higher zoom level this makes more damage than help\n\n      var rx = this.rx ? Math.min(this.rx, this.width / 2) : 0,\n          ry = this.ry ? Math.min(this.ry, this.height / 2) : 0,\n          w = this.width,\n          h = this.height,\n          x = -this.width / 2,\n          y = -this.height / 2,\n          isRounded = rx !== 0 || ry !== 0,\n          /* \"magic number\" for bezier approximations of arcs (http://itc.ktu.lt/itc354/Riskus354.pdf) */\n          k = 1 - 0.5522847498;\n      ctx.beginPath();\n\n      ctx.moveTo(x + rx, y);\n\n      ctx.lineTo(x + w - rx, y);\n      isRounded && ctx.bezierCurveTo(x + w - k * rx, y, x + w, y + k * ry, x + w, y + ry);\n\n      ctx.lineTo(x + w, y + h - ry);\n      isRounded && ctx.bezierCurveTo(x + w, y + h - k * ry, x + w - k * rx, y + h, x + w - rx, y + h);\n\n      ctx.lineTo(x + rx, y + h);\n      isRounded && ctx.bezierCurveTo(x + k * rx, y + h, x, y + h - k * ry, x, y + h - ry);\n\n      ctx.lineTo(x, y + ry);\n      isRounded && ctx.bezierCurveTo(x, y + k * ry, x + k * rx, y, x + rx, y);\n\n      ctx.closePath();\n\n      this._renderPaintInOrder(ctx);\n    },\n\n    /**\n     * Returns object representation of an instance\n     * @param {Array} [propertiesToInclude] Any properties that you might want to additionally include in the output\n     * @return {Object} object representation of an instance\n     */\n    toObject: function(propertiesToInclude) {\n      return this.callSuper('toObject', ['rx', 'ry'].concat(propertiesToInclude));\n    },\n\n    /* _TO_SVG_START_ */\n    /**\n     * Returns svg representation of an instance\n     * @return {Array} an array of strings with the specific svg representation\n     * of the instance\n     */\n    _toSVG: function() {\n      var x = -this.width / 2, y = -this.height / 2;\n      return [\n        '<rect ', 'COMMON_PARTS',\n        'x=\"', x, '\" y=\"', y,\n        '\" rx=\"', this.rx, '\" ry=\"', this.ry,\n        '\" width=\"', this.width, '\" height=\"', this.height,\n        '\" />\\n'\n      ];\n    },\n    /* _TO_SVG_END_ */\n  });\n\n  /* _FROM_SVG_START_ */\n  /**\n   * List of attribute names to account for when parsing SVG element (used by `fabric.Rect.fromElement`)\n   * @static\n   * @memberOf fabric.Rect\n   * @see: http://www.w3.org/TR/SVG/shapes.html#RectElement\n   */\n  fabric.Rect.ATTRIBUTE_NAMES = fabric.SHARED_ATTRIBUTES.concat('x y rx ry width height'.split(' '));\n\n  /**\n   * Returns {@link fabric.Rect} instance from an SVG element\n   * @static\n   * @memberOf fabric.Rect\n   * @param {SVGElement} element Element to parse\n   * @param {Function} callback callback function invoked after parsing\n   * @param {Object} [options] Options object\n   */\n  fabric.Rect.fromElement = function(element, callback, options) {\n    if (!element) {\n      return callback(null);\n    }\n    options = options || { };\n\n    var parsedAttributes = fabric.parseAttributes(element, fabric.Rect.ATTRIBUTE_NAMES);\n    parsedAttributes.left = parsedAttributes.left || 0;\n    parsedAttributes.top  = parsedAttributes.top  || 0;\n    parsedAttributes.height  = parsedAttributes.height || 0;\n    parsedAttributes.width  = parsedAttributes.width || 0;\n    var rect = new fabric.Rect(extend((options ? fabric.util.object.clone(options) : { }), parsedAttributes));\n    rect.visible = rect.visible && rect.width > 0 && rect.height > 0;\n    callback(rect);\n  };\n  /* _FROM_SVG_END_ */\n\n  /**\n   * Returns {@link fabric.Rect} instance from an object representation\n   * @static\n   * @memberOf fabric.Rect\n   * @param {Object} object Object to create an instance from\n   * @param {Function} [callback] Callback to invoke when an fabric.Rect instance is created\n   */\n  fabric.Rect.fromObject = function(object, callback) {\n    return fabric.Object._fromObject('Rect', object, callback);\n  };\n\n})(typeof exports !== 'undefined' ? exports : this);\n\n\n(function(global) {\n\n  'use strict';\n\n  var fabric = global.fabric || (global.fabric = { }),\n      extend = fabric.util.object.extend,\n      min = fabric.util.array.min,\n      max = fabric.util.array.max,\n      toFixed = fabric.util.toFixed,\n      projectStrokeOnPoints = fabric.util.projectStrokeOnPoints;\n\n  if (fabric.Polyline) {\n    fabric.warn('fabric.Polyline is already defined');\n    return;\n  }\n\n  /**\n   * Polyline class\n   * @class fabric.Polyline\n   * @extends fabric.Object\n   * @see {@link fabric.Polyline#initialize} for constructor definition\n   */\n  fabric.Polyline = fabric.util.createClass(fabric.Object, /** @lends fabric.Polyline.prototype */ {\n\n    /**\n     * Type of an object\n     * @type String\n     * @default\n     */\n    type: 'polyline',\n\n    /**\n     * Points array\n     * @type Array\n     * @default\n     */\n    points: null,\n\n    /**\n     * WARNING: Feature in progress\n     * Calculate the exact bounding box taking in account strokeWidth on acute angles\n     * this will be turned to true by default on fabric 6.0\n     * maybe will be left in as an optimization since calculations may be slow\n     * @deprecated\n     * @type Boolean\n     * @default false\n     */\n    exactBoundingBox: false,\n\n    cacheProperties: fabric.Object.prototype.cacheProperties.concat('points'),\n\n    /**\n     * Constructor\n     * @param {Array} points Array of points (where each point is an object with x and y)\n     * @param {Object} [options] Options object\n     * @return {fabric.Polyline} thisArg\n     * @example\n     * var poly = new fabric.Polyline([\n     *     { x: 10, y: 10 },\n     *     { x: 50, y: 30 },\n     *     { x: 40, y: 70 },\n     *     { x: 60, y: 50 },\n     *     { x: 100, y: 150 },\n     *     { x: 40, y: 100 }\n     *   ], {\n     *   stroke: 'red',\n     *   left: 100,\n     *   top: 100\n     * });\n     */\n    initialize: function(points, options) {\n      options = options || {};\n      this.points = points || [];\n      this.callSuper('initialize', options);\n      this._setPositionDimensions(options);\n    },\n\n    /**\n     * @private\n     */\n    _projectStrokeOnPoints: function () {\n      return projectStrokeOnPoints(this.points, this, true);\n    },\n\n    _setPositionDimensions: function(options) {\n      var calcDim = this._calcDimensions(options), correctLeftTop,\n          correctSize = this.exactBoundingBox ? this.strokeWidth : 0;\n      this.width = calcDim.width - correctSize;\n      this.height = calcDim.height - correctSize;\n      if (!options.fromSVG) {\n        correctLeftTop = this.translateToGivenOrigin(\n          {\n            // this looks bad, but is one way to keep it optional for now.\n            x: calcDim.left - this.strokeWidth / 2 + correctSize / 2,\n            y: calcDim.top - this.strokeWidth / 2 + correctSize / 2\n          },\n          'left',\n          'top',\n          this.originX,\n          this.originY\n        );\n      }\n      if (typeof options.left === 'undefined') {\n        this.left = options.fromSVG ? calcDim.left : correctLeftTop.x;\n      }\n      if (typeof options.top === 'undefined') {\n        this.top = options.fromSVG ? calcDim.top : correctLeftTop.y;\n      }\n      this.pathOffset = {\n        x: calcDim.left + this.width / 2 + correctSize / 2,\n        y: calcDim.top + this.height / 2 + correctSize / 2\n      };\n    },\n\n    /**\n     * Calculate the polygon min and max point from points array,\n     * returning an object with left, top, width, height to measure the\n     * polygon size\n     * @return {Object} object.left X coordinate of the polygon leftmost point\n     * @return {Object} object.top Y coordinate of the polygon topmost point\n     * @return {Object} object.width distance between X coordinates of the polygon leftmost and rightmost point\n     * @return {Object} object.height distance between Y coordinates of the polygon topmost and bottommost point\n     * @private\n     */\n    _calcDimensions: function() {\n\n      var points = this.exactBoundingBox ? this._projectStrokeOnPoints() : this.points,\n          minX = min(points, 'x') || 0,\n          minY = min(points, 'y') || 0,\n          maxX = max(points, 'x') || 0,\n          maxY = max(points, 'y') || 0,\n          width = (maxX - minX),\n          height = (maxY - minY);\n\n      return {\n        left: minX,\n        top: minY,\n        width: width,\n        height: height,\n      };\n    },\n\n    /**\n     * Returns object representation of an instance\n     * @param {Array} [propertiesToInclude] Any properties that you might want to additionally include in the output\n     * @return {Object} Object representation of an instance\n     */\n    toObject: function(propertiesToInclude) {\n      return extend(this.callSuper('toObject', propertiesToInclude), {\n        points: this.points.concat()\n      });\n    },\n\n    /* _TO_SVG_START_ */\n    /**\n     * Returns svg representation of an instance\n     * @return {Array} an array of strings with the specific svg representation\n     * of the instance\n     */\n    _toSVG: function() {\n      var points = [], diffX = this.pathOffset.x, diffY = this.pathOffset.y,\n          NUM_FRACTION_DIGITS = fabric.Object.NUM_FRACTION_DIGITS;\n\n      for (var i = 0, len = this.points.length; i < len; i++) {\n        points.push(\n          toFixed(this.points[i].x - diffX, NUM_FRACTION_DIGITS), ',',\n          toFixed(this.points[i].y - diffY, NUM_FRACTION_DIGITS), ' '\n        );\n      }\n      return [\n        '<' + this.type + ' ', 'COMMON_PARTS',\n        'points=\"', points.join(''),\n        '\" />\\n'\n      ];\n    },\n    /* _TO_SVG_END_ */\n\n\n    /**\n     * @private\n     * @param {CanvasRenderingContext2D} ctx Context to render on\n     */\n    commonRender: function(ctx) {\n      var point, len = this.points.length,\n          x = this.pathOffset.x,\n          y = this.pathOffset.y;\n\n      if (!len || isNaN(this.points[len - 1].y)) {\n        // do not draw if no points or odd points\n        // NaN comes from parseFloat of a empty string in parser\n        return false;\n      }\n      ctx.beginPath();\n      ctx.moveTo(this.points[0].x - x, this.points[0].y - y);\n      for (var i = 0; i < len; i++) {\n        point = this.points[i];\n        ctx.lineTo(point.x - x, point.y - y);\n      }\n      return true;\n    },\n\n    /**\n     * @private\n     * @param {CanvasRenderingContext2D} ctx Context to render on\n     */\n    _render: function(ctx) {\n      if (!this.commonRender(ctx)) {\n        return;\n      }\n      this._renderPaintInOrder(ctx);\n    },\n\n    /**\n     * Returns complexity of an instance\n     * @return {Number} complexity of this instance\n     */\n    complexity: function() {\n      return this.get('points').length;\n    }\n  });\n\n  /* _FROM_SVG_START_ */\n  /**\n   * List of attribute names to account for when parsing SVG element (used by {@link fabric.Polyline.fromElement})\n   * @static\n   * @memberOf fabric.Polyline\n   * @see: http://www.w3.org/TR/SVG/shapes.html#PolylineElement\n   */\n  fabric.Polyline.ATTRIBUTE_NAMES = fabric.SHARED_ATTRIBUTES.concat();\n\n  /**\n   * Returns fabric.Polyline instance from an SVG element\n   * @static\n   * @memberOf fabric.Polyline\n   * @param {SVGElement} element Element to parser\n   * @param {Function} callback callback function invoked after parsing\n   * @param {Object} [options] Options object\n   */\n  fabric.Polyline.fromElementGenerator = function(_class) {\n    return function(element, callback, options) {\n      if (!element) {\n        return callback(null);\n      }\n      options || (options = { });\n\n      var points = fabric.parsePointsAttribute(element.getAttribute('points')),\n          parsedAttributes = fabric.parseAttributes(element, fabric[_class].ATTRIBUTE_NAMES);\n      parsedAttributes.fromSVG = true;\n      callback(new fabric[_class](points, extend(parsedAttributes, options)));\n    };\n  };\n\n  fabric.Polyline.fromElement = fabric.Polyline.fromElementGenerator('Polyline');\n\n  /* _FROM_SVG_END_ */\n\n  /**\n   * Returns fabric.Polyline instance from an object representation\n   * @static\n   * @memberOf fabric.Polyline\n   * @param {Object} object Object to create an instance from\n   * @param {Function} [callback] Callback to invoke when an fabric.Path instance is created\n   */\n  fabric.Polyline.fromObject = function(object, callback) {\n    return fabric.Object._fromObject('Polyline', object, callback, 'points');\n  };\n\n})(typeof exports !== 'undefined' ? exports : this);\n\n\n(function(global) {\n\n  'use strict';\n\n  var fabric = global.fabric || (global.fabric = {}),\n      projectStrokeOnPoints = fabric.util.projectStrokeOnPoints;\n\n  if (fabric.Polygon) {\n    fabric.warn('fabric.Polygon is already defined');\n    return;\n  }\n\n  /**\n   * Polygon class\n   * @class fabric.Polygon\n   * @extends fabric.Polyline\n   * @see {@link fabric.Polygon#initialize} for constructor definition\n   */\n  fabric.Polygon = fabric.util.createClass(fabric.Polyline, /** @lends fabric.Polygon.prototype */ {\n\n    /**\n     * Type of an object\n     * @type String\n     * @default\n     */\n    type: 'polygon',\n\n    /**\n     * @private\n     */\n    _projectStrokeOnPoints: function () {\n      return projectStrokeOnPoints(this.points, this);\n    },\n\n    /**\n     * @private\n     * @param {CanvasRenderingContext2D} ctx Context to render on\n     */\n    _render: function(ctx) {\n      if (!this.commonRender(ctx)) {\n        return;\n      }\n      ctx.closePath();\n      this._renderPaintInOrder(ctx);\n    },\n\n  });\n\n  /* _FROM_SVG_START_ */\n  /**\n   * List of attribute names to account for when parsing SVG element (used by `fabric.Polygon.fromElement`)\n   * @static\n   * @memberOf fabric.Polygon\n   * @see: http://www.w3.org/TR/SVG/shapes.html#PolygonElement\n   */\n  fabric.Polygon.ATTRIBUTE_NAMES = fabric.SHARED_ATTRIBUTES.concat();\n\n  /**\n   * Returns {@link fabric.Polygon} instance from an SVG element\n   * @static\n   * @memberOf fabric.Polygon\n   * @param {SVGElement} element Element to parse\n   * @param {Function} callback callback function invoked after parsing\n   * @param {Object} [options] Options object\n   */\n  fabric.Polygon.fromElement = fabric.Polyline.fromElementGenerator('Polygon');\n  /* _FROM_SVG_END_ */\n\n  /**\n   * Returns fabric.Polygon instance from an object representation\n   * @static\n   * @memberOf fabric.Polygon\n   * @param {Object} object Object to create an instance from\n   * @param {Function} [callback] Callback to invoke when an fabric.Path instance is created\n   * @return {void}\n   */\n  fabric.Polygon.fromObject = function(object, callback) {\n    fabric.Object._fromObject('Polygon', object, callback, 'points');\n  };\n\n})(typeof exports !== 'undefined' ? exports : this);\n\n\n(function(global) {\n\n  'use strict';\n\n  var fabric = global.fabric || (global.fabric = { }),\n      min = fabric.util.array.min,\n      max = fabric.util.array.max,\n      extend = fabric.util.object.extend,\n      clone = fabric.util.object.clone,\n      toFixed = fabric.util.toFixed;\n\n  if (fabric.Path) {\n    fabric.warn('fabric.Path is already defined');\n    return;\n  }\n\n  /**\n   * Path class\n   * @class fabric.Path\n   * @extends fabric.Object\n   * @tutorial {@link http://fabricjs.com/fabric-intro-part-1#path_and_pathgroup}\n   * @see {@link fabric.Path#initialize} for constructor definition\n   */\n  fabric.Path = fabric.util.createClass(fabric.Object, /** @lends fabric.Path.prototype */ {\n\n    /**\n     * Type of an object\n     * @type String\n     * @default\n     */\n    type: 'path',\n\n    /**\n     * Array of path points\n     * @type Array\n     * @default\n     */\n    path: null,\n\n    cacheProperties: fabric.Object.prototype.cacheProperties.concat('path', 'fillRule'),\n\n    stateProperties: fabric.Object.prototype.stateProperties.concat('path'),\n\n    /**\n     * Constructor\n     * @param {Array|String} path Path data (sequence of coordinates and corresponding \"command\" tokens)\n     * @param {Object} [options] Options object\n     * @return {fabric.Path} thisArg\n     */\n    initialize: function (path, options) {\n      options = clone(options || {});\n      delete options.path;\n      this.callSuper('initialize', options);\n      this._setPath(path || [], options);\n    },\n\n    /**\n    * @private\n    * @param {Array|String} path Path data (sequence of coordinates and corresponding \"command\" tokens)\n    * @param {Object} [options] Options object\n    */\n    _setPath: function (path, options) {\n      this.path = fabric.util.makePathSimpler(\n        Array.isArray(path) ? path : fabric.util.parsePath(path)\n      );\n\n      fabric.Polyline.prototype._setPositionDimensions.call(this, options || {});\n    },\n\n    /**\n     * @private\n     * @param {CanvasRenderingContext2D} ctx context to render path on\n     */\n    _renderPathCommands: function(ctx) {\n      var current, // current instruction\n          subpathStartX = 0,\n          subpathStartY = 0,\n          x = 0, // current x\n          y = 0, // current y\n          controlX = 0, // current control point x\n          controlY = 0, // current control point y\n          l = -this.pathOffset.x,\n          t = -this.pathOffset.y;\n\n      ctx.beginPath();\n\n      for (var i = 0, len = this.path.length; i < len; ++i) {\n\n        current = this.path[i];\n\n        switch (current[0]) { // first letter\n\n          case 'L': // lineto, absolute\n            x = current[1];\n            y = current[2];\n            ctx.lineTo(x + l, y + t);\n            break;\n\n          case 'M': // moveTo, absolute\n            x = current[1];\n            y = current[2];\n            subpathStartX = x;\n            subpathStartY = y;\n            ctx.moveTo(x + l, y + t);\n            break;\n\n          case 'C': // bezierCurveTo, absolute\n            x = current[5];\n            y = current[6];\n            controlX = current[3];\n            controlY = current[4];\n            ctx.bezierCurveTo(\n              current[1] + l,\n              current[2] + t,\n              controlX + l,\n              controlY + t,\n              x + l,\n              y + t\n            );\n            break;\n\n          case 'Q': // quadraticCurveTo, absolute\n            ctx.quadraticCurveTo(\n              current[1] + l,\n              current[2] + t,\n              current[3] + l,\n              current[4] + t\n            );\n            x = current[3];\n            y = current[4];\n            controlX = current[1];\n            controlY = current[2];\n            break;\n\n          case 'z':\n          case 'Z':\n            x = subpathStartX;\n            y = subpathStartY;\n            ctx.closePath();\n            break;\n        }\n      }\n    },\n\n    /**\n     * @private\n     * @param {CanvasRenderingContext2D} ctx context to render path on\n     */\n    _render: function(ctx) {\n      this._renderPathCommands(ctx);\n      this._renderPaintInOrder(ctx);\n    },\n\n    /**\n     * Returns string representation of an instance\n     * @return {String} string representation of an instance\n     */\n    toString: function() {\n      return '#<fabric.Path (' + this.complexity() +\n        '): { \"top\": ' + this.top + ', \"left\": ' + this.left + ' }>';\n    },\n\n    /**\n     * Returns object representation of an instance\n     * @param {Array} [propertiesToInclude] Any properties that you might want to additionally include in the output\n     * @return {Object} object representation of an instance\n     */\n    toObject: function(propertiesToInclude) {\n      return extend(this.callSuper('toObject', propertiesToInclude), {\n        path: this.path.map(function(item) { return item.slice(); }),\n      });\n    },\n\n    /**\n     * Returns dataless object representation of an instance\n     * @param {Array} [propertiesToInclude] Any properties that you might want to additionally include in the output\n     * @return {Object} object representation of an instance\n     */\n    toDatalessObject: function(propertiesToInclude) {\n      var o = this.toObject(['sourcePath'].concat(propertiesToInclude));\n      if (o.sourcePath) {\n        delete o.path;\n      }\n      return o;\n    },\n\n    /* _TO_SVG_START_ */\n    /**\n     * Returns svg representation of an instance\n     * @return {Array} an array of strings with the specific svg representation\n     * of the instance\n     */\n    _toSVG: function() {\n      var path = fabric.util.joinPath(this.path);\n      return [\n        '<path ', 'COMMON_PARTS',\n        'd=\"', path,\n        '\" stroke-linecap=\"round\" ',\n        '/>\\n'\n      ];\n    },\n\n    _getOffsetTransform: function() {\n      var digits = fabric.Object.NUM_FRACTION_DIGITS;\n      return ' translate(' + toFixed(-this.pathOffset.x, digits) + ', ' +\n          toFixed(-this.pathOffset.y, digits) + ')';\n    },\n\n    /**\n     * Returns svg clipPath representation of an instance\n     * @param {Function} [reviver] Method for further parsing of svg representation.\n     * @return {String} svg representation of an instance\n     */\n    toClipPathSVG: function(reviver) {\n      var additionalTransform = this._getOffsetTransform();\n      return '\\t' + this._createBaseClipPathSVGMarkup(\n        this._toSVG(), { reviver: reviver, additionalTransform: additionalTransform }\n      );\n    },\n\n    /**\n     * Returns svg representation of an instance\n     * @param {Function} [reviver] Method for further parsing of svg representation.\n     * @return {String} svg representation of an instance\n     */\n    toSVG: function(reviver) {\n      var additionalTransform = this._getOffsetTransform();\n      return this._createBaseSVGMarkup(this._toSVG(), { reviver: reviver, additionalTransform: additionalTransform  });\n    },\n    /* _TO_SVG_END_ */\n\n    /**\n     * Returns number representation of an instance complexity\n     * @return {Number} complexity of this instance\n     */\n    complexity: function() {\n      return this.path.length;\n    },\n\n    /**\n     * @private\n     */\n    _calcDimensions: function() {\n\n      var aX = [],\n          aY = [],\n          current, // current instruction\n          subpathStartX = 0,\n          subpathStartY = 0,\n          x = 0, // current x\n          y = 0, // current y\n          bounds;\n\n      for (var i = 0, len = this.path.length; i < len; ++i) {\n\n        current = this.path[i];\n\n        switch (current[0]) { // first letter\n\n          case 'L': // lineto, absolute\n            x = current[1];\n            y = current[2];\n            bounds = [];\n            break;\n\n          case 'M': // moveTo, absolute\n            x = current[1];\n            y = current[2];\n            subpathStartX = x;\n            subpathStartY = y;\n            bounds = [];\n            break;\n\n          case 'C': // bezierCurveTo, absolute\n            bounds = fabric.util.getBoundsOfCurve(x, y,\n              current[1],\n              current[2],\n              current[3],\n              current[4],\n              current[5],\n              current[6]\n            );\n            x = current[5];\n            y = current[6];\n            break;\n\n          case 'Q': // quadraticCurveTo, absolute\n            bounds = fabric.util.getBoundsOfCurve(x, y,\n              current[1],\n              current[2],\n              current[1],\n              current[2],\n              current[3],\n              current[4]\n            );\n            x = current[3];\n            y = current[4];\n            break;\n\n          case 'z':\n          case 'Z':\n            x = subpathStartX;\n            y = subpathStartY;\n            break;\n        }\n        bounds.forEach(function (point) {\n          aX.push(point.x);\n          aY.push(point.y);\n        });\n        aX.push(x);\n        aY.push(y);\n      }\n\n      var minX = min(aX) || 0,\n          minY = min(aY) || 0,\n          maxX = max(aX) || 0,\n          maxY = max(aY) || 0,\n          deltaX = maxX - minX,\n          deltaY = maxY - minY;\n\n      return {\n        left: minX,\n        top: minY,\n        width: deltaX,\n        height: deltaY\n      };\n    }\n  });\n\n  /**\n   * Creates an instance of fabric.Path from an object\n   * @static\n   * @memberOf fabric.Path\n   * @param {Object} object\n   * @param {Function} [callback] Callback to invoke when an fabric.Path instance is created\n   */\n  fabric.Path.fromObject = function(object, callback) {\n    if (typeof object.sourcePath === 'string') {\n      var pathUrl = object.sourcePath;\n      fabric.loadSVGFromURL(pathUrl, function (elements) {\n        var path = elements[0];\n        path.setOptions(object);\n        if (object.clipPath) {\n          fabric.util.enlivenObjects([object.clipPath], function(elivenedObjects) {\n            path.clipPath = elivenedObjects[0];\n            callback && callback(path);\n          });\n        }\n        else {\n          callback && callback(path);\n        }\n      });\n    }\n    else {\n      fabric.Object._fromObject('Path', object, callback, 'path');\n    }\n  };\n\n  /* _FROM_SVG_START_ */\n  /**\n   * List of attribute names to account for when parsing SVG element (used by `fabric.Path.fromElement`)\n   * @static\n   * @memberOf fabric.Path\n   * @see http://www.w3.org/TR/SVG/paths.html#PathElement\n   */\n  fabric.Path.ATTRIBUTE_NAMES = fabric.SHARED_ATTRIBUTES.concat(['d']);\n\n  /**\n   * Creates an instance of fabric.Path from an SVG <path> element\n   * @static\n   * @memberOf fabric.Path\n   * @param {SVGElement} element to parse\n   * @param {Function} callback Callback to invoke when an fabric.Path instance is created\n   * @param {Object} [options] Options object\n   * @param {Function} [callback] Options callback invoked after parsing is finished\n   */\n  fabric.Path.fromElement = function(element, callback, options) {\n    var parsedAttributes = fabric.parseAttributes(element, fabric.Path.ATTRIBUTE_NAMES);\n    parsedAttributes.fromSVG = true;\n    callback(new fabric.Path(parsedAttributes.d, extend(parsedAttributes, options)));\n  };\n  /* _FROM_SVG_END_ */\n\n})(typeof exports !== 'undefined' ? exports : this);\n\n\n(function(global) {\n\n  'use strict';\n\n  var fabric = global.fabric || (global.fabric = { }),\n      min = fabric.util.array.min,\n      max = fabric.util.array.max;\n\n  if (fabric.Group) {\n    return;\n  }\n\n  /**\n   * Group class\n   * @class fabric.Group\n   * @extends fabric.Object\n   * @mixes fabric.Collection\n   * @tutorial {@link http://fabricjs.com/fabric-intro-part-3#groups}\n   * @see {@link fabric.Group#initialize} for constructor definition\n   */\n  fabric.Group = fabric.util.createClass(fabric.Object, fabric.Collection, /** @lends fabric.Group.prototype */ {\n\n    /**\n     * Type of an object\n     * @type String\n     * @default\n     */\n    type: 'group',\n\n    /**\n     * Width of stroke\n     * @type Number\n     * @default\n     */\n    strokeWidth: 0,\n\n    /**\n     * Indicates if click, mouseover, mouseout events & hoverCursor should also check for subtargets\n     * @type Boolean\n     * @default\n     */\n    subTargetCheck: false,\n\n    /**\n     * Groups are container, do not render anything on theyr own, ence no cache properties\n     * @type Array\n     * @default\n     */\n    cacheProperties: [],\n\n    /**\n     * setOnGroup is a method used for TextBox that is no more used since 2.0.0 The behavior is still\n     * available setting this boolean to true.\n     * @type Boolean\n     * @since 2.0.0\n     * @default\n     */\n    useSetOnGroup: false,\n\n    /**\n     * Constructor\n     * @param {Object} objects Group objects\n     * @param {Object} [options] Options object\n     * @param {Boolean} [isAlreadyGrouped] if true, objects have been grouped already.\n     * @return {Object} thisArg\n     */\n    initialize: function(objects, options, isAlreadyGrouped) {\n      options = options || {};\n      this._objects = [];\n      // if objects enclosed in a group have been grouped already,\n      // we cannot change properties of objects.\n      // Thus we need to set options to group without objects,\n      isAlreadyGrouped && this.callSuper('initialize', options);\n      this._objects = objects || [];\n      for (var i = this._objects.length; i--; ) {\n        this._objects[i].group = this;\n      }\n\n      if (!isAlreadyGrouped) {\n        var center = options && options.centerPoint;\n        // we want to set origins before calculating the bounding box.\n        // so that the topleft can be set with that in mind.\n        // if specific top and left are passed, are overwritten later\n        // with the callSuper('initialize', options)\n        if (options.originX !== undefined) {\n          this.originX = options.originX;\n        }\n        if (options.originY !== undefined) {\n          this.originY = options.originY;\n        }\n        // if coming from svg i do not want to calc bounds.\n        // i assume width and height are passed along options\n        center || this._calcBounds();\n        this._updateObjectsCoords(center);\n        delete options.centerPoint;\n        this.callSuper('initialize', options);\n      }\n      else {\n        this._updateObjectsACoords();\n      }\n\n      this.setCoords();\n    },\n\n    /**\n     * @private\n     */\n    _updateObjectsACoords: function() {\n      var skipControls = true;\n      for (var i = this._objects.length; i--; ){\n        this._objects[i].setCoords(skipControls);\n      }\n    },\n\n    /**\n     * @private\n     * @param {Boolean} [skipCoordsChange] if true, coordinates of objects enclosed in a group do not change\n     */\n    _updateObjectsCoords: function(center) {\n      var center = center || this.getCenterPoint();\n      for (var i = this._objects.length; i--; ){\n        this._updateObjectCoords(this._objects[i], center);\n      }\n    },\n\n    /**\n     * @private\n     * @param {Object} object\n     * @param {fabric.Point} center, current center of group.\n     */\n    _updateObjectCoords: function(object, center) {\n      var objectLeft = object.left,\n          objectTop = object.top,\n          skipControls = true;\n\n      object.set({\n        left: objectLeft - center.x,\n        top: objectTop - center.y\n      });\n      object.group = this;\n      object.setCoords(skipControls);\n    },\n\n    /**\n     * Returns string represenation of a group\n     * @return {String}\n     */\n    toString: function() {\n      return '#<fabric.Group: (' + this.complexity() + ')>';\n    },\n\n    /**\n     * Adds an object to a group; Then recalculates group's dimension, position.\n     * @param {Object} object\n     * @return {fabric.Group} thisArg\n     * @chainable\n     */\n    addWithUpdate: function(object) {\n      var nested = !!this.group;\n      this._restoreObjectsState();\n      fabric.util.resetObjectTransform(this);\n      if (object) {\n        if (nested) {\n          // if this group is inside another group, we need to pre transform the object\n          fabric.util.removeTransformFromObject(object, this.group.calcTransformMatrix());\n        }\n        this._objects.push(object);\n        object.group = this;\n        object._set('canvas', this.canvas);\n      }\n      this._calcBounds();\n      this._updateObjectsCoords();\n      this.dirty = true;\n      if (nested) {\n        this.group.addWithUpdate();\n      }\n      else {\n        this.setCoords();\n      }\n      return this;\n    },\n\n    /**\n     * Removes an object from a group; Then recalculates group's dimension, position.\n     * @param {Object} object\n     * @return {fabric.Group} thisArg\n     * @chainable\n     */\n    removeWithUpdate: function(object) {\n      this._restoreObjectsState();\n      fabric.util.resetObjectTransform(this);\n\n      this.remove(object);\n      this._calcBounds();\n      this._updateObjectsCoords();\n      this.setCoords();\n      this.dirty = true;\n      return this;\n    },\n\n    /**\n     * @private\n     */\n    _onObjectAdded: function(object) {\n      this.dirty = true;\n      object.group = this;\n      object._set('canvas', this.canvas);\n    },\n\n    /**\n     * @private\n     */\n    _onObjectRemoved: function(object) {\n      this.dirty = true;\n      delete object.group;\n    },\n\n    /**\n     * @private\n     */\n    _set: function(key, value) {\n      var i = this._objects.length;\n      if (this.useSetOnGroup) {\n        while (i--) {\n          this._objects[i].setOnGroup(key, value);\n        }\n      }\n      if (key === 'canvas') {\n        while (i--) {\n          this._objects[i]._set(key, value);\n        }\n      }\n      fabric.Object.prototype._set.call(this, key, value);\n    },\n\n    /**\n     * Returns object representation of an instance\n     * @param {Array} [propertiesToInclude] Any properties that you might want to additionally include in the output\n     * @return {Object} object representation of an instance\n     */\n    toObject: function(propertiesToInclude) {\n      var _includeDefaultValues = this.includeDefaultValues;\n      var objsToObject = this._objects\n        .filter(function (obj) {\n          return !obj.excludeFromExport;\n        })\n        .map(function (obj) {\n          var originalDefaults = obj.includeDefaultValues;\n          obj.includeDefaultValues = _includeDefaultValues;\n          var _obj = obj.toObject(propertiesToInclude);\n          obj.includeDefaultValues = originalDefaults;\n          return _obj;\n        });\n      var obj = fabric.Object.prototype.toObject.call(this, propertiesToInclude);\n      obj.objects = objsToObject;\n      return obj;\n    },\n\n    /**\n     * Returns object representation of an instance, in dataless mode.\n     * @param {Array} [propertiesToInclude] Any properties that you might want to additionally include in the output\n     * @return {Object} object representation of an instance\n     */\n    toDatalessObject: function(propertiesToInclude) {\n      var objsToObject, sourcePath = this.sourcePath;\n      if (sourcePath) {\n        objsToObject = sourcePath;\n      }\n      else {\n        var _includeDefaultValues = this.includeDefaultValues;\n        objsToObject = this._objects.map(function(obj) {\n          var originalDefaults = obj.includeDefaultValues;\n          obj.includeDefaultValues = _includeDefaultValues;\n          var _obj = obj.toDatalessObject(propertiesToInclude);\n          obj.includeDefaultValues = originalDefaults;\n          return _obj;\n        });\n      }\n      var obj = fabric.Object.prototype.toDatalessObject.call(this, propertiesToInclude);\n      obj.objects = objsToObject;\n      return obj;\n    },\n\n    /**\n     * Renders instance on a given context\n     * @param {CanvasRenderingContext2D} ctx context to render instance on\n     */\n    render: function(ctx) {\n      this._transformDone = true;\n      this.callSuper('render', ctx);\n      this._transformDone = false;\n    },\n\n    /**\n     * Decide if the object should cache or not. Create its own cache level\n     * needsItsOwnCache should be used when the object drawing method requires\n     * a cache step. None of the fabric classes requires it.\n     * Generally you do not cache objects in groups because the group is already cached.\n     * @return {Boolean}\n     */\n    shouldCache: function() {\n      var ownCache = fabric.Object.prototype.shouldCache.call(this);\n      if (ownCache) {\n        for (var i = 0, len = this._objects.length; i < len; i++) {\n          if (this._objects[i].willDrawShadow()) {\n            this.ownCaching = false;\n            return false;\n          }\n        }\n      }\n      return ownCache;\n    },\n\n    /**\n     * Check if this object or a child object will cast a shadow\n     * @return {Boolean}\n     */\n    willDrawShadow: function() {\n      if (fabric.Object.prototype.willDrawShadow.call(this)) {\n        return true;\n      }\n      for (var i = 0, len = this._objects.length; i < len; i++) {\n        if (this._objects[i].willDrawShadow()) {\n          return true;\n        }\n      }\n      return false;\n    },\n\n    /**\n     * Check if this group or its parent group are caching, recursively up\n     * @return {Boolean}\n     */\n    isOnACache: function() {\n      return this.ownCaching || (this.group && this.group.isOnACache());\n    },\n\n    /**\n     * Execute the drawing operation for an object on a specified context\n     * @param {CanvasRenderingContext2D} ctx Context to render on\n     */\n    drawObject: function(ctx) {\n      for (var i = 0, len = this._objects.length; i < len; i++) {\n        this._objects[i].render(ctx);\n      }\n      this._drawClipPath(ctx, this.clipPath);\n    },\n\n    /**\n     * Check if cache is dirty\n     */\n    isCacheDirty: function(skipCanvas) {\n      if (this.callSuper('isCacheDirty', skipCanvas)) {\n        return true;\n      }\n      if (!this.statefullCache) {\n        return false;\n      }\n      for (var i = 0, len = this._objects.length; i < len; i++) {\n        if (this._objects[i].isCacheDirty(true)) {\n          if (this._cacheCanvas) {\n            // if this group has not a cache canvas there is nothing to clean\n            var x = this.cacheWidth / this.zoomX, y = this.cacheHeight / this.zoomY;\n            this._cacheContext.clearRect(-x / 2, -y / 2, x, y);\n          }\n          return true;\n        }\n      }\n      return false;\n    },\n\n    /**\n     * Restores original state of each of group objects (original state is that which was before group was created).\n     * if the nested boolean is true, the original state will be restored just for the\n     * first group and not for all the group chain\n     * @private\n     * @param {Boolean} nested tell the function to restore object state up to the parent group and not more\n     * @return {fabric.Group} thisArg\n     * @chainable\n     */\n    _restoreObjectsState: function() {\n      var groupMatrix = this.calcOwnMatrix();\n      this._objects.forEach(function(object) {\n        // instead of using _this = this;\n        fabric.util.addTransformToObject(object, groupMatrix);\n        delete object.group;\n        object.setCoords();\n      });\n      return this;\n    },\n\n    /**\n     * Destroys a group (restoring state of its objects)\n     * @return {fabric.Group} thisArg\n     * @chainable\n     */\n    destroy: function() {\n      // when group is destroyed objects needs to get a repaint to be eventually\n      // displayed on canvas.\n      this._objects.forEach(function(object) {\n        object.set('dirty', true);\n      });\n      return this._restoreObjectsState();\n    },\n\n    dispose: function () {\n      this.callSuper('dispose');\n      this.forEachObject(function (object) {\n        object.dispose && object.dispose();\n      });\n      this._objects = [];\n    },\n\n    /**\n     * make a group an active selection, remove the group from canvas\n     * the group has to be on canvas for this to work.\n     * @return {fabric.ActiveSelection} thisArg\n     * @chainable\n     */\n    toActiveSelection: function() {\n      if (!this.canvas) {\n        return;\n      }\n      var objects = this._objects, canvas = this.canvas;\n      this._objects = [];\n      var options = this.toObject();\n      delete options.objects;\n      var activeSelection = new fabric.ActiveSelection([]);\n      activeSelection.set(options);\n      activeSelection.type = 'activeSelection';\n      canvas.remove(this);\n      objects.forEach(function(object) {\n        object.group = activeSelection;\n        object.dirty = true;\n        canvas.add(object);\n      });\n      activeSelection.canvas = canvas;\n      activeSelection._objects = objects;\n      canvas._activeObject = activeSelection;\n      activeSelection.setCoords();\n      return activeSelection;\n    },\n\n    /**\n     * Destroys a group (restoring state of its objects)\n     * @return {fabric.Group} thisArg\n     * @chainable\n     */\n    ungroupOnCanvas: function() {\n      return this._restoreObjectsState();\n    },\n\n    /**\n     * Sets coordinates of all objects inside group\n     * @return {fabric.Group} thisArg\n     * @chainable\n     */\n    setObjectsCoords: function() {\n      var skipControls = true;\n      this.forEachObject(function(object) {\n        object.setCoords(skipControls);\n      });\n      return this;\n    },\n\n    /**\n     * @private\n     */\n    _calcBounds: function(onlyWidthHeight) {\n      var aX = [],\n          aY = [],\n          o, prop, coords,\n          props = ['tr', 'br', 'bl', 'tl'],\n          i = 0, iLen = this._objects.length,\n          j, jLen = props.length;\n\n      for ( ; i < iLen; ++i) {\n        o = this._objects[i];\n        coords = o.calcACoords();\n        for (j = 0; j < jLen; j++) {\n          prop = props[j];\n          aX.push(coords[prop].x);\n          aY.push(coords[prop].y);\n        }\n        o.aCoords = coords;\n      }\n\n      this._getBounds(aX, aY, onlyWidthHeight);\n    },\n\n    /**\n     * @private\n     */\n    _getBounds: function(aX, aY, onlyWidthHeight) {\n      var minXY = new fabric.Point(min(aX), min(aY)),\n          maxXY = new fabric.Point(max(aX), max(aY)),\n          top = minXY.y || 0, left = minXY.x || 0,\n          width = (maxXY.x - minXY.x) || 0,\n          height = (maxXY.y - minXY.y) || 0;\n      this.width = width;\n      this.height = height;\n      if (!onlyWidthHeight) {\n        // the bounding box always finds the topleft most corner.\n        // whatever is the group origin, we set up here the left/top position.\n        this.setPositionByOrigin({ x: left, y: top }, 'left', 'top');\n      }\n    },\n\n    /* _TO_SVG_START_ */\n    /**\n     * Returns svg representation of an instance\n     * @param {Function} [reviver] Method for further parsing of svg representation.\n     * @return {String} svg representation of an instance\n     */\n    _toSVG: function(reviver) {\n      var svgString = ['<g ', 'COMMON_PARTS', ' >\\n'];\n\n      for (var i = 0, len = this._objects.length; i < len; i++) {\n        svgString.push('\\t\\t', this._objects[i].toSVG(reviver));\n      }\n      svgString.push('</g>\\n');\n      return svgString;\n    },\n\n    /**\n     * Returns styles-string for svg-export, specific version for group\n     * @return {String}\n     */\n    getSvgStyles: function() {\n      var opacity = typeof this.opacity !== 'undefined' && this.opacity !== 1 ?\n            'opacity: ' + this.opacity + ';' : '',\n          visibility = this.visible ? '' : ' visibility: hidden;';\n      return [\n        opacity,\n        this.getSvgFilter(),\n        visibility\n      ].join('');\n    },\n\n    /**\n     * Returns svg clipPath representation of an instance\n     * @param {Function} [reviver] Method for further parsing of svg representation.\n     * @return {String} svg representation of an instance\n     */\n    toClipPathSVG: function(reviver) {\n      var svgString = [];\n\n      for (var i = 0, len = this._objects.length; i < len; i++) {\n        svgString.push('\\t', this._objects[i].toClipPathSVG(reviver));\n      }\n\n      return this._createBaseClipPathSVGMarkup(svgString, { reviver: reviver });\n    },\n    /* _TO_SVG_END_ */\n  });\n\n  /**\n   * Returns {@link fabric.Group} instance from an object representation\n   * @static\n   * @memberOf fabric.Group\n   * @param {Object} object Object to create a group from\n   * @param {Function} [callback] Callback to invoke when an group instance is created\n   */\n  fabric.Group.fromObject = function(object, callback) {\n    var objects = object.objects,\n        options = fabric.util.object.clone(object, true);\n    delete options.objects;\n    if (typeof objects === 'string') {\n      // it has to be an url or something went wrong.\n      fabric.loadSVGFromURL(objects, function (elements) {\n        var group = fabric.util.groupSVGElements(elements, object, objects);\n        var clipPath = options.clipPath;\n        delete options.clipPath;\n        group.set(options);\n        if (clipPath) {\n          fabric.util.enlivenObjects([clipPath], function(elivenedObjects) {\n            group.clipPath = elivenedObjects[0];\n            callback && callback(group);\n          });\n        }\n        else {\n          callback && callback(group);\n        }\n      });\n      return;\n    }\n    fabric.util.enlivenObjects(objects, function (enlivenedObjects) {\n      fabric.util.enlivenObjectEnlivables(object, options, function () {\n        callback && callback(new fabric.Group(enlivenedObjects, options, true));\n      });\n    });\n  };\n})(typeof exports !== 'undefined' ? exports : this);\n\n\n(function(global) {\n\n  'use strict';\n\n  var fabric = global.fabric || (global.fabric = { });\n\n  if (fabric.ActiveSelection) {\n    return;\n  }\n\n  /**\n   * Group class\n   * @class fabric.ActiveSelection\n   * @extends fabric.Group\n   * @tutorial {@link http://fabricjs.com/fabric-intro-part-3#groups}\n   * @see {@link fabric.ActiveSelection#initialize} for constructor definition\n   */\n  fabric.ActiveSelection = fabric.util.createClass(fabric.Group, /** @lends fabric.ActiveSelection.prototype */ {\n\n    /**\n     * Type of an object\n     * @type String\n     * @default\n     */\n    type: 'activeSelection',\n\n    /**\n     * Constructor\n     * @param {Object} objects ActiveSelection objects\n     * @param {Object} [options] Options object\n     * @return {Object} thisArg\n     */\n    initialize: function(objects, options) {\n      options = options || {};\n      this._objects = objects || [];\n      for (var i = this._objects.length; i--; ) {\n        this._objects[i].group = this;\n      }\n\n      if (options.originX) {\n        this.originX = options.originX;\n      }\n      if (options.originY) {\n        this.originY = options.originY;\n      }\n      this._calcBounds();\n      this._updateObjectsCoords();\n      fabric.Object.prototype.initialize.call(this, options);\n      this.setCoords();\n    },\n\n    /**\n     * Change te activeSelection to a normal group,\n     * High level function that automatically adds it to canvas as\n     * active object. no events fired.\n     * @since 2.0.0\n     * @return {fabric.Group}\n     */\n    toGroup: function() {\n      var objects = this._objects.concat();\n      this._objects = [];\n      var options = fabric.Object.prototype.toObject.call(this);\n      var newGroup = new fabric.Group([]);\n      delete options.type;\n      newGroup.set(options);\n      objects.forEach(function(object) {\n        object.canvas.remove(object);\n        object.group = newGroup;\n      });\n      newGroup._objects = objects;\n      if (!this.canvas) {\n        return newGroup;\n      }\n      var canvas = this.canvas;\n      canvas.add(newGroup);\n      canvas._activeObject = newGroup;\n      newGroup.setCoords();\n      return newGroup;\n    },\n\n    /**\n     * If returns true, deselection is cancelled.\n     * @since 2.0.0\n     * @return {Boolean} [cancel]\n     */\n    onDeselect: function() {\n      this.destroy();\n      return false;\n    },\n\n    /**\n     * Returns string representation of a group\n     * @return {String}\n     */\n    toString: function() {\n      return '#<fabric.ActiveSelection: (' + this.complexity() + ')>';\n    },\n\n    /**\n     * Decide if the object should cache or not. Create its own cache level\n     * objectCaching is a global flag, wins over everything\n     * needsItsOwnCache should be used when the object drawing method requires\n     * a cache step. None of the fabric classes requires it.\n     * Generally you do not cache objects in groups because the group outside is cached.\n     * @return {Boolean}\n     */\n    shouldCache: function() {\n      return false;\n    },\n\n    /**\n     * Check if this group or its parent group are caching, recursively up\n     * @return {Boolean}\n     */\n    isOnACache: function() {\n      return false;\n    },\n\n    /**\n     * Renders controls and borders for the object\n     * @param {CanvasRenderingContext2D} ctx Context to render on\n     * @param {Object} [styleOverride] properties to override the object style\n     * @param {Object} [childrenOverride] properties to override the children overrides\n     */\n    _renderControls: function(ctx, styleOverride, childrenOverride) {\n      ctx.save();\n      ctx.globalAlpha = this.isMoving ? this.borderOpacityWhenMoving : 1;\n      this.callSuper('_renderControls', ctx, styleOverride);\n      childrenOverride = childrenOverride || { };\n      if (typeof childrenOverride.hasControls === 'undefined') {\n        childrenOverride.hasControls = false;\n      }\n      childrenOverride.forActiveSelection = true;\n      for (var i = 0, len = this._objects.length; i < len; i++) {\n        this._objects[i]._renderControls(ctx, childrenOverride);\n      }\n      ctx.restore();\n    },\n  });\n\n  /**\n   * Returns {@link fabric.ActiveSelection} instance from an object representation\n   * @static\n   * @memberOf fabric.ActiveSelection\n   * @param {Object} object Object to create a group from\n   * @param {Function} [callback] Callback to invoke when an ActiveSelection instance is created\n   */\n  fabric.ActiveSelection.fromObject = function(object, callback) {\n    fabric.util.enlivenObjects(object.objects, function(enlivenedObjects) {\n      delete object.objects;\n      callback && callback(new fabric.ActiveSelection(enlivenedObjects, object, true));\n    });\n  };\n\n})(typeof exports !== 'undefined' ? exports : this);\n\n\n(function(global) {\n\n  'use strict';\n\n  var extend = fabric.util.object.extend;\n\n  if (!global.fabric) {\n    global.fabric = { };\n  }\n\n  if (global.fabric.Image) {\n    fabric.warn('fabric.Image is already defined.');\n    return;\n  }\n\n  /**\n   * Image class\n   * @class fabric.Image\n   * @extends fabric.Object\n   * @tutorial {@link http://fabricjs.com/fabric-intro-part-1#images}\n   * @see {@link fabric.Image#initialize} for constructor definition\n   */\n  fabric.Image = fabric.util.createClass(fabric.Object, /** @lends fabric.Image.prototype */ {\n\n    /**\n     * Type of an object\n     * @type String\n     * @default\n     */\n    type: 'image',\n\n    /**\n     * Width of a stroke.\n     * For image quality a stroke multiple of 2 gives better results.\n     * @type Number\n     * @default\n     */\n    strokeWidth: 0,\n\n    /**\n     * When calling {@link fabric.Image.getSrc}, return value from element src with `element.getAttribute('src')`.\n     * This allows for relative urls as image src.\n     * @since 2.7.0\n     * @type Boolean\n     * @default\n     */\n    srcFromAttribute: false,\n\n    /**\n     * private\n     * contains last value of scaleX to detect\n     * if the Image got resized after the last Render\n     * @type Number\n     */\n    _lastScaleX: 1,\n\n    /**\n     * private\n     * contains last value of scaleY to detect\n     * if the Image got resized after the last Render\n     * @type Number\n     */\n    _lastScaleY: 1,\n\n    /**\n     * private\n     * contains last value of scaling applied by the apply filter chain\n     * @type Number\n     */\n    _filterScalingX: 1,\n\n    /**\n     * private\n     * contains last value of scaling applied by the apply filter chain\n     * @type Number\n     */\n    _filterScalingY: 1,\n\n    /**\n     * minimum scale factor under which any resizeFilter is triggered to resize the image\n     * 0 will disable the automatic resize. 1 will trigger automatically always.\n     * number bigger than 1 are not implemented yet.\n     * @type Number\n     */\n    minimumScaleTrigger: 0.5,\n\n    /**\n     * List of properties to consider when checking if\n     * state of an object is changed ({@link fabric.Object#hasStateChanged})\n     * as well as for history (undo/redo) purposes\n     * @type Array\n     */\n    stateProperties: fabric.Object.prototype.stateProperties.concat('cropX', 'cropY'),\n\n    /**\n     * List of properties to consider when checking if cache needs refresh\n     * Those properties are checked by statefullCache ON ( or lazy mode if we want ) or from single\n     * calls to Object.set(key, value). If the key is in this list, the object is marked as dirty\n     * and refreshed at the next render\n     * @type Array\n     */\n    cacheProperties: fabric.Object.prototype.cacheProperties.concat('cropX', 'cropY'),\n\n    /**\n     * key used to retrieve the texture representing this image\n     * @since 2.0.0\n     * @type String\n     * @default\n     */\n    cacheKey: '',\n\n    /**\n     * Image crop in pixels from original image size.\n     * @since 2.0.0\n     * @type Number\n     * @default\n     */\n    cropX: 0,\n\n    /**\n     * Image crop in pixels from original image size.\n     * @since 2.0.0\n     * @type Number\n     * @default\n     */\n    cropY: 0,\n\n    /**\n     * Indicates whether this canvas will use image smoothing when painting this image.\n     * Also influence if the cacheCanvas for this image uses imageSmoothing\n     * @since 4.0.0-beta.11\n     * @type Boolean\n     * @default\n     */\n    imageSmoothing: true,\n\n    /**\n     * Constructor\n     * Image can be initialized with any canvas drawable or a string.\n     * The string should be a url and will be loaded as an image.\n     * Canvas and Image element work out of the box, while videos require extra code to work.\n     * Please check video element events for seeking.\n     * @param {HTMLImageElement | HTMLCanvasElement | HTMLVideoElement | String} element Image element\n     * @param {Object} [options] Options object\n     * @param {function} [callback] callback function to call after eventual filters applied.\n     * @return {fabric.Image} thisArg\n     */\n    initialize: function(element, options) {\n      options || (options = { });\n      this.filters = [];\n      this.cacheKey = 'texture' + fabric.Object.__uid++;\n      this.callSuper('initialize', options);\n      this._initElement(element, options);\n    },\n\n    /**\n     * Returns image element which this instance if based on\n     * @return {HTMLImageElement} Image element\n     */\n    getElement: function() {\n      return this._element || {};\n    },\n\n    /**\n     * Sets image element for this instance to a specified one.\n     * If filters defined they are applied to new image.\n     * You might need to call `canvas.renderAll` and `object.setCoords` after replacing, to render new image and update controls area.\n     * @param {HTMLImageElement} element\n     * @param {Object} [options] Options object\n     * @return {fabric.Image} thisArg\n     * @chainable\n     */\n    setElement: function(element, options) {\n      this.removeTexture(this.cacheKey);\n      this.removeTexture(this.cacheKey + '_filtered');\n      this._element = element;\n      this._originalElement = element;\n      this._initConfig(options);\n      if (this.filters.length !== 0) {\n        this.applyFilters();\n      }\n      // resizeFilters work on the already filtered copy.\n      // we need to apply resizeFilters AFTER normal filters.\n      // applyResizeFilters is run more often than normal filters\n      // and is triggered by user interactions rather than dev code\n      if (this.resizeFilter) {\n        this.applyResizeFilters();\n      }\n      return this;\n    },\n\n    /**\n     * Delete a single texture if in webgl mode\n     */\n    removeTexture: function(key) {\n      var backend = fabric.filterBackend;\n      if (backend && backend.evictCachesForKey) {\n        backend.evictCachesForKey(key);\n      }\n    },\n\n    /**\n     * Delete textures, reference to elements and eventually JSDOM cleanup\n     */\n    dispose: function () {\n      this.callSuper('dispose');\n      this.removeTexture(this.cacheKey);\n      this.removeTexture(this.cacheKey + '_filtered');\n      this._cacheContext = undefined;\n      ['_originalElement', '_element', '_filteredEl', '_cacheCanvas'].forEach((function(element) {\n        fabric.util.cleanUpJsdomNode(this[element]);\n        this[element] = undefined;\n      }).bind(this));\n    },\n\n    /**\n     * Get the crossOrigin value (of the corresponding image element)\n     */\n    getCrossOrigin: function() {\n      return this._originalElement && (this._originalElement.crossOrigin || null);\n    },\n\n    /**\n     * Returns original size of an image\n     * @return {Object} Object with \"width\" and \"height\" properties\n     */\n    getOriginalSize: function() {\n      var element = this.getElement();\n      return {\n        width: element.naturalWidth || element.width,\n        height: element.naturalHeight || element.height\n      };\n    },\n\n    /**\n     * @private\n     * @param {CanvasRenderingContext2D} ctx Context to render on\n     */\n    _stroke: function(ctx) {\n      if (!this.stroke || this.strokeWidth === 0) {\n        return;\n      }\n      var w = this.width / 2, h = this.height / 2;\n      ctx.beginPath();\n      ctx.moveTo(-w, -h);\n      ctx.lineTo(w, -h);\n      ctx.lineTo(w, h);\n      ctx.lineTo(-w, h);\n      ctx.lineTo(-w, -h);\n      ctx.closePath();\n    },\n\n    /**\n     * Returns object representation of an instance\n     * @param {Array} [propertiesToInclude] Any properties that you might want to additionally include in the output\n     * @return {Object} Object representation of an instance\n     */\n    toObject: function(propertiesToInclude) {\n      var filters = [];\n\n      this.filters.forEach(function(filterObj) {\n        if (filterObj) {\n          filters.push(filterObj.toObject());\n        }\n      });\n      var object = extend(\n        this.callSuper(\n          'toObject',\n          ['cropX', 'cropY'].concat(propertiesToInclude)\n        ), {\n          src: this.getSrc(),\n          crossOrigin: this.getCrossOrigin(),\n          filters: filters,\n        });\n      if (this.resizeFilter) {\n        object.resizeFilter = this.resizeFilter.toObject();\n      }\n      return object;\n    },\n\n    /**\n     * Returns true if an image has crop applied, inspecting values of cropX,cropY,width,height.\n     * @return {Boolean}\n     */\n    hasCrop: function() {\n      return this.cropX || this.cropY || this.width < this._element.width || this.height < this._element.height;\n    },\n\n    /* _TO_SVG_START_ */\n    /**\n     * Returns svg representation of an instance\n     * @return {Array} an array of strings with the specific svg representation\n     * of the instance\n     */\n    _toSVG: function() {\n      var svgString = [], imageMarkup = [], strokeSvg, element = this._element,\n          x = -this.width / 2, y = -this.height / 2, clipPath = '', imageRendering = '';\n      if (!element) {\n        return [];\n      }\n      if (this.hasCrop()) {\n        var clipPathId = fabric.Object.__uid++;\n        svgString.push(\n          '<clipPath id=\"imageCrop_' + clipPathId + '\">\\n',\n          '\\t<rect x=\"' + x + '\" y=\"' + y + '\" width=\"' + this.width + '\" height=\"' + this.height + '\" />\\n',\n          '</clipPath>\\n'\n        );\n        clipPath = ' clip-path=\"url(#imageCrop_' + clipPathId + ')\" ';\n      }\n      if (!this.imageSmoothing) {\n        imageRendering = '\" image-rendering=\"optimizeSpeed';\n      }\n      imageMarkup.push('\\t<image ', 'COMMON_PARTS', 'xlink:href=\"', this.getSvgSrc(true),\n        '\" x=\"', x - this.cropX, '\" y=\"', y - this.cropY,\n        // we're essentially moving origin of transformation from top/left corner to the center of the shape\n        // by wrapping it in container <g> element with actual transformation, then offsetting object to the top/left\n        // so that object's center aligns with container's left/top\n        '\" width=\"', element.width || element.naturalWidth,\n        '\" height=\"', element.height || element.height,\n        imageRendering,\n        '\"', clipPath,\n        '></image>\\n');\n\n      if (this.stroke || this.strokeDashArray) {\n        var origFill = this.fill;\n        this.fill = null;\n        strokeSvg = [\n          '\\t<rect ',\n          'x=\"', x, '\" y=\"', y,\n          '\" width=\"', this.width, '\" height=\"', this.height,\n          '\" style=\"', this.getSvgStyles(),\n          '\"/>\\n'\n        ];\n        this.fill = origFill;\n      }\n      if (this.paintFirst !== 'fill') {\n        svgString = svgString.concat(strokeSvg, imageMarkup);\n      }\n      else {\n        svgString = svgString.concat(imageMarkup, strokeSvg);\n      }\n      return svgString;\n    },\n    /* _TO_SVG_END_ */\n\n    /**\n     * Returns source of an image\n     * @param {Boolean} filtered indicates if the src is needed for svg\n     * @return {String} Source of an image\n     */\n    getSrc: function(filtered) {\n      var element = filtered ? this._element : this._originalElement;\n      if (element) {\n        if (element.toDataURL) {\n          return element.toDataURL();\n        }\n\n        if (this.srcFromAttribute) {\n          return element.getAttribute('src');\n        }\n        else {\n          return element.src;\n        }\n      }\n      else {\n        return this.src || '';\n      }\n    },\n\n    /**\n     * Sets source of an image\n     * @param {String} src Source string (URL)\n     * @param {Function} [callback] Callback is invoked when image has been loaded (and all filters have been applied)\n     * @param {Object} [options] Options object\n     * @param {String} [options.crossOrigin] crossOrigin value (one of \"\", \"anonymous\", \"use-credentials\")\n     * @see https://developer.mozilla.org/en-US/docs/HTML/CORS_settings_attributes\n     * @return {fabric.Image} thisArg\n     * @chainable\n     */\n    setSrc: function(src, callback, options) {\n      fabric.util.loadImage(src, function(img, isError) {\n        this.setElement(img, options);\n        this._setWidthHeight();\n        callback && callback(this, isError);\n      }, this, options && options.crossOrigin);\n      return this;\n    },\n\n    /**\n     * Returns string representation of an instance\n     * @return {String} String representation of an instance\n     */\n    toString: function() {\n      return '#<fabric.Image: { src: \"' + this.getSrc() + '\" }>';\n    },\n\n    applyResizeFilters: function() {\n      var filter = this.resizeFilter,\n          minimumScale = this.minimumScaleTrigger,\n          objectScale = this.getTotalObjectScaling(),\n          scaleX = objectScale.scaleX,\n          scaleY = objectScale.scaleY,\n          elementToFilter = this._filteredEl || this._originalElement;\n      if (this.group) {\n        this.set('dirty', true);\n      }\n      if (!filter || (scaleX > minimumScale && scaleY > minimumScale)) {\n        this._element = elementToFilter;\n        this._filterScalingX = 1;\n        this._filterScalingY = 1;\n        this._lastScaleX = scaleX;\n        this._lastScaleY = scaleY;\n        return;\n      }\n      if (!fabric.filterBackend) {\n        fabric.filterBackend = fabric.initFilterBackend();\n      }\n      var canvasEl = fabric.util.createCanvasElement(),\n          cacheKey = this._filteredEl ? (this.cacheKey + '_filtered') : this.cacheKey,\n          sourceWidth = elementToFilter.width, sourceHeight = elementToFilter.height;\n      canvasEl.width = sourceWidth;\n      canvasEl.height = sourceHeight;\n      this._element = canvasEl;\n      this._lastScaleX = filter.scaleX = scaleX;\n      this._lastScaleY = filter.scaleY = scaleY;\n      fabric.filterBackend.applyFilters(\n        [filter], elementToFilter, sourceWidth, sourceHeight, this._element, cacheKey);\n      this._filterScalingX = canvasEl.width / this._originalElement.width;\n      this._filterScalingY = canvasEl.height / this._originalElement.height;\n    },\n\n    /**\n     * Applies filters assigned to this image (from \"filters\" array) or from filter param\n     * @method applyFilters\n     * @param {Array} filters to be applied\n     * @param {Boolean} forResizing specify if the filter operation is a resize operation\n     * @return {thisArg} return the fabric.Image object\n     * @chainable\n     */\n    applyFilters: function(filters) {\n\n      filters = filters || this.filters || [];\n      filters = filters.filter(function(filter) { return filter && !filter.isNeutralState(); });\n      this.set('dirty', true);\n\n      // needs to clear out or WEBGL will not resize correctly\n      this.removeTexture(this.cacheKey + '_filtered');\n\n      if (filters.length === 0) {\n        this._element = this._originalElement;\n        this._filteredEl = null;\n        this._filterScalingX = 1;\n        this._filterScalingY = 1;\n        return this;\n      }\n\n      var imgElement = this._originalElement,\n          sourceWidth = imgElement.naturalWidth || imgElement.width,\n          sourceHeight = imgElement.naturalHeight || imgElement.height;\n\n      if (this._element === this._originalElement) {\n        // if the element is the same we need to create a new element\n        var canvasEl = fabric.util.createCanvasElement();\n        canvasEl.width = sourceWidth;\n        canvasEl.height = sourceHeight;\n        this._element = canvasEl;\n        this._filteredEl = canvasEl;\n      }\n      else {\n        // clear the existing element to get new filter data\n        // also dereference the eventual resized _element\n        this._element = this._filteredEl;\n        this._filteredEl.getContext('2d').clearRect(0, 0, sourceWidth, sourceHeight);\n        // we also need to resize again at next renderAll, so remove saved _lastScaleX/Y\n        this._lastScaleX = 1;\n        this._lastScaleY = 1;\n      }\n      if (!fabric.filterBackend) {\n        fabric.filterBackend = fabric.initFilterBackend();\n      }\n      fabric.filterBackend.applyFilters(\n        filters, this._originalElement, sourceWidth, sourceHeight, this._element, this.cacheKey);\n      if (this._originalElement.width !== this._element.width ||\n        this._originalElement.height !== this._element.height) {\n        this._filterScalingX = this._element.width / this._originalElement.width;\n        this._filterScalingY = this._element.height / this._originalElement.height;\n      }\n      return this;\n    },\n\n    /**\n     * @private\n     * @param {CanvasRenderingContext2D} ctx Context to render on\n     */\n    _render: function(ctx) {\n      fabric.util.setImageSmoothing(ctx, this.imageSmoothing);\n      if (this.isMoving !== true && this.resizeFilter && this._needsResize()) {\n        this.applyResizeFilters();\n      }\n      this._stroke(ctx);\n      this._renderPaintInOrder(ctx);\n    },\n\n    /**\n     * Paint the cached copy of the object on the target context.\n     * it will set the imageSmoothing for the draw operation\n     * @param {CanvasRenderingContext2D} ctx Context to render on\n     */\n    drawCacheOnCanvas: function(ctx) {\n      fabric.util.setImageSmoothing(ctx, this.imageSmoothing);\n      fabric.Object.prototype.drawCacheOnCanvas.call(this, ctx);\n    },\n\n    /**\n     * Decide if the object should cache or not. Create its own cache level\n     * needsItsOwnCache should be used when the object drawing method requires\n     * a cache step. None of the fabric classes requires it.\n     * Generally you do not cache objects in groups because the group outside is cached.\n     * This is the special image version where we would like to avoid caching where possible.\n     * Essentially images do not benefit from caching. They may require caching, and in that\n     * case we do it. Also caching an image usually ends in a loss of details.\n     * A full performance audit should be done.\n     * @return {Boolean}\n     */\n    shouldCache: function() {\n      return this.needsItsOwnCache();\n    },\n\n    _renderFill: function(ctx) {\n      var elementToDraw = this._element;\n      if (!elementToDraw) {\n        return;\n      }\n      var scaleX = this._filterScalingX, scaleY = this._filterScalingY,\n          w = this.width, h = this.height, min = Math.min, max = Math.max,\n          // crop values cannot be lesser than 0.\n          cropX = max(this.cropX, 0), cropY = max(this.cropY, 0),\n          elWidth = elementToDraw.naturalWidth || elementToDraw.width,\n          elHeight = elementToDraw.naturalHeight || elementToDraw.height,\n          sX = cropX * scaleX,\n          sY = cropY * scaleY,\n          // the width height cannot exceed element width/height, starting from the crop offset.\n          sW = min(w * scaleX, elWidth - sX),\n          sH = min(h * scaleY, elHeight - sY),\n          x = -w / 2, y = -h / 2,\n          maxDestW = min(w, elWidth / scaleX - cropX),\n          maxDestH = min(h, elHeight / scaleY - cropY);\n\n      elementToDraw && ctx.drawImage(elementToDraw, sX, sY, sW, sH, x, y, maxDestW, maxDestH);\n    },\n\n    /**\n     * needed to check if image needs resize\n     * @private\n     */\n    _needsResize: function() {\n      var scale = this.getTotalObjectScaling();\n      return (scale.scaleX !== this._lastScaleX || scale.scaleY !== this._lastScaleY);\n    },\n\n    /**\n     * @private\n     */\n    _resetWidthHeight: function() {\n      this.set(this.getOriginalSize());\n    },\n\n    /**\n     * The Image class's initialization method. This method is automatically\n     * called by the constructor.\n     * @private\n     * @param {HTMLImageElement|String} element The element representing the image\n     * @param {Object} [options] Options object\n     */\n    _initElement: function(element, options) {\n      this.setElement(fabric.util.getById(element), options);\n      fabric.util.addClass(this.getElement(), fabric.Image.CSS_CANVAS);\n    },\n\n    /**\n     * @private\n     * @param {Object} [options] Options object\n     */\n    _initConfig: function(options) {\n      options || (options = { });\n      this.setOptions(options);\n      this._setWidthHeight(options);\n    },\n\n    /**\n     * @private\n     * @param {Array} filters to be initialized\n     * @param {Function} callback Callback to invoke when all fabric.Image.filters instances are created\n     */\n    _initFilters: function(filters, callback) {\n      if (filters && filters.length) {\n        fabric.util.enlivenObjects(filters, function(enlivenedObjects) {\n          callback && callback(enlivenedObjects);\n        }, 'fabric.Image.filters');\n      }\n      else {\n        callback && callback();\n      }\n    },\n\n    /**\n     * @private\n     * Set the width and the height of the image object, using the element or the\n     * options.\n     * @param {Object} [options] Object with width/height properties\n     */\n    _setWidthHeight: function(options) {\n      options || (options = { });\n      var el = this.getElement();\n      this.width = options.width || el.naturalWidth || el.width || 0;\n      this.height = options.height || el.naturalHeight || el.height || 0;\n    },\n\n    /**\n     * Calculate offset for center and scale factor for the image in order to respect\n     * the preserveAspectRatio attribute\n     * @private\n     * @return {Object}\n     */\n    parsePreserveAspectRatioAttribute: function() {\n      var pAR = fabric.util.parsePreserveAspectRatioAttribute(this.preserveAspectRatio || ''),\n          rWidth = this._element.width, rHeight = this._element.height,\n          scaleX = 1, scaleY = 1, offsetLeft = 0, offsetTop = 0, cropX = 0, cropY = 0,\n          offset, pWidth = this.width, pHeight = this.height, parsedAttributes = { width: pWidth, height: pHeight };\n      if (pAR && (pAR.alignX !== 'none' || pAR.alignY !== 'none')) {\n        if (pAR.meetOrSlice === 'meet') {\n          scaleX = scaleY = fabric.util.findScaleToFit(this._element, parsedAttributes);\n          offset = (pWidth - rWidth * scaleX) / 2;\n          if (pAR.alignX === 'Min') {\n            offsetLeft = -offset;\n          }\n          if (pAR.alignX === 'Max') {\n            offsetLeft = offset;\n          }\n          offset = (pHeight - rHeight * scaleY) / 2;\n          if (pAR.alignY === 'Min') {\n            offsetTop = -offset;\n          }\n          if (pAR.alignY === 'Max') {\n            offsetTop = offset;\n          }\n        }\n        if (pAR.meetOrSlice === 'slice') {\n          scaleX = scaleY = fabric.util.findScaleToCover(this._element, parsedAttributes);\n          offset = rWidth - pWidth / scaleX;\n          if (pAR.alignX === 'Mid') {\n            cropX = offset / 2;\n          }\n          if (pAR.alignX === 'Max') {\n            cropX = offset;\n          }\n          offset = rHeight - pHeight / scaleY;\n          if (pAR.alignY === 'Mid') {\n            cropY = offset / 2;\n          }\n          if (pAR.alignY === 'Max') {\n            cropY = offset;\n          }\n          rWidth = pWidth / scaleX;\n          rHeight = pHeight / scaleY;\n        }\n      }\n      else {\n        scaleX = pWidth / rWidth;\n        scaleY = pHeight / rHeight;\n      }\n      return {\n        width: rWidth,\n        height: rHeight,\n        scaleX: scaleX,\n        scaleY: scaleY,\n        offsetLeft: offsetLeft,\n        offsetTop: offsetTop,\n        cropX: cropX,\n        cropY: cropY\n      };\n    }\n  });\n\n  /**\n   * Default CSS class name for canvas\n   * @static\n   * @type String\n   * @default\n   */\n  fabric.Image.CSS_CANVAS = 'canvas-img';\n\n  /**\n   * Alias for getSrc\n   * @static\n   */\n  fabric.Image.prototype.getSvgSrc = fabric.Image.prototype.getSrc;\n\n  /**\n   * Creates an instance of fabric.Image from its object representation\n   * @static\n   * @param {Object} object Object to create an instance from\n   * @param {Function} callback Callback to invoke when an image instance is created\n   */\n  fabric.Image.fromObject = function(_object, callback) {\n    var object = fabric.util.object.clone(_object);\n    fabric.util.loadImage(object.src, function(img, isError) {\n      if (isError) {\n        callback && callback(null, true);\n        return;\n      }\n      fabric.Image.prototype._initFilters.call(object, object.filters, function(filters) {\n        object.filters = filters || [];\n        fabric.Image.prototype._initFilters.call(object, [object.resizeFilter], function(resizeFilters) {\n          object.resizeFilter = resizeFilters[0];\n          fabric.util.enlivenObjectEnlivables(object, object, function () {\n            var image = new fabric.Image(img, object);\n            callback(image, false);\n          });\n        });\n      });\n    }, null, object.crossOrigin);\n  };\n\n  /**\n   * Creates an instance of fabric.Image from an URL string\n   * @static\n   * @param {String} url URL to create an image from\n   * @param {Function} [callback] Callback to invoke when image is created (newly created image is passed as a first argument). Second argument is a boolean indicating if an error occurred or not.\n   * @param {Object} [imgOptions] Options object\n   */\n  fabric.Image.fromURL = function(url, callback, imgOptions) {\n    fabric.util.loadImage(url, function(img, isError) {\n      callback && callback(new fabric.Image(img, imgOptions), isError);\n    }, null, imgOptions && imgOptions.crossOrigin);\n  };\n\n  /* _FROM_SVG_START_ */\n  /**\n   * List of attribute names to account for when parsing SVG element (used by {@link fabric.Image.fromElement})\n   * @static\n   * @see {@link http://www.w3.org/TR/SVG/struct.html#ImageElement}\n   */\n  fabric.Image.ATTRIBUTE_NAMES =\n    fabric.SHARED_ATTRIBUTES.concat(\n      'x y width height preserveAspectRatio xlink:href crossOrigin image-rendering'.split(' ')\n    );\n\n  /**\n   * Returns {@link fabric.Image} instance from an SVG element\n   * @static\n   * @param {SVGElement} element Element to parse\n   * @param {Object} [options] Options object\n   * @param {Function} callback Callback to execute when fabric.Image object is created\n   * @return {fabric.Image} Instance of fabric.Image\n   */\n  fabric.Image.fromElement = function(element, callback, options) {\n    var parsedAttributes = fabric.parseAttributes(element, fabric.Image.ATTRIBUTE_NAMES);\n    fabric.Image.fromURL(parsedAttributes['xlink:href'], callback,\n      extend((options ? fabric.util.object.clone(options) : { }), parsedAttributes));\n  };\n  /* _FROM_SVG_END_ */\n\n})(typeof exports !== 'undefined' ? exports : this);\n\n\nfabric.util.object.extend(fabric.Object.prototype, /** @lends fabric.Object.prototype */ {\n\n  /**\n   * @private\n   * @return {Number} angle value\n   */\n  _getAngleValueForStraighten: function() {\n    var angle = this.angle % 360;\n    if (angle > 0) {\n      return Math.round((angle - 1) / 90) * 90;\n    }\n    return Math.round(angle / 90) * 90;\n  },\n\n  /**\n   * Straightens an object (rotating it from current angle to one of 0, 90, 180, 270, etc. depending on which is closer)\n   * @return {fabric.Object} thisArg\n   * @chainable\n   */\n  straighten: function() {\n    return this.rotate(this._getAngleValueForStraighten());\n  },\n\n  /**\n   * Same as {@link fabric.Object.prototype.straighten} but with animation\n   * @param {Object} callbacks Object with callback functions\n   * @param {Function} [callbacks.onComplete] Invoked on completion\n   * @param {Function} [callbacks.onChange] Invoked on every step of animation\n   * @return {fabric.Object} thisArg\n   */\n  fxStraighten: function(callbacks) {\n    callbacks = callbacks || { };\n\n    var empty = function() { },\n        onComplete = callbacks.onComplete || empty,\n        onChange = callbacks.onChange || empty,\n        _this = this;\n\n    return fabric.util.animate({\n      target: this,\n      startValue: this.get('angle'),\n      endValue: this._getAngleValueForStraighten(),\n      duration: this.FX_DURATION,\n      onChange: function(value) {\n        _this.rotate(value);\n        onChange();\n      },\n      onComplete: function() {\n        _this.setCoords();\n        onComplete();\n      },\n    });\n  }\n});\n\nfabric.util.object.extend(fabric.StaticCanvas.prototype, /** @lends fabric.StaticCanvas.prototype */ {\n\n  /**\n   * Straightens object, then rerenders canvas\n   * @param {fabric.Object} object Object to straighten\n   * @return {fabric.Canvas} thisArg\n   * @chainable\n   */\n  straightenObject: function (object) {\n    object.straighten();\n    this.requestRenderAll();\n    return this;\n  },\n\n  /**\n   * Same as {@link fabric.Canvas.prototype.straightenObject}, but animated\n   * @param {fabric.Object} object Object to straighten\n   * @return {fabric.Canvas} thisArg\n   */\n  fxStraightenObject: function (object) {\n    return object.fxStraighten({\n      onChange: this.requestRenderAllBound\n    });\n  }\n});\n\n\n(function() {\n\n  'use strict';\n\n  /**\n   * Tests if webgl supports certain precision\n   * @param {WebGL} Canvas WebGL context to test on\n   * @param {String} Precision to test can be any of following: 'lowp', 'mediump', 'highp'\n   * @returns {Boolean} Whether the user's browser WebGL supports given precision.\n   */\n  function testPrecision(gl, precision){\n    var fragmentSource = 'precision ' + precision + ' float;\\nvoid main(){}';\n    var fragmentShader = gl.createShader(gl.FRAGMENT_SHADER);\n    gl.shaderSource(fragmentShader, fragmentSource);\n    gl.compileShader(fragmentShader);\n    if (!gl.getShaderParameter(fragmentShader, gl.COMPILE_STATUS)) {\n      return false;\n    }\n    return true;\n  }\n\n  /**\n   * Indicate whether this filtering backend is supported by the user's browser.\n   * @param {Number} tileSize check if the tileSize is supported\n   * @returns {Boolean} Whether the user's browser supports WebGL.\n   */\n  fabric.isWebglSupported = function(tileSize) {\n    if (fabric.isLikelyNode) {\n      return false;\n    }\n    tileSize = tileSize || fabric.WebglFilterBackend.prototype.tileSize;\n    var canvas = document.createElement('canvas');\n    var gl = canvas.getContext('webgl') || canvas.getContext('experimental-webgl');\n    var isSupported = false;\n    // eslint-disable-next-line\n    if (gl) {\n      fabric.maxTextureSize = gl.getParameter(gl.MAX_TEXTURE_SIZE);\n      isSupported = fabric.maxTextureSize >= tileSize;\n      var precisions = ['highp', 'mediump', 'lowp'];\n      for (var i = 0; i < 3; i++){\n        if (testPrecision(gl, precisions[i])){\n          fabric.webGlPrecision = precisions[i];\n          break;\n        };\n      }\n    }\n    this.isSupported = isSupported;\n    return isSupported;\n  };\n\n  fabric.WebglFilterBackend = WebglFilterBackend;\n\n  /**\n   * WebGL filter backend.\n   */\n  function WebglFilterBackend(options) {\n    if (options && options.tileSize) {\n      this.tileSize = options.tileSize;\n    }\n    this.setupGLContext(this.tileSize, this.tileSize);\n    this.captureGPUInfo();\n  };\n\n  WebglFilterBackend.prototype = /** @lends fabric.WebglFilterBackend.prototype */ {\n\n    tileSize: 2048,\n\n    /**\n     * Experimental. This object is a sort of repository of help layers used to avoid\n     * of recreating them during frequent filtering. If you are previewing a filter with\n     * a slider you probably do not want to create help layers every filter step.\n     * in this object there will be appended some canvases, created once, resized sometimes\n     * cleared never. Clearing is left to the developer.\n     **/\n    resources: {\n\n    },\n\n    /**\n     * Setup a WebGL context suitable for filtering, and bind any needed event handlers.\n     */\n    setupGLContext: function(width, height) {\n      this.dispose();\n      this.createWebGLCanvas(width, height);\n      // eslint-disable-next-line\n      this.aPosition = new Float32Array([0, 0, 0, 1, 1, 0, 1, 1]);\n      this.chooseFastestCopyGLTo2DMethod(width, height);\n    },\n\n    /**\n     * Pick a method to copy data from GL context to 2d canvas.  In some browsers using\n     * putImageData is faster than drawImage for that specific operation.\n     */\n    chooseFastestCopyGLTo2DMethod: function(width, height) {\n      var canMeasurePerf = typeof window.performance !== 'undefined', canUseImageData;\n      try {\n        new ImageData(1, 1);\n        canUseImageData = true;\n      }\n      catch (e) {\n        canUseImageData = false;\n      }\n      // eslint-disable-next-line no-undef\n      var canUseArrayBuffer = typeof ArrayBuffer !== 'undefined';\n      // eslint-disable-next-line no-undef\n      var canUseUint8Clamped = typeof Uint8ClampedArray !== 'undefined';\n\n      if (!(canMeasurePerf && canUseImageData && canUseArrayBuffer && canUseUint8Clamped)) {\n        return;\n      }\n\n      var targetCanvas = fabric.util.createCanvasElement();\n      // eslint-disable-next-line no-undef\n      var imageBuffer = new ArrayBuffer(width * height * 4);\n      if (fabric.forceGLPutImageData) {\n        this.imageBuffer = imageBuffer;\n        this.copyGLTo2D = copyGLTo2DPutImageData;\n        return;\n      }\n      var testContext = {\n        imageBuffer: imageBuffer,\n        destinationWidth: width,\n        destinationHeight: height,\n        targetCanvas: targetCanvas\n      };\n      var startTime, drawImageTime, putImageDataTime;\n      targetCanvas.width = width;\n      targetCanvas.height = height;\n\n      startTime = window.performance.now();\n      copyGLTo2DDrawImage.call(testContext, this.gl, testContext);\n      drawImageTime = window.performance.now() - startTime;\n\n      startTime = window.performance.now();\n      copyGLTo2DPutImageData.call(testContext, this.gl, testContext);\n      putImageDataTime = window.performance.now() - startTime;\n\n      if (drawImageTime > putImageDataTime) {\n        this.imageBuffer = imageBuffer;\n        this.copyGLTo2D = copyGLTo2DPutImageData;\n      }\n      else {\n        this.copyGLTo2D = copyGLTo2DDrawImage;\n      }\n    },\n\n    /**\n     * Create a canvas element and associated WebGL context and attaches them as\n     * class properties to the GLFilterBackend class.\n     */\n    createWebGLCanvas: function(width, height) {\n      var canvas = fabric.util.createCanvasElement();\n      canvas.width = width;\n      canvas.height = height;\n      var glOptions = {\n            alpha: true,\n            premultipliedAlpha: false,\n            depth: false,\n            stencil: false,\n            antialias: false\n          },\n          gl = canvas.getContext('webgl', glOptions);\n      if (!gl) {\n        gl = canvas.getContext('experimental-webgl', glOptions);\n      }\n      if (!gl) {\n        return;\n      }\n      gl.clearColor(0, 0, 0, 0);\n      // this canvas can fire webglcontextlost and webglcontextrestored\n      this.canvas = canvas;\n      this.gl = gl;\n    },\n\n    /**\n     * Attempts to apply the requested filters to the source provided, drawing the filtered output\n     * to the provided target canvas.\n     *\n     * @param {Array} filters The filters to apply.\n     * @param {HTMLImageElement|HTMLCanvasElement} source The source to be filtered.\n     * @param {Number} width The width of the source input.\n     * @param {Number} height The height of the source input.\n     * @param {HTMLCanvasElement} targetCanvas The destination for filtered output to be drawn.\n     * @param {String|undefined} cacheKey A key used to cache resources related to the source. If\n     * omitted, caching will be skipped.\n     */\n    applyFilters: function(filters, source, width, height, targetCanvas, cacheKey) {\n      var gl = this.gl;\n      var cachedTexture;\n      if (cacheKey) {\n        cachedTexture = this.getCachedTexture(cacheKey, source);\n      }\n      var pipelineState = {\n        originalWidth: source.width || source.originalWidth,\n        originalHeight: source.height || source.originalHeight,\n        sourceWidth: width,\n        sourceHeight: height,\n        destinationWidth: width,\n        destinationHeight: height,\n        context: gl,\n        sourceTexture: this.createTexture(gl, width, height, !cachedTexture && source),\n        targetTexture: this.createTexture(gl, width, height),\n        originalTexture: cachedTexture ||\n          this.createTexture(gl, width, height, !cachedTexture && source),\n        passes: filters.length,\n        webgl: true,\n        aPosition: this.aPosition,\n        programCache: this.programCache,\n        pass: 0,\n        filterBackend: this,\n        targetCanvas: targetCanvas\n      };\n      var tempFbo = gl.createFramebuffer();\n      gl.bindFramebuffer(gl.FRAMEBUFFER, tempFbo);\n      filters.forEach(function(filter) { filter && filter.applyTo(pipelineState); });\n      resizeCanvasIfNeeded(pipelineState);\n      this.copyGLTo2D(gl, pipelineState);\n      gl.bindTexture(gl.TEXTURE_2D, null);\n      gl.deleteTexture(pipelineState.sourceTexture);\n      gl.deleteTexture(pipelineState.targetTexture);\n      gl.deleteFramebuffer(tempFbo);\n      targetCanvas.getContext('2d').setTransform(1, 0, 0, 1, 0, 0);\n      return pipelineState;\n    },\n\n    /**\n     * Detach event listeners, remove references, and clean up caches.\n     */\n    dispose: function() {\n      if (this.canvas) {\n        this.canvas = null;\n        this.gl = null;\n      }\n      this.clearWebGLCaches();\n    },\n\n    /**\n     * Wipe out WebGL-related caches.\n     */\n    clearWebGLCaches: function() {\n      this.programCache = {};\n      this.textureCache = {};\n    },\n\n    /**\n     * Create a WebGL texture object.\n     *\n     * Accepts specific dimensions to initialize the texture to or a source image.\n     *\n     * @param {WebGLRenderingContext} gl The GL context to use for creating the texture.\n     * @param {Number} width The width to initialize the texture at.\n     * @param {Number} height The height to initialize the texture.\n     * @param {HTMLImageElement|HTMLCanvasElement} textureImageSource A source for the texture data.\n     * @returns {WebGLTexture}\n     */\n    createTexture: function(gl, width, height, textureImageSource) {\n      var texture = gl.createTexture();\n      gl.bindTexture(gl.TEXTURE_2D, texture);\n      gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MAG_FILTER, gl.NEAREST);\n      gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MIN_FILTER, gl.NEAREST);\n      gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_S, gl.CLAMP_TO_EDGE);\n      gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_T, gl.CLAMP_TO_EDGE);\n      if (textureImageSource) {\n        gl.texImage2D(gl.TEXTURE_2D, 0, gl.RGBA, gl.RGBA, gl.UNSIGNED_BYTE, textureImageSource);\n      }\n      else {\n        gl.texImage2D(gl.TEXTURE_2D, 0, gl.RGBA, width, height, 0, gl.RGBA, gl.UNSIGNED_BYTE, null);\n      }\n      return texture;\n    },\n\n    /**\n     * Can be optionally used to get a texture from the cache array\n     *\n     * If an existing texture is not found, a new texture is created and cached.\n     *\n     * @param {String} uniqueId A cache key to use to find an existing texture.\n     * @param {HTMLImageElement|HTMLCanvasElement} textureImageSource A source to use to create the\n     * texture cache entry if one does not already exist.\n     */\n    getCachedTexture: function(uniqueId, textureImageSource) {\n      if (this.textureCache[uniqueId]) {\n        return this.textureCache[uniqueId];\n      }\n      else {\n        var texture = this.createTexture(\n          this.gl, textureImageSource.width, textureImageSource.height, textureImageSource);\n        this.textureCache[uniqueId] = texture;\n        return texture;\n      }\n    },\n\n    /**\n     * Clear out cached resources related to a source image that has been\n     * filtered previously.\n     *\n     * @param {String} cacheKey The cache key provided when the source image was filtered.\n     */\n    evictCachesForKey: function(cacheKey) {\n      if (this.textureCache[cacheKey]) {\n        this.gl.deleteTexture(this.textureCache[cacheKey]);\n        delete this.textureCache[cacheKey];\n      }\n    },\n\n    copyGLTo2D: copyGLTo2DDrawImage,\n\n    /**\n     * Attempt to extract GPU information strings from a WebGL context.\n     *\n     * Useful information when debugging or blacklisting specific GPUs.\n     *\n     * @returns {Object} A GPU info object with renderer and vendor strings.\n     */\n    captureGPUInfo: function() {\n      if (this.gpuInfo) {\n        return this.gpuInfo;\n      }\n      var gl = this.gl, gpuInfo = { renderer: '', vendor: '' };\n      if (!gl) {\n        return gpuInfo;\n      }\n      var ext = gl.getExtension('WEBGL_debug_renderer_info');\n      if (ext) {\n        var renderer = gl.getParameter(ext.UNMASKED_RENDERER_WEBGL);\n        var vendor = gl.getParameter(ext.UNMASKED_VENDOR_WEBGL);\n        if (renderer) {\n          gpuInfo.renderer = renderer.toLowerCase();\n        }\n        if (vendor) {\n          gpuInfo.vendor = vendor.toLowerCase();\n        }\n      }\n      this.gpuInfo = gpuInfo;\n      return gpuInfo;\n    },\n  };\n})();\n\nfunction resizeCanvasIfNeeded(pipelineState) {\n  var targetCanvas = pipelineState.targetCanvas,\n      width = targetCanvas.width, height = targetCanvas.height,\n      dWidth = pipelineState.destinationWidth,\n      dHeight = pipelineState.destinationHeight;\n\n  if (width !== dWidth || height !== dHeight) {\n    targetCanvas.width = dWidth;\n    targetCanvas.height = dHeight;\n  }\n}\n\n/**\n * Copy an input WebGL canvas on to an output 2D canvas.\n *\n * The WebGL canvas is assumed to be upside down, with the top-left pixel of the\n * desired output image appearing in the bottom-left corner of the WebGL canvas.\n *\n * @param {WebGLRenderingContext} sourceContext The WebGL context to copy from.\n * @param {HTMLCanvasElement} targetCanvas The 2D target canvas to copy on to.\n * @param {Object} pipelineState The 2D target canvas to copy on to.\n */\nfunction copyGLTo2DDrawImage(gl, pipelineState) {\n  var glCanvas = gl.canvas, targetCanvas = pipelineState.targetCanvas,\n      ctx = targetCanvas.getContext('2d');\n  ctx.translate(0, targetCanvas.height); // move it down again\n  ctx.scale(1, -1); // vertical flip\n  // where is my image on the big glcanvas?\n  var sourceY = glCanvas.height - targetCanvas.height;\n  ctx.drawImage(glCanvas, 0, sourceY, targetCanvas.width, targetCanvas.height, 0, 0,\n    targetCanvas.width, targetCanvas.height);\n}\n\n/**\n * Copy an input WebGL canvas on to an output 2D canvas using 2d canvas' putImageData\n * API. Measurably faster than using ctx.drawImage in Firefox (version 54 on OSX Sierra).\n *\n * @param {WebGLRenderingContext} sourceContext The WebGL context to copy from.\n * @param {HTMLCanvasElement} targetCanvas The 2D target canvas to copy on to.\n * @param {Object} pipelineState The 2D target canvas to copy on to.\n */\nfunction copyGLTo2DPutImageData(gl, pipelineState) {\n  var targetCanvas = pipelineState.targetCanvas, ctx = targetCanvas.getContext('2d'),\n      dWidth = pipelineState.destinationWidth,\n      dHeight = pipelineState.destinationHeight,\n      numBytes = dWidth * dHeight * 4;\n\n  // eslint-disable-next-line no-undef\n  var u8 = new Uint8Array(this.imageBuffer, 0, numBytes);\n  // eslint-disable-next-line no-undef\n  var u8Clamped = new Uint8ClampedArray(this.imageBuffer, 0, numBytes);\n\n  gl.readPixels(0, 0, dWidth, dHeight, gl.RGBA, gl.UNSIGNED_BYTE, u8);\n  var imgData = new ImageData(u8Clamped, dWidth, dHeight);\n  ctx.putImageData(imgData, 0, 0);\n}\n\n\n(function() {\n\n  'use strict';\n\n  var noop = function() {};\n\n  fabric.Canvas2dFilterBackend = Canvas2dFilterBackend;\n\n  /**\n   * Canvas 2D filter backend.\n   */\n  function Canvas2dFilterBackend() {};\n\n  Canvas2dFilterBackend.prototype = /** @lends fabric.Canvas2dFilterBackend.prototype */ {\n    evictCachesForKey: noop,\n    dispose: noop,\n    clearWebGLCaches: noop,\n\n    /**\n     * Experimental. This object is a sort of repository of help layers used to avoid\n     * of recreating them during frequent filtering. If you are previewing a filter with\n     * a slider you probably do not want to create help layers every filter step.\n     * in this object there will be appended some canvases, created once, resized sometimes\n     * cleared never. Clearing is left to the developer.\n     **/\n    resources: {\n\n    },\n\n    /**\n     * Apply a set of filters against a source image and draw the filtered output\n     * to the provided destination canvas.\n     *\n     * @param {EnhancedFilter} filters The filter to apply.\n     * @param {HTMLImageElement|HTMLCanvasElement} sourceElement The source to be filtered.\n     * @param {Number} sourceWidth The width of the source input.\n     * @param {Number} sourceHeight The height of the source input.\n     * @param {HTMLCanvasElement} targetCanvas The destination for filtered output to be drawn.\n     */\n    applyFilters: function(filters, sourceElement, sourceWidth, sourceHeight, targetCanvas) {\n      var ctx = targetCanvas.getContext('2d');\n      ctx.drawImage(sourceElement, 0, 0, sourceWidth, sourceHeight);\n      var imageData = ctx.getImageData(0, 0, sourceWidth, sourceHeight);\n      var originalImageData = ctx.getImageData(0, 0, sourceWidth, sourceHeight);\n      var pipelineState = {\n        sourceWidth: sourceWidth,\n        sourceHeight: sourceHeight,\n        imageData: imageData,\n        originalEl: sourceElement,\n        originalImageData: originalImageData,\n        canvasEl: targetCanvas,\n        ctx: ctx,\n        filterBackend: this,\n      };\n      filters.forEach(function(filter) { filter.applyTo(pipelineState); });\n      if (pipelineState.imageData.width !== sourceWidth || pipelineState.imageData.height !== sourceHeight) {\n        targetCanvas.width = pipelineState.imageData.width;\n        targetCanvas.height = pipelineState.imageData.height;\n      }\n      ctx.putImageData(pipelineState.imageData, 0, 0);\n      return pipelineState;\n    },\n\n  };\n})();\n\n\n/**\n * @namespace fabric.Image.filters\n * @memberOf fabric.Image\n * @tutorial {@link http://fabricjs.com/fabric-intro-part-2#image_filters}\n * @see {@link http://fabricjs.com/image-filters|ImageFilters demo}\n */\nfabric.Image = fabric.Image || { };\nfabric.Image.filters = fabric.Image.filters || { };\n\n/**\n * Root filter class from which all filter classes inherit from\n * @class fabric.Image.filters.BaseFilter\n * @memberOf fabric.Image.filters\n */\nfabric.Image.filters.BaseFilter = fabric.util.createClass(/** @lends fabric.Image.filters.BaseFilter.prototype */ {\n\n  /**\n   * Filter type\n   * @param {String} type\n   * @default\n   */\n  type: 'BaseFilter',\n\n  /**\n   * Array of attributes to send with buffers. do not modify\n   * @private\n   */\n\n  vertexSource: 'attribute vec2 aPosition;\\n' +\n    'varying vec2 vTexCoord;\\n' +\n    'void main() {\\n' +\n      'vTexCoord = aPosition;\\n' +\n      'gl_Position = vec4(aPosition * 2.0 - 1.0, 0.0, 1.0);\\n' +\n    '}',\n\n  fragmentSource: 'precision highp float;\\n' +\n    'varying vec2 vTexCoord;\\n' +\n    'uniform sampler2D uTexture;\\n' +\n    'void main() {\\n' +\n      'gl_FragColor = texture2D(uTexture, vTexCoord);\\n' +\n    '}',\n\n  /**\n   * Constructor\n   * @param {Object} [options] Options object\n   */\n  initialize: function(options) {\n    if (options) {\n      this.setOptions(options);\n    }\n  },\n\n  /**\n   * Sets filter's properties from options\n   * @param {Object} [options] Options object\n   */\n  setOptions: function(options) {\n    for (var prop in options) {\n      this[prop] = options[prop];\n    }\n  },\n\n  /**\n   * Compile this filter's shader program.\n   *\n   * @param {WebGLRenderingContext} gl The GL canvas context to use for shader compilation.\n   * @param {String} fragmentSource fragmentShader source for compilation\n   * @param {String} vertexSource vertexShader source for compilation\n   */\n  createProgram: function(gl, fragmentSource, vertexSource) {\n    fragmentSource = fragmentSource || this.fragmentSource;\n    vertexSource = vertexSource || this.vertexSource;\n    if (fabric.webGlPrecision !== 'highp'){\n      fragmentSource = fragmentSource.replace(\n        /precision highp float/g,\n        'precision ' + fabric.webGlPrecision + ' float'\n      );\n    }\n    var vertexShader = gl.createShader(gl.VERTEX_SHADER);\n    gl.shaderSource(vertexShader, vertexSource);\n    gl.compileShader(vertexShader);\n    if (!gl.getShaderParameter(vertexShader, gl.COMPILE_STATUS)) {\n      throw new Error(\n        // eslint-disable-next-line prefer-template\n        'Vertex shader compile error for ' + this.type + ': ' +\n        gl.getShaderInfoLog(vertexShader)\n      );\n    }\n\n    var fragmentShader = gl.createShader(gl.FRAGMENT_SHADER);\n    gl.shaderSource(fragmentShader, fragmentSource);\n    gl.compileShader(fragmentShader);\n    if (!gl.getShaderParameter(fragmentShader, gl.COMPILE_STATUS)) {\n      throw new Error(\n        // eslint-disable-next-line prefer-template\n        'Fragment shader compile error for ' + this.type + ': ' +\n        gl.getShaderInfoLog(fragmentShader)\n      );\n    }\n\n    var program = gl.createProgram();\n    gl.attachShader(program, vertexShader);\n    gl.attachShader(program, fragmentShader);\n    gl.linkProgram(program);\n    if (!gl.getProgramParameter(program, gl.LINK_STATUS)) {\n      throw new Error(\n        // eslint-disable-next-line prefer-template\n        'Shader link error for \"${this.type}\" ' +\n        gl.getProgramInfoLog(program)\n      );\n    }\n\n    var attributeLocations = this.getAttributeLocations(gl, program);\n    var uniformLocations = this.getUniformLocations(gl, program) || { };\n    uniformLocations.uStepW = gl.getUniformLocation(program, 'uStepW');\n    uniformLocations.uStepH = gl.getUniformLocation(program, 'uStepH');\n    return {\n      program: program,\n      attributeLocations: attributeLocations,\n      uniformLocations: uniformLocations\n    };\n  },\n\n  /**\n   * Return a map of attribute names to WebGLAttributeLocation objects.\n   *\n   * @param {WebGLRenderingContext} gl The canvas context used to compile the shader program.\n   * @param {WebGLShaderProgram} program The shader program from which to take attribute locations.\n   * @returns {Object} A map of attribute names to attribute locations.\n   */\n  getAttributeLocations: function(gl, program) {\n    return {\n      aPosition: gl.getAttribLocation(program, 'aPosition'),\n    };\n  },\n\n  /**\n   * Return a map of uniform names to WebGLUniformLocation objects.\n   *\n   * Intended to be overridden by subclasses.\n   *\n   * @param {WebGLRenderingContext} gl The canvas context used to compile the shader program.\n   * @param {WebGLShaderProgram} program The shader program from which to take uniform locations.\n   * @returns {Object} A map of uniform names to uniform locations.\n   */\n  getUniformLocations: function (/* gl, program */) {\n    // in case i do not need any special uniform i need to return an empty object\n    return { };\n  },\n\n  /**\n   * Send attribute data from this filter to its shader program on the GPU.\n   *\n   * @param {WebGLRenderingContext} gl The canvas context used to compile the shader program.\n   * @param {Object} attributeLocations A map of shader attribute names to their locations.\n   */\n  sendAttributeData: function(gl, attributeLocations, aPositionData) {\n    var attributeLocation = attributeLocations.aPosition;\n    var buffer = gl.createBuffer();\n    gl.bindBuffer(gl.ARRAY_BUFFER, buffer);\n    gl.enableVertexAttribArray(attributeLocation);\n    gl.vertexAttribPointer(attributeLocation, 2, gl.FLOAT, false, 0, 0);\n    gl.bufferData(gl.ARRAY_BUFFER, aPositionData, gl.STATIC_DRAW);\n  },\n\n  _setupFrameBuffer: function(options) {\n    var gl = options.context, width, height;\n    if (options.passes > 1) {\n      width = options.destinationWidth;\n      height = options.destinationHeight;\n      if (options.sourceWidth !== width || options.sourceHeight !== height) {\n        gl.deleteTexture(options.targetTexture);\n        options.targetTexture = options.filterBackend.createTexture(gl, width, height);\n      }\n      gl.framebufferTexture2D(gl.FRAMEBUFFER, gl.COLOR_ATTACHMENT0, gl.TEXTURE_2D,\n        options.targetTexture, 0);\n    }\n    else {\n      // draw last filter on canvas and not to framebuffer.\n      gl.bindFramebuffer(gl.FRAMEBUFFER, null);\n      gl.finish();\n    }\n  },\n\n  _swapTextures: function(options) {\n    options.passes--;\n    options.pass++;\n    var temp = options.targetTexture;\n    options.targetTexture = options.sourceTexture;\n    options.sourceTexture = temp;\n  },\n\n  /**\n   * Generic isNeutral implementation for one parameter based filters.\n   * Used only in image applyFilters to discard filters that will not have an effect\n   * on the image\n   * Other filters may need their own version ( ColorMatrix, HueRotation, gamma, ComposedFilter )\n   * @param {Object} options\n   **/\n  isNeutralState: function(/* options */) {\n    var main = this.mainParameter,\n        _class = fabric.Image.filters[this.type].prototype;\n    if (main) {\n      if (Array.isArray(_class[main])) {\n        for (var i = _class[main].length; i--;) {\n          if (this[main][i] !== _class[main][i]) {\n            return false;\n          }\n        }\n        return true;\n      }\n      else {\n        return _class[main] === this[main];\n      }\n    }\n    else {\n      return false;\n    }\n  },\n\n  /**\n   * Apply this filter to the input image data provided.\n   *\n   * Determines whether to use WebGL or Canvas2D based on the options.webgl flag.\n   *\n   * @param {Object} options\n   * @param {Number} options.passes The number of filters remaining to be executed\n   * @param {Boolean} options.webgl Whether to use webgl to render the filter.\n   * @param {WebGLTexture} options.sourceTexture The texture setup as the source to be filtered.\n   * @param {WebGLTexture} options.targetTexture The texture where filtered output should be drawn.\n   * @param {WebGLRenderingContext} options.context The GL context used for rendering.\n   * @param {Object} options.programCache A map of compiled shader programs, keyed by filter type.\n   */\n  applyTo: function(options) {\n    if (options.webgl) {\n      this._setupFrameBuffer(options);\n      this.applyToWebGL(options);\n      this._swapTextures(options);\n    }\n    else {\n      this.applyTo2d(options);\n    }\n  },\n\n  /**\n   * Retrieves the cached shader.\n   * @param {Object} options\n   * @param {WebGLRenderingContext} options.context The GL context used for rendering.\n   * @param {Object} options.programCache A map of compiled shader programs, keyed by filter type.\n   */\n  retrieveShader: function(options) {\n    if (!options.programCache.hasOwnProperty(this.type)) {\n      options.programCache[this.type] = this.createProgram(options.context);\n    }\n    return options.programCache[this.type];\n  },\n\n  /**\n   * Apply this filter using webgl.\n   *\n   * @param {Object} options\n   * @param {Number} options.passes The number of filters remaining to be executed\n   * @param {Boolean} options.webgl Whether to use webgl to render the filter.\n   * @param {WebGLTexture} options.originalTexture The texture of the original input image.\n   * @param {WebGLTexture} options.sourceTexture The texture setup as the source to be filtered.\n   * @param {WebGLTexture} options.targetTexture The texture where filtered output should be drawn.\n   * @param {WebGLRenderingContext} options.context The GL context used for rendering.\n   * @param {Object} options.programCache A map of compiled shader programs, keyed by filter type.\n   */\n  applyToWebGL: function(options) {\n    var gl = options.context;\n    var shader = this.retrieveShader(options);\n    if (options.pass === 0 && options.originalTexture) {\n      gl.bindTexture(gl.TEXTURE_2D, options.originalTexture);\n    }\n    else {\n      gl.bindTexture(gl.TEXTURE_2D, options.sourceTexture);\n    }\n    gl.useProgram(shader.program);\n    this.sendAttributeData(gl, shader.attributeLocations, options.aPosition);\n\n    gl.uniform1f(shader.uniformLocations.uStepW, 1 / options.sourceWidth);\n    gl.uniform1f(shader.uniformLocations.uStepH, 1 / options.sourceHeight);\n\n    this.sendUniformData(gl, shader.uniformLocations);\n    gl.viewport(0, 0, options.destinationWidth, options.destinationHeight);\n    gl.drawArrays(gl.TRIANGLE_STRIP, 0, 4);\n  },\n\n  bindAdditionalTexture: function(gl, texture, textureUnit) {\n    gl.activeTexture(textureUnit);\n    gl.bindTexture(gl.TEXTURE_2D, texture);\n    // reset active texture to 0 as usual\n    gl.activeTexture(gl.TEXTURE0);\n  },\n\n  unbindAdditionalTexture: function(gl, textureUnit) {\n    gl.activeTexture(textureUnit);\n    gl.bindTexture(gl.TEXTURE_2D, null);\n    gl.activeTexture(gl.TEXTURE0);\n  },\n\n  getMainParameter: function() {\n    return this[this.mainParameter];\n  },\n\n  setMainParameter: function(value) {\n    this[this.mainParameter] = value;\n  },\n\n  /**\n   * Send uniform data from this filter to its shader program on the GPU.\n   *\n   * Intended to be overridden by subclasses.\n   *\n   * @param {WebGLRenderingContext} gl The canvas context used to compile the shader program.\n   * @param {Object} uniformLocations A map of shader uniform names to their locations.\n   */\n  sendUniformData: function(/* gl, uniformLocations */) {\n    // Intentionally left blank.  Override me in subclasses.\n  },\n\n  /**\n   * If needed by a 2d filter, this functions can create an helper canvas to be used\n   * remember that options.targetCanvas is available for use till end of chain.\n   */\n  createHelpLayer: function(options) {\n    if (!options.helpLayer) {\n      var helpLayer = document.createElement('canvas');\n      helpLayer.width = options.sourceWidth;\n      helpLayer.height = options.sourceHeight;\n      options.helpLayer = helpLayer;\n    }\n  },\n\n  /**\n   * Returns object representation of an instance\n   * @return {Object} Object representation of an instance\n   */\n  toObject: function() {\n    var object = { type: this.type }, mainP = this.mainParameter;\n    if (mainP) {\n      object[mainP] = this[mainP];\n    }\n    return object;\n  },\n\n  /**\n   * Returns a JSON representation of an instance\n   * @return {Object} JSON\n   */\n  toJSON: function() {\n    // delegate, not alias\n    return this.toObject();\n  }\n});\n\nfabric.Image.filters.BaseFilter.fromObject = function(object, callback) {\n  var filter = new fabric.Image.filters[object.type](object);\n  callback && callback(filter);\n  return filter;\n};\n\n\n(function(global) {\n\n  'use strict';\n\n  var fabric  = global.fabric || (global.fabric = { }),\n      filters = fabric.Image.filters,\n      createClass = fabric.util.createClass;\n\n  /**\n   * Color Matrix filter class\n   * @class fabric.Image.filters.ColorMatrix\n   * @memberOf fabric.Image.filters\n   * @extends fabric.Image.filters.BaseFilter\n   * @see {@link fabric.Image.filters.ColorMatrix#initialize} for constructor definition\n   * @see {@link http://fabricjs.com/image-filters|ImageFilters demo}\n   * @see {@Link http://www.webwasp.co.uk/tutorials/219/Color_Matrix_Filter.php}\n   * @see {@Link http://phoboslab.org/log/2013/11/fast-image-filters-with-webgl}\n   * @example <caption>Kodachrome filter</caption>\n   * var filter = new fabric.Image.filters.ColorMatrix({\n   *  matrix: [\n       1.1285582396593525, -0.3967382283601348, -0.03992559172921793, 0, 63.72958762196502,\n       -0.16404339962244616, 1.0835251566291304, -0.05498805115633132, 0, 24.732407896706203,\n       -0.16786010706155763, -0.5603416277695248, 1.6014850761964943, 0, 35.62982807460946,\n       0, 0, 0, 1, 0\n      ]\n   * });\n   * object.filters.push(filter);\n   * object.applyFilters();\n   */\n  filters.ColorMatrix = createClass(filters.BaseFilter, /** @lends fabric.Image.filters.ColorMatrix.prototype */ {\n\n    /**\n     * Filter type\n     * @param {String} type\n     * @default\n     */\n    type: 'ColorMatrix',\n\n    fragmentSource: 'precision highp float;\\n' +\n      'uniform sampler2D uTexture;\\n' +\n      'varying vec2 vTexCoord;\\n' +\n      'uniform mat4 uColorMatrix;\\n' +\n      'uniform vec4 uConstants;\\n' +\n      'void main() {\\n' +\n        'vec4 color = texture2D(uTexture, vTexCoord);\\n' +\n        'color *= uColorMatrix;\\n' +\n        'color += uConstants;\\n' +\n        'gl_FragColor = color;\\n' +\n      '}',\n\n    /**\n     * Colormatrix for pixels.\n     * array of 20 floats. Numbers in positions 4, 9, 14, 19 loose meaning\n     * outside the -1, 1 range.\n     * 0.0039215686 is the part of 1 that get translated to 1 in 2d\n     * @param {Array} matrix array of 20 numbers.\n     * @default\n     */\n    matrix: [\n      1, 0, 0, 0, 0,\n      0, 1, 0, 0, 0,\n      0, 0, 1, 0, 0,\n      0, 0, 0, 1, 0\n    ],\n\n    mainParameter: 'matrix',\n\n    /**\n     * Lock the colormatrix on the color part, skipping alpha, mainly for non webgl scenario\n     * to save some calculation\n     * @type Boolean\n     * @default true\n     */\n    colorsOnly: true,\n\n    /**\n     * Constructor\n     * @param {Object} [options] Options object\n     */\n    initialize: function(options) {\n      this.callSuper('initialize', options);\n      // create a new array instead mutating the prototype with push\n      this.matrix = this.matrix.slice(0);\n    },\n\n    /**\n     * Apply the ColorMatrix operation to a Uint8Array representing the pixels of an image.\n     *\n     * @param {Object} options\n     * @param {ImageData} options.imageData The Uint8Array to be filtered.\n     */\n    applyTo2d: function(options) {\n      var imageData = options.imageData,\n          data = imageData.data,\n          iLen = data.length,\n          m = this.matrix,\n          r, g, b, a, i, colorsOnly = this.colorsOnly;\n\n      for (i = 0; i < iLen; i += 4) {\n        r = data[i];\n        g = data[i + 1];\n        b = data[i + 2];\n        if (colorsOnly) {\n          data[i] = r * m[0] + g * m[1] + b * m[2] + m[4] * 255;\n          data[i + 1] = r * m[5] + g * m[6] + b * m[7] + m[9] * 255;\n          data[i + 2] = r * m[10] + g * m[11] + b * m[12] + m[14] * 255;\n        }\n        else {\n          a = data[i + 3];\n          data[i] = r * m[0] + g * m[1] + b * m[2] + a * m[3] + m[4] * 255;\n          data[i + 1] = r * m[5] + g * m[6] + b * m[7] + a * m[8] + m[9] * 255;\n          data[i + 2] = r * m[10] + g * m[11] + b * m[12] + a * m[13] + m[14] * 255;\n          data[i + 3] = r * m[15] + g * m[16] + b * m[17] + a * m[18] + m[19] * 255;\n        }\n      }\n    },\n\n    /**\n     * Return WebGL uniform locations for this filter's shader.\n     *\n     * @param {WebGLRenderingContext} gl The GL canvas context used to compile this filter's shader.\n     * @param {WebGLShaderProgram} program This filter's compiled shader program.\n     */\n    getUniformLocations: function(gl, program) {\n      return {\n        uColorMatrix: gl.getUniformLocation(program, 'uColorMatrix'),\n        uConstants: gl.getUniformLocation(program, 'uConstants'),\n      };\n    },\n\n    /**\n     * Send data from this filter to its shader program's uniforms.\n     *\n     * @param {WebGLRenderingContext} gl The GL canvas context used to compile this filter's shader.\n     * @param {Object} uniformLocations A map of string uniform names to WebGLUniformLocation objects\n     */\n    sendUniformData: function(gl, uniformLocations) {\n      var m = this.matrix,\n          matrix = [\n            m[0], m[1], m[2], m[3],\n            m[5], m[6], m[7], m[8],\n            m[10], m[11], m[12], m[13],\n            m[15], m[16], m[17], m[18]\n          ],\n          constants = [m[4], m[9], m[14], m[19]];\n      gl.uniformMatrix4fv(uniformLocations.uColorMatrix, false, matrix);\n      gl.uniform4fv(uniformLocations.uConstants, constants);\n    },\n  });\n\n  /**\n   * Returns filter instance from an object representation\n   * @static\n   * @param {Object} object Object to create an instance from\n   * @param {function} [callback] function to invoke after filter creation\n   * @return {fabric.Image.filters.ColorMatrix} Instance of fabric.Image.filters.ColorMatrix\n   */\n  fabric.Image.filters.ColorMatrix.fromObject = fabric.Image.filters.BaseFilter.fromObject;\n})(typeof exports !== 'undefined' ? exports : this);\n\n\n(function(global) {\n\n  'use strict';\n\n  var fabric  = global.fabric || (global.fabric = { }),\n      filters = fabric.Image.filters,\n      createClass = fabric.util.createClass;\n\n  /**\n   * Brightness filter class\n   * @class fabric.Image.filters.Brightness\n   * @memberOf fabric.Image.filters\n   * @extends fabric.Image.filters.BaseFilter\n   * @see {@link fabric.Image.filters.Brightness#initialize} for constructor definition\n   * @see {@link http://fabricjs.com/image-filters|ImageFilters demo}\n   * @example\n   * var filter = new fabric.Image.filters.Brightness({\n   *   brightness: 0.05\n   * });\n   * object.filters.push(filter);\n   * object.applyFilters();\n   */\n  filters.Brightness = createClass(filters.BaseFilter, /** @lends fabric.Image.filters.Brightness.prototype */ {\n\n    /**\n     * Filter type\n     * @param {String} type\n     * @default\n     */\n    type: 'Brightness',\n\n    /**\n     * Fragment source for the brightness program\n     */\n    fragmentSource: 'precision highp float;\\n' +\n      'uniform sampler2D uTexture;\\n' +\n      'uniform float uBrightness;\\n' +\n      'varying vec2 vTexCoord;\\n' +\n      'void main() {\\n' +\n        'vec4 color = texture2D(uTexture, vTexCoord);\\n' +\n        'color.rgb += uBrightness;\\n' +\n        'gl_FragColor = color;\\n' +\n      '}',\n\n    /**\n     * Brightness value, from -1 to 1.\n     * translated to -255 to 255 for 2d\n     * 0.0039215686 is the part of 1 that get translated to 1 in 2d\n     * @param {Number} brightness\n     * @default\n     */\n    brightness: 0,\n\n    /**\n     * Describe the property that is the filter parameter\n     * @param {String} m\n     * @default\n     */\n    mainParameter: 'brightness',\n\n    /**\n    * Apply the Brightness operation to a Uint8ClampedArray representing the pixels of an image.\n    *\n    * @param {Object} options\n    * @param {ImageData} options.imageData The Uint8ClampedArray to be filtered.\n    */\n    applyTo2d: function(options) {\n      if (this.brightness === 0) {\n        return;\n      }\n      var imageData = options.imageData,\n          data = imageData.data, i, len = data.length,\n          brightness = Math.round(this.brightness * 255);\n      for (i = 0; i < len; i += 4) {\n        data[i] = data[i] + brightness;\n        data[i + 1] = data[i + 1] + brightness;\n        data[i + 2] = data[i + 2] + brightness;\n      }\n    },\n\n    /**\n     * Return WebGL uniform locations for this filter's shader.\n     *\n     * @param {WebGLRenderingContext} gl The GL canvas context used to compile this filter's shader.\n     * @param {WebGLShaderProgram} program This filter's compiled shader program.\n     */\n    getUniformLocations: function(gl, program) {\n      return {\n        uBrightness: gl.getUniformLocation(program, 'uBrightness'),\n      };\n    },\n\n    /**\n     * Send data from this filter to its shader program's uniforms.\n     *\n     * @param {WebGLRenderingContext} gl The GL canvas context used to compile this filter's shader.\n     * @param {Object} uniformLocations A map of string uniform names to WebGLUniformLocation objects\n     */\n    sendUniformData: function(gl, uniformLocations) {\n      gl.uniform1f(uniformLocations.uBrightness, this.brightness);\n    },\n  });\n\n  /**\n   * Returns filter instance from an object representation\n   * @static\n   * @param {Object} object Object to create an instance from\n   * @param {function} [callback] to be invoked after filter creation\n   * @return {fabric.Image.filters.Brightness} Instance of fabric.Image.filters.Brightness\n   */\n  fabric.Image.filters.Brightness.fromObject = fabric.Image.filters.BaseFilter.fromObject;\n\n})(typeof exports !== 'undefined' ? exports : this);\n\n\n(function(global) {\n\n  'use strict';\n\n  var fabric  = global.fabric || (global.fabric = { }),\n      extend = fabric.util.object.extend,\n      filters = fabric.Image.filters,\n      createClass = fabric.util.createClass;\n\n  /**\n   * Adapted from <a href=\"http://www.html5rocks.com/en/tutorials/canvas/imagefilters/\">html5rocks article</a>\n   * @class fabric.Image.filters.Convolute\n   * @memberOf fabric.Image.filters\n   * @extends fabric.Image.filters.BaseFilter\n   * @see {@link fabric.Image.filters.Convolute#initialize} for constructor definition\n   * @see {@link http://fabricjs.com/image-filters|ImageFilters demo}\n   * @example <caption>Sharpen filter</caption>\n   * var filter = new fabric.Image.filters.Convolute({\n   *   matrix: [ 0, -1,  0,\n   *            -1,  5, -1,\n   *             0, -1,  0 ]\n   * });\n   * object.filters.push(filter);\n   * object.applyFilters();\n   * canvas.renderAll();\n   * @example <caption>Blur filter</caption>\n   * var filter = new fabric.Image.filters.Convolute({\n   *   matrix: [ 1/9, 1/9, 1/9,\n   *             1/9, 1/9, 1/9,\n   *             1/9, 1/9, 1/9 ]\n   * });\n   * object.filters.push(filter);\n   * object.applyFilters();\n   * canvas.renderAll();\n   * @example <caption>Emboss filter</caption>\n   * var filter = new fabric.Image.filters.Convolute({\n   *   matrix: [ 1,   1,  1,\n   *             1, 0.7, -1,\n   *            -1,  -1, -1 ]\n   * });\n   * object.filters.push(filter);\n   * object.applyFilters();\n   * canvas.renderAll();\n   * @example <caption>Emboss filter with opaqueness</caption>\n   * var filter = new fabric.Image.filters.Convolute({\n   *   opaque: true,\n   *   matrix: [ 1,   1,  1,\n   *             1, 0.7, -1,\n   *            -1,  -1, -1 ]\n   * });\n   * object.filters.push(filter);\n   * object.applyFilters();\n   * canvas.renderAll();\n   */\n  filters.Convolute = createClass(filters.BaseFilter, /** @lends fabric.Image.filters.Convolute.prototype */ {\n\n    /**\n     * Filter type\n     * @param {String} type\n     * @default\n     */\n    type: 'Convolute',\n\n    /*\n     * Opaque value (true/false)\n     */\n    opaque: false,\n\n    /*\n     * matrix for the filter, max 9x9\n     */\n    matrix: [0, 0, 0, 0, 1, 0, 0, 0, 0],\n\n    /**\n     * Fragment source for the brightness program\n     */\n    fragmentSource: {\n      Convolute_3_1: 'precision highp float;\\n' +\n        'uniform sampler2D uTexture;\\n' +\n        'uniform float uMatrix[9];\\n' +\n        'uniform float uStepW;\\n' +\n        'uniform float uStepH;\\n' +\n        'varying vec2 vTexCoord;\\n' +\n        'void main() {\\n' +\n          'vec4 color = vec4(0, 0, 0, 0);\\n' +\n          'for (float h = 0.0; h < 3.0; h+=1.0) {\\n' +\n            'for (float w = 0.0; w < 3.0; w+=1.0) {\\n' +\n              'vec2 matrixPos = vec2(uStepW * (w - 1), uStepH * (h - 1));\\n' +\n              'color += texture2D(uTexture, vTexCoord + matrixPos) * uMatrix[int(h * 3.0 + w)];\\n' +\n            '}\\n' +\n          '}\\n' +\n          'gl_FragColor = color;\\n' +\n        '}',\n      Convolute_3_0: 'precision highp float;\\n' +\n        'uniform sampler2D uTexture;\\n' +\n        'uniform float uMatrix[9];\\n' +\n        'uniform float uStepW;\\n' +\n        'uniform float uStepH;\\n' +\n        'varying vec2 vTexCoord;\\n' +\n        'void main() {\\n' +\n          'vec4 color = vec4(0, 0, 0, 1);\\n' +\n          'for (float h = 0.0; h < 3.0; h+=1.0) {\\n' +\n            'for (float w = 0.0; w < 3.0; w+=1.0) {\\n' +\n              'vec2 matrixPos = vec2(uStepW * (w - 1.0), uStepH * (h - 1.0));\\n' +\n              'color.rgb += texture2D(uTexture, vTexCoord + matrixPos).rgb * uMatrix[int(h * 3.0 + w)];\\n' +\n            '}\\n' +\n          '}\\n' +\n          'float alpha = texture2D(uTexture, vTexCoord).a;\\n' +\n          'gl_FragColor = color;\\n' +\n          'gl_FragColor.a = alpha;\\n' +\n        '}',\n      Convolute_5_1: 'precision highp float;\\n' +\n        'uniform sampler2D uTexture;\\n' +\n        'uniform float uMatrix[25];\\n' +\n        'uniform float uStepW;\\n' +\n        'uniform float uStepH;\\n' +\n        'varying vec2 vTexCoord;\\n' +\n        'void main() {\\n' +\n          'vec4 color = vec4(0, 0, 0, 0);\\n' +\n          'for (float h = 0.0; h < 5.0; h+=1.0) {\\n' +\n            'for (float w = 0.0; w < 5.0; w+=1.0) {\\n' +\n              'vec2 matrixPos = vec2(uStepW * (w - 2.0), uStepH * (h - 2.0));\\n' +\n              'color += texture2D(uTexture, vTexCoord + matrixPos) * uMatrix[int(h * 5.0 + w)];\\n' +\n            '}\\n' +\n          '}\\n' +\n          'gl_FragColor = color;\\n' +\n        '}',\n      Convolute_5_0: 'precision highp float;\\n' +\n        'uniform sampler2D uTexture;\\n' +\n        'uniform float uMatrix[25];\\n' +\n        'uniform float uStepW;\\n' +\n        'uniform float uStepH;\\n' +\n        'varying vec2 vTexCoord;\\n' +\n        'void main() {\\n' +\n          'vec4 color = vec4(0, 0, 0, 1);\\n' +\n          'for (float h = 0.0; h < 5.0; h+=1.0) {\\n' +\n            'for (float w = 0.0; w < 5.0; w+=1.0) {\\n' +\n              'vec2 matrixPos = vec2(uStepW * (w - 2.0), uStepH * (h - 2.0));\\n' +\n              'color.rgb += texture2D(uTexture, vTexCoord + matrixPos).rgb * uMatrix[int(h * 5.0 + w)];\\n' +\n            '}\\n' +\n          '}\\n' +\n          'float alpha = texture2D(uTexture, vTexCoord).a;\\n' +\n          'gl_FragColor = color;\\n' +\n          'gl_FragColor.a = alpha;\\n' +\n        '}',\n      Convolute_7_1: 'precision highp float;\\n' +\n        'uniform sampler2D uTexture;\\n' +\n        'uniform float uMatrix[49];\\n' +\n        'uniform float uStepW;\\n' +\n        'uniform float uStepH;\\n' +\n        'varying vec2 vTexCoord;\\n' +\n        'void main() {\\n' +\n          'vec4 color = vec4(0, 0, 0, 0);\\n' +\n          'for (float h = 0.0; h < 7.0; h+=1.0) {\\n' +\n            'for (float w = 0.0; w < 7.0; w+=1.0) {\\n' +\n              'vec2 matrixPos = vec2(uStepW * (w - 3.0), uStepH * (h - 3.0));\\n' +\n              'color += texture2D(uTexture, vTexCoord + matrixPos) * uMatrix[int(h * 7.0 + w)];\\n' +\n            '}\\n' +\n          '}\\n' +\n          'gl_FragColor = color;\\n' +\n        '}',\n      Convolute_7_0: 'precision highp float;\\n' +\n        'uniform sampler2D uTexture;\\n' +\n        'uniform float uMatrix[49];\\n' +\n        'uniform float uStepW;\\n' +\n        'uniform float uStepH;\\n' +\n        'varying vec2 vTexCoord;\\n' +\n        'void main() {\\n' +\n          'vec4 color = vec4(0, 0, 0, 1);\\n' +\n          'for (float h = 0.0; h < 7.0; h+=1.0) {\\n' +\n            'for (float w = 0.0; w < 7.0; w+=1.0) {\\n' +\n              'vec2 matrixPos = vec2(uStepW * (w - 3.0), uStepH * (h - 3.0));\\n' +\n              'color.rgb += texture2D(uTexture, vTexCoord + matrixPos).rgb * uMatrix[int(h * 7.0 + w)];\\n' +\n            '}\\n' +\n          '}\\n' +\n          'float alpha = texture2D(uTexture, vTexCoord).a;\\n' +\n          'gl_FragColor = color;\\n' +\n          'gl_FragColor.a = alpha;\\n' +\n        '}',\n      Convolute_9_1: 'precision highp float;\\n' +\n        'uniform sampler2D uTexture;\\n' +\n        'uniform float uMatrix[81];\\n' +\n        'uniform float uStepW;\\n' +\n        'uniform float uStepH;\\n' +\n        'varying vec2 vTexCoord;\\n' +\n        'void main() {\\n' +\n          'vec4 color = vec4(0, 0, 0, 0);\\n' +\n          'for (float h = 0.0; h < 9.0; h+=1.0) {\\n' +\n            'for (float w = 0.0; w < 9.0; w+=1.0) {\\n' +\n              'vec2 matrixPos = vec2(uStepW * (w - 4.0), uStepH * (h - 4.0));\\n' +\n              'color += texture2D(uTexture, vTexCoord + matrixPos) * uMatrix[int(h * 9.0 + w)];\\n' +\n            '}\\n' +\n          '}\\n' +\n          'gl_FragColor = color;\\n' +\n        '}',\n      Convolute_9_0: 'precision highp float;\\n' +\n        'uniform sampler2D uTexture;\\n' +\n        'uniform float uMatrix[81];\\n' +\n        'uniform float uStepW;\\n' +\n        'uniform float uStepH;\\n' +\n        'varying vec2 vTexCoord;\\n' +\n        'void main() {\\n' +\n          'vec4 color = vec4(0, 0, 0, 1);\\n' +\n          'for (float h = 0.0; h < 9.0; h+=1.0) {\\n' +\n            'for (float w = 0.0; w < 9.0; w+=1.0) {\\n' +\n              'vec2 matrixPos = vec2(uStepW * (w - 4.0), uStepH * (h - 4.0));\\n' +\n              'color.rgb += texture2D(uTexture, vTexCoord + matrixPos).rgb * uMatrix[int(h * 9.0 + w)];\\n' +\n            '}\\n' +\n          '}\\n' +\n          'float alpha = texture2D(uTexture, vTexCoord).a;\\n' +\n          'gl_FragColor = color;\\n' +\n          'gl_FragColor.a = alpha;\\n' +\n        '}',\n    },\n\n    /**\n     * Constructor\n     * @memberOf fabric.Image.filters.Convolute.prototype\n     * @param {Object} [options] Options object\n     * @param {Boolean} [options.opaque=false] Opaque value (true/false)\n     * @param {Array} [options.matrix] Filter matrix\n     */\n\n\n    /**\n    * Retrieves the cached shader.\n    * @param {Object} options\n    * @param {WebGLRenderingContext} options.context The GL context used for rendering.\n    * @param {Object} options.programCache A map of compiled shader programs, keyed by filter type.\n    */\n    retrieveShader: function(options) {\n      var size = Math.sqrt(this.matrix.length);\n      var cacheKey = this.type + '_' + size + '_' + (this.opaque ? 1 : 0);\n      var shaderSource = this.fragmentSource[cacheKey];\n      if (!options.programCache.hasOwnProperty(cacheKey)) {\n        options.programCache[cacheKey] = this.createProgram(options.context, shaderSource);\n      }\n      return options.programCache[cacheKey];\n    },\n\n    /**\n     * Apply the Brightness operation to a Uint8ClampedArray representing the pixels of an image.\n     *\n     * @param {Object} options\n     * @param {ImageData} options.imageData The Uint8ClampedArray to be filtered.\n     */\n    applyTo2d: function(options) {\n      var imageData = options.imageData,\n          data = imageData.data,\n          weights = this.matrix,\n          side = Math.round(Math.sqrt(weights.length)),\n          halfSide = Math.floor(side / 2),\n          sw = imageData.width,\n          sh = imageData.height,\n          output = options.ctx.createImageData(sw, sh),\n          dst = output.data,\n          // go through the destination image pixels\n          alphaFac = this.opaque ? 1 : 0,\n          r, g, b, a, dstOff,\n          scx, scy, srcOff, wt,\n          x, y, cx, cy;\n\n      for (y = 0; y < sh; y++) {\n        for (x = 0; x < sw; x++) {\n          dstOff = (y * sw + x) * 4;\n          // calculate the weighed sum of the source image pixels that\n          // fall under the convolution matrix\n          r = 0; g = 0; b = 0; a = 0;\n\n          for (cy = 0; cy < side; cy++) {\n            for (cx = 0; cx < side; cx++) {\n              scy = y + cy - halfSide;\n              scx = x + cx - halfSide;\n\n              // eslint-disable-next-line max-depth\n              if (scy < 0 || scy >= sh || scx < 0 || scx >= sw) {\n                continue;\n              }\n\n              srcOff = (scy * sw + scx) * 4;\n              wt = weights[cy * side + cx];\n\n              r += data[srcOff] * wt;\n              g += data[srcOff + 1] * wt;\n              b += data[srcOff + 2] * wt;\n              // eslint-disable-next-line max-depth\n              if (!alphaFac) {\n                a += data[srcOff + 3] * wt;\n              }\n            }\n          }\n          dst[dstOff] = r;\n          dst[dstOff + 1] = g;\n          dst[dstOff + 2] = b;\n          if (!alphaFac) {\n            dst[dstOff + 3] = a;\n          }\n          else {\n            dst[dstOff + 3] = data[dstOff + 3];\n          }\n        }\n      }\n      options.imageData = output;\n    },\n\n    /**\n     * Return WebGL uniform locations for this filter's shader.\n     *\n     * @param {WebGLRenderingContext} gl The GL canvas context used to compile this filter's shader.\n     * @param {WebGLShaderProgram} program This filter's compiled shader program.\n     */\n    getUniformLocations: function(gl, program) {\n      return {\n        uMatrix: gl.getUniformLocation(program, 'uMatrix'),\n        uOpaque: gl.getUniformLocation(program, 'uOpaque'),\n        uHalfSize: gl.getUniformLocation(program, 'uHalfSize'),\n        uSize: gl.getUniformLocation(program, 'uSize'),\n      };\n    },\n\n    /**\n     * Send data from this filter to its shader program's uniforms.\n     *\n     * @param {WebGLRenderingContext} gl The GL canvas context used to compile this filter's shader.\n     * @param {Object} uniformLocations A map of string uniform names to WebGLUniformLocation objects\n     */\n    sendUniformData: function(gl, uniformLocations) {\n      gl.uniform1fv(uniformLocations.uMatrix, this.matrix);\n    },\n\n    /**\n     * Returns object representation of an instance\n     * @return {Object} Object representation of an instance\n     */\n    toObject: function() {\n      return extend(this.callSuper('toObject'), {\n        opaque: this.opaque,\n        matrix: this.matrix\n      });\n    }\n  });\n\n  /**\n   * Returns filter instance from an object representation\n   * @static\n   * @param {Object} object Object to create an instance from\n   * @param {function} [callback] to be invoked after filter creation\n   * @return {fabric.Image.filters.Convolute} Instance of fabric.Image.filters.Convolute\n   */\n  fabric.Image.filters.Convolute.fromObject = fabric.Image.filters.BaseFilter.fromObject;\n\n})(typeof exports !== 'undefined' ? exports : this);\n\n\n(function(global) {\n\n  'use strict';\n\n  var fabric  = global.fabric || (global.fabric = { }),\n      filters = fabric.Image.filters,\n      createClass = fabric.util.createClass;\n\n  /**\n   * Grayscale image filter class\n   * @class fabric.Image.filters.Grayscale\n   * @memberOf fabric.Image.filters\n   * @extends fabric.Image.filters.BaseFilter\n   * @see {@link http://fabricjs.com/image-filters|ImageFilters demo}\n   * @example\n   * var filter = new fabric.Image.filters.Grayscale();\n   * object.filters.push(filter);\n   * object.applyFilters();\n   */\n  filters.Grayscale = createClass(filters.BaseFilter, /** @lends fabric.Image.filters.Grayscale.prototype */ {\n\n    /**\n     * Filter type\n     * @param {String} type\n     * @default\n     */\n    type: 'Grayscale',\n\n    fragmentSource: {\n      average: 'precision highp float;\\n' +\n        'uniform sampler2D uTexture;\\n' +\n        'varying vec2 vTexCoord;\\n' +\n        'void main() {\\n' +\n          'vec4 color = texture2D(uTexture, vTexCoord);\\n' +\n          'float average = (color.r + color.b + color.g) / 3.0;\\n' +\n          'gl_FragColor = vec4(average, average, average, color.a);\\n' +\n        '}',\n      lightness: 'precision highp float;\\n' +\n        'uniform sampler2D uTexture;\\n' +\n        'uniform int uMode;\\n' +\n        'varying vec2 vTexCoord;\\n' +\n        'void main() {\\n' +\n          'vec4 col = texture2D(uTexture, vTexCoord);\\n' +\n          'float average = (max(max(col.r, col.g),col.b) + min(min(col.r, col.g),col.b)) / 2.0;\\n' +\n          'gl_FragColor = vec4(average, average, average, col.a);\\n' +\n        '}',\n      luminosity: 'precision highp float;\\n' +\n        'uniform sampler2D uTexture;\\n' +\n        'uniform int uMode;\\n' +\n        'varying vec2 vTexCoord;\\n' +\n        'void main() {\\n' +\n          'vec4 col = texture2D(uTexture, vTexCoord);\\n' +\n          'float average = 0.21 * col.r + 0.72 * col.g + 0.07 * col.b;\\n' +\n          'gl_FragColor = vec4(average, average, average, col.a);\\n' +\n        '}',\n    },\n\n\n    /**\n     * Grayscale mode, between 'average', 'lightness', 'luminosity'\n     * @param {String} type\n     * @default\n     */\n    mode: 'average',\n\n    mainParameter: 'mode',\n\n    /**\n     * Apply the Grayscale operation to a Uint8Array representing the pixels of an image.\n     *\n     * @param {Object} options\n     * @param {ImageData} options.imageData The Uint8Array to be filtered.\n     */\n    applyTo2d: function(options) {\n      var imageData = options.imageData,\n          data = imageData.data, i,\n          len = data.length, value,\n          mode = this.mode;\n      for (i = 0; i < len; i += 4) {\n        if (mode === 'average') {\n          value = (data[i] + data[i + 1] + data[i + 2]) / 3;\n        }\n        else if (mode === 'lightness') {\n          value = (Math.min(data[i], data[i + 1], data[i + 2]) +\n            Math.max(data[i], data[i + 1], data[i + 2])) / 2;\n        }\n        else if (mode === 'luminosity') {\n          value = 0.21 * data[i] + 0.72 * data[i + 1] + 0.07 * data[i + 2];\n        }\n        data[i] = value;\n        data[i + 1] = value;\n        data[i + 2] = value;\n      }\n    },\n\n    /**\n     * Retrieves the cached shader.\n     * @param {Object} options\n     * @param {WebGLRenderingContext} options.context The GL context used for rendering.\n     * @param {Object} options.programCache A map of compiled shader programs, keyed by filter type.\n     */\n    retrieveShader: function(options) {\n      var cacheKey = this.type + '_' + this.mode;\n      if (!options.programCache.hasOwnProperty(cacheKey)) {\n        var shaderSource = this.fragmentSource[this.mode];\n        options.programCache[cacheKey] = this.createProgram(options.context, shaderSource);\n      }\n      return options.programCache[cacheKey];\n    },\n\n    /**\n     * Return WebGL uniform locations for this filter's shader.\n     *\n     * @param {WebGLRenderingContext} gl The GL canvas context used to compile this filter's shader.\n     * @param {WebGLShaderProgram} program This filter's compiled shader program.\n     */\n    getUniformLocations: function(gl, program) {\n      return {\n        uMode: gl.getUniformLocation(program, 'uMode'),\n      };\n    },\n\n    /**\n     * Send data from this filter to its shader program's uniforms.\n     *\n     * @param {WebGLRenderingContext} gl The GL canvas context used to compile this filter's shader.\n     * @param {Object} uniformLocations A map of string uniform names to WebGLUniformLocation objects\n     */\n    sendUniformData: function(gl, uniformLocations) {\n      // default average mode.\n      var mode = 1;\n      gl.uniform1i(uniformLocations.uMode, mode);\n    },\n\n    /**\n     * Grayscale filter isNeutralState implementation\n     * The filter is never neutral\n     * on the image\n     **/\n    isNeutralState: function() {\n      return false;\n    },\n  });\n\n  /**\n   * Returns filter instance from an object representation\n   * @static\n   * @param {Object} object Object to create an instance from\n   * @param {function} [callback] to be invoked after filter creation\n   * @return {fabric.Image.filters.Grayscale} Instance of fabric.Image.filters.Grayscale\n   */\n  fabric.Image.filters.Grayscale.fromObject = fabric.Image.filters.BaseFilter.fromObject;\n\n})(typeof exports !== 'undefined' ? exports : this);\n\n\n(function(global) {\n\n  'use strict';\n\n  var fabric  = global.fabric || (global.fabric = { }),\n      filters = fabric.Image.filters,\n      createClass = fabric.util.createClass;\n\n  /**\n   * Invert filter class\n   * @class fabric.Image.filters.Invert\n   * @memberOf fabric.Image.filters\n   * @extends fabric.Image.filters.BaseFilter\n   * @see {@link http://fabricjs.com/image-filters|ImageFilters demo}\n   * @example\n   * var filter = new fabric.Image.filters.Invert();\n   * object.filters.push(filter);\n   * object.applyFilters(canvas.renderAll.bind(canvas));\n   */\n  filters.Invert = createClass(filters.BaseFilter, /** @lends fabric.Image.filters.Invert.prototype */ {\n\n    /**\n     * Filter type\n     * @param {String} type\n     * @default\n     */\n    type: 'Invert',\n\n    fragmentSource: 'precision highp float;\\n' +\n      'uniform sampler2D uTexture;\\n' +\n      'uniform int uInvert;\\n' +\n      'varying vec2 vTexCoord;\\n' +\n      'void main() {\\n' +\n        'vec4 color = texture2D(uTexture, vTexCoord);\\n' +\n        'if (uInvert == 1) {\\n' +\n          'gl_FragColor = vec4(1.0 - color.r,1.0 -color.g,1.0 -color.b,color.a);\\n' +\n        '} else {\\n' +\n          'gl_FragColor = color;\\n' +\n        '}\\n' +\n      '}',\n\n    /**\n     * Filter invert. if false, does nothing\n     * @param {Boolean} invert\n     * @default\n     */\n    invert: true,\n\n    mainParameter: 'invert',\n\n    /**\n     * Apply the Invert operation to a Uint8Array representing the pixels of an image.\n     *\n     * @param {Object} options\n     * @param {ImageData} options.imageData The Uint8Array to be filtered.\n     */\n    applyTo2d: function(options) {\n      var imageData = options.imageData,\n          data = imageData.data, i,\n          len = data.length;\n      for (i = 0; i < len; i += 4) {\n        data[i] = 255 - data[i];\n        data[i + 1] = 255 - data[i + 1];\n        data[i + 2] = 255 - data[i + 2];\n      }\n    },\n\n    /**\n     * Invert filter isNeutralState implementation\n     * Used only in image applyFilters to discard filters that will not have an effect\n     * on the image\n     * @param {Object} options\n     **/\n    isNeutralState: function() {\n      return !this.invert;\n    },\n\n    /**\n     * Return WebGL uniform locations for this filter's shader.\n     *\n     * @param {WebGLRenderingContext} gl The GL canvas context used to compile this filter's shader.\n     * @param {WebGLShaderProgram} program This filter's compiled shader program.\n     */\n    getUniformLocations: function(gl, program) {\n      return {\n        uInvert: gl.getUniformLocation(program, 'uInvert'),\n      };\n    },\n\n    /**\n     * Send data from this filter to its shader program's uniforms.\n     *\n     * @param {WebGLRenderingContext} gl The GL canvas context used to compile this filter's shader.\n     * @param {Object} uniformLocations A map of string uniform names to WebGLUniformLocation objects\n     */\n    sendUniformData: function(gl, uniformLocations) {\n      gl.uniform1i(uniformLocations.uInvert, this.invert);\n    },\n  });\n\n  /**\n   * Returns filter instance from an object representation\n   * @static\n   * @param {Object} object Object to create an instance from\n   * @param {function} [callback] to be invoked after filter creation\n   * @return {fabric.Image.filters.Invert} Instance of fabric.Image.filters.Invert\n   */\n  fabric.Image.filters.Invert.fromObject = fabric.Image.filters.BaseFilter.fromObject;\n\n\n})(typeof exports !== 'undefined' ? exports : this);\n\n\n(function(global) {\n\n  'use strict';\n\n  var fabric  = global.fabric || (global.fabric = { }),\n      extend = fabric.util.object.extend,\n      filters = fabric.Image.filters,\n      createClass = fabric.util.createClass;\n\n  /**\n   * Noise filter class\n   * @class fabric.Image.filters.Noise\n   * @memberOf fabric.Image.filters\n   * @extends fabric.Image.filters.BaseFilter\n   * @see {@link fabric.Image.filters.Noise#initialize} for constructor definition\n   * @see {@link http://fabricjs.com/image-filters|ImageFilters demo}\n   * @example\n   * var filter = new fabric.Image.filters.Noise({\n   *   noise: 700\n   * });\n   * object.filters.push(filter);\n   * object.applyFilters();\n   * canvas.renderAll();\n   */\n  filters.Noise = createClass(filters.BaseFilter, /** @lends fabric.Image.filters.Noise.prototype */ {\n\n    /**\n     * Filter type\n     * @param {String} type\n     * @default\n     */\n    type: 'Noise',\n\n    /**\n     * Fragment source for the noise program\n     */\n    fragmentSource: 'precision highp float;\\n' +\n      'uniform sampler2D uTexture;\\n' +\n      'uniform float uStepH;\\n' +\n      'uniform float uNoise;\\n' +\n      'uniform float uSeed;\\n' +\n      'varying vec2 vTexCoord;\\n' +\n      'float rand(vec2 co, float seed, float vScale) {\\n' +\n        'return fract(sin(dot(co.xy * vScale ,vec2(12.9898 , 78.233))) * 43758.5453 * (seed + 0.01) / 2.0);\\n' +\n      '}\\n' +\n      'void main() {\\n' +\n        'vec4 color = texture2D(uTexture, vTexCoord);\\n' +\n        'color.rgb += (0.5 - rand(vTexCoord, uSeed, 0.1 / uStepH)) * uNoise;\\n' +\n        'gl_FragColor = color;\\n' +\n      '}',\n\n    /**\n     * Describe the property that is the filter parameter\n     * @param {String} m\n     * @default\n     */\n    mainParameter: 'noise',\n\n    /**\n     * Noise value, from\n     * @param {Number} noise\n     * @default\n     */\n    noise: 0,\n\n    /**\n     * Apply the Brightness operation to a Uint8ClampedArray representing the pixels of an image.\n     *\n     * @param {Object} options\n     * @param {ImageData} options.imageData The Uint8ClampedArray to be filtered.\n     */\n    applyTo2d: function(options) {\n      if (this.noise === 0) {\n        return;\n      }\n      var imageData = options.imageData,\n          data = imageData.data, i, len = data.length,\n          noise = this.noise, rand;\n\n      for (i = 0, len = data.length; i < len; i += 4) {\n\n        rand = (0.5 - Math.random()) * noise;\n\n        data[i] += rand;\n        data[i + 1] += rand;\n        data[i + 2] += rand;\n      }\n    },\n\n    /**\n     * Return WebGL uniform locations for this filter's shader.\n     *\n     * @param {WebGLRenderingContext} gl The GL canvas context used to compile this filter's shader.\n     * @param {WebGLShaderProgram} program This filter's compiled shader program.\n     */\n    getUniformLocations: function(gl, program) {\n      return {\n        uNoise: gl.getUniformLocation(program, 'uNoise'),\n        uSeed: gl.getUniformLocation(program, 'uSeed'),\n      };\n    },\n\n    /**\n     * Send data from this filter to its shader program's uniforms.\n     *\n     * @param {WebGLRenderingContext} gl The GL canvas context used to compile this filter's shader.\n     * @param {Object} uniformLocations A map of string uniform names to WebGLUniformLocation objects\n     */\n    sendUniformData: function(gl, uniformLocations) {\n      gl.uniform1f(uniformLocations.uNoise, this.noise / 255);\n      gl.uniform1f(uniformLocations.uSeed, Math.random());\n    },\n\n    /**\n     * Returns object representation of an instance\n     * @return {Object} Object representation of an instance\n     */\n    toObject: function() {\n      return extend(this.callSuper('toObject'), {\n        noise: this.noise\n      });\n    }\n  });\n\n  /**\n   * Returns filter instance from an object representation\n   * @static\n   * @param {Object} object Object to create an instance from\n   * @param {Function} [callback] to be invoked after filter creation\n   * @return {fabric.Image.filters.Noise} Instance of fabric.Image.filters.Noise\n   */\n  fabric.Image.filters.Noise.fromObject = fabric.Image.filters.BaseFilter.fromObject;\n\n})(typeof exports !== 'undefined' ? exports : this);\n\n\n(function(global) {\n\n  'use strict';\n\n  var fabric  = global.fabric || (global.fabric = { }),\n      filters = fabric.Image.filters,\n      createClass = fabric.util.createClass;\n\n  /**\n   * Pixelate filter class\n   * @class fabric.Image.filters.Pixelate\n   * @memberOf fabric.Image.filters\n   * @extends fabric.Image.filters.BaseFilter\n   * @see {@link fabric.Image.filters.Pixelate#initialize} for constructor definition\n   * @see {@link http://fabricjs.com/image-filters|ImageFilters demo}\n   * @example\n   * var filter = new fabric.Image.filters.Pixelate({\n   *   blocksize: 8\n   * });\n   * object.filters.push(filter);\n   * object.applyFilters();\n   */\n  filters.Pixelate = createClass(filters.BaseFilter, /** @lends fabric.Image.filters.Pixelate.prototype */ {\n\n    /**\n     * Filter type\n     * @param {String} type\n     * @default\n     */\n    type: 'Pixelate',\n\n    blocksize: 4,\n\n    mainParameter: 'blocksize',\n\n    /**\n     * Fragment source for the Pixelate program\n     */\n    fragmentSource: 'precision highp float;\\n' +\n      'uniform sampler2D uTexture;\\n' +\n      'uniform float uBlocksize;\\n' +\n      'uniform float uStepW;\\n' +\n      'uniform float uStepH;\\n' +\n      'varying vec2 vTexCoord;\\n' +\n      'void main() {\\n' +\n        'float blockW = uBlocksize * uStepW;\\n' +\n        'float blockH = uBlocksize * uStepW;\\n' +\n        'int posX = int(vTexCoord.x / blockW);\\n' +\n        'int posY = int(vTexCoord.y / blockH);\\n' +\n        'float fposX = float(posX);\\n' +\n        'float fposY = float(posY);\\n' +\n        'vec2 squareCoords = vec2(fposX * blockW, fposY * blockH);\\n' +\n        'vec4 color = texture2D(uTexture, squareCoords);\\n' +\n        'gl_FragColor = color;\\n' +\n      '}',\n\n    /**\n     * Apply the Pixelate operation to a Uint8ClampedArray representing the pixels of an image.\n     *\n     * @param {Object} options\n     * @param {ImageData} options.imageData The Uint8ClampedArray to be filtered.\n     */\n    applyTo2d: function(options) {\n      var imageData = options.imageData,\n          data = imageData.data,\n          iLen = imageData.height,\n          jLen = imageData.width,\n          index, i, j, r, g, b, a,\n          _i, _j, _iLen, _jLen;\n\n      for (i = 0; i < iLen; i += this.blocksize) {\n        for (j = 0; j < jLen; j += this.blocksize) {\n\n          index = (i * 4) * jLen + (j * 4);\n\n          r = data[index];\n          g = data[index + 1];\n          b = data[index + 2];\n          a = data[index + 3];\n\n          _iLen = Math.min(i + this.blocksize, iLen);\n          _jLen = Math.min(j + this.blocksize, jLen);\n          for (_i = i; _i < _iLen; _i++) {\n            for (_j = j; _j < _jLen; _j++) {\n              index = (_i * 4) * jLen + (_j * 4);\n              data[index] = r;\n              data[index + 1] = g;\n              data[index + 2] = b;\n              data[index + 3] = a;\n            }\n          }\n        }\n      }\n    },\n\n    /**\n     * Indicate when the filter is not gonna apply changes to the image\n     **/\n    isNeutralState: function() {\n      return this.blocksize === 1;\n    },\n\n    /**\n     * Return WebGL uniform locations for this filter's shader.\n     *\n     * @param {WebGLRenderingContext} gl The GL canvas context used to compile this filter's shader.\n     * @param {WebGLShaderProgram} program This filter's compiled shader program.\n     */\n    getUniformLocations: function(gl, program) {\n      return {\n        uBlocksize: gl.getUniformLocation(program, 'uBlocksize'),\n        uStepW: gl.getUniformLocation(program, 'uStepW'),\n        uStepH: gl.getUniformLocation(program, 'uStepH'),\n      };\n    },\n\n    /**\n     * Send data from this filter to its shader program's uniforms.\n     *\n     * @param {WebGLRenderingContext} gl The GL canvas context used to compile this filter's shader.\n     * @param {Object} uniformLocations A map of string uniform names to WebGLUniformLocation objects\n     */\n    sendUniformData: function(gl, uniformLocations) {\n      gl.uniform1f(uniformLocations.uBlocksize, this.blocksize);\n    },\n  });\n\n  /**\n   * Returns filter instance from an object representation\n   * @static\n   * @param {Object} object Object to create an instance from\n   * @param {Function} [callback] to be invoked after filter creation\n   * @return {fabric.Image.filters.Pixelate} Instance of fabric.Image.filters.Pixelate\n   */\n  fabric.Image.filters.Pixelate.fromObject = fabric.Image.filters.BaseFilter.fromObject;\n\n})(typeof exports !== 'undefined' ? exports : this);\n\n\n(function(global) {\n\n  'use strict';\n\n  var fabric  = global.fabric || (global.fabric = { }),\n      extend = fabric.util.object.extend,\n      filters = fabric.Image.filters,\n      createClass = fabric.util.createClass;\n\n  /**\n   * Remove white filter class\n   * @class fabric.Image.filters.RemoveColor\n   * @memberOf fabric.Image.filters\n   * @extends fabric.Image.filters.BaseFilter\n   * @see {@link fabric.Image.filters.RemoveColor#initialize} for constructor definition\n   * @see {@link http://fabricjs.com/image-filters|ImageFilters demo}\n   * @example\n   * var filter = new fabric.Image.filters.RemoveColor({\n   *   threshold: 0.2,\n   * });\n   * object.filters.push(filter);\n   * object.applyFilters();\n   * canvas.renderAll();\n   */\n  filters.RemoveColor = createClass(filters.BaseFilter, /** @lends fabric.Image.filters.RemoveColor.prototype */ {\n\n    /**\n     * Filter type\n     * @param {String} type\n     * @default\n     */\n    type: 'RemoveColor',\n\n    /**\n     * Color to remove, in any format understood by fabric.Color.\n     * @param {String} type\n     * @default\n     */\n    color: '#FFFFFF',\n\n    /**\n     * Fragment source for the brightness program\n     */\n    fragmentSource: 'precision highp float;\\n' +\n      'uniform sampler2D uTexture;\\n' +\n      'uniform vec4 uLow;\\n' +\n      'uniform vec4 uHigh;\\n' +\n      'varying vec2 vTexCoord;\\n' +\n      'void main() {\\n' +\n        'gl_FragColor = texture2D(uTexture, vTexCoord);\\n' +\n        'if(all(greaterThan(gl_FragColor.rgb,uLow.rgb)) && all(greaterThan(uHigh.rgb,gl_FragColor.rgb))) {\\n' +\n          'gl_FragColor.a = 0.0;\\n' +\n        '}\\n' +\n      '}',\n\n    /**\n     * distance to actual color, as value up or down from each r,g,b\n     * between 0 and 1\n     **/\n    distance: 0.02,\n\n    /**\n     * For color to remove inside distance, use alpha channel for a smoother deletion\n     * NOT IMPLEMENTED YET\n     **/\n    useAlpha: false,\n\n    /**\n     * Constructor\n     * @memberOf fabric.Image.filters.RemoveWhite.prototype\n     * @param {Object} [options] Options object\n     * @param {Number} [options.color=#RRGGBB] Threshold value\n     * @param {Number} [options.distance=10] Distance value\n     */\n\n    /**\n     * Applies filter to canvas element\n     * @param {Object} canvasEl Canvas element to apply filter to\n     */\n    applyTo2d: function(options) {\n      var imageData = options.imageData,\n          data = imageData.data, i,\n          distance = this.distance * 255,\n          r, g, b,\n          source = new fabric.Color(this.color).getSource(),\n          lowC = [\n            source[0] - distance,\n            source[1] - distance,\n            source[2] - distance,\n          ],\n          highC = [\n            source[0] + distance,\n            source[1] + distance,\n            source[2] + distance,\n          ];\n\n\n      for (i = 0; i < data.length; i += 4) {\n        r = data[i];\n        g = data[i + 1];\n        b = data[i + 2];\n\n        if (r > lowC[0] &&\n            g > lowC[1] &&\n            b > lowC[2] &&\n            r < highC[0] &&\n            g < highC[1] &&\n            b < highC[2]) {\n          data[i + 3] = 0;\n        }\n      }\n    },\n\n    /**\n     * Return WebGL uniform locations for this filter's shader.\n     *\n     * @param {WebGLRenderingContext} gl The GL canvas context used to compile this filter's shader.\n     * @param {WebGLShaderProgram} program This filter's compiled shader program.\n     */\n    getUniformLocations: function(gl, program) {\n      return {\n        uLow: gl.getUniformLocation(program, 'uLow'),\n        uHigh: gl.getUniformLocation(program, 'uHigh'),\n      };\n    },\n\n    /**\n     * Send data from this filter to its shader program's uniforms.\n     *\n     * @param {WebGLRenderingContext} gl The GL canvas context used to compile this filter's shader.\n     * @param {Object} uniformLocations A map of string uniform names to WebGLUniformLocation objects\n     */\n    sendUniformData: function(gl, uniformLocations) {\n      var source = new fabric.Color(this.color).getSource(),\n          distance = parseFloat(this.distance),\n          lowC = [\n            0 + source[0] / 255 - distance,\n            0 + source[1] / 255 - distance,\n            0 + source[2] / 255 - distance,\n            1\n          ],\n          highC = [\n            source[0] / 255 + distance,\n            source[1] / 255 + distance,\n            source[2] / 255 + distance,\n            1\n          ];\n      gl.uniform4fv(uniformLocations.uLow, lowC);\n      gl.uniform4fv(uniformLocations.uHigh, highC);\n    },\n\n    /**\n     * Returns object representation of an instance\n     * @return {Object} Object representation of an instance\n     */\n    toObject: function() {\n      return extend(this.callSuper('toObject'), {\n        color: this.color,\n        distance: this.distance\n      });\n    }\n  });\n\n  /**\n   * Returns filter instance from an object representation\n   * @static\n   * @param {Object} object Object to create an instance from\n   * @param {Function} [callback] to be invoked after filter creation\n   * @return {fabric.Image.filters.RemoveColor} Instance of fabric.Image.filters.RemoveWhite\n   */\n  fabric.Image.filters.RemoveColor.fromObject = fabric.Image.filters.BaseFilter.fromObject;\n\n})(typeof exports !== 'undefined' ? exports : this);\n\n\n(function(global) {\n\n  'use strict';\n\n  var fabric  = global.fabric || (global.fabric = { }),\n      filters = fabric.Image.filters,\n      createClass = fabric.util.createClass;\n\n  var matrices = {\n    Brownie: [\n      0.59970,0.34553,-0.27082,0,0.186,\n      -0.03770,0.86095,0.15059,0,-0.1449,\n      0.24113,-0.07441,0.44972,0,-0.02965,\n      0,0,0,1,0\n    ],\n    Vintage: [\n      0.62793,0.32021,-0.03965,0,0.03784,\n      0.02578,0.64411,0.03259,0,0.02926,\n      0.04660,-0.08512,0.52416,0,0.02023,\n      0,0,0,1,0\n    ],\n    Kodachrome: [\n      1.12855,-0.39673,-0.03992,0,0.24991,\n      -0.16404,1.08352,-0.05498,0,0.09698,\n      -0.16786,-0.56034,1.60148,0,0.13972,\n      0,0,0,1,0\n    ],\n    Technicolor: [\n      1.91252,-0.85453,-0.09155,0,0.04624,\n      -0.30878,1.76589,-0.10601,0,-0.27589,\n      -0.23110,-0.75018,1.84759,0,0.12137,\n      0,0,0,1,0\n    ],\n    Polaroid: [\n      1.438,-0.062,-0.062,0,0,\n      -0.122,1.378,-0.122,0,0,\n      -0.016,-0.016,1.483,0,0,\n      0,0,0,1,0\n    ],\n    Sepia: [\n      0.393, 0.769, 0.189, 0, 0,\n      0.349, 0.686, 0.168, 0, 0,\n      0.272, 0.534, 0.131, 0, 0,\n      0, 0, 0, 1, 0\n    ],\n    BlackWhite: [\n      1.5, 1.5, 1.5, 0, -1,\n      1.5, 1.5, 1.5, 0, -1,\n      1.5, 1.5, 1.5, 0, -1,\n      0, 0, 0, 1, 0,\n    ]\n  };\n\n  for (var key in matrices) {\n    filters[key] = createClass(filters.ColorMatrix, /** @lends fabric.Image.filters.Sepia.prototype */ {\n\n      /**\n       * Filter type\n       * @param {String} type\n       * @default\n       */\n      type: key,\n\n      /**\n       * Colormatrix for the effect\n       * array of 20 floats. Numbers in positions 4, 9, 14, 19 loose meaning\n       * outside the -1, 1 range.\n       * @param {Array} matrix array of 20 numbers.\n       * @default\n       */\n      matrix: matrices[key],\n\n      /**\n       * Lock the matrix export for this kind of static, parameter less filters.\n       */\n      mainParameter: false,\n      /**\n       * Lock the colormatrix on the color part, skipping alpha\n       */\n      colorsOnly: true,\n\n    });\n    fabric.Image.filters[key].fromObject = fabric.Image.filters.BaseFilter.fromObject;\n  }\n})(typeof exports !== 'undefined' ? exports : this);\n\n\n(function(global) {\n  'use strict';\n\n  var fabric = global.fabric,\n      filters = fabric.Image.filters,\n      createClass = fabric.util.createClass;\n\n  /**\n   * Color Blend filter class\n   * @class fabric.Image.filter.BlendColor\n   * @memberOf fabric.Image.filters\n   * @extends fabric.Image.filters.BaseFilter\n   * @example\n   * var filter = new fabric.Image.filters.BlendColor({\n   *  color: '#000',\n   *  mode: 'multiply'\n   * });\n   *\n   * var filter = new fabric.Image.filters.BlendImage({\n   *  image: fabricImageObject,\n   *  mode: 'multiply',\n   *  alpha: 0.5\n   * });\n   * object.filters.push(filter);\n   * object.applyFilters();\n   * canvas.renderAll();\n   */\n\n  filters.BlendColor = createClass(filters.BaseFilter, /** @lends fabric.Image.filters.Blend.prototype */ {\n    type: 'BlendColor',\n\n    /**\n     * Color to make the blend operation with. default to a reddish color since black or white\n     * gives always strong result.\n     * @type String\n     * @default\n     **/\n    color: '#F95C63',\n\n    /**\n     * Blend mode for the filter: one of multiply, add, diff, screen, subtract,\n     * darken, lighten, overlay, exclusion, tint.\n     * @type String\n     * @default\n     **/\n    mode: 'multiply',\n\n    /**\n     * alpha value. represent the strength of the blend color operation.\n     * @type Number\n     * @default\n     **/\n    alpha: 1,\n\n    /**\n     * Fragment source for the Multiply program\n     */\n    fragmentSource: {\n      multiply: 'gl_FragColor.rgb *= uColor.rgb;\\n',\n      screen: 'gl_FragColor.rgb = 1.0 - (1.0 - gl_FragColor.rgb) * (1.0 - uColor.rgb);\\n',\n      add: 'gl_FragColor.rgb += uColor.rgb;\\n',\n      diff: 'gl_FragColor.rgb = abs(gl_FragColor.rgb - uColor.rgb);\\n',\n      subtract: 'gl_FragColor.rgb -= uColor.rgb;\\n',\n      lighten: 'gl_FragColor.rgb = max(gl_FragColor.rgb, uColor.rgb);\\n',\n      darken: 'gl_FragColor.rgb = min(gl_FragColor.rgb, uColor.rgb);\\n',\n      exclusion: 'gl_FragColor.rgb += uColor.rgb - 2.0 * (uColor.rgb * gl_FragColor.rgb);\\n',\n      overlay: 'if (uColor.r < 0.5) {\\n' +\n          'gl_FragColor.r *= 2.0 * uColor.r;\\n' +\n        '} else {\\n' +\n          'gl_FragColor.r = 1.0 - 2.0 * (1.0 - gl_FragColor.r) * (1.0 - uColor.r);\\n' +\n        '}\\n' +\n        'if (uColor.g < 0.5) {\\n' +\n          'gl_FragColor.g *= 2.0 * uColor.g;\\n' +\n        '} else {\\n' +\n          'gl_FragColor.g = 1.0 - 2.0 * (1.0 - gl_FragColor.g) * (1.0 - uColor.g);\\n' +\n        '}\\n' +\n        'if (uColor.b < 0.5) {\\n' +\n          'gl_FragColor.b *= 2.0 * uColor.b;\\n' +\n        '} else {\\n' +\n          'gl_FragColor.b = 1.0 - 2.0 * (1.0 - gl_FragColor.b) * (1.0 - uColor.b);\\n' +\n        '}\\n',\n      tint: 'gl_FragColor.rgb *= (1.0 - uColor.a);\\n' +\n        'gl_FragColor.rgb += uColor.rgb;\\n',\n    },\n\n    /**\n     * build the fragment source for the filters, joining the common part with\n     * the specific one.\n     * @param {String} mode the mode of the filter, a key of this.fragmentSource\n     * @return {String} the source to be compiled\n     * @private\n     */\n    buildSource: function(mode) {\n      return 'precision highp float;\\n' +\n        'uniform sampler2D uTexture;\\n' +\n        'uniform vec4 uColor;\\n' +\n        'varying vec2 vTexCoord;\\n' +\n        'void main() {\\n' +\n          'vec4 color = texture2D(uTexture, vTexCoord);\\n' +\n          'gl_FragColor = color;\\n' +\n          'if (color.a > 0.0) {\\n' +\n            this.fragmentSource[mode] +\n          '}\\n' +\n        '}';\n    },\n\n    /**\n     * Retrieves the cached shader.\n     * @param {Object} options\n     * @param {WebGLRenderingContext} options.context The GL context used for rendering.\n     * @param {Object} options.programCache A map of compiled shader programs, keyed by filter type.\n     */\n    retrieveShader: function(options) {\n      var cacheKey = this.type + '_' + this.mode, shaderSource;\n      if (!options.programCache.hasOwnProperty(cacheKey)) {\n        shaderSource = this.buildSource(this.mode);\n        options.programCache[cacheKey] = this.createProgram(options.context, shaderSource);\n      }\n      return options.programCache[cacheKey];\n    },\n\n    /**\n     * Apply the Blend operation to a Uint8ClampedArray representing the pixels of an image.\n     *\n     * @param {Object} options\n     * @param {ImageData} options.imageData The Uint8ClampedArray to be filtered.\n     */\n    applyTo2d: function(options) {\n      var imageData = options.imageData,\n          data = imageData.data, iLen = data.length,\n          tr, tg, tb,\n          r, g, b,\n          source, alpha1 = 1 - this.alpha;\n\n      source = new fabric.Color(this.color).getSource();\n      tr = source[0] * this.alpha;\n      tg = source[1] * this.alpha;\n      tb = source[2] * this.alpha;\n\n      for (var i = 0; i < iLen; i += 4) {\n\n        r = data[i];\n        g = data[i + 1];\n        b = data[i + 2];\n\n        switch (this.mode) {\n          case 'multiply':\n            data[i] = r * tr / 255;\n            data[i + 1] = g * tg / 255;\n            data[i + 2] = b * tb / 255;\n            break;\n          case 'screen':\n            data[i] = 255 - (255 - r) * (255 - tr) / 255;\n            data[i + 1] = 255 - (255 - g) * (255 - tg) / 255;\n            data[i + 2] = 255 - (255 - b) * (255 - tb) / 255;\n            break;\n          case 'add':\n            data[i] = r + tr;\n            data[i + 1] = g + tg;\n            data[i + 2] = b + tb;\n            break;\n          case 'diff':\n          case 'difference':\n            data[i] = Math.abs(r - tr);\n            data[i + 1] = Math.abs(g - tg);\n            data[i + 2] = Math.abs(b - tb);\n            break;\n          case 'subtract':\n            data[i] = r - tr;\n            data[i + 1] = g - tg;\n            data[i + 2] = b - tb;\n            break;\n          case 'darken':\n            data[i] = Math.min(r, tr);\n            data[i + 1] = Math.min(g, tg);\n            data[i + 2] = Math.min(b, tb);\n            break;\n          case 'lighten':\n            data[i] = Math.max(r, tr);\n            data[i + 1] = Math.max(g, tg);\n            data[i + 2] = Math.max(b, tb);\n            break;\n          case 'overlay':\n            data[i] = tr < 128 ? (2 * r * tr / 255) : (255 - 2 * (255 - r) * (255 - tr) / 255);\n            data[i + 1] = tg < 128 ? (2 * g * tg / 255) : (255 - 2 * (255 - g) * (255 - tg) / 255);\n            data[i + 2] = tb < 128 ? (2 * b * tb / 255) : (255 - 2 * (255 - b) * (255 - tb) / 255);\n            break;\n          case 'exclusion':\n            data[i] = tr + r - ((2 * tr * r) / 255);\n            data[i + 1] = tg + g - ((2 * tg * g) / 255);\n            data[i + 2] = tb + b - ((2 * tb * b) / 255);\n            break;\n          case 'tint':\n            data[i] = tr + r * alpha1;\n            data[i + 1] = tg + g * alpha1;\n            data[i + 2] = tb + b * alpha1;\n        }\n      }\n    },\n\n    /**\n     * Return WebGL uniform locations for this filter's shader.\n     *\n     * @param {WebGLRenderingContext} gl The GL canvas context used to compile this filter's shader.\n     * @param {WebGLShaderProgram} program This filter's compiled shader program.\n     */\n    getUniformLocations: function(gl, program) {\n      return {\n        uColor: gl.getUniformLocation(program, 'uColor'),\n      };\n    },\n\n    /**\n     * Send data from this filter to its shader program's uniforms.\n     *\n     * @param {WebGLRenderingContext} gl The GL canvas context used to compile this filter's shader.\n     * @param {Object} uniformLocations A map of string uniform names to WebGLUniformLocation objects\n     */\n    sendUniformData: function(gl, uniformLocations) {\n      var source = new fabric.Color(this.color).getSource();\n      source[0] = this.alpha * source[0] / 255;\n      source[1] = this.alpha * source[1] / 255;\n      source[2] = this.alpha * source[2] / 255;\n      source[3] = this.alpha;\n      gl.uniform4fv(uniformLocations.uColor, source);\n    },\n\n    /**\n     * Returns object representation of an instance\n     * @return {Object} Object representation of an instance\n     */\n    toObject: function() {\n      return {\n        type: this.type,\n        color: this.color,\n        mode: this.mode,\n        alpha: this.alpha\n      };\n    }\n  });\n\n  /**\n   * Returns filter instance from an object representation\n   * @static\n   * @param {Object} object Object to create an instance from\n   * @param {function} [callback] to be invoked after filter creation\n   * @return {fabric.Image.filters.BlendColor} Instance of fabric.Image.filters.BlendColor\n   */\n  fabric.Image.filters.BlendColor.fromObject = fabric.Image.filters.BaseFilter.fromObject;\n\n})(typeof exports !== 'undefined' ? exports : this);\n\n\n(function(global) {\n  'use strict';\n\n  var fabric = global.fabric,\n      filters = fabric.Image.filters,\n      createClass = fabric.util.createClass;\n\n  /**\n   * Image Blend filter class\n   * @class fabric.Image.filter.BlendImage\n   * @memberOf fabric.Image.filters\n   * @extends fabric.Image.filters.BaseFilter\n   * @example\n   * var filter = new fabric.Image.filters.BlendColor({\n   *  color: '#000',\n   *  mode: 'multiply'\n   * });\n   *\n   * var filter = new fabric.Image.filters.BlendImage({\n   *  image: fabricImageObject,\n   *  mode: 'multiply',\n   *  alpha: 0.5\n   * });\n   * object.filters.push(filter);\n   * object.applyFilters();\n   * canvas.renderAll();\n   */\n\n  filters.BlendImage = createClass(filters.BaseFilter, /** @lends fabric.Image.filters.BlendImage.prototype */ {\n    type: 'BlendImage',\n\n    /**\n     * Color to make the blend operation with. default to a reddish color since black or white\n     * gives always strong result.\n     **/\n    image: null,\n\n    /**\n     * Blend mode for the filter (one of \"multiply\", \"mask\")\n     * @type String\n     * @default\n     **/\n    mode: 'multiply',\n\n    /**\n     * alpha value. represent the strength of the blend image operation.\n     * not implemented.\n     **/\n    alpha: 1,\n\n    vertexSource: 'attribute vec2 aPosition;\\n' +\n      'varying vec2 vTexCoord;\\n' +\n      'varying vec2 vTexCoord2;\\n' +\n      'uniform mat3 uTransformMatrix;\\n' +\n      'void main() {\\n' +\n        'vTexCoord = aPosition;\\n' +\n        'vTexCoord2 = (uTransformMatrix * vec3(aPosition, 1.0)).xy;\\n' +\n        'gl_Position = vec4(aPosition * 2.0 - 1.0, 0.0, 1.0);\\n' +\n      '}',\n\n    /**\n     * Fragment source for the Multiply program\n     */\n    fragmentSource: {\n      multiply: 'precision highp float;\\n' +\n        'uniform sampler2D uTexture;\\n' +\n        'uniform sampler2D uImage;\\n' +\n        'uniform vec4 uColor;\\n' +\n        'varying vec2 vTexCoord;\\n' +\n        'varying vec2 vTexCoord2;\\n' +\n        'void main() {\\n' +\n          'vec4 color = texture2D(uTexture, vTexCoord);\\n' +\n          'vec4 color2 = texture2D(uImage, vTexCoord2);\\n' +\n          'color.rgba *= color2.rgba;\\n' +\n          'gl_FragColor = color;\\n' +\n        '}',\n      mask: 'precision highp float;\\n' +\n        'uniform sampler2D uTexture;\\n' +\n        'uniform sampler2D uImage;\\n' +\n        'uniform vec4 uColor;\\n' +\n        'varying vec2 vTexCoord;\\n' +\n        'varying vec2 vTexCoord2;\\n' +\n        'void main() {\\n' +\n          'vec4 color = texture2D(uTexture, vTexCoord);\\n' +\n          'vec4 color2 = texture2D(uImage, vTexCoord2);\\n' +\n          'color.a = color2.a;\\n' +\n          'gl_FragColor = color;\\n' +\n        '}',\n    },\n\n    /**\n     * Retrieves the cached shader.\n     * @param {Object} options\n     * @param {WebGLRenderingContext} options.context The GL context used for rendering.\n     * @param {Object} options.programCache A map of compiled shader programs, keyed by filter type.\n     */\n    retrieveShader: function(options) {\n      var cacheKey = this.type + '_' + this.mode;\n      var shaderSource = this.fragmentSource[this.mode];\n      if (!options.programCache.hasOwnProperty(cacheKey)) {\n        options.programCache[cacheKey] = this.createProgram(options.context, shaderSource);\n      }\n      return options.programCache[cacheKey];\n    },\n\n    applyToWebGL: function(options) {\n      // load texture to blend.\n      var gl = options.context,\n          texture = this.createTexture(options.filterBackend, this.image);\n      this.bindAdditionalTexture(gl, texture, gl.TEXTURE1);\n      this.callSuper('applyToWebGL', options);\n      this.unbindAdditionalTexture(gl, gl.TEXTURE1);\n    },\n\n    createTexture: function(backend, image) {\n      return backend.getCachedTexture(image.cacheKey, image._element);\n    },\n\n    /**\n     * Calculate a transformMatrix to adapt the image to blend over\n     * @param {Object} options\n     * @param {WebGLRenderingContext} options.context The GL context used for rendering.\n     * @param {Object} options.programCache A map of compiled shader programs, keyed by filter type.\n     */\n    calculateMatrix: function() {\n      var image = this.image,\n          width = image._element.width,\n          height = image._element.height;\n      return [\n        1 / image.scaleX, 0, 0,\n        0, 1 / image.scaleY, 0,\n        -image.left / width, -image.top / height, 1\n      ];\n    },\n\n    /**\n     * Apply the Blend operation to a Uint8ClampedArray representing the pixels of an image.\n     *\n     * @param {Object} options\n     * @param {ImageData} options.imageData The Uint8ClampedArray to be filtered.\n     */\n    applyTo2d: function(options) {\n      var imageData = options.imageData,\n          resources = options.filterBackend.resources,\n          data = imageData.data, iLen = data.length,\n          width = imageData.width,\n          height = imageData.height,\n          tr, tg, tb, ta,\n          r, g, b, a,\n          canvas1, context, image = this.image, blendData;\n\n      if (!resources.blendImage) {\n        resources.blendImage = fabric.util.createCanvasElement();\n      }\n      canvas1 = resources.blendImage;\n      context = canvas1.getContext('2d');\n      if (canvas1.width !== width || canvas1.height !== height) {\n        canvas1.width = width;\n        canvas1.height = height;\n      }\n      else {\n        context.clearRect(0, 0, width, height);\n      }\n      context.setTransform(image.scaleX, 0, 0, image.scaleY, image.left, image.top);\n      context.drawImage(image._element, 0, 0, width, height);\n      blendData = context.getImageData(0, 0, width, height).data;\n      for (var i = 0; i < iLen; i += 4) {\n\n        r = data[i];\n        g = data[i + 1];\n        b = data[i + 2];\n        a = data[i + 3];\n\n        tr = blendData[i];\n        tg = blendData[i + 1];\n        tb = blendData[i + 2];\n        ta = blendData[i + 3];\n\n        switch (this.mode) {\n          case 'multiply':\n            data[i] = r * tr / 255;\n            data[i + 1] = g * tg / 255;\n            data[i + 2] = b * tb / 255;\n            data[i + 3] = a * ta / 255;\n            break;\n          case 'mask':\n            data[i + 3] = ta;\n            break;\n        }\n      }\n    },\n\n    /**\n     * Return WebGL uniform locations for this filter's shader.\n     *\n     * @param {WebGLRenderingContext} gl The GL canvas context used to compile this filter's shader.\n     * @param {WebGLShaderProgram} program This filter's compiled shader program.\n     */\n    getUniformLocations: function(gl, program) {\n      return {\n        uTransformMatrix: gl.getUniformLocation(program, 'uTransformMatrix'),\n        uImage: gl.getUniformLocation(program, 'uImage'),\n      };\n    },\n\n    /**\n     * Send data from this filter to its shader program's uniforms.\n     *\n     * @param {WebGLRenderingContext} gl The GL canvas context used to compile this filter's shader.\n     * @param {Object} uniformLocations A map of string uniform names to WebGLUniformLocation objects\n     */\n    sendUniformData: function(gl, uniformLocations) {\n      var matrix = this.calculateMatrix();\n      gl.uniform1i(uniformLocations.uImage, 1); // texture unit 1.\n      gl.uniformMatrix3fv(uniformLocations.uTransformMatrix, false, matrix);\n    },\n\n    /**\n     * Returns object representation of an instance\n     * @return {Object} Object representation of an instance\n     */\n    toObject: function() {\n      return {\n        type: this.type,\n        image: this.image && this.image.toObject(),\n        mode: this.mode,\n        alpha: this.alpha\n      };\n    }\n  });\n\n  /**\n   * Returns filter instance from an object representation\n   * @static\n   * @param {Object} object Object to create an instance from\n   * @param {function} callback to be invoked after filter creation\n   * @return {fabric.Image.filters.BlendImage} Instance of fabric.Image.filters.BlendImage\n   */\n  fabric.Image.filters.BlendImage.fromObject = function(object, callback) {\n    fabric.Image.fromObject(object.image, function(image) {\n      var options = fabric.util.object.clone(object);\n      options.image = image;\n      callback(new fabric.Image.filters.BlendImage(options));\n    });\n  };\n\n})(typeof exports !== 'undefined' ? exports : this);\n\n\n(function(global) {\n\n  'use strict';\n\n  var fabric  = global.fabric || (global.fabric = { }), pow = Math.pow, floor = Math.floor,\n      sqrt = Math.sqrt, abs = Math.abs, round = Math.round, sin = Math.sin,\n      ceil = Math.ceil,\n      filters = fabric.Image.filters,\n      createClass = fabric.util.createClass;\n\n  /**\n   * Resize image filter class\n   * @class fabric.Image.filters.Resize\n   * @memberOf fabric.Image.filters\n   * @extends fabric.Image.filters.BaseFilter\n   * @see {@link http://fabricjs.com/image-filters|ImageFilters demo}\n   * @example\n   * var filter = new fabric.Image.filters.Resize();\n   * object.filters.push(filter);\n   * object.applyFilters(canvas.renderAll.bind(canvas));\n   */\n  filters.Resize = createClass(filters.BaseFilter, /** @lends fabric.Image.filters.Resize.prototype */ {\n\n    /**\n     * Filter type\n     * @param {String} type\n     * @default\n     */\n    type: 'Resize',\n\n    /**\n     * Resize type\n     * for webgl resizeType is just lanczos, for canvas2d can be:\n     * bilinear, hermite, sliceHack, lanczos.\n     * @param {String} resizeType\n     * @default\n     */\n    resizeType: 'hermite',\n\n    /**\n     * Scale factor for resizing, x axis\n     * @param {Number} scaleX\n     * @default\n     */\n    scaleX: 1,\n\n    /**\n     * Scale factor for resizing, y axis\n     * @param {Number} scaleY\n     * @default\n     */\n    scaleY: 1,\n\n    /**\n     * LanczosLobes parameter for lanczos filter, valid for resizeType lanczos\n     * @param {Number} lanczosLobes\n     * @default\n     */\n    lanczosLobes: 3,\n\n\n    /**\n     * Return WebGL uniform locations for this filter's shader.\n     *\n     * @param {WebGLRenderingContext} gl The GL canvas context used to compile this filter's shader.\n     * @param {WebGLShaderProgram} program This filter's compiled shader program.\n     */\n    getUniformLocations: function(gl, program) {\n      return {\n        uDelta: gl.getUniformLocation(program, 'uDelta'),\n        uTaps: gl.getUniformLocation(program, 'uTaps'),\n      };\n    },\n\n    /**\n     * Send data from this filter to its shader program's uniforms.\n     *\n     * @param {WebGLRenderingContext} gl The GL canvas context used to compile this filter's shader.\n     * @param {Object} uniformLocations A map of string uniform names to WebGLUniformLocation objects\n     */\n    sendUniformData: function(gl, uniformLocations) {\n      gl.uniform2fv(uniformLocations.uDelta, this.horizontal ? [1 / this.width, 0] : [0, 1 / this.height]);\n      gl.uniform1fv(uniformLocations.uTaps, this.taps);\n    },\n\n    /**\n     * Retrieves the cached shader.\n     * @param {Object} options\n     * @param {WebGLRenderingContext} options.context The GL context used for rendering.\n     * @param {Object} options.programCache A map of compiled shader programs, keyed by filter type.\n     */\n    retrieveShader: function(options) {\n      var filterWindow = this.getFilterWindow(), cacheKey = this.type + '_' + filterWindow;\n      if (!options.programCache.hasOwnProperty(cacheKey)) {\n        var fragmentShader = this.generateShader(filterWindow);\n        options.programCache[cacheKey] = this.createProgram(options.context, fragmentShader);\n      }\n      return options.programCache[cacheKey];\n    },\n\n    getFilterWindow: function() {\n      var scale = this.tempScale;\n      return Math.ceil(this.lanczosLobes / scale);\n    },\n\n    getTaps: function() {\n      var lobeFunction = this.lanczosCreate(this.lanczosLobes), scale = this.tempScale,\n          filterWindow = this.getFilterWindow(), taps = new Array(filterWindow);\n      for (var i = 1; i <= filterWindow; i++) {\n        taps[i - 1] = lobeFunction(i * scale);\n      }\n      return taps;\n    },\n\n    /**\n     * Generate vertex and shader sources from the necessary steps numbers\n     * @param {Number} filterWindow\n     */\n    generateShader: function(filterWindow) {\n      var offsets = new Array(filterWindow),\n          fragmentShader = this.fragmentSourceTOP, filterWindow;\n\n      for (var i = 1; i <= filterWindow; i++) {\n        offsets[i - 1] = i + '.0 * uDelta';\n      }\n\n      fragmentShader += 'uniform float uTaps[' + filterWindow + '];\\n';\n      fragmentShader += 'void main() {\\n';\n      fragmentShader += '  vec4 color = texture2D(uTexture, vTexCoord);\\n';\n      fragmentShader += '  float sum = 1.0;\\n';\n\n      offsets.forEach(function(offset, i) {\n        fragmentShader += '  color += texture2D(uTexture, vTexCoord + ' + offset + ') * uTaps[' + i + '];\\n';\n        fragmentShader += '  color += texture2D(uTexture, vTexCoord - ' + offset + ') * uTaps[' + i + '];\\n';\n        fragmentShader += '  sum += 2.0 * uTaps[' + i + '];\\n';\n      });\n      fragmentShader += '  gl_FragColor = color / sum;\\n';\n      fragmentShader += '}';\n      return fragmentShader;\n    },\n\n    fragmentSourceTOP: 'precision highp float;\\n' +\n      'uniform sampler2D uTexture;\\n' +\n      'uniform vec2 uDelta;\\n' +\n      'varying vec2 vTexCoord;\\n',\n\n    /**\n     * Apply the resize filter to the image\n     * Determines whether to use WebGL or Canvas2D based on the options.webgl flag.\n     *\n     * @param {Object} options\n     * @param {Number} options.passes The number of filters remaining to be executed\n     * @param {Boolean} options.webgl Whether to use webgl to render the filter.\n     * @param {WebGLTexture} options.sourceTexture The texture setup as the source to be filtered.\n     * @param {WebGLTexture} options.targetTexture The texture where filtered output should be drawn.\n     * @param {WebGLRenderingContext} options.context The GL context used for rendering.\n     * @param {Object} options.programCache A map of compiled shader programs, keyed by filter type.\n     */\n    applyTo: function(options) {\n      if (options.webgl) {\n        options.passes++;\n        this.width = options.sourceWidth;\n        this.horizontal = true;\n        this.dW = Math.round(this.width * this.scaleX);\n        this.dH = options.sourceHeight;\n        this.tempScale = this.dW / this.width;\n        this.taps = this.getTaps();\n        options.destinationWidth = this.dW;\n        this._setupFrameBuffer(options);\n        this.applyToWebGL(options);\n        this._swapTextures(options);\n        options.sourceWidth = options.destinationWidth;\n\n        this.height = options.sourceHeight;\n        this.horizontal = false;\n        this.dH = Math.round(this.height * this.scaleY);\n        this.tempScale = this.dH / this.height;\n        this.taps = this.getTaps();\n        options.destinationHeight = this.dH;\n        this._setupFrameBuffer(options);\n        this.applyToWebGL(options);\n        this._swapTextures(options);\n        options.sourceHeight = options.destinationHeight;\n      }\n      else {\n        this.applyTo2d(options);\n      }\n    },\n\n    isNeutralState: function() {\n      return this.scaleX === 1 && this.scaleY === 1;\n    },\n\n    lanczosCreate: function(lobes) {\n      return function(x) {\n        if (x >= lobes || x <= -lobes) {\n          return 0.0;\n        }\n        if (x < 1.19209290E-07 && x > -1.19209290E-07) {\n          return 1.0;\n        }\n        x *= Math.PI;\n        var xx = x / lobes;\n        return (sin(x) / x) * sin(xx) / xx;\n      };\n    },\n\n    /**\n     * Applies filter to canvas element\n     * @memberOf fabric.Image.filters.Resize.prototype\n     * @param {Object} canvasEl Canvas element to apply filter to\n     * @param {Number} scaleX\n     * @param {Number} scaleY\n     */\n    applyTo2d: function(options) {\n      var imageData = options.imageData,\n          scaleX = this.scaleX,\n          scaleY = this.scaleY;\n\n      this.rcpScaleX = 1 / scaleX;\n      this.rcpScaleY = 1 / scaleY;\n\n      var oW = imageData.width, oH = imageData.height,\n          dW = round(oW * scaleX), dH = round(oH * scaleY),\n          newData;\n\n      if (this.resizeType === 'sliceHack') {\n        newData = this.sliceByTwo(options, oW, oH, dW, dH);\n      }\n      else if (this.resizeType === 'hermite') {\n        newData = this.hermiteFastResize(options, oW, oH, dW, dH);\n      }\n      else if (this.resizeType === 'bilinear') {\n        newData = this.bilinearFiltering(options, oW, oH, dW, dH);\n      }\n      else if (this.resizeType === 'lanczos') {\n        newData = this.lanczosResize(options, oW, oH, dW, dH);\n      }\n      options.imageData = newData;\n    },\n\n    /**\n     * Filter sliceByTwo\n     * @param {Object} canvasEl Canvas element to apply filter to\n     * @param {Number} oW Original Width\n     * @param {Number} oH Original Height\n     * @param {Number} dW Destination Width\n     * @param {Number} dH Destination Height\n     * @returns {ImageData}\n     */\n    sliceByTwo: function(options, oW, oH, dW, dH) {\n      var imageData = options.imageData,\n          mult = 0.5, doneW = false, doneH = false, stepW = oW * mult,\n          stepH = oH * mult, resources = fabric.filterBackend.resources,\n          tmpCanvas, ctx, sX = 0, sY = 0, dX = oW, dY = 0;\n      if (!resources.sliceByTwo) {\n        resources.sliceByTwo = document.createElement('canvas');\n      }\n      tmpCanvas = resources.sliceByTwo;\n      if (tmpCanvas.width < oW * 1.5 || tmpCanvas.height < oH) {\n        tmpCanvas.width = oW * 1.5;\n        tmpCanvas.height = oH;\n      }\n      ctx = tmpCanvas.getContext('2d');\n      ctx.clearRect(0, 0, oW * 1.5, oH);\n      ctx.putImageData(imageData, 0, 0);\n\n      dW = floor(dW);\n      dH = floor(dH);\n\n      while (!doneW || !doneH) {\n        oW = stepW;\n        oH = stepH;\n        if (dW < floor(stepW * mult)) {\n          stepW = floor(stepW * mult);\n        }\n        else {\n          stepW = dW;\n          doneW = true;\n        }\n        if (dH < floor(stepH * mult)) {\n          stepH = floor(stepH * mult);\n        }\n        else {\n          stepH = dH;\n          doneH = true;\n        }\n        ctx.drawImage(tmpCanvas, sX, sY, oW, oH, dX, dY, stepW, stepH);\n        sX = dX;\n        sY = dY;\n        dY += stepH;\n      }\n      return ctx.getImageData(sX, sY, dW, dH);\n    },\n\n    /**\n     * Filter lanczosResize\n     * @param {Object} canvasEl Canvas element to apply filter to\n     * @param {Number} oW Original Width\n     * @param {Number} oH Original Height\n     * @param {Number} dW Destination Width\n     * @param {Number} dH Destination Height\n     * @returns {ImageData}\n     */\n    lanczosResize: function(options, oW, oH, dW, dH) {\n\n      function process(u) {\n        var v, i, weight, idx, a, red, green,\n            blue, alpha, fX, fY;\n        center.x = (u + 0.5) * ratioX;\n        icenter.x = floor(center.x);\n        for (v = 0; v < dH; v++) {\n          center.y = (v + 0.5) * ratioY;\n          icenter.y = floor(center.y);\n          a = 0; red = 0; green = 0; blue = 0; alpha = 0;\n          for (i = icenter.x - range2X; i <= icenter.x + range2X; i++) {\n            if (i < 0 || i >= oW) {\n              continue;\n            }\n            fX = floor(1000 * abs(i - center.x));\n            if (!cacheLanc[fX]) {\n              cacheLanc[fX] = { };\n            }\n            for (var j = icenter.y - range2Y; j <= icenter.y + range2Y; j++) {\n              if (j < 0 || j >= oH) {\n                continue;\n              }\n              fY = floor(1000 * abs(j - center.y));\n              if (!cacheLanc[fX][fY]) {\n                cacheLanc[fX][fY] = lanczos(sqrt(pow(fX * rcpRatioX, 2) + pow(fY * rcpRatioY, 2)) / 1000);\n              }\n              weight = cacheLanc[fX][fY];\n              if (weight > 0) {\n                idx = (j * oW + i) * 4;\n                a += weight;\n                red += weight * srcData[idx];\n                green += weight * srcData[idx + 1];\n                blue += weight * srcData[idx + 2];\n                alpha += weight * srcData[idx + 3];\n              }\n            }\n          }\n          idx = (v * dW + u) * 4;\n          destData[idx] = red / a;\n          destData[idx + 1] = green / a;\n          destData[idx + 2] = blue / a;\n          destData[idx + 3] = alpha / a;\n        }\n\n        if (++u < dW) {\n          return process(u);\n        }\n        else {\n          return destImg;\n        }\n      }\n\n      var srcData = options.imageData.data,\n          destImg = options.ctx.createImageData(dW, dH),\n          destData = destImg.data,\n          lanczos = this.lanczosCreate(this.lanczosLobes),\n          ratioX = this.rcpScaleX, ratioY = this.rcpScaleY,\n          rcpRatioX = 2 / this.rcpScaleX, rcpRatioY = 2 / this.rcpScaleY,\n          range2X = ceil(ratioX * this.lanczosLobes / 2),\n          range2Y = ceil(ratioY * this.lanczosLobes / 2),\n          cacheLanc = { }, center = { }, icenter = { };\n\n      return process(0);\n    },\n\n    /**\n     * bilinearFiltering\n     * @param {Object} canvasEl Canvas element to apply filter to\n     * @param {Number} oW Original Width\n     * @param {Number} oH Original Height\n     * @param {Number} dW Destination Width\n     * @param {Number} dH Destination Height\n     * @returns {ImageData}\n     */\n    bilinearFiltering: function(options, oW, oH, dW, dH) {\n      var a, b, c, d, x, y, i, j, xDiff, yDiff, chnl,\n          color, offset = 0, origPix, ratioX = this.rcpScaleX,\n          ratioY = this.rcpScaleY,\n          w4 = 4 * (oW - 1), img = options.imageData,\n          pixels = img.data, destImage = options.ctx.createImageData(dW, dH),\n          destPixels = destImage.data;\n      for (i = 0; i < dH; i++) {\n        for (j = 0; j < dW; j++) {\n          x = floor(ratioX * j);\n          y = floor(ratioY * i);\n          xDiff = ratioX * j - x;\n          yDiff = ratioY * i - y;\n          origPix = 4 * (y * oW + x);\n\n          for (chnl = 0; chnl < 4; chnl++) {\n            a = pixels[origPix + chnl];\n            b = pixels[origPix + 4 + chnl];\n            c = pixels[origPix + w4 + chnl];\n            d = pixels[origPix + w4 + 4 + chnl];\n            color = a * (1 - xDiff) * (1 - yDiff) + b * xDiff * (1 - yDiff) +\n                    c * yDiff * (1 - xDiff) + d * xDiff * yDiff;\n            destPixels[offset++] = color;\n          }\n        }\n      }\n      return destImage;\n    },\n\n    /**\n     * hermiteFastResize\n     * @param {Object} canvasEl Canvas element to apply filter to\n     * @param {Number} oW Original Width\n     * @param {Number} oH Original Height\n     * @param {Number} dW Destination Width\n     * @param {Number} dH Destination Height\n     * @returns {ImageData}\n     */\n    hermiteFastResize: function(options, oW, oH, dW, dH) {\n      var ratioW = this.rcpScaleX, ratioH = this.rcpScaleY,\n          ratioWHalf = ceil(ratioW / 2),\n          ratioHHalf = ceil(ratioH / 2),\n          img = options.imageData, data = img.data,\n          img2 = options.ctx.createImageData(dW, dH), data2 = img2.data;\n      for (var j = 0; j < dH; j++) {\n        for (var i = 0; i < dW; i++) {\n          var x2 = (i + j * dW) * 4, weight = 0, weights = 0, weightsAlpha = 0,\n              gxR = 0, gxG = 0, gxB = 0, gxA = 0, centerY = (j + 0.5) * ratioH;\n          for (var yy = floor(j * ratioH); yy < (j + 1) * ratioH; yy++) {\n            var dy = abs(centerY - (yy + 0.5)) / ratioHHalf,\n                centerX = (i + 0.5) * ratioW, w0 = dy * dy;\n            for (var xx = floor(i * ratioW); xx < (i + 1) * ratioW; xx++) {\n              var dx = abs(centerX - (xx + 0.5)) / ratioWHalf,\n                  w = sqrt(w0 + dx * dx);\n              /* eslint-disable max-depth */\n              if (w > 1 && w < -1) {\n                continue;\n              }\n              //hermite filter\n              weight = 2 * w * w * w - 3 * w * w + 1;\n              if (weight > 0) {\n                dx = 4 * (xx + yy * oW);\n                //alpha\n                gxA += weight * data[dx + 3];\n                weightsAlpha += weight;\n                //colors\n                if (data[dx + 3] < 255) {\n                  weight = weight * data[dx + 3] / 250;\n                }\n                gxR += weight * data[dx];\n                gxG += weight * data[dx + 1];\n                gxB += weight * data[dx + 2];\n                weights += weight;\n              }\n              /* eslint-enable max-depth */\n            }\n          }\n          data2[x2] = gxR / weights;\n          data2[x2 + 1] = gxG / weights;\n          data2[x2 + 2] = gxB / weights;\n          data2[x2 + 3] = gxA / weightsAlpha;\n        }\n      }\n      return img2;\n    },\n\n    /**\n     * Returns object representation of an instance\n     * @return {Object} Object representation of an instance\n     */\n    toObject: function() {\n      return {\n        type: this.type,\n        scaleX: this.scaleX,\n        scaleY: this.scaleY,\n        resizeType: this.resizeType,\n        lanczosLobes: this.lanczosLobes\n      };\n    }\n  });\n\n  /**\n   * Returns filter instance from an object representation\n   * @static\n   * @param {Object} object Object to create an instance from\n   * @param {Function} [callback] to be invoked after filter creation\n   * @return {fabric.Image.filters.Resize} Instance of fabric.Image.filters.Resize\n   */\n  fabric.Image.filters.Resize.fromObject = fabric.Image.filters.BaseFilter.fromObject;\n\n})(typeof exports !== 'undefined' ? exports : this);\n\n\n(function(global) {\n\n  'use strict';\n\n  var fabric  = global.fabric || (global.fabric = { }),\n      filters = fabric.Image.filters,\n      createClass = fabric.util.createClass;\n\n  /**\n   * Contrast filter class\n   * @class fabric.Image.filters.Contrast\n   * @memberOf fabric.Image.filters\n   * @extends fabric.Image.filters.BaseFilter\n   * @see {@link fabric.Image.filters.Contrast#initialize} for constructor definition\n   * @see {@link http://fabricjs.com/image-filters|ImageFilters demo}\n   * @example\n   * var filter = new fabric.Image.filters.Contrast({\n   *   contrast: 0.25\n   * });\n   * object.filters.push(filter);\n   * object.applyFilters();\n   */\n  filters.Contrast = createClass(filters.BaseFilter, /** @lends fabric.Image.filters.Contrast.prototype */ {\n\n    /**\n     * Filter type\n     * @param {String} type\n     * @default\n     */\n    type: 'Contrast',\n\n    fragmentSource: 'precision highp float;\\n' +\n      'uniform sampler2D uTexture;\\n' +\n      'uniform float uContrast;\\n' +\n      'varying vec2 vTexCoord;\\n' +\n      'void main() {\\n' +\n        'vec4 color = texture2D(uTexture, vTexCoord);\\n' +\n        'float contrastF = 1.015 * (uContrast + 1.0) / (1.0 * (1.015 - uContrast));\\n' +\n        'color.rgb = contrastF * (color.rgb - 0.5) + 0.5;\\n' +\n        'gl_FragColor = color;\\n' +\n      '}',\n\n    /**\n     * contrast value, range from -1 to 1.\n     * @param {Number} contrast\n     * @default 0\n     */\n    contrast: 0,\n\n    mainParameter: 'contrast',\n\n    /**\n     * Constructor\n     * @memberOf fabric.Image.filters.Contrast.prototype\n     * @param {Object} [options] Options object\n     * @param {Number} [options.contrast=0] Value to contrast the image up (-1...1)\n     */\n\n    /**\n      * Apply the Contrast operation to a Uint8Array representing the pixels of an image.\n      *\n      * @param {Object} options\n      * @param {ImageData} options.imageData The Uint8Array to be filtered.\n      */\n    applyTo2d: function(options) {\n      if (this.contrast === 0) {\n        return;\n      }\n      var imageData = options.imageData, i, len,\n          data = imageData.data, len = data.length,\n          contrast = Math.floor(this.contrast * 255),\n          contrastF = 259 * (contrast + 255) / (255 * (259 - contrast));\n\n      for (i = 0; i < len; i += 4) {\n        data[i] = contrastF * (data[i] - 128) + 128;\n        data[i + 1] = contrastF * (data[i + 1] - 128) + 128;\n        data[i + 2] = contrastF * (data[i + 2] - 128) + 128;\n      }\n    },\n\n    /**\n     * Return WebGL uniform locations for this filter's shader.\n     *\n     * @param {WebGLRenderingContext} gl The GL canvas context used to compile this filter's shader.\n     * @param {WebGLShaderProgram} program This filter's compiled shader program.\n     */\n    getUniformLocations: function(gl, program) {\n      return {\n        uContrast: gl.getUniformLocation(program, 'uContrast'),\n      };\n    },\n\n    /**\n     * Send data from this filter to its shader program's uniforms.\n     *\n     * @param {WebGLRenderingContext} gl The GL canvas context used to compile this filter's shader.\n     * @param {Object} uniformLocations A map of string uniform names to WebGLUniformLocation objects\n     */\n    sendUniformData: function(gl, uniformLocations) {\n      gl.uniform1f(uniformLocations.uContrast, this.contrast);\n    },\n  });\n\n  /**\n   * Returns filter instance from an object representation\n   * @static\n   * @param {Object} object Object to create an instance from\n   * @param {function} [callback] to be invoked after filter creation\n   * @return {fabric.Image.filters.Contrast} Instance of fabric.Image.filters.Contrast\n   */\n  fabric.Image.filters.Contrast.fromObject = fabric.Image.filters.BaseFilter.fromObject;\n\n})(typeof exports !== 'undefined' ? exports : this);\n\n\n(function(global) {\n\n  'use strict';\n\n  var fabric  = global.fabric || (global.fabric = { }),\n      filters = fabric.Image.filters,\n      createClass = fabric.util.createClass;\n\n  /**\n   * Saturate filter class\n   * @class fabric.Image.filters.Saturation\n   * @memberOf fabric.Image.filters\n   * @extends fabric.Image.filters.BaseFilter\n   * @see {@link fabric.Image.filters.Saturation#initialize} for constructor definition\n   * @see {@link http://fabricjs.com/image-filters|ImageFilters demo}\n   * @example\n   * var filter = new fabric.Image.filters.Saturation({\n   *   saturation: 1\n   * });\n   * object.filters.push(filter);\n   * object.applyFilters();\n   */\n  filters.Saturation = createClass(filters.BaseFilter, /** @lends fabric.Image.filters.Saturation.prototype */ {\n\n    /**\n     * Filter type\n     * @param {String} type\n     * @default\n     */\n    type: 'Saturation',\n\n    fragmentSource: 'precision highp float;\\n' +\n      'uniform sampler2D uTexture;\\n' +\n      'uniform float uSaturation;\\n' +\n      'varying vec2 vTexCoord;\\n' +\n      'void main() {\\n' +\n        'vec4 color = texture2D(uTexture, vTexCoord);\\n' +\n        'float rgMax = max(color.r, color.g);\\n' +\n        'float rgbMax = max(rgMax, color.b);\\n' +\n        'color.r += rgbMax != color.r ? (rgbMax - color.r) * uSaturation : 0.00;\\n' +\n        'color.g += rgbMax != color.g ? (rgbMax - color.g) * uSaturation : 0.00;\\n' +\n        'color.b += rgbMax != color.b ? (rgbMax - color.b) * uSaturation : 0.00;\\n' +\n        'gl_FragColor = color;\\n' +\n      '}',\n\n    /**\n     * Saturation value, from -1 to 1.\n     * Increases/decreases the color saturation.\n     * A value of 0 has no effect.\n     * \n     * @param {Number} saturation\n     * @default\n     */\n    saturation: 0,\n\n    mainParameter: 'saturation',\n\n    /**\n     * Constructor\n     * @memberOf fabric.Image.filters.Saturate.prototype\n     * @param {Object} [options] Options object\n     * @param {Number} [options.saturate=0] Value to saturate the image (-1...1)\n     */\n\n    /**\n     * Apply the Saturation operation to a Uint8ClampedArray representing the pixels of an image.\n     *\n     * @param {Object} options\n     * @param {ImageData} options.imageData The Uint8ClampedArray to be filtered.\n     */\n    applyTo2d: function(options) {\n      if (this.saturation === 0) {\n        return;\n      }\n      var imageData = options.imageData,\n          data = imageData.data, len = data.length,\n          adjust = -this.saturation, i, max;\n\n      for (i = 0; i < len; i += 4) {\n        max = Math.max(data[i], data[i + 1], data[i + 2]);\n        data[i] += max !== data[i] ? (max - data[i]) * adjust : 0;\n        data[i + 1] += max !== data[i + 1] ? (max - data[i + 1]) * adjust : 0;\n        data[i + 2] += max !== data[i + 2] ? (max - data[i + 2]) * adjust : 0;\n      }\n    },\n\n    /**\n     * Return WebGL uniform locations for this filter's shader.\n     *\n     * @param {WebGLRenderingContext} gl The GL canvas context used to compile this filter's shader.\n     * @param {WebGLShaderProgram} program This filter's compiled shader program.\n     */\n    getUniformLocations: function(gl, program) {\n      return {\n        uSaturation: gl.getUniformLocation(program, 'uSaturation'),\n      };\n    },\n\n    /**\n     * Send data from this filter to its shader program's uniforms.\n     *\n     * @param {WebGLRenderingContext} gl The GL canvas context used to compile this filter's shader.\n     * @param {Object} uniformLocations A map of string uniform names to WebGLUniformLocation objects\n     */\n    sendUniformData: function(gl, uniformLocations) {\n      gl.uniform1f(uniformLocations.uSaturation, -this.saturation);\n    },\n  });\n\n  /**\n   * Returns filter instance from an object representation\n   * @static\n   * @param {Object} object Object to create an instance from\n   * @param {Function} [callback] to be invoked after filter creation\n   * @return {fabric.Image.filters.Saturation} Instance of fabric.Image.filters.Saturate\n   */\n  fabric.Image.filters.Saturation.fromObject = fabric.Image.filters.BaseFilter.fromObject;\n\n})(typeof exports !== 'undefined' ? exports : this);\n\n\n(function(global) {\n\n  'use strict';\n\n  var fabric  = global.fabric || (global.fabric = { }),\n      filters = fabric.Image.filters,\n      createClass = fabric.util.createClass;\n\n  /**\n   * Vibrance filter class\n   * @class fabric.Image.filters.Vibrance\n   * @memberOf fabric.Image.filters\n   * @extends fabric.Image.filters.BaseFilter\n   * @see {@link fabric.Image.filters.Vibrance#initialize} for constructor definition\n   * @see {@link http://fabricjs.com/image-filters|ImageFilters demo}\n   * @example\n   * var filter = new fabric.Image.filters.Vibrance({\n   *   vibrance: 1\n   * });\n   * object.filters.push(filter);\n   * object.applyFilters();\n   */\n  filters.Vibrance = createClass(filters.BaseFilter, /** @lends fabric.Image.filters.Vibrance.prototype */ {\n\n    /**\n     * Filter type\n     * @param {String} type\n     * @default\n     */\n    type: 'Vibrance',\n\n    fragmentSource: 'precision highp float;\\n' +\n      'uniform sampler2D uTexture;\\n' +\n      'uniform float uVibrance;\\n' +\n      'varying vec2 vTexCoord;\\n' +\n      'void main() {\\n' +\n        'vec4 color = texture2D(uTexture, vTexCoord);\\n' +\n        'float max = max(color.r, max(color.g, color.b));\\n' +\n        'float avg = (color.r + color.g + color.b) / 3.0;\\n' +\n        'float amt = (abs(max - avg) * 2.0) * uVibrance;\\n' +\n        'color.r += max != color.r ? (max - color.r) * amt : 0.00;\\n' +\n        'color.g += max != color.g ? (max - color.g) * amt : 0.00;\\n' +\n        'color.b += max != color.b ? (max - color.b) * amt : 0.00;\\n' +\n        'gl_FragColor = color;\\n' +\n      '}',\n\n    /**\n     * Vibrance value, from -1 to 1.\n     * Increases/decreases the saturation of more muted colors with less effect on saturated colors.\n     * A value of 0 has no effect.\n     * \n     * @param {Number} vibrance\n     * @default\n     */\n    vibrance: 0,\n\n    mainParameter: 'vibrance',\n\n    /**\n     * Constructor\n     * @memberOf fabric.Image.filters.Vibrance.prototype\n     * @param {Object} [options] Options object\n     * @param {Number} [options.vibrance=0] Vibrance value for the image (between -1 and 1)\n     */\n\n    /**\n     * Apply the Vibrance operation to a Uint8ClampedArray representing the pixels of an image.\n     *\n     * @param {Object} options\n     * @param {ImageData} options.imageData The Uint8ClampedArray to be filtered.\n     */\n    applyTo2d: function(options) {\n      if (this.vibrance === 0) {\n        return;\n      }\n      var imageData = options.imageData,\n          data = imageData.data, len = data.length,\n          adjust = -this.vibrance, i, max, avg, amt;\n\n      for (i = 0; i < len; i += 4) {\n        max = Math.max(data[i], data[i + 1], data[i + 2]);\n        avg = (data[i] + data[i + 1] + data[i + 2]) / 3;\n        amt = ((Math.abs(max - avg) * 2 / 255) * adjust);\n        data[i] += max !== data[i] ? (max - data[i]) * amt : 0;\n        data[i + 1] += max !== data[i + 1] ? (max - data[i + 1]) * amt : 0;\n        data[i + 2] += max !== data[i + 2] ? (max - data[i + 2]) * amt : 0;\n      }\n    },\n\n    /**\n     * Return WebGL uniform locations for this filter's shader.\n     *\n     * @param {WebGLRenderingContext} gl The GL canvas context used to compile this filter's shader.\n     * @param {WebGLShaderProgram} program This filter's compiled shader program.\n     */\n    getUniformLocations: function(gl, program) {\n      return {\n        uVibrance: gl.getUniformLocation(program, 'uVibrance'),\n      };\n    },\n\n    /**\n     * Send data from this filter to its shader program's uniforms.\n     *\n     * @param {WebGLRenderingContext} gl The GL canvas context used to compile this filter's shader.\n     * @param {Object} uniformLocations A map of string uniform names to WebGLUniformLocation objects\n     */\n    sendUniformData: function(gl, uniformLocations) {\n      gl.uniform1f(uniformLocations.uVibrance, -this.vibrance);\n    },\n  });\n\n  /**\n   * Returns filter instance from an object representation\n   * @static\n   * @param {Object} object Object to create an instance from\n   * @param {Function} [callback] to be invoked after filter creation\n   * @return {fabric.Image.filters.Vibrance} Instance of fabric.Image.filters.Vibrance\n   */\n  fabric.Image.filters.Vibrance.fromObject = fabric.Image.filters.BaseFilter.fromObject;\n\n})(typeof exports !== 'undefined' ? exports : this);\n\n\n(function(global) {\n\n  'use strict';\n\n  var fabric  = global.fabric || (global.fabric = { }),\n      filters = fabric.Image.filters,\n      createClass = fabric.util.createClass;\n\n  /**\n   * Blur filter class\n   * @class fabric.Image.filters.Blur\n   * @memberOf fabric.Image.filters\n   * @extends fabric.Image.filters.BaseFilter\n   * @see {@link fabric.Image.filters.Blur#initialize} for constructor definition\n   * @see {@link http://fabricjs.com/image-filters|ImageFilters demo}\n   * @example\n   * var filter = new fabric.Image.filters.Blur({\n   *   blur: 0.5\n   * });\n   * object.filters.push(filter);\n   * object.applyFilters();\n   * canvas.renderAll();\n   */\n  filters.Blur = createClass(filters.BaseFilter, /** @lends fabric.Image.filters.Blur.prototype */ {\n\n    type: 'Blur',\n\n    /*\n'gl_FragColor = vec4(0.0);',\n'gl_FragColor += texture2D(texture, vTexCoord + -7 * uDelta)*0.0044299121055113265;',\n'gl_FragColor += texture2D(texture, vTexCoord + -6 * uDelta)*0.00895781211794;',\n'gl_FragColor += texture2D(texture, vTexCoord + -5 * uDelta)*0.0215963866053;',\n'gl_FragColor += texture2D(texture, vTexCoord + -4 * uDelta)*0.0443683338718;',\n'gl_FragColor += texture2D(texture, vTexCoord + -3 * uDelta)*0.0776744219933;',\n'gl_FragColor += texture2D(texture, vTexCoord + -2 * uDelta)*0.115876621105;',\n'gl_FragColor += texture2D(texture, vTexCoord + -1 * uDelta)*0.147308056121;',\n'gl_FragColor += texture2D(texture, vTexCoord              )*0.159576912161;',\n'gl_FragColor += texture2D(texture, vTexCoord + 1 * uDelta)*0.147308056121;',\n'gl_FragColor += texture2D(texture, vTexCoord + 2 * uDelta)*0.115876621105;',\n'gl_FragColor += texture2D(texture, vTexCoord + 3 * uDelta)*0.0776744219933;',\n'gl_FragColor += texture2D(texture, vTexCoord + 4 * uDelta)*0.0443683338718;',\n'gl_FragColor += texture2D(texture, vTexCoord + 5 * uDelta)*0.0215963866053;',\n'gl_FragColor += texture2D(texture, vTexCoord + 6 * uDelta)*0.00895781211794;',\n'gl_FragColor += texture2D(texture, vTexCoord + 7 * uDelta)*0.0044299121055113265;',\n*/\n\n    /* eslint-disable max-len */\n    fragmentSource: 'precision highp float;\\n' +\n      'uniform sampler2D uTexture;\\n' +\n      'uniform vec2 uDelta;\\n' +\n      'varying vec2 vTexCoord;\\n' +\n      'const float nSamples = 15.0;\\n' +\n      'vec3 v3offset = vec3(12.9898, 78.233, 151.7182);\\n' +\n      'float random(vec3 scale) {\\n' +\n        /* use the fragment position for a different seed per-pixel */\n        'return fract(sin(dot(gl_FragCoord.xyz, scale)) * 43758.5453);\\n' +\n      '}\\n' +\n      'void main() {\\n' +\n        'vec4 color = vec4(0.0);\\n' +\n        'float total = 0.0;\\n' +\n        'float offset = random(v3offset);\\n' +\n        'for (float t = -nSamples; t <= nSamples; t++) {\\n' +\n          'float percent = (t + offset - 0.5) / nSamples;\\n' +\n          'float weight = 1.0 - abs(percent);\\n' +\n          'color += texture2D(uTexture, vTexCoord + uDelta * percent) * weight;\\n' +\n          'total += weight;\\n' +\n        '}\\n' +\n        'gl_FragColor = color / total;\\n' +\n      '}',\n    /* eslint-enable max-len */\n\n    /**\n     * blur value, in percentage of image dimensions.\n     * specific to keep the image blur constant at different resolutions\n     * range between 0 and 1.\n     * @type Number\n     * @default\n     */\n    blur: 0,\n\n    mainParameter: 'blur',\n\n    applyTo: function(options) {\n      if (options.webgl) {\n        // this aspectRatio is used to give the same blur to vertical and horizontal\n        this.aspectRatio = options.sourceWidth / options.sourceHeight;\n        options.passes++;\n        this._setupFrameBuffer(options);\n        this.horizontal = true;\n        this.applyToWebGL(options);\n        this._swapTextures(options);\n        this._setupFrameBuffer(options);\n        this.horizontal = false;\n        this.applyToWebGL(options);\n        this._swapTextures(options);\n      }\n      else {\n        this.applyTo2d(options);\n      }\n    },\n\n    applyTo2d: function(options) {\n      // paint canvasEl with current image data.\n      //options.ctx.putImageData(options.imageData, 0, 0);\n      options.imageData = this.simpleBlur(options);\n    },\n\n    simpleBlur: function(options) {\n      var resources = options.filterBackend.resources, canvas1, canvas2,\n          width = options.imageData.width,\n          height = options.imageData.height;\n\n      if (!resources.blurLayer1) {\n        resources.blurLayer1 = fabric.util.createCanvasElement();\n        resources.blurLayer2 = fabric.util.createCanvasElement();\n      }\n      canvas1 = resources.blurLayer1;\n      canvas2 = resources.blurLayer2;\n      if (canvas1.width !== width || canvas1.height !== height) {\n        canvas2.width = canvas1.width = width;\n        canvas2.height = canvas1.height = height;\n      }\n      var ctx1 = canvas1.getContext('2d'),\n          ctx2 = canvas2.getContext('2d'),\n          nSamples = 15,\n          random, percent, j, i,\n          blur = this.blur * 0.06 * 0.5;\n\n      // load first canvas\n      ctx1.putImageData(options.imageData, 0, 0);\n      ctx2.clearRect(0, 0, width, height);\n\n      for (i = -nSamples; i <= nSamples; i++) {\n        random = (Math.random() - 0.5) / 4;\n        percent = i / nSamples;\n        j = blur * percent * width + random;\n        ctx2.globalAlpha = 1 - Math.abs(percent);\n        ctx2.drawImage(canvas1, j, random);\n        ctx1.drawImage(canvas2, 0, 0);\n        ctx2.globalAlpha = 1;\n        ctx2.clearRect(0, 0, canvas2.width, canvas2.height);\n      }\n      for (i = -nSamples; i <= nSamples; i++) {\n        random = (Math.random() - 0.5) / 4;\n        percent = i / nSamples;\n        j = blur * percent * height + random;\n        ctx2.globalAlpha = 1 - Math.abs(percent);\n        ctx2.drawImage(canvas1, random, j);\n        ctx1.drawImage(canvas2, 0, 0);\n        ctx2.globalAlpha = 1;\n        ctx2.clearRect(0, 0, canvas2.width, canvas2.height);\n      }\n      options.ctx.drawImage(canvas1, 0, 0);\n      var newImageData = options.ctx.getImageData(0, 0, canvas1.width, canvas1.height);\n      ctx1.globalAlpha = 1;\n      ctx1.clearRect(0, 0, canvas1.width, canvas1.height);\n      return newImageData;\n    },\n\n    /**\n     * Return WebGL uniform locations for this filter's shader.\n     *\n     * @param {WebGLRenderingContext} gl The GL canvas context used to compile this filter's shader.\n     * @param {WebGLShaderProgram} program This filter's compiled shader program.\n     */\n    getUniformLocations: function(gl, program) {\n      return {\n        delta: gl.getUniformLocation(program, 'uDelta'),\n      };\n    },\n\n    /**\n     * Send data from this filter to its shader program's uniforms.\n     *\n     * @param {WebGLRenderingContext} gl The GL canvas context used to compile this filter's shader.\n     * @param {Object} uniformLocations A map of string uniform names to WebGLUniformLocation objects\n     */\n    sendUniformData: function(gl, uniformLocations) {\n      var delta = this.chooseRightDelta();\n      gl.uniform2fv(uniformLocations.delta, delta);\n    },\n\n    /**\n     * choose right value of image percentage to blur with\n     * @returns {Array} a numeric array with delta values\n     */\n    chooseRightDelta: function() {\n      var blurScale = 1, delta = [0, 0], blur;\n      if (this.horizontal) {\n        if (this.aspectRatio > 1) {\n          // image is wide, i want to shrink radius horizontal\n          blurScale = 1 / this.aspectRatio;\n        }\n      }\n      else {\n        if (this.aspectRatio < 1) {\n          // image is tall, i want to shrink radius vertical\n          blurScale = this.aspectRatio;\n        }\n      }\n      blur = blurScale * this.blur * 0.12;\n      if (this.horizontal) {\n        delta[0] = blur;\n      }\n      else {\n        delta[1] = blur;\n      }\n      return delta;\n    },\n  });\n\n  /**\n   * Deserialize a JSON definition of a BlurFilter into a concrete instance.\n   */\n  filters.Blur.fromObject = fabric.Image.filters.BaseFilter.fromObject;\n\n})(typeof exports !== 'undefined' ? exports : this);\n\n\n(function(global) {\n\n  'use strict';\n\n  var fabric  = global.fabric || (global.fabric = { }),\n      filters = fabric.Image.filters,\n      createClass = fabric.util.createClass;\n\n  /**\n   * Gamma filter class\n   * @class fabric.Image.filters.Gamma\n   * @memberOf fabric.Image.filters\n   * @extends fabric.Image.filters.BaseFilter\n   * @see {@link fabric.Image.filters.Gamma#initialize} for constructor definition\n   * @see {@link http://fabricjs.com/image-filters|ImageFilters demo}\n   * @example\n   * var filter = new fabric.Image.filters.Gamma({\n   *   gamma: [1, 0.5, 2.1]\n   * });\n   * object.filters.push(filter);\n   * object.applyFilters();\n   */\n  filters.Gamma = createClass(filters.BaseFilter, /** @lends fabric.Image.filters.Gamma.prototype */ {\n\n    /**\n     * Filter type\n     * @param {String} type\n     * @default\n     */\n    type: 'Gamma',\n\n    fragmentSource: 'precision highp float;\\n' +\n      'uniform sampler2D uTexture;\\n' +\n      'uniform vec3 uGamma;\\n' +\n      'varying vec2 vTexCoord;\\n' +\n      'void main() {\\n' +\n        'vec4 color = texture2D(uTexture, vTexCoord);\\n' +\n        'vec3 correction = (1.0 / uGamma);\\n' +\n        'color.r = pow(color.r, correction.r);\\n' +\n        'color.g = pow(color.g, correction.g);\\n' +\n        'color.b = pow(color.b, correction.b);\\n' +\n        'gl_FragColor = color;\\n' +\n        'gl_FragColor.rgb *= color.a;\\n' +\n      '}',\n\n    /**\n     * Gamma array value, from 0.01 to 2.2.\n     * @param {Array} gamma\n     * @default\n     */\n    gamma: [1, 1, 1],\n\n    /**\n     * Describe the property that is the filter parameter\n     * @param {String} m\n     * @default\n     */\n    mainParameter: 'gamma',\n\n    /**\n     * Constructor\n     * @param {Object} [options] Options object\n     */\n    initialize: function(options) {\n      this.gamma = [1, 1, 1];\n      filters.BaseFilter.prototype.initialize.call(this, options);\n    },\n\n    /**\n     * Apply the Gamma operation to a Uint8Array representing the pixels of an image.\n     *\n     * @param {Object} options\n     * @param {ImageData} options.imageData The Uint8Array to be filtered.\n     */\n    applyTo2d: function(options) {\n      var imageData = options.imageData, data = imageData.data,\n          gamma = this.gamma, len = data.length,\n          rInv = 1 / gamma[0], gInv = 1 / gamma[1],\n          bInv = 1 / gamma[2], i;\n\n      if (!this.rVals) {\n        // eslint-disable-next-line\n        this.rVals = new Uint8Array(256);\n        // eslint-disable-next-line\n        this.gVals = new Uint8Array(256);\n        // eslint-disable-next-line\n        this.bVals = new Uint8Array(256);\n      }\n\n      // This is an optimization - pre-compute a look-up table for each color channel\n      // instead of performing these pow calls for each pixel in the image.\n      for (i = 0, len = 256; i < len; i++) {\n        this.rVals[i] = Math.pow(i / 255, rInv) * 255;\n        this.gVals[i] = Math.pow(i / 255, gInv) * 255;\n        this.bVals[i] = Math.pow(i / 255, bInv) * 255;\n      }\n      for (i = 0, len = data.length; i < len; i += 4) {\n        data[i] = this.rVals[data[i]];\n        data[i + 1] = this.gVals[data[i + 1]];\n        data[i + 2] = this.bVals[data[i + 2]];\n      }\n    },\n\n    /**\n     * Return WebGL uniform locations for this filter's shader.\n     *\n     * @param {WebGLRenderingContext} gl The GL canvas context used to compile this filter's shader.\n     * @param {WebGLShaderProgram} program This filter's compiled shader program.\n     */\n    getUniformLocations: function(gl, program) {\n      return {\n        uGamma: gl.getUniformLocation(program, 'uGamma'),\n      };\n    },\n\n    /**\n     * Send data from this filter to its shader program's uniforms.\n     *\n     * @param {WebGLRenderingContext} gl The GL canvas context used to compile this filter's shader.\n     * @param {Object} uniformLocations A map of string uniform names to WebGLUniformLocation objects\n     */\n    sendUniformData: function(gl, uniformLocations) {\n      gl.uniform3fv(uniformLocations.uGamma, this.gamma);\n    },\n  });\n\n  /**\n   * Returns filter instance from an object representation\n   * @static\n   * @param {Object} object Object to create an instance from\n   * @param {function} [callback] to be invoked after filter creation\n   * @return {fabric.Image.filters.Gamma} Instance of fabric.Image.filters.Gamma\n   */\n  fabric.Image.filters.Gamma.fromObject = fabric.Image.filters.BaseFilter.fromObject;\n\n})(typeof exports !== 'undefined' ? exports : this);\n\n\n(function(global) {\n\n  'use strict';\n\n  var fabric  = global.fabric || (global.fabric = { }),\n      filters = fabric.Image.filters,\n      createClass = fabric.util.createClass;\n\n  /**\n   * A container class that knows how to apply a sequence of filters to an input image.\n   */\n  filters.Composed = createClass(filters.BaseFilter, /** @lends fabric.Image.filters.Composed.prototype */ {\n\n    type: 'Composed',\n\n    /**\n     * A non sparse array of filters to apply\n     */\n    subFilters: [],\n\n    /**\n     * Constructor\n     * @param {Object} [options] Options object\n     */\n    initialize: function(options) {\n      this.callSuper('initialize', options);\n      // create a new array instead mutating the prototype with push\n      this.subFilters = this.subFilters.slice(0);\n    },\n\n    /**\n     * Apply this container's filters to the input image provided.\n     *\n     * @param {Object} options\n     * @param {Number} options.passes The number of filters remaining to be applied.\n     */\n    applyTo: function(options) {\n      options.passes += this.subFilters.length - 1;\n      this.subFilters.forEach(function(filter) {\n        filter.applyTo(options);\n      });\n    },\n\n    /**\n     * Serialize this filter into JSON.\n     *\n     * @returns {Object} A JSON representation of this filter.\n     */\n    toObject: function() {\n      return fabric.util.object.extend(this.callSuper('toObject'), {\n        subFilters: this.subFilters.map(function(filter) { return filter.toObject(); }),\n      });\n    },\n\n    isNeutralState: function() {\n      return !this.subFilters.some(function(filter) { return !filter.isNeutralState(); });\n    }\n  });\n\n  /**\n   * Deserialize a JSON definition of a ComposedFilter into a concrete instance.\n   */\n  fabric.Image.filters.Composed.fromObject = function(object, callback) {\n    var filters = object.subFilters || [],\n        subFilters = filters.map(function(filter) {\n          return new fabric.Image.filters[filter.type](filter);\n        }),\n        instance = new fabric.Image.filters.Composed({ subFilters: subFilters });\n    callback && callback(instance);\n    return instance;\n  };\n})(typeof exports !== 'undefined' ? exports : this);\n\n\n(function(global) {\n\n  'use strict';\n\n  var fabric  = global.fabric || (global.fabric = { }),\n      filters = fabric.Image.filters,\n      createClass = fabric.util.createClass;\n\n  /**\n   * HueRotation filter class\n   * @class fabric.Image.filters.HueRotation\n   * @memberOf fabric.Image.filters\n   * @extends fabric.Image.filters.BaseFilter\n   * @see {@link fabric.Image.filters.HueRotation#initialize} for constructor definition\n   * @see {@link http://fabricjs.com/image-filters|ImageFilters demo}\n   * @example\n   * var filter = new fabric.Image.filters.HueRotation({\n   *   rotation: -0.5\n   * });\n   * object.filters.push(filter);\n   * object.applyFilters();\n   */\n  filters.HueRotation = createClass(filters.ColorMatrix, /** @lends fabric.Image.filters.HueRotation.prototype */ {\n\n    /**\n     * Filter type\n     * @param {String} type\n     * @default\n     */\n    type: 'HueRotation',\n\n    /**\n     * HueRotation value, from -1 to 1.\n     * the unit is radians\n     * @param {Number} myParameter\n     * @default\n     */\n    rotation: 0,\n\n    /**\n     * Describe the property that is the filter parameter\n     * @param {String} m\n     * @default\n     */\n    mainParameter: 'rotation',\n\n    calculateMatrix: function() {\n      var rad = this.rotation * Math.PI, cos = fabric.util.cos(rad), sin = fabric.util.sin(rad),\n          aThird = 1 / 3, aThirdSqtSin = Math.sqrt(aThird) * sin, OneMinusCos = 1 - cos;\n      this.matrix = [\n        1, 0, 0, 0, 0,\n        0, 1, 0, 0, 0,\n        0, 0, 1, 0, 0,\n        0, 0, 0, 1, 0\n      ];\n      this.matrix[0] = cos + OneMinusCos / 3;\n      this.matrix[1] = aThird * OneMinusCos - aThirdSqtSin;\n      this.matrix[2] = aThird * OneMinusCos + aThirdSqtSin;\n      this.matrix[5] = aThird * OneMinusCos + aThirdSqtSin;\n      this.matrix[6] = cos + aThird * OneMinusCos;\n      this.matrix[7] = aThird * OneMinusCos - aThirdSqtSin;\n      this.matrix[10] = aThird * OneMinusCos - aThirdSqtSin;\n      this.matrix[11] = aThird * OneMinusCos + aThirdSqtSin;\n      this.matrix[12] = cos + aThird * OneMinusCos;\n    },\n\n    /**\n     * HueRotation isNeutralState implementation\n     * Used only in image applyFilters to discard filters that will not have an effect\n     * on the image\n     * @param {Object} options\n     **/\n    isNeutralState: function(options) {\n      this.calculateMatrix();\n      return filters.BaseFilter.prototype.isNeutralState.call(this, options);\n    },\n\n    /**\n     * Apply this filter to the input image data provided.\n     *\n     * Determines whether to use WebGL or Canvas2D based on the options.webgl flag.\n     *\n     * @param {Object} options\n     * @param {Number} options.passes The number of filters remaining to be executed\n     * @param {Boolean} options.webgl Whether to use webgl to render the filter.\n     * @param {WebGLTexture} options.sourceTexture The texture setup as the source to be filtered.\n     * @param {WebGLTexture} options.targetTexture The texture where filtered output should be drawn.\n     * @param {WebGLRenderingContext} options.context The GL context used for rendering.\n     * @param {Object} options.programCache A map of compiled shader programs, keyed by filter type.\n     */\n    applyTo: function(options) {\n      this.calculateMatrix();\n      filters.BaseFilter.prototype.applyTo.call(this, options);\n    },\n\n  });\n\n  /**\n   * Returns filter instance from an object representation\n   * @static\n   * @param {Object} object Object to create an instance from\n   * @param {function} [callback] to be invoked after filter creation\n   * @return {fabric.Image.filters.HueRotation} Instance of fabric.Image.filters.HueRotation\n   */\n  fabric.Image.filters.HueRotation.fromObject = fabric.Image.filters.BaseFilter.fromObject;\n\n})(typeof exports !== 'undefined' ? exports : this);\n\n\n(function(global) {\n\n  'use strict';\n\n  var fabric = global.fabric || (global.fabric = { }),\n      clone = fabric.util.object.clone;\n\n  if (fabric.Text) {\n    fabric.warn('fabric.Text is already defined');\n    return;\n  }\n\n  var additionalProps =\n    ('fontFamily fontWeight fontSize text underline overline linethrough' +\n    ' textAlign fontStyle lineHeight textBackgroundColor charSpacing styles' +\n    ' direction path pathStartOffset pathSide pathAlign').split(' ');\n\n  /**\n   * Text class\n   * @class fabric.Text\n   * @extends fabric.Object\n   * @return {fabric.Text} thisArg\n   * @tutorial {@link http://fabricjs.com/fabric-intro-part-2#text}\n   * @see {@link fabric.Text#initialize} for constructor definition\n   */\n  fabric.Text = fabric.util.createClass(fabric.Object, /** @lends fabric.Text.prototype */ {\n\n    /**\n     * Properties which when set cause object to change dimensions\n     * @type Array\n     * @private\n     */\n    _dimensionAffectingProps: [\n      'fontSize',\n      'fontWeight',\n      'fontFamily',\n      'fontStyle',\n      'lineHeight',\n      'text',\n      'charSpacing',\n      'textAlign',\n      'styles',\n      'path',\n      'pathStartOffset',\n      'pathSide',\n      'pathAlign'\n    ],\n\n    /**\n     * @private\n     */\n    _reNewline: /\\r?\\n/,\n\n    /**\n     * Use this regular expression to filter for whitespaces that is not a new line.\n     * Mostly used when text is 'justify' aligned.\n     * @private\n     */\n    _reSpacesAndTabs: /[ \\t\\r]/g,\n\n    /**\n     * Use this regular expression to filter for whitespace that is not a new line.\n     * Mostly used when text is 'justify' aligned.\n     * @private\n     */\n    _reSpaceAndTab: /[ \\t\\r]/,\n\n    /**\n     * Use this regular expression to filter consecutive groups of non spaces.\n     * Mostly used when text is 'justify' aligned.\n     * @private\n     */\n    _reWords: /\\S+/g,\n\n    /**\n     * Type of an object\n     * @type String\n     * @default\n     */\n    type:                 'text',\n\n    /**\n     * Font size (in pixels)\n     * @type Number\n     * @default\n     */\n    fontSize:             40,\n\n    /**\n     * Font weight (e.g. bold, normal, 400, 600, 800)\n     * @type {(Number|String)}\n     * @default\n     */\n    fontWeight:           'normal',\n\n    /**\n     * Font family\n     * @type String\n     * @default\n     */\n    fontFamily:           'Times New Roman',\n\n    /**\n     * Text decoration underline.\n     * @type Boolean\n     * @default\n     */\n    underline:       false,\n\n    /**\n     * Text decoration overline.\n     * @type Boolean\n     * @default\n     */\n    overline:       false,\n\n    /**\n     * Text decoration linethrough.\n     * @type Boolean\n     * @default\n     */\n    linethrough:       false,\n\n    /**\n     * Text alignment. Possible values: \"left\", \"center\", \"right\", \"justify\",\n     * \"justify-left\", \"justify-center\" or \"justify-right\".\n     * @type String\n     * @default\n     */\n    textAlign:            'left',\n\n    /**\n     * Font style . Possible values: \"\", \"normal\", \"italic\" or \"oblique\".\n     * @type String\n     * @default\n     */\n    fontStyle:            'normal',\n\n    /**\n     * Line height\n     * @type Number\n     * @default\n     */\n    lineHeight:           1.16,\n\n    /**\n     * Superscript schema object (minimum overlap)\n     * @type {Object}\n     * @default\n     */\n    superscript: {\n      size:      0.60, // fontSize factor\n      baseline: -0.35  // baseline-shift factor (upwards)\n    },\n\n    /**\n     * Subscript schema object (minimum overlap)\n     * @type {Object}\n     * @default\n     */\n    subscript: {\n      size:      0.60, // fontSize factor\n      baseline:  0.11  // baseline-shift factor (downwards)\n    },\n\n    /**\n     * Background color of text lines\n     * @type String\n     * @default\n     */\n    textBackgroundColor:  '',\n\n    /**\n     * List of properties to consider when checking if\n     * state of an object is changed ({@link fabric.Object#hasStateChanged})\n     * as well as for history (undo/redo) purposes\n     * @type Array\n     */\n    stateProperties: fabric.Object.prototype.stateProperties.concat(additionalProps),\n\n    /**\n     * List of properties to consider when checking if cache needs refresh\n     * @type Array\n     */\n    cacheProperties: fabric.Object.prototype.cacheProperties.concat(additionalProps),\n\n    /**\n     * When defined, an object is rendered via stroke and this property specifies its color.\n     * <b>Backwards incompatibility note:</b> This property was named \"strokeStyle\" until v1.1.6\n     * @type String\n     * @default\n     */\n    stroke:               null,\n\n    /**\n     * Shadow object representing shadow of this shape.\n     * <b>Backwards incompatibility note:</b> This property was named \"textShadow\" (String) until v1.2.11\n     * @type fabric.Shadow\n     * @default\n     */\n    shadow:               null,\n\n    /**\n     * fabric.Path that the text should follow.\n     * since 4.6.0 the path will be drawn automatically.\n     * if you want to make the path visible, give it a stroke and strokeWidth or fill value\n     * if you want it to be hidden, assign visible = false to the path.\n     * This feature is in BETA, and SVG import/export is not yet supported.\n     * @type fabric.Path\n     * @example\n     * var textPath = new fabric.Text('Text on a path', {\n     *     top: 150,\n     *     left: 150,\n     *     textAlign: 'center',\n     *     charSpacing: -50,\n     *     path: new fabric.Path('M 0 0 C 50 -100 150 -100 200 0', {\n     *         strokeWidth: 1,\n     *         visible: false\n     *     }),\n     *     pathSide: 'left',\n     *     pathStartOffset: 0\n     * });\n     * @default\n     */\n    path:               null,\n\n    /**\n     * Offset amount for text path starting position\n     * Only used when text has a path\n     * @type Number\n     * @default\n     */\n    pathStartOffset:               0,\n\n    /**\n     * Which side of the path the text should be drawn on.\n     * Only used when text has a path\n     * @type {String} 'left|right'\n     * @default\n     */\n    pathSide:               'left',\n\n    /**\n     * How text is aligned to the path. This property determines\n     * the perpendicular position of each character relative to the path.\n     * (one of \"baseline\", \"center\", \"ascender\", \"descender\")\n     * This feature is in BETA, and its behavior may change\n     * @type String\n     * @default\n     */\n    pathAlign:               'baseline',\n\n    /**\n     * @private\n     */\n    _fontSizeFraction: 0.222,\n\n    /**\n     * @private\n     */\n    offsets: {\n      underline: 0.10,\n      linethrough: -0.315,\n      overline: -0.88\n    },\n\n    /**\n     * Text Line proportion to font Size (in pixels)\n     * @type Number\n     * @default\n     */\n    _fontSizeMult:             1.13,\n\n    /**\n     * additional space between characters\n     * expressed in thousands of em unit\n     * @type Number\n     * @default\n     */\n    charSpacing:             0,\n\n    /**\n     * Object containing character styles - top-level properties -> line numbers,\n     * 2nd-level properties - character numbers\n     * @type Object\n     * @default\n     */\n    styles: null,\n\n    /**\n     * Reference to a context to measure text char or couple of chars\n     * the cacheContext of the canvas will be used or a freshly created one if the object is not on canvas\n     * once created it will be referenced on fabric._measuringContext to avoid creating a canvas for every\n     * text object created.\n     * @type {CanvasRenderingContext2D}\n     * @default\n     */\n    _measuringContext: null,\n\n    /**\n     * Baseline shift, styles only, keep at 0 for the main text object\n     * @type {Number}\n     * @default\n     */\n    deltaY: 0,\n\n    /**\n     * WARNING: EXPERIMENTAL. NOT SUPPORTED YET\n     * determine the direction of the text.\n     * This has to be set manually together with textAlign and originX for proper\n     * experience.\n     * some interesting link for the future\n     * https://www.w3.org/International/questions/qa-bidi-unicode-controls\n     * @since 4.5.0\n     * @type {String} 'ltr|rtl'\n     * @default\n     */\n    direction: 'ltr',\n\n    /**\n     * Array of properties that define a style unit (of 'styles').\n     * @type {Array}\n     * @default\n     */\n    _styleProperties: [\n      'stroke',\n      'strokeWidth',\n      'fill',\n      'fontFamily',\n      'fontSize',\n      'fontWeight',\n      'fontStyle',\n      'underline',\n      'overline',\n      'linethrough',\n      'deltaY',\n      'textBackgroundColor',\n    ],\n\n    /**\n     * contains characters bounding boxes\n     */\n    __charBounds: [],\n\n    /**\n     * use this size when measuring text. To avoid IE11 rounding errors\n     * @type {Number}\n     * @default\n     * @readonly\n     * @private\n     */\n    CACHE_FONT_SIZE: 400,\n\n    /**\n     * contains the min text width to avoid getting 0\n     * @type {Number}\n     * @default\n     */\n    MIN_TEXT_WIDTH: 2,\n\n    /**\n     * Constructor\n     * @param {String} text Text string\n     * @param {Object} [options] Options object\n     * @return {fabric.Text} thisArg\n     */\n    initialize: function(text, options) {\n      this.styles = options ? (options.styles || { }) : { };\n      this.text = text;\n      this.__skipDimension = true;\n      this.callSuper('initialize', options);\n      if (this.path) {\n        this.setPathInfo();\n      }\n      this.__skipDimension = false;\n      this.initDimensions();\n      this.setCoords();\n      this.setupState({ propertySet: '_dimensionAffectingProps' });\n    },\n\n    /**\n     * If text has a path, it will add the extra information needed\n     * for path and text calculations\n     * @return {fabric.Text} thisArg\n     */\n    setPathInfo: function() {\n      var path = this.path;\n      if (path) {\n        path.segmentsInfo = fabric.util.getPathSegmentsInfo(path.path);\n      }\n    },\n\n    /**\n     * Return a context for measurement of text string.\n     * if created it gets stored for reuse\n     * this is for internal use, please do not use it\n     * @private\n     * @param {String} text Text string\n     * @param {Object} [options] Options object\n     * @return {fabric.Text} thisArg\n     */\n    getMeasuringContext: function() {\n      // if we did not return we have to measure something.\n      if (!fabric._measuringContext) {\n        fabric._measuringContext = this.canvas && this.canvas.contextCache ||\n          fabric.util.createCanvasElement().getContext('2d');\n      }\n      return fabric._measuringContext;\n    },\n\n    /**\n     * @private\n     * Divides text into lines of text and lines of graphemes.\n     */\n    _splitText: function() {\n      var newLines = this._splitTextIntoLines(this.text);\n      this.textLines = newLines.lines;\n      this._textLines = newLines.graphemeLines;\n      this._unwrappedTextLines = newLines._unwrappedLines;\n      this._text = newLines.graphemeText;\n      return newLines;\n    },\n\n    /**\n     * Initialize or update text dimensions.\n     * Updates this.width and this.height with the proper values.\n     * Does not return dimensions.\n     */\n    initDimensions: function() {\n      if (this.__skipDimension) {\n        return;\n      }\n      this._splitText();\n      this._clearCache();\n      if (this.path) {\n        this.width = this.path.width;\n        this.height = this.path.height;\n      }\n      else {\n        this.width = this.calcTextWidth() || this.cursorWidth || this.MIN_TEXT_WIDTH;\n        this.height = this.calcTextHeight();\n      }\n      if (this.textAlign.indexOf('justify') !== -1) {\n        // once text is measured we need to make space fatter to make justified text.\n        this.enlargeSpaces();\n      }\n      this.saveState({ propertySet: '_dimensionAffectingProps' });\n    },\n\n    /**\n     * Enlarge space boxes and shift the others\n     */\n    enlargeSpaces: function() {\n      var diffSpace, currentLineWidth, numberOfSpaces, accumulatedSpace, line, charBound, spaces;\n      for (var i = 0, len = this._textLines.length; i < len; i++) {\n        if (this.textAlign !== 'justify' && (i === len - 1 || this.isEndOfWrapping(i))) {\n          continue;\n        }\n        accumulatedSpace = 0;\n        line = this._textLines[i];\n        currentLineWidth = this.getLineWidth(i);\n        if (currentLineWidth < this.width && (spaces = this.textLines[i].match(this._reSpacesAndTabs))) {\n          numberOfSpaces = spaces.length;\n          diffSpace = (this.width - currentLineWidth) / numberOfSpaces;\n          for (var j = 0, jlen = line.length; j <= jlen; j++) {\n            charBound = this.__charBounds[i][j];\n            if (this._reSpaceAndTab.test(line[j])) {\n              charBound.width += diffSpace;\n              charBound.kernedWidth += diffSpace;\n              charBound.left += accumulatedSpace;\n              accumulatedSpace += diffSpace;\n            }\n            else {\n              charBound.left += accumulatedSpace;\n            }\n          }\n        }\n      }\n    },\n\n    /**\n     * Detect if the text line is ended with an hard break\n     * text and itext do not have wrapping, return false\n     * @return {Boolean}\n     */\n    isEndOfWrapping: function(lineIndex) {\n      return lineIndex === this._textLines.length - 1;\n    },\n\n    /**\n     * Detect if a line has a linebreak and so we need to account for it when moving\n     * and counting style.\n     * It return always for text and Itext.\n     * @return Number\n     */\n    missingNewlineOffset: function() {\n      return 1;\n    },\n\n    /**\n     * Returns string representation of an instance\n     * @return {String} String representation of text object\n     */\n    toString: function() {\n      return '#<fabric.Text (' + this.complexity() +\n        '): { \"text\": \"' + this.text + '\", \"fontFamily\": \"' + this.fontFamily + '\" }>';\n    },\n\n    /**\n     * Return the dimension and the zoom level needed to create a cache canvas\n     * big enough to host the object to be cached.\n     * @private\n     * @param {Object} dim.x width of object to be cached\n     * @param {Object} dim.y height of object to be cached\n     * @return {Object}.width width of canvas\n     * @return {Object}.height height of canvas\n     * @return {Object}.zoomX zoomX zoom value to unscale the canvas before drawing cache\n     * @return {Object}.zoomY zoomY zoom value to unscale the canvas before drawing cache\n     */\n    _getCacheCanvasDimensions: function() {\n      var dims = this.callSuper('_getCacheCanvasDimensions');\n      var fontSize = this.fontSize;\n      dims.width += fontSize * dims.zoomX;\n      dims.height += fontSize * dims.zoomY;\n      return dims;\n    },\n\n    /**\n     * @private\n     * @param {CanvasRenderingContext2D} ctx Context to render on\n     */\n    _render: function(ctx) {\n      var path = this.path;\n      path && !path.isNotVisible() && path._render(ctx);\n      this._setTextStyles(ctx);\n      this._renderTextLinesBackground(ctx);\n      this._renderTextDecoration(ctx, 'underline');\n      this._renderText(ctx);\n      this._renderTextDecoration(ctx, 'overline');\n      this._renderTextDecoration(ctx, 'linethrough');\n    },\n\n    /**\n     * @private\n     * @param {CanvasRenderingContext2D} ctx Context to render on\n     */\n    _renderText: function(ctx) {\n      if (this.paintFirst === 'stroke') {\n        this._renderTextStroke(ctx);\n        this._renderTextFill(ctx);\n      }\n      else {\n        this._renderTextFill(ctx);\n        this._renderTextStroke(ctx);\n      }\n    },\n\n    /**\n     * Set the font parameter of the context with the object properties or with charStyle\n     * @private\n     * @param {CanvasRenderingContext2D} ctx Context to render on\n     * @param {Object} [charStyle] object with font style properties\n     * @param {String} [charStyle.fontFamily] Font Family\n     * @param {Number} [charStyle.fontSize] Font size in pixels. ( without px suffix )\n     * @param {String} [charStyle.fontWeight] Font weight\n     * @param {String} [charStyle.fontStyle] Font style (italic|normal)\n     */\n    _setTextStyles: function(ctx, charStyle, forMeasuring) {\n      ctx.textBaseline = 'alphabetical';\n      if (this.path) {\n        switch (this.pathAlign) {\n          case 'center':\n            ctx.textBaseline = 'middle';\n            break;\n          case 'ascender':\n            ctx.textBaseline = 'top';\n            break;\n          case 'descender':\n            ctx.textBaseline = 'bottom';\n            break;\n        }\n      }\n      ctx.font = this._getFontDeclaration(charStyle, forMeasuring);\n    },\n\n    /**\n     * calculate and return the text Width measuring each line.\n     * @private\n     * @param {CanvasRenderingContext2D} ctx Context to render on\n     * @return {Number} Maximum width of fabric.Text object\n     */\n    calcTextWidth: function() {\n      var maxWidth = this.getLineWidth(0);\n\n      for (var i = 1, len = this._textLines.length; i < len; i++) {\n        var currentLineWidth = this.getLineWidth(i);\n        if (currentLineWidth > maxWidth) {\n          maxWidth = currentLineWidth;\n        }\n      }\n      return maxWidth;\n    },\n\n    /**\n     * @private\n     * @param {String} method Method name (\"fillText\" or \"strokeText\")\n     * @param {CanvasRenderingContext2D} ctx Context to render on\n     * @param {String} line Text to render\n     * @param {Number} left Left position of text\n     * @param {Number} top Top position of text\n     * @param {Number} lineIndex Index of a line in a text\n     */\n    _renderTextLine: function(method, ctx, line, left, top, lineIndex) {\n      this._renderChars(method, ctx, line, left, top, lineIndex);\n    },\n\n    /**\n     * Renders the text background for lines, taking care of style\n     * @private\n     * @param {CanvasRenderingContext2D} ctx Context to render on\n     */\n    _renderTextLinesBackground: function(ctx) {\n      if (!this.textBackgroundColor && !this.styleHas('textBackgroundColor')) {\n        return;\n      }\n      var heightOfLine,\n          lineLeftOffset, originalFill = ctx.fillStyle,\n          line, lastColor,\n          leftOffset = this._getLeftOffset(),\n          lineTopOffset = this._getTopOffset(),\n          boxStart = 0, boxWidth = 0, charBox, currentColor, path = this.path,\n          drawStart;\n\n      for (var i = 0, len = this._textLines.length; i < len; i++) {\n        heightOfLine = this.getHeightOfLine(i);\n        if (!this.textBackgroundColor && !this.styleHas('textBackgroundColor', i)) {\n          lineTopOffset += heightOfLine;\n          continue;\n        }\n        line = this._textLines[i];\n        lineLeftOffset = this._getLineLeftOffset(i);\n        boxWidth = 0;\n        boxStart = 0;\n        lastColor = this.getValueOfPropertyAt(i, 0, 'textBackgroundColor');\n        for (var j = 0, jlen = line.length; j < jlen; j++) {\n          charBox = this.__charBounds[i][j];\n          currentColor = this.getValueOfPropertyAt(i, j, 'textBackgroundColor');\n          if (path) {\n            ctx.save();\n            ctx.translate(charBox.renderLeft, charBox.renderTop);\n            ctx.rotate(charBox.angle);\n            ctx.fillStyle = currentColor;\n            currentColor && ctx.fillRect(\n              -charBox.width / 2,\n              -heightOfLine / this.lineHeight * (1 - this._fontSizeFraction),\n              charBox.width,\n              heightOfLine / this.lineHeight\n            );\n            ctx.restore();\n          }\n          else if (currentColor !== lastColor) {\n            drawStart = leftOffset + lineLeftOffset + boxStart;\n            if (this.direction === 'rtl') {\n              drawStart = this.width - drawStart - boxWidth;\n            }\n            ctx.fillStyle = lastColor;\n            lastColor && ctx.fillRect(\n              drawStart,\n              lineTopOffset,\n              boxWidth,\n              heightOfLine / this.lineHeight\n            );\n            boxStart = charBox.left;\n            boxWidth = charBox.width;\n            lastColor = currentColor;\n          }\n          else {\n            boxWidth += charBox.kernedWidth;\n          }\n        }\n        if (currentColor && !path) {\n          drawStart = leftOffset + lineLeftOffset + boxStart;\n          if (this.direction === 'rtl') {\n            drawStart = this.width - drawStart - boxWidth;\n          }\n          ctx.fillStyle = currentColor;\n          ctx.fillRect(\n            drawStart,\n            lineTopOffset,\n            boxWidth,\n            heightOfLine / this.lineHeight\n          );\n        }\n        lineTopOffset += heightOfLine;\n      }\n      ctx.fillStyle = originalFill;\n      // if there is text background color no\n      // other shadows should be casted\n      this._removeShadow(ctx);\n    },\n\n    /**\n     * @private\n     * @param {Object} decl style declaration for cache\n     * @param {String} decl.fontFamily fontFamily\n     * @param {String} decl.fontStyle fontStyle\n     * @param {String} decl.fontWeight fontWeight\n     * @return {Object} reference to cache\n     */\n    getFontCache: function(decl) {\n      var fontFamily = decl.fontFamily.toLowerCase();\n      if (!fabric.charWidthsCache[fontFamily]) {\n        fabric.charWidthsCache[fontFamily] = { };\n      }\n      var cache = fabric.charWidthsCache[fontFamily],\n          cacheProp = decl.fontStyle.toLowerCase() + '_' + (decl.fontWeight + '').toLowerCase();\n      if (!cache[cacheProp]) {\n        cache[cacheProp] = { };\n      }\n      return cache[cacheProp];\n    },\n\n    /**\n     * measure and return the width of a single character.\n     * possibly overridden to accommodate different measure logic or\n     * to hook some external lib for character measurement\n     * @private\n     * @param {String} _char, char to be measured\n     * @param {Object} charStyle style of char to be measured\n     * @param {String} [previousChar] previous char\n     * @param {Object} [prevCharStyle] style of previous char\n     */\n    _measureChar: function(_char, charStyle, previousChar, prevCharStyle) {\n      // first i try to return from cache\n      var fontCache = this.getFontCache(charStyle), fontDeclaration = this._getFontDeclaration(charStyle),\n          previousFontDeclaration = this._getFontDeclaration(prevCharStyle), couple = previousChar + _char,\n          stylesAreEqual = fontDeclaration === previousFontDeclaration, width, coupleWidth, previousWidth,\n          fontMultiplier = charStyle.fontSize / this.CACHE_FONT_SIZE, kernedWidth;\n\n      if (previousChar && fontCache[previousChar] !== undefined) {\n        previousWidth = fontCache[previousChar];\n      }\n      if (fontCache[_char] !== undefined) {\n        kernedWidth = width = fontCache[_char];\n      }\n      if (stylesAreEqual && fontCache[couple] !== undefined) {\n        coupleWidth = fontCache[couple];\n        kernedWidth = coupleWidth - previousWidth;\n      }\n      if (width === undefined || previousWidth === undefined || coupleWidth === undefined) {\n        var ctx = this.getMeasuringContext();\n        // send a TRUE to specify measuring font size CACHE_FONT_SIZE\n        this._setTextStyles(ctx, charStyle, true);\n      }\n      if (width === undefined) {\n        kernedWidth = width = ctx.measureText(_char).width;\n        fontCache[_char] = width;\n      }\n      if (previousWidth === undefined && stylesAreEqual && previousChar) {\n        previousWidth = ctx.measureText(previousChar).width;\n        fontCache[previousChar] = previousWidth;\n      }\n      if (stylesAreEqual && coupleWidth === undefined) {\n        // we can measure the kerning couple and subtract the width of the previous character\n        coupleWidth = ctx.measureText(couple).width;\n        fontCache[couple] = coupleWidth;\n        kernedWidth = coupleWidth - previousWidth;\n      }\n      return { width: width * fontMultiplier, kernedWidth: kernedWidth * fontMultiplier };\n    },\n\n    /**\n     * Computes height of character at given position\n     * @param {Number} line the line index number\n     * @param {Number} _char the character index number\n     * @return {Number} fontSize of the character\n     */\n    getHeightOfChar: function(line, _char) {\n      return this.getValueOfPropertyAt(line, _char, 'fontSize');\n    },\n\n    /**\n     * measure a text line measuring all characters.\n     * @param {Number} lineIndex line number\n     * @return {Number} Line width\n     */\n    measureLine: function(lineIndex) {\n      var lineInfo = this._measureLine(lineIndex);\n      if (this.charSpacing !== 0) {\n        lineInfo.width -= this._getWidthOfCharSpacing();\n      }\n      if (lineInfo.width < 0) {\n        lineInfo.width = 0;\n      }\n      return lineInfo;\n    },\n\n    /**\n     * measure every grapheme of a line, populating __charBounds\n     * @param {Number} lineIndex\n     * @return {Object} object.width total width of characters\n     * @return {Object} object.widthOfSpaces length of chars that match this._reSpacesAndTabs\n     */\n    _measureLine: function(lineIndex) {\n      var width = 0, i, grapheme, line = this._textLines[lineIndex], prevGrapheme,\n          graphemeInfo, numOfSpaces = 0, lineBounds = new Array(line.length),\n          positionInPath = 0, startingPoint, totalPathLength, path = this.path,\n          reverse = this.pathSide === 'right';\n\n      this.__charBounds[lineIndex] = lineBounds;\n      for (i = 0; i < line.length; i++) {\n        grapheme = line[i];\n        graphemeInfo = this._getGraphemeBox(grapheme, lineIndex, i, prevGrapheme);\n        lineBounds[i] = graphemeInfo;\n        width += graphemeInfo.kernedWidth;\n        prevGrapheme = grapheme;\n      }\n      // this latest bound box represent the last character of the line\n      // to simplify cursor handling in interactive mode.\n      lineBounds[i] = {\n        left: graphemeInfo ? graphemeInfo.left + graphemeInfo.width : 0,\n        width: 0,\n        kernedWidth: 0,\n        height: this.fontSize\n      };\n      if (path) {\n        totalPathLength = path.segmentsInfo[path.segmentsInfo.length - 1].length;\n        startingPoint = fabric.util.getPointOnPath(path.path, 0, path.segmentsInfo);\n        startingPoint.x += path.pathOffset.x;\n        startingPoint.y += path.pathOffset.y;\n        switch (this.textAlign) {\n          case 'left':\n            positionInPath = reverse ? (totalPathLength - width) : 0;\n            break;\n          case 'center':\n            positionInPath = (totalPathLength - width) / 2;\n            break;\n          case 'right':\n            positionInPath = reverse ? 0 : (totalPathLength - width);\n            break;\n          //todo - add support for justify\n        }\n        positionInPath += this.pathStartOffset * (reverse ? -1 : 1);\n        for (i = reverse ? line.length - 1 : 0;\n          reverse ? i >= 0 : i < line.length;\n          reverse ? i-- : i++) {\n          graphemeInfo = lineBounds[i];\n          if (positionInPath > totalPathLength) {\n            positionInPath %= totalPathLength;\n          }\n          else if (positionInPath < 0) {\n            positionInPath += totalPathLength;\n          }\n          // it would probably much faster to send all the grapheme position for a line\n          // and calculate path position/angle at once.\n          this._setGraphemeOnPath(positionInPath, graphemeInfo, startingPoint);\n          positionInPath += graphemeInfo.kernedWidth;\n        }\n      }\n      return { width: width, numOfSpaces: numOfSpaces };\n    },\n\n    /**\n     * Calculate the angle  and the left,top position of the char that follow a path.\n     * It appends it to graphemeInfo to be reused later at rendering\n     * @private\n     * @param {Number} positionInPath to be measured\n     * @param {Object} graphemeInfo current grapheme box information\n     * @param {Object} startingPoint position of the point\n     */\n    _setGraphemeOnPath: function(positionInPath, graphemeInfo, startingPoint) {\n      var centerPosition = positionInPath + graphemeInfo.kernedWidth / 2,\n          path = this.path;\n\n      // we are at currentPositionOnPath. we want to know what point on the path is.\n      var info = fabric.util.getPointOnPath(path.path, centerPosition, path.segmentsInfo);\n      graphemeInfo.renderLeft = info.x - startingPoint.x;\n      graphemeInfo.renderTop = info.y - startingPoint.y;\n      graphemeInfo.angle = info.angle + (this.pathSide ===  'right' ? Math.PI : 0);\n    },\n\n    /**\n     * Measure and return the info of a single grapheme.\n     * needs the the info of previous graphemes already filled\n     * @private\n     * @param {String} grapheme to be measured\n     * @param {Number} lineIndex index of the line where the char is\n     * @param {Number} charIndex position in the line\n     * @param {String} [prevGrapheme] character preceding the one to be measured\n     */\n    _getGraphemeBox: function(grapheme, lineIndex, charIndex, prevGrapheme, skipLeft) {\n      var style = this.getCompleteStyleDeclaration(lineIndex, charIndex),\n          prevStyle = prevGrapheme ? this.getCompleteStyleDeclaration(lineIndex, charIndex - 1) : { },\n          info = this._measureChar(grapheme, style, prevGrapheme, prevStyle),\n          kernedWidth = info.kernedWidth,\n          width = info.width, charSpacing;\n\n      if (this.charSpacing !== 0) {\n        charSpacing = this._getWidthOfCharSpacing();\n        width += charSpacing;\n        kernedWidth += charSpacing;\n      }\n\n      var box = {\n        width: width,\n        left: 0,\n        height: style.fontSize,\n        kernedWidth: kernedWidth,\n        deltaY: style.deltaY,\n      };\n      if (charIndex > 0 && !skipLeft) {\n        var previousBox = this.__charBounds[lineIndex][charIndex - 1];\n        box.left = previousBox.left + previousBox.width + info.kernedWidth - info.width;\n      }\n      return box;\n    },\n\n    /**\n     * Calculate height of line at 'lineIndex'\n     * @param {Number} lineIndex index of line to calculate\n     * @return {Number}\n     */\n    getHeightOfLine: function(lineIndex) {\n      if (this.__lineHeights[lineIndex]) {\n        return this.__lineHeights[lineIndex];\n      }\n\n      var line = this._textLines[lineIndex],\n          // char 0 is measured before the line cycle because it nneds to char\n          // emptylines\n          maxHeight = this.getHeightOfChar(lineIndex, 0);\n      for (var i = 1, len = line.length; i < len; i++) {\n        maxHeight = Math.max(this.getHeightOfChar(lineIndex, i), maxHeight);\n      }\n\n      return this.__lineHeights[lineIndex] = maxHeight * this.lineHeight * this._fontSizeMult;\n    },\n\n    /**\n     * Calculate text box height\n     */\n    calcTextHeight: function() {\n      var lineHeight, height = 0;\n      for (var i = 0, len = this._textLines.length; i < len; i++) {\n        lineHeight = this.getHeightOfLine(i);\n        height += (i === len - 1 ? lineHeight / this.lineHeight : lineHeight);\n      }\n      return height;\n    },\n\n    /**\n     * @private\n     * @return {Number} Left offset\n     */\n    _getLeftOffset: function() {\n      return this.direction === 'ltr' ? -this.width / 2 : this.width / 2;\n    },\n\n    /**\n     * @private\n     * @return {Number} Top offset\n     */\n    _getTopOffset: function() {\n      return -this.height / 2;\n    },\n\n    /**\n     * @private\n     * @param {CanvasRenderingContext2D} ctx Context to render on\n     * @param {String} method Method name (\"fillText\" or \"strokeText\")\n     */\n    _renderTextCommon: function(ctx, method) {\n      ctx.save();\n      var lineHeights = 0, left = this._getLeftOffset(), top = this._getTopOffset();\n      for (var i = 0, len = this._textLines.length; i < len; i++) {\n        var heightOfLine = this.getHeightOfLine(i),\n            maxHeight = heightOfLine / this.lineHeight,\n            leftOffset = this._getLineLeftOffset(i);\n        this._renderTextLine(\n          method,\n          ctx,\n          this._textLines[i],\n          left + leftOffset,\n          top + lineHeights + maxHeight,\n          i\n        );\n        lineHeights += heightOfLine;\n      }\n      ctx.restore();\n    },\n\n    /**\n     * @private\n     * @param {CanvasRenderingContext2D} ctx Context to render on\n     */\n    _renderTextFill: function(ctx) {\n      if (!this.fill && !this.styleHas('fill')) {\n        return;\n      }\n\n      this._renderTextCommon(ctx, 'fillText');\n    },\n\n    /**\n     * @private\n     * @param {CanvasRenderingContext2D} ctx Context to render on\n     */\n    _renderTextStroke: function(ctx) {\n      if ((!this.stroke || this.strokeWidth === 0) && this.isEmptyStyles()) {\n        return;\n      }\n\n      if (this.shadow && !this.shadow.affectStroke) {\n        this._removeShadow(ctx);\n      }\n\n      ctx.save();\n      this._setLineDash(ctx, this.strokeDashArray);\n      ctx.beginPath();\n      this._renderTextCommon(ctx, 'strokeText');\n      ctx.closePath();\n      ctx.restore();\n    },\n\n    /**\n     * @private\n     * @param {String} method fillText or strokeText.\n     * @param {CanvasRenderingContext2D} ctx Context to render on\n     * @param {Array} line Content of the line, splitted in an array by grapheme\n     * @param {Number} left\n     * @param {Number} top\n     * @param {Number} lineIndex\n     */\n    _renderChars: function(method, ctx, line, left, top, lineIndex) {\n      // set proper line offset\n      var lineHeight = this.getHeightOfLine(lineIndex),\n          isJustify = this.textAlign.indexOf('justify') !== -1,\n          actualStyle,\n          nextStyle,\n          charsToRender = '',\n          charBox,\n          boxWidth = 0,\n          timeToRender,\n          path = this.path,\n          shortCut = !isJustify && this.charSpacing === 0 && this.isEmptyStyles(lineIndex) && !path,\n          isLtr = this.direction === 'ltr', sign = this.direction === 'ltr' ? 1 : -1,\n          drawingLeft, currentDirection = ctx.canvas.getAttribute('dir');\n      ctx.save();\n      if (currentDirection !== this.direction) {\n        ctx.canvas.setAttribute('dir', isLtr ? 'ltr' : 'rtl');\n        ctx.direction = isLtr ? 'ltr' : 'rtl';\n        ctx.textAlign = isLtr ? 'left' : 'right';\n      }\n      top -= lineHeight * this._fontSizeFraction / this.lineHeight;\n      if (shortCut) {\n        // render all the line in one pass without checking\n        // drawingLeft = isLtr ? left : left - this.getLineWidth(lineIndex);\n        this._renderChar(method, ctx, lineIndex, 0, line.join(''), left, top, lineHeight);\n        ctx.restore();\n        return;\n      }\n      for (var i = 0, len = line.length - 1; i <= len; i++) {\n        timeToRender = i === len || this.charSpacing || path;\n        charsToRender += line[i];\n        charBox = this.__charBounds[lineIndex][i];\n        if (boxWidth === 0) {\n          left += sign * (charBox.kernedWidth - charBox.width);\n          boxWidth += charBox.width;\n        }\n        else {\n          boxWidth += charBox.kernedWidth;\n        }\n        if (isJustify && !timeToRender) {\n          if (this._reSpaceAndTab.test(line[i])) {\n            timeToRender = true;\n          }\n        }\n        if (!timeToRender) {\n          // if we have charSpacing, we render char by char\n          actualStyle = actualStyle || this.getCompleteStyleDeclaration(lineIndex, i);\n          nextStyle = this.getCompleteStyleDeclaration(lineIndex, i + 1);\n          timeToRender = fabric.util.hasStyleChanged(actualStyle, nextStyle, false);\n        }\n        if (timeToRender) {\n          if (path) {\n            ctx.save();\n            ctx.translate(charBox.renderLeft, charBox.renderTop);\n            ctx.rotate(charBox.angle);\n            this._renderChar(method, ctx, lineIndex, i, charsToRender, -boxWidth / 2, 0, lineHeight);\n            ctx.restore();\n          }\n          else {\n            drawingLeft = left;\n            this._renderChar(method, ctx, lineIndex, i, charsToRender, drawingLeft, top, lineHeight);\n          }\n          charsToRender = '';\n          actualStyle = nextStyle;\n          left += sign * boxWidth;\n          boxWidth = 0;\n        }\n      }\n      ctx.restore();\n    },\n\n    /**\n     * This function try to patch the missing gradientTransform on canvas gradients.\n     * transforming a context to transform the gradient, is going to transform the stroke too.\n     * we want to transform the gradient but not the stroke operation, so we create\n     * a transformed gradient on a pattern and then we use the pattern instead of the gradient.\n     * this method has drawbacks: is slow, is in low resolution, needs a patch for when the size\n     * is limited.\n     * @private\n     * @param {fabric.Gradient} filler a fabric gradient instance\n     * @return {CanvasPattern} a pattern to use as fill/stroke style\n     */\n    _applyPatternGradientTransformText: function(filler) {\n      var pCanvas = fabric.util.createCanvasElement(), pCtx,\n          // TODO: verify compatibility with strokeUniform\n          width = this.width + this.strokeWidth, height = this.height + this.strokeWidth;\n      pCanvas.width = width;\n      pCanvas.height = height;\n      pCtx = pCanvas.getContext('2d');\n      pCtx.beginPath(); pCtx.moveTo(0, 0); pCtx.lineTo(width, 0); pCtx.lineTo(width, height);\n      pCtx.lineTo(0, height); pCtx.closePath();\n      pCtx.translate(width / 2, height / 2);\n      pCtx.fillStyle = filler.toLive(pCtx);\n      this._applyPatternGradientTransform(pCtx, filler);\n      pCtx.fill();\n      return pCtx.createPattern(pCanvas, 'no-repeat');\n    },\n\n    handleFiller: function(ctx, property, filler) {\n      var offsetX, offsetY;\n      if (filler.toLive) {\n        if (filler.gradientUnits === 'percentage' || filler.gradientTransform || filler.patternTransform) {\n          // need to transform gradient in a pattern.\n          // this is a slow process. If you are hitting this codepath, and the object\n          // is not using caching, you should consider switching it on.\n          // we need a canvas as big as the current object caching canvas.\n          offsetX = -this.width / 2;\n          offsetY = -this.height / 2;\n          ctx.translate(offsetX, offsetY);\n          ctx[property] = this._applyPatternGradientTransformText(filler);\n          return { offsetX: offsetX, offsetY: offsetY };\n        }\n        else {\n          // is a simple gradient or pattern\n          ctx[property] = filler.toLive(ctx, this);\n          return this._applyPatternGradientTransform(ctx, filler);\n        }\n      }\n      else {\n        // is a color\n        ctx[property] = filler;\n      }\n      return { offsetX: 0, offsetY: 0 };\n    },\n\n    _setStrokeStyles: function(ctx, decl) {\n      ctx.lineWidth = decl.strokeWidth;\n      ctx.lineCap = this.strokeLineCap;\n      ctx.lineDashOffset = this.strokeDashOffset;\n      ctx.lineJoin = this.strokeLineJoin;\n      ctx.miterLimit = this.strokeMiterLimit;\n      return this.handleFiller(ctx, 'strokeStyle', decl.stroke);\n    },\n\n    _setFillStyles: function(ctx, decl) {\n      return this.handleFiller(ctx, 'fillStyle', decl.fill);\n    },\n\n    /**\n     * @private\n     * @param {String} method\n     * @param {CanvasRenderingContext2D} ctx Context to render on\n     * @param {Number} lineIndex\n     * @param {Number} charIndex\n     * @param {String} _char\n     * @param {Number} left Left coordinate\n     * @param {Number} top Top coordinate\n     * @param {Number} lineHeight Height of the line\n     */\n    _renderChar: function(method, ctx, lineIndex, charIndex, _char, left, top) {\n      var decl = this._getStyleDeclaration(lineIndex, charIndex),\n          fullDecl = this.getCompleteStyleDeclaration(lineIndex, charIndex),\n          shouldFill = method === 'fillText' && fullDecl.fill,\n          shouldStroke = method === 'strokeText' && fullDecl.stroke && fullDecl.strokeWidth,\n          fillOffsets, strokeOffsets;\n\n      if (!shouldStroke && !shouldFill) {\n        return;\n      }\n      ctx.save();\n\n      shouldFill && (fillOffsets = this._setFillStyles(ctx, fullDecl));\n      shouldStroke && (strokeOffsets = this._setStrokeStyles(ctx, fullDecl));\n\n      ctx.font = this._getFontDeclaration(fullDecl);\n\n\n      if (decl && decl.textBackgroundColor) {\n        this._removeShadow(ctx);\n      }\n      if (decl && decl.deltaY) {\n        top += decl.deltaY;\n      }\n      shouldFill && ctx.fillText(_char, left - fillOffsets.offsetX, top - fillOffsets.offsetY);\n      shouldStroke && ctx.strokeText(_char, left - strokeOffsets.offsetX, top - strokeOffsets.offsetY);\n      ctx.restore();\n    },\n\n    /**\n     * Turns the character into a 'superior figure' (i.e. 'superscript')\n     * @param {Number} start selection start\n     * @param {Number} end selection end\n     * @returns {fabric.Text} thisArg\n     * @chainable\n     */\n    setSuperscript: function(start, end) {\n      return this._setScript(start, end, this.superscript);\n    },\n\n    /**\n     * Turns the character into an 'inferior figure' (i.e. 'subscript')\n     * @param {Number} start selection start\n     * @param {Number} end selection end\n     * @returns {fabric.Text} thisArg\n     * @chainable\n     */\n    setSubscript: function(start, end) {\n      return this._setScript(start, end, this.subscript);\n    },\n\n    /**\n     * Applies 'schema' at given position\n     * @private\n     * @param {Number} start selection start\n     * @param {Number} end selection end\n     * @param {Number} schema\n     * @returns {fabric.Text} thisArg\n     * @chainable\n     */\n    _setScript: function(start, end, schema) {\n      var loc = this.get2DCursorLocation(start, true),\n          fontSize = this.getValueOfPropertyAt(loc.lineIndex, loc.charIndex, 'fontSize'),\n          dy = this.getValueOfPropertyAt(loc.lineIndex, loc.charIndex, 'deltaY'),\n          style = { fontSize: fontSize * schema.size, deltaY: dy + fontSize * schema.baseline };\n      this.setSelectionStyles(style, start, end);\n      return this;\n    },\n\n    /**\n     * @private\n     * @param {Number} lineIndex index text line\n     * @return {Number} Line left offset\n     */\n    _getLineLeftOffset: function(lineIndex) {\n      var lineWidth = this.getLineWidth(lineIndex),\n          lineDiff = this.width - lineWidth, textAlign = this.textAlign, direction = this.direction,\n          isEndOfWrapping, leftOffset = 0, isEndOfWrapping = this.isEndOfWrapping(lineIndex);\n      if (textAlign === 'justify'\n        || (textAlign === 'justify-center' && !isEndOfWrapping)\n        || (textAlign === 'justify-right' && !isEndOfWrapping)\n        || (textAlign === 'justify-left' && !isEndOfWrapping)\n      ) {\n        return 0;\n      }\n      if (textAlign === 'center') {\n        leftOffset = lineDiff / 2;\n      }\n      if (textAlign === 'right') {\n        leftOffset = lineDiff;\n      }\n      if (textAlign === 'justify-center') {\n        leftOffset = lineDiff / 2;\n      }\n      if (textAlign === 'justify-right') {\n        leftOffset = lineDiff;\n      }\n      if (direction === 'rtl') {\n        leftOffset -= lineDiff;\n      }\n      return leftOffset;\n    },\n\n    /**\n     * @private\n     */\n    _clearCache: function() {\n      this.__lineWidths = [];\n      this.__lineHeights = [];\n      this.__charBounds = [];\n    },\n\n    /**\n     * @private\n     */\n    _shouldClearDimensionCache: function() {\n      var shouldClear = this._forceClearCache;\n      shouldClear || (shouldClear = this.hasStateChanged('_dimensionAffectingProps'));\n      if (shouldClear) {\n        this.dirty = true;\n        this._forceClearCache = false;\n      }\n      return shouldClear;\n    },\n\n    /**\n     * Measure a single line given its index. Used to calculate the initial\n     * text bounding box. The values are calculated and stored in __lineWidths cache.\n     * @private\n     * @param {Number} lineIndex line number\n     * @return {Number} Line width\n     */\n    getLineWidth: function(lineIndex) {\n      if (this.__lineWidths[lineIndex] !== undefined) {\n        return this.__lineWidths[lineIndex];\n      }\n\n      var lineInfo = this.measureLine(lineIndex);\n      var width = lineInfo.width;\n      this.__lineWidths[lineIndex] = width;\n      return width;\n    },\n\n    _getWidthOfCharSpacing: function() {\n      if (this.charSpacing !== 0) {\n        return this.fontSize * this.charSpacing / 1000;\n      }\n      return 0;\n    },\n\n    /**\n     * Retrieves the value of property at given character position\n     * @param {Number} lineIndex the line number\n     * @param {Number} charIndex the character number\n     * @param {String} property the property name\n     * @returns the value of 'property'\n     */\n    getValueOfPropertyAt: function(lineIndex, charIndex, property) {\n      var charStyle = this._getStyleDeclaration(lineIndex, charIndex);\n      if (charStyle && typeof charStyle[property] !== 'undefined') {\n        return charStyle[property];\n      }\n      return this[property];\n    },\n\n    /**\n     * @private\n     * @param {CanvasRenderingContext2D} ctx Context to render on\n     */\n    _renderTextDecoration: function(ctx, type) {\n      if (!this[type] && !this.styleHas(type)) {\n        return;\n      }\n      var heightOfLine, size, _size,\n          lineLeftOffset, dy, _dy,\n          line, lastDecoration,\n          leftOffset = this._getLeftOffset(),\n          topOffset = this._getTopOffset(), top,\n          boxStart, boxWidth, charBox, currentDecoration,\n          maxHeight, currentFill, lastFill, path = this.path,\n          charSpacing = this._getWidthOfCharSpacing(),\n          offsetY = this.offsets[type];\n\n      for (var i = 0, len = this._textLines.length; i < len; i++) {\n        heightOfLine = this.getHeightOfLine(i);\n        if (!this[type] && !this.styleHas(type, i)) {\n          topOffset += heightOfLine;\n          continue;\n        }\n        line = this._textLines[i];\n        maxHeight = heightOfLine / this.lineHeight;\n        lineLeftOffset = this._getLineLeftOffset(i);\n        boxStart = 0;\n        boxWidth = 0;\n        lastDecoration = this.getValueOfPropertyAt(i, 0, type);\n        lastFill = this.getValueOfPropertyAt(i, 0, 'fill');\n        top = topOffset + maxHeight * (1 - this._fontSizeFraction);\n        size = this.getHeightOfChar(i, 0);\n        dy = this.getValueOfPropertyAt(i, 0, 'deltaY');\n        for (var j = 0, jlen = line.length; j < jlen; j++) {\n          charBox = this.__charBounds[i][j];\n          currentDecoration = this.getValueOfPropertyAt(i, j, type);\n          currentFill = this.getValueOfPropertyAt(i, j, 'fill');\n          _size = this.getHeightOfChar(i, j);\n          _dy = this.getValueOfPropertyAt(i, j, 'deltaY');\n          if (path && currentDecoration && currentFill) {\n            ctx.save();\n            ctx.fillStyle = lastFill;\n            ctx.translate(charBox.renderLeft, charBox.renderTop);\n            ctx.rotate(charBox.angle);\n            ctx.fillRect(\n              -charBox.kernedWidth / 2,\n              offsetY * _size + _dy,\n              charBox.kernedWidth,\n              this.fontSize / 15\n            );\n            ctx.restore();\n          }\n          else if (\n            (currentDecoration !== lastDecoration || currentFill !== lastFill || _size !== size || _dy !== dy)\n            && boxWidth > 0\n          ) {\n            var drawStart = leftOffset + lineLeftOffset + boxStart;\n            if (this.direction === 'rtl') {\n              drawStart = this.width - drawStart - boxWidth;\n            }\n            if (lastDecoration && lastFill) {\n              ctx.fillStyle = lastFill;\n              ctx.fillRect(\n                drawStart,\n                top + offsetY * size + dy,\n                boxWidth,\n                this.fontSize / 15\n              );\n            }\n            boxStart = charBox.left;\n            boxWidth = charBox.width;\n            lastDecoration = currentDecoration;\n            lastFill = currentFill;\n            size = _size;\n            dy = _dy;\n          }\n          else {\n            boxWidth += charBox.kernedWidth;\n          }\n        }\n        var drawStart = leftOffset + lineLeftOffset + boxStart;\n        if (this.direction === 'rtl') {\n          drawStart = this.width - drawStart - boxWidth;\n        }\n        ctx.fillStyle = currentFill;\n        currentDecoration && currentFill && ctx.fillRect(\n          drawStart,\n          top + offsetY * size + dy,\n          boxWidth - charSpacing,\n          this.fontSize / 15\n        );\n        topOffset += heightOfLine;\n      }\n      // if there is text background color no\n      // other shadows should be casted\n      this._removeShadow(ctx);\n    },\n\n    /**\n     * return font declaration string for canvas context\n     * @param {Object} [styleObject] object\n     * @returns {String} font declaration formatted for canvas context.\n     */\n    _getFontDeclaration: function(styleObject, forMeasuring) {\n      var style = styleObject || this, family = this.fontFamily,\n          fontIsGeneric = fabric.Text.genericFonts.indexOf(family.toLowerCase()) > -1;\n      var fontFamily = family === undefined ||\n      family.indexOf('\\'') > -1 || family.indexOf(',') > -1 ||\n      family.indexOf('\"') > -1 || fontIsGeneric\n        ? style.fontFamily : '\"' + style.fontFamily + '\"';\n      return [\n        // node-canvas needs \"weight style\", while browsers need \"style weight\"\n        // verify if this can be fixed in JSDOM\n        (fabric.isLikelyNode ? style.fontWeight : style.fontStyle),\n        (fabric.isLikelyNode ? style.fontStyle : style.fontWeight),\n        forMeasuring ? this.CACHE_FONT_SIZE + 'px' : style.fontSize + 'px',\n        fontFamily\n      ].join(' ');\n    },\n\n    /**\n     * Renders text instance on a specified context\n     * @param {CanvasRenderingContext2D} ctx Context to render on\n     */\n    render: function(ctx) {\n      // do not render if object is not visible\n      if (!this.visible) {\n        return;\n      }\n      if (this.canvas && this.canvas.skipOffscreen && !this.group && !this.isOnScreen()) {\n        return;\n      }\n      if (this._shouldClearDimensionCache()) {\n        this.initDimensions();\n      }\n      this.callSuper('render', ctx);\n    },\n\n    /**\n     * Returns the text as an array of lines.\n     * @param {String} text text to split\n     * @returns {Array} Lines in the text\n     */\n    _splitTextIntoLines: function(text) {\n      var lines = text.split(this._reNewline),\n          newLines = new Array(lines.length),\n          newLine = ['\\n'],\n          newText = [];\n      for (var i = 0; i < lines.length; i++) {\n        newLines[i] = fabric.util.string.graphemeSplit(lines[i]);\n        newText = newText.concat(newLines[i], newLine);\n      }\n      newText.pop();\n      return { _unwrappedLines: newLines, lines: lines, graphemeText: newText, graphemeLines: newLines };\n    },\n\n    /**\n     * Returns object representation of an instance\n     * @param {Array} [propertiesToInclude] Any properties that you might want to additionally include in the output\n     * @return {Object} Object representation of an instance\n     */\n    toObject: function(propertiesToInclude) {\n      var allProperties = additionalProps.concat(propertiesToInclude);\n      var obj = this.callSuper('toObject', allProperties);\n      obj.styles = fabric.util.stylesToArray(this.styles, this.text);\n      if (obj.path) {\n        obj.path = this.path.toObject();\n      }\n      return obj;\n    },\n\n    /**\n     * Sets property to a given value. When changing position/dimension -related properties (left, top, scale, angle, etc.) `set` does not update position of object's borders/controls. If you need to update those, call `setCoords()`.\n     * @param {String|Object} key Property name or object (if object, iterate over the object properties)\n     * @param {Object|Function} value Property value (if function, the value is passed into it and its return value is used as a new one)\n     * @return {fabric.Object} thisArg\n     * @chainable\n     */\n    set: function(key, value) {\n      this.callSuper('set', key, value);\n      var needsDims = false;\n      var isAddingPath = false;\n      if (typeof key === 'object') {\n        for (var _key in key) {\n          if (_key === 'path') {\n            this.setPathInfo();\n          }\n          needsDims = needsDims || this._dimensionAffectingProps.indexOf(_key) !== -1;\n          isAddingPath = isAddingPath || _key === 'path';\n        }\n      }\n      else {\n        needsDims = this._dimensionAffectingProps.indexOf(key) !== -1;\n        isAddingPath = key === 'path';\n      }\n      if (isAddingPath) {\n        this.setPathInfo();\n      }\n      if (needsDims) {\n        this.initDimensions();\n        this.setCoords();\n      }\n      return this;\n    },\n\n    /**\n     * Returns complexity of an instance\n     * @return {Number} complexity\n     */\n    complexity: function() {\n      return 1;\n    }\n  });\n\n  /* _FROM_SVG_START_ */\n  /**\n   * List of attribute names to account for when parsing SVG element (used by {@link fabric.Text.fromElement})\n   * @static\n   * @memberOf fabric.Text\n   * @see: http://www.w3.org/TR/SVG/text.html#TextElement\n   */\n  fabric.Text.ATTRIBUTE_NAMES = fabric.SHARED_ATTRIBUTES.concat(\n    'x y dx dy font-family font-style font-weight font-size letter-spacing text-decoration text-anchor'.split(' '));\n\n  /**\n   * Default SVG font size\n   * @static\n   * @memberOf fabric.Text\n   */\n  fabric.Text.DEFAULT_SVG_FONT_SIZE = 16;\n\n  /**\n   * Returns fabric.Text instance from an SVG element (<b>not yet implemented</b>)\n   * @static\n   * @memberOf fabric.Text\n   * @param {SVGElement} element Element to parse\n   * @param {Function} callback callback function invoked after parsing\n   * @param {Object} [options] Options object\n   */\n  fabric.Text.fromElement = function(element, callback, options) {\n    if (!element) {\n      return callback(null);\n    }\n\n    var parsedAttributes = fabric.parseAttributes(element, fabric.Text.ATTRIBUTE_NAMES),\n        parsedAnchor = parsedAttributes.textAnchor || 'left';\n    options = fabric.util.object.extend((options ? clone(options) : { }), parsedAttributes);\n\n    options.top = options.top || 0;\n    options.left = options.left || 0;\n    if (parsedAttributes.textDecoration) {\n      var textDecoration = parsedAttributes.textDecoration;\n      if (textDecoration.indexOf('underline') !== -1) {\n        options.underline = true;\n      }\n      if (textDecoration.indexOf('overline') !== -1) {\n        options.overline = true;\n      }\n      if (textDecoration.indexOf('line-through') !== -1) {\n        options.linethrough = true;\n      }\n      delete options.textDecoration;\n    }\n    if ('dx' in parsedAttributes) {\n      options.left += parsedAttributes.dx;\n    }\n    if ('dy' in parsedAttributes) {\n      options.top += parsedAttributes.dy;\n    }\n    if (!('fontSize' in options)) {\n      options.fontSize = fabric.Text.DEFAULT_SVG_FONT_SIZE;\n    }\n\n    var textContent = '';\n\n    // The XML is not properly parsed in IE9 so a workaround to get\n    // textContent is through firstChild.data. Another workaround would be\n    // to convert XML loaded from a file to be converted using DOMParser (same way loadSVGFromString() does)\n    if (!('textContent' in element)) {\n      if ('firstChild' in element && element.firstChild !== null) {\n        if ('data' in element.firstChild && element.firstChild.data !== null) {\n          textContent = element.firstChild.data;\n        }\n      }\n    }\n    else {\n      textContent = element.textContent;\n    }\n\n    textContent = textContent.replace(/^\\s+|\\s+$|\\n+/g, '').replace(/\\s+/g, ' ');\n    var originalStrokeWidth = options.strokeWidth;\n    options.strokeWidth = 0;\n\n    var text = new fabric.Text(textContent, options),\n        textHeightScaleFactor = text.getScaledHeight() / text.height,\n        lineHeightDiff = (text.height + text.strokeWidth) * text.lineHeight - text.height,\n        scaledDiff = lineHeightDiff * textHeightScaleFactor,\n        textHeight = text.getScaledHeight() + scaledDiff,\n        offX = 0;\n    /*\n      Adjust positioning:\n        x/y attributes in SVG correspond to the bottom-left corner of text bounding box\n        fabric output by default at top, left.\n    */\n    if (parsedAnchor === 'center') {\n      offX = text.getScaledWidth() / 2;\n    }\n    if (parsedAnchor === 'right') {\n      offX = text.getScaledWidth();\n    }\n    text.set({\n      left: text.left - offX,\n      top: text.top - (textHeight - text.fontSize * (0.07 + text._fontSizeFraction)) / text.lineHeight,\n      strokeWidth: typeof originalStrokeWidth !== 'undefined' ? originalStrokeWidth : 1,\n    });\n    callback(text);\n  };\n  /* _FROM_SVG_END_ */\n\n  /**\n   * Returns fabric.Text instance from an object representation\n   * @static\n   * @memberOf fabric.Text\n   * @param {Object} object plain js Object to create an instance from\n   * @param {Function} [callback] Callback to invoke when an fabric.Text instance is created\n   */\n  fabric.Text.fromObject = function(object, callback) {\n    var objectCopy = clone(object), path = object.path;\n    delete objectCopy.path;\n    return fabric.Object._fromObject('Text', objectCopy, function(textInstance) {\n      textInstance.styles = fabric.util.stylesFromArray(object.styles, object.text);\n      if (path) {\n        fabric.Object._fromObject('Path', path, function(pathInstance) {\n          textInstance.set('path', pathInstance);\n          callback(textInstance);\n        }, 'path');\n      }\n      else {\n        callback(textInstance);\n      }\n    }, 'text');\n  };\n\n  fabric.Text.genericFonts = ['sans-serif', 'serif', 'cursive', 'fantasy', 'monospace'];\n\n  fabric.util.createAccessors && fabric.util.createAccessors(fabric.Text);\n\n})(typeof exports !== 'undefined' ? exports : this);\n\n\n(function() {\n  fabric.util.object.extend(fabric.Text.prototype, /** @lends fabric.Text.prototype */ {\n    /**\n     * Returns true if object has no styling or no styling in a line\n     * @param {Number} lineIndex , lineIndex is on wrapped lines.\n     * @return {Boolean}\n     */\n    isEmptyStyles: function(lineIndex) {\n      if (!this.styles) {\n        return true;\n      }\n      if (typeof lineIndex !== 'undefined' && !this.styles[lineIndex]) {\n        return true;\n      }\n      var obj = typeof lineIndex === 'undefined' ? this.styles : { line: this.styles[lineIndex] };\n      for (var p1 in obj) {\n        for (var p2 in obj[p1]) {\n          // eslint-disable-next-line no-unused-vars\n          for (var p3 in obj[p1][p2]) {\n            return false;\n          }\n        }\n      }\n      return true;\n    },\n\n    /**\n     * Returns true if object has a style property or has it ina specified line\n     * This function is used to detect if a text will use a particular property or not.\n     * @param {String} property to check for\n     * @param {Number} lineIndex to check the style on\n     * @return {Boolean}\n     */\n    styleHas: function(property, lineIndex) {\n      if (!this.styles || !property || property === '') {\n        return false;\n      }\n      if (typeof lineIndex !== 'undefined' && !this.styles[lineIndex]) {\n        return false;\n      }\n      var obj = typeof lineIndex === 'undefined' ? this.styles : { 0: this.styles[lineIndex] };\n      // eslint-disable-next-line\n      for (var p1 in obj) {\n        // eslint-disable-next-line\n        for (var p2 in obj[p1]) {\n          if (typeof obj[p1][p2][property] !== 'undefined') {\n            return true;\n          }\n        }\n      }\n      return false;\n    },\n\n    /**\n     * Check if characters in a text have a value for a property\n     * whose value matches the textbox's value for that property.  If so,\n     * the character-level property is deleted.  If the character\n     * has no other properties, then it is also deleted.  Finally,\n     * if the line containing that character has no other characters\n     * then it also is deleted.\n     *\n     * @param {string} property The property to compare between characters and text.\n     */\n    cleanStyle: function(property) {\n      if (!this.styles || !property || property === '') {\n        return false;\n      }\n      var obj = this.styles, stylesCount = 0, letterCount, stylePropertyValue,\n          allStyleObjectPropertiesMatch = true, graphemeCount = 0, styleObject;\n      // eslint-disable-next-line\n      for (var p1 in obj) {\n        letterCount = 0;\n        // eslint-disable-next-line\n        for (var p2 in obj[p1]) {\n          var styleObject = obj[p1][p2],\n              stylePropertyHasBeenSet = styleObject.hasOwnProperty(property);\n\n          stylesCount++;\n\n          if (stylePropertyHasBeenSet) {\n            if (!stylePropertyValue) {\n              stylePropertyValue = styleObject[property];\n            }\n            else if (styleObject[property] !== stylePropertyValue) {\n              allStyleObjectPropertiesMatch = false;\n            }\n\n            if (styleObject[property] === this[property]) {\n              delete styleObject[property];\n            }\n          }\n          else {\n            allStyleObjectPropertiesMatch = false;\n          }\n\n          if (Object.keys(styleObject).length !== 0) {\n            letterCount++;\n          }\n          else {\n            delete obj[p1][p2];\n          }\n        }\n\n        if (letterCount === 0) {\n          delete obj[p1];\n        }\n      }\n      // if every grapheme has the same style set then\n      // delete those styles and set it on the parent\n      for (var i = 0; i < this._textLines.length; i++) {\n        graphemeCount += this._textLines[i].length;\n      }\n      if (allStyleObjectPropertiesMatch && stylesCount === graphemeCount) {\n        this[property] = stylePropertyValue;\n        this.removeStyle(property);\n      }\n    },\n\n    /**\n     * Remove a style property or properties from all individual character styles\n     * in a text object.  Deletes the character style object if it contains no other style\n     * props.  Deletes a line style object if it contains no other character styles.\n     *\n     * @param {String} props The property to remove from character styles.\n     */\n    removeStyle: function(property) {\n      if (!this.styles || !property || property === '') {\n        return;\n      }\n      var obj = this.styles, line, lineNum, charNum;\n      for (lineNum in obj) {\n        line = obj[lineNum];\n        for (charNum in line) {\n          delete line[charNum][property];\n          if (Object.keys(line[charNum]).length === 0) {\n            delete line[charNum];\n          }\n        }\n        if (Object.keys(line).length === 0) {\n          delete obj[lineNum];\n        }\n      }\n    },\n\n    /**\n     * @private\n     */\n    _extendStyles: function(index, styles) {\n      var loc = this.get2DCursorLocation(index);\n\n      if (!this._getLineStyle(loc.lineIndex)) {\n        this._setLineStyle(loc.lineIndex);\n      }\n\n      if (!this._getStyleDeclaration(loc.lineIndex, loc.charIndex)) {\n        this._setStyleDeclaration(loc.lineIndex, loc.charIndex, {});\n      }\n\n      fabric.util.object.extend(this._getStyleDeclaration(loc.lineIndex, loc.charIndex), styles);\n    },\n\n    /**\n     * Returns 2d representation (lineIndex and charIndex) of cursor (or selection start)\n     * @param {Number} [selectionStart] Optional index. When not given, current selectionStart is used.\n     * @param {Boolean} [skipWrapping] consider the location for unwrapped lines. useful to manage styles.\n     */\n    get2DCursorLocation: function(selectionStart, skipWrapping) {\n      if (typeof selectionStart === 'undefined') {\n        selectionStart = this.selectionStart;\n      }\n      var lines = skipWrapping ? this._unwrappedTextLines : this._textLines,\n          len = lines.length;\n      for (var i = 0; i < len; i++) {\n        if (selectionStart <= lines[i].length) {\n          return {\n            lineIndex: i,\n            charIndex: selectionStart\n          };\n        }\n        selectionStart -= lines[i].length + this.missingNewlineOffset(i);\n      }\n      return {\n        lineIndex: i - 1,\n        charIndex: lines[i - 1].length < selectionStart ? lines[i - 1].length : selectionStart\n      };\n    },\n\n    /**\n     * Gets style of a current selection/cursor (at the start position)\n     * if startIndex or endIndex are not provided, selectionStart or selectionEnd will be used.\n     * @param {Number} [startIndex] Start index to get styles at\n     * @param {Number} [endIndex] End index to get styles at, if not specified selectionEnd or startIndex + 1\n     * @param {Boolean} [complete] get full style or not\n     * @return {Array} styles an array with one, zero or more Style objects\n     */\n    getSelectionStyles: function(startIndex, endIndex, complete) {\n      if (typeof startIndex === 'undefined') {\n        startIndex = this.selectionStart || 0;\n      }\n      if (typeof endIndex === 'undefined') {\n        endIndex = this.selectionEnd || startIndex;\n      }\n      var styles = [];\n      for (var i = startIndex; i < endIndex; i++) {\n        styles.push(this.getStyleAtPosition(i, complete));\n      }\n      return styles;\n    },\n\n    /**\n     * Gets style of a current selection/cursor position\n     * @param {Number} position  to get styles at\n     * @param {Boolean} [complete] full style if true\n     * @return {Object} style Style object at a specified index\n     * @private\n     */\n    getStyleAtPosition: function(position, complete) {\n      var loc = this.get2DCursorLocation(position),\n          style = complete ? this.getCompleteStyleDeclaration(loc.lineIndex, loc.charIndex) :\n            this._getStyleDeclaration(loc.lineIndex, loc.charIndex);\n      return style || {};\n    },\n\n    /**\n     * Sets style of a current selection, if no selection exist, do not set anything.\n     * @param {Object} [styles] Styles object\n     * @param {Number} [startIndex] Start index to get styles at\n     * @param {Number} [endIndex] End index to get styles at, if not specified selectionEnd or startIndex + 1\n     * @return {fabric.IText} thisArg\n     * @chainable\n     */\n    setSelectionStyles: function(styles, startIndex, endIndex) {\n      if (typeof startIndex === 'undefined') {\n        startIndex = this.selectionStart || 0;\n      }\n      if (typeof endIndex === 'undefined') {\n        endIndex = this.selectionEnd || startIndex;\n      }\n      for (var i = startIndex; i < endIndex; i++) {\n        this._extendStyles(i, styles);\n      }\n      /* not included in _extendStyles to avoid clearing cache more than once */\n      this._forceClearCache = true;\n      return this;\n    },\n\n    /**\n     * get the reference, not a clone, of the style object for a given character\n     * @param {Number} lineIndex\n     * @param {Number} charIndex\n     * @return {Object} style object\n     */\n    _getStyleDeclaration: function(lineIndex, charIndex) {\n      var lineStyle = this.styles && this.styles[lineIndex];\n      if (!lineStyle) {\n        return null;\n      }\n      return lineStyle[charIndex];\n    },\n\n    /**\n     * return a new object that contains all the style property for a character\n     * the object returned is newly created\n     * @param {Number} lineIndex of the line where the character is\n     * @param {Number} charIndex position of the character on the line\n     * @return {Object} style object\n     */\n    getCompleteStyleDeclaration: function(lineIndex, charIndex) {\n      var style = this._getStyleDeclaration(lineIndex, charIndex) || { },\n          styleObject = { }, prop;\n      for (var i = 0; i < this._styleProperties.length; i++) {\n        prop = this._styleProperties[i];\n        styleObject[prop] = typeof style[prop] === 'undefined' ? this[prop] : style[prop];\n      }\n      return styleObject;\n    },\n\n    /**\n     * @param {Number} lineIndex\n     * @param {Number} charIndex\n     * @param {Object} style\n     * @private\n     */\n    _setStyleDeclaration: function(lineIndex, charIndex, style) {\n      this.styles[lineIndex][charIndex] = style;\n    },\n\n    /**\n     *\n     * @param {Number} lineIndex\n     * @param {Number} charIndex\n     * @private\n     */\n    _deleteStyleDeclaration: function(lineIndex, charIndex) {\n      delete this.styles[lineIndex][charIndex];\n    },\n\n    /**\n     * @param {Number} lineIndex\n     * @return {Boolean} if the line exists or not\n     * @private\n     */\n    _getLineStyle: function(lineIndex) {\n      return !!this.styles[lineIndex];\n    },\n\n    /**\n     * Set the line style to an empty object so that is initialized\n     * @param {Number} lineIndex\n     * @private\n     */\n    _setLineStyle: function(lineIndex) {\n      this.styles[lineIndex] = {};\n    },\n\n    /**\n     * @param {Number} lineIndex\n     * @private\n     */\n    _deleteLineStyle: function(lineIndex) {\n      delete this.styles[lineIndex];\n    }\n  });\n})();\n\n\n(function() {\n\n  function parseDecoration(object) {\n    if (object.textDecoration) {\n      object.textDecoration.indexOf('underline') > -1 && (object.underline = true);\n      object.textDecoration.indexOf('line-through') > -1 && (object.linethrough = true);\n      object.textDecoration.indexOf('overline') > -1 && (object.overline = true);\n      delete object.textDecoration;\n    }\n  }\n\n  /**\n   * IText class (introduced in <b>v1.4</b>) Events are also fired with \"text:\"\n   * prefix when observing canvas.\n   * @class fabric.IText\n   * @extends fabric.Text\n   * @mixes fabric.Observable\n   *\n   * @fires changed\n   * @fires selection:changed\n   * @fires editing:entered\n   * @fires editing:exited\n   *\n   * @return {fabric.IText} thisArg\n   * @see {@link fabric.IText#initialize} for constructor definition\n   *\n   * <p>Supported key combinations:</p>\n   * <pre>\n   *   Move cursor:                    left, right, up, down\n   *   Select character:               shift + left, shift + right\n   *   Select text vertically:         shift + up, shift + down\n   *   Move cursor by word:            alt + left, alt + right\n   *   Select words:                   shift + alt + left, shift + alt + right\n   *   Move cursor to line start/end:  cmd + left, cmd + right or home, end\n   *   Select till start/end of line:  cmd + shift + left, cmd + shift + right or shift + home, shift + end\n   *   Jump to start/end of text:      cmd + up, cmd + down\n   *   Select till start/end of text:  cmd + shift + up, cmd + shift + down or shift + pgUp, shift + pgDown\n   *   Delete character:               backspace\n   *   Delete word:                    alt + backspace\n   *   Delete line:                    cmd + backspace\n   *   Forward delete:                 delete\n   *   Copy text:                      ctrl/cmd + c\n   *   Paste text:                     ctrl/cmd + v\n   *   Cut text:                       ctrl/cmd + x\n   *   Select entire text:             ctrl/cmd + a\n   *   Quit editing                    tab or esc\n   * </pre>\n   *\n   * <p>Supported mouse/touch combination</p>\n   * <pre>\n   *   Position cursor:                click/touch\n   *   Create selection:               click/touch & drag\n   *   Create selection:               click & shift + click\n   *   Select word:                    double click\n   *   Select line:                    triple click\n   * </pre>\n   */\n  fabric.IText = fabric.util.createClass(fabric.Text, fabric.Observable, /** @lends fabric.IText.prototype */ {\n\n    /**\n     * Type of an object\n     * @type String\n     * @default\n     */\n    type: 'i-text',\n\n    /**\n     * Index where text selection starts (or where cursor is when there is no selection)\n     * @type Number\n     * @default\n     */\n    selectionStart: 0,\n\n    /**\n     * Index where text selection ends\n     * @type Number\n     * @default\n     */\n    selectionEnd: 0,\n\n    /**\n     * Color of text selection\n     * @type String\n     * @default\n     */\n    selectionColor: 'rgba(17,119,255,0.3)',\n\n    /**\n     * Indicates whether text is in editing mode\n     * @type Boolean\n     * @default\n     */\n    isEditing: false,\n\n    /**\n     * Indicates whether a text can be edited\n     * @type Boolean\n     * @default\n     */\n    editable: true,\n\n    /**\n     * Border color of text object while it's in editing mode\n     * @type String\n     * @default\n     */\n    editingBorderColor: 'rgba(102,153,255,0.25)',\n\n    /**\n     * Width of cursor (in px)\n     * @type Number\n     * @default\n     */\n    cursorWidth: 2,\n\n    /**\n     * Color of text cursor color in editing mode.\n     * if not set (default) will take color from the text.\n     * if set to a color value that fabric can understand, it will\n     * be used instead of the color of the text at the current position.\n     * @type String\n     * @default\n     */\n    cursorColor: '',\n\n    /**\n     * Delay between cursor blink (in ms)\n     * @type Number\n     * @default\n     */\n    cursorDelay: 1000,\n\n    /**\n     * Duration of cursor fadein (in ms)\n     * @type Number\n     * @default\n     */\n    cursorDuration: 600,\n\n    /**\n     * Indicates whether internal text char widths can be cached\n     * @type Boolean\n     * @default\n     */\n    caching: true,\n\n    /**\n     * DOM container to append the hiddenTextarea.\n     * An alternative to attaching to the document.body.\n     * Useful to reduce laggish redraw of the full document.body tree and\n     * also with modals event capturing that won't let the textarea take focus.\n     * @type HTMLElement\n     * @default\n     */\n    hiddenTextareaContainer: null,\n\n    /**\n     * @private\n     */\n    _reSpace: /\\s|\\n/,\n\n    /**\n     * @private\n     */\n    _currentCursorOpacity: 0,\n\n    /**\n     * @private\n     */\n    _selectionDirection: null,\n\n    /**\n     * @private\n     */\n    _abortCursorAnimation: false,\n\n    /**\n     * @private\n     */\n    __widthOfSpace: [],\n\n    /**\n     * Helps determining when the text is in composition, so that the cursor\n     * rendering is altered.\n     */\n    inCompositionMode: false,\n\n    /**\n     * Constructor\n     * @param {String} text Text string\n     * @param {Object} [options] Options object\n     * @return {fabric.IText} thisArg\n     */\n    initialize: function(text, options) {\n      this.callSuper('initialize', text, options);\n      this.initBehavior();\n    },\n\n    /**\n     * Sets selection start (left boundary of a selection)\n     * @param {Number} index Index to set selection start to\n     */\n    setSelectionStart: function(index) {\n      index = Math.max(index, 0);\n      this._updateAndFire('selectionStart', index);\n    },\n\n    /**\n     * Sets selection end (right boundary of a selection)\n     * @param {Number} index Index to set selection end to\n     */\n    setSelectionEnd: function(index) {\n      index = Math.min(index, this.text.length);\n      this._updateAndFire('selectionEnd', index);\n    },\n\n    /**\n     * @private\n     * @param {String} property 'selectionStart' or 'selectionEnd'\n     * @param {Number} index new position of property\n     */\n    _updateAndFire: function(property, index) {\n      if (this[property] !== index) {\n        this._fireSelectionChanged();\n        this[property] = index;\n      }\n      this._updateTextarea();\n    },\n\n    /**\n     * Fires the even of selection changed\n     * @private\n     */\n    _fireSelectionChanged: function() {\n      this.fire('selection:changed');\n      this.canvas && this.canvas.fire('text:selection:changed', { target: this });\n    },\n\n    /**\n     * Initialize text dimensions. Render all text on given context\n     * or on a offscreen canvas to get the text width with measureText.\n     * Updates this.width and this.height with the proper values.\n     * Does not return dimensions.\n     * @private\n     */\n    initDimensions: function() {\n      this.isEditing && this.initDelayedCursor();\n      this.clearContextTop();\n      this.callSuper('initDimensions');\n    },\n\n    /**\n     * @private\n     * @param {CanvasRenderingContext2D} ctx Context to render on\n     */\n    render: function(ctx) {\n      this.clearContextTop();\n      this.callSuper('render', ctx);\n      // clear the cursorOffsetCache, so we ensure to calculate once per renderCursor\n      // the correct position but not at every cursor animation.\n      this.cursorOffsetCache = { };\n      this.renderCursorOrSelection();\n    },\n\n    /**\n     * @private\n     * @param {CanvasRenderingContext2D} ctx Context to render on\n     */\n    _render: function(ctx) {\n      this.callSuper('_render', ctx);\n    },\n\n    /**\n     * Prepare and clean the contextTop\n     */\n    clearContextTop: function(skipRestore) {\n      if (!this.isEditing || !this.canvas || !this.canvas.contextTop) {\n        return;\n      }\n      var ctx = this.canvas.contextTop, v = this.canvas.viewportTransform;\n      ctx.save();\n      ctx.transform(v[0], v[1], v[2], v[3], v[4], v[5]);\n      this.transform(ctx);\n      this._clearTextArea(ctx);\n      skipRestore || ctx.restore();\n    },\n    /**\n     * Renders cursor or selection (depending on what exists)\n     * it does on the contextTop. If contextTop is not available, do nothing.\n     */\n    renderCursorOrSelection: function() {\n      if (!this.isEditing || !this.canvas || !this.canvas.contextTop) {\n        return;\n      }\n      var boundaries = this._getCursorBoundaries(),\n          ctx = this.canvas.contextTop;\n      this.clearContextTop(true);\n      if (this.selectionStart === this.selectionEnd) {\n        this.renderCursor(boundaries, ctx);\n      }\n      else {\n        this.renderSelection(boundaries, ctx);\n      }\n      ctx.restore();\n    },\n\n    _clearTextArea: function(ctx) {\n      // we add 4 pixel, to be sure to do not leave any pixel out\n      var width = this.width + 4, height = this.height + 4;\n      ctx.clearRect(-width / 2, -height / 2, width, height);\n    },\n\n    /**\n     * Returns cursor boundaries (left, top, leftOffset, topOffset)\n     * @private\n     * @param {Array} chars Array of characters\n     * @param {String} typeOfBoundaries\n     */\n    _getCursorBoundaries: function(position) {\n\n      // left/top are left/top of entire text box\n      // leftOffset/topOffset are offset from that left/top point of a text box\n\n      if (typeof position === 'undefined') {\n        position = this.selectionStart;\n      }\n\n      var left = this._getLeftOffset(),\n          top = this._getTopOffset(),\n          offsets = this._getCursorBoundariesOffsets(position);\n      return {\n        left: left,\n        top: top,\n        leftOffset: offsets.left,\n        topOffset: offsets.top\n      };\n    },\n\n    /**\n     * @private\n     */\n    _getCursorBoundariesOffsets: function(position) {\n      if (this.cursorOffsetCache && 'top' in this.cursorOffsetCache) {\n        return this.cursorOffsetCache;\n      }\n      var lineLeftOffset,\n          lineIndex,\n          charIndex,\n          topOffset = 0,\n          leftOffset = 0,\n          boundaries,\n          cursorPosition = this.get2DCursorLocation(position);\n      charIndex = cursorPosition.charIndex;\n      lineIndex = cursorPosition.lineIndex;\n      for (var i = 0; i < lineIndex; i++) {\n        topOffset += this.getHeightOfLine(i);\n      }\n      lineLeftOffset = this._getLineLeftOffset(lineIndex);\n      var bound = this.__charBounds[lineIndex][charIndex];\n      bound && (leftOffset = bound.left);\n      if (this.charSpacing !== 0 && charIndex === this._textLines[lineIndex].length) {\n        leftOffset -= this._getWidthOfCharSpacing();\n      }\n      boundaries = {\n        top: topOffset,\n        left: lineLeftOffset + (leftOffset > 0 ? leftOffset : 0),\n      };\n      if (this.direction === 'rtl') {\n        boundaries.left *= -1;\n      }\n      this.cursorOffsetCache = boundaries;\n      return this.cursorOffsetCache;\n    },\n\n    /**\n     * Renders cursor\n     * @param {Object} boundaries\n     * @param {CanvasRenderingContext2D} ctx transformed context to draw on\n     */\n    renderCursor: function(boundaries, ctx) {\n      var cursorLocation = this.get2DCursorLocation(),\n          lineIndex = cursorLocation.lineIndex,\n          charIndex = cursorLocation.charIndex > 0 ? cursorLocation.charIndex - 1 : 0,\n          charHeight = this.getValueOfPropertyAt(lineIndex, charIndex, 'fontSize'),\n          multiplier = this.scaleX * this.canvas.getZoom(),\n          cursorWidth = this.cursorWidth / multiplier,\n          topOffset = boundaries.topOffset,\n          dy = this.getValueOfPropertyAt(lineIndex, charIndex, 'deltaY');\n      topOffset += (1 - this._fontSizeFraction) * this.getHeightOfLine(lineIndex) / this.lineHeight\n        - charHeight * (1 - this._fontSizeFraction);\n\n      if (this.inCompositionMode) {\n        this.renderSelection(boundaries, ctx);\n      }\n      ctx.fillStyle = this.cursorColor || this.getValueOfPropertyAt(lineIndex, charIndex, 'fill');\n      ctx.globalAlpha = this.__isMousedown ? 1 : this._currentCursorOpacity;\n      ctx.fillRect(\n        boundaries.left + boundaries.leftOffset - cursorWidth / 2,\n        topOffset + boundaries.top + dy,\n        cursorWidth,\n        charHeight);\n    },\n\n    /**\n     * Renders text selection\n     * @param {Object} boundaries Object with left/top/leftOffset/topOffset\n     * @param {CanvasRenderingContext2D} ctx transformed context to draw on\n     */\n    renderSelection: function(boundaries, ctx) {\n\n      var selectionStart = this.inCompositionMode ? this.hiddenTextarea.selectionStart : this.selectionStart,\n          selectionEnd = this.inCompositionMode ? this.hiddenTextarea.selectionEnd : this.selectionEnd,\n          isJustify = this.textAlign.indexOf('justify') !== -1,\n          start = this.get2DCursorLocation(selectionStart),\n          end = this.get2DCursorLocation(selectionEnd),\n          startLine = start.lineIndex,\n          endLine = end.lineIndex,\n          startChar = start.charIndex < 0 ? 0 : start.charIndex,\n          endChar = end.charIndex < 0 ? 0 : end.charIndex;\n\n      for (var i = startLine; i <= endLine; i++) {\n        var lineOffset = this._getLineLeftOffset(i) || 0,\n            lineHeight = this.getHeightOfLine(i),\n            realLineHeight = 0, boxStart = 0, boxEnd = 0;\n\n        if (i === startLine) {\n          boxStart = this.__charBounds[startLine][startChar].left;\n        }\n        if (i >= startLine && i < endLine) {\n          boxEnd = isJustify && !this.isEndOfWrapping(i) ? this.width : this.getLineWidth(i) || 5; // WTF is this 5?\n        }\n        else if (i === endLine) {\n          if (endChar === 0) {\n            boxEnd = this.__charBounds[endLine][endChar].left;\n          }\n          else {\n            var charSpacing = this._getWidthOfCharSpacing();\n            boxEnd = this.__charBounds[endLine][endChar - 1].left\n              + this.__charBounds[endLine][endChar - 1].width - charSpacing;\n          }\n        }\n        realLineHeight = lineHeight;\n        if (this.lineHeight < 1 || (i === endLine && this.lineHeight > 1)) {\n          lineHeight /= this.lineHeight;\n        }\n        var drawStart = boundaries.left + lineOffset + boxStart,\n            drawWidth = boxEnd - boxStart,\n            drawHeight = lineHeight, extraTop = 0;\n        if (this.inCompositionMode) {\n          ctx.fillStyle = this.compositionColor || 'black';\n          drawHeight = 1;\n          extraTop = lineHeight;\n        }\n        else {\n          ctx.fillStyle = this.selectionColor;\n        }\n        if (this.direction === 'rtl') {\n          drawStart = this.width - drawStart - drawWidth;\n        }\n        ctx.fillRect(\n          drawStart,\n          boundaries.top + boundaries.topOffset + extraTop,\n          drawWidth,\n          drawHeight);\n        boundaries.topOffset += realLineHeight;\n      }\n    },\n\n    /**\n     * High level function to know the height of the cursor.\n     * the currentChar is the one that precedes the cursor\n     * Returns fontSize of char at the current cursor\n     * Unused from the library, is for the end user\n     * @return {Number} Character font size\n     */\n    getCurrentCharFontSize: function() {\n      var cp = this._getCurrentCharIndex();\n      return this.getValueOfPropertyAt(cp.l, cp.c, 'fontSize');\n    },\n\n    /**\n     * High level function to know the color of the cursor.\n     * the currentChar is the one that precedes the cursor\n     * Returns color (fill) of char at the current cursor\n     * if the text object has a pattern or gradient for filler, it will return that.\n     * Unused by the library, is for the end user\n     * @return {String | fabric.Gradient | fabric.Pattern} Character color (fill)\n     */\n    getCurrentCharColor: function() {\n      var cp = this._getCurrentCharIndex();\n      return this.getValueOfPropertyAt(cp.l, cp.c, 'fill');\n    },\n\n    /**\n     * Returns the cursor position for the getCurrent.. functions\n     * @private\n     */\n    _getCurrentCharIndex: function() {\n      var cursorPosition = this.get2DCursorLocation(this.selectionStart, true),\n          charIndex = cursorPosition.charIndex > 0 ? cursorPosition.charIndex - 1 : 0;\n      return { l: cursorPosition.lineIndex, c: charIndex };\n    }\n  });\n\n  /**\n   * Returns fabric.IText instance from an object representation\n   * @static\n   * @memberOf fabric.IText\n   * @param {Object} object Object to create an instance from\n   * @param {function} [callback] invoked with new instance as argument\n   */\n  fabric.IText.fromObject = function(object, callback) {\n    var styles = fabric.util.stylesFromArray(object.styles, object.text);\n    //copy object to prevent mutation\n    var objCopy = Object.assign({}, object, { styles: styles });\n    parseDecoration(objCopy);\n    if (objCopy.styles) {\n      for (var i in objCopy.styles) {\n        for (var j in objCopy.styles[i]) {\n          parseDecoration(objCopy.styles[i][j]);\n        }\n      }\n    }\n    fabric.Object._fromObject('IText', objCopy, callback, 'text');\n  };\n})();\n\n\n(function() {\n\n  var clone = fabric.util.object.clone;\n\n  fabric.util.object.extend(fabric.IText.prototype, /** @lends fabric.IText.prototype */ {\n\n    /**\n     * Initializes all the interactive behavior of IText\n     */\n    initBehavior: function() {\n      this.initAddedHandler();\n      this.initRemovedHandler();\n      this.initCursorSelectionHandlers();\n      this.initDoubleClickSimulation();\n      this.mouseMoveHandler = this.mouseMoveHandler.bind(this);\n    },\n\n    onDeselect: function() {\n      this.isEditing && this.exitEditing();\n      this.selected = false;\n    },\n\n    /**\n     * Initializes \"added\" event handler\n     */\n    initAddedHandler: function() {\n      var _this = this;\n      this.on('added', function() {\n        var canvas = _this.canvas;\n        if (canvas) {\n          if (!canvas._hasITextHandlers) {\n            canvas._hasITextHandlers = true;\n            _this._initCanvasHandlers(canvas);\n          }\n          canvas._iTextInstances = canvas._iTextInstances || [];\n          canvas._iTextInstances.push(_this);\n        }\n      });\n    },\n\n    initRemovedHandler: function() {\n      var _this = this;\n      this.on('removed', function() {\n        var canvas = _this.canvas;\n        if (canvas) {\n          canvas._iTextInstances = canvas._iTextInstances || [];\n          fabric.util.removeFromArray(canvas._iTextInstances, _this);\n          if (canvas._iTextInstances.length === 0) {\n            canvas._hasITextHandlers = false;\n            _this._removeCanvasHandlers(canvas);\n          }\n        }\n      });\n    },\n\n    /**\n     * register canvas event to manage exiting on other instances\n     * @private\n     */\n    _initCanvasHandlers: function(canvas) {\n      canvas._mouseUpITextHandler = function() {\n        if (canvas._iTextInstances) {\n          canvas._iTextInstances.forEach(function(obj) {\n            obj.__isMousedown = false;\n          });\n        }\n      };\n      canvas.on('mouse:up', canvas._mouseUpITextHandler);\n    },\n\n    /**\n     * remove canvas event to manage exiting on other instances\n     * @private\n     */\n    _removeCanvasHandlers: function(canvas) {\n      canvas.off('mouse:up', canvas._mouseUpITextHandler);\n    },\n\n    /**\n     * @private\n     */\n    _tick: function() {\n      this._currentTickState = this._animateCursor(this, 1, this.cursorDuration, '_onTickComplete');\n    },\n\n    /**\n     * @private\n     */\n    _animateCursor: function(obj, targetOpacity, duration, completeMethod) {\n\n      var tickState;\n\n      tickState = {\n        isAborted: false,\n        abort: function() {\n          this.isAborted = true;\n        },\n      };\n\n      obj.animate('_currentCursorOpacity', targetOpacity, {\n        duration: duration,\n        onComplete: function() {\n          if (!tickState.isAborted) {\n            obj[completeMethod]();\n          }\n        },\n        onChange: function() {\n          // we do not want to animate a selection, only cursor\n          if (obj.canvas && obj.selectionStart === obj.selectionEnd) {\n            obj.renderCursorOrSelection();\n          }\n        },\n        abort: function() {\n          return tickState.isAborted;\n        }\n      });\n      return tickState;\n    },\n\n    /**\n     * @private\n     */\n    _onTickComplete: function() {\n\n      var _this = this;\n\n      if (this._cursorTimeout1) {\n        clearTimeout(this._cursorTimeout1);\n      }\n      this._cursorTimeout1 = setTimeout(function() {\n        _this._currentTickCompleteState = _this._animateCursor(_this, 0, this.cursorDuration / 2, '_tick');\n      }, 100);\n    },\n\n    /**\n     * Initializes delayed cursor\n     */\n    initDelayedCursor: function(restart) {\n      var _this = this,\n          delay = restart ? 0 : this.cursorDelay;\n\n      this.abortCursorAnimation();\n      this._currentCursorOpacity = 1;\n      this._cursorTimeout2 = setTimeout(function() {\n        _this._tick();\n      }, delay);\n    },\n\n    /**\n     * Aborts cursor animation and clears all timeouts\n     */\n    abortCursorAnimation: function() {\n      var shouldClear = this._currentTickState || this._currentTickCompleteState,\n          canvas = this.canvas;\n      this._currentTickState && this._currentTickState.abort();\n      this._currentTickCompleteState && this._currentTickCompleteState.abort();\n\n      clearTimeout(this._cursorTimeout1);\n      clearTimeout(this._cursorTimeout2);\n\n      this._currentCursorOpacity = 0;\n      // to clear just itext area we need to transform the context\n      // it may not be worth it\n      if (shouldClear && canvas) {\n        canvas.clearContext(canvas.contextTop || canvas.contextContainer);\n      }\n\n    },\n\n    /**\n     * Selects entire text\n     * @return {fabric.IText} thisArg\n     * @chainable\n     */\n    selectAll: function() {\n      this.selectionStart = 0;\n      this.selectionEnd = this._text.length;\n      this._fireSelectionChanged();\n      this._updateTextarea();\n      return this;\n    },\n\n    /**\n     * Returns selected text\n     * @return {String}\n     */\n    getSelectedText: function() {\n      return this._text.slice(this.selectionStart, this.selectionEnd).join('');\n    },\n\n    /**\n     * Find new selection index representing start of current word according to current selection index\n     * @param {Number} startFrom Current selection index\n     * @return {Number} New selection index\n     */\n    findWordBoundaryLeft: function(startFrom) {\n      var offset = 0, index = startFrom - 1;\n\n      // remove space before cursor first\n      if (this._reSpace.test(this._text[index])) {\n        while (this._reSpace.test(this._text[index])) {\n          offset++;\n          index--;\n        }\n      }\n      while (/\\S/.test(this._text[index]) && index > -1) {\n        offset++;\n        index--;\n      }\n\n      return startFrom - offset;\n    },\n\n    /**\n     * Find new selection index representing end of current word according to current selection index\n     * @param {Number} startFrom Current selection index\n     * @return {Number} New selection index\n     */\n    findWordBoundaryRight: function(startFrom) {\n      var offset = 0, index = startFrom;\n\n      // remove space after cursor first\n      if (this._reSpace.test(this._text[index])) {\n        while (this._reSpace.test(this._text[index])) {\n          offset++;\n          index++;\n        }\n      }\n      while (/\\S/.test(this._text[index]) && index < this._text.length) {\n        offset++;\n        index++;\n      }\n\n      return startFrom + offset;\n    },\n\n    /**\n     * Find new selection index representing start of current line according to current selection index\n     * @param {Number} startFrom Current selection index\n     * @return {Number} New selection index\n     */\n    findLineBoundaryLeft: function(startFrom) {\n      var offset = 0, index = startFrom - 1;\n\n      while (!/\\n/.test(this._text[index]) && index > -1) {\n        offset++;\n        index--;\n      }\n\n      return startFrom - offset;\n    },\n\n    /**\n     * Find new selection index representing end of current line according to current selection index\n     * @param {Number} startFrom Current selection index\n     * @return {Number} New selection index\n     */\n    findLineBoundaryRight: function(startFrom) {\n      var offset = 0, index = startFrom;\n\n      while (!/\\n/.test(this._text[index]) && index < this._text.length) {\n        offset++;\n        index++;\n      }\n\n      return startFrom + offset;\n    },\n\n    /**\n     * Finds index corresponding to beginning or end of a word\n     * @param {Number} selectionStart Index of a character\n     * @param {Number} direction 1 or -1\n     * @return {Number} Index of the beginning or end of a word\n     */\n    searchWordBoundary: function(selectionStart, direction) {\n      var text = this._text,\n          index     = this._reSpace.test(text[selectionStart]) ? selectionStart - 1 : selectionStart,\n          _char     = text[index],\n          // wrong\n          reNonWord = fabric.reNonWord;\n\n      while (!reNonWord.test(_char) && index > 0 && index < text.length) {\n        index += direction;\n        _char = text[index];\n      }\n      if (reNonWord.test(_char)) {\n        index += direction === 1 ? 0 : 1;\n      }\n      return index;\n    },\n\n    /**\n     * Selects a word based on the index\n     * @param {Number} selectionStart Index of a character\n     */\n    selectWord: function(selectionStart) {\n      selectionStart = selectionStart || this.selectionStart;\n      var newSelectionStart = this.searchWordBoundary(selectionStart, -1), /* search backwards */\n          newSelectionEnd = this.searchWordBoundary(selectionStart, 1); /* search forward */\n\n      this.selectionStart = newSelectionStart;\n      this.selectionEnd = newSelectionEnd;\n      this._fireSelectionChanged();\n      this._updateTextarea();\n      this.renderCursorOrSelection();\n    },\n\n    /**\n     * Selects a line based on the index\n     * @param {Number} selectionStart Index of a character\n     * @return {fabric.IText} thisArg\n     * @chainable\n     */\n    selectLine: function(selectionStart) {\n      selectionStart = selectionStart || this.selectionStart;\n      var newSelectionStart = this.findLineBoundaryLeft(selectionStart),\n          newSelectionEnd = this.findLineBoundaryRight(selectionStart);\n\n      this.selectionStart = newSelectionStart;\n      this.selectionEnd = newSelectionEnd;\n      this._fireSelectionChanged();\n      this._updateTextarea();\n      return this;\n    },\n\n    /**\n     * Enters editing state\n     * @return {fabric.IText} thisArg\n     * @chainable\n     */\n    enterEditing: function(e) {\n      if (this.isEditing || !this.editable) {\n        return;\n      }\n\n      if (this.canvas) {\n        this.canvas.calcOffset();\n        this.exitEditingOnOthers(this.canvas);\n      }\n\n      this.isEditing = true;\n\n      this.initHiddenTextarea(e);\n      this.hiddenTextarea.focus();\n      this.hiddenTextarea.value = this.text;\n      this._updateTextarea();\n      this._saveEditingProps();\n      this._setEditingProps();\n      this._textBeforeEdit = this.text;\n\n      this._tick();\n      this.fire('editing:entered');\n      this._fireSelectionChanged();\n      if (!this.canvas) {\n        return this;\n      }\n      this.canvas.fire('text:editing:entered', { target: this });\n      this.initMouseMoveHandler();\n      this.canvas.requestRenderAll();\n      return this;\n    },\n\n    exitEditingOnOthers: function(canvas) {\n      if (canvas._iTextInstances) {\n        canvas._iTextInstances.forEach(function(obj) {\n          obj.selected = false;\n          if (obj.isEditing) {\n            obj.exitEditing();\n          }\n        });\n      }\n    },\n\n    /**\n     * Initializes \"mousemove\" event handler\n     */\n    initMouseMoveHandler: function() {\n      this.canvas.on('mouse:move', this.mouseMoveHandler);\n    },\n\n    /**\n     * @private\n     */\n    mouseMoveHandler: function(options) {\n      if (!this.__isMousedown || !this.isEditing) {\n        return;\n      }\n\n      // regain focus\n      document.activeElement !== this.hiddenTextarea && this.hiddenTextarea.focus();\n\n      var newSelectionStart = this.getSelectionStartFromPointer(options.e),\n          currentStart = this.selectionStart,\n          currentEnd = this.selectionEnd;\n      if (\n        (newSelectionStart !== this.__selectionStartOnMouseDown || currentStart === currentEnd)\n        &&\n        (currentStart === newSelectionStart || currentEnd === newSelectionStart)\n      ) {\n        return;\n      }\n      if (newSelectionStart > this.__selectionStartOnMouseDown) {\n        this.selectionStart = this.__selectionStartOnMouseDown;\n        this.selectionEnd = newSelectionStart;\n      }\n      else {\n        this.selectionStart = newSelectionStart;\n        this.selectionEnd = this.__selectionStartOnMouseDown;\n      }\n      if (this.selectionStart !== currentStart || this.selectionEnd !== currentEnd) {\n        this.restartCursorIfNeeded();\n        this._fireSelectionChanged();\n        this._updateTextarea();\n        this.renderCursorOrSelection();\n      }\n    },\n\n    /**\n     * @private\n     */\n    _setEditingProps: function() {\n      this.hoverCursor = 'text';\n\n      if (this.canvas) {\n        this.canvas.defaultCursor = this.canvas.moveCursor = 'text';\n      }\n\n      this.borderColor = this.editingBorderColor;\n      this.hasControls = this.selectable = false;\n      this.lockMovementX = this.lockMovementY = true;\n    },\n\n    /**\n     * convert from textarea to grapheme indexes\n     */\n    fromStringToGraphemeSelection: function(start, end, text) {\n      var smallerTextStart = text.slice(0, start),\n          graphemeStart = fabric.util.string.graphemeSplit(smallerTextStart).length;\n      if (start === end) {\n        return { selectionStart: graphemeStart, selectionEnd: graphemeStart };\n      }\n      var smallerTextEnd = text.slice(start, end),\n          graphemeEnd = fabric.util.string.graphemeSplit(smallerTextEnd).length;\n      return { selectionStart: graphemeStart, selectionEnd: graphemeStart + graphemeEnd };\n    },\n\n    /**\n     * convert from fabric to textarea values\n     */\n    fromGraphemeToStringSelection: function(start, end, _text) {\n      var smallerTextStart = _text.slice(0, start),\n          graphemeStart = smallerTextStart.join('').length;\n      if (start === end) {\n        return { selectionStart: graphemeStart, selectionEnd: graphemeStart };\n      }\n      var smallerTextEnd = _text.slice(start, end),\n          graphemeEnd = smallerTextEnd.join('').length;\n      return { selectionStart: graphemeStart, selectionEnd: graphemeStart + graphemeEnd };\n    },\n\n    /**\n     * @private\n     */\n    _updateTextarea: function() {\n      this.cursorOffsetCache = { };\n      if (!this.hiddenTextarea) {\n        return;\n      }\n      if (!this.inCompositionMode) {\n        var newSelection = this.fromGraphemeToStringSelection(this.selectionStart, this.selectionEnd, this._text);\n        this.hiddenTextarea.selectionStart = newSelection.selectionStart;\n        this.hiddenTextarea.selectionEnd = newSelection.selectionEnd;\n      }\n      this.updateTextareaPosition();\n    },\n\n    /**\n     * @private\n     */\n    updateFromTextArea: function() {\n      if (!this.hiddenTextarea) {\n        return;\n      }\n      this.cursorOffsetCache = { };\n      this.text = this.hiddenTextarea.value;\n      if (this._shouldClearDimensionCache()) {\n        this.initDimensions();\n        this.setCoords();\n      }\n      var newSelection = this.fromStringToGraphemeSelection(\n        this.hiddenTextarea.selectionStart, this.hiddenTextarea.selectionEnd, this.hiddenTextarea.value);\n      this.selectionEnd = this.selectionStart = newSelection.selectionEnd;\n      if (!this.inCompositionMode) {\n        this.selectionStart = newSelection.selectionStart;\n      }\n      this.updateTextareaPosition();\n    },\n\n    /**\n     * @private\n     */\n    updateTextareaPosition: function() {\n      if (this.selectionStart === this.selectionEnd) {\n        var style = this._calcTextareaPosition();\n        this.hiddenTextarea.style.left = style.left;\n        this.hiddenTextarea.style.top = style.top;\n      }\n    },\n\n    /**\n     * @private\n     * @return {Object} style contains style for hiddenTextarea\n     */\n    _calcTextareaPosition: function() {\n      if (!this.canvas) {\n        return { x: 1, y: 1 };\n      }\n      var desiredPosition = this.inCompositionMode ? this.compositionStart : this.selectionStart,\n          boundaries = this._getCursorBoundaries(desiredPosition),\n          cursorLocation = this.get2DCursorLocation(desiredPosition),\n          lineIndex = cursorLocation.lineIndex,\n          charIndex = cursorLocation.charIndex,\n          charHeight = this.getValueOfPropertyAt(lineIndex, charIndex, 'fontSize') * this.lineHeight,\n          leftOffset = boundaries.leftOffset,\n          m = this.calcTransformMatrix(),\n          p = {\n            x: boundaries.left + leftOffset,\n            y: boundaries.top + boundaries.topOffset + charHeight\n          },\n          retinaScaling = this.canvas.getRetinaScaling(),\n          upperCanvas = this.canvas.upperCanvasEl,\n          upperCanvasWidth = upperCanvas.width / retinaScaling,\n          upperCanvasHeight = upperCanvas.height / retinaScaling,\n          maxWidth = upperCanvasWidth - charHeight,\n          maxHeight = upperCanvasHeight - charHeight,\n          scaleX = upperCanvas.clientWidth / upperCanvasWidth,\n          scaleY = upperCanvas.clientHeight / upperCanvasHeight;\n\n      p = fabric.util.transformPoint(p, m);\n      p = fabric.util.transformPoint(p, this.canvas.viewportTransform);\n      p.x *= scaleX;\n      p.y *= scaleY;\n      if (p.x < 0) {\n        p.x = 0;\n      }\n      if (p.x > maxWidth) {\n        p.x = maxWidth;\n      }\n      if (p.y < 0) {\n        p.y = 0;\n      }\n      if (p.y > maxHeight) {\n        p.y = maxHeight;\n      }\n\n      // add canvas offset on document\n      p.x += this.canvas._offset.left;\n      p.y += this.canvas._offset.top;\n\n      return { left: p.x + 'px', top: p.y + 'px', fontSize: charHeight + 'px', charHeight: charHeight };\n    },\n\n    /**\n     * @private\n     */\n    _saveEditingProps: function() {\n      this._savedProps = {\n        hasControls: this.hasControls,\n        borderColor: this.borderColor,\n        lockMovementX: this.lockMovementX,\n        lockMovementY: this.lockMovementY,\n        hoverCursor: this.hoverCursor,\n        selectable: this.selectable,\n        defaultCursor: this.canvas && this.canvas.defaultCursor,\n        moveCursor: this.canvas && this.canvas.moveCursor\n      };\n    },\n\n    /**\n     * @private\n     */\n    _restoreEditingProps: function() {\n      if (!this._savedProps) {\n        return;\n      }\n\n      this.hoverCursor = this._savedProps.hoverCursor;\n      this.hasControls = this._savedProps.hasControls;\n      this.borderColor = this._savedProps.borderColor;\n      this.selectable = this._savedProps.selectable;\n      this.lockMovementX = this._savedProps.lockMovementX;\n      this.lockMovementY = this._savedProps.lockMovementY;\n\n      if (this.canvas) {\n        this.canvas.defaultCursor = this._savedProps.defaultCursor;\n        this.canvas.moveCursor = this._savedProps.moveCursor;\n      }\n    },\n\n    /**\n     * Exits from editing state\n     * @return {fabric.IText} thisArg\n     * @chainable\n     */\n    exitEditing: function() {\n      var isTextChanged = (this._textBeforeEdit !== this.text);\n      var hiddenTextarea = this.hiddenTextarea;\n      this.selected = false;\n      this.isEditing = false;\n\n      this.selectionEnd = this.selectionStart;\n\n      if (hiddenTextarea) {\n        hiddenTextarea.blur && hiddenTextarea.blur();\n        hiddenTextarea.parentNode && hiddenTextarea.parentNode.removeChild(hiddenTextarea);\n      }\n      this.hiddenTextarea = null;\n      this.abortCursorAnimation();\n      this._restoreEditingProps();\n      this._currentCursorOpacity = 0;\n      if (this._shouldClearDimensionCache()) {\n        this.initDimensions();\n        this.setCoords();\n      }\n      this.fire('editing:exited');\n      isTextChanged && this.fire('modified');\n      if (this.canvas) {\n        this.canvas.off('mouse:move', this.mouseMoveHandler);\n        this.canvas.fire('text:editing:exited', { target: this });\n        isTextChanged && this.canvas.fire('object:modified', { target: this });\n      }\n      return this;\n    },\n\n    /**\n     * @private\n     */\n    _removeExtraneousStyles: function() {\n      for (var prop in this.styles) {\n        if (!this._textLines[prop]) {\n          delete this.styles[prop];\n        }\n      }\n    },\n\n    /**\n     * remove and reflow a style block from start to end.\n     * @param {Number} start linear start position for removal (included in removal)\n     * @param {Number} end linear end position for removal ( excluded from removal )\n     */\n    removeStyleFromTo: function(start, end) {\n      var cursorStart = this.get2DCursorLocation(start, true),\n          cursorEnd = this.get2DCursorLocation(end, true),\n          lineStart = cursorStart.lineIndex,\n          charStart = cursorStart.charIndex,\n          lineEnd = cursorEnd.lineIndex,\n          charEnd = cursorEnd.charIndex,\n          i, styleObj;\n      if (lineStart !== lineEnd) {\n        // step1 remove the trailing of lineStart\n        if (this.styles[lineStart]) {\n          for (i = charStart; i < this._unwrappedTextLines[lineStart].length; i++) {\n            delete this.styles[lineStart][i];\n          }\n        }\n        // step2 move the trailing of lineEnd to lineStart if needed\n        if (this.styles[lineEnd]) {\n          for (i = charEnd; i < this._unwrappedTextLines[lineEnd].length; i++) {\n            styleObj = this.styles[lineEnd][i];\n            if (styleObj) {\n              this.styles[lineStart] || (this.styles[lineStart] = { });\n              this.styles[lineStart][charStart + i - charEnd] = styleObj;\n            }\n          }\n        }\n        // step3 detects lines will be completely removed.\n        for (i = lineStart + 1; i <= lineEnd; i++) {\n          delete this.styles[i];\n        }\n        // step4 shift remaining lines.\n        this.shiftLineStyles(lineEnd, lineStart - lineEnd);\n      }\n      else {\n        // remove and shift left on the same line\n        if (this.styles[lineStart]) {\n          styleObj = this.styles[lineStart];\n          var diff = charEnd - charStart, numericChar, _char;\n          for (i = charStart; i < charEnd; i++) {\n            delete styleObj[i];\n          }\n          for (_char in this.styles[lineStart]) {\n            numericChar = parseInt(_char, 10);\n            if (numericChar >= charEnd) {\n              styleObj[numericChar - diff] = styleObj[_char];\n              delete styleObj[_char];\n            }\n          }\n        }\n      }\n    },\n\n    /**\n     * Shifts line styles up or down\n     * @param {Number} lineIndex Index of a line\n     * @param {Number} offset Can any number?\n     */\n    shiftLineStyles: function(lineIndex, offset) {\n      // shift all line styles by offset upward or downward\n      // do not clone deep. we need new array, not new style objects\n      var clonedStyles = clone(this.styles);\n      for (var line in this.styles) {\n        var numericLine = parseInt(line, 10);\n        if (numericLine > lineIndex) {\n          this.styles[numericLine + offset] = clonedStyles[numericLine];\n          if (!clonedStyles[numericLine - offset]) {\n            delete this.styles[numericLine];\n          }\n        }\n      }\n    },\n\n    restartCursorIfNeeded: function() {\n      if (!this._currentTickState || this._currentTickState.isAborted\n        || !this._currentTickCompleteState || this._currentTickCompleteState.isAborted\n      ) {\n        this.initDelayedCursor();\n      }\n    },\n\n    /**\n     * Handle insertion of more consecutive style lines for when one or more\n     * newlines gets added to the text. Since current style needs to be shifted\n     * first we shift the current style of the number lines needed, then we add\n     * new lines from the last to the first.\n     * @param {Number} lineIndex Index of a line\n     * @param {Number} charIndex Index of a char\n     * @param {Number} qty number of lines to add\n     * @param {Array} copiedStyle Array of objects styles\n     */\n    insertNewlineStyleObject: function(lineIndex, charIndex, qty, copiedStyle) {\n      var currentCharStyle,\n          newLineStyles = {},\n          somethingAdded = false,\n          isEndOfLine = this._unwrappedTextLines[lineIndex].length === charIndex;\n\n      qty || (qty = 1);\n      this.shiftLineStyles(lineIndex, qty);\n      if (this.styles[lineIndex]) {\n        currentCharStyle = this.styles[lineIndex][charIndex === 0 ? charIndex : charIndex - 1];\n      }\n      // we clone styles of all chars\n      // after cursor onto the current line\n      for (var index in this.styles[lineIndex]) {\n        var numIndex = parseInt(index, 10);\n        if (numIndex >= charIndex) {\n          somethingAdded = true;\n          newLineStyles[numIndex - charIndex] = this.styles[lineIndex][index];\n          // remove lines from the previous line since they're on a new line now\n          if (!(isEndOfLine && charIndex === 0)) {\n            delete this.styles[lineIndex][index];\n          }\n        }\n      }\n      var styleCarriedOver = false;\n      if (somethingAdded && !isEndOfLine) {\n        // if is end of line, the extra style we copied\n        // is probably not something we want\n        this.styles[lineIndex + qty] = newLineStyles;\n        styleCarriedOver = true;\n      }\n      if (styleCarriedOver) {\n        // skip the last line of since we already prepared it.\n        qty--;\n      }\n      // for the all the lines or all the other lines\n      // we clone current char style onto the next (otherwise empty) line\n      while (qty > 0) {\n        if (copiedStyle && copiedStyle[qty - 1]) {\n          this.styles[lineIndex + qty] = { 0: clone(copiedStyle[qty - 1]) };\n        }\n        else if (currentCharStyle) {\n          this.styles[lineIndex + qty] = { 0: clone(currentCharStyle) };\n        }\n        else {\n          delete this.styles[lineIndex + qty];\n        }\n        qty--;\n      }\n      this._forceClearCache = true;\n    },\n\n    /**\n     * Inserts style object for a given line/char index\n     * @param {Number} lineIndex Index of a line\n     * @param {Number} charIndex Index of a char\n     * @param {Number} quantity number Style object to insert, if given\n     * @param {Array} copiedStyle array of style objects\n     */\n    insertCharStyleObject: function(lineIndex, charIndex, quantity, copiedStyle) {\n      if (!this.styles) {\n        this.styles = {};\n      }\n      var currentLineStyles       = this.styles[lineIndex],\n          currentLineStylesCloned = currentLineStyles ? clone(currentLineStyles) : {};\n\n      quantity || (quantity = 1);\n      // shift all char styles by quantity forward\n      // 0,1,2,3 -> (charIndex=2) -> 0,1,3,4 -> (insert 2) -> 0,1,2,3,4\n      for (var index in currentLineStylesCloned) {\n        var numericIndex = parseInt(index, 10);\n        if (numericIndex >= charIndex) {\n          currentLineStyles[numericIndex + quantity] = currentLineStylesCloned[numericIndex];\n          // only delete the style if there was nothing moved there\n          if (!currentLineStylesCloned[numericIndex - quantity]) {\n            delete currentLineStyles[numericIndex];\n          }\n        }\n      }\n      this._forceClearCache = true;\n      if (copiedStyle) {\n        while (quantity--) {\n          if (!Object.keys(copiedStyle[quantity]).length) {\n            continue;\n          }\n          if (!this.styles[lineIndex]) {\n            this.styles[lineIndex] = {};\n          }\n          this.styles[lineIndex][charIndex + quantity] = clone(copiedStyle[quantity]);\n        }\n        return;\n      }\n      if (!currentLineStyles) {\n        return;\n      }\n      var newStyle = currentLineStyles[charIndex ? charIndex - 1 : 1];\n      while (newStyle && quantity--) {\n        this.styles[lineIndex][charIndex + quantity] = clone(newStyle);\n      }\n    },\n\n    /**\n     * Inserts style object(s)\n     * @param {Array} insertedText Characters at the location where style is inserted\n     * @param {Number} start cursor index for inserting style\n     * @param {Array} [copiedStyle] array of style objects to insert.\n     */\n    insertNewStyleBlock: function(insertedText, start, copiedStyle) {\n      var cursorLoc = this.get2DCursorLocation(start, true),\n          addedLines = [0], linesLength = 0;\n      // get an array of how many char per lines are being added.\n      for (var i = 0; i < insertedText.length; i++) {\n        if (insertedText[i] === '\\n') {\n          linesLength++;\n          addedLines[linesLength] = 0;\n        }\n        else {\n          addedLines[linesLength]++;\n        }\n      }\n      // for the first line copy the style from the current char position.\n      if (addedLines[0] > 0) {\n        this.insertCharStyleObject(cursorLoc.lineIndex, cursorLoc.charIndex, addedLines[0], copiedStyle);\n        copiedStyle = copiedStyle && copiedStyle.slice(addedLines[0] + 1);\n      }\n      linesLength && this.insertNewlineStyleObject(\n        cursorLoc.lineIndex, cursorLoc.charIndex + addedLines[0], linesLength);\n      for (var i = 1; i < linesLength; i++) {\n        if (addedLines[i] > 0) {\n          this.insertCharStyleObject(cursorLoc.lineIndex + i, 0, addedLines[i], copiedStyle);\n        }\n        else if (copiedStyle) {\n          // this test is required in order to close #6841\n          // when a pasted buffer begins with a newline then\n          // this.styles[cursorLoc.lineIndex + i] and copiedStyle[0]\n          // may be undefined for some reason\n          if (this.styles[cursorLoc.lineIndex + i] && copiedStyle[0]) {\n            this.styles[cursorLoc.lineIndex + i][0] = copiedStyle[0];\n          }\n        }\n        copiedStyle = copiedStyle && copiedStyle.slice(addedLines[i] + 1);\n      }\n      // we use i outside the loop to get it like linesLength\n      if (addedLines[i] > 0) {\n        this.insertCharStyleObject(cursorLoc.lineIndex + i, 0, addedLines[i], copiedStyle);\n      }\n    },\n\n    /**\n     * Set the selectionStart and selectionEnd according to the new position of cursor\n     * mimic the key - mouse navigation when shift is pressed.\n     */\n    setSelectionStartEndWithShift: function(start, end, newSelection) {\n      if (newSelection <= start) {\n        if (end === start) {\n          this._selectionDirection = 'left';\n        }\n        else if (this._selectionDirection === 'right') {\n          this._selectionDirection = 'left';\n          this.selectionEnd = start;\n        }\n        this.selectionStart = newSelection;\n      }\n      else if (newSelection > start && newSelection < end) {\n        if (this._selectionDirection === 'right') {\n          this.selectionEnd = newSelection;\n        }\n        else {\n          this.selectionStart = newSelection;\n        }\n      }\n      else {\n        // newSelection is > selection start and end\n        if (end === start) {\n          this._selectionDirection = 'right';\n        }\n        else if (this._selectionDirection === 'left') {\n          this._selectionDirection = 'right';\n          this.selectionStart = end;\n        }\n        this.selectionEnd = newSelection;\n      }\n    },\n\n    setSelectionInBoundaries: function() {\n      var length = this.text.length;\n      if (this.selectionStart > length) {\n        this.selectionStart = length;\n      }\n      else if (this.selectionStart < 0) {\n        this.selectionStart = 0;\n      }\n      if (this.selectionEnd > length) {\n        this.selectionEnd = length;\n      }\n      else if (this.selectionEnd < 0) {\n        this.selectionEnd = 0;\n      }\n    }\n  });\n})();\n\n\nfabric.util.object.extend(fabric.IText.prototype, /** @lends fabric.IText.prototype */ {\n  /**\n   * Initializes \"dbclick\" event handler\n   */\n  initDoubleClickSimulation: function() {\n\n    // for double click\n    this.__lastClickTime = +new Date();\n\n    // for triple click\n    this.__lastLastClickTime = +new Date();\n\n    this.__lastPointer = { };\n\n    this.on('mousedown', this.onMouseDown);\n  },\n\n  /**\n   * Default event handler to simulate triple click\n   * @private\n   */\n  onMouseDown: function(options) {\n    if (!this.canvas) {\n      return;\n    }\n    this.__newClickTime = +new Date();\n    var newPointer = options.pointer;\n    if (this.isTripleClick(newPointer)) {\n      this.fire('tripleclick', options);\n      this._stopEvent(options.e);\n    }\n    this.__lastLastClickTime = this.__lastClickTime;\n    this.__lastClickTime = this.__newClickTime;\n    this.__lastPointer = newPointer;\n    this.__lastIsEditing = this.isEditing;\n    this.__lastSelected = this.selected;\n  },\n\n  isTripleClick: function(newPointer) {\n    return this.__newClickTime - this.__lastClickTime < 500 &&\n        this.__lastClickTime - this.__lastLastClickTime < 500 &&\n        this.__lastPointer.x === newPointer.x &&\n        this.__lastPointer.y === newPointer.y;\n  },\n\n  /**\n   * @private\n   */\n  _stopEvent: function(e) {\n    e.preventDefault && e.preventDefault();\n    e.stopPropagation && e.stopPropagation();\n  },\n\n  /**\n   * Initializes event handlers related to cursor or selection\n   */\n  initCursorSelectionHandlers: function() {\n    this.initMousedownHandler();\n    this.initMouseupHandler();\n    this.initClicks();\n  },\n\n  /**\n   * Default handler for double click, select a word\n   */\n  doubleClickHandler: function(options) {\n    if (!this.isEditing) {\n      return;\n    }\n    this.selectWord(this.getSelectionStartFromPointer(options.e));\n  },\n\n  /**\n   * Default handler for triple click, select a line\n   */\n  tripleClickHandler: function(options) {\n    if (!this.isEditing) {\n      return;\n    }\n    this.selectLine(this.getSelectionStartFromPointer(options.e));\n  },\n\n  /**\n   * Initializes double and triple click event handlers\n   */\n  initClicks: function() {\n    this.on('mousedblclick', this.doubleClickHandler);\n    this.on('tripleclick', this.tripleClickHandler);\n  },\n\n  /**\n   * Default event handler for the basic functionalities needed on _mouseDown\n   * can be overridden to do something different.\n   * Scope of this implementation is: find the click position, set selectionStart\n   * find selectionEnd, initialize the drawing of either cursor or selection area\n   * initializing a mousedDown on a text area will cancel fabricjs knowledge of\n   * current compositionMode. It will be set to false.\n   */\n  _mouseDownHandler: function(options) {\n    if (!this.canvas || !this.editable || (options.e.button && options.e.button !== 1)) {\n      return;\n    }\n\n    this.__isMousedown = true;\n\n    if (this.selected) {\n      this.inCompositionMode = false;\n      this.setCursorByClick(options.e);\n    }\n\n    if (this.isEditing) {\n      this.__selectionStartOnMouseDown = this.selectionStart;\n      if (this.selectionStart === this.selectionEnd) {\n        this.abortCursorAnimation();\n      }\n      this.renderCursorOrSelection();\n    }\n  },\n\n  /**\n   * Default event handler for the basic functionalities needed on mousedown:before\n   * can be overridden to do something different.\n   * Scope of this implementation is: verify the object is already selected when mousing down\n   */\n  _mouseDownHandlerBefore: function(options) {\n    if (!this.canvas || !this.editable || (options.e.button && options.e.button !== 1)) {\n      return;\n    }\n    // we want to avoid that an object that was selected and then becomes unselectable,\n    // may trigger editing mode in some way.\n    this.selected = this === this.canvas._activeObject;\n  },\n\n  /**\n   * Initializes \"mousedown\" event handler\n   */\n  initMousedownHandler: function() {\n    this.on('mousedown', this._mouseDownHandler);\n    this.on('mousedown:before', this._mouseDownHandlerBefore);\n  },\n\n  /**\n   * Initializes \"mouseup\" event handler\n   */\n  initMouseupHandler: function() {\n    this.on('mouseup', this.mouseUpHandler);\n  },\n\n  /**\n   * standard handler for mouse up, overridable\n   * @private\n   */\n  mouseUpHandler: function(options) {\n    this.__isMousedown = false;\n    if (!this.editable || this.group ||\n      (options.transform && options.transform.actionPerformed) ||\n      (options.e.button && options.e.button !== 1)) {\n      return;\n    }\n\n    if (this.canvas) {\n      var currentActive = this.canvas._activeObject;\n      if (currentActive && currentActive !== this) {\n        // avoid running this logic when there is an active object\n        // this because is possible with shift click and fast clicks,\n        // to rapidly deselect and reselect this object and trigger an enterEdit\n        return;\n      }\n    }\n\n    if (this.__lastSelected && !this.__corner) {\n      this.selected = false;\n      this.__lastSelected = false;\n      this.enterEditing(options.e);\n      if (this.selectionStart === this.selectionEnd) {\n        this.initDelayedCursor(true);\n      }\n      else {\n        this.renderCursorOrSelection();\n      }\n    }\n    else {\n      this.selected = true;\n    }\n  },\n\n  /**\n   * Changes cursor location in a text depending on passed pointer (x/y) object\n   * @param {Event} e Event object\n   */\n  setCursorByClick: function(e) {\n    var newSelection = this.getSelectionStartFromPointer(e),\n        start = this.selectionStart, end = this.selectionEnd;\n    if (e.shiftKey) {\n      this.setSelectionStartEndWithShift(start, end, newSelection);\n    }\n    else {\n      this.selectionStart = newSelection;\n      this.selectionEnd = newSelection;\n    }\n    if (this.isEditing) {\n      this._fireSelectionChanged();\n      this._updateTextarea();\n    }\n  },\n\n  /**\n   * Returns index of a character corresponding to where an object was clicked\n   * @param {Event} e Event object\n   * @return {Number} Index of a character\n   */\n  getSelectionStartFromPointer: function(e) {\n    var mouseOffset = this.getLocalPointer(e),\n        prevWidth = 0,\n        width = 0,\n        height = 0,\n        charIndex = 0,\n        lineIndex = 0,\n        lineLeftOffset,\n        line;\n    for (var i = 0, len = this._textLines.length; i < len; i++) {\n      if (height <= mouseOffset.y) {\n        height += this.getHeightOfLine(i) * this.scaleY;\n        lineIndex = i;\n        if (i > 0) {\n          charIndex += this._textLines[i - 1].length + this.missingNewlineOffset(i - 1);\n        }\n      }\n      else {\n        break;\n      }\n    }\n    lineLeftOffset = this._getLineLeftOffset(lineIndex);\n    width = lineLeftOffset * this.scaleX;\n    line = this._textLines[lineIndex];\n    // handling of RTL: in order to get things work correctly,\n    // we assume RTL writing is mirrored compared to LTR writing.\n    // so in position detection we mirror the X offset, and when is time\n    // of rendering it, we mirror it again.\n    if (this.direction === 'rtl') {\n      mouseOffset.x = this.width * this.scaleX - mouseOffset.x + width;\n    }\n    for (var j = 0, jlen = line.length; j < jlen; j++) {\n      prevWidth = width;\n      // i removed something about flipX here, check.\n      width += this.__charBounds[lineIndex][j].kernedWidth * this.scaleX;\n      if (width <= mouseOffset.x) {\n        charIndex++;\n      }\n      else {\n        break;\n      }\n    }\n    return this._getNewSelectionStartFromOffset(mouseOffset, prevWidth, width, charIndex, jlen);\n  },\n\n  /**\n   * @private\n   */\n  _getNewSelectionStartFromOffset: function(mouseOffset, prevWidth, width, index, jlen) {\n    // we need Math.abs because when width is after the last char, the offset is given as 1, while is 0\n    var distanceBtwLastCharAndCursor = mouseOffset.x - prevWidth,\n        distanceBtwNextCharAndCursor = width - mouseOffset.x,\n        offset = distanceBtwNextCharAndCursor > distanceBtwLastCharAndCursor ||\n          distanceBtwNextCharAndCursor < 0 ? 0 : 1,\n        newSelectionStart = index + offset;\n    // if object is horizontally flipped, mirror cursor location from the end\n    if (this.flipX) {\n      newSelectionStart = jlen - newSelectionStart;\n    }\n\n    if (newSelectionStart > this._text.length) {\n      newSelectionStart = this._text.length;\n    }\n\n    return newSelectionStart;\n  }\n});\n\n\nfabric.util.object.extend(fabric.IText.prototype, /** @lends fabric.IText.prototype */ {\n\n  /**\n   * Initializes hidden textarea (needed to bring up keyboard in iOS)\n   */\n  initHiddenTextarea: function() {\n    this.hiddenTextarea = fabric.document.createElement('textarea');\n    this.hiddenTextarea.setAttribute('autocapitalize', 'off');\n    this.hiddenTextarea.setAttribute('autocorrect', 'off');\n    this.hiddenTextarea.setAttribute('autocomplete', 'off');\n    this.hiddenTextarea.setAttribute('spellcheck', 'false');\n    this.hiddenTextarea.setAttribute('data-fabric-hiddentextarea', '');\n    this.hiddenTextarea.setAttribute('wrap', 'off');\n    var style = this._calcTextareaPosition();\n    // line-height: 1px; was removed from the style to fix this:\n    // https://bugs.chromium.org/p/chromium/issues/detail?id=870966\n    this.hiddenTextarea.style.cssText = 'position: absolute; top: ' + style.top +\n    '; left: ' + style.left + '; z-index: -999; opacity: 0; width: 1px; height: 1px; font-size: 1px;' +\n    ' paddingｰtop: ' + style.fontSize + ';';\n\n    if (this.hiddenTextareaContainer) {\n      this.hiddenTextareaContainer.appendChild(this.hiddenTextarea);\n    }\n    else {\n      fabric.document.body.appendChild(this.hiddenTextarea);\n    }\n\n    fabric.util.addListener(this.hiddenTextarea, 'keydown', this.onKeyDown.bind(this));\n    fabric.util.addListener(this.hiddenTextarea, 'keyup', this.onKeyUp.bind(this));\n    fabric.util.addListener(this.hiddenTextarea, 'input', this.onInput.bind(this));\n    fabric.util.addListener(this.hiddenTextarea, 'copy', this.copy.bind(this));\n    fabric.util.addListener(this.hiddenTextarea, 'cut', this.copy.bind(this));\n    fabric.util.addListener(this.hiddenTextarea, 'paste', this.paste.bind(this));\n    fabric.util.addListener(this.hiddenTextarea, 'compositionstart', this.onCompositionStart.bind(this));\n    fabric.util.addListener(this.hiddenTextarea, 'compositionupdate', this.onCompositionUpdate.bind(this));\n    fabric.util.addListener(this.hiddenTextarea, 'compositionend', this.onCompositionEnd.bind(this));\n\n    if (!this._clickHandlerInitialized && this.canvas) {\n      fabric.util.addListener(this.canvas.upperCanvasEl, 'click', this.onClick.bind(this));\n      this._clickHandlerInitialized = true;\n    }\n  },\n\n  /**\n   * For functionalities on keyDown\n   * Map a special key to a function of the instance/prototype\n   * If you need different behaviour for ESC or TAB or arrows, you have to change\n   * this map setting the name of a function that you build on the fabric.Itext or\n   * your prototype.\n   * the map change will affect all Instances unless you need for only some text Instances\n   * in that case you have to clone this object and assign your Instance.\n   * this.keysMap = fabric.util.object.clone(this.keysMap);\n   * The function must be in fabric.Itext.prototype.myFunction And will receive event as args[0]\n   */\n  keysMap: {\n    9:  'exitEditing',\n    27: 'exitEditing',\n    33: 'moveCursorUp',\n    34: 'moveCursorDown',\n    35: 'moveCursorRight',\n    36: 'moveCursorLeft',\n    37: 'moveCursorLeft',\n    38: 'moveCursorUp',\n    39: 'moveCursorRight',\n    40: 'moveCursorDown',\n  },\n\n  keysMapRtl: {\n    9:  'exitEditing',\n    27: 'exitEditing',\n    33: 'moveCursorUp',\n    34: 'moveCursorDown',\n    35: 'moveCursorLeft',\n    36: 'moveCursorRight',\n    37: 'moveCursorRight',\n    38: 'moveCursorUp',\n    39: 'moveCursorLeft',\n    40: 'moveCursorDown',\n  },\n\n  /**\n   * For functionalities on keyUp + ctrl || cmd\n   */\n  ctrlKeysMapUp: {\n    67: 'copy',\n    88: 'cut'\n  },\n\n  /**\n   * For functionalities on keyDown + ctrl || cmd\n   */\n  ctrlKeysMapDown: {\n    65: 'selectAll'\n  },\n\n  onClick: function() {\n    // No need to trigger click event here, focus is enough to have the keyboard appear on Android\n    this.hiddenTextarea && this.hiddenTextarea.focus();\n  },\n\n  /**\n   * Handles keydown event\n   * only used for arrows and combination of modifier keys.\n   * @param {Event} e Event object\n   */\n  onKeyDown: function(e) {\n    if (!this.isEditing) {\n      return;\n    }\n    var keyMap = this.direction === 'rtl' ? this.keysMapRtl : this.keysMap;\n    if (e.keyCode in keyMap) {\n      this[keyMap[e.keyCode]](e);\n    }\n    else if ((e.keyCode in this.ctrlKeysMapDown) && (e.ctrlKey || e.metaKey)) {\n      this[this.ctrlKeysMapDown[e.keyCode]](e);\n    }\n    else {\n      return;\n    }\n    e.stopImmediatePropagation();\n    e.preventDefault();\n    if (e.keyCode >= 33 && e.keyCode <= 40) {\n      // if i press an arrow key just update selection\n      this.inCompositionMode = false;\n      this.clearContextTop();\n      this.renderCursorOrSelection();\n    }\n    else {\n      this.canvas && this.canvas.requestRenderAll();\n    }\n  },\n\n  /**\n   * Handles keyup event\n   * We handle KeyUp because ie11 and edge have difficulties copy/pasting\n   * if a copy/cut event fired, keyup is dismissed\n   * @param {Event} e Event object\n   */\n  onKeyUp: function(e) {\n    if (!this.isEditing || this._copyDone || this.inCompositionMode) {\n      this._copyDone = false;\n      return;\n    }\n    if ((e.keyCode in this.ctrlKeysMapUp) && (e.ctrlKey || e.metaKey)) {\n      this[this.ctrlKeysMapUp[e.keyCode]](e);\n    }\n    else {\n      return;\n    }\n    e.stopImmediatePropagation();\n    e.preventDefault();\n    this.canvas && this.canvas.requestRenderAll();\n  },\n\n  /**\n   * Handles onInput event\n   * @param {Event} e Event object\n   */\n  onInput: function(e) {\n    var fromPaste = this.fromPaste;\n    this.fromPaste = false;\n    e && e.stopPropagation();\n    if (!this.isEditing) {\n      return;\n    }\n    // decisions about style changes.\n    var nextText = this._splitTextIntoLines(this.hiddenTextarea.value).graphemeText,\n        charCount = this._text.length,\n        nextCharCount = nextText.length,\n        removedText, insertedText,\n        charDiff = nextCharCount - charCount,\n        selectionStart = this.selectionStart, selectionEnd = this.selectionEnd,\n        selection = selectionStart !== selectionEnd,\n        copiedStyle, removeFrom, removeTo;\n    if (this.hiddenTextarea.value === '') {\n      this.styles = { };\n      this.updateFromTextArea();\n      this.fire('changed');\n      if (this.canvas) {\n        this.canvas.fire('text:changed', { target: this });\n        this.canvas.requestRenderAll();\n      }\n      return;\n    }\n\n    var textareaSelection = this.fromStringToGraphemeSelection(\n      this.hiddenTextarea.selectionStart,\n      this.hiddenTextarea.selectionEnd,\n      this.hiddenTextarea.value\n    );\n    var backDelete = selectionStart > textareaSelection.selectionStart;\n\n    if (selection) {\n      removedText = this._text.slice(selectionStart, selectionEnd);\n      charDiff += selectionEnd - selectionStart;\n    }\n    else if (nextCharCount < charCount) {\n      if (backDelete) {\n        removedText = this._text.slice(selectionEnd + charDiff, selectionEnd);\n      }\n      else {\n        removedText = this._text.slice(selectionStart, selectionStart - charDiff);\n      }\n    }\n    insertedText = nextText.slice(textareaSelection.selectionEnd - charDiff, textareaSelection.selectionEnd);\n    if (removedText && removedText.length) {\n      if (insertedText.length) {\n        // let's copy some style before deleting.\n        // we want to copy the style before the cursor OR the style at the cursor if selection\n        // is bigger than 0.\n        copiedStyle = this.getSelectionStyles(selectionStart, selectionStart + 1, false);\n        // now duplicate the style one for each inserted text.\n        copiedStyle = insertedText.map(function() {\n          // this return an array of references, but that is fine since we are\n          // copying the style later.\n          return copiedStyle[0];\n        });\n      }\n      if (selection) {\n        removeFrom = selectionStart;\n        removeTo = selectionEnd;\n      }\n      else if (backDelete) {\n        // detect differences between forwardDelete and backDelete\n        removeFrom = selectionEnd - removedText.length;\n        removeTo = selectionEnd;\n      }\n      else {\n        removeFrom = selectionEnd;\n        removeTo = selectionEnd + removedText.length;\n      }\n      this.removeStyleFromTo(removeFrom, removeTo);\n    }\n    if (insertedText.length) {\n      if (fromPaste && insertedText.join('') === fabric.copiedText && !fabric.disableStyleCopyPaste) {\n        copiedStyle = fabric.copiedTextStyle;\n      }\n      this.insertNewStyleBlock(insertedText, selectionStart, copiedStyle);\n    }\n    this.updateFromTextArea();\n    this.fire('changed');\n    if (this.canvas) {\n      this.canvas.fire('text:changed', { target: this });\n      this.canvas.requestRenderAll();\n    }\n  },\n  /**\n   * Composition start\n   */\n  onCompositionStart: function() {\n    this.inCompositionMode = true;\n  },\n\n  /**\n   * Composition end\n   */\n  onCompositionEnd: function() {\n    this.inCompositionMode = false;\n  },\n\n  // /**\n  //  * Composition update\n  //  */\n  onCompositionUpdate: function(e) {\n    this.compositionStart = e.target.selectionStart;\n    this.compositionEnd = e.target.selectionEnd;\n    this.updateTextareaPosition();\n  },\n\n  /**\n   * Copies selected text\n   * @param {Event} e Event object\n   */\n  copy: function() {\n    if (this.selectionStart === this.selectionEnd) {\n      //do not cut-copy if no selection\n      return;\n    }\n\n    fabric.copiedText = this.getSelectedText();\n    if (!fabric.disableStyleCopyPaste) {\n      fabric.copiedTextStyle = this.getSelectionStyles(this.selectionStart, this.selectionEnd, true);\n    }\n    else {\n      fabric.copiedTextStyle = null;\n    }\n    this._copyDone = true;\n  },\n\n  /**\n   * Pastes text\n   * @param {Event} e Event object\n   */\n  paste: function() {\n    this.fromPaste = true;\n  },\n\n  /**\n   * @private\n   * @param {Event} e Event object\n   * @return {Object} Clipboard data object\n   */\n  _getClipboardData: function(e) {\n    return (e && e.clipboardData) || fabric.window.clipboardData;\n  },\n\n  /**\n   * Finds the width in pixels before the cursor on the same line\n   * @private\n   * @param {Number} lineIndex\n   * @param {Number} charIndex\n   * @return {Number} widthBeforeCursor width before cursor\n   */\n  _getWidthBeforeCursor: function(lineIndex, charIndex) {\n    var widthBeforeCursor = this._getLineLeftOffset(lineIndex), bound;\n\n    if (charIndex > 0) {\n      bound = this.__charBounds[lineIndex][charIndex - 1];\n      widthBeforeCursor += bound.left + bound.width;\n    }\n    return widthBeforeCursor;\n  },\n\n  /**\n   * Gets start offset of a selection\n   * @param {Event} e Event object\n   * @param {Boolean} isRight\n   * @return {Number}\n   */\n  getDownCursorOffset: function(e, isRight) {\n    var selectionProp = this._getSelectionForOffset(e, isRight),\n        cursorLocation = this.get2DCursorLocation(selectionProp),\n        lineIndex = cursorLocation.lineIndex;\n    // if on last line, down cursor goes to end of line\n    if (lineIndex === this._textLines.length - 1 || e.metaKey || e.keyCode === 34) {\n      // move to the end of a text\n      return this._text.length - selectionProp;\n    }\n    var charIndex = cursorLocation.charIndex,\n        widthBeforeCursor = this._getWidthBeforeCursor(lineIndex, charIndex),\n        indexOnOtherLine = this._getIndexOnLine(lineIndex + 1, widthBeforeCursor),\n        textAfterCursor = this._textLines[lineIndex].slice(charIndex);\n    return textAfterCursor.length + indexOnOtherLine + 1 + this.missingNewlineOffset(lineIndex);\n  },\n\n  /**\n   * private\n   * Helps finding if the offset should be counted from Start or End\n   * @param {Event} e Event object\n   * @param {Boolean} isRight\n   * @return {Number}\n   */\n  _getSelectionForOffset: function(e, isRight) {\n    if (e.shiftKey && this.selectionStart !== this.selectionEnd && isRight) {\n      return this.selectionEnd;\n    }\n    else {\n      return this.selectionStart;\n    }\n  },\n\n  /**\n   * @param {Event} e Event object\n   * @param {Boolean} isRight\n   * @return {Number}\n   */\n  getUpCursorOffset: function(e, isRight) {\n    var selectionProp = this._getSelectionForOffset(e, isRight),\n        cursorLocation = this.get2DCursorLocation(selectionProp),\n        lineIndex = cursorLocation.lineIndex;\n    if (lineIndex === 0 || e.metaKey || e.keyCode === 33) {\n      // if on first line, up cursor goes to start of line\n      return -selectionProp;\n    }\n    var charIndex = cursorLocation.charIndex,\n        widthBeforeCursor = this._getWidthBeforeCursor(lineIndex, charIndex),\n        indexOnOtherLine = this._getIndexOnLine(lineIndex - 1, widthBeforeCursor),\n        textBeforeCursor = this._textLines[lineIndex].slice(0, charIndex),\n        missingNewlineOffset = this.missingNewlineOffset(lineIndex - 1);\n    // return a negative offset\n    return -this._textLines[lineIndex - 1].length\n     + indexOnOtherLine - textBeforeCursor.length + (1 - missingNewlineOffset);\n  },\n\n  /**\n   * for a given width it founds the matching character.\n   * @private\n   */\n  _getIndexOnLine: function(lineIndex, width) {\n\n    var line = this._textLines[lineIndex],\n        lineLeftOffset = this._getLineLeftOffset(lineIndex),\n        widthOfCharsOnLine = lineLeftOffset,\n        indexOnLine = 0, charWidth, foundMatch;\n\n    for (var j = 0, jlen = line.length; j < jlen; j++) {\n      charWidth = this.__charBounds[lineIndex][j].width;\n      widthOfCharsOnLine += charWidth;\n      if (widthOfCharsOnLine > width) {\n        foundMatch = true;\n        var leftEdge = widthOfCharsOnLine - charWidth,\n            rightEdge = widthOfCharsOnLine,\n            offsetFromLeftEdge = Math.abs(leftEdge - width),\n            offsetFromRightEdge = Math.abs(rightEdge - width);\n\n        indexOnLine = offsetFromRightEdge < offsetFromLeftEdge ? j : (j - 1);\n        break;\n      }\n    }\n\n    // reached end\n    if (!foundMatch) {\n      indexOnLine = line.length - 1;\n    }\n\n    return indexOnLine;\n  },\n\n\n  /**\n   * Moves cursor down\n   * @param {Event} e Event object\n   */\n  moveCursorDown: function(e) {\n    if (this.selectionStart >= this._text.length && this.selectionEnd >= this._text.length) {\n      return;\n    }\n    this._moveCursorUpOrDown('Down', e);\n  },\n\n  /**\n   * Moves cursor up\n   * @param {Event} e Event object\n   */\n  moveCursorUp: function(e) {\n    if (this.selectionStart === 0 && this.selectionEnd === 0) {\n      return;\n    }\n    this._moveCursorUpOrDown('Up', e);\n  },\n\n  /**\n   * Moves cursor up or down, fires the events\n   * @param {String} direction 'Up' or 'Down'\n   * @param {Event} e Event object\n   */\n  _moveCursorUpOrDown: function(direction, e) {\n    // getUpCursorOffset\n    // getDownCursorOffset\n    var action = 'get' + direction + 'CursorOffset',\n        offset = this[action](e, this._selectionDirection === 'right');\n    if (e.shiftKey) {\n      this.moveCursorWithShift(offset);\n    }\n    else {\n      this.moveCursorWithoutShift(offset);\n    }\n    if (offset !== 0) {\n      this.setSelectionInBoundaries();\n      this.abortCursorAnimation();\n      this._currentCursorOpacity = 1;\n      this.initDelayedCursor();\n      this._fireSelectionChanged();\n      this._updateTextarea();\n    }\n  },\n\n  /**\n   * Moves cursor with shift\n   * @param {Number} offset\n   */\n  moveCursorWithShift: function(offset) {\n    var newSelection = this._selectionDirection === 'left'\n      ? this.selectionStart + offset\n      : this.selectionEnd + offset;\n    this.setSelectionStartEndWithShift(this.selectionStart, this.selectionEnd, newSelection);\n    return offset !== 0;\n  },\n\n  /**\n   * Moves cursor up without shift\n   * @param {Number} offset\n   */\n  moveCursorWithoutShift: function(offset) {\n    if (offset < 0) {\n      this.selectionStart += offset;\n      this.selectionEnd = this.selectionStart;\n    }\n    else {\n      this.selectionEnd += offset;\n      this.selectionStart = this.selectionEnd;\n    }\n    return offset !== 0;\n  },\n\n  /**\n   * Moves cursor left\n   * @param {Event} e Event object\n   */\n  moveCursorLeft: function(e) {\n    if (this.selectionStart === 0 && this.selectionEnd === 0) {\n      return;\n    }\n    this._moveCursorLeftOrRight('Left', e);\n  },\n\n  /**\n   * @private\n   * @return {Boolean} true if a change happened\n   */\n  _move: function(e, prop, direction) {\n    var newValue;\n    if (e.altKey) {\n      newValue = this['findWordBoundary' + direction](this[prop]);\n    }\n    else if (e.metaKey || e.keyCode === 35 ||  e.keyCode === 36 ) {\n      newValue = this['findLineBoundary' + direction](this[prop]);\n    }\n    else {\n      this[prop] += direction === 'Left' ? -1 : 1;\n      return true;\n    }\n    if (typeof newValue !== 'undefined' && this[prop] !== newValue) {\n      this[prop] = newValue;\n      return true;\n    }\n  },\n\n  /**\n   * @private\n   */\n  _moveLeft: function(e, prop) {\n    return this._move(e, prop, 'Left');\n  },\n\n  /**\n   * @private\n   */\n  _moveRight: function(e, prop) {\n    return this._move(e, prop, 'Right');\n  },\n\n  /**\n   * Moves cursor left without keeping selection\n   * @param {Event} e\n   */\n  moveCursorLeftWithoutShift: function(e) {\n    var change = true;\n    this._selectionDirection = 'left';\n\n    // only move cursor when there is no selection,\n    // otherwise we discard it, and leave cursor on same place\n    if (this.selectionEnd === this.selectionStart && this.selectionStart !== 0) {\n      change = this._moveLeft(e, 'selectionStart');\n\n    }\n    this.selectionEnd = this.selectionStart;\n    return change;\n  },\n\n  /**\n   * Moves cursor left while keeping selection\n   * @param {Event} e\n   */\n  moveCursorLeftWithShift: function(e) {\n    if (this._selectionDirection === 'right' && this.selectionStart !== this.selectionEnd) {\n      return this._moveLeft(e, 'selectionEnd');\n    }\n    else if (this.selectionStart !== 0){\n      this._selectionDirection = 'left';\n      return this._moveLeft(e, 'selectionStart');\n    }\n  },\n\n  /**\n   * Moves cursor right\n   * @param {Event} e Event object\n   */\n  moveCursorRight: function(e) {\n    if (this.selectionStart >= this._text.length && this.selectionEnd >= this._text.length) {\n      return;\n    }\n    this._moveCursorLeftOrRight('Right', e);\n  },\n\n  /**\n   * Moves cursor right or Left, fires event\n   * @param {String} direction 'Left', 'Right'\n   * @param {Event} e Event object\n   */\n  _moveCursorLeftOrRight: function(direction, e) {\n    var actionName = 'moveCursor' + direction + 'With';\n    this._currentCursorOpacity = 1;\n\n    if (e.shiftKey) {\n      actionName += 'Shift';\n    }\n    else {\n      actionName += 'outShift';\n    }\n    if (this[actionName](e)) {\n      this.abortCursorAnimation();\n      this.initDelayedCursor();\n      this._fireSelectionChanged();\n      this._updateTextarea();\n    }\n  },\n\n  /**\n   * Moves cursor right while keeping selection\n   * @param {Event} e\n   */\n  moveCursorRightWithShift: function(e) {\n    if (this._selectionDirection === 'left' && this.selectionStart !== this.selectionEnd) {\n      return this._moveRight(e, 'selectionStart');\n    }\n    else if (this.selectionEnd !== this._text.length) {\n      this._selectionDirection = 'right';\n      return this._moveRight(e, 'selectionEnd');\n    }\n  },\n\n  /**\n   * Moves cursor right without keeping selection\n   * @param {Event} e Event object\n   */\n  moveCursorRightWithoutShift: function(e) {\n    var changed = true;\n    this._selectionDirection = 'right';\n\n    if (this.selectionStart === this.selectionEnd) {\n      changed = this._moveRight(e, 'selectionStart');\n      this.selectionEnd = this.selectionStart;\n    }\n    else {\n      this.selectionStart = this.selectionEnd;\n    }\n    return changed;\n  },\n\n  /**\n   * Removes characters from start/end\n   * start/end ar per grapheme position in _text array.\n   *\n   * @param {Number} start\n   * @param {Number} end default to start + 1\n   */\n  removeChars: function(start, end) {\n    if (typeof end === 'undefined') {\n      end = start + 1;\n    }\n    this.removeStyleFromTo(start, end);\n    this._text.splice(start, end - start);\n    this.text = this._text.join('');\n    this.set('dirty', true);\n    if (this._shouldClearDimensionCache()) {\n      this.initDimensions();\n      this.setCoords();\n    }\n    this._removeExtraneousStyles();\n  },\n\n  /**\n   * insert characters at start position, before start position.\n   * start  equal 1 it means the text get inserted between actual grapheme 0 and 1\n   * if style array is provided, it must be as the same length of text in graphemes\n   * if end is provided and is bigger than start, old text is replaced.\n   * start/end ar per grapheme position in _text array.\n   *\n   * @param {String} text text to insert\n   * @param {Array} style array of style objects\n   * @param {Number} start\n   * @param {Number} end default to start + 1\n   */\n  insertChars: function(text, style, start, end) {\n    if (typeof end === 'undefined') {\n      end = start;\n    }\n    if (end > start) {\n      this.removeStyleFromTo(start, end);\n    }\n    var graphemes = fabric.util.string.graphemeSplit(text);\n    this.insertNewStyleBlock(graphemes, start, style);\n    this._text = [].concat(this._text.slice(0, start), graphemes, this._text.slice(end));\n    this.text = this._text.join('');\n    this.set('dirty', true);\n    if (this._shouldClearDimensionCache()) {\n      this.initDimensions();\n      this.setCoords();\n    }\n    this._removeExtraneousStyles();\n  },\n\n});\n\n\n/* _TO_SVG_START_ */\n(function() {\n  var toFixed = fabric.util.toFixed,\n      multipleSpacesRegex = /  +/g;\n\n  fabric.util.object.extend(fabric.Text.prototype, /** @lends fabric.Text.prototype */ {\n\n    /**\n     * Returns SVG representation of an instance\n     * @param {Function} [reviver] Method for further parsing of svg representation.\n     * @return {String} svg representation of an instance\n     */\n    _toSVG: function() {\n      var offsets = this._getSVGLeftTopOffsets(),\n          textAndBg = this._getSVGTextAndBg(offsets.textTop, offsets.textLeft);\n      return this._wrapSVGTextAndBg(textAndBg);\n    },\n\n    /**\n     * Returns svg representation of an instance\n     * @param {Function} [reviver] Method for further parsing of svg representation.\n     * @return {String} svg representation of an instance\n     */\n    toSVG: function(reviver) {\n      return this._createBaseSVGMarkup(\n        this._toSVG(),\n        { reviver: reviver, noStyle: true, withShadow: true }\n      );\n    },\n\n    /**\n     * @private\n     */\n    _getSVGLeftTopOffsets: function() {\n      return {\n        textLeft: -this.width / 2,\n        textTop: -this.height / 2,\n        lineTop: this.getHeightOfLine(0)\n      };\n    },\n\n    /**\n     * @private\n     */\n    _wrapSVGTextAndBg: function(textAndBg) {\n      var noShadow = true,\n          textDecoration = this.getSvgTextDecoration(this);\n      return [\n        textAndBg.textBgRects.join(''),\n        '\\t\\t<text xml:space=\"preserve\" ',\n        (this.fontFamily ? 'font-family=\"' + this.fontFamily.replace(/\"/g, '\\'') + '\" ' : ''),\n        (this.fontSize ? 'font-size=\"' + this.fontSize + '\" ' : ''),\n        (this.fontStyle ? 'font-style=\"' + this.fontStyle + '\" ' : ''),\n        (this.fontWeight ? 'font-weight=\"' + this.fontWeight + '\" ' : ''),\n        (textDecoration ? 'text-decoration=\"' + textDecoration + '\" ' : ''),\n        'style=\"', this.getSvgStyles(noShadow), '\"', this.addPaintOrder(), ' >',\n        textAndBg.textSpans.join(''),\n        '</text>\\n'\n      ];\n    },\n\n    /**\n     * @private\n     * @param {Number} textTopOffset Text top offset\n     * @param {Number} textLeftOffset Text left offset\n     * @return {Object}\n     */\n    _getSVGTextAndBg: function(textTopOffset, textLeftOffset) {\n      var textSpans = [],\n          textBgRects = [],\n          height = textTopOffset, lineOffset;\n      // bounding-box background\n      this._setSVGBg(textBgRects);\n\n      // text and text-background\n      for (var i = 0, len = this._textLines.length; i < len; i++) {\n        lineOffset = this._getLineLeftOffset(i);\n        if (this.textBackgroundColor || this.styleHas('textBackgroundColor', i)) {\n          this._setSVGTextLineBg(textBgRects, i, textLeftOffset + lineOffset, height);\n        }\n        this._setSVGTextLineText(textSpans, i, textLeftOffset + lineOffset, height);\n        height += this.getHeightOfLine(i);\n      }\n\n      return {\n        textSpans: textSpans,\n        textBgRects: textBgRects\n      };\n    },\n\n    /**\n     * @private\n     */\n    _createTextCharSpan: function(_char, styleDecl, left, top) {\n      var shouldUseWhitespace = _char !== _char.trim() || _char.match(multipleSpacesRegex),\n          styleProps = this.getSvgSpanStyles(styleDecl, shouldUseWhitespace),\n          fillStyles = styleProps ? 'style=\"' + styleProps + '\"' : '',\n          dy = styleDecl.deltaY, dySpan = '',\n          NUM_FRACTION_DIGITS = fabric.Object.NUM_FRACTION_DIGITS;\n      if (dy) {\n        dySpan = ' dy=\"' + toFixed(dy, NUM_FRACTION_DIGITS) + '\" ';\n      }\n      return [\n        '<tspan x=\"', toFixed(left, NUM_FRACTION_DIGITS), '\" y=\"',\n        toFixed(top, NUM_FRACTION_DIGITS), '\" ', dySpan,\n        fillStyles, '>',\n        fabric.util.string.escapeXml(_char),\n        '</tspan>'\n      ].join('');\n    },\n\n    _setSVGTextLineText: function(textSpans, lineIndex, textLeftOffset, textTopOffset) {\n      // set proper line offset\n      var lineHeight = this.getHeightOfLine(lineIndex),\n          isJustify = this.textAlign.indexOf('justify') !== -1,\n          actualStyle,\n          nextStyle,\n          charsToRender = '',\n          charBox, style,\n          boxWidth = 0,\n          line = this._textLines[lineIndex],\n          timeToRender;\n\n      textTopOffset += lineHeight * (1 - this._fontSizeFraction) / this.lineHeight;\n      for (var i = 0, len = line.length - 1; i <= len; i++) {\n        timeToRender = i === len || this.charSpacing;\n        charsToRender += line[i];\n        charBox = this.__charBounds[lineIndex][i];\n        if (boxWidth === 0) {\n          textLeftOffset += charBox.kernedWidth - charBox.width;\n          boxWidth += charBox.width;\n        }\n        else {\n          boxWidth += charBox.kernedWidth;\n        }\n        if (isJustify && !timeToRender) {\n          if (this._reSpaceAndTab.test(line[i])) {\n            timeToRender = true;\n          }\n        }\n        if (!timeToRender) {\n          // if we have charSpacing, we render char by char\n          actualStyle = actualStyle || this.getCompleteStyleDeclaration(lineIndex, i);\n          nextStyle = this.getCompleteStyleDeclaration(lineIndex, i + 1);\n          timeToRender = fabric.util.hasStyleChanged(actualStyle, nextStyle, true);\n        }\n        if (timeToRender) {\n          style = this._getStyleDeclaration(lineIndex, i) || { };\n          textSpans.push(this._createTextCharSpan(charsToRender, style, textLeftOffset, textTopOffset));\n          charsToRender = '';\n          actualStyle = nextStyle;\n          textLeftOffset += boxWidth;\n          boxWidth = 0;\n        }\n      }\n    },\n\n    _pushTextBgRect: function(textBgRects, color, left, top, width, height) {\n      var NUM_FRACTION_DIGITS = fabric.Object.NUM_FRACTION_DIGITS;\n      textBgRects.push(\n        '\\t\\t<rect ',\n        this._getFillAttributes(color),\n        ' x=\"',\n        toFixed(left, NUM_FRACTION_DIGITS),\n        '\" y=\"',\n        toFixed(top, NUM_FRACTION_DIGITS),\n        '\" width=\"',\n        toFixed(width, NUM_FRACTION_DIGITS),\n        '\" height=\"',\n        toFixed(height, NUM_FRACTION_DIGITS),\n        '\"></rect>\\n');\n    },\n\n    _setSVGTextLineBg: function(textBgRects, i, leftOffset, textTopOffset) {\n      var line = this._textLines[i],\n          heightOfLine = this.getHeightOfLine(i) / this.lineHeight,\n          boxWidth = 0,\n          boxStart = 0,\n          charBox, currentColor,\n          lastColor = this.getValueOfPropertyAt(i, 0, 'textBackgroundColor');\n      for (var j = 0, jlen = line.length; j < jlen; j++) {\n        charBox = this.__charBounds[i][j];\n        currentColor = this.getValueOfPropertyAt(i, j, 'textBackgroundColor');\n        if (currentColor !== lastColor) {\n          lastColor && this._pushTextBgRect(textBgRects, lastColor, leftOffset + boxStart,\n            textTopOffset, boxWidth, heightOfLine);\n          boxStart = charBox.left;\n          boxWidth = charBox.width;\n          lastColor = currentColor;\n        }\n        else {\n          boxWidth += charBox.kernedWidth;\n        }\n      }\n      currentColor && this._pushTextBgRect(textBgRects, currentColor, leftOffset + boxStart,\n        textTopOffset, boxWidth, heightOfLine);\n    },\n\n    /**\n     * Adobe Illustrator (at least CS5) is unable to render rgba()-based fill values\n     * we work around it by \"moving\" alpha channel into opacity attribute and setting fill's alpha to 1\n     *\n     * @private\n     * @param {*} value\n     * @return {String}\n     */\n    _getFillAttributes: function(value) {\n      var fillColor = (value && typeof value === 'string') ? new fabric.Color(value) : '';\n      if (!fillColor || !fillColor.getSource() || fillColor.getAlpha() === 1) {\n        return 'fill=\"' + value + '\"';\n      }\n      return 'opacity=\"' + fillColor.getAlpha() + '\" fill=\"' + fillColor.setAlpha(1).toRgb() + '\"';\n    },\n\n    /**\n     * @private\n     */\n    _getSVGLineTopOffset: function(lineIndex) {\n      var lineTopOffset = 0, lastHeight = 0;\n      for (var j = 0; j < lineIndex; j++) {\n        lineTopOffset += this.getHeightOfLine(j);\n      }\n      lastHeight = this.getHeightOfLine(j);\n      return {\n        lineTop: lineTopOffset,\n        offset: (this._fontSizeMult - this._fontSizeFraction) * lastHeight / (this.lineHeight * this._fontSizeMult)\n      };\n    },\n\n    /**\n     * Returns styles-string for svg-export\n     * @param {Boolean} skipShadow a boolean to skip shadow filter output\n     * @return {String}\n     */\n    getSvgStyles: function(skipShadow) {\n      var svgStyle = fabric.Object.prototype.getSvgStyles.call(this, skipShadow);\n      return svgStyle + ' white-space: pre;';\n    },\n  });\n})();\n/* _TO_SVG_END_ */\n\n\n(function(global) {\n\n  'use strict';\n\n  var fabric = global.fabric || (global.fabric = {});\n\n  /**\n   * Textbox class, based on IText, allows the user to resize the text rectangle\n   * and wraps lines automatically. Textboxes have their Y scaling locked, the\n   * user can only change width. Height is adjusted automatically based on the\n   * wrapping of lines.\n   * @class fabric.Textbox\n   * @extends fabric.IText\n   * @mixes fabric.Observable\n   * @return {fabric.Textbox} thisArg\n   * @see {@link fabric.Textbox#initialize} for constructor definition\n   */\n  fabric.Textbox = fabric.util.createClass(fabric.IText, fabric.Observable, {\n\n    /**\n     * Type of an object\n     * @type String\n     * @default\n     */\n    type: 'textbox',\n\n    /**\n     * Minimum width of textbox, in pixels.\n     * @type Number\n     * @default\n     */\n    minWidth: 20,\n\n    /**\n     * Minimum calculated width of a textbox, in pixels.\n     * fixed to 2 so that an empty textbox cannot go to 0\n     * and is still selectable without text.\n     * @type Number\n     * @default\n     */\n    dynamicMinWidth: 2,\n\n    /**\n     * Cached array of text wrapping.\n     * @type Array\n     */\n    __cachedLines: null,\n\n    /**\n     * Override standard Object class values\n     */\n    lockScalingFlip: true,\n\n    /**\n     * Override standard Object class values\n     * Textbox needs this on false\n     */\n    noScaleCache: false,\n\n    /**\n     * Properties which when set cause object to change dimensions\n     * @type Object\n     * @private\n     */\n    _dimensionAffectingProps: fabric.Text.prototype._dimensionAffectingProps.concat('width'),\n\n    /**\n     * Use this regular expression to split strings in breakable lines\n     * @private\n     */\n    _wordJoiners: /[ \\t\\r]/,\n\n    /**\n     * Use this boolean property in order to split strings that have no white space concept.\n     * this is a cheap way to help with chinese/japanese\n     * @type Boolean\n     * @since 2.6.0\n     */\n    splitByGrapheme: false,\n\n    /**\n     * Unlike superclass's version of this function, Textbox does not update\n     * its width.\n     * @private\n     * @override\n     */\n    initDimensions: function() {\n      if (this.__skipDimension) {\n        return;\n      }\n      this.isEditing && this.initDelayedCursor();\n      this.clearContextTop();\n      this._clearCache();\n      // clear dynamicMinWidth as it will be different after we re-wrap line\n      this.dynamicMinWidth = 0;\n      // wrap lines\n      this._styleMap = this._generateStyleMap(this._splitText());\n      // if after wrapping, the width is smaller than dynamicMinWidth, change the width and re-wrap\n      if (this.dynamicMinWidth > this.width) {\n        this._set('width', this.dynamicMinWidth);\n      }\n      if (this.textAlign.indexOf('justify') !== -1) {\n        // once text is measured we need to make space fatter to make justified text.\n        this.enlargeSpaces();\n      }\n      // clear cache and re-calculate height\n      this.height = this.calcTextHeight();\n      this.saveState({ propertySet: '_dimensionAffectingProps' });\n    },\n\n    /**\n     * Generate an object that translates the style object so that it is\n     * broken up by visual lines (new lines and automatic wrapping).\n     * The original text styles object is broken up by actual lines (new lines only),\n     * which is only sufficient for Text / IText\n     * @private\n     */\n    _generateStyleMap: function(textInfo) {\n      var realLineCount     = 0,\n          realLineCharCount = 0,\n          charCount         = 0,\n          map               = {};\n\n      for (var i = 0; i < textInfo.graphemeLines.length; i++) {\n        if (textInfo.graphemeText[charCount] === '\\n' && i > 0) {\n          realLineCharCount = 0;\n          charCount++;\n          realLineCount++;\n        }\n        else if (!this.splitByGrapheme && this._reSpaceAndTab.test(textInfo.graphemeText[charCount]) && i > 0) {\n          // this case deals with space's that are removed from end of lines when wrapping\n          realLineCharCount++;\n          charCount++;\n        }\n\n        map[i] = { line: realLineCount, offset: realLineCharCount };\n\n        charCount += textInfo.graphemeLines[i].length;\n        realLineCharCount += textInfo.graphemeLines[i].length;\n      }\n\n      return map;\n    },\n\n    /**\n     * Returns true if object has a style property or has it on a specified line\n     * @param {Number} lineIndex\n     * @return {Boolean}\n     */\n    styleHas: function(property, lineIndex) {\n      if (this._styleMap && !this.isWrapping) {\n        var map = this._styleMap[lineIndex];\n        if (map) {\n          lineIndex = map.line;\n        }\n      }\n      return fabric.Text.prototype.styleHas.call(this, property, lineIndex);\n    },\n\n    /**\n     * Returns true if object has no styling or no styling in a line\n     * @param {Number} lineIndex , lineIndex is on wrapped lines.\n     * @return {Boolean}\n     */\n    isEmptyStyles: function(lineIndex) {\n      if (!this.styles) {\n        return true;\n      }\n      var offset = 0, nextLineIndex = lineIndex + 1, nextOffset, obj, shouldLimit = false,\n          map = this._styleMap[lineIndex], mapNextLine = this._styleMap[lineIndex + 1];\n      if (map) {\n        lineIndex = map.line;\n        offset = map.offset;\n      }\n      if (mapNextLine) {\n        nextLineIndex = mapNextLine.line;\n        shouldLimit = nextLineIndex === lineIndex;\n        nextOffset = mapNextLine.offset;\n      }\n      obj = typeof lineIndex === 'undefined' ? this.styles : { line: this.styles[lineIndex] };\n      for (var p1 in obj) {\n        for (var p2 in obj[p1]) {\n          if (p2 >= offset && (!shouldLimit || p2 < nextOffset)) {\n            // eslint-disable-next-line no-unused-vars\n            for (var p3 in obj[p1][p2]) {\n              return false;\n            }\n          }\n        }\n      }\n      return true;\n    },\n\n    /**\n     * @param {Number} lineIndex\n     * @param {Number} charIndex\n     * @private\n     */\n    _getStyleDeclaration: function(lineIndex, charIndex) {\n      if (this._styleMap && !this.isWrapping) {\n        var map = this._styleMap[lineIndex];\n        if (!map) {\n          return null;\n        }\n        lineIndex = map.line;\n        charIndex = map.offset + charIndex;\n      }\n      return this.callSuper('_getStyleDeclaration', lineIndex, charIndex);\n    },\n\n    /**\n     * @param {Number} lineIndex\n     * @param {Number} charIndex\n     * @param {Object} style\n     * @private\n     */\n    _setStyleDeclaration: function(lineIndex, charIndex, style) {\n      var map = this._styleMap[lineIndex];\n      lineIndex = map.line;\n      charIndex = map.offset + charIndex;\n\n      this.styles[lineIndex][charIndex] = style;\n    },\n\n    /**\n     * @param {Number} lineIndex\n     * @param {Number} charIndex\n     * @private\n     */\n    _deleteStyleDeclaration: function(lineIndex, charIndex) {\n      var map = this._styleMap[lineIndex];\n      lineIndex = map.line;\n      charIndex = map.offset + charIndex;\n      delete this.styles[lineIndex][charIndex];\n    },\n\n    /**\n     * probably broken need a fix\n     * Returns the real style line that correspond to the wrapped lineIndex line\n     * Used just to verify if the line does exist or not.\n     * @param {Number} lineIndex\n     * @returns {Boolean} if the line exists or not\n     * @private\n     */\n    _getLineStyle: function(lineIndex) {\n      var map = this._styleMap[lineIndex];\n      return !!this.styles[map.line];\n    },\n\n    /**\n     * Set the line style to an empty object so that is initialized\n     * @param {Number} lineIndex\n     * @param {Object} style\n     * @private\n     */\n    _setLineStyle: function(lineIndex) {\n      var map = this._styleMap[lineIndex];\n      this.styles[map.line] = {};\n    },\n\n    /**\n     * Wraps text using the 'width' property of Textbox. First this function\n     * splits text on newlines, so we preserve newlines entered by the user.\n     * Then it wraps each line using the width of the Textbox by calling\n     * _wrapLine().\n     * @param {Array} lines The string array of text that is split into lines\n     * @param {Number} desiredWidth width you want to wrap to\n     * @returns {Array} Array of lines\n     */\n    _wrapText: function(lines, desiredWidth) {\n      var wrapped = [], i;\n      this.isWrapping = true;\n      for (i = 0; i < lines.length; i++) {\n        wrapped = wrapped.concat(this._wrapLine(lines[i], i, desiredWidth));\n      }\n      this.isWrapping = false;\n      return wrapped;\n    },\n\n    /**\n     * Helper function to measure a string of text, given its lineIndex and charIndex offset\n     * it gets called when charBounds are not available yet.\n     * @param {CanvasRenderingContext2D} ctx\n     * @param {String} text\n     * @param {number} lineIndex\n     * @param {number} charOffset\n     * @returns {number}\n     * @private\n     */\n    _measureWord: function(word, lineIndex, charOffset) {\n      var width = 0, prevGrapheme, skipLeft = true;\n      charOffset = charOffset || 0;\n      for (var i = 0, len = word.length; i < len; i++) {\n        var box = this._getGraphemeBox(word[i], lineIndex, i + charOffset, prevGrapheme, skipLeft);\n        width += box.kernedWidth;\n        prevGrapheme = word[i];\n      }\n      return width;\n    },\n\n    /**\n     * Wraps a line of text using the width of the Textbox and a context.\n     * @param {Array} line The grapheme array that represent the line\n     * @param {Number} lineIndex\n     * @param {Number} desiredWidth width you want to wrap the line to\n     * @param {Number} reservedSpace space to remove from wrapping for custom functionalities\n     * @returns {Array} Array of line(s) into which the given text is wrapped\n     * to.\n     */\n    _wrapLine: function(_line, lineIndex, desiredWidth, reservedSpace) {\n      var lineWidth = 0,\n          splitByGrapheme = this.splitByGrapheme,\n          graphemeLines = [],\n          line = [],\n          // spaces in different languages?\n          words = splitByGrapheme ? fabric.util.string.graphemeSplit(_line) : _line.split(this._wordJoiners),\n          word = '',\n          offset = 0,\n          infix = splitByGrapheme ? '' : ' ',\n          wordWidth = 0,\n          infixWidth = 0,\n          largestWordWidth = 0,\n          lineJustStarted = true,\n          additionalSpace = this._getWidthOfCharSpacing(),\n          reservedSpace = reservedSpace || 0;\n      // fix a difference between split and graphemeSplit\n      if (words.length === 0) {\n        words.push([]);\n      }\n      desiredWidth -= reservedSpace;\n      for (var i = 0; i < words.length; i++) {\n        // if using splitByGrapheme words are already in graphemes.\n        word = splitByGrapheme ? words[i] : fabric.util.string.graphemeSplit(words[i]);\n        wordWidth = this._measureWord(word, lineIndex, offset);\n        offset += word.length;\n\n        lineWidth += infixWidth + wordWidth - additionalSpace;\n        if (lineWidth > desiredWidth && !lineJustStarted) {\n          graphemeLines.push(line);\n          line = [];\n          lineWidth = wordWidth;\n          lineJustStarted = true;\n        }\n        else {\n          lineWidth += additionalSpace;\n        }\n\n        if (!lineJustStarted && !splitByGrapheme) {\n          line.push(infix);\n        }\n        line = line.concat(word);\n\n        infixWidth = splitByGrapheme ? 0 : this._measureWord([infix], lineIndex, offset);\n        offset++;\n        lineJustStarted = false;\n        // keep track of largest word\n        if (wordWidth > largestWordWidth) {\n          largestWordWidth = wordWidth;\n        }\n      }\n\n      i && graphemeLines.push(line);\n\n      if (largestWordWidth + reservedSpace > this.dynamicMinWidth) {\n        this.dynamicMinWidth = largestWordWidth - additionalSpace + reservedSpace;\n      }\n      return graphemeLines;\n    },\n\n    /**\n     * Detect if the text line is ended with an hard break\n     * text and itext do not have wrapping, return false\n     * @param {Number} lineIndex text to split\n     * @return {Boolean}\n     */\n    isEndOfWrapping: function(lineIndex) {\n      if (!this._styleMap[lineIndex + 1]) {\n        // is last line, return true;\n        return true;\n      }\n      if (this._styleMap[lineIndex + 1].line !== this._styleMap[lineIndex].line) {\n        // this is last line before a line break, return true;\n        return true;\n      }\n      return false;\n    },\n\n    /**\n     * Detect if a line has a linebreak and so we need to account for it when moving\n     * and counting style.\n     * @return Number\n     */\n    missingNewlineOffset: function(lineIndex) {\n      if (this.splitByGrapheme) {\n        return this.isEndOfWrapping(lineIndex) ? 1 : 0;\n      }\n      return 1;\n    },\n\n    /**\n    * Gets lines of text to render in the Textbox. This function calculates\n    * text wrapping on the fly every time it is called.\n    * @param {String} text text to split\n    * @returns {Array} Array of lines in the Textbox.\n    * @override\n    */\n    _splitTextIntoLines: function(text) {\n      var newText = fabric.Text.prototype._splitTextIntoLines.call(this, text),\n          graphemeLines = this._wrapText(newText.lines, this.width),\n          lines = new Array(graphemeLines.length);\n      for (var i = 0; i < graphemeLines.length; i++) {\n        lines[i] = graphemeLines[i].join('');\n      }\n      newText.lines = lines;\n      newText.graphemeLines = graphemeLines;\n      return newText;\n    },\n\n    getMinWidth: function() {\n      return Math.max(this.minWidth, this.dynamicMinWidth);\n    },\n\n    _removeExtraneousStyles: function() {\n      var linesToKeep = {};\n      for (var prop in this._styleMap) {\n        if (this._textLines[prop]) {\n          linesToKeep[this._styleMap[prop].line] = 1;\n        }\n      }\n      for (var prop in this.styles) {\n        if (!linesToKeep[prop]) {\n          delete this.styles[prop];\n        }\n      }\n    },\n\n    /**\n     * Returns object representation of an instance\n     * @method toObject\n     * @param {Array} [propertiesToInclude] Any properties that you might want to additionally include in the output\n     * @return {Object} object representation of an instance\n     */\n    toObject: function(propertiesToInclude) {\n      return this.callSuper('toObject', ['minWidth', 'splitByGrapheme'].concat(propertiesToInclude));\n    }\n  });\n\n  /**\n   * Returns fabric.Textbox instance from an object representation\n   * @static\n   * @memberOf fabric.Textbox\n   * @param {Object} object Object to create an instance from\n   * @param {Function} [callback] Callback to invoke when an fabric.Textbox instance is created\n   */\n  fabric.Textbox.fromObject = function(object, callback) {\n    var styles = fabric.util.stylesFromArray(object.styles, object.text);\n    //copy object to prevent mutation\n    var objCopy = Object.assign({}, object, { styles: styles });\n    return fabric.Object._fromObject('Textbox', objCopy, callback, 'text');\n  };\n})(typeof exports !== 'undefined' ? exports : this);\n\n\n(function() {\n\n  var controlsUtils = fabric.controlsUtils,\n      scaleSkewStyleHandler = controlsUtils.scaleSkewCursorStyleHandler,\n      scaleStyleHandler = controlsUtils.scaleCursorStyleHandler,\n      scalingEqually = controlsUtils.scalingEqually,\n      scalingYOrSkewingX = controlsUtils.scalingYOrSkewingX,\n      scalingXOrSkewingY = controlsUtils.scalingXOrSkewingY,\n      scaleOrSkewActionName = controlsUtils.scaleOrSkewActionName,\n      objectControls = fabric.Object.prototype.controls;\n\n  objectControls.ml = new fabric.Control({\n    x: -0.5,\n    y: 0,\n    cursorStyleHandler: scaleSkewStyleHandler,\n    actionHandler: scalingXOrSkewingY,\n    getActionName: scaleOrSkewActionName,\n  });\n\n  objectControls.mr = new fabric.Control({\n    x: 0.5,\n    y: 0,\n    cursorStyleHandler: scaleSkewStyleHandler,\n    actionHandler: scalingXOrSkewingY,\n    getActionName: scaleOrSkewActionName,\n  });\n\n  objectControls.mb = new fabric.Control({\n    x: 0,\n    y: 0.5,\n    cursorStyleHandler: scaleSkewStyleHandler,\n    actionHandler: scalingYOrSkewingX,\n    getActionName: scaleOrSkewActionName,\n  });\n\n  objectControls.mt = new fabric.Control({\n    x: 0,\n    y: -0.5,\n    cursorStyleHandler: scaleSkewStyleHandler,\n    actionHandler: scalingYOrSkewingX,\n    getActionName: scaleOrSkewActionName,\n  });\n\n  objectControls.tl = new fabric.Control({\n    x: -0.5,\n    y: -0.5,\n    cursorStyleHandler: scaleStyleHandler,\n    actionHandler: scalingEqually\n  });\n\n  objectControls.tr = new fabric.Control({\n    x: 0.5,\n    y: -0.5,\n    cursorStyleHandler: scaleStyleHandler,\n    actionHandler: scalingEqually\n  });\n\n  objectControls.bl = new fabric.Control({\n    x: -0.5,\n    y: 0.5,\n    cursorStyleHandler: scaleStyleHandler,\n    actionHandler: scalingEqually\n  });\n\n  objectControls.br = new fabric.Control({\n    x: 0.5,\n    y: 0.5,\n    cursorStyleHandler: scaleStyleHandler,\n    actionHandler: scalingEqually\n  });\n\n  objectControls.mtr = new fabric.Control({\n    x: 0,\n    y: -0.5,\n    actionHandler: controlsUtils.rotationWithSnapping,\n    cursorStyleHandler: controlsUtils.rotationStyleHandler,\n    offsetY: -40,\n    withConnection: true,\n    actionName: 'rotate',\n  });\n\n  if (fabric.Textbox) {\n    // this is breaking the prototype inheritance, no time / ideas to fix it.\n    // is important to document that if you want to have all objects to have a\n    // specific custom control, you have to add it to Object prototype and to Textbox\n    // prototype. The controls are shared as references. So changes to control `tr`\n    // can still apply to all objects if needed.\n    var textBoxControls = fabric.Textbox.prototype.controls = { };\n\n    textBoxControls.mtr = objectControls.mtr;\n    textBoxControls.tr = objectControls.tr;\n    textBoxControls.br = objectControls.br;\n    textBoxControls.tl = objectControls.tl;\n    textBoxControls.bl = objectControls.bl;\n    textBoxControls.mt = objectControls.mt;\n    textBoxControls.mb = objectControls.mb;\n\n    textBoxControls.mr = new fabric.Control({\n      x: 0.5,\n      y: 0,\n      actionHandler: controlsUtils.changeWidth,\n      cursorStyleHandler: scaleSkewStyleHandler,\n      actionName: 'resizing',\n    });\n\n    textBoxControls.ml = new fabric.Control({\n      x: -0.5,\n      y: 0,\n      actionHandler: controlsUtils.changeWidth,\n      cursorStyleHandler: scaleSkewStyleHandler,\n      actionName: 'resizing',\n    });\n  }\n})();\n\n","import {IObjectOptions} from 'fabric/fabric-impl';\n\nexport const DEFAULT_OBJ_CONFIG: IObjectOptions = {\n  lockScalingFlip: true,\n  originY: 'center',\n  originX: 'center',\n  lockMovementX: true,\n  lockMovementY: true,\n  borderColor: 'transparent',\n};\n","export function randomString(length: number = 36) {\n  let random = '';\n  const possible =\n    'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789';\n\n  for (let i = 0; i < length; i += 1) {\n    random += possible.charAt(Math.floor(Math.random() * possible.length));\n  }\n\n  return random;\n}\n","import {fabric} from 'fabric';\nimport {Canvas} from 'fabric/fabric-impl';\nimport {DEFAULT_OBJ_CONFIG} from '../objects/default-obj-config';\nimport {randomString} from '../common/utils/string/random-string';\nimport {state} from '../state/utils';\n\nexport function initFabric(canvasEl: HTMLCanvasElement): Canvas {\n  const fabricCanvas = new fabric.Canvas(canvasEl, {width: 1, height: 1});\n  fabricCanvas.preserveObjectStacking = true;\n  fabricCanvas.selection = false;\n  fabricCanvas.renderOnAddRemove = false;\n\n  const textureSize = state().config.textureSize;\n  if (textureSize) fabric.textureSize = textureSize;\n\n  const userConfig = state().config.objectDefaults?.global;\n  const objectDefaults = {\n    ...userConfig,\n    ...DEFAULT_OBJ_CONFIG,\n  };\n\n  Object.keys(objectDefaults).forEach(key => {\n    // @ts-ignore\n    fabric.Object.prototype[key] = objectDefaults[key];\n  });\n\n  // add ID to all objects\n  fabricCanvas.on('object:added', e => {\n    if (e.target && !e.target?.data?.id) {\n      if (!e.target.data) e.target.data = {};\n      e.target.data.id = randomString(10);\n    }\n  });\n\n  // remove native fabric object controls\n  const objectControls = fabric.Object.prototype.controls;\n  Object.keys(objectControls).forEach(key => {\n    delete objectControls[key];\n  });\n\n  return fabricCanvas;\n}\n","type InteractionName = null | 'resize' | 'rotate' | 'drag' | 'move';\n\nexport let activeInteraction: InteractionName = null;\n\nexport function setActiveInteraction(name: InteractionName) {\n  activeInteraction = name;\n}\n","import NP from 'number-precision';\nimport {useStore} from '../state/store';\nimport {fabricCanvas, state} from '../state/utils';\nimport {activeInteraction} from '../common/ui/interactions/active-interaction';\n\nexport class ZoomTool {\n  protected readonly maxZoom = 2;\n  protected minZoom = 1;\n  readonly step = 0.05;\n\n  get allowUserZoom() {\n    return state().config?.tools?.zoom?.allowUserZoom ?? true;\n  }\n\n  get currentZoom(): number {\n    return state().zoom;\n  }\n\n  constructor() {\n    if (this.allowUserZoom) {\n      this.bindMouseWheel();\n    }\n\n    useStore.subscribe(\n      s => s.stageSize,\n      () => {\n        setTimeout(() => {\n          this.fitToScreen();\n        }, 1);\n      }\n    );\n  }\n\n  zoomIn(amount = this.step) {\n    this.set(this.currentZoom + amount);\n  }\n\n  canZoomIn(amount = this.step): boolean {\n    return this.currentZoom + amount <= this.maxZoom;\n  }\n\n  canZoomOut(amount = this.step): boolean {\n    return this.currentZoom - amount >= this.minZoom;\n  }\n\n  zoomOut(amount = this.step) {\n    this.set(this.currentZoom - amount);\n  }\n\n  /**\n   * Zoom canvas to specified scale.\n   */\n  set(newZoom: number, resize: boolean = true) {\n    if (newZoom < this.minZoom || newZoom > this.maxZoom) return;\n\n    const width = NP.round(state().original.width * newZoom, 0);\n    const height = NP.round(state().original.height * newZoom, 0);\n\n    fabricCanvas().setZoom(newZoom);\n\n    if (resize) {\n      fabricCanvas().setDimensions({width, height});\n    }\n\n    state().setZoom(newZoom);\n  }\n\n  /**\n   * Resize canvas to fit available screen space.\n   */\n  fitToScreen() {\n    if (!state().config.tools?.zoom?.fitImageToScreen) {\n      return;\n    }\n    const {width, height} = state().stageSize;\n    const stageHeight = Math.max(height, 1);\n    const stageWidth = Math.max(width, 1);\n\n    // image won't fit into current space available to canvas\n    if (\n      state().original.height > stageHeight ||\n      state().original.width > stageWidth\n    ) {\n      const scale = Math.min(\n        stageHeight / state().original.height,\n        stageWidth / state().original.width\n      );\n      // no need to allow zooming out beyond maximum size that fits into canvas\n      this.minZoom = Math.min(scale, 1);\n      // image will fit, so we can just load it in original size\n    } else {\n      this.minZoom = 1;\n    }\n\n    this.set(this.minZoom);\n  }\n\n  private bindMouseWheel() {\n    fabricCanvas().on('mouse:wheel', opt => {\n      opt.e.preventDefault();\n      opt.e.stopPropagation();\n\n      // disable zoom via mouse wheel if moving, rotating or resizing a shape.\n      if (activeInteraction != null) {\n        return;\n      }\n\n      if ((opt.e as WheelEvent).deltaY < 0) {\n        this.zoomIn();\n      } else {\n        this.zoomOut();\n      }\n    });\n  }\n}\n","import {Image} from 'fabric/fabric-impl';\nimport {fabric} from 'fabric';\nimport {state} from '../../state/utils';\n\nexport function loadFabricImage(data: string): Promise<Image> {\n  return new Promise(resolve => {\n    fabric.util.loadImage(\n      data,\n      img => resolve(new fabric.Image(img)),\n      null,\n      state().config.crossOrigin ? 'anonymous' : undefined\n    );\n  });\n}\n","import {IImageOptions, Image} from 'fabric/fabric-impl';\nimport {staticObjectConfig} from '../../objects/static-object-config';\nimport {ObjectName} from '../../objects/object-name';\nimport {loadFabricImage} from './load-fabric-image';\nimport {LoadingType} from '../../state/editor-state';\nimport {fabricCanvas, state, tools} from '../../state/utils';\nimport {canvasIsEmpty} from './canvas-is-empty';\nimport {fetchStateJsonFromUrl} from '../import/fetch-state-json-from-url';\n\nexport class PixieCanvas {\n  private readonly minWidth: number = 50;\n  private readonly minHeight: number = 50;\n\n  resize(\n    width: number,\n    height: number,\n    {\n      applyZoom = false,\n      resizeHelper = true,\n    }: {applyZoom?: boolean; resizeHelper?: boolean} = {}\n  ) {\n    const currentZoom = state().zoom;\n    fabricCanvas().setWidth(width * (applyZoom ? currentZoom : 1));\n    fabricCanvas().setHeight(height * (applyZoom ? currentZoom : 1));\n    state().setOriginal(width, height);\n    if (resizeHelper) {\n      tools().transform.resetStraightenAnchor();\n    }\n  }\n\n  async addMainImage(\n    url: string,\n    loadStateName: LoadingType = 'mainImage'\n  ): Promise<Image | undefined> {\n    state().toggleLoading(loadStateName);\n\n    const img = await loadFabricImage(url);\n    if (!img) return;\n\n    this.clear();\n    img.set(staticObjectConfig as IImageOptions);\n    img.name = ObjectName.MainImage;\n    fabricCanvas().add(img);\n\n    this.resize(img.width!, img.height!);\n    img.center();\n    img.setCoords();\n    tools().zoom.fitToScreen();\n    state().toggleLoading(false);\n    state().config.onMainImageLoaded?.(img);\n    return img;\n  }\n\n  openNew(\n    width: number,\n    height: number,\n    bgColor?: string\n  ): Promise<{width: number; height: number}> {\n    width = Math.max(this.minWidth, width);\n    height = Math.max(this.minHeight, height);\n\n    this.clear();\n    this.resize(width, height);\n    fabricCanvas().backgroundColor = bgColor;\n\n    tools().zoom.fitToScreen();\n    state().toggleLoading('newCanvas');\n    requestAnimationFrame(() => {\n      state().toggleLoading(false);\n    });\n    return Promise.resolve({width, height});\n  }\n\n  /**\n   * Get main image object, if it exists.\n   */\n  getMainImage(): Image {\n    return fabricCanvas()\n      .getObjects()\n      .find(obj => obj.name === ObjectName.MainImage) as Image;\n  }\n\n  render() {\n    fabricCanvas().requestRenderAll();\n  }\n\n  async loadInitialContent(): Promise<void> {\n    const image = state().config.image;\n    const size = state().config.blankCanvasSize;\n    const stateJson = state().config.state;\n    if (image && image.endsWith('json')) {\n      const stateObj = await fetchStateJsonFromUrl(image);\n      await tools().import.loadState(stateObj);\n    } else if (image && image.startsWith('{\"canvas')) {\n      await tools().import.loadState(image);\n    } else if (image) {\n      await this.addMainImage(image);\n    } else if (stateJson) {\n      await tools().import.loadState(stateJson);\n    } else if (size) {\n      await this.openNew(size.width, size.height);\n    }\n    if (canvasIsEmpty() && state().config.ui?.openImageDialog?.show) {\n      state().togglePanel('newImage', true);\n    }\n    // delay adding initial so changes made in the returned promise are caught\n    return new Promise<void>(resolve => {\n      setTimeout(() => {\n        tools().history.addInitial();\n        resolve();\n      }, 10);\n    });\n  }\n\n  clear() {\n    fabricCanvas().clear();\n    tools().frame.remove();\n    tools().transform.resetStraightenAnchor();\n  }\n}\n","import {Group, Object} from 'fabric/fabric-impl';\nimport {ObjectName} from '../object-name';\n\nexport function isSvgSticker(obj: Object): obj is Group {\n  return obj.name === ObjectName.Sticker && 'forEachObject' in obj;\n}\n","import type {ObjectOptions} from './object-modified-event';\n\nexport const SIZE_AND_POSITION_PROPS: (keyof ObjectOptions)[] = [\n  'fontSize',\n  'fontFamily',\n  'left',\n  'top',\n  'width',\n  'height',\n  'scaleX',\n  'scaleY',\n  'flipX',\n  'flipY',\n  'angle',\n  'src',\n  'strokeWidth',\n];\n","import {IImageOptions, IObjectOptions, ITextOptions} from 'fabric/fabric-impl';\nimport {SIZE_AND_POSITION_PROPS} from './size-and-position-props';\nimport {fabricCanvas} from '../state/utils';\n\nexport type ObjectOptions = IObjectOptions &\n  ITextOptions &\n  IImageOptions & {src?: string};\n\nexport interface ObjectModifiedEvent {\n  values: ObjectOptions;\n  sizeOrPositionChanged: boolean;\n}\n\nexport function fireObjModifiedEvent(values: ObjectOptions = {}) {\n  fabricCanvas().fire('object:modified', buildObjModifiedEvent(values));\n}\n\nexport function buildObjModifiedEvent(\n  values: ObjectOptions\n): ObjectModifiedEvent {\n  return {\n    values,\n    sizeOrPositionChanged: sizeOrPositionChanged(values),\n  };\n}\n\nfunction sizeOrPositionChanged(values: ObjectOptions): boolean {\n  return Object.keys(values).some(r =>\n    SIZE_AND_POSITION_PROPS.includes(r as keyof ObjectOptions)\n  );\n}\n","import {IEvent, Object as IObject} from 'fabric/fabric-impl';\nimport {getToolForObj, setActiveTool} from '../ui/navbar/set-active-tool';\nimport {state, tools} from '../state/utils';\nimport {ToolName} from '../tools/tool-name';\n\ninterface SelectionEvent extends IEvent {\n  deselected?: IObject[];\n}\n\nexport function bindToFabricSelectionEvents() {\n  state().fabric.on('selection:created', e => {\n    if (e.selected?.[0] && !shouldPreventObjDeselect(e)) {\n      selectNewObj(e.selected[0]);\n    }\n  });\n  state().fabric.on('selection:updated', e => {\n    if (!shouldPreventObjDeselect(e)) {\n      selectNewObj(e.selected?.[0]);\n    }\n  });\n  state().fabric.on('selection:cleared', () => {\n    selectNewObj();\n  });\n}\n\nfunction shouldPreventObjDeselect(e: SelectionEvent): boolean {\n  const [toolName] = getToolForObj(e.selected?.[0]);\n  const objIsHandledByActiveTool = toolName === state().activeTool;\n  if (state().dirty && (!e.selected?.[0] || !objIsHandledByActiveTool)) {\n    if (e.deselected) {\n      tools().objects.select(e.deselected[0]);\n    }\n    return true;\n  }\n  return false;\n}\n\nfunction selectNewObj(obj?: IObject) {\n  if (obj?.data.id === state().objects.active.id) {\n    return;\n  }\n  state().objects.setActive(obj ?? null);\n\n  // prevent draw tool from closing when deselecting an object\n  if (state().activeTool !== ToolName.DRAW) {\n    setActiveTool();\n  }\n}\n","import {Object as IObject} from 'fabric/fabric-impl';\nimport {isSvgSticker} from './utils/is-svg-sticker';\nimport {isText} from './utils/is-text';\nimport {fireObjModifiedEvent, ObjectOptions} from './object-modified-event';\nimport {bindToFabricSelectionEvents} from './bind-to-fabric-selection-events';\nimport {fabricCanvas, state, tools} from '../state/utils';\nimport {useStore} from '../state/store';\nimport {randomString} from '../common/utils/string/random-string';\n\nexport class ObjectTool {\n  constructor() {\n    this.syncObjects();\n\n    bindToFabricSelectionEvents();\n\n    state().fabric.on('text:editing:entered', () => {\n      state().objects.setIsEditingText(true);\n    });\n    state().fabric.on('text:editing:exited', () => {\n      state().objects.setIsEditingText(false);\n    });\n\n    state().fabric.on('object:added', () => {\n      this.syncObjects();\n    });\n    state().fabric.on('object:removed', () => {\n      this.syncObjects();\n    });\n  }\n\n  /**\n   * Get all objects that are currently on canvas.\n   */\n  getAll(): IObject[] {\n    return fabricCanvas()\n      .getObjects()\n      .filter(obj => !obj?.data?.pixieInternal);\n  }\n\n  /**\n   * Get object with specified name from canvas.\n   */\n  get(name: string) {\n    return this.getAll().find(obj => obj.name === name);\n  }\n\n  /**\n   * Get object with specified id from canvas.\n   */\n  getById(id: string) {\n    return this.getAll().find(obj => obj.data.id === id);\n  }\n\n  /**\n   * Check whether specified object is currently selected.\n   */\n  isActive(objectOrId: IObject | string): boolean {\n    const objId =\n      typeof objectOrId === 'string' ? objectOrId : objectOrId.data.id;\n    return state().objects.active?.id === objId;\n  }\n\n  /**\n   * Get currently active object.\n   */\n  getActive(): IObject | null {\n    return fabricCanvas().getActiveObject();\n  }\n\n  /**\n   * Check if object with specified name exists on canvas.\n   */\n  has(name: string) {\n    return this.getAll().findIndex(obj => obj.name === name) > -1;\n  }\n\n  /**\n   * Select specified object.\n   */\n  select(objOrId: IObject | string) {\n    const obj = typeof objOrId === 'string' ? this.getById(objOrId) : objOrId;\n    if (!obj) return;\n    fabricCanvas().setActiveObject(obj);\n    fabricCanvas().requestRenderAll();\n  }\n\n  /**\n   * Deselect currently active object.\n   */\n  deselectActive() {\n    fabricCanvas().discardActiveObject();\n    fabricCanvas().requestRenderAll();\n  }\n\n  /**\n   * Apply values to specified or currently active object.\n   */\n  setValues(values: ObjectOptions, obj?: IObject | null) {\n    obj = obj || this.getActive();\n    if (!obj) return;\n\n    let fontChanged = false;\n\n    // apply fill color to each svg line separately, so sticker\n    // is not recolored when other values like shadow change\n    if (isSvgSticker(obj) && values.fill !== obj.fill) {\n      obj.forEachObject(path => path.set('fill', values.fill));\n    }\n\n    if (isText(obj)) {\n      if (\n        values.fontFamily !== obj.fontFamily ||\n        values.fontSize !== obj.fontSize\n      ) {\n        fontChanged = true;\n      }\n      if (obj.selectionStart !== obj.selectionEnd) {\n        obj.setSelectionStyles(values);\n      } else {\n        obj.set(values);\n      }\n    } else {\n      obj.set(values);\n    }\n\n    // sometimes changes are not rendered until next render without this\n    if (fontChanged) {\n      setTimeout(() => {\n        fabricCanvas().requestRenderAll();\n      }, 50);\n    } else {\n      fabricCanvas().requestRenderAll();\n    }\n\n    state().objects.setActive(obj);\n    fireObjModifiedEvent(values);\n  }\n\n  /**\n   * Move specified or currently active object in given direction.\n   */\n  move(\n    direction: 'up' | 'right' | 'down' | 'left',\n    amount: number = 1,\n    obj?: IObject | null\n  ) {\n    obj = obj || this.getActive();\n    if (!obj) return;\n    if (direction === 'up') {\n      this.setValues({top: obj.top! - amount});\n    } else if (direction === 'down') {\n      this.setValues({top: obj.top! + amount});\n    } else if (direction === 'left') {\n      this.setValues({left: obj.left! - amount});\n    } else if (direction === 'right') {\n      this.setValues({left: obj.left! + amount});\n    }\n    tools().canvas.render();\n  }\n\n  /**\n   * Bring specified or currently active object to front of canvas.\n   */\n  bringToFront(obj?: IObject | null) {\n    obj = obj || this.getActive();\n    if (!obj) return;\n    obj.bringToFront();\n    tools().canvas.render();\n  }\n\n  /**\n   * Send specified or currently active object to the back of canvas.\n   */\n  sendToBack(obj?: IObject | null) {\n    obj = obj || this.getActive();\n    if (!obj) return;\n    obj.sendToBack();\n    tools().canvas.render();\n  }\n\n  /**\n   * Flip specified or currently active object horizontally.\n   */\n  flipHorizontally(obj?: IObject | null) {\n    obj = obj || this.getActive();\n    if (!obj) return;\n    this.setValues({flipX: !obj.flipX});\n    tools().canvas.render();\n  }\n\n  /**\n   * Duplicate specified or currently active object.\n   */\n  duplicate(obj?: IObject | null) {\n    const original = obj || this.getActive();\n    if (!original) return;\n\n    this.deselectActive();\n\n    original.clone((clonedObj: IObject) => {\n      clonedObj.set({\n        left: original.left! + 40,\n        top: original.top! + 40,\n        data: {...original.data, id: randomString(10)},\n        name: original.name,\n      });\n\n      fabricCanvas().add(clonedObj);\n      this.select(clonedObj);\n      tools().canvas.render();\n    });\n  }\n\n  /**\n   * Delete specified or currently active object.\n   */\n  delete(obj?: IObject | null) {\n    obj = obj || this.getActive();\n    if (!obj) return;\n    this.deselectActive();\n    fabricCanvas().remove(obj);\n    fabricCanvas().requestRenderAll();\n    tools().history.addHistoryItem({name: 'deletedObject'});\n  }\n\n  /**\n   * Sync layers list with fabric.js objects.\n   * @hidden\n   */\n  syncObjects() {\n    const partial = this.getAll().map(o => ({\n      name: o.name!,\n      selectable: o.selectable ?? false,\n      id: o.data.id,\n    }));\n    useStore.setState({\n      objects: {\n        ...state().objects,\n        all: partial,\n      },\n    });\n  }\n}\n","import {IObjectOptions} from 'fabric/fabric-impl';\n\nexport interface SerializedPixieState {\n  canvas: SerializedFabricState;\n  editor: {\n    frame: {name: string; sizePercent: number} | null;\n    zoom: number;\n    activeObjectId: string | null;\n  };\n  canvasWidth: number;\n  canvasHeight: number;\n}\n\nexport const DEFAULT_SERIALIZED_EDITOR_STATE = {\n  frame: null,\n  fonts: [],\n};\n\nexport interface SerializedFabricState {\n  objects: IObjectOptions[];\n}\n","import {SerializedPixieState} from '../serialized-pixie-state';\nimport {HistoryItem} from '../history-item.interface';\nimport {randomString} from '../../../common/utils/string/random-string';\nimport {getCurrentCanvasState} from './get-current-canvas-state';\nimport {HistoryName} from '../history-display-names';\n\nexport function createHistoryItem(params: {\n  name: HistoryName;\n  state?: SerializedPixieState;\n}): HistoryItem {\n  if (!params.state) {\n    params.state = getCurrentCanvasState();\n  }\n  const state = params.state || getCurrentCanvasState();\n  return {\n    ...state,\n    name: params.name,\n    id: randomString(15),\n  };\n}\n","import {IText, ITextOptions} from 'fabric/fabric-impl';\nimport {fabric} from 'fabric';\nimport {defaultObjectProps} from '../../config/default-object-props';\nimport {ObjectName} from '../../objects/object-name';\nimport {fabricCanvas, state, tools} from '../../state/utils';\nimport {isText} from '../../objects/utils/is-text';\n\nexport const TEXT_CONTROLS_PADDING = 15;\n\nexport class TextTool {\n  private readonly minWidth: number = 250;\n\n  /**\n   * Add specified text to canvas.\n   */\n  add(text?: string, providedConfig: ITextOptions = {}) {\n    text = text || state().config.tools?.text?.defaultText;\n    if (!text) return;\n\n    const options = {\n      ...state().config.objectDefaults?.text,\n      ...providedConfig,\n      name: ObjectName.Text,\n      padding: TEXT_CONTROLS_PADDING,\n      editingBorderColor: defaultObjectProps.fill,\n    };\n\n    const itext = new fabric.IText(text, options);\n    fabricCanvas().add(itext);\n    this.autoPositionText(itext);\n\n    tools().objects.select(itext);\n  }\n\n  private autoPositionText(text: IText) {\n    const canvasWidth = fabricCanvas().getWidth();\n    const canvasHeight = fabricCanvas().getHeight();\n\n    // make sure min width is not larger than canvas width\n    const minWidth = Math.min(fabricCanvas().getWidth(), this.minWidth);\n\n    text.scaleToWidth(Math.max(canvasWidth / 3, minWidth));\n\n    // make sure text is not scaled outside canvas\n    if (text.getScaledHeight() > canvasHeight) {\n      text.scaleToHeight(canvasHeight - text.getScaledHeight() - 20);\n    }\n\n    text.viewportCenter();\n\n    // push text down, if it intersects with another text object\n    fabricCanvas()\n      .getObjects('i-text')\n      .forEach(obj => {\n        if (obj === text) return;\n        if (obj.intersectsWithObject(text)) {\n          const offset = obj.top! - text.top! + obj.getScaledHeight();\n          let newTop = text.top! + offset;\n\n          // if pushing object down would push it outside canvas, position text at top of canvas\n          if (newTop > state().original.height - obj.getScaledHeight()) {\n            newTop = 0;\n          }\n\n          text.set('top', newTop);\n          text.setCoords();\n        }\n      });\n  }\n\n  /**\n   * Select first text object on canvas if it exists, otherwise add a new one.\n   */\n  selectOrAddText(text?: string, providedConfig: ITextOptions = {}): boolean {\n    if (state().objects.active.isText) return false;\n\n    const textObj = tools()\n      .objects.getAll()\n      .find(o => isText(o));\n    if (textObj) {\n      tools().objects.select(textObj);\n      return false;\n    } else {\n      this.add(text, providedConfig);\n      return true;\n    }\n  }\n}\n","import {FontFaceConfig} from './font-face-config';\n\nexport function loadFonts(\n  fonts: FontFaceConfig[],\n  prefixSrc?: (src: string) => string\n): Promise<FontFace[]> {\n  const promises = fonts.map(async fontConfig => {\n    const loadedFont = Array.from(document.fonts.values()).find(current => {\n      return current.family === fontConfig.family;\n    });\n    if (loadedFont) {\n      return loadedFont.loaded;\n    }\n    const fontFace = new FontFace(\n      fontConfig.family,\n      `url(${prefixSrc ? prefixSrc(fontConfig.src) : fontConfig.src})`,\n      fontConfig.descriptors\n    );\n    document.fonts.add(fontFace);\n    return fontFace.load();\n  });\n  return Promise.all(promises);\n}\n","export function isAbsoluteUrl(url: string): boolean {\n  if (!url) return false;\n  return /^[a-zA-Z][a-zA-Z\\d+\\-.]*?:/.test(url);\n}\n","import {state} from '../state/utils';\nimport {isAbsoluteUrl} from '../common/utils/urls/is-absolute-url';\n\nexport function assetUrl(uri?: string): string {\n  if (!uri) return '';\n  if (isAbsoluteUrl(uri)) {\n    return uri;\n  }\n  const baseUrl = state().config.baseUrl ? `${state().config.baseUrl}/` : '';\n  return `${baseUrl}${uri}`;\n}\n","import {IObjectOptions} from 'fabric/fabric-impl';\nimport {\n  DEFAULT_SERIALIZED_EDITOR_STATE,\n  SerializedPixieState,\n} from './serialized-pixie-state';\nimport {HistoryItem} from './history-item.interface';\nimport {HistoryName} from './history-display-names';\nimport {createHistoryItem} from './state/create-history-item';\nimport {TEXT_CONTROLS_PADDING} from '../text/text-tool';\nimport {isText} from '../../objects/utils/is-text';\nimport {loadFonts} from '../../common/ui/font-picker/load-fonts';\nimport {FontFaceConfig} from '../../common/ui/font-picker/font-face-config';\nimport {DEFAULT_OBJ_CONFIG} from '../../objects/default-obj-config';\nimport {fabricCanvas, state, tools} from '../../state/utils';\nimport {canvasIsEmpty} from '../canvas/canvas-is-empty';\nimport {assetUrl} from '../../utils/asset-url';\n\nexport class HistoryTool {\n  /**\n   * Undo last canvas operation.\n   */\n  async undo(): Promise<void> {\n    if (this.canUndo()) {\n      const prev = state().history.items[state().history.pointer - 1];\n      await this.load(prev);\n    }\n  }\n\n  /**\n   * Redo last canvas operation.\n   */\n  async redo(): Promise<void> {\n    if (this.canRedo()) {\n      const next = state().history.items[state().history.pointer + 1];\n      await this.load(next);\n    }\n  }\n\n  /**\n   * Check if there are any actions to undo.\n   */\n  canUndo(): boolean {\n    return state().history.canUndo;\n  }\n\n  /**\n   * Check if there are any actions to redo.\n   */\n  canRedo(): boolean {\n    return state().history.canRedo;\n  }\n\n  /**\n   * Reload current history state, undoing any actions that were not yet applied.\n   */\n  reload() {\n    return this.load(state().history.items[state().history.pointer]);\n  }\n\n  /**\n   * Replace current history item with current canvas state.\n   */\n  replaceCurrent() {\n    const current = state().history.items[state().history.pointer];\n    const items = [...state().history.items];\n    items[state().history.pointer] = createHistoryItem({\n      name: current.name,\n      state: current,\n    });\n  }\n\n  /**\n   * Create a new history item from current canvas state.\n   */\n  addHistoryItem(params: {name: HistoryName; state?: SerializedPixieState}) {\n    const item = createHistoryItem(params);\n    const stateUntilPointer = state().history.items.slice(\n      0,\n      state().history.pointer + 1\n    );\n    const newItems = [...stateUntilPointer, item];\n    state().history.update(newItems.length - 1, newItems);\n  }\n\n  /**\n   * Replace current canvas state with specified history item.\n   */\n  load(item: HistoryItem): Promise<any> {\n    item = {...item, editor: item.editor || DEFAULT_SERIALIZED_EDITOR_STATE};\n    return new Promise<void>(resolve => {\n      loadFonts(getUsedFonts(item.canvas.objects), assetUrl).finally(() => {\n        fabricCanvas().loadFromJSON(item.canvas, () => {\n          tools().zoom.set(1);\n\n          // resize canvas if needed\n          if (item.canvasWidth && item.canvasHeight) {\n            tools().canvas.resize(item.canvasWidth, item.canvasHeight, {\n              resizeHelper: false,\n              applyZoom: false,\n            });\n          }\n\n          // add frame\n          tools().frame.remove();\n          if (item.editor.frame) {\n            tools().frame.add(\n              item.editor.frame.name,\n              item.editor.frame.sizePercent\n            );\n          }\n\n          tools().objects.syncObjects();\n\n          // restore padding\n          tools()\n            .objects.getAll()\n            .forEach(o => {\n              // translate left/top to center/center coordinates, for compatibility with old .json state files\n              if (\n                !o.data.pixieInternal &&\n                o.originX === 'left' &&\n                o.originY === 'top'\n              ) {\n                const point = o.getPointByOrigin('center', 'center');\n                o.set('left', point.x);\n                o.set('top', point.y);\n              }\n              o.set({...DEFAULT_OBJ_CONFIG});\n              if (o.type === 'i-text') {\n                o.padding = TEXT_CONTROLS_PADDING;\n              }\n            });\n\n          // prepare fabric.js and canvas\n          tools().canvas.render();\n          fabricCanvas().calcOffset();\n          tools().zoom.fitToScreen();\n\n          // update pointer ID after state is applied to canvas\n          state().history.updatePointerById(item.id);\n          tools().transform.resetStraightenAnchor();\n          resolve();\n        });\n      });\n    });\n  }\n\n  /**\n   * @hidden\n   */\n  addInitial(stateObj?: SerializedPixieState) {\n    const initial = state().history.items.find(i => i.name === 'initial');\n    if (!initial && (stateObj || !canvasIsEmpty())) {\n      this.addHistoryItem({name: 'initial', state: stateObj});\n    }\n  }\n}\n\nfunction getUsedFonts(objects: IObjectOptions[]): FontFaceConfig[] {\n  const fonts: FontFaceConfig[] = [];\n  objects.forEach(obj => {\n    if (!isText(obj)) return;\n    const fontConfig = state().config.tools?.text?.items?.find(\n      f => f.family === obj.fontFamily\n    );\n    if (fontConfig) {\n      fonts.push(fontConfig);\n    }\n  });\n  return fonts;\n}\n","import {ObjectName} from '../../objects/object-name';\nimport {state, tools} from '../../state/utils';\n\nexport class MergeTool {\n  canMerge(): boolean {\n    return (\n      tools()\n        .objects.getAll()\n        .filter(obj => obj.name !== ObjectName.MainImage).length > 0\n    );\n  }\n\n  async apply(): Promise<any> {\n    state().toggleLoading('merge');\n    const data = tools().export.getDataUrl();\n    if (data) {\n      await tools().canvas.addMainImage(data, 'merge');\n    }\n  }\n}\n","import {IAllFilters} from 'fabric/fabric-impl';\nimport {MessageDescriptor} from '../../common/i18n/message-descriptor';\nimport {message} from '../../common/i18n/message';\n\nexport interface FilterConfig {\n  name: string;\n  fabricType?: string;\n  uses?: keyof IAllFilters;\n  options?: FilterOptions;\n  initialConfig?: {[key: string]: any};\n  matrix?: number[];\n  apply?: Function;\n}\n\nexport interface FilterOptions {\n  [key: string]: SliderOptions | SelectOptions | ColorOptions;\n}\n\ninterface SliderOptions {\n  type: 'slider';\n  current: number;\n  min: number;\n  max: number;\n  step?: number;\n}\n\ninterface SelectOptions {\n  type: 'select';\n  current: string;\n  available: {key: string}[];\n}\n\ninterface ColorOptions {\n  type: 'colorPicker';\n  current: string;\n}\n\nexport const filterList: FilterConfig[] = [\n  {name: 'grayscale'},\n  {name: 'blackWhite', fabricType: 'blackwhite'},\n  {\n    name: 'sharpen',\n    uses: 'Convolute',\n    matrix: [0, -1, 0, -1, 5, -1, 0, -1, 0],\n  },\n  {name: 'invert'},\n  {name: 'vintage'},\n  {name: 'polaroid'},\n  {name: 'kodachrome'},\n  {name: 'technicolor'},\n  {name: 'brownie'},\n  {name: 'sepia'},\n  {\n    name: 'removeColor',\n    fabricType: 'removecolor',\n    options: {\n      distance: {type: 'slider', current: 0.1, min: 0, max: 1, step: 0.01},\n      color: {current: '#fff', type: 'colorPicker'},\n    },\n  },\n  {\n    name: 'brightness',\n    options: {\n      brightness: {type: 'slider', current: 0.1, min: -1, max: 1, step: 0.1},\n    },\n  },\n  {\n    name: 'gamma',\n    options: {\n      red: {type: 'slider', current: 0.1, min: 0.2, max: 2.2, step: 0.003921},\n      green: {type: 'slider', current: 0.1, min: 0.2, max: 2.2, step: 0.003921},\n      blue: {type: 'slider', current: 0.1, min: 0.2, max: 2.2, step: 0.003921},\n    },\n    apply: (filter: any) => {\n      filter.gamma = [filter.red, filter.green, filter.blue];\n    },\n  },\n  {\n    name: 'noise',\n    options: {\n      noise: {type: 'slider', current: 40, min: 1, max: 600},\n    },\n  },\n  {\n    name: 'pixelate',\n    options: {\n      blocksize: {type: 'slider', min: 1, max: 40, current: 6},\n    },\n  },\n  {\n    name: 'blur',\n    uses: 'Convolute',\n    matrix: [1 / 9, 1 / 9, 1 / 9, 1 / 9, 1 / 9, 1 / 9, 1 / 9, 1 / 9, 1 / 9],\n  },\n  {\n    name: 'emboss',\n    uses: 'Convolute',\n    matrix: [1, 1, 1, 1, 0.7, -1, -1, -1, -1],\n  },\n  {\n    name: 'blendColor',\n    fabricType: 'blendcolor',\n    options: {\n      alpha: {type: 'slider', current: 0.5, min: 0.1, max: 1, step: 0.1},\n      mode: {\n        current: 'add',\n        type: 'select',\n        available: [\n          {key: 'add'},\n          {key: 'multiply'},\n          {key: 'subtract'},\n          {key: 'diff'},\n          {key: 'screen'},\n          {key: 'lighten'},\n          {key: 'darken'},\n        ],\n      },\n      color: {type: 'colorPicker', current: '#FF4081'},\n    },\n  },\n];\n\nexport const filterNameMessages: Record<string, MessageDescriptor> = {\n  grayscale: message('grayscale'),\n  blackWhite: message('Black & White'),\n  sharpen: message('Sharpen'),\n  invert: message('Invert'),\n  vintage: message('Vintage'),\n  polaroid: message('Polaroid'),\n  kodachrome: message('Kodachrome'),\n  technicolor: message('Technicolor'),\n  brownie: message('Brownie'),\n  sepia: message('Sepia'),\n  removeColor: message('Remove Color'),\n  brightness: message('Brightness'),\n  gamma: message('Gamma'),\n  noise: message('Noise'),\n  pixelate: message('Pixelate'),\n  blur: message('Blur'),\n  emboss: message('Emboss'),\n  blendColor: message('Blend Color'),\n};\n\nexport const filterOptionMessages: Record<string, MessageDescriptor> = {\n  distance: message('distance'),\n  color: message('color'),\n  brightness: message('brightness'),\n  red: message('red'),\n  green: message('green'),\n  blue: message('blue'),\n  noise: message('noise'),\n  blocksize: message('blocksize'),\n  mode: message('mode'),\n  alpha: message('alpha'),\n};\n","export function ucFirst<T extends string>(string: T): T {\n  if (!string) return string;\n  return (string.charAt(0).toUpperCase() + string.slice(1)) as T;\n}\n","import {fabric} from 'fabric';\nimport {IAllFilters, IBaseFilter, Image} from 'fabric/fabric-impl';\nimport {FilterConfig, filterList, FilterOptions} from './filter-list';\nimport {ucFirst} from '../../common/utils/string/uc-first';\nimport {useStore} from '../../state/store';\nimport {ObjectName} from '../../objects/object-name';\nimport {state, tools} from '../../state/utils';\n\nexport interface FabricFilter extends IBaseFilter {\n  type: string;\n  matrix?: number[];\n\n  [key: string]: any;\n}\n\nexport class FilterTool {\n  constructor() {\n    useStore.subscribe(\n      s => s.history.pointer,\n      () => {\n        this.syncState();\n      }\n    );\n  }\n\n  /**\n   * Apply specified filter to all images.\n   */\n  apply(filterName: string) {\n    state().filter.select(filterName, this.hasOptions(filterName));\n    const filter = this.getByName(filterName);\n    if (this.isApplied(filter.name)) {\n      this.remove(filter.name);\n      return;\n    }\n\n    const newFilter = this.create(filter);\n    this.getImages().forEach(image => {\n      image.filters?.push(newFilter);\n      image.applyFilters();\n    });\n\n    this.syncState();\n    tools().canvas.render();\n  }\n\n  /**\n   * Remove specified filter from all images.\n   */\n  remove(filterName: string) {\n    state().filter.deselect(filterName);\n    const filter = this.getByName(filterName);\n    this.getImages().forEach(image => {\n      const i = this.findFilterIndex(\n        filter.name,\n        image.filters as FabricFilter[]\n      );\n      image.filters?.splice(i, 1);\n      image.applyFilters();\n    });\n    this.syncState();\n    tools().canvas.render();\n  }\n\n  /**\n   * Get a list of all available filters.\n   */\n  getAll(): FilterConfig[] {\n    return filterList;\n  }\n\n  /**\n   * Get configuration for specified filter.\n   */\n  getByName(name: string): FilterConfig {\n    return filterList.find(f => f.name === name) as FilterConfig;\n  }\n\n  /**\n   * Check if specified filter is currently applied.\n   */\n  isApplied(name: string): boolean {\n    const mainImage = tools().canvas.getMainImage();\n    if (!mainImage) return false;\n    return this.findFilterIndex(name, mainImage.filters as FabricFilter[]) > -1;\n  }\n\n  /**\n   * Change specified value for an active filter.\n   */\n  applyValue(\n    filterName: string,\n    optionName: string,\n    optionValue: number | string\n  ) {\n    const filter = this.getByName(filterName);\n\n    this.getImages().forEach(image => {\n      const fabricFilter = ((image.filters || []) as FabricFilter[]).find(\n        curr => curr.type.toLowerCase() === filter.name.toLowerCase()\n      );\n      if (!fabricFilter) return;\n\n      fabricFilter[optionName] = optionValue;\n\n      // filter has a special \"apply\" function that needs to be invoked\n      if (filter.apply) {\n        filter.apply(fabricFilter, optionName, optionValue);\n      }\n\n      image.applyFilters();\n    });\n\n    tools().canvas.render();\n  }\n\n  /**\n   * Create a custom filter.\n   */\n  addCustom(\n    name: string,\n    filter: object,\n    editableOptions?: FilterOptions,\n    initialConfig?: object\n  ) {\n    const imgFilters = fabric.Image.filters as unknown as Record<string, any>;\n    imgFilters[ucFirst(name)] = fabric.util.createClass(\n      imgFilters.BaseFilter,\n      filter\n    );\n    imgFilters[ucFirst(name)].fromObject = imgFilters.BaseFilter.fromObject;\n    filterList.push({\n      name,\n      options: editableOptions,\n      initialConfig,\n    });\n  }\n\n  /**\n   * @hidden\n   */\n  create(config: FilterConfig): IBaseFilter {\n    const initialConfig = config.initialConfig || {};\n    let filter: IBaseFilter;\n    if (config.uses) {\n      initialConfig.matrix = config.matrix;\n      filter = new fabric.Image.filters[ucFirst(config.uses)](initialConfig);\n    } else {\n      Object.entries(config.options || {}).forEach(([key, value]) => {\n        initialConfig[key] = value.current;\n      });\n      filter = new fabric.Image.filters[\n        ucFirst(config.name) as keyof IAllFilters\n      ](initialConfig);\n    }\n    (filter as FabricFilter).name = config.name;\n    return filter;\n  }\n\n  /**\n   * @hidden\n   */\n  hasOptions(name: string) {\n    return !!this.getByName(name).options;\n  }\n\n  /**\n   * @hidden\n   */\n  findFilterIndex(name: string, fabricFilters?: FabricFilter[]): number {\n    if (!fabricFilters?.length) return -1;\n\n    const filterConfig = this.getByName(name);\n\n    return fabricFilters.findIndex(fabricFilter => {\n      return this.configMatchesFabricFilter(filterConfig, fabricFilter);\n    });\n  }\n\n  /**\n   * @hidden\n   */\n  syncState() {\n    const applied: string[] = [];\n    const fabricFilters = this.getImages()[0]?.filters || [];\n    fabricFilters.forEach(fabricFilter => {\n      const filterConfig = this.getByFabricFilter(fabricFilter as FabricFilter);\n      if (filterConfig) {\n        applied.push(filterConfig.name);\n      }\n    });\n    useStore.setState({\n      filter: {\n        ...state().filter,\n        applied,\n      },\n    });\n  }\n\n  private getByFabricFilter(\n    fabricFilter: FabricFilter\n  ): FilterConfig | undefined {\n    return filterList.find(filterConfig => {\n      return this.configMatchesFabricFilter(filterConfig, fabricFilter);\n    });\n  }\n\n  private configMatchesFabricFilter(\n    filterConfig: FilterConfig,\n    fabricFilter: FabricFilter\n  ): boolean {\n    const type = fabricFilter.type.toLowerCase().replace(' ', '');\n    if (type === filterConfig.fabricType || type === filterConfig.name) {\n      return true;\n    }\n    // match by matrix\n    return (\n      type === 'convolute' &&\n      this.matrixAreEqual(filterConfig.matrix, fabricFilter.matrix)\n    );\n  }\n\n  private matrixAreEqual(\n    matrix1: number[] | undefined,\n    matrix2: number[] | undefined\n  ): boolean {\n    if (!matrix1 || !matrix2 || matrix1.length !== matrix2.length) return false;\n    for (let i = matrix1.length; i--; ) {\n      if (matrix1[i] !== matrix2[i]) return false;\n    }\n    return true;\n  }\n\n  private getImages(): Image[] {\n    return tools()\n      .objects.getAll()\n      .filter(obj => {\n        return obj.name === ObjectName.Image || ObjectName.MainImage;\n      }) as Image[];\n  }\n}\n","import {state} from '../../state/utils';\nimport type {ResizePayload} from './resize-tool';\n\nexport function clampResizePayload(value: ResizePayload): ResizePayload {\n  if (value.width < getMinWidth(value.usePercentages)) {\n    value.width = getMinWidth(value.usePercentages);\n    if (value.maintainAspect) {\n      value.height = aspectToHeight(value.width, value.usePercentages);\n    }\n  }\n  if (value.width > getMaxWidth(value.usePercentages)) {\n    value.width = getMaxWidth(value.usePercentages);\n    if (value.maintainAspect) {\n      value.height = aspectToHeight(value.width, value.usePercentages);\n    }\n  }\n  if (value.height < getMinHeight(value.usePercentages)) {\n    value.height = getMinHeight(value.usePercentages);\n    if (value.maintainAspect) {\n      value.width = aspectToWidth(value.height, value.usePercentages);\n    }\n  }\n  if (value.height > getMaxHeight(value.usePercentages)) {\n    value.height = getMaxHeight(value.usePercentages);\n    if (value.maintainAspect) {\n      value.width = aspectToWidth(value.height, value.usePercentages);\n    }\n  }\n  return value;\n}\n\nfunction getMinWidth(usePercentages: boolean) {\n  const minWidth = state().config.tools?.resize?.minWidth || 50;\n  if (usePercentages) {\n    return Math.ceil((minWidth * 100) / state().original.width);\n  }\n  return minWidth;\n}\n\nfunction getMaxWidth(usePercentages: boolean) {\n  const maxWidth = state().config.tools?.resize?.maxWidth || 2400;\n  if (usePercentages) {\n    return Math.ceil((maxWidth * 100) / state().original.width);\n  }\n  return maxWidth;\n}\n\nfunction getMinHeight(usePercentages: boolean) {\n  const minHeight = state().config.tools?.resize?.minHeight || 50;\n  if (usePercentages) {\n    return Math.ceil((minHeight * 100) / state().original.height);\n  }\n  return minHeight;\n}\n\nfunction getMaxHeight(usePercentages: boolean) {\n  const maxHeight = state().config.tools?.resize?.maxHeight || 2400;\n  if (usePercentages) {\n    return Math.ceil((maxHeight * 100) / state().original.height);\n  }\n  return maxHeight;\n}\n\nexport function aspectToWidth(\n  newHeight: number,\n  usePercentages: boolean\n): number {\n  if (usePercentages) {\n    // noinspection JSSuspiciousNameCombination\n    return newHeight;\n  }\n  const hRatio = state().original.height / newHeight;\n  return Math.floor(state().original.width / hRatio);\n}\n\nexport function aspectToHeight(\n  newWidth: number,\n  usePercentages: boolean\n): number {\n  if (usePercentages) {\n    // noinspection JSSuspiciousNameCombination\n    return newWidth;\n  }\n  const wRatio = state().original.width / newWidth;\n  return Math.floor(state().original.height / wRatio);\n}\n","import {clampResizePayload} from './clamp-resize-payload';\nimport {fabricCanvas, state, tools} from '../../state/utils';\n\nexport class ResizeTool {\n  /**\n   * Resize image and other canvas objects.\n   * If \"usePercentages\" is false, width/height should be pixels.\n   */\n  apply(payload: ResizePayload) {\n    const {width, height, usePercentages} = clampResizePayload(payload);\n    const currentWidth = Math.ceil(state().original.width);\n    const currentHeight = Math.ceil(state().original.height);\n    const newWidth = Math.ceil(width);\n    const newHeight = Math.ceil(height);\n    let widthScale;\n    let heightScale;\n\n    if (usePercentages) {\n      widthScale = width / 100;\n      heightScale = height / 100;\n    } else {\n      widthScale = width / state().original.width;\n      heightScale = height / state().original.height;\n    }\n\n    if (currentWidth === newWidth && currentHeight === newHeight) return;\n\n    this.resize(widthScale, heightScale);\n  }\n\n  /**\n   * Resize canvas and all objects to specified scale.\n   */\n  private resize(widthScale: number, heightScale: number) {\n    tools().zoom.set(1, false);\n\n    const newHeight = Math.round(state().original.height * heightScale);\n    const newWidth = Math.round(state().original.width * widthScale);\n\n    tools().canvas.resize(newWidth, newHeight, {\n      applyZoom: false,\n      resizeHelper: true,\n    });\n\n    tools()\n      .objects.getAll()\n      .forEach(object => {\n        const scaleX = object.scaleX || 1;\n        const scaleY = object.scaleY || 1;\n        const left = object.left || 0;\n        const top = object.top || 0;\n\n        const tempScaleX = scaleX * widthScale;\n        const tempScaleY = scaleY * heightScale;\n        const tempLeft = left * widthScale;\n        const tempTop = top * heightScale;\n\n        object.scaleX = tempScaleX;\n        object.scaleY = tempScaleY;\n        object.left = tempLeft;\n        object.top = tempTop;\n\n        object.setCoords();\n      });\n\n    tools().zoom.fitToScreen();\n    fabricCanvas().requestRenderAll();\n  }\n}\n\nexport interface ResizePayload {\n  width: number;\n  height: number;\n  maintainAspect: boolean;\n  usePercentages: boolean;\n}\n","import {CropzoneRefs} from './cropzone-refs';\nimport {state} from '../../../../state/utils';\nimport {InteractableRect} from '../../../../common/ui/interactions/interactable-event';\n\nexport function drawCropzone(rect: InteractableRect, refs: CropzoneRefs) {\n  if (refs.innerZone !== null) {\n    refs = refs as NonNullable<CropzoneRefs>;\n    drawInnerZone(rect, refs);\n    drawMask(rect, refs);\n    drawLines(rect, refs);\n  }\n}\n\nfunction drawInnerZone(\n  rect: InteractableRect,\n  refs: NonNullable<CropzoneRefs>\n) {\n  refs.innerZone!.style.width = `${rect.width}px`;\n  refs.innerZone!.style.height = `${rect.height}px`;\n  refs.innerZone!.style.transform = `translate(${rect.left}px, ${rect.top}px)`;\n}\n\nfunction drawMask(rect: InteractableRect, refs: CropzoneRefs) {\n  const contWidth = state().canvasSize.width;\n  const contHeight = state().canvasSize.height;\n\n  // top\n  refs.maskTop!.style.height = `${rect.top}px`;\n  refs.maskTop!.style.width = `${contWidth}px`;\n  // left\n  refs.maskLeft!.style.top = `${rect.top}px`;\n  refs.maskLeft!.style.height = `${rect.height}px`;\n  refs.maskLeft!.style.width = `${rect.left}px`;\n  // right\n  const rightLeft = rect.left + rect.width;\n  refs.maskRight!.style.left = `${rightLeft}px`;\n  refs.maskRight!.style.top = `${rect.top}px`;\n  refs.maskRight!.style.height = `${rect.height}px`;\n  refs.maskRight!.style.width = `${contWidth - rightLeft}px`;\n  // bottom\n  refs.maskBottom!.style.height = `${contHeight - (rect.top + rect.height)}px`;\n  refs.maskBottom!.style.width = `${contWidth}px`;\n}\n\nfunction drawLines(rect: InteractableRect, refs: CropzoneRefs) {\n  const horSpace = (rect.width - 2) / 3;\n  refs.lineVer1!.style.height = `${rect.height}px`;\n  refs.lineVer1!.style.transform = `translate(${horSpace}px, 0)`;\n  refs.lineVer2!.style.height = `${rect.height}px`;\n  refs.lineVer2!.style.transform = `translate(${horSpace * 2}px, 0)`;\n  const verSpace = (rect.height - 2) / 3;\n  refs.lineHor1!.style.width = `${rect.width}px`;\n  refs.lineHor1!.style.transform = `translate(0, ${verSpace}px)`;\n  refs.lineHor2!.style.width = `${rect.width}px`;\n  refs.lineHor2!.style.transform = `translate(0, ${verSpace * 2}px)`;\n}\n","export function calcNewSizeFromAspectRatio(\n  aspectRatio: number | null,\n  oldWidth: number,\n  oldHeight: number\n) {\n  let newWidth = oldWidth;\n  let newHeight = oldHeight;\n\n  if (aspectRatio) {\n    if (oldHeight * aspectRatio > oldWidth) {\n      newHeight = oldWidth / aspectRatio;\n    } else {\n      newWidth = oldHeight * aspectRatio;\n    }\n  }\n\n  return {width: Math.floor(newWidth), height: Math.floor(newHeight)};\n}\n\nexport function aspectRatioFromStr(ratio: string | null): number | null {\n  if (!ratio) return null;\n  const parts = ratio.split(':');\n  return parseInt(parts[0]) / parseInt(parts[1]);\n}\n","import {InteractableRect} from '../interactable-event';\nimport {calcNewSizeFromAspectRatio} from './calc-new-size-from-aspect-ratio';\n\nexport function centerWithinBoundary(\n  boundary: Omit<InteractableRect, 'angle'>,\n  aspectRatio: number | null = null\n): InteractableRect {\n  // set rect to the size of specified boundary\n  const rect: InteractableRect = {\n    width: boundary.width,\n    height: boundary.height,\n    top: 0,\n    left: 0,\n    angle: 0,\n  };\n  // maybe resize rect based on aspect ratio\n  if (aspectRatio) {\n    const newSize = calcNewSizeFromAspectRatio(\n      aspectRatio,\n      rect.width,\n      rect.height\n    );\n    rect.width = newSize.width;\n    rect.height = newSize.height;\n  }\n  // center the rect\n  rect.left = (boundary.width - rect.width) / 2;\n  rect.top = (boundary.height - rect.height) / 2;\n  return rect;\n}\n","import React from 'react';\nimport {drawCropzone} from './ui/cropzone/draw-cropzone';\nimport {centerWithinBoundary} from '../../common/ui/interactions/utils/center-within-boundary';\nimport {aspectRatioFromStr} from '../../common/ui/interactions/utils/calc-new-size-from-aspect-ratio';\nimport {CropzoneRefs} from './ui/cropzone/cropzone-refs';\nimport {state, tools} from '../../state/utils';\nimport {InteractableRect} from '../../common/ui/interactions/interactable-event';\n\nexport class CropTool {\n  private refs: React.MutableRefObject<CropzoneRefs> | null = null;\n\n  apply(box: Omit<InteractableRect, 'angle'>): Promise<void> {\n    const frameName = tools().frame.active.config?.name;\n    const frameSize = tools().frame.active.currentSizeInPercent;\n    tools().frame.active.hide();\n\n    return tools()\n      .merge.apply()\n      .then(() => {\n        tools().canvas.resize(Math.round(box.width), Math.round(box.height), {\n          applyZoom: true,\n          resizeHelper: true,\n        });\n\n        const img = tools().canvas.getMainImage();\n        img.cropX = Math.round(box.left);\n        img.cropY = Math.round(box.top);\n        img.width = Math.round(box.width);\n        img.height = Math.round(box.height);\n        img.viewportCenter();\n\n        if (frameName) {\n          tools().frame.add(frameName, frameSize);\n        }\n\n        tools().zoom.fitToScreen();\n        tools().canvas.render();\n      });\n  }\n\n  drawZone(rect: InteractableRect) {\n    if (this.refs?.current) {\n      state().crop.setCropzoneRect(rect);\n      drawCropzone(rect, this.refs.current);\n    }\n  }\n\n  resetCropzone(aspectRatioStr: string | null) {\n    const boundaryRect = state().canvasSize;\n    const aspectRatio = aspectRatioFromStr(aspectRatioStr);\n    if (!boundaryRect) return;\n    state().crop.setAspectRatio(aspectRatioStr);\n    const newRect = centerWithinBoundary(boundaryRect, aspectRatio);\n    this.drawZone(newRect);\n  }\n\n  registerRefs(refs: React.MutableRefObject<CropzoneRefs>) {\n    this.refs = refs;\n  }\n}\n","import {Object} from 'fabric/fabric-impl';\nimport {fabric} from 'fabric';\nimport {BasicShape, PathOptions} from '../../config/default-shapes';\nimport {StickerCategory} from '../../config/default-stickers';\nimport {ObjectName} from '../../objects/object-name';\nimport {fabricCanvas, state, tools} from '../../state/utils';\nimport {assetUrl} from '../../utils/asset-url';\n\nexport class ShapeTool {\n  getShapeByName(name: string): BasicShape | null {\n    const shapes = state().config.tools?.shapes?.items;\n    return shapes?.find(shape => shape.name === name) || null;\n  }\n\n  addBasicShape(shapeName: string): Object | null {\n    const shape = this.getShapeByName(shapeName);\n    if (!shape) return null;\n\n    const {width, height, ...userConfig} =\n      state().config.objectDefaults?.shape || {};\n\n    const options: BasicShape['options'] = {\n      ...userConfig,\n      ...shape.options,\n    };\n\n    let fabricShape: Object;\n\n    if (shape.name === 'circle') {\n      fabricShape = new fabric.Circle({\n        ...options,\n        radius: 100,\n      });\n    } else if (shape.name === 'ellipse') {\n      fabricShape = new fabric.Ellipse({\n        ...options,\n        rx: 100,\n        ry: 50,\n      });\n    } else if (shape.type === 'Path') {\n      fabricShape = new fabric.Path((options as PathOptions).path, {\n        // @ts-ignore\n        displayName: shape.name,\n        ...options,\n      });\n    } else {\n      const shapeType = shape.type as 'Circle' | 'Rect';\n      fabricShape = new fabric[shapeType]({\n        ...options,\n        width: 150,\n        height: 150,\n      });\n    }\n\n    this.addAndPositionShape(fabricShape, ObjectName.Shape, {width, height});\n    return fabricShape;\n  }\n\n  addSticker(categoryName: string, name: number | string): Promise<void> {\n    const category = state().config.tools?.stickers?.items?.find(\n      cat => cat.name === categoryName\n    );\n    if (!category) return Promise.resolve();\n    if (category.type === 'svg') {\n      const url = stickerUrl(category, name);\n      return this.addSvgSticker(url);\n    }\n    return this.addRegularSticker(category, name);\n  }\n\n  private addRegularSticker(\n    category: StickerCategory,\n    name: number | string\n  ): Promise<void> {\n    return new Promise(resolve => {\n      fabric.util.loadImage(stickerUrl(category, name), img => {\n        const {width, height, ...userConfig} =\n          state().config.objectDefaults?.sticker || {};\n        const sticker = new fabric.Image(img, userConfig);\n        this.addAndPositionShape(sticker, ObjectName.Sticker, {width, height});\n        resolve();\n      });\n    });\n  }\n\n  addSvgSticker(\n    url: string,\n    objectName: ObjectName = ObjectName.Sticker\n  ): Promise<void> {\n    return new Promise(resolve => {\n      fabric.loadSVGFromURL(url, (objects, options) => {\n        const {width, height, ...userConfig} =\n          state().config.objectDefaults?.sticker || {};\n        const sticker = fabric.util.groupSVGElements(objects, options);\n        sticker.set(userConfig);\n        this.addAndPositionShape(sticker, objectName, {width, height});\n        resolve();\n      });\n    });\n  }\n\n  private addAndPositionShape(\n    shape: Object,\n    objectName: ObjectName,\n    {width}: {width?: number; height?: number}\n  ) {\n    shape.name = objectName;\n    shape.scaleX = 1;\n    shape.scaleY = 1;\n    fabricCanvas().add(shape);\n\n    const newWidth = width || (state().original.width * state().zoom) / 4;\n    shape.scaleToWidth(Math.min(150, newWidth));\n\n    shape.viewportCenter();\n    shape.setCoords();\n    tools().canvas.render();\n    fabricCanvas().setActiveObject(shape);\n  }\n}\n\nexport function stickerUrl(\n  category: StickerCategory,\n  stickerName: number | string\n): string {\n  return assetUrl(\n    `images/stickers/${category.name}/${stickerName}.${category.type}`\n  );\n}\n","import {fabric} from 'fabric';\nimport {IImageOptions, Image, StaticCanvas} from 'fabric/fabric-impl';\nimport {ActiveFrame, ActiveFrameParts} from './active-frame';\nimport {Frame} from './frame';\nimport {staticObjectConfig} from '../../objects/static-object-config';\nimport {fabricCanvas, state, tools} from '../../state/utils';\nimport {assetUrl} from '../../utils/asset-url';\n\ninterface FramePatternPart {\n  name: keyof ActiveFrameParts;\n  img: Image;\n  canvas: StaticCanvas;\n}\n\nexport class FramePatterns {\n  patternCache: FramePatternPart[] = [];\n\n  constructor(private activeFrame: ActiveFrame) {}\n\n  /**\n   * Fill frame part objects with matching pattern images.\n   */\n  private fillParts(mode: 'stretch' | 'repeat' | 'basic') {\n    this.patternCache.forEach(part => {\n      this.fillPartWithPattern(part, mode);\n    });\n  }\n\n  /**\n   * Fill specified frame part with matching pattern.\n   */\n  private fillPartWithPattern(\n    part: FramePatternPart,\n    mode: 'stretch' | 'repeat' | 'basic'\n  ) {\n    if (!this.activeFrame.parts) return;\n    part.canvas = new fabric.StaticCanvas(null);\n    part.canvas.add(part.img);\n\n    const pattern = new fabric.Pattern({\n      source: part.canvas.getElement() as any,\n      repeat: mode === 'repeat' ? 'repeat' : 'no-repeat',\n    });\n\n    if (this.activeFrame.parts[part.name]) {\n      this.activeFrame.parts[part.name].set('fill', pattern);\n    }\n  }\n\n  /**\n   * Scale all frame patterns to fill their container rect objects.\n   */\n  public scale(value: number) {\n    if (!this.activeFrame.config || !this.patternCache) {\n      return;\n    }\n\n    const mode = this.activeFrame.config.mode;\n\n    // @ts-ignore\n    value /= fabricCanvas().getRetinaScaling();\n\n    this.patternCache.forEach(part => {\n      if (!this.activeFrame.parts) return;\n      // scale or repeat top and bottom sides\n      if (part.name === 'top' || part.name === 'bottom') {\n        if (mode === 'stretch') {\n          this.scalePatternToWidth(\n            part.img,\n            this.activeFrame.parts.top.getScaledWidth()\n          ); // minus width of left and right corners\n          this.scalePatternToHeight(part.img, value);\n        } else {\n          part.img.scaleToHeight(value);\n        }\n\n        // scale or repeat left and right sides\n      } else if (part.name === 'left' || part.name === 'right') {\n        if (mode === 'stretch') {\n          this.scalePatternToWidth(part.img, value);\n          this.scalePatternToHeight(\n            part.img,\n            this.activeFrame.parts.left.getScaledHeight()\n          ); // minus width of left and right corners\n        } else {\n          part.img.scaleToWidth(value);\n        }\n\n        // scale corners\n      } else if (mode === 'stretch') {\n        this.scalePatternToWidth(part.img, value);\n        this.scalePatternToHeight(part.img, value); // minus width of left and right corners\n      } else {\n        part.img.scaleToWidth(value);\n      }\n      part.canvas.setDimensions({\n        width: part.img.getScaledWidth(),\n        height: part.img.getScaledHeight(),\n      });\n    });\n    tools().canvas.render();\n  }\n\n  /**\n   * Scale pattern image to specified width.\n   */\n  private scalePatternToWidth(pattern: Image, value: number) {\n    if (!pattern.width) return;\n    const boundingRectFactor =\n      pattern.getBoundingRect().width / pattern.getScaledWidth();\n    pattern.set('scaleX', value / pattern.width / boundingRectFactor);\n    pattern.setCoords();\n  }\n\n  /**\n   * Scale pattern image to specified height.\n   */\n  private scalePatternToHeight(pattern: Image, value: number) {\n    if (!pattern.height) return;\n    const boundingRectFactor =\n      pattern.getBoundingRect().height / pattern.getScaledHeight();\n    pattern.set('scaleY', value / pattern.height / boundingRectFactor);\n    pattern.setCoords();\n  }\n\n  /**\n   * Load all images needed to build specified frame.\n   */\n  public load(frame: Frame) {\n    const promises = this.activeFrame.getPartNames().map(part => {\n      return new Promise(resolve => {\n        const config = {\n          ...staticObjectConfig,\n          originX: 'left',\n          originY: 'top',\n        } as IImageOptions;\n        if (state().config.crossOrigin) {\n          config.crossOrigin = 'anonymous';\n        }\n        fabric.Image.fromURL(\n          this.getPartUrl(frame, part),\n          img => {\n            resolve({name: part, img});\n          },\n          config\n        );\n      });\n    });\n\n    return Promise.all(promises).then(images => {\n      this.patternCache = images as any;\n      this.fillParts(frame.mode);\n    });\n  }\n\n  private getPartUrl(frame: Frame, part: string): string {\n    return assetUrl(`images/frames/${frame.name}/${part}.png`);\n  }\n}\n","import {fabric} from 'fabric';\nimport {ActiveFrame, ActiveFrameParts} from './active-frame';\nimport {FramePatterns} from './frame-patterns';\nimport {Frame} from './frame';\nimport {staticObjectConfig} from '../../objects/static-object-config';\nimport {fabricCanvas, state, tools} from '../../state/utils';\n\nexport class FrameBuilder {\n  get defaultColor(): string | undefined {\n    return state().config.objectDefaults?.global?.fill;\n  }\n\n  constructor(\n    private activeFrame: ActiveFrame,\n    private patterns: FramePatterns\n  ) {}\n\n  /**\n   * Build a new canvas frame group.\n   */\n  build(frame: Frame, size: number): void {\n    this.createParts(frame);\n    this.resize(size);\n    this.activeFrame.config = frame;\n\n    // basic frame has no pattern fill\n    if (frame.mode === 'basic') {\n      tools().canvas.render();\n      return;\n    }\n\n    this.patterns.load(frame).then(() => {\n      this.patterns.scale(size);\n      tools().canvas.render();\n    });\n  }\n\n  /**\n   * Create rect object for each frame part.\n   */\n  private createParts(frame: Frame) {\n    const parts: ActiveFrameParts = {} as ActiveFrameParts;\n    this.activeFrame.getPartNames().forEach(partName => {\n      const fill = frame.mode === 'basic' ? this.defaultColor : undefined;\n      parts[partName] = new fabric.Rect({\n        ...staticObjectConfig,\n        fill,\n        originX: 'left',\n        originY: 'top',\n        name: `frame.rect.${partName}`,\n        objectCaching: false, // patterns are not redrawn correctly when resizing frame without this\n        data: {pixieInternal: true},\n      });\n      fabricCanvas().add(parts[partName]);\n    });\n    this.activeFrame.parts = parts;\n  }\n\n  /**\n   * Position and resize all frame parts.\n   */\n  resize(value: number) {\n    const fullWidth = state().original.width;\n    const fullHeight = state().original.height;\n    const frame = this.activeFrame;\n    const cornerSize = value;\n\n    if (!frame.parts) return;\n\n    frame.parts.topLeft.set({\n      width: cornerSize,\n      height: cornerSize,\n    });\n\n    frame.parts.topRight.set({\n      left: fullWidth - frame.parts.topLeft.getScaledWidth(),\n      width: cornerSize,\n      height: cornerSize,\n    });\n\n    frame.parts.top.set({\n      left: frame.parts.topLeft.getScaledWidth() - 1,\n      width:\n        fullWidth -\n        frame.parts.topLeft.getScaledWidth() -\n        frame.parts.topRight.getScaledWidth() +\n        3,\n      height: cornerSize,\n    });\n\n    frame.parts.bottomLeft.set({\n      top: fullHeight - frame.parts.topLeft.getScaledHeight(),\n      width: cornerSize,\n      height: cornerSize,\n    });\n\n    frame.parts.left.set({\n      top: frame.parts.topLeft.getScaledHeight() - 1,\n      width: cornerSize,\n      height:\n        fullHeight -\n        frame.parts.topLeft.getScaledHeight() -\n        frame.parts.bottomLeft.getScaledHeight() +\n        3,\n    });\n\n    frame.parts.bottomRight.set({\n      left: fullWidth - frame.parts.bottomLeft.getScaledWidth(),\n      top: fullHeight - frame.parts.topRight.getScaledWidth(),\n      width: cornerSize,\n      height: cornerSize,\n    });\n\n    frame.parts.bottom.set({\n      left: frame.parts.top.left,\n      top: fullHeight - frame.parts.top.getScaledHeight(),\n      width: frame.parts.top.getScaledWidth(),\n      height: cornerSize,\n    });\n\n    frame.parts.right.set({\n      left: fullWidth - frame.parts.left.getScaledWidth(),\n      top: frame.parts.left.top,\n      width: frame.parts.left.width,\n      height: frame.parts.left.getScaledHeight(),\n    });\n  }\n}\n","import {Rect} from 'fabric/fabric-impl';\nimport {Frame} from './frame';\nimport {fabricCanvas, tools} from '../../state/utils';\n\nexport interface ActiveFrameParts {\n  topLeft: Rect;\n  top: Rect;\n  topRight: Rect;\n  right: Rect;\n  bottomRight: Rect;\n  bottom: Rect;\n  bottomLeft: Rect;\n  left: Rect;\n}\n\nexport class ActiveFrame {\n  /**\n   * List of frame corner names.\n   */\n  readonly corners = [\n    'topLeft',\n    'topRight',\n    'bottomLeft',\n    'bottomRight',\n  ] as const;\n\n  /**\n   * List of frame side names.\n   */\n  readonly sides = ['top', 'right', 'bottom', 'left'] as const;\n\n  parts: ActiveFrameParts | null = null;\n\n  /**\n   * Configuration for currently active frame.\n   */\n  config: Frame | null = null;\n\n  /**\n   * Current size of frame in percents relative to canvas size.\n   */\n  currentSizeInPercent: number = 100;\n\n  getPartNames() {\n    return [...this.corners, ...this.sides];\n  }\n\n  hide() {\n    if (!this.parts) return;\n    Object.values(this.parts).forEach(part => part.set({visible: false}));\n    tools().canvas.render();\n  }\n\n  show() {\n    if (!this.parts) return;\n    Object.values(this.parts).forEach(part => part.set({visible: true}));\n    tools().canvas.render();\n  }\n\n  /**\n   * Remove currently active frame.\n   */\n  remove() {\n    if (!this.parts) return;\n\n    // delete all fabric object references\n    this.config = null;\n    Object.values(this.parts).forEach(part => {\n      fabricCanvas().remove(part);\n    });\n    this.parts = null;\n    tools().canvas.render();\n  }\n\n  /**\n   * Check if specified frame is active.\n   */\n  is(frame: Frame): boolean {\n    if (!this.config) return false;\n    return this.config.name === frame.name;\n  }\n\n  /**\n   * Change color of basic frame.\n   */\n  changeColor(value: string) {\n    if (this.config?.mode !== 'basic' || !this.parts) return;\n\n    Object.values(this.parts).forEach(part => {\n      part.set('fill', value);\n    });\n\n    tools().canvas.render();\n  }\n\n  getMinSize(): number {\n    return this.config?.size.min ?? 1;\n  }\n\n  getMaxSize(): number {\n    return this.config?.size.max ?? 35;\n  }\n}\n","import {Frame} from './frame';\nimport {FramePatterns} from './frame-patterns';\nimport {FrameBuilder} from './frame-builder';\nimport {ActiveFrame} from './active-frame';\nimport {fabricCanvas, state, tools} from '../../state/utils';\n\nexport class FrameTool {\n  private readonly patterns: FramePatterns;\n  builder: FrameBuilder;\n  active: ActiveFrame;\n\n  constructor() {\n    this.active = new ActiveFrame();\n    this.patterns = new FramePatterns(this.active);\n    this.builder = new FrameBuilder(this.active, this.patterns);\n    fabricCanvas().on('object:added', () => {\n      Object.values(this.active.parts || []).forEach(part => part.moveTo(98));\n    });\n  }\n\n  /**\n   * Add a new frame to canvas.\n   */\n  add(frameName: string, sizePercent?: number) {\n    const frame = this.getByName(frameName);\n    if (!frame || this.active.is(frame)) return;\n\n    this.active.remove();\n\n    this.active.currentSizeInPercent = sizePercent ?? frame.size.default;\n    const size = this.calcFrameSizeInPixels(this.active.currentSizeInPercent);\n    this.builder.build(frame, size);\n    state().frame.select(frame);\n  }\n\n  /**\n   * Resize active frame to specified percentage relative to canvas size.\n   */\n  resize(percentage?: number) {\n    if (!this.active.parts || !this.active.config) return;\n    if (!percentage) {\n      percentage = this.active.currentSizeInPercent;\n    } else {\n      this.active.currentSizeInPercent = percentage;\n    }\n    const size = this.calcFrameSizeInPixels(percentage);\n    this.builder.resize(size);\n    this.patterns.scale(size);\n    tools().canvas.render();\n  }\n\n  /**\n   * Change color of currently active frame. Only works for \"basic\" frame.\n   */\n  changeColor(value: string) {\n    this.active.changeColor(value);\n  }\n\n  /**\n   * Remove currently active frame.\n   */\n  remove() {\n    this.active.remove();\n    state().frame.deselect();\n  }\n\n  /**\n   * Get frame by specified name.\n   */\n  getByName(frameName: string): Frame | undefined {\n    const items = state().config.tools?.frame?.items;\n    if (items) {\n      return items.find(frame => frame.name === frameName);\n    }\n  }\n\n  /**\n   * @hidden\n   */\n  getActiveFrameConfig(): Frame | null {\n    return this.active.config;\n  }\n\n  /**\n   * Calculate frame size in pixels based on specified percentage relative to canvas size.\n   */\n  private calcFrameSizeInPixels(percentage: number) {\n    const min = Math.min(state().original.width, state().original.height);\n    return Math.ceil((percentage / 100) * min);\n  }\n}\n","import {fabric} from 'fabric';\n\nexport const VLineBrush = (canvas: fabric.Canvas) => {\n  const vLinePatternBrush = new (fabric.PatternBrush as any)(canvas);\n  vLinePatternBrush.getPatternSrc = function VLineBrushSrc() {\n    const patternCanvas = (fabric as any).document.createElement('canvas');\n    patternCanvas.width = 10;\n    patternCanvas.height = 10;\n    const ctx = patternCanvas.getContext('2d');\n\n    ctx.strokeStyle = this.color;\n    ctx.lineWidth = 5;\n    ctx.beginPath();\n    ctx.moveTo(0, 5);\n    ctx.lineTo(10, 5);\n    ctx.closePath();\n    ctx.stroke();\n\n    return patternCanvas;\n  };\n  return vLinePatternBrush;\n};\n","import {fabric} from 'fabric';\n\nexport const HLineBrush = (canvas: fabric.Canvas) => {\n  const hLinePatternBrush = new (fabric.PatternBrush as any)(canvas);\n  hLinePatternBrush.getPatternSrc = function HLineBrushSrc() {\n    const patternCanvas = document.createElement('canvas');\n    patternCanvas.width = 10;\n    patternCanvas.height = 10;\n    const ctx = patternCanvas.getContext('2d')!;\n\n    ctx.strokeStyle = this.color;\n    ctx.lineWidth = 5;\n    ctx.beginPath();\n    ctx.moveTo(5, 0);\n    ctx.lineTo(5, 10);\n    ctx.closePath();\n    ctx.stroke();\n\n    return patternCanvas;\n  };\n\n  return hLinePatternBrush;\n};\n","import {fabric} from 'fabric';\n\nexport const DiamondBrush = (canvas: fabric.Canvas) => {\n  const diamondBrush = new (fabric.PatternBrush as any)(canvas);\n\n  diamondBrush.getPatternSrc = function DiamondBrushSrc() {\n    const squareWidth = this.width / 2;\n    const squareDistance = 5;\n    const patternCanvas = document.createElement('canvas');\n\n    // noinspection JSSuspiciousNameCombination\n    const rect = new fabric.Rect({\n      width: squareWidth,\n      height: squareWidth,\n      angle: 45,\n      fill: this.color,\n    });\n\n    const canvasWidth = rect.getBoundingRect().width;\n\n    patternCanvas.width = canvasWidth + squareDistance;\n    patternCanvas.height = canvasWidth + squareDistance;\n    rect.set({left: canvasWidth / 2, top: canvasWidth / 2});\n\n    const ctx = patternCanvas.getContext('2d');\n    rect.render(ctx!);\n\n    return patternCanvas;\n  };\n\n  return diamondBrush;\n};\n","import {fabric} from 'fabric';\n\nexport const SquareBrush = (canvas: fabric.Canvas) => {\n  const squareBrush = new (fabric.PatternBrush as any)(canvas);\n\n  squareBrush.getPatternSrc = function SquareBrushSrc() {\n    const squareWidth = 10;\n    const squareDistance = 2;\n\n    const patternCanvas = document.createElement('canvas');\n    patternCanvas.width = squareWidth + squareDistance;\n    patternCanvas.height = squareWidth + squareDistance;\n    const ctx = patternCanvas.getContext('2d')!;\n\n    ctx.fillStyle = this.color;\n    ctx.fillRect(0, 0, squareWidth, squareWidth);\n\n    return patternCanvas;\n  };\n\n  return squareBrush;\n};\n","import {fabric} from 'fabric';\nimport {Path} from 'fabric/fabric-impl';\nimport {VLineBrush} from './brushes/v-line-brush';\nimport {HLineBrush} from './brushes/h-line-brush';\nimport {DiamondBrush} from './brushes/diamond-brush';\nimport {SquareBrush} from './brushes/square-brush';\nimport {BrushSizes} from './draw-defaults';\nimport {ObjectName} from '../../objects/object-name';\nimport {staticObjectConfig} from '../../objects/static-object-config';\nimport {fabricCanvas, state} from '../../state/utils';\n\nexport class DrawTool {\n  private customBrushes = {\n    VLineBrush,\n    HLineBrush,\n    DiamondBrush,\n    SquareBrush,\n  } as const;\n  currentBrush = {\n    type: 'PencilBrush',\n    color: state().config.objectDefaults?.global?.fill,\n    width: BrushSizes[1],\n  };\n\n  onPathCreated = (e: {path: Path}) => {\n    e.path.name = ObjectName.Drawing;\n    e.path.set(getPathConfig());\n    state().setDirty(true);\n  };\n\n  /**\n   * Enable drawing mode on canvas.\n   */\n  enable() {\n    fabricCanvas().on('path:created', this.onPathCreated as any);\n    fabricCanvas().isDrawingMode = true;\n    this.setBrushType(this.currentBrush.type);\n    this.setBrushSize(this.currentBrush.width);\n  }\n\n  /**\n   * Disable drawing mode on canvas.\n   */\n  disable() {\n    fabricCanvas().off('path:created', this.onPathCreated as any);\n    fabricCanvas().isDrawingMode = false;\n  }\n\n  getBrushType(): string {\n    return this.currentBrush.type;\n  }\n\n  setBrushType(type: string) {\n    this.currentBrush.type = type;\n    fabricCanvas().freeDrawingBrush =\n      type in fabric\n        ? // @ts-ignore\n          new fabric[type](fabricCanvas())\n        : // @ts-ignore\n          this.customBrushes[type](fabricCanvas());\n    this.applyBrushStyles();\n  }\n\n  /**\n   * Apply current brush styles to fabric.js FreeDrawingBrush instance.\n   */\n  private applyBrushStyles() {\n    Object.keys(this.currentBrush).forEach(key => {\n      // @ts-ignore\n      fabricCanvas().freeDrawingBrush[key] = this.currentBrush[key];\n    });\n    const brush = fabricCanvas().freeDrawingBrush as any;\n    if (brush.getPatternSrc) {\n      brush.source = brush.getPatternSrc.call(brush);\n    }\n  }\n\n  setBrushSize(size: number) {\n    this.currentBrush.width = size;\n    this.applyBrushStyles();\n  }\n\n  getBrushSize(): number {\n    return this.currentBrush.width;\n  }\n\n  /**\n   * Change color of drawing brush.\n   */\n  setBrushColor(color: string) {\n    this.currentBrush.color = color;\n    this.applyBrushStyles();\n  }\n\n  /**\n   * Get color of drawing brush.\n   */\n  getBrushColor(): string | undefined {\n    return this.currentBrush.color;\n  }\n}\n\nfunction getPathConfig() {\n  const staticObjConfig = {...staticObjectConfig};\n  delete staticObjConfig.strokeWidth;\n  return staticObjConfig;\n}\n","export function extensionFromFilename(fullFileName: string): string {\n  const re = /(?:\\.([^.]+))?$/;\n  return re.exec(fullFileName)?.[1] || '';\n}\n","import {extensionFromFilename} from './extension-from-filename';\n\nexport function getFileMime(file: File): string {\n  const extensionsToMime: Record<string, string> = {\n    md: 'text/markdown',\n    markdown: 'text/markdown',\n    mp4: 'video/mp4',\n    mp3: 'audio/mp3',\n    svg: 'image/svg+xml',\n    jpg: 'image/jpeg',\n    png: 'image/png',\n    gif: 'image/gif',\n    yaml: 'text/yaml',\n    yml: 'text/yaml',\n  };\n\n  const fileExtension = file.name ? extensionFromFilename(file.name) : null;\n\n  // check if mime type is set in the file object\n  if (file.type) {\n    return file.type;\n  }\n\n  // see if we can map extension to a mime type\n  if (fileExtension && fileExtension in extensionsToMime) {\n    return extensionsToMime[fileExtension];\n  }\n\n  return 'application/octet-stream';\n}\n","// store this in a separate file, to avoid importing query client and axios in pixie\n\nlet activeWorkspaceId = 0;\n\n// for access outside react\nexport function getActiveWorkspaceId() {\n  return activeWorkspaceId;\n}\n\nexport function setActiveWorkspaceId(id: number) {\n  activeWorkspaceId = id;\n}\n","import {getFileMime} from './utils/get-file-mime';\nimport {extensionFromFilename} from './utils/extension-from-filename';\nimport {nanoid} from 'nanoid';\nimport {getActiveWorkspaceId} from '../workspace/active-workspace-id';\n\nexport class UploadedFile {\n  id: string;\n  fingerprint: string;\n  name: string;\n  relativePath = '';\n  size: number;\n  mime = '';\n  extension = '';\n  native: File;\n  lastModified: number;\n\n  private cachedData?: string;\n  get data(): Promise<string> {\n    return new Promise(resolve => {\n      if (this.cachedData) {\n        resolve(this.cachedData);\n      }\n      const reader = new FileReader();\n\n      reader.addEventListener('load', () => {\n        this.cachedData = reader.result as string;\n        resolve(this.cachedData);\n      });\n\n      if (this.extension === 'json') {\n        reader.readAsText(this.native);\n      } else {\n        reader.readAsDataURL(this.native);\n      }\n    });\n  }\n\n  constructor(file: File, relativePath?: string | null) {\n    this.id = nanoid();\n    this.name = file.name;\n    this.size = file.size;\n    this.mime = getFileMime(file);\n    this.lastModified = file.lastModified;\n    this.extension = extensionFromFilename(file.name) || 'bin';\n    this.native = file;\n    relativePath = relativePath || file.webkitRelativePath || '';\n\n    // remove leading slashes\n    relativePath = relativePath.replace(/^\\/+/g, '');\n\n    // only include relative path if file is actually in a folder and not just /file.txt\n    if (relativePath && relativePath.split('/').length > 1) {\n      this.relativePath = relativePath;\n    }\n\n    this.fingerprint = generateId({\n      name: this.name,\n      size: this.size,\n      mime: this.mime,\n      lastModified: this.lastModified,\n    });\n  }\n}\n\ninterface FileMeta {\n  name?: string;\n  mime?: string | null;\n  size?: number | string;\n  lastModified?: number;\n  relativePath?: string;\n}\nfunction generateId({name, mime, size, relativePath, lastModified}: FileMeta) {\n  let id = 'be';\n  if (typeof name === 'string') {\n    id += `-${encodeFilename(name.toLowerCase())}`;\n  }\n\n  if (mime) {\n    id += `-${mime}`;\n  }\n\n  if (typeof relativePath === 'string') {\n    id += `-${encodeFilename(relativePath.toLowerCase())}`;\n  }\n\n  if (size !== undefined) {\n    id += `-${size}`;\n  }\n  if (lastModified !== undefined) {\n    id += `-${lastModified}`;\n  }\n\n  id += `${getActiveWorkspaceId()}`;\n\n  // add version number, so it can be incremented easily to allow uploading same file multiple times\n  return `${id}-v1`;\n}\n\nfunction encodeCharacter(character: string) {\n  return character.charCodeAt(0).toString(32);\n}\n\nfunction encodeFilename(name: string) {\n  let suffix = '';\n  return (\n    name.replace(/[^A-Z0-9]/gi, character => {\n      suffix += `-${encodeCharacter(character)}`;\n      return '/';\n    }) + suffix\n  );\n}\n","import {UploadInputConfig} from '../types/upload-input-config';\n\nexport function createUploadInput(\n  config: UploadInputConfig = {}\n): HTMLInputElement {\n  const old = document.querySelector('#hidden-file-upload-input');\n  if (old) old.remove();\n\n  const input = document.createElement('input');\n  input.type = 'file';\n  input.multiple = config.multiple ?? false;\n  input.classList.add('hidden');\n  input.style.display = 'none';\n  input.style.visibility = 'hidden';\n  input.id = 'hidden-file-upload-input';\n\n  input.accept = buildUploadInputAccept(config);\n\n  if (config.directory) {\n    input.webkitdirectory = true;\n  }\n\n  document.body.appendChild(input);\n\n  return input;\n}\n\nexport interface UploadAccentProps {\n  extensions?: string[];\n  types?: string[];\n}\nexport function buildUploadInputAccept({\n  extensions = [],\n  types = [],\n}: UploadAccentProps): string {\n  const accept = [];\n  if (extensions?.length) {\n    extensions = extensions.map(e => {\n      return e.startsWith('.') ? e : `.${e}`;\n    });\n    accept.push(extensions.join(','));\n  }\n\n  if (types?.length) {\n    accept.push(types.join(','));\n  }\n\n  return accept.join(',');\n}\n","import {UploadInputConfig} from '../types/upload-input-config';\nimport {UploadedFile} from '../uploaded-file';\nimport {createUploadInput} from './create-upload-input';\n\n/**\n * Open browser dialog for uploading files and\n * resolve promise with uploaded files.\n */\nexport function openUploadWindow(\n  config: UploadInputConfig = {}\n): Promise<UploadedFile[]> {\n  return new Promise(resolve => {\n    const input = createUploadInput(config);\n\n    input.onchange = e => {\n      const fileList = (e.target as HTMLInputElement).files;\n      if (!fileList) {\n        return resolve([]);\n      }\n\n      const uploads = Array.from(fileList)\n        .filter(f => f.name !== '.DS_Store')\n        .map(file => new UploadedFile(file));\n      resolve(uploads);\n      input.remove();\n    };\n\n    document.body.appendChild(input);\n    input.click();\n  });\n}\n","import {Image} from 'fabric/fabric-impl';\nimport {loadFabricImage} from './load-fabric-image';\nimport {ObjectName} from '../../objects/object-name';\nimport {state, tools} from '../../state/utils';\n\nexport async function addImage(\n  url: string,\n  fitToScreen = true\n): Promise<Image | undefined> {\n  const img = await loadFabricImage(url);\n  if (!img) return;\n  return new Promise(resolve => {\n    img.name = ObjectName.Image;\n    img.opacity = 0;\n\n    // use either main image or canvas dimensions as outer boundaries for scaling new image\n    const maxWidth = state().original.width;\n    const maxHeight = state().original.height;\n\n    // if image is wider or higher than the current canvas, we'll scale it down\n    if (fitToScreen && (img.width! >= maxWidth || img.height! >= maxHeight)) {\n      // calc new image dimensions (main image height - 10% and width - 10%)\n      const newWidth = maxWidth - 0.1 * maxWidth;\n      const newHeight = maxHeight - 0.1 * maxHeight;\n      const scale =\n        1 /\n        Math.min(\n          newHeight / img.getScaledHeight(),\n          newWidth / img.getScaledWidth()\n        );\n\n      // scale newly uploaded image to the above dimensions\n      img.scaleX! *= 1 / scale;\n      img.scaleY! *= 1 / scale;\n    }\n\n    // center and render newly uploaded image on the canvas\n    state().fabric.add(img);\n    state().fabric.setActiveObject(img);\n    img.viewportCenter();\n    img.setCoords();\n    state().fabric.requestRenderAll();\n    tools().zoom.fitToScreen();\n\n    img.animate('opacity', '1', {\n      duration: 425,\n      onChange: () => {\n        state().fabric.requestRenderAll();\n      },\n      onComplete: () => {\n        resolve(img);\n      },\n    });\n  });\n}\n","export interface UploadInputConfig {\n  types?: (UploadInputType | string)[];\n  extensions?: string[];\n  multiple?: boolean;\n  directory?: boolean;\n}\n\nexport enum UploadInputType {\n  image = 'image/*',\n  audio = 'audio/*',\n  json = 'application/json',\n  video = 'video/mp4,video/mpeg,video/x-m4v,video/*',\n}\n","// Adapted from https://github.com/Flet/prettier-bytes/\n// Changing 1000 bytes to 1024, so we can keep uppercase KB vs kB\n// ISC License (c) Dan Flettre https://github.com/Flet/prettier-bytes/blob/master/LICENSE\nexport function prettyBytes(num?: number): string {\n  if (num == null || Number.isNaN(num)) return '';\n  const neg = num < 0;\n  const units = ['B', 'KB', 'MB', 'GB', 'TB', 'PB', 'EB', 'ZB', 'YB'];\n\n  if (neg) {\n    num = -num;\n  }\n\n  if (num < 1) {\n    return `${(neg ? '-' : '') + num} B`;\n  }\n\n  const exponent = Math.min(\n    Math.floor(Math.log(num) / Math.log(1024)),\n    units.length - 1\n  );\n  num = Number(num / Math.pow(1024, exponent));\n  const unit = units[exponent];\n\n  if (num >= 10 || num % 1 === 0) {\n    // Do not show decimals when the number is two-digit, or if the number has no\n    // decimal component.\n    return `${(neg ? '-' : '') + num.toFixed(0)} ${unit}`;\n  }\n  return `${(neg ? '-' : '') + num.toFixed(1)} ${unit}`;\n}\n","/* jshint node: true */\n'use strict';\n\n/**\n  # wildcard\n\n  Very simple wildcard matching, which is designed to provide the same\n  functionality that is found in the\n  [eve](https://github.com/adobe-webplatform/eve) eventing library.\n\n  ## Usage\n\n  It works with strings:\n\n  <<< examples/strings.js\n\n  Arrays:\n\n  <<< examples/arrays.js\n\n  Objects (matching against keys):\n\n  <<< examples/objects.js\n\n  While the library works in Node, if you are are looking for file-based\n  wildcard matching then you should have a look at:\n\n  <https://github.com/isaacs/node-glob>\n**/\n\nfunction WildcardMatcher(text, separator) {\n  this.text = text = text || '';\n  this.hasWild = ~text.indexOf('*');\n  this.separator = separator;\n  this.parts = text.split(separator);\n}\n\nWildcardMatcher.prototype.match = function(input) {\n  var matches = true;\n  var parts = this.parts;\n  var ii;\n  var partsCount = parts.length;\n  var testParts;\n\n  if (typeof input == 'string' || input instanceof String) {\n    if (!this.hasWild && this.text != input) {\n      matches = false;\n    } else {\n      testParts = (input || '').split(this.separator);\n      for (ii = 0; matches && ii < partsCount; ii++) {\n        if (parts[ii] === '*')  {\n          continue;\n        } else if (ii < testParts.length) {\n          matches = parts[ii] === testParts[ii];\n        } else {\n          matches = false;\n        }\n      }\n\n      // If matches, then return the component parts\n      matches = matches && testParts;\n    }\n  }\n  else if (typeof input.splice == 'function') {\n    matches = [];\n\n    for (ii = input.length; ii--; ) {\n      if (this.match(input[ii])) {\n        matches[matches.length] = input[ii];\n      }\n    }\n  }\n  else if (typeof input == 'object') {\n    matches = {};\n\n    for (var key in input) {\n      if (this.match(key)) {\n        matches[key] = input[key];\n      }\n    }\n  }\n\n  return matches;\n};\n\nmodule.exports = function(text, test, separator) {\n  var matcher = new WildcardMatcher(text, separator || /[\\/\\.]/);\n  if (typeof test != 'undefined') {\n    return matcher.match(test);\n  }\n\n  return matcher;\n};\n","var wildcard = require('wildcard');\nvar reMimePartSplit = /[\\/\\+\\.]/;\n\n/**\n  # mime-match\n\n  A simple function to checker whether a target mime type matches a mime-type\n  pattern (e.g. image/jpeg matches image/jpeg OR image/*).\n\n  ## Example Usage\n\n  <<< example.js\n\n**/\nmodule.exports = function(target, pattern) {\n  function test(pattern) {\n    var result = wildcard(pattern, target, reMimePartSplit);\n\n    // ensure that we have a valid mime type (should have two parts)\n    return result && result.length >= 2;\n  }\n\n  return pattern ? test(pattern.split(';')[0]) : test;\n};\n","import {UploadedFile} from '../uploaded-file';\nimport {message} from '../../i18n/message';\nimport {prettyBytes} from '../utils/pretty-bytes';\nimport {MessageDescriptor} from '../../i18n/message-descriptor';\nimport match from 'mime-match';\n\nexport interface Restrictions {\n  maxFileSize?: number;\n  allowedFileTypes?: string[];\n  blockedFileTypes?: string[];\n}\n\nexport function validateUpload(\n  file: UploadedFile,\n  restrictions?: Restrictions\n): MessageDescriptor | void {\n  if (!restrictions) return;\n\n  const {maxFileSize, allowedFileTypes, blockedFileTypes} = restrictions;\n\n  if (maxFileSize && file.size != null && file.size > maxFileSize) {\n    return message('`:file` exceeds maximum allowed size of :size', {\n      values: {file: file.name, size: prettyBytes(maxFileSize)},\n    });\n  }\n\n  if (allowedFileTypes?.length) {\n    if (!fileMatchesTypes(file, allowedFileTypes)) {\n      return message('This file type is not allowed');\n    }\n  }\n\n  if (blockedFileTypes?.length) {\n    if (fileMatchesTypes(file, blockedFileTypes)) {\n      return message('This file type is not allowed');\n    }\n  }\n}\n\nfunction fileMatchesTypes(file: UploadedFile, types: string[]): boolean {\n  return types.some(type => {\n    // check if this is a mime-type\n    if (type.includes('/')) {\n      if (!file.mime) return false;\n      return match(file.mime.replace(/;.*?$/, ''), type);\n    }\n\n    // otherwise this is likely an extension\n    if (type.replace('.', '') && file.extension) {\n      return file.extension.toLowerCase() === type.toLowerCase();\n    }\n    return false;\n  });\n}\n","export type SpaceUnit = 'KB' | 'MB' | 'GB' | 'TB' | 'PB';\n\nexport function convertToBytes(value: number, unit: SpaceUnit): number {\n  if (value == null) return 0;\n  switch (unit) {\n    case 'KB':\n      return value * 1024;\n    case 'MB':\n      return value * 1024 ** 2;\n    case 'GB':\n      return value * 1024 ** 3;\n    case 'TB':\n      return value * 1024 ** 4;\n    case 'PB':\n      return value * 1024 ** 5;\n    default:\n      return value;\n  }\n}\n","import {Image} from 'fabric/fabric-impl';\nimport {openUploadWindow} from '../../common/uploads/utils/open-upload-window';\nimport {UploadedFile} from '../../common/uploads/uploaded-file';\nimport {ObjectName} from '../../objects/object-name';\nimport {SerializedPixieState} from '../history/serialized-pixie-state';\nimport {addImage} from '../canvas/add-image';\nimport {state, tools} from '../../state/utils';\nimport {resetEditor} from '../../utils/reset-editor';\nimport {UploadAccentProps} from '../../common/uploads/utils/create-upload-input';\nimport {fetchStateJsonFromUrl} from './fetch-state-json-from-url';\nimport {UploadInputType} from '../../common/uploads/types/upload-input-config';\nimport {validateUpload} from '../../common/uploads/uploader/validate-upload';\nimport {convertToBytes} from '../../common/uploads/utils/convert-to-bytes';\nimport {toast} from '../../common/ui/toast/toast';\n\nexport class ImportTool {\n  /**\n   * Open file upload window and add selected image to canvas.\n   */\n  async uploadAndAddImage(): Promise<void> {\n    const file = await this.openUploadWindow();\n    await this.openUploadedFile(file);\n  }\n\n  /**\n   * Open file upload window and replace canvas contents with selected image.\n   */\n  async uploadAndReplaceMainImage(): Promise<void> {\n    const file = await this.openUploadWindow();\n    if (file) {\n      await this.openBackgroundImage(file);\n    }\n  }\n\n  /**\n   * Open file upload window and replace canvas contents with selected state file.\n   */\n  async uploadAndOpenStateFile(): Promise<void> {\n    const file = await this.openUploadWindow(stateContentType);\n    if (file) {\n      await this.loadState(await file.data);\n    }\n  }\n\n  /**\n   * @hidden\n   */\n  async openUploadedFile(file?: UploadedFile | null) {\n    if (!file) return;\n    const fileData = await file.data;\n    switch (file.extension) {\n      case 'json':\n        await this.loadState(fileData);\n        break;\n      case 'svg':\n        await tools().shape.addSvgSticker(fileData, ObjectName.Image);\n        tools().history.addHistoryItem({name: 'overlayImage'});\n        break;\n      default:\n        await addImage(\n          fileData,\n          state().config.tools?.import?.fitOverlayToScreen ?? true\n        );\n        tools().history.addHistoryItem({name: 'overlayImage'});\n    }\n  }\n\n  /**\n   * Replace current editor state with specified one.\n   */\n  async loadState(data: string | SerializedPixieState): Promise<void> {\n    state().toggleLoading('state');\n    await resetEditor();\n\n    let stateObj: SerializedPixieState;\n\n    if (typeof data === 'string') {\n      if (data.endsWith('.json')) {\n        stateObj = await fetchStateJsonFromUrl(data);\n      } else {\n        stateObj = JSON.parse(data);\n      }\n    } else {\n      stateObj = data;\n    }\n\n    await tools().history.addInitial(stateObj);\n    await tools().history.reload();\n    state().toggleLoading(false);\n  }\n\n  /**\n   * @hidden\n   */\n  async openUploadWindow(\n    contentTypes?: UploadAccentProps\n  ): Promise<UploadedFile | null> {\n    contentTypes = contentTypes || imgContentTypes();\n    const file = (await openUploadWindow(contentTypes))[0];\n    if (this.fileIsValid(file)) {\n      state().config.onFileOpen?.(file);\n      return file;\n    }\n    return null;\n  }\n\n  /**\n   * Open specified data or image as background image.\n   */\n  async openBackgroundImage(\n    image: UploadedFile | HTMLImageElement | string\n  ): Promise<Image | undefined> {\n    await resetEditor();\n    let src: string;\n    if (image instanceof HTMLImageElement) {\n      src = image.src;\n    } else if (image instanceof UploadedFile) {\n      src = await image.data;\n    } else {\n      src = image;\n    }\n    const response = await tools().canvas.addMainImage(src);\n    await tools().history.addInitial();\n    return response;\n  }\n\n  fileIsValid(file: UploadedFile): boolean {\n    const maxFileSize =\n      state().config.tools?.import?.maxFileSize ?? convertToBytes(10, 'MB');\n    const allowedFileTypes = [\n      ...(state().config.tools?.import?.validImgExtensions ?? []),\n      'json',\n    ];\n    const errorMessage = validateUpload(file, {maxFileSize, allowedFileTypes});\n    if (errorMessage) {\n      toast.danger(errorMessage);\n      return false;\n    }\n    return true;\n  }\n}\n\nexport function imgContentTypes(): UploadAccentProps {\n  const validExtensions = state().config.tools?.import?.validImgExtensions;\n  if (validExtensions) {\n    return {extensions: validExtensions};\n  }\n  return {types: [UploadInputType.image]};\n}\n\nexport const stateContentType: UploadAccentProps = {\n  types: ['.json', UploadInputType.json],\n};\n","import {Group} from 'fabric/fabric-impl';\nimport {fabric} from 'fabric';\nimport {staticObjectConfig} from '../../objects/static-object-config';\nimport {fabricCanvas, state, tools} from '../../state/utils';\n\nexport class WatermarkTool {\n  private watermark: Group | null = null;\n\n  private lineStyle = {\n    stroke: 'rgba(255,255,255,0.3)',\n    strokeWidth: 5,\n    strokeLineCap: 'round',\n    strokeLineJoin: 'round',\n  };\n\n  /**\n   * Add a watermark to canvas.\n   */\n  add(watermarkText: string) {\n    this.createGroup();\n    this.addText(watermarkText);\n    this.addLines();\n\n    fabricCanvas().add(this.watermark!);\n    tools().canvas.render();\n  }\n\n  /**\n   * Remove watermark from canvas.\n   */\n  remove() {\n    if (!this.watermark) return;\n    fabricCanvas().remove(this.watermark);\n    this.watermark = null;\n    tools().canvas.render();\n  }\n\n  private createGroup() {\n    this.watermark = new fabric.Group(undefined, {\n      ...staticObjectConfig,\n      width: state().original.width,\n      height: state().original.height,\n      excludeFromExport: true,\n      top: 0,\n      left: 0,\n      originX: 'left',\n      originY: 'top',\n    });\n  }\n\n  private addText(watermarkText: string) {\n    const text = new fabric.Text(watermarkText, {\n      fill: 'rgba(255,255,255,0.3)',\n      strokeWidth: 2,\n      stroke: 'rgba(255,255,255,0.4)',\n      originX: 'center',\n      originY: 'center',\n      fontWeight: 600,\n      fontSize: 150,\n      fontFamily: 'Courier New',\n    });\n\n    text.scaleToWidth(state().original.width / 2);\n    this.watermark?.add(text);\n  }\n\n  private addLines() {\n    if (!this.watermark) return;\n    const text = this.watermark?.getObjects('text')[0];\n\n    // original canvas size\n    const halfWidth = state().original.width / 2;\n    const halfHeight = state().original.height / 2;\n\n    // offset from text for watermark lines\n    const offsetY = 100;\n    const offsetX = text.width! / 4;\n\n    const line1 = new fabric.Line(undefined, this.lineStyle);\n    const line2 = new fabric.Line(undefined, this.lineStyle);\n    const line3 = new fabric.Line(undefined, this.lineStyle);\n    const line4 = new fabric.Line(undefined, this.lineStyle);\n\n    this.watermark.add(line1, line2, line3, line4);\n\n    line1.set({\n      x1: offsetX,\n      y1: -offsetY,\n      x2: halfWidth,\n      y2: -halfHeight,\n    });\n\n    line2.set({\n      x1: offsetX,\n      y1: offsetY,\n      x2: halfWidth,\n      y2: halfHeight,\n    });\n\n    line3.set({\n      x1: -offsetX,\n      y1: -offsetY,\n      x2: -halfWidth,\n      y2: -halfHeight,\n    });\n\n    line4.set({\n      x1: -offsetX,\n      y1: offsetY,\n      x2: -halfWidth,\n      y2: halfHeight,\n    });\n  }\n}\n","(function(a,b){if(\"function\"==typeof define&&define.amd)define([],b);else if(\"undefined\"!=typeof exports)b();else{b(),a.FileSaver={exports:{}}.exports}})(this,function(){\"use strict\";function b(a,b){return\"undefined\"==typeof b?b={autoBom:!1}:\"object\"!=typeof b&&(console.warn(\"Deprecated: Expected third argument to be a object\"),b={autoBom:!b}),b.autoBom&&/^\\s*(?:text\\/\\S*|application\\/xml|\\S*\\/\\S*\\+xml)\\s*;.*charset\\s*=\\s*utf-8/i.test(a.type)?new Blob([\"\\uFEFF\",a],{type:a.type}):a}function c(a,b,c){var d=new XMLHttpRequest;d.open(\"GET\",a),d.responseType=\"blob\",d.onload=function(){g(d.response,b,c)},d.onerror=function(){console.error(\"could not download file\")},d.send()}function d(a){var b=new XMLHttpRequest;b.open(\"HEAD\",a,!1);try{b.send()}catch(a){}return 200<=b.status&&299>=b.status}function e(a){try{a.dispatchEvent(new MouseEvent(\"click\"))}catch(c){var b=document.createEvent(\"MouseEvents\");b.initMouseEvent(\"click\",!0,!0,window,0,0,0,80,20,!1,!1,!1,!1,0,null),a.dispatchEvent(b)}}var f=\"object\"==typeof window&&window.window===window?window:\"object\"==typeof self&&self.self===self?self:\"object\"==typeof global&&global.global===global?global:void 0,a=f.navigator&&/Macintosh/.test(navigator.userAgent)&&/AppleWebKit/.test(navigator.userAgent)&&!/Safari/.test(navigator.userAgent),g=f.saveAs||(\"object\"!=typeof window||window!==f?function(){}:\"download\"in HTMLAnchorElement.prototype&&!a?function(b,g,h){var i=f.URL||f.webkitURL,j=document.createElement(\"a\");g=g||b.name||\"download\",j.download=g,j.rel=\"noopener\",\"string\"==typeof b?(j.href=b,j.origin===location.origin?e(j):d(j.href)?c(b,g,h):e(j,j.target=\"_blank\")):(j.href=i.createObjectURL(b),setTimeout(function(){i.revokeObjectURL(j.href)},4E4),setTimeout(function(){e(j)},0))}:\"msSaveOrOpenBlob\"in navigator?function(f,g,h){if(g=g||f.name||\"download\",\"string\"!=typeof f)navigator.msSaveOrOpenBlob(b(f,h),g);else if(d(f))c(f,g,h);else{var i=document.createElement(\"a\");i.href=f,i.target=\"_blank\",setTimeout(function(){e(i)})}}:function(b,d,e,g){if(g=g||open(\"\",\"_blank\"),g&&(g.document.title=g.document.body.innerText=\"downloading...\"),\"string\"==typeof b)return c(b,d,e);var h=\"application/octet-stream\"===b.type,i=/constructor/i.test(f.HTMLElement)||f.safari,j=/CriOS\\/[\\d]+/.test(navigator.userAgent);if((j||h&&i||a)&&\"undefined\"!=typeof FileReader){var k=new FileReader;k.onloadend=function(){var a=k.result;a=j?a:a.replace(/^data:[^;]*;/,\"data:attachment/file;\"),g?g.location.href=a:location=a,g=null},k.readAsDataURL(b)}else{var l=f.URL||f.webkitURL,m=l.createObjectURL(b);g?g.location=m:location.href=m,g=null,setTimeout(function(){l.revokeObjectURL(m)},4E4)}});f.saveAs=g.saveAs=g,\"undefined\"!=typeof module&&(module.exports=g)});\n\n//# sourceMappingURL=FileSaver.min.js.map","export function b64toBlob(\n  b64Data: string,\n  contentType?: string,\n  sliceSize?: number\n) {\n  contentType = contentType || '';\n  sliceSize = sliceSize || 512;\n\n  const byteCharacters = atob(b64Data);\n  const byteArrays = [];\n\n  for (let offset = 0; offset < byteCharacters.length; offset += sliceSize) {\n    const slice = byteCharacters.slice(offset, offset + sliceSize);\n\n    const byteNumbers = new Array(slice.length);\n    for (let i = 0; i < slice.length; i++) {\n      byteNumbers[i] = slice.charCodeAt(i);\n    }\n\n    const byteArray = new Uint8Array(byteNumbers);\n\n    byteArrays.push(byteArray);\n  }\n\n  return new Blob(byteArrays, {type: contentType});\n}\n","import {saveAs} from 'file-saver';\nimport {getCurrentCanvasState} from '../history/state/get-current-canvas-state';\nimport {fabricCanvas, state, tools} from '../../state/utils';\nimport {b64toBlob} from './b64-to-blob';\nimport {toast} from '../../common/ui/toast/toast';\nimport {message} from '../../common/i18n/message';\n\ntype ValidFormats = 'png' | 'jpeg' | 'json' | 'svg';\n\nexport class ExportTool {\n  /**\n   * Primary \"save\" function. This is called when user clicks \"Done\" button in the toolbar.\n   * It will apply watermark (if specified) and execute one of the actions below in the order of priority:\n   *\n   * 1. Send image data to url. If specified via \"saveUrl\" option in configuration.\n   * 2. Execute \"onSave\" callback function. If provided in configuration.\n   * 3. Download image or state file to user device with specified name, format and quality.\n   */\n  save(name?: string, format?: ValidFormats, quality?: number) {\n    const exportConfig = state().config.tools?.export;\n    name = name || exportConfig?.defaultName;\n    format = this.getFormat(format);\n    quality = this.getQuality(quality);\n\n    const filename = `${name}.${format}`;\n\n    this.applyWaterMark();\n\n    const data: string | null =\n      format === 'json'\n        ? this.getJsonState()\n        : this.getDataUrl(format, quality);\n\n    tools().watermark.remove();\n\n    if (!data) return;\n\n    if (state().config.saveUrl) {\n      fetch(state().config.saveUrl!, {\n        method: 'POST',\n        body: JSON.stringify({data, filename, format}),\n      });\n    } else if (state().config.onSave) {\n      state().config.onSave?.(data, filename, format);\n    } else {\n      const blob = this.getCanvasBlob(format, data);\n      saveAs(blob, filename);\n    }\n  }\n\n  /**\n   * Returns base64 encoded data for current image.\n   */\n  getDataUrl(format?: ValidFormats, quality?: number): string | null {\n    this.prepareCanvas();\n    try {\n      if (format === 'svg') {\n        return fabricCanvas().toSVG();\n      }\n      return fabricCanvas().toDataURL({\n        format: this.getFormat(format),\n        quality: this.getQuality(quality),\n        multiplier: Math.max(\n          state().original.width / fabricCanvas().width!,\n          state().original.height / fabricCanvas().height!\n        ),\n      });\n    } catch (e) {\n      if ((e as TypeError).message.toLowerCase().includes('tainted')) {\n        toast.danger(message('Could not export canvas with external image.'));\n      }\n    }\n    return null;\n  }\n\n  private getCanvasBlob(format: ValidFormats, data: string): Blob {\n    if (format === 'json') {\n      return new Blob([data], {type: 'application/json'});\n    }\n    if (format === 'svg') {\n      return new Blob([data], {type: 'image/svg+xml'});\n    }\n    const contentType = `image/${format}`;\n    data = data.replace(/data:image\\/([a-z]*)?;base64,/, '');\n    return b64toBlob(data, contentType);\n  }\n\n  private getJsonState(): string {\n    return JSON.stringify(getCurrentCanvasState());\n  }\n\n  private prepareCanvas() {\n    fabricCanvas().discardActiveObject();\n  }\n\n  private applyWaterMark() {\n    const watermark = state().config.watermarkText;\n    if (watermark) {\n      tools().watermark.add(watermark);\n    }\n  }\n\n  private getFormat(format?: ValidFormats | 'jpg'): ValidFormats {\n    const config = state().config.tools?.export;\n    format = format || config?.defaultFormat || 'png';\n    if (format === 'jpg') format = 'jpeg';\n    return format;\n  }\n\n  private getQuality(quality?: number): number {\n    const config = state().config.tools?.export;\n    quality = quality || config?.defaultQuality || 0.8;\n    return quality;\n  }\n}\n","import {Rect} from 'fabric/fabric-impl';\nimport {fabric} from 'fabric';\nimport {fabricCanvas, state, tools} from '../../state/utils';\n\nexport class CornersTool {\n  private previewRect: Rect | null = null;\n\n  async apply(radius: number) {\n    if (!this.previewRect) {\n      this.showPreview();\n    }\n    this.updatePreview(radius);\n\n    fabricCanvas().remove(this.previewRect!);\n    fabricCanvas().clipPath = this.previewRect!;\n\n    // get data and clear canvas\n    const data = tools().export.getDataUrl();\n    if (data) {\n      tools().canvas.clear();\n    }\n\n    // hide preview\n    this.hidePreview();\n\n    // add new rounded image\n    if (data) {\n      await tools().canvas.addMainImage(data);\n    }\n\n    fabricCanvas().clipPath = undefined;\n  }\n\n  getPreviewRadius(): number {\n    return this.previewRect?.rx || 0;\n  }\n\n  updatePreview(radius: number) {\n    if (!this.previewRect) return;\n    this.previewRect.set({\n      rx: radius,\n      ry: radius,\n    });\n    tools().canvas.render();\n  }\n\n  showPreview() {\n    this.previewRect = new fabric.Rect({\n      width: state().original.width,\n      height: state().original.height,\n      rx: 50,\n      ry: 50,\n      objectCaching: false,\n      fill: 'transparent',\n      name: 'round.rect',\n      data: {pixieInternal: true},\n      stroke: 'rgba(255,255,255,0.8)',\n      strokeWidth: 3,\n      strokeDashArray: [4, 4],\n      selectable: false,\n      evented: false,\n    });\n\n    fabricCanvas().add(this.previewRect);\n    this.previewRect.moveTo(99);\n    this.previewRect.viewportCenter();\n    tools().canvas.render();\n  }\n\n  hidePreview() {\n    if (!this.previewRect) return;\n    fabricCanvas().remove(this.previewRect);\n    tools().canvas.render();\n    this.previewRect = null;\n  }\n}\n","import {IRectOptions, Object as IObject} from 'fabric/fabric-impl';\nimport {fabric} from 'fabric';\nimport {fabricCanvas, state, tools} from '../../state/utils';\nimport {StraightenAnchor} from './straighten-anchor';\nimport {staticObjectConfig} from '../../objects/static-object-config';\nimport {ObjectName} from '../../objects/object-name';\n\nexport class TransformTool {\n  private get straightenAnchor(): StraightenAnchor {\n    return fabricCanvas()\n      .getObjects()\n      .find(\n        obj => obj.name === ObjectName.StraightenAnchor\n      ) as StraightenAnchor;\n  }\n\n  /**\n   * Rotate canvas left by 90 degrees.\n   */\n  rotateLeft() {\n    this.rotateFixed(-90);\n  }\n\n  /**\n   * Rotate canvas right by 90 degrees.\n   */\n  rotateRight() {\n    this.rotateFixed(90);\n  }\n\n  /**\n   * Straighten canvas by specified number of degrees.\n   */\n  straighten(degrees: number) {\n    this.storeObjectsRelationToHelper();\n    tools().objects.deselectActive();\n    const newAngle = (this.straightenAnchor.data.rotateAngle || 0) + degrees;\n    const scale = this.getImageScale(newAngle, this.straightenAnchor);\n\n    this.straightenAnchor.angle = newAngle;\n    this.straightenAnchor.scaleX = scale;\n    this.straightenAnchor.scaleY = scale;\n\n    this.straightenAnchor.data.straightenAngle = degrees;\n\n    this.transformObjectsBasedOnHelper();\n  }\n\n  /**\n   * Flip canvas vertically or horizontally.\n   */\n  flip(direction: 'horizontal' | 'vertical') {\n    const prop = direction === 'horizontal' ? 'flipY' : 'flipX';\n    tools()\n      .objects.getAll()\n      .forEach(obj => {\n        obj[prop] = !obj[prop];\n      });\n    tools().canvas.render();\n  }\n\n  private rotateFixed(degrees: number) {\n    tools().zoom.set(1, false);\n    tools().objects.deselectActive();\n    const currentRotateAngle = this.straightenAnchor.data.rotateAngle || 0;\n    degrees = Math.round(degrees / 90) * 90;\n    const newAngle =\n      currentRotateAngle +\n      (this.straightenAnchor.data.straightenAngle || 0) +\n      degrees;\n\n    // noinspection JSSuspiciousNameCombination\n    tools().canvas.resize(state().original.height, state().original.width, {\n      applyZoom: false,\n      resizeHelper: false,\n    });\n\n    this.storeObjectsRelationToHelper();\n\n    this.straightenAnchor.rotate(newAngle);\n    this.straightenAnchor.data.rotateAngle = currentRotateAngle + degrees;\n\n    this.straightenAnchor.center();\n    this.transformObjectsBasedOnHelper();\n    tools().frame.resize(tools().frame.active.currentSizeInPercent);\n    // pattern frames dont resize properly if we dont zoom on next paint\n    requestAnimationFrame(() => {\n      tools().zoom.fitToScreen();\n    });\n  }\n\n  /**\n   * Get minimum scale in order for image to fill the whole canvas, based on rotation.\n   */\n  private getImageScale(angle: number, image: IObject): number {\n    angle = fabric.util.degreesToRadians(angle);\n    const w = state().original.width;\n    const h = state().original.height;\n    const cw = w / 2;\n    const ch = h / 2;\n\n    const iw = image.width! / 2;\n    const ih = image.height! / 2;\n    const dist = Math.sqrt(cw ** 2 + ch ** 2);\n    const diagAngle = Math.asin(ch / dist);\n\n    let a1 = ((angle % (Math.PI * 2)) + Math.PI * 4) % (Math.PI * 2);\n    if (a1 > Math.PI) {\n      a1 -= Math.PI;\n    }\n    if (a1 > Math.PI / 2 && a1 <= Math.PI) {\n      a1 = Math.PI / 2 - (a1 - Math.PI / 2);\n    }\n\n    const ang1 = Math.PI / 2 - diagAngle - Math.abs(a1);\n    const ang2 = Math.abs(diagAngle - Math.abs(a1));\n    const dist1 = Math.cos(ang1) * dist;\n    const dist2 = Math.cos(ang2) * dist;\n    return Math.max(dist2 / iw, dist1 / ih);\n  }\n\n  private storeObjectsRelationToHelper() {\n    tools()\n      .objects.getAll()\n      .forEach(o => {\n        if (o !== this.straightenAnchor) {\n          const relationToCanvas = fabric.util.multiplyTransformMatrices(\n            fabric.util.invertTransform(\n              this.straightenAnchor.calcTransformMatrix()\n            ),\n            o.calcTransformMatrix()\n          );\n          o.data = {...o.data, relationToCanvas};\n        }\n      });\n  }\n\n  private transformObjectsBasedOnHelper() {\n    tools()\n      .objects.getAll()\n      .forEach(o => {\n        if (o.data.relationToCanvas) {\n          const newTransform = fabric.util.multiplyTransformMatrices(\n            this.straightenAnchor.calcTransformMatrix(),\n            o.data.relationToCanvas\n          );\n          const opt = fabric.util.qrDecompose(newTransform);\n          o.set({flipX: false, flipY: false});\n          o.setPositionByOrigin(\n            {x: opt.translateX, y: opt.translateY} as any,\n            'center',\n            'center'\n          );\n          o.set(opt);\n          o.setCoords();\n          o.data.relationToCanvas = null;\n        }\n      });\n  }\n\n  /**\n   * @hidden\n   */\n  resetStraightenAnchor() {\n    const oldHelper = this.straightenAnchor;\n    if (oldHelper) {\n      fabricCanvas().remove(oldHelper);\n    }\n    const newHelper = new fabric.Rect({\n      ...(staticObjectConfig as IRectOptions),\n      name: ObjectName.StraightenAnchor,\n      visible: false,\n      width: state().original.width,\n      height: state().original.height,\n      data: {\n        pixieInternal: true,\n        straightenAngle: 0,\n        rotateAngle: 0,\n      },\n    }) as StraightenAnchor;\n    fabricCanvas().add(newHelper);\n    newHelper.viewportCenter();\n  }\n}\n","import {initFabric} from '../utils/init-fabric';\nimport {ZoomTool} from './zoom-tool';\nimport {PixieCanvas} from './canvas/pixie-canvas';\nimport {ObjectTool} from '../objects/object-tool';\nimport {HistoryTool} from './history/history-tool';\nimport {MergeTool} from './merge/merge-tool';\nimport {FilterTool} from './filter/filter-tool';\nimport {ResizeTool} from './resize/resize-tool';\nimport {CropTool} from './crop/crop-tool';\nimport {ShapeTool} from './shapes/shape-tool';\nimport {FrameTool} from './frame/frame-tool';\nimport {TextTool} from './text/text-tool';\nimport {DrawTool} from './draw/draw-tool';\nimport {ImportTool} from './import/import-tool';\nimport {WatermarkTool} from './export/watermark-tool';\nimport {ExportTool} from './export/export-tool';\nimport {useStore} from '../state/store';\nimport {CornersTool} from './corners/corners-tool';\nimport {TransformTool} from './transform/transform-tool';\nimport {state} from '../state/utils';\n\nexport interface Tools {\n  filter: FilterTool;\n  history: HistoryTool;\n  objects: ObjectTool;\n  canvas: PixieCanvas;\n  zoom: ZoomTool;\n  resize: ResizeTool;\n  crop: CropTool;\n  merge: MergeTool;\n  shape: ShapeTool;\n  frame: FrameTool;\n  text: TextTool;\n  draw: DrawTool;\n  transform: TransformTool;\n  import: ImportTool;\n  watermark: WatermarkTool;\n  export: ExportTool;\n  corners: CornersTool;\n}\n\nexport function initTools(canvasEl: HTMLCanvasElement) {\n  const fabric = initFabric(canvasEl);\n  state().editor.fabric = fabric;\n  useStore.setState({fabric});\n  state().editor.tools = {\n    canvas: new PixieCanvas(),\n    objects: new ObjectTool(),\n    zoom: new ZoomTool(),\n    history: new HistoryTool(),\n    filter: new FilterTool(),\n    resize: new ResizeTool(),\n    crop: new CropTool(),\n    merge: new MergeTool(),\n    shape: new ShapeTool(),\n    frame: new FrameTool(),\n    text: new TextTool(),\n    draw: new DrawTool(),\n    transform: new TransformTool(),\n    import: new ImportTool(),\n    watermark: new WatermarkTool(),\n    export: new ExportTool(),\n    corners: new CornersTool(),\n  };\n}\n","import {RefObject} from 'react';\n\ntype Callback = (e: {width: number; height: number}) => void;\n\nexport function observeSize(\n  ref: RefObject<HTMLElement>,\n  callback: Callback\n): () => void {\n  const observer = new ResizeObserver(entries => {\n    const rect = entries[0].contentRect;\n    callback({width: rect.width, height: rect.height});\n  });\n  if (ref.current) {\n    observer.observe(ref.current);\n  }\n  return () => {\n    if (ref.current) {\n      observer.unobserve(ref.current);\n    }\n  };\n}\n","export interface PlainRect {\n  top: number;\n  right: number;\n  bottom: number;\n  left: number;\n  width: number;\n  height: number;\n}\n\nexport function getBoundingClientRect(el: HTMLElement) {\n  const rect = el.getBoundingClientRect();\n  return {\n    top: rect.top,\n    right: rect.right,\n    bottom: rect.bottom,\n    left: rect.left,\n    width: rect.width,\n    height: rect.height,\n  };\n}\n","import {HTMLMotionProps} from 'framer-motion';\n\nexport const toolbarStyle =\n  'flex flex-shrink-0 items-center justify-between px-12 py-[9px] w-full h-[54px]';\n\nexport const toolbarAnimation: HTMLMotionProps<'div'> = {\n  initial: {opacity: 0},\n  animate: {opacity: 1},\n  exit: {opacity: 0, position: 'absolute'},\n  transition: {type: 'tween', duration: 0.15},\n};\n","import {ButtonVariant} from './get-shared-button-style';\n\nexport type ButtonSize = 'xs' | 'sm' | 'md' | 'lg' | 'xl' | null;\n\ninterface Props {\n  padding?: string;\n  equalWidth?: boolean;\n  variant?: ButtonVariant;\n}\n\nexport function getButtonSizeStyle(\n  size?: ButtonSize,\n  {padding, equalWidth, variant}: Props = {}\n): string {\n  switch (size) {\n    case 'xs':\n      if (variant === 'link') return 'text-xs';\n      return `text-xs h-30 ${equalWidth ? 'w-30' : padding || 'px-14'}`;\n    case 'sm':\n      if (variant === 'link') return 'text-sm';\n      return `text-sm h-36 ${equalWidth ? 'w-36' : padding || 'px-18'}`;\n    case 'md':\n      if (variant === 'link') return 'text-base';\n      return `text-base h-42 ${equalWidth ? 'w-42' : padding || 'px-22'}`;\n    case 'lg':\n      if (variant === 'link') return 'text-lg';\n      return `text-base h-50 ${equalWidth ? 'w-50' : padding || 'px-26'}`;\n    case 'xl':\n      if (variant === 'link') return 'text-xl';\n      return `text-lg h-60 ${equalWidth ? 'w-60' : padding || 'px-32'}`;\n    default:\n      return size || '';\n  }\n}\n\nexport function getIconSizeStyle(size?: ButtonSize): string {\n  switch (size) {\n    case 'xs':\n      return 'icon-xs';\n    case 'sm':\n      return 'icon-sm';\n    case 'md':\n      return 'icon-sm';\n    case 'lg':\n      return 'icon-lg';\n    case 'xl':\n      return 'icon-xl';\n    default:\n      // cant' return \"size\" variable here, append in field will not work with it\n      return '';\n  }\n}\n","export type ButtonVariant =\n  | 'text'\n  | 'flat'\n  | 'raised'\n  | 'outline'\n  | 'link'\n  | null;\nexport type ButtonColor = null | 'primary' | 'danger' | 'paper' | 'chip';\n\ninterface SharedButtonStyleProps {\n  variant?: ButtonVariant;\n  color?: ButtonColor;\n  border?: string;\n}\nexport function getSharedButtonStyle(\n  props: SharedButtonStyleProps\n): (string | boolean | null | undefined)[] {\n  const {variant} = props;\n  const variantProps = {...props, border: props.border || 'border'};\n  let style: string[] = [];\n  if (variant === 'outline') {\n    style = outline(variantProps);\n  } else if (variant === 'text') {\n    style = text(variantProps);\n  } else if (variant === 'flat' || variant === 'raised') {\n    style = contained(variantProps);\n  } else if (variant === 'link') {\n    style = link(variantProps);\n  }\n  return [\n    ...style,\n    variant === 'raised' && 'shadow-md',\n    variant &&\n      'align-middle whitespace-nowrap inline-flex items-center transition-button duration-200',\n    'select-none appearance-none no-underline outline-none disabled:pointer-events-none disabled:cursor-default',\n  ];\n}\n\nfunction outline({color, border}: SharedButtonStyleProps) {\n  const disabled =\n    'disabled:text-disabled disabled:bg-transparent disabled:border-disabled-bg';\n  switch (color) {\n    case 'primary':\n      return [\n        `text-primary bg-transparent ${border} border-primary/50`,\n        'hover:bg-primary/hover hover:border-primary',\n        disabled,\n      ];\n    case 'danger':\n      return [\n        `text-danger bg-transparent ${border} border-danger/50`,\n        'hover:bg-danger/4 hover:border-danger',\n        disabled,\n      ];\n    case 'paper':\n      return [`text bg-paper ${border}`, 'hover:bg-hover', disabled];\n    default:\n      return [`bg-transparent ${border}`, 'hover:bg-hover', disabled];\n  }\n}\n\nfunction text({color}: SharedButtonStyleProps) {\n  const disabled = 'disabled:text-disabled disabled:bg-transparent';\n  switch (color) {\n    case 'primary':\n      return [\n        'text-primary bg-transparent border-transparent',\n        'hover:bg-primary/4',\n        disabled,\n      ];\n    case 'danger':\n      return [\n        'text-danger bg-transparent border-transparent',\n        'hover:bg-danger/4',\n        disabled,\n      ];\n    default:\n      return ['bg-transparent border-transparent', 'hover:bg-hover', disabled];\n  }\n}\n\nfunction link({color}: SharedButtonStyleProps) {\n  switch (color) {\n    case 'primary':\n      return ['text-primary', 'hover:underline', 'disabled:text-disabled'];\n    case 'danger':\n      return ['text-danger', 'hover:underline', 'disabled:text-disabled'];\n    default:\n      return ['text-main', 'hover:underline', 'disabled:text-disabled'];\n  }\n}\n\nfunction contained({color, border}: SharedButtonStyleProps) {\n  const disabled =\n    'disabled:text-disabled disabled:bg-disabled disabled:border-transparent disabled:shadow-none';\n  switch (color) {\n    case 'primary':\n      return [\n        `text-on-primary bg-primary ${border} border-primary`,\n        'hover:bg-primary-dark hover:border-primary-dark',\n        disabled,\n      ];\n    case 'danger':\n      return [\n        `text-white bg-danger ${border} border-danger`,\n        'hover:bg-danger/90 hover:border-danger/90',\n        disabled,\n      ];\n    case 'chip':\n      return [\n        `text-main bg-chip ${border} border-chip`,\n        'hover:bg-chip/90 hover:border-chip/90',\n        disabled,\n      ];\n    case 'paper':\n      return [\n        `text-main bg-paper ${border} border-paper`,\n        'hover:bg-paper/90 hover:bg-paper-90',\n        disabled,\n      ];\n    default:\n      return [`bg ${border} border-background`, 'hover:bg-hover', disabled];\n  }\n}\n","import {EventHandler, SyntheticEvent} from 'react';\n\nexport function createEventHandler(handler?: EventHandler<SyntheticEvent>) {\n  if (!handler) return undefined;\n\n  return (e: SyntheticEvent) => {\n    // ignore events bubbling up from portals\n    if (e.currentTarget.contains(e.target as HTMLElement)) {\n      handler(e);\n    }\n  };\n}\n","import React, {\n  ComponentPropsWithoutRef,\n  forwardRef,\n  JSXElementConstructor,\n} from 'react';\nimport clsx from 'clsx';\nimport {To} from 'react-router-dom';\nimport {\n  ButtonColor,\n  ButtonVariant,\n  getSharedButtonStyle,\n} from './get-shared-button-style';\nimport {createEventHandler} from '../../utils/dom/create-event-handler';\n\nexport interface ButtonBaseProps\n  extends Omit<ComponentPropsWithoutRef<'button'>, 'color'> {\n  color?: ButtonColor;\n  variant?: ButtonVariant;\n  value?: any;\n  justify?: string;\n  radius?: string;\n  border?: string;\n  form?: string;\n  to?: To;\n  href?: string;\n  target?: '_blank';\n  replace?: boolean;\n  end?: boolean;\n  elementType?: 'button' | 'a' | JSXElementConstructor<any>;\n}\n\nexport const ButtonBase = forwardRef<\n  HTMLButtonElement | HTMLLinkElement,\n  ButtonBaseProps\n>((props, ref) => {\n  const {\n    children,\n    color = null,\n    variant,\n    radius,\n    justify = 'justify-center',\n    className,\n    href,\n    form,\n    border,\n    elementType,\n    to,\n    replace,\n    end,\n    type = 'button',\n    onClick,\n    onPointerDown,\n    onPointerUp,\n    onKeyDown,\n    ...domProps\n  } = props;\n  const Element = elementType || (href ? 'a' : 'button');\n  const isLink = Element === 'a';\n\n  return (\n    <Element\n      ref={ref as any}\n      form={isLink ? undefined : form}\n      href={href}\n      to={to}\n      type={isLink ? undefined : type}\n      replace={replace}\n      end={end}\n      onPointerDown={createEventHandler(onPointerDown)}\n      onPointerUp={createEventHandler(onPointerUp)}\n      onClick={createEventHandler(onClick)}\n      onKeyDown={createEventHandler(onKeyDown)}\n      className={clsx(\n        'focus-visible:ring',\n        getSharedButtonStyle({variant, color, border}),\n        radius,\n        justify,\n        className\n      )}\n      {...domProps}\n    >\n      {children}\n    </Element>\n  );\n});\n","import React, {ReactElement} from 'react';\nimport clsx from 'clsx';\nimport {ButtonSize, getButtonSizeStyle} from './button-size';\nimport {ButtonBase, ButtonBaseProps} from './button-base';\nimport {IconSize} from '../../icons/svg-icon';\n\nexport interface ButtonProps extends ButtonBaseProps {\n  size?: ButtonSize;\n  equalWidth?: boolean;\n  startIcon?: ReactElement | null | false;\n  endIcon?: ReactElement | null | false;\n}\nexport const Button = React.forwardRef<HTMLButtonElement, ButtonProps>(\n  (\n    {\n      children,\n      startIcon,\n      endIcon,\n      size = 'sm',\n      className,\n      equalWidth = false,\n      radius = 'rounded',\n      variant = 'text',\n      ...other\n    },\n    ref\n  ) => {\n    const mergedClassName = clsx(\n      'font-semibold',\n      getButtonSizeStyle(size, {equalWidth, variant}),\n      className\n    );\n    return (\n      <ButtonBase\n        className={mergedClassName}\n        ref={ref}\n        radius={radius}\n        variant={variant}\n        {...other}\n      >\n        {startIcon && (\n          <InlineIcon position=\"start\" icon={startIcon} size={size} />\n        )}\n        {children}\n        {endIcon && <InlineIcon position=\"end\" icon={endIcon} size={size} />}\n      </ButtonBase>\n    );\n  }\n);\n\ntype InlineIconProps = {\n  icon: ReactElement;\n  position: 'start' | 'end';\n  size?: IconSize | null;\n};\nfunction InlineIcon({icon, position, size}: InlineIconProps): ReactElement {\n  const className = clsx(\n    'm-auto',\n    {\n      '-ml-4 mr-8': position === 'start',\n      '-mr-4 ml-8': position === 'end',\n    },\n    icon.props.className\n  );\n  return React.cloneElement(icon, {className, size});\n}\n","(function() {\r\n\t\"use strict\";\r\n\tvar assign = Object.assign;\r\n\tif(typeof(assign)!==\"function\") {\r\n\t\tassign = function() { \r\n\t\t\tvar a = arguments,\r\n\t\t\t\to = arguments[0];\r\n\t\t\tif (o === null || o === undefined) {\r\n\t\t\t\tthrow new TypeError(\"Cannot convert undefined or null to object\");\r\n\t\t\t}\r\n\t\t\to = Object(o);\r\n\t\t\tfor(var i=1;i<a.length;i++) {\r\n\t\t\t\tif(a[i] && typeof(a[i])===\"object\") {\r\n\t\t\t\t\tfor(var k in a[i]) {\r\n\t\t\t\t\t\to[k] = a[i][k];\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\treturn o;\r\n\t\t};\r\n\t}\r\n\tfunction vrgs(f) {\r\n\t\t\tvar s = f+\"\",\r\n\t\t\t\ti = s.indexOf(\"...\");\r\n\t\t\treturn i>=0 && (i<s.indexOf(\")\") || s.indexOf(\"arguments\")>=0);\r\n\t}\r\n\tfunction nanomemoize(fn,o) {\r\n\t\t/*o = {\r\n\t\t\tserializer, // used to serialize arguments of single argument functions, multis are not serialized\r\n\t\t\tequals, // equality tester, will force use of slower multiarg approach even for single arg functions\r\n\t\t\tmaxAge, // max cache age is ms, set > 0 && < Infinity if you want automatic clearing\r\n\t\t\tmaxArgs, // max args to use for signature\r\n\t\t\tvargs = vrgs(fn) // set to true if function may have variable or beyond-signature arguments, default is best attempt at infering\r\n\t\t  } = {}\r\n\t\t*/\r\n\t\to || (o={});\r\n\t\tvar vargs = o.vargs || vrgs(fn),\r\n\t\t\ts = Object.create(null), // single arg function key/value cache\r\n\t\t\tk = [], // multiple arg function arg key cache\r\n\t\t\tv = [], // multiple arg function result cache\r\n\t\t\twm = new WeakMap(),\r\n\t\t\td = function(key,c,k) { return setTimeout(function() {\r\n\t\t\t\t\tif(k) { // dealing with multi-arg function, c and k are Arrays\r\n\t\t\t\t\t\tc.splice (key,1);\r\n\t\t\t\t\t\tk.splice(key,1);\r\n\t\t\t\t\t\treturn;\r\n\t\t\t\t\t} // dealing with single arg function, c is a WekMap or Object\r\n\t\t\t\t\tc instanceof WeakMap  ? c.delete(key) : delete c[key]; \r\n\t\t\t\t},o.maxAge); },\r\n\t\t\tc = o.maxAge>0 && o.maxAge<Infinity ? d : 0, // cache change timeout,\r\n\t\t\teq = o.equals ? o.equals : function(a,b) { return a===b; },\r\n\t\t\tmaxargs = o.maxArgs,\r\n\t\t\tsrlz = o.serializer,\r\n\t\t\tf, // memoized function to return\r\n\t\t\tu; // flag indicating a unary arg function is in use for clear operation\r\n\t\t\tif(fn.length===1 && !o.equals && !vargs) {\r\n\t\t\t\t// for single argument functions, just use a JS object key look-up\r\n\t\t\t\tf =  (function(a) {\r\n\t\t\t\t\t// strings must be serialized because cache[1] should not equal or overwrite cache[\"1\"] for value = 1 and value = \"1\"\r\n\t\t\t\t\tvar t = typeof a;\r\n\t\t\t\t\t// set chng timeout only when new value computed, hits will not push out the tte, but it is arguable they should not\r\n\t\t\t\t\tif(!srlz && ((t===\"object\" && a)  || t===\"function\")) {\r\n\t\t\t\t\t\tvar r;\r\n\t\t\t\t\t\treturn wm.get(a) || ((!c||c(a,wm)),wm.set(a,r = fn.call(this, a)),r);\r\n\t\t\t\t\t}\r\n\t\t\t\t\tvar key = t === \"number\" || t === \"boolean\" || a == null ? a : t === \"string\" ? JSON.stringify(a) : srlz(a);\r\n\t\t\t\t\treturn s[key] || ((!c||c(key,s)),s[key] = fn.call(this, a));\r\n\t\t\t\t}).bind(this);\r\n\t\t\t\tu = 1;\r\n\t\t\t} else {\r\n\t\t\t// for multiple arg functions, loop through a cache of all the args\r\n\t\t\t// looking at each arg separately so a test can abort as soon as possible\r\n\t\t\tf = (function() {\r\n\t\t\t\tvar l = maxargs||arguments.length,\r\n\t\t\t\t\ti;\r\n\t\t\t\tfor(i=k.length-1;i>=0;i--) { // an array of arrays of args, each array represents a call signature\r\n\t\t\t\t\tif (!maxargs && k[i].length !== l) continue; // cache miss if called with a different number of args\r\n\t\t\t\t\tfor(var j=l-1;j>=0 && eq(k[i][j],arguments[j]);j--) {\t// compare each arg\t\t\t\r\n\t\t\t\t\t\tif(j===0) { return v[i]; } // the args matched\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\ti = k.length - (i + 1);\r\n\t\t\t\t// set change timeout only when new value computed, hits will not push out the tte, but it is arguable they should not\r\n\t\t\t\treturn (!c||c(i,v,k)),v[i] = fn.apply(this,k[i] = arguments);\r\n\t\t\t}).bind(this);\r\n\t\t}\r\n\t\t// reset all the caches\r\n\t\tf.clear = function() {\r\n\t\t\twm = new WeakMap();\r\n\t\t\ts = Object.create(null);\r\n\t\t\tk = [];\r\n\t\t\tv = []; \r\n\t\t};\r\n\t\tf.keys = function() { return u ? null : k.slice(); };\r\n\t\tf.values = function() { return u ? null : v.slice(); };\r\n\t\tf.keyValues = function() { return u ? {primitives:assign({},s),objects:wm} : null; };\r\n\t\treturn f;\r\n\t}\r\n\tif(typeof(module)!==\"undefined\") { module.exports = nanomemoize; }\r\n\tif(typeof(window)!==\"undefined\") { window.nanomemoize = nanomemoize; }\r\n}).call(this);\r\n\r\n","import React, {ReactNode, useId} from 'react';\nimport clsx from 'clsx';\n\nexport interface ListboxSectionProps {\n  label?: ReactNode;\n  children: React.ReactNode;\n  index?: number;\n}\nexport function Section({children, label, index}: ListboxSectionProps) {\n  const id = useId();\n\n  return (\n    <div\n      role=\"group\"\n      className={clsx(index !== 0 && 'border-t my-4')}\n      aria-labelledby={label ? `be-select-${id}` : undefined}\n    >\n      {label && (\n        <div\n          className=\"block uppercase text-muted text-xs px-16 py-10\"\n          role=\"presentation\"\n          id={`be-select-${id}`}\n          aria-hidden=\"true\"\n        >\n          {label}\n        </div>\n      )}\n      {children}\n    </div>\n  );\n}\n","import {Children, isValidElement, ReactElement, ReactNode} from 'react';\nimport memoize from 'nano-memoize';\nimport {ListboxItemProps} from './item';\nimport {ListboxSectionProps, Section} from './section';\nimport {ListBoxChildren} from './types';\n\nexport type ListboxCollection = Map<string | number, CollectionItem<any>>;\n\nexport type CollectionItem<T> = {\n  index: number;\n  textLabel: string;\n  element: ReactElement<ListboxItemProps>;\n  value: string | number;\n  item?: T;\n  isDisabled?: boolean;\n  section?: ReactElement<ListboxSectionProps>;\n};\n\ntype Props<T> = ListBoxChildren<T> & {\n  inputValue?: string;\n  maxItems?: number;\n};\n\nexport const buildListboxCollection = memoize(\n  ({maxItems, children, items, inputValue}: Props<any>) => {\n    let collection = childrenToCollection({children, items});\n    let filteredCollection = filterCollection({collection, inputValue});\n\n    if (maxItems) {\n      collection = new Map([...collection.entries()].slice(0, maxItems));\n      filteredCollection = new Map(\n        [...filteredCollection.entries()].slice(0, maxItems)\n      );\n    }\n\n    return {collection, filteredCollection};\n  }\n);\n\ntype filterCollectionProps = {\n  collection: ListboxCollection;\n  inputValue?: string;\n};\nconst filterCollection = memoize(\n  ({collection, inputValue}: filterCollectionProps) => {\n    let filteredCollection: ListboxCollection = new Map();\n\n    const query = inputValue ? `${inputValue}`.toLowerCase().trim() : '';\n    if (!query) {\n      filteredCollection = collection;\n    } else {\n      let filterIndex = 0;\n      collection.forEach((meta, value) => {\n        const haystack = meta.item ? JSON.stringify(meta.item) : meta.textLabel;\n        if (haystack.toLowerCase().trim().includes(query)) {\n          filteredCollection.set(value, {...meta, index: filterIndex++});\n        }\n      });\n    }\n\n    return filteredCollection;\n  }\n);\n\nconst childrenToCollection = memoize(\n  ({children, items}: ListBoxChildren<any>) => {\n    let reactChildren: ReactNode;\n    if (items && typeof children === 'function') {\n      reactChildren = items.map(item => {\n        return children(item);\n      });\n    } else {\n      reactChildren = children as ReactNode;\n    }\n\n    const collection = new Map<string | number, CollectionItem<any>>();\n    let optionIndex = 0;\n\n    const setOption = (\n      element: ReactElement<ListboxItemProps>,\n      section?: any,\n      sectionIndex?: number,\n      sectionItemIndex?: number\n    ) => {\n      const index = optionIndex++;\n      const item = section\n        ? // get item from nested array\n          items?.[sectionIndex!].items[sectionItemIndex!]\n        : // get item from flat array\n          items?.[index];\n\n      collection.set(element.props.value, {\n        index,\n        element,\n        textLabel: getTextLabel(element),\n        item,\n        section,\n        isDisabled: element.props.isDisabled,\n        value: element.props.value,\n      });\n    };\n\n    Children.forEach(reactChildren, (child, childIndex) => {\n      if (!isValidElement(child)) return;\n      if (child.type === Section) {\n        Children.forEach(\n          child.props.children,\n          (nestedChild, nestedChildIndex) => {\n            setOption(nestedChild, child, childIndex, nestedChildIndex);\n          }\n        );\n      } else {\n        setOption(child as ReactElement<ListboxItemProps>);\n      }\n    });\n\n    return collection;\n  }\n);\n\nfunction getTextLabel(item: ReactElement<ListboxItemProps>): string {\n  const content = item.props.children;\n\n  if (item.props.textLabel) {\n    return item.props.textLabel;\n  }\n  if (content && (content as any).props?.defaultMessage) {\n    return (content as any).props.defaultMessage[0].value;\n  }\n\n  return `${content}` || '';\n}\n","function getSide(placement) {\n  return placement.split('-')[0];\n}\n\nfunction getAlignment(placement) {\n  return placement.split('-')[1];\n}\n\nfunction getMainAxisFromPlacement(placement) {\n  return ['top', 'bottom'].includes(getSide(placement)) ? 'x' : 'y';\n}\n\nfunction getLengthFromAxis(axis) {\n  return axis === 'y' ? 'height' : 'width';\n}\n\nfunction computeCoordsFromPlacement(_ref, placement, rtl) {\n  let {\n    reference,\n    floating\n  } = _ref;\n  const commonX = reference.x + reference.width / 2 - floating.width / 2;\n  const commonY = reference.y + reference.height / 2 - floating.height / 2;\n  const mainAxis = getMainAxisFromPlacement(placement);\n  const length = getLengthFromAxis(mainAxis);\n  const commonAlign = reference[length] / 2 - floating[length] / 2;\n  const side = getSide(placement);\n  const isVertical = mainAxis === 'x';\n  let coords;\n\n  switch (side) {\n    case 'top':\n      coords = {\n        x: commonX,\n        y: reference.y - floating.height\n      };\n      break;\n\n    case 'bottom':\n      coords = {\n        x: commonX,\n        y: reference.y + reference.height\n      };\n      break;\n\n    case 'right':\n      coords = {\n        x: reference.x + reference.width,\n        y: commonY\n      };\n      break;\n\n    case 'left':\n      coords = {\n        x: reference.x - floating.width,\n        y: commonY\n      };\n      break;\n\n    default:\n      coords = {\n        x: reference.x,\n        y: reference.y\n      };\n  }\n\n  switch (getAlignment(placement)) {\n    case 'start':\n      coords[mainAxis] -= commonAlign * (rtl && isVertical ? -1 : 1);\n      break;\n\n    case 'end':\n      coords[mainAxis] += commonAlign * (rtl && isVertical ? -1 : 1);\n      break;\n  }\n\n  return coords;\n}\n\n/**\n * Computes the `x` and `y` coordinates that will place the floating element\n * next to a reference element when it is given a certain positioning strategy.\n *\n * This export does not have any `platform` interface logic. You will need to\n * write one for the platform you are using Floating UI with.\n */\n\nconst computePosition = async (reference, floating, config) => {\n  const {\n    placement = 'bottom',\n    strategy = 'absolute',\n    middleware = [],\n    platform\n  } = config;\n  const rtl = await (platform.isRTL == null ? void 0 : platform.isRTL(floating));\n\n  if (process.env.NODE_ENV !== \"production\") {\n    if (platform == null) {\n      console.error(['Floating UI: `platform` property was not passed to config. If you', 'want to use Floating UI on the web, install @floating-ui/dom', 'instead of the /core package. Otherwise, you can create your own', '`platform`: https://floating-ui.com/docs/platform'].join(' '));\n    }\n\n    if (middleware.filter(_ref => {\n      let {\n        name\n      } = _ref;\n      return name === 'autoPlacement' || name === 'flip';\n    }).length > 1) {\n      throw new Error(['Floating UI: duplicate `flip` and/or `autoPlacement`', 'middleware detected. This will lead to an infinite loop. Ensure only', 'one of either has been passed to the `middleware` array.'].join(' '));\n    }\n  }\n\n  let rects = await platform.getElementRects({\n    reference,\n    floating,\n    strategy\n  });\n  let {\n    x,\n    y\n  } = computeCoordsFromPlacement(rects, placement, rtl);\n  let statefulPlacement = placement;\n  let middlewareData = {};\n  let resetCount = 0;\n\n  for (let i = 0; i < middleware.length; i++) {\n    const {\n      name,\n      fn\n    } = middleware[i];\n    const {\n      x: nextX,\n      y: nextY,\n      data,\n      reset\n    } = await fn({\n      x,\n      y,\n      initialPlacement: placement,\n      placement: statefulPlacement,\n      strategy,\n      middlewareData,\n      rects,\n      platform,\n      elements: {\n        reference,\n        floating\n      }\n    });\n    x = nextX != null ? nextX : x;\n    y = nextY != null ? nextY : y;\n    middlewareData = { ...middlewareData,\n      [name]: { ...middlewareData[name],\n        ...data\n      }\n    };\n\n    if (process.env.NODE_ENV !== \"production\") {\n      if (resetCount > 50) {\n        console.warn(['Floating UI: The middleware lifecycle appears to be running in an', 'infinite loop. This is usually caused by a `reset` continually', 'being returned without a break condition.'].join(' '));\n      }\n    }\n\n    if (reset && resetCount <= 50) {\n      resetCount++;\n\n      if (typeof reset === 'object') {\n        if (reset.placement) {\n          statefulPlacement = reset.placement;\n        }\n\n        if (reset.rects) {\n          rects = reset.rects === true ? await platform.getElementRects({\n            reference,\n            floating,\n            strategy\n          }) : reset.rects;\n        }\n\n        ({\n          x,\n          y\n        } = computeCoordsFromPlacement(rects, statefulPlacement, rtl));\n      }\n\n      i = -1;\n      continue;\n    }\n  }\n\n  return {\n    x,\n    y,\n    placement: statefulPlacement,\n    strategy,\n    middlewareData\n  };\n};\n\nfunction expandPaddingObject(padding) {\n  return {\n    top: 0,\n    right: 0,\n    bottom: 0,\n    left: 0,\n    ...padding\n  };\n}\n\nfunction getSideObjectFromPadding(padding) {\n  return typeof padding !== 'number' ? expandPaddingObject(padding) : {\n    top: padding,\n    right: padding,\n    bottom: padding,\n    left: padding\n  };\n}\n\nfunction rectToClientRect(rect) {\n  return { ...rect,\n    top: rect.y,\n    left: rect.x,\n    right: rect.x + rect.width,\n    bottom: rect.y + rect.height\n  };\n}\n\n/**\n * Resolves with an object of overflow side offsets that determine how much the\n * element is overflowing a given clipping boundary.\n * - positive = overflowing the boundary by that number of pixels\n * - negative = how many pixels left before it will overflow\n * - 0 = lies flush with the boundary\n * @see https://floating-ui.com/docs/detectOverflow\n */\nasync function detectOverflow(middlewareArguments, options) {\n  var _await$platform$isEle;\n\n  if (options === void 0) {\n    options = {};\n  }\n\n  const {\n    x,\n    y,\n    platform,\n    rects,\n    elements,\n    strategy\n  } = middlewareArguments;\n  const {\n    boundary = 'clippingAncestors',\n    rootBoundary = 'viewport',\n    elementContext = 'floating',\n    altBoundary = false,\n    padding = 0\n  } = options;\n  const paddingObject = getSideObjectFromPadding(padding);\n  const altContext = elementContext === 'floating' ? 'reference' : 'floating';\n  const element = elements[altBoundary ? altContext : elementContext];\n  const clippingClientRect = rectToClientRect(await platform.getClippingRect({\n    element: ((_await$platform$isEle = await (platform.isElement == null ? void 0 : platform.isElement(element))) != null ? _await$platform$isEle : true) ? element : element.contextElement || (await (platform.getDocumentElement == null ? void 0 : platform.getDocumentElement(elements.floating))),\n    boundary,\n    rootBoundary,\n    strategy\n  }));\n  const elementClientRect = rectToClientRect(platform.convertOffsetParentRelativeRectToViewportRelativeRect ? await platform.convertOffsetParentRelativeRectToViewportRelativeRect({\n    rect: elementContext === 'floating' ? { ...rects.floating,\n      x,\n      y\n    } : rects.reference,\n    offsetParent: await (platform.getOffsetParent == null ? void 0 : platform.getOffsetParent(elements.floating)),\n    strategy\n  }) : rects[elementContext]);\n  return {\n    top: clippingClientRect.top - elementClientRect.top + paddingObject.top,\n    bottom: elementClientRect.bottom - clippingClientRect.bottom + paddingObject.bottom,\n    left: clippingClientRect.left - elementClientRect.left + paddingObject.left,\n    right: elementClientRect.right - clippingClientRect.right + paddingObject.right\n  };\n}\n\nconst min = Math.min;\nconst max = Math.max;\n\nfunction within(min$1, value, max$1) {\n  return max(min$1, min(value, max$1));\n}\n\n/**\n * Positions an inner element of the floating element such that it is centered\n * to the reference element.\n * @see https://floating-ui.com/docs/arrow\n */\nconst arrow = options => ({\n  name: 'arrow',\n  options,\n\n  async fn(middlewareArguments) {\n    // Since `element` is required, we don't Partial<> the type\n    const {\n      element,\n      padding = 0\n    } = options != null ? options : {};\n    const {\n      x,\n      y,\n      placement,\n      rects,\n      platform\n    } = middlewareArguments;\n\n    if (element == null) {\n      if (process.env.NODE_ENV !== \"production\") {\n        console.warn('Floating UI: No `element` was passed to the `arrow` middleware.');\n      }\n\n      return {};\n    }\n\n    const paddingObject = getSideObjectFromPadding(padding);\n    const coords = {\n      x,\n      y\n    };\n    const axis = getMainAxisFromPlacement(placement);\n    const alignment = getAlignment(placement);\n    const length = getLengthFromAxis(axis);\n    const arrowDimensions = await platform.getDimensions(element);\n    const minProp = axis === 'y' ? 'top' : 'left';\n    const maxProp = axis === 'y' ? 'bottom' : 'right';\n    const endDiff = rects.reference[length] + rects.reference[axis] - coords[axis] - rects.floating[length];\n    const startDiff = coords[axis] - rects.reference[axis];\n    const arrowOffsetParent = await (platform.getOffsetParent == null ? void 0 : platform.getOffsetParent(element));\n    let clientSize = arrowOffsetParent ? axis === 'y' ? arrowOffsetParent.clientHeight || 0 : arrowOffsetParent.clientWidth || 0 : 0;\n\n    if (clientSize === 0) {\n      clientSize = rects.floating[length];\n    }\n\n    const centerToReference = endDiff / 2 - startDiff / 2; // Make sure the arrow doesn't overflow the floating element if the center\n    // point is outside the floating element's bounds\n\n    const min = paddingObject[minProp];\n    const max = clientSize - arrowDimensions[length] - paddingObject[maxProp];\n    const center = clientSize / 2 - arrowDimensions[length] / 2 + centerToReference;\n    const offset = within(min, center, max); // Make sure that arrow points at the reference\n\n    const alignmentPadding = alignment === 'start' ? paddingObject[minProp] : paddingObject[maxProp];\n    const shouldAddOffset = alignmentPadding > 0 && center !== offset && rects.reference[length] <= rects.floating[length];\n    const alignmentOffset = shouldAddOffset ? center < min ? min - center : max - center : 0;\n    return {\n      [axis]: coords[axis] - alignmentOffset,\n      data: {\n        [axis]: offset,\n        centerOffset: center - offset\n      }\n    };\n  }\n\n});\n\nconst hash$1 = {\n  left: 'right',\n  right: 'left',\n  bottom: 'top',\n  top: 'bottom'\n};\nfunction getOppositePlacement(placement) {\n  return placement.replace(/left|right|bottom|top/g, matched => hash$1[matched]);\n}\n\nfunction getAlignmentSides(placement, rects, rtl) {\n  if (rtl === void 0) {\n    rtl = false;\n  }\n\n  const alignment = getAlignment(placement);\n  const mainAxis = getMainAxisFromPlacement(placement);\n  const length = getLengthFromAxis(mainAxis);\n  let mainAlignmentSide = mainAxis === 'x' ? alignment === (rtl ? 'end' : 'start') ? 'right' : 'left' : alignment === 'start' ? 'bottom' : 'top';\n\n  if (rects.reference[length] > rects.floating[length]) {\n    mainAlignmentSide = getOppositePlacement(mainAlignmentSide);\n  }\n\n  return {\n    main: mainAlignmentSide,\n    cross: getOppositePlacement(mainAlignmentSide)\n  };\n}\n\nconst hash = {\n  start: 'end',\n  end: 'start'\n};\nfunction getOppositeAlignmentPlacement(placement) {\n  return placement.replace(/start|end/g, matched => hash[matched]);\n}\n\nconst sides = ['top', 'right', 'bottom', 'left'];\nconst allPlacements = /*#__PURE__*/sides.reduce((acc, side) => acc.concat(side, side + \"-start\", side + \"-end\"), []);\n\nfunction getPlacementList(alignment, autoAlignment, allowedPlacements) {\n  const allowedPlacementsSortedByAlignment = alignment ? [...allowedPlacements.filter(placement => getAlignment(placement) === alignment), ...allowedPlacements.filter(placement => getAlignment(placement) !== alignment)] : allowedPlacements.filter(placement => getSide(placement) === placement);\n  return allowedPlacementsSortedByAlignment.filter(placement => {\n    if (alignment) {\n      return getAlignment(placement) === alignment || (autoAlignment ? getOppositeAlignmentPlacement(placement) !== placement : false);\n    }\n\n    return true;\n  });\n}\n\n/**\n * Automatically chooses the `placement` which has the most space available.\n * @see https://floating-ui.com/docs/autoPlacement\n */\nconst autoPlacement = function (options) {\n  if (options === void 0) {\n    options = {};\n  }\n\n  return {\n    name: 'autoPlacement',\n    options,\n\n    async fn(middlewareArguments) {\n      var _middlewareData$autoP, _middlewareData$autoP2, _middlewareData$autoP3, _middlewareData$autoP4, _placementsSortedByLe;\n\n      const {\n        x,\n        y,\n        rects,\n        middlewareData,\n        placement,\n        platform,\n        elements\n      } = middlewareArguments;\n      const {\n        alignment = null,\n        allowedPlacements = allPlacements,\n        autoAlignment = true,\n        ...detectOverflowOptions\n      } = options;\n      const placements = getPlacementList(alignment, autoAlignment, allowedPlacements);\n      const overflow = await detectOverflow(middlewareArguments, detectOverflowOptions);\n      const currentIndex = (_middlewareData$autoP = (_middlewareData$autoP2 = middlewareData.autoPlacement) == null ? void 0 : _middlewareData$autoP2.index) != null ? _middlewareData$autoP : 0;\n      const currentPlacement = placements[currentIndex];\n\n      if (currentPlacement == null) {\n        return {};\n      }\n\n      const {\n        main,\n        cross\n      } = getAlignmentSides(currentPlacement, rects, await (platform.isRTL == null ? void 0 : platform.isRTL(elements.floating))); // Make `computeCoords` start from the right place\n\n      if (placement !== currentPlacement) {\n        return {\n          x,\n          y,\n          reset: {\n            placement: placements[0]\n          }\n        };\n      }\n\n      const currentOverflows = [overflow[getSide(currentPlacement)], overflow[main], overflow[cross]];\n      const allOverflows = [...((_middlewareData$autoP3 = (_middlewareData$autoP4 = middlewareData.autoPlacement) == null ? void 0 : _middlewareData$autoP4.overflows) != null ? _middlewareData$autoP3 : []), {\n        placement: currentPlacement,\n        overflows: currentOverflows\n      }];\n      const nextPlacement = placements[currentIndex + 1]; // There are more placements to check\n\n      if (nextPlacement) {\n        return {\n          data: {\n            index: currentIndex + 1,\n            overflows: allOverflows\n          },\n          reset: {\n            placement: nextPlacement\n          }\n        };\n      }\n\n      const placementsSortedByLeastOverflow = allOverflows.slice().sort((a, b) => a.overflows[0] - b.overflows[0]);\n      const placementThatFitsOnAllSides = (_placementsSortedByLe = placementsSortedByLeastOverflow.find(_ref => {\n        let {\n          overflows\n        } = _ref;\n        return overflows.every(overflow => overflow <= 0);\n      })) == null ? void 0 : _placementsSortedByLe.placement;\n      const resetPlacement = placementThatFitsOnAllSides != null ? placementThatFitsOnAllSides : placementsSortedByLeastOverflow[0].placement;\n\n      if (resetPlacement !== placement) {\n        return {\n          data: {\n            index: currentIndex + 1,\n            overflows: allOverflows\n          },\n          reset: {\n            placement: resetPlacement\n          }\n        };\n      }\n\n      return {};\n    }\n\n  };\n};\n\nfunction getExpandedPlacements(placement) {\n  const oppositePlacement = getOppositePlacement(placement);\n  return [getOppositeAlignmentPlacement(placement), oppositePlacement, getOppositeAlignmentPlacement(oppositePlacement)];\n}\n\n/**\n * Changes the placement of the floating element to one that will fit if the\n * initially specified `placement` does not.\n * @see https://floating-ui.com/docs/flip\n */\nconst flip = function (options) {\n  if (options === void 0) {\n    options = {};\n  }\n\n  return {\n    name: 'flip',\n    options,\n\n    async fn(middlewareArguments) {\n      var _middlewareData$flip;\n\n      const {\n        placement,\n        middlewareData,\n        rects,\n        initialPlacement,\n        platform,\n        elements\n      } = middlewareArguments;\n      const {\n        mainAxis: checkMainAxis = true,\n        crossAxis: checkCrossAxis = true,\n        fallbackPlacements: specifiedFallbackPlacements,\n        fallbackStrategy = 'bestFit',\n        flipAlignment = true,\n        ...detectOverflowOptions\n      } = options;\n      const side = getSide(placement);\n      const isBasePlacement = side === initialPlacement;\n      const fallbackPlacements = specifiedFallbackPlacements || (isBasePlacement || !flipAlignment ? [getOppositePlacement(initialPlacement)] : getExpandedPlacements(initialPlacement));\n      const placements = [initialPlacement, ...fallbackPlacements];\n      const overflow = await detectOverflow(middlewareArguments, detectOverflowOptions);\n      const overflows = [];\n      let overflowsData = ((_middlewareData$flip = middlewareData.flip) == null ? void 0 : _middlewareData$flip.overflows) || [];\n\n      if (checkMainAxis) {\n        overflows.push(overflow[side]);\n      }\n\n      if (checkCrossAxis) {\n        const {\n          main,\n          cross\n        } = getAlignmentSides(placement, rects, await (platform.isRTL == null ? void 0 : platform.isRTL(elements.floating)));\n        overflows.push(overflow[main], overflow[cross]);\n      }\n\n      overflowsData = [...overflowsData, {\n        placement,\n        overflows\n      }]; // One or more sides is overflowing\n\n      if (!overflows.every(side => side <= 0)) {\n        var _middlewareData$flip$, _middlewareData$flip2;\n\n        const nextIndex = ((_middlewareData$flip$ = (_middlewareData$flip2 = middlewareData.flip) == null ? void 0 : _middlewareData$flip2.index) != null ? _middlewareData$flip$ : 0) + 1;\n        const nextPlacement = placements[nextIndex];\n\n        if (nextPlacement) {\n          // Try next placement and re-run the lifecycle\n          return {\n            data: {\n              index: nextIndex,\n              overflows: overflowsData\n            },\n            reset: {\n              placement: nextPlacement\n            }\n          };\n        }\n\n        let resetPlacement = 'bottom';\n\n        switch (fallbackStrategy) {\n          case 'bestFit':\n            {\n              var _overflowsData$map$so;\n\n              const placement = (_overflowsData$map$so = overflowsData.map(d => [d, d.overflows.filter(overflow => overflow > 0).reduce((acc, overflow) => acc + overflow, 0)]).sort((a, b) => a[1] - b[1])[0]) == null ? void 0 : _overflowsData$map$so[0].placement;\n\n              if (placement) {\n                resetPlacement = placement;\n              }\n\n              break;\n            }\n\n          case 'initialPlacement':\n            resetPlacement = initialPlacement;\n            break;\n        }\n\n        if (placement !== resetPlacement) {\n          return {\n            reset: {\n              placement: resetPlacement\n            }\n          };\n        }\n      }\n\n      return {};\n    }\n\n  };\n};\n\nfunction getSideOffsets(overflow, rect) {\n  return {\n    top: overflow.top - rect.height,\n    right: overflow.right - rect.width,\n    bottom: overflow.bottom - rect.height,\n    left: overflow.left - rect.width\n  };\n}\n\nfunction isAnySideFullyClipped(overflow) {\n  return sides.some(side => overflow[side] >= 0);\n}\n\n/**\n * Provides data to hide the floating element in applicable situations, such as\n * when it is not in the same clipping context as the reference element.\n * @see https://floating-ui.com/docs/hide\n */\nconst hide = function (_temp) {\n  let {\n    strategy = 'referenceHidden',\n    ...detectOverflowOptions\n  } = _temp === void 0 ? {} : _temp;\n  return {\n    name: 'hide',\n\n    async fn(middlewareArguments) {\n      const {\n        rects\n      } = middlewareArguments;\n\n      switch (strategy) {\n        case 'referenceHidden':\n          {\n            const overflow = await detectOverflow(middlewareArguments, { ...detectOverflowOptions,\n              elementContext: 'reference'\n            });\n            const offsets = getSideOffsets(overflow, rects.reference);\n            return {\n              data: {\n                referenceHiddenOffsets: offsets,\n                referenceHidden: isAnySideFullyClipped(offsets)\n              }\n            };\n          }\n\n        case 'escaped':\n          {\n            const overflow = await detectOverflow(middlewareArguments, { ...detectOverflowOptions,\n              altBoundary: true\n            });\n            const offsets = getSideOffsets(overflow, rects.floating);\n            return {\n              data: {\n                escapedOffsets: offsets,\n                escaped: isAnySideFullyClipped(offsets)\n              }\n            };\n          }\n\n        default:\n          {\n            return {};\n          }\n      }\n    }\n\n  };\n};\n\nasync function convertValueToCoords(middlewareArguments, value) {\n  const {\n    placement,\n    platform,\n    elements\n  } = middlewareArguments;\n  const rtl = await (platform.isRTL == null ? void 0 : platform.isRTL(elements.floating));\n  const side = getSide(placement);\n  const alignment = getAlignment(placement);\n  const isVertical = getMainAxisFromPlacement(placement) === 'x';\n  const mainAxisMulti = ['left', 'top'].includes(side) ? -1 : 1;\n  const crossAxisMulti = rtl && isVertical ? -1 : 1;\n  const rawValue = typeof value === 'function' ? value(middlewareArguments) : value; // eslint-disable-next-line prefer-const\n\n  let {\n    mainAxis,\n    crossAxis,\n    alignmentAxis\n  } = typeof rawValue === 'number' ? {\n    mainAxis: rawValue,\n    crossAxis: 0,\n    alignmentAxis: null\n  } : {\n    mainAxis: 0,\n    crossAxis: 0,\n    alignmentAxis: null,\n    ...rawValue\n  };\n\n  if (alignment && typeof alignmentAxis === 'number') {\n    crossAxis = alignment === 'end' ? alignmentAxis * -1 : alignmentAxis;\n  }\n\n  return isVertical ? {\n    x: crossAxis * crossAxisMulti,\n    y: mainAxis * mainAxisMulti\n  } : {\n    x: mainAxis * mainAxisMulti,\n    y: crossAxis * crossAxisMulti\n  };\n}\n/**\n * Displaces the floating element from its reference element.\n * @see https://floating-ui.com/docs/offset\n */\n\nconst offset = function (value) {\n  if (value === void 0) {\n    value = 0;\n  }\n\n  return {\n    name: 'offset',\n    options: value,\n\n    async fn(middlewareArguments) {\n      const {\n        x,\n        y\n      } = middlewareArguments;\n      const diffCoords = await convertValueToCoords(middlewareArguments, value);\n      return {\n        x: x + diffCoords.x,\n        y: y + diffCoords.y,\n        data: diffCoords\n      };\n    }\n\n  };\n};\n\nfunction getCrossAxis(axis) {\n  return axis === 'x' ? 'y' : 'x';\n}\n\n/**\n * Shifts the floating element in order to keep it in view when it will overflow\n * a clipping boundary.\n * @see https://floating-ui.com/docs/shift\n */\nconst shift = function (options) {\n  if (options === void 0) {\n    options = {};\n  }\n\n  return {\n    name: 'shift',\n    options,\n\n    async fn(middlewareArguments) {\n      const {\n        x,\n        y,\n        placement\n      } = middlewareArguments;\n      const {\n        mainAxis: checkMainAxis = true,\n        crossAxis: checkCrossAxis = false,\n        limiter = {\n          fn: _ref => {\n            let {\n              x,\n              y\n            } = _ref;\n            return {\n              x,\n              y\n            };\n          }\n        },\n        ...detectOverflowOptions\n      } = options;\n      const coords = {\n        x,\n        y\n      };\n      const overflow = await detectOverflow(middlewareArguments, detectOverflowOptions);\n      const mainAxis = getMainAxisFromPlacement(getSide(placement));\n      const crossAxis = getCrossAxis(mainAxis);\n      let mainAxisCoord = coords[mainAxis];\n      let crossAxisCoord = coords[crossAxis];\n\n      if (checkMainAxis) {\n        const minSide = mainAxis === 'y' ? 'top' : 'left';\n        const maxSide = mainAxis === 'y' ? 'bottom' : 'right';\n        const min = mainAxisCoord + overflow[minSide];\n        const max = mainAxisCoord - overflow[maxSide];\n        mainAxisCoord = within(min, mainAxisCoord, max);\n      }\n\n      if (checkCrossAxis) {\n        const minSide = crossAxis === 'y' ? 'top' : 'left';\n        const maxSide = crossAxis === 'y' ? 'bottom' : 'right';\n        const min = crossAxisCoord + overflow[minSide];\n        const max = crossAxisCoord - overflow[maxSide];\n        crossAxisCoord = within(min, crossAxisCoord, max);\n      }\n\n      const limitedCoords = limiter.fn({ ...middlewareArguments,\n        [mainAxis]: mainAxisCoord,\n        [crossAxis]: crossAxisCoord\n      });\n      return { ...limitedCoords,\n        data: {\n          x: limitedCoords.x - x,\n          y: limitedCoords.y - y\n        }\n      };\n    }\n\n  };\n};\n\n/**\n * Built-in `limiter` that will stop `shift()` at a certain point.\n */\nconst limitShift = function (options) {\n  if (options === void 0) {\n    options = {};\n  }\n\n  return {\n    options,\n\n    fn(middlewareArguments) {\n      const {\n        x,\n        y,\n        placement,\n        rects,\n        middlewareData\n      } = middlewareArguments;\n      const {\n        offset = 0,\n        mainAxis: checkMainAxis = true,\n        crossAxis: checkCrossAxis = true\n      } = options;\n      const coords = {\n        x,\n        y\n      };\n      const mainAxis = getMainAxisFromPlacement(placement);\n      const crossAxis = getCrossAxis(mainAxis);\n      let mainAxisCoord = coords[mainAxis];\n      let crossAxisCoord = coords[crossAxis];\n      const rawOffset = typeof offset === 'function' ? offset(middlewareArguments) : offset;\n      const computedOffset = typeof rawOffset === 'number' ? {\n        mainAxis: rawOffset,\n        crossAxis: 0\n      } : {\n        mainAxis: 0,\n        crossAxis: 0,\n        ...rawOffset\n      };\n\n      if (checkMainAxis) {\n        const len = mainAxis === 'y' ? 'height' : 'width';\n        const limitMin = rects.reference[mainAxis] - rects.floating[len] + computedOffset.mainAxis;\n        const limitMax = rects.reference[mainAxis] + rects.reference[len] - computedOffset.mainAxis;\n\n        if (mainAxisCoord < limitMin) {\n          mainAxisCoord = limitMin;\n        } else if (mainAxisCoord > limitMax) {\n          mainAxisCoord = limitMax;\n        }\n      }\n\n      if (checkCrossAxis) {\n        var _middlewareData$offse, _middlewareData$offse2, _middlewareData$offse3, _middlewareData$offse4;\n\n        const len = mainAxis === 'y' ? 'width' : 'height';\n        const isOriginSide = ['top', 'left'].includes(getSide(placement));\n        const limitMin = rects.reference[crossAxis] - rects.floating[len] + (isOriginSide ? (_middlewareData$offse = (_middlewareData$offse2 = middlewareData.offset) == null ? void 0 : _middlewareData$offse2[crossAxis]) != null ? _middlewareData$offse : 0 : 0) + (isOriginSide ? 0 : computedOffset.crossAxis);\n        const limitMax = rects.reference[crossAxis] + rects.reference[len] + (isOriginSide ? 0 : (_middlewareData$offse3 = (_middlewareData$offse4 = middlewareData.offset) == null ? void 0 : _middlewareData$offse4[crossAxis]) != null ? _middlewareData$offse3 : 0) - (isOriginSide ? computedOffset.crossAxis : 0);\n\n        if (crossAxisCoord < limitMin) {\n          crossAxisCoord = limitMin;\n        } else if (crossAxisCoord > limitMax) {\n          crossAxisCoord = limitMax;\n        }\n      }\n\n      return {\n        [mainAxis]: mainAxisCoord,\n        [crossAxis]: crossAxisCoord\n      };\n    }\n\n  };\n};\n\n/**\n * Provides data to change the size of the floating element. For instance,\n * prevent it from overflowing its clipping boundary or match the width of the\n * reference element.\n * @see https://floating-ui.com/docs/size\n */\nconst size = function (options) {\n  if (options === void 0) {\n    options = {};\n  }\n\n  return {\n    name: 'size',\n    options,\n\n    async fn(middlewareArguments) {\n      const {\n        placement,\n        rects,\n        platform,\n        elements\n      } = middlewareArguments;\n      const {\n        apply = () => {},\n        ...detectOverflowOptions\n      } = options;\n      const overflow = await detectOverflow(middlewareArguments, detectOverflowOptions);\n      const side = getSide(placement);\n      const alignment = getAlignment(placement);\n      let heightSide;\n      let widthSide;\n\n      if (side === 'top' || side === 'bottom') {\n        heightSide = side;\n        widthSide = alignment === ((await (platform.isRTL == null ? void 0 : platform.isRTL(elements.floating))) ? 'start' : 'end') ? 'left' : 'right';\n      } else {\n        widthSide = side;\n        heightSide = alignment === 'end' ? 'top' : 'bottom';\n      }\n\n      const xMin = max(overflow.left, 0);\n      const xMax = max(overflow.right, 0);\n      const yMin = max(overflow.top, 0);\n      const yMax = max(overflow.bottom, 0);\n      const dimensions = {\n        availableHeight: rects.floating.height - (['left', 'right'].includes(placement) ? 2 * (yMin !== 0 || yMax !== 0 ? yMin + yMax : max(overflow.top, overflow.bottom)) : overflow[heightSide]),\n        availableWidth: rects.floating.width - (['top', 'bottom'].includes(placement) ? 2 * (xMin !== 0 || xMax !== 0 ? xMin + xMax : max(overflow.left, overflow.right)) : overflow[widthSide])\n      };\n      await apply({ ...middlewareArguments,\n        ...dimensions\n      });\n      const nextDimensions = await platform.getDimensions(elements.floating);\n\n      if (rects.floating.width !== nextDimensions.width || rects.floating.height !== nextDimensions.height) {\n        return {\n          reset: {\n            rects: true\n          }\n        };\n      }\n\n      return {};\n    }\n\n  };\n};\n\n/**\n * Provides improved positioning for inline reference elements that can span\n * over multiple lines, such as hyperlinks or range selections.\n * @see https://floating-ui.com/docs/inline\n */\nconst inline = function (options) {\n  if (options === void 0) {\n    options = {};\n  }\n\n  return {\n    name: 'inline',\n    options,\n\n    async fn(middlewareArguments) {\n      var _await$platform$getCl;\n\n      const {\n        placement,\n        elements,\n        rects,\n        platform,\n        strategy\n      } = middlewareArguments; // A MouseEvent's client{X,Y} coords can be up to 2 pixels off a\n      // ClientRect's bounds, despite the event listener being triggered. A\n      // padding of 2 seems to handle this issue.\n\n      const {\n        padding = 2,\n        x,\n        y\n      } = options;\n      const fallback = rectToClientRect(platform.convertOffsetParentRelativeRectToViewportRelativeRect ? await platform.convertOffsetParentRelativeRectToViewportRelativeRect({\n        rect: rects.reference,\n        offsetParent: await (platform.getOffsetParent == null ? void 0 : platform.getOffsetParent(elements.floating)),\n        strategy\n      }) : rects.reference);\n      const clientRects = (_await$platform$getCl = await (platform.getClientRects == null ? void 0 : platform.getClientRects(elements.reference))) != null ? _await$platform$getCl : [];\n      const paddingObject = getSideObjectFromPadding(padding);\n\n      function getBoundingClientRect() {\n        // There are two rects and they are disjoined\n        if (clientRects.length === 2 && clientRects[0].left > clientRects[1].right && x != null && y != null) {\n          var _clientRects$find;\n\n          // Find the first rect in which the point is fully inside\n          return (_clientRects$find = clientRects.find(rect => x > rect.left - paddingObject.left && x < rect.right + paddingObject.right && y > rect.top - paddingObject.top && y < rect.bottom + paddingObject.bottom)) != null ? _clientRects$find : fallback;\n        } // There are 2 or more connected rects\n\n\n        if (clientRects.length >= 2) {\n          if (getMainAxisFromPlacement(placement) === 'x') {\n            const firstRect = clientRects[0];\n            const lastRect = clientRects[clientRects.length - 1];\n            const isTop = getSide(placement) === 'top';\n            const top = firstRect.top;\n            const bottom = lastRect.bottom;\n            const left = isTop ? firstRect.left : lastRect.left;\n            const right = isTop ? firstRect.right : lastRect.right;\n            const width = right - left;\n            const height = bottom - top;\n            return {\n              top,\n              bottom,\n              left,\n              right,\n              width,\n              height,\n              x: left,\n              y: top\n            };\n          }\n\n          const isLeftSide = getSide(placement) === 'left';\n          const maxRight = max(...clientRects.map(rect => rect.right));\n          const minLeft = min(...clientRects.map(rect => rect.left));\n          const measureRects = clientRects.filter(rect => isLeftSide ? rect.left === minLeft : rect.right === maxRight);\n          const top = measureRects[0].top;\n          const bottom = measureRects[measureRects.length - 1].bottom;\n          const left = minLeft;\n          const right = maxRight;\n          const width = right - left;\n          const height = bottom - top;\n          return {\n            top,\n            bottom,\n            left,\n            right,\n            width,\n            height,\n            x: left,\n            y: top\n          };\n        }\n\n        return fallback;\n      }\n\n      const resetRects = await platform.getElementRects({\n        reference: {\n          getBoundingClientRect\n        },\n        floating: elements.floating,\n        strategy\n      });\n\n      if (rects.reference.x !== resetRects.reference.x || rects.reference.y !== resetRects.reference.y || rects.reference.width !== resetRects.reference.width || rects.reference.height !== resetRects.reference.height) {\n        return {\n          reset: {\n            rects: resetRects\n          }\n        };\n      }\n\n      return {};\n    }\n\n  };\n};\n\nexport { arrow, autoPlacement, computePosition, detectOverflow, flip, hide, inline, limitShift, offset, rectToClientRect, shift, size };\n","import { rectToClientRect, computePosition as computePosition$1 } from '@floating-ui/core';\nexport { arrow, autoPlacement, detectOverflow, flip, hide, inline, limitShift, offset, shift, size } from '@floating-ui/core';\n\nfunction isWindow(value) {\n  return value && value.document && value.location && value.alert && value.setInterval;\n}\nfunction getWindow(node) {\n  if (node == null) {\n    return window;\n  }\n\n  if (!isWindow(node)) {\n    const ownerDocument = node.ownerDocument;\n    return ownerDocument ? ownerDocument.defaultView || window : window;\n  }\n\n  return node;\n}\n\nfunction getComputedStyle(element) {\n  return getWindow(element).getComputedStyle(element);\n}\n\nfunction getNodeName(node) {\n  return isWindow(node) ? '' : node ? (node.nodeName || '').toLowerCase() : '';\n}\n\nfunction getUAString() {\n  const uaData = navigator.userAgentData;\n\n  if (uaData != null && uaData.brands) {\n    return uaData.brands.map(item => item.brand + \"/\" + item.version).join(' ');\n  }\n\n  return navigator.userAgent;\n}\n\nfunction isHTMLElement(value) {\n  return value instanceof getWindow(value).HTMLElement;\n}\nfunction isElement(value) {\n  return value instanceof getWindow(value).Element;\n}\nfunction isNode(value) {\n  return value instanceof getWindow(value).Node;\n}\nfunction isShadowRoot(node) {\n  // Browsers without `ShadowRoot` support\n  if (typeof ShadowRoot === 'undefined') {\n    return false;\n  }\n\n  const OwnElement = getWindow(node).ShadowRoot;\n  return node instanceof OwnElement || node instanceof ShadowRoot;\n}\nfunction isOverflowElement(element) {\n  // Firefox wants us to check `-x` and `-y` variations as well\n  const {\n    overflow,\n    overflowX,\n    overflowY\n  } = getComputedStyle(element);\n  return /auto|scroll|overlay|hidden/.test(overflow + overflowY + overflowX);\n}\nfunction isTableElement(element) {\n  return ['table', 'td', 'th'].includes(getNodeName(element));\n}\nfunction isContainingBlock(element) {\n  // TODO: Try and use feature detection here instead\n  const isFirefox = /firefox/i.test(getUAString());\n  const css = getComputedStyle(element); // This is non-exhaustive but covers the most common CSS properties that\n  // create a containing block.\n  // https://developer.mozilla.org/en-US/docs/Web/CSS/Containing_block#identifying_the_containing_block\n\n  return css.transform !== 'none' || css.perspective !== 'none' || // @ts-ignore (TS 4.1 compat)\n  css.contain === 'paint' || ['transform', 'perspective'].includes(css.willChange) || isFirefox && css.willChange === 'filter' || isFirefox && (css.filter ? css.filter !== 'none' : false);\n}\nfunction isLayoutViewport() {\n  // Not Safari\n  return !/^((?!chrome|android).)*safari/i.test(getUAString()); // Feature detection for this fails in various ways\n  // • Always-visible scrollbar or not\n  // • Width of <html>, etc.\n  // const vV = win.visualViewport;\n  // return vV ? Math.abs(win.innerWidth / vV.scale - vV.width) < 0.5 : true;\n}\n\nconst min = Math.min;\nconst max = Math.max;\nconst round = Math.round;\n\nfunction getBoundingClientRect(element, includeScale, isFixedStrategy) {\n  var _win$visualViewport$o, _win$visualViewport, _win$visualViewport$o2, _win$visualViewport2;\n\n  if (includeScale === void 0) {\n    includeScale = false;\n  }\n\n  if (isFixedStrategy === void 0) {\n    isFixedStrategy = false;\n  }\n\n  const clientRect = element.getBoundingClientRect();\n  let scaleX = 1;\n  let scaleY = 1;\n\n  if (includeScale && isHTMLElement(element)) {\n    scaleX = element.offsetWidth > 0 ? round(clientRect.width) / element.offsetWidth || 1 : 1;\n    scaleY = element.offsetHeight > 0 ? round(clientRect.height) / element.offsetHeight || 1 : 1;\n  }\n\n  const win = isElement(element) ? getWindow(element) : window;\n  const addVisualOffsets = !isLayoutViewport() && isFixedStrategy;\n  const x = (clientRect.left + (addVisualOffsets ? (_win$visualViewport$o = (_win$visualViewport = win.visualViewport) == null ? void 0 : _win$visualViewport.offsetLeft) != null ? _win$visualViewport$o : 0 : 0)) / scaleX;\n  const y = (clientRect.top + (addVisualOffsets ? (_win$visualViewport$o2 = (_win$visualViewport2 = win.visualViewport) == null ? void 0 : _win$visualViewport2.offsetTop) != null ? _win$visualViewport$o2 : 0 : 0)) / scaleY;\n  const width = clientRect.width / scaleX;\n  const height = clientRect.height / scaleY;\n  return {\n    width,\n    height,\n    top: y,\n    right: x + width,\n    bottom: y + height,\n    left: x,\n    x,\n    y\n  };\n}\n\nfunction getDocumentElement(node) {\n  return ((isNode(node) ? node.ownerDocument : node.document) || window.document).documentElement;\n}\n\nfunction getNodeScroll(element) {\n  if (isElement(element)) {\n    return {\n      scrollLeft: element.scrollLeft,\n      scrollTop: element.scrollTop\n    };\n  }\n\n  return {\n    scrollLeft: element.pageXOffset,\n    scrollTop: element.pageYOffset\n  };\n}\n\nfunction getWindowScrollBarX(element) {\n  // If <html> has a CSS width greater than the viewport, then this will be\n  // incorrect for RTL.\n  return getBoundingClientRect(getDocumentElement(element)).left + getNodeScroll(element).scrollLeft;\n}\n\nfunction isScaled(element) {\n  const rect = getBoundingClientRect(element);\n  return round(rect.width) !== element.offsetWidth || round(rect.height) !== element.offsetHeight;\n}\n\nfunction getRectRelativeToOffsetParent(element, offsetParent, strategy) {\n  const isOffsetParentAnElement = isHTMLElement(offsetParent);\n  const documentElement = getDocumentElement(offsetParent);\n  const rect = getBoundingClientRect(element, // @ts-ignore - checked above (TS 4.1 compat)\n  isOffsetParentAnElement && isScaled(offsetParent), strategy === 'fixed');\n  let scroll = {\n    scrollLeft: 0,\n    scrollTop: 0\n  };\n  const offsets = {\n    x: 0,\n    y: 0\n  };\n\n  if (isOffsetParentAnElement || !isOffsetParentAnElement && strategy !== 'fixed') {\n    if (getNodeName(offsetParent) !== 'body' || isOverflowElement(documentElement)) {\n      scroll = getNodeScroll(offsetParent);\n    }\n\n    if (isHTMLElement(offsetParent)) {\n      const offsetRect = getBoundingClientRect(offsetParent, true);\n      offsets.x = offsetRect.x + offsetParent.clientLeft;\n      offsets.y = offsetRect.y + offsetParent.clientTop;\n    } else if (documentElement) {\n      offsets.x = getWindowScrollBarX(documentElement);\n    }\n  }\n\n  return {\n    x: rect.left + scroll.scrollLeft - offsets.x,\n    y: rect.top + scroll.scrollTop - offsets.y,\n    width: rect.width,\n    height: rect.height\n  };\n}\n\nfunction getParentNode(node) {\n  if (getNodeName(node) === 'html') {\n    return node;\n  }\n\n  return (// this is a quicker (but less type safe) way to save quite some bytes from the bundle\n    // @ts-ignore\n    node.assignedSlot || // step into the shadow DOM of the parent of a slotted node\n    node.parentNode || ( // DOM Element detected\n    isShadowRoot(node) ? node.host : null) || // ShadowRoot detected\n    getDocumentElement(node) // fallback\n\n  );\n}\n\nfunction getTrueOffsetParent(element) {\n  if (!isHTMLElement(element) || getComputedStyle(element).position === 'fixed') {\n    return null;\n  }\n\n  return element.offsetParent;\n}\n\nfunction getContainingBlock(element) {\n  let currentNode = getParentNode(element);\n\n  if (isShadowRoot(currentNode)) {\n    currentNode = currentNode.host;\n  }\n\n  while (isHTMLElement(currentNode) && !['html', 'body'].includes(getNodeName(currentNode))) {\n    if (isContainingBlock(currentNode)) {\n      return currentNode;\n    } else {\n      const parent = currentNode.parentNode;\n      currentNode = isShadowRoot(parent) ? parent.host : parent;\n    }\n  }\n\n  return null;\n} // Gets the closest ancestor positioned element. Handles some edge cases,\n// such as table ancestors and cross browser bugs.\n\n\nfunction getOffsetParent(element) {\n  const window = getWindow(element);\n  let offsetParent = getTrueOffsetParent(element);\n\n  while (offsetParent && isTableElement(offsetParent) && getComputedStyle(offsetParent).position === 'static') {\n    offsetParent = getTrueOffsetParent(offsetParent);\n  }\n\n  if (offsetParent && (getNodeName(offsetParent) === 'html' || getNodeName(offsetParent) === 'body' && getComputedStyle(offsetParent).position === 'static' && !isContainingBlock(offsetParent))) {\n    return window;\n  }\n\n  return offsetParent || getContainingBlock(element) || window;\n}\n\nfunction getDimensions(element) {\n  if (isHTMLElement(element)) {\n    return {\n      width: element.offsetWidth,\n      height: element.offsetHeight\n    };\n  }\n\n  const rect = getBoundingClientRect(element);\n  return {\n    width: rect.width,\n    height: rect.height\n  };\n}\n\nfunction convertOffsetParentRelativeRectToViewportRelativeRect(_ref) {\n  let {\n    rect,\n    offsetParent,\n    strategy\n  } = _ref;\n  const isOffsetParentAnElement = isHTMLElement(offsetParent);\n  const documentElement = getDocumentElement(offsetParent);\n\n  if (offsetParent === documentElement) {\n    return rect;\n  }\n\n  let scroll = {\n    scrollLeft: 0,\n    scrollTop: 0\n  };\n  const offsets = {\n    x: 0,\n    y: 0\n  };\n\n  if (isOffsetParentAnElement || !isOffsetParentAnElement && strategy !== 'fixed') {\n    if (getNodeName(offsetParent) !== 'body' || isOverflowElement(documentElement)) {\n      scroll = getNodeScroll(offsetParent);\n    }\n\n    if (isHTMLElement(offsetParent)) {\n      const offsetRect = getBoundingClientRect(offsetParent, true);\n      offsets.x = offsetRect.x + offsetParent.clientLeft;\n      offsets.y = offsetRect.y + offsetParent.clientTop;\n    } // This doesn't appear to be need to be negated.\n    // else if (documentElement) {\n    //   offsets.x = getWindowScrollBarX(documentElement);\n    // }\n\n  }\n\n  return { ...rect,\n    x: rect.x - scroll.scrollLeft + offsets.x,\n    y: rect.y - scroll.scrollTop + offsets.y\n  };\n}\n\nfunction getViewportRect(element, strategy) {\n  const win = getWindow(element);\n  const html = getDocumentElement(element);\n  const visualViewport = win.visualViewport;\n  let width = html.clientWidth;\n  let height = html.clientHeight;\n  let x = 0;\n  let y = 0;\n\n  if (visualViewport) {\n    width = visualViewport.width;\n    height = visualViewport.height;\n    const layoutViewport = isLayoutViewport();\n\n    if (layoutViewport || !layoutViewport && strategy === 'fixed') {\n      x = visualViewport.offsetLeft;\n      y = visualViewport.offsetTop;\n    }\n  }\n\n  return {\n    width,\n    height,\n    x,\n    y\n  };\n}\n\n// of the `<html>` and `<body>` rect bounds if horizontally scrollable\n\nfunction getDocumentRect(element) {\n  var _element$ownerDocumen;\n\n  const html = getDocumentElement(element);\n  const scroll = getNodeScroll(element);\n  const body = (_element$ownerDocumen = element.ownerDocument) == null ? void 0 : _element$ownerDocumen.body;\n  const width = max(html.scrollWidth, html.clientWidth, body ? body.scrollWidth : 0, body ? body.clientWidth : 0);\n  const height = max(html.scrollHeight, html.clientHeight, body ? body.scrollHeight : 0, body ? body.clientHeight : 0);\n  let x = -scroll.scrollLeft + getWindowScrollBarX(element);\n  const y = -scroll.scrollTop;\n\n  if (getComputedStyle(body || html).direction === 'rtl') {\n    x += max(html.clientWidth, body ? body.clientWidth : 0) - width;\n  }\n\n  return {\n    width,\n    height,\n    x,\n    y\n  };\n}\n\nfunction getNearestOverflowAncestor(node) {\n  const parentNode = getParentNode(node);\n\n  if (['html', 'body', '#document'].includes(getNodeName(parentNode))) {\n    // @ts-ignore assume body is always available\n    return node.ownerDocument.body;\n  }\n\n  if (isHTMLElement(parentNode) && isOverflowElement(parentNode)) {\n    return parentNode;\n  }\n\n  return getNearestOverflowAncestor(parentNode);\n}\n\nfunction getOverflowAncestors(node, list) {\n  var _node$ownerDocument;\n\n  if (list === void 0) {\n    list = [];\n  }\n\n  const scrollableAncestor = getNearestOverflowAncestor(node);\n  const isBody = scrollableAncestor === ((_node$ownerDocument = node.ownerDocument) == null ? void 0 : _node$ownerDocument.body);\n  const win = getWindow(scrollableAncestor);\n  const target = isBody ? [win].concat(win.visualViewport || [], isOverflowElement(scrollableAncestor) ? scrollableAncestor : []) : scrollableAncestor;\n  const updatedList = list.concat(target);\n  return isBody ? updatedList : // @ts-ignore: isBody tells us target will be an HTMLElement here\n  updatedList.concat(getOverflowAncestors(target));\n}\n\nfunction contains(parent, child) {\n  const rootNode = child.getRootNode == null ? void 0 : child.getRootNode(); // First, attempt with faster native method\n\n  if (parent.contains(child)) {\n    return true;\n  } // then fallback to custom implementation with Shadow DOM support\n  else if (rootNode && isShadowRoot(rootNode)) {\n    let next = child;\n\n    do {\n      // use `===` replace node.isSameNode()\n      if (next && parent === next) {\n        return true;\n      } // @ts-ignore: need a better way to handle this...\n\n\n      next = next.parentNode || next.host;\n    } while (next);\n  }\n\n  return false;\n}\n\nfunction getInnerBoundingClientRect(element, strategy) {\n  const clientRect = getBoundingClientRect(element, false, strategy === 'fixed');\n  const top = clientRect.top + element.clientTop;\n  const left = clientRect.left + element.clientLeft;\n  return {\n    top,\n    left,\n    x: left,\n    y: top,\n    right: left + element.clientWidth,\n    bottom: top + element.clientHeight,\n    width: element.clientWidth,\n    height: element.clientHeight\n  };\n}\n\nfunction getClientRectFromClippingAncestor(element, clippingParent, strategy) {\n  if (clippingParent === 'viewport') {\n    return rectToClientRect(getViewportRect(element, strategy));\n  }\n\n  if (isElement(clippingParent)) {\n    return getInnerBoundingClientRect(clippingParent, strategy);\n  }\n\n  return rectToClientRect(getDocumentRect(getDocumentElement(element)));\n} // A \"clipping ancestor\" is an overflowable container with the characteristic of\n// clipping (or hiding) overflowing elements with a position different from\n// `initial`\n\n\nfunction getClippingAncestors(element) {\n  const clippingAncestors = getOverflowAncestors(element);\n  const canEscapeClipping = ['absolute', 'fixed'].includes(getComputedStyle(element).position);\n  const clipperElement = canEscapeClipping && isHTMLElement(element) ? getOffsetParent(element) : element;\n\n  if (!isElement(clipperElement)) {\n    return [];\n  } // @ts-ignore isElement check ensures we return Array<Element>\n\n\n  return clippingAncestors.filter(clippingAncestors => isElement(clippingAncestors) && contains(clippingAncestors, clipperElement) && getNodeName(clippingAncestors) !== 'body');\n} // Gets the maximum area that the element is visible in due to any number of\n// clipping ancestors\n\n\nfunction getClippingRect(_ref) {\n  let {\n    element,\n    boundary,\n    rootBoundary,\n    strategy\n  } = _ref;\n  const mainClippingAncestors = boundary === 'clippingAncestors' ? getClippingAncestors(element) : [].concat(boundary);\n  const clippingAncestors = [...mainClippingAncestors, rootBoundary];\n  const firstClippingAncestor = clippingAncestors[0];\n  const clippingRect = clippingAncestors.reduce((accRect, clippingAncestor) => {\n    const rect = getClientRectFromClippingAncestor(element, clippingAncestor, strategy);\n    accRect.top = max(rect.top, accRect.top);\n    accRect.right = min(rect.right, accRect.right);\n    accRect.bottom = min(rect.bottom, accRect.bottom);\n    accRect.left = max(rect.left, accRect.left);\n    return accRect;\n  }, getClientRectFromClippingAncestor(element, firstClippingAncestor, strategy));\n  return {\n    width: clippingRect.right - clippingRect.left,\n    height: clippingRect.bottom - clippingRect.top,\n    x: clippingRect.left,\n    y: clippingRect.top\n  };\n}\n\nconst platform = {\n  getClippingRect,\n  convertOffsetParentRelativeRectToViewportRelativeRect,\n  isElement,\n  getDimensions,\n  getOffsetParent,\n  getDocumentElement,\n  getElementRects: _ref => {\n    let {\n      reference,\n      floating,\n      strategy\n    } = _ref;\n    return {\n      reference: getRectRelativeToOffsetParent(reference, getOffsetParent(floating), strategy),\n      floating: { ...getDimensions(floating),\n        x: 0,\n        y: 0\n      }\n    };\n  },\n  getClientRects: element => Array.from(element.getClientRects()),\n  isRTL: element => getComputedStyle(element).direction === 'rtl'\n};\n\n/**\n * Automatically updates the position of the floating element when necessary.\n * @see https://floating-ui.com/docs/autoUpdate\n */\nfunction autoUpdate(reference, floating, update, options) {\n  if (options === void 0) {\n    options = {};\n  }\n\n  const {\n    ancestorScroll: _ancestorScroll = true,\n    ancestorResize: _ancestorResize = true,\n    elementResize = true,\n    animationFrame = false\n  } = options;\n  const ancestorScroll = _ancestorScroll && !animationFrame;\n  const ancestorResize = _ancestorResize && !animationFrame;\n  const ancestors = ancestorScroll || ancestorResize ? [...(isElement(reference) ? getOverflowAncestors(reference) : []), ...getOverflowAncestors(floating)] : [];\n  ancestors.forEach(ancestor => {\n    ancestorScroll && ancestor.addEventListener('scroll', update, {\n      passive: true\n    });\n    ancestorResize && ancestor.addEventListener('resize', update);\n  });\n  let observer = null;\n\n  if (elementResize) {\n    let initialUpdate = true;\n    observer = new ResizeObserver(() => {\n      if (!initialUpdate) {\n        update();\n      }\n\n      initialUpdate = false;\n    });\n    isElement(reference) && !animationFrame && observer.observe(reference);\n    observer.observe(floating);\n  }\n\n  let frameId;\n  let prevRefRect = animationFrame ? getBoundingClientRect(reference) : null;\n\n  if (animationFrame) {\n    frameLoop();\n  }\n\n  function frameLoop() {\n    const nextRefRect = getBoundingClientRect(reference);\n\n    if (prevRefRect && (nextRefRect.x !== prevRefRect.x || nextRefRect.y !== prevRefRect.y || nextRefRect.width !== prevRefRect.width || nextRefRect.height !== prevRefRect.height)) {\n      update();\n    }\n\n    prevRefRect = nextRefRect;\n    frameId = requestAnimationFrame(frameLoop);\n  }\n\n  update();\n  return () => {\n    var _observer;\n\n    ancestors.forEach(ancestor => {\n      ancestorScroll && ancestor.removeEventListener('scroll', update);\n      ancestorResize && ancestor.removeEventListener('resize', update);\n    });\n    (_observer = observer) == null ? void 0 : _observer.disconnect();\n    observer = null;\n\n    if (animationFrame) {\n      cancelAnimationFrame(frameId);\n    }\n  };\n}\n\n/**\n * Computes the `x` and `y` coordinates that will place the floating element\n * next to a reference element when it is given a certain CSS positioning\n * strategy.\n */\n\nconst computePosition = (reference, floating, options) => computePosition$1(reference, floating, {\n  platform,\n  ...options\n});\n\nexport { autoUpdate, computePosition, getOverflowAncestors, platform };\n","import { computePosition, arrow as arrow$1 } from '@floating-ui/dom';\nexport * from '@floating-ui/dom';\nimport * as React from 'react';\nimport { useLayoutEffect, useEffect } from 'react';\nimport * as ReactDOM from 'react-dom';\n\nvar index = typeof document !== 'undefined' ? useLayoutEffect : useEffect;\n\n// Fork of `fast-deep-equal` that only does the comparisons we need and compares\n// functions\nfunction deepEqual(a, b) {\n  if (a === b) {\n    return true;\n  }\n\n  if (typeof a !== typeof b) {\n    return false;\n  }\n\n  if (typeof a === 'function' && a.toString() === b.toString()) {\n    return true;\n  }\n\n  let length, i, keys;\n\n  if (a && b && typeof a == 'object') {\n    if (Array.isArray(a)) {\n      length = a.length;\n      if (length != b.length) return false;\n\n      for (i = length; i-- !== 0;) {\n        if (!deepEqual(a[i], b[i])) {\n          return false;\n        }\n      }\n\n      return true;\n    }\n\n    keys = Object.keys(a);\n    length = keys.length;\n\n    if (length !== Object.keys(b).length) {\n      return false;\n    }\n\n    for (i = length; i-- !== 0;) {\n      if (!Object.prototype.hasOwnProperty.call(b, keys[i])) {\n        return false;\n      }\n    }\n\n    for (i = length; i-- !== 0;) {\n      const key = keys[i];\n\n      if (key === '_owner' && a.$$typeof) {\n        continue;\n      }\n\n      if (!deepEqual(a[key], b[key])) {\n        return false;\n      }\n    }\n\n    return true;\n  }\n\n  return a !== a && b !== b;\n}\n\nfunction useLatestRef(value) {\n  const ref = React.useRef(value);\n  index(() => {\n    ref.current = value;\n  });\n  return ref;\n}\n\nfunction useFloating(_temp) {\n  let {\n    middleware,\n    placement = 'bottom',\n    strategy = 'absolute',\n    whileElementsMounted\n  } = _temp === void 0 ? {} : _temp;\n  const [data, setData] = React.useState({\n    // Setting these to `null` will allow the consumer to determine if\n    // `computePosition()` has run yet\n    x: null,\n    y: null,\n    strategy,\n    placement,\n    middlewareData: {}\n  });\n  const [latestMiddleware, setLatestMiddleware] = React.useState(middleware);\n\n  if (!deepEqual(latestMiddleware == null ? void 0 : latestMiddleware.map(_ref => {\n    let {\n      name,\n      options\n    } = _ref;\n    return {\n      name,\n      options\n    };\n  }), middleware == null ? void 0 : middleware.map(_ref2 => {\n    let {\n      name,\n      options\n    } = _ref2;\n    return {\n      name,\n      options\n    };\n  }))) {\n    setLatestMiddleware(middleware);\n  }\n\n  const reference = React.useRef(null);\n  const floating = React.useRef(null);\n  const cleanupRef = React.useRef(null);\n  const dataRef = React.useRef(data);\n  const whileElementsMountedRef = useLatestRef(whileElementsMounted);\n  const update = React.useCallback(() => {\n    if (!reference.current || !floating.current) {\n      return;\n    }\n\n    computePosition(reference.current, floating.current, {\n      middleware: latestMiddleware,\n      placement,\n      strategy\n    }).then(data => {\n      if (isMountedRef.current && !deepEqual(dataRef.current, data)) {\n        dataRef.current = data;\n        ReactDOM.flushSync(() => {\n          setData(data);\n        });\n      }\n    });\n  }, [latestMiddleware, placement, strategy]);\n  index(() => {\n    // Skip first update\n    if (isMountedRef.current) {\n      update();\n    }\n  }, [update]);\n  const isMountedRef = React.useRef(false);\n  index(() => {\n    isMountedRef.current = true;\n    return () => {\n      isMountedRef.current = false;\n    };\n  }, []);\n  const runElementMountCallback = React.useCallback(() => {\n    if (typeof cleanupRef.current === 'function') {\n      cleanupRef.current();\n      cleanupRef.current = null;\n    }\n\n    if (reference.current && floating.current) {\n      if (whileElementsMountedRef.current) {\n        const cleanupFn = whileElementsMountedRef.current(reference.current, floating.current, update);\n        cleanupRef.current = cleanupFn;\n      } else {\n        update();\n      }\n    }\n  }, [update, whileElementsMountedRef]);\n  const setReference = React.useCallback(node => {\n    reference.current = node;\n    runElementMountCallback();\n  }, [runElementMountCallback]);\n  const setFloating = React.useCallback(node => {\n    floating.current = node;\n    runElementMountCallback();\n  }, [runElementMountCallback]);\n  const refs = React.useMemo(() => ({\n    reference,\n    floating\n  }), []);\n  return React.useMemo(() => ({ ...data,\n    update,\n    refs,\n    reference: setReference,\n    floating: setFloating\n  }), [data, update, refs, setReference, setFloating]);\n}\n\n/**\n * Positions an inner element of the floating element such that it is centered\n * to the reference element.\n * This wraps the core `arrow` middleware to allow React refs as the element.\n * @see https://floating-ui.com/docs/arrow\n */\n\nconst arrow = options => {\n  const {\n    element,\n    padding\n  } = options;\n\n  function isRef(value) {\n    return Object.prototype.hasOwnProperty.call(value, 'current');\n  }\n\n  return {\n    name: 'arrow',\n    options,\n\n    fn(args) {\n      if (isRef(element)) {\n        if (element.current != null) {\n          return arrow$1({\n            element: element.current,\n            padding\n          }).fn(args);\n        }\n\n        return {};\n      } else if (element) {\n        return arrow$1({\n          element,\n          padding\n        }).fn(args);\n      }\n\n      return {};\n    }\n\n  };\n};\n\nexport { arrow, useFloating };\n","function o(f){return r=>{f.forEach(n=>{typeof n==\"function\"?n(r):n!=null&&(n.current=r)})}}export{o as mergeRefs};\n//# sourceMappingURL=index.mjs.map\n","import {\n  arrow,\n  autoUpdate,\n  flip,\n  offset as offsetMiddleware,\n  Placement,\n  ReferenceType,\n  shift,\n  size,\n  useFloating,\n} from '@floating-ui/react-dom';\nimport {CSSProperties, Ref, useMemo, useRef} from 'react';\nimport {mergeRefs} from 'react-merge-refs';\nimport {Options as OffsetOptions} from '@floating-ui/core/src/middleware/offset';\nimport {UseFloatingProps} from '@floating-ui/react-dom/src/types';\n\ninterface Props {\n  floatingWidth?: 'auto' | 'matchTrigger';\n  ref?: Ref<HTMLElement>;\n  disablePositioning?: boolean;\n  placement?: Placement;\n  offset?: OffsetOptions;\n  showArrow?: boolean;\n}\nexport function useFloatingPosition({\n  floatingWidth,\n  ref,\n  disablePositioning = false,\n  placement = 'bottom',\n  offset = 2,\n  showArrow = false,\n}: Props) {\n  const arrowRef = useRef<HTMLElement>(null);\n\n  const floatingConfig: UseFloatingProps = {placement};\n\n  if (!disablePositioning) {\n    floatingConfig.whileElementsMounted = autoUpdate;\n    floatingConfig.middleware = [\n      offsetMiddleware(offset),\n      flip({padding: 16}),\n      shift({padding: 16}),\n      size({\n        apply({rects, availableHeight, availableWidth, elements}) {\n          if (floatingWidth === 'matchTrigger') {\n            Object.assign(elements.floating.style, {\n              width: `${rects.reference.width}px`,\n              maxWidth: `${availableWidth}`,\n              maxHeight: `${Math.min(availableHeight, 420)}px`,\n            });\n          }\n        },\n        padding: 16,\n      }),\n    ];\n    if (showArrow) {\n      floatingConfig.middleware.push(arrow({element: arrowRef}));\n    }\n  }\n\n  const floatingProps = useFloating(floatingConfig);\n\n  const mergedReferenceRef = useMemo(\n    () => mergeRefs<ReferenceType>([ref!, floatingProps.reference]),\n    [floatingProps.reference, ref]\n  );\n\n  const {x: arrowX, y: arrowY} = floatingProps.middlewareData.arrow || {};\n\n  const staticSide = {\n    top: 'bottom',\n    right: 'left',\n    bottom: 'top',\n    left: 'right',\n  }[floatingProps.placement.split('-')[0]]!;\n\n  const arrowStyle: CSSProperties = {\n    left: arrowX,\n    top: arrowY,\n    right: '',\n    bottom: '',\n    [staticSide]: '-4px',\n  };\n\n  return {\n    ...floatingProps,\n    reference: mergedReferenceRef,\n    arrowRef,\n    arrowStyle,\n  };\n}\n","import React, {\n  Ref,\n  useCallback,\n  useId,\n  useMemo,\n  useRef,\n  useState,\n} from \"react\";\nimport { useControlledState } from \"@react-stately/utils\";\nimport {\n  buildListboxCollection,\n  CollectionItem,\n} from \"./build-listbox-collection\";\nimport { useFloatingPosition } from \"../../overlays/floating-position\";\nimport {\n  ListBoxChildren,\n  ListboxProps,\n  PrimitiveValue,\n  UseListboxReturn,\n} from \"./types\";\nimport { VirtualElement } from \"@floating-ui/react-dom\";\n\nexport function useListbox<T>(\n  props: ListboxProps & ListBoxChildren<T>,\n  ref?: Ref<HTMLElement>\n): UseListboxReturn {\n  const {\n    children,\n    items,\n    role = \"listbox\",\n    virtualFocus,\n    loopFocus = false,\n    onItemSelected,\n    clearInputOnItemSelection,\n    floatingWidth = \"matchTrigger\",\n    floatingMinWidth,\n    offset,\n    placement,\n    showCheckmark,\n    showEmptyMessage,\n    maxItems,\n    isAsync,\n  } = props;\n  const selectionMode = props.selectionMode || \"none\";\n  const id = useId();\n  const listboxId = `${id}-listbox`;\n\n  // controlled state for text input (if in combobox mode)\n  const [inputValue, setInputValue] = useControlledState(\n    props.inputValue,\n    props.defaultInputValue || \"\",\n    props.onInputValueChange\n  );\n\n  // mostly for combobox, so can show all collection items on dropdown icon click, even if user has filtered via input\n  const [activeCollection, setActiveCollection] = useState<\"all\" | \"filtered\">(\n    \"all\"\n  );\n\n  const collections = buildListboxCollection({\n    children,\n    items,\n    inputValue,\n    maxItems,\n  });\n  const collection =\n    activeCollection === \"all\"\n      ? collections.collection\n      : collections.filteredCollection;\n\n  // items for keyboard navigation\n  const listItemsRef = useRef<Array<HTMLElement | null>>([]);\n\n  // plain text labels for typeahead\n  const listContent: (string | null)[] = useMemo(() => {\n    return [...collection.values()].map((o) =>\n      o.isDisabled ? null : o.textLabel\n    );\n  }, [collection]);\n\n  // state for currently selected values (always array, even in single selection mode)\n  const { selectedValues, selectValues } = useControlledSelection(props);\n\n  const [isOpen, setIsOpen] = useControlledState(\n    props.isOpen,\n    props.defaultIsOpen,\n    props.onOpenChange\n  );\n  const [activeIndex, setActiveIndex] = useState<number | null>(null);\n\n  // handle listbox positioning relative to trigger\n  const floatingProps = useFloatingPosition({\n    floatingWidth,\n    ref,\n    placement,\n    offset,\n  });\n  const { refs, floating, strategy, x, y } = floatingProps;\n\n  // handle selection state for syncing with active index in keyboard navigation\n  const selectedOption =\n    selectionMode === \"none\" ? undefined : collection.get(selectedValues[0]);\n  const selectedIndex =\n    selectionMode === \"none\" ? undefined : selectedOption?.index;\n  const setSelectedIndex = (index: number) => {\n    if (selectionMode !== \"none\") {\n      const item = [...collection.values()][index];\n      if (item) {\n        selectValues(item.value);\n      }\n    }\n  };\n\n  // focus and scroll to specified index, in both virtual and regular mode.\n  // will also skip disabled indices and focus next or previous non-disabled index instead\n  const focusItem = useCallback(\n    (fallbackOperation: \"increment\" | \"decrement\", newIndex: number) => {\n      const items = [...collection.values()];\n      const allItemsDisabled = !items.find((i) => !i.isDisabled);\n      const lastIndex = collection.size - 1;\n\n      // invalid index\n      if (\n        newIndex == null ||\n        !collection.size ||\n        newIndex > lastIndex ||\n        newIndex < 0 ||\n        allItemsDisabled\n      ) {\n        setActiveIndex(null);\n        return;\n      }\n\n      // get next or previous non-disabled item\n      newIndex = getNonDisabledIndex(\n        items,\n        newIndex,\n        loopFocus,\n        fallbackOperation\n      );\n\n      setActiveIndex(newIndex);\n\n      if (virtualFocus) {\n        listItemsRef.current[newIndex]?.scrollIntoView({\n          block: \"nearest\",\n        });\n      } else {\n        listItemsRef.current[newIndex]?.focus();\n      }\n    },\n    [collection, virtualFocus, loopFocus]\n  );\n\n  const onInputChange = useCallback(\n    (e: React.ChangeEvent<HTMLInputElement>) => {\n      setInputValue(e.target.value);\n\n      // if listbox is async, filtering will happen on backend\n      if (!isAsync) {\n        setActiveCollection(e.target.value.trim() ? \"filtered\" : \"all\");\n      }\n\n      if (e.target.value) {\n        setIsOpen(true);\n      } else {\n        // deselect currently selected option if user fully clears the input\n        selectValues(\"\");\n      }\n    },\n    [setInputValue, setIsOpen, setActiveCollection, selectValues, isAsync]\n  );\n\n  const handleItemSelection = (value: PrimitiveValue) => {\n    if (selectionMode !== \"none\") {\n      selectValues(value);\n    } else {\n      const reference = refs.reference.current as\n        | HTMLElement\n        | VirtualElement\n        | null;\n      if (reference && \"focus\" in reference) {\n        reference.focus();\n      }\n    }\n    // is combobox\n    if (virtualFocus) {\n      setInputValue(clearInputOnItemSelection ? \"\" : `${value}`);\n    }\n    setIsOpen(false);\n    setActiveIndex(null);\n    onItemSelected?.(value);\n  };\n\n  return {\n    // even handlers\n    handleItemSelection,\n    onInputChange,\n    loopFocus,\n\n    // config\n    floatingWidth,\n    floatingMinWidth,\n    showCheckmark,\n    collection,\n    virtualFocus,\n    focusItem,\n    showEmptyMessage,\n\n    // floating ui\n    refs,\n    reference: floatingProps.reference,\n    floating,\n    positionStyle: {\n      position: strategy,\n      top: y ?? \"\",\n      left: x ?? \"\",\n    },\n\n    listContent,\n    listItemsRef,\n    listboxId,\n    role,\n\n    state: {\n      // currently focused or active (if virtual focus) option\n      activeIndex,\n      setActiveIndex,\n      selectedIndex,\n      setSelectedIndex,\n      selectionMode,\n      selectedValues,\n      selectValues,\n      inputValue,\n      setInputValue,\n      isOpen,\n      setIsOpen,\n      setActiveCollection,\n    },\n  };\n}\n\nfunction getNonDisabledIndex(\n  items: CollectionItem<unknown>[],\n  newIndex: number,\n  loopFocus: boolean,\n  operation: \"increment\" | \"decrement\"\n) {\n  const lastIndex = items.length - 1;\n  while (items[newIndex]?.isDisabled) {\n    if (operation === \"increment\") {\n      newIndex++;\n      if (newIndex >= lastIndex) {\n        // loop from the start, if end reached\n        if (loopFocus) {\n          newIndex = 0;\n          // if focus is not looping, stay on the previous index\n        } else {\n          return newIndex - 1;\n        }\n      }\n    } else {\n      newIndex--;\n      // loop from the end, if start reached\n      if (newIndex < 0) {\n        if (loopFocus) {\n          newIndex = lastIndex;\n          // if focus is not looping, stay on the previous index\n        } else {\n          return newIndex + 1;\n        }\n      }\n    }\n  }\n\n  return newIndex;\n}\n\nfunction useControlledSelection(props: ListboxProps) {\n  const { selectionMode, allowEmptySelection } = props;\n  const selectionEnabled =\n    selectionMode === \"single\" || selectionMode === \"multiple\";\n\n  const [stateValues, setStateValues] = useControlledState<any>(\n    !selectionEnabled ? undefined : props.selectedValue,\n    !selectionEnabled ? undefined : props.defaultSelectedValue,\n    !selectionEnabled ? undefined : props.onSelectionChange\n  );\n\n  const selectedValues = useMemo(() => {\n    if (stateValues == null || stateValues === \"\") {\n      return [];\n    }\n    return Array.isArray(stateValues) ? stateValues : [stateValues];\n  }, [stateValues]);\n\n  const selectValues = useCallback(\n    (mixedValue: PrimitiveValue | PrimitiveValue[] | null) => {\n      const newValues = Array.isArray(mixedValue) ? mixedValue : [mixedValue];\n      if (selectionMode === \"single\") {\n        setStateValues(newValues[0]);\n      } else {\n        newValues.forEach((newValue) => {\n          const index = selectedValues.indexOf(newValue);\n          if (index === -1) {\n            selectedValues.push(newValue);\n            setStateValues([...selectedValues]);\n          } else if (selectedValues.length > 1 || allowEmptySelection) {\n            selectedValues.splice(index, 1);\n            setStateValues([...selectedValues]);\n          }\n        });\n      }\n    },\n    [allowEmptySelection, selectedValues, selectionMode, setStateValues]\n  );\n\n  return {\n    selectedValues,\n    selectValues,\n  };\n}\n","import {createContext, useContext} from 'react';\nimport {UseListboxReturn} from './types';\n\ntype ListBoxReturnType = UseListboxReturn;\nexport type ListboxContextValue = ListBoxReturnType;\n\nexport const ListBoxContext = createContext<ListboxContextValue>(null!);\n\nexport function useListboxContext() {\n  return useContext(ListBoxContext);\n}\n","import {createSvgIcon} from '../create-svg-icon';\n\nexport const CheckIcon = createSvgIcon(\n  <path d=\"M9 16.17 4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41L9 16.17z\" />\n, 'CheckOutlined');\n","import clsx from 'clsx';\nimport React, {ComponentPropsWithoutRef, ReactNode} from 'react';\nimport {CheckIcon} from '../../icons/material/Check';\n\nexport interface ListItemBaseProps extends ComponentPropsWithoutRef<'div'> {\n  startIcon?: ReactNode;\n  endIcon?: ReactNode;\n  endSection?: ReactNode;\n  description?: ReactNode;\n  textLabel?: string;\n  capitalizeFirst?: boolean;\n  isSelected?: boolean;\n  isDisabled?: boolean;\n  isActive?: boolean;\n  className?: string;\n  showCheckmark?: boolean;\n}\n\nexport const ListItemBase = React.forwardRef<HTMLDivElement, ListItemBaseProps>(\n  (props, ref) => {\n    let {\n      startIcon,\n      capitalizeFirst,\n      children,\n      description,\n      endIcon,\n      endSection,\n      isDisabled,\n      isActive,\n      isSelected,\n      showCheckmark,\n      ...domProps\n    } = props;\n\n    if (!startIcon && showCheckmark) {\n      startIcon = (\n        <CheckIcon\n          size=\"sm\"\n          className={clsx('text-primary', !isSelected && 'invisible')}\n        />\n      );\n    }\n\n    const iconClassName = clsx(\n      'icon-sm rounded overflow-hidden flex-shrink-0',\n      !isDisabled && 'text-muted'\n    );\n\n    return (\n      <div\n        {...domProps}\n        aria-disabled={isDisabled}\n        className={itemClassName(props)}\n        ref={ref}\n      >\n        {startIcon && <div className={iconClassName}>{startIcon}</div>}\n        <div\n          className={clsx(\n            'mr-auto',\n            capitalizeFirst && 'first-letter:capitalize'\n          )}\n        >\n          {children}\n          {description && (\n            <div\n              className={clsx(\n                'text-xs mt-4 whitespace-normal',\n                isDisabled ? 'text-disabled' : 'text-muted'\n              )}\n            >\n              {description}\n            </div>\n          )}\n        </div>\n        {(endIcon || endSection) && (\n          <div className={endIcon ? iconClassName : 'text-muted'}>\n            {endIcon || endSection}\n          </div>\n        )}\n      </div>\n    );\n  }\n);\n\ninterface Props {\n  isSelected?: boolean;\n  isDisabled?: boolean;\n  isActive?: boolean;\n  className?: string;\n  showCheckmark?: boolean;\n}\nfunction itemClassName({\n  className,\n  isSelected,\n  isActive,\n  isDisabled,\n  showCheckmark,\n}: Props): string {\n  let state: string = '';\n  if (isDisabled) {\n    state = 'text-disabled pointer-events-none';\n  } else if (isSelected) {\n    if (isActive) {\n      state = 'bg-primary/focus';\n    } else {\n      state = 'bg-primary/selected hover:bg-primary/focus';\n    }\n  } else if (isActive) {\n    state = 'hover:bg-fg-base/15 bg-focus';\n  } else {\n    state = 'hover:bg-hover';\n  }\n\n  return clsx(\n    'w-full select-none outline-none cursor-pointer',\n    'py-8 text-sm truncate flex items-center gap-10 text-main',\n    showCheckmark ? 'px-8' : 'px-20',\n    state,\n    className\n  );\n}\n","import React from 'react';\nimport {useListboxContext} from './listbox-context';\nimport {ListItemBase, ListItemBaseProps} from '../../list/list-item-base';\n\nexport interface ListboxItemProps extends ListItemBaseProps {\n  value: any;\n  textLabel?: string;\n  onSelected?: () => void;\n  onKeyDown?: any;\n  tabIndex?: number;\n  className?: string;\n  capitalizeFirst?: boolean;\n}\nexport function Item({\n  children,\n  value,\n  startIcon,\n  endIcon,\n  endSection,\n  description,\n  capitalizeFirst,\n  textLabel,\n  isDisabled,\n  onSelected,\n  onClick,\n  ...domProps\n}: ListboxItemProps) {\n  const {\n    collection,\n    showCheckmark,\n    virtualFocus,\n    listboxId,\n    role,\n    listItemsRef,\n    handleItemSelection,\n    state: {selectedValues, activeIndex, setActiveIndex},\n  } = useListboxContext();\n  const isSelected = selectedValues.includes(value);\n  const index = collection.get(value)?.index;\n  const isActive = activeIndex === index;\n\n  // context value might get out of sync with item due to AnimatePresence\n  if (index == null) {\n    return null;\n  }\n\n  const tabIndex = isActive && !isDisabled ? -1 : 0;\n\n  return (\n    <ListItemBase\n      {...domProps}\n      onFocus={() => {\n        if (!virtualFocus) {\n          setActiveIndex(index);\n        }\n      }}\n      onPointerEnter={e => {\n        setActiveIndex(index);\n        if (!virtualFocus) {\n          e.currentTarget.focus();\n        }\n      }}\n      onPointerDown={e => {\n        if (virtualFocus) {\n          e.preventDefault();\n        }\n      }}\n      onKeyDown={e => {\n        if (e.key === 'Enter' || e.key === ' ') {\n          e.preventDefault();\n          handleItemSelection(value);\n          onSelected?.();\n        }\n      }}\n      onClick={e => {\n        handleItemSelection(value);\n        onSelected?.();\n        onClick?.(e);\n      }}\n      ref={node => (listItemsRef.current[index] = node)}\n      id={`${listboxId}-${index}`}\n      role={role === 'menu' ? 'menuitem' : 'option'}\n      tabIndex={virtualFocus ? undefined : tabIndex}\n      aria-selected={isActive && isSelected}\n      showCheckmark={showCheckmark}\n      isDisabled={isDisabled}\n      isActive={isActive}\n      isSelected={isSelected}\n      startIcon={startIcon}\n      description={description}\n      endIcon={endIcon}\n      endSection={endSection}\n      capitalizeFirst={capitalizeFirst}\n    >\n      {children}\n    </ListItemBase>\n  );\n}\n","import {useIsSSR} from '@react-aria/ssr';\n\nconst MOBILE_SCREEN_WIDTH = 768;\n\nexport function useIsMobileDevice(): boolean {\n  const isSSR = useIsSSR();\n  if (isSSR || typeof window === 'undefined') {\n    return false;\n  }\n\n  return window.screen.width <= MOBILE_SCREEN_WIDTH;\n}\n","import {HTMLMotionProps} from 'framer-motion';\n\nexport const PopoverAnimation: HTMLMotionProps<'div'> = {\n  initial: {opacity: 0, y: 5},\n  animate: {opacity: 1, y: 0},\n  exit: {opacity: 0, y: 5},\n  transition: {type: 'tween', duration: 0.125},\n};\n","import {useViewportSize} from '@react-aria/utils';\n\nexport function useOverlayViewport(): Record<string, string> {\n  const {width, height} = useViewportSize();\n  return {\n    '--be-viewport-height': `${height}px`,\n    '--be-viewport-width': `${width}px`,\n  };\n}\n","import {mergeProps as $bx7SL$mergeProps, useSyncRef as $bx7SL$useSyncRef, useGlobalListeners as $bx7SL$useGlobalListeners, focusWithoutScrolling as $bx7SL$focusWithoutScrolling, isIOS as $bx7SL$isIOS, runAfterTransition as $bx7SL$runAfterTransition, useLayoutEffect as $bx7SL$useLayoutEffect, isMac as $bx7SL$isMac, useEvent as $bx7SL$useEvent, useDescription as $bx7SL$useDescription} from \"@react-aria/utils\";\nimport $bx7SL$react, {useRef as $bx7SL$useRef, useContext as $bx7SL$useContext, useState as $bx7SL$useState, useMemo as $bx7SL$useMemo, useEffect as $bx7SL$useEffect, useCallback as $bx7SL$useCallback} from \"react\";\n\n\n\n// Note that state only matters here for iOS. Non-iOS gets user-select: none applied to the target element\n// rather than at the document level so we just need to apply/remove user-select: none for each pressed element individually\nlet $14c0b72509d70225$var$state = 'default';\nlet $14c0b72509d70225$var$savedUserSelect = '';\nlet $14c0b72509d70225$var$modifiedElementMap = new WeakMap();\nfunction $14c0b72509d70225$export$16a4697467175487(target) {\n    if ($bx7SL$isIOS()) {\n        if ($14c0b72509d70225$var$state === 'default') {\n            $14c0b72509d70225$var$savedUserSelect = document.documentElement.style.webkitUserSelect;\n            document.documentElement.style.webkitUserSelect = 'none';\n        }\n        $14c0b72509d70225$var$state = 'disabled';\n    } else if (target instanceof HTMLElement || target instanceof SVGElement) {\n        // If not iOS, store the target's original user-select and change to user-select: none\n        // Ignore state since it doesn't apply for non iOS\n        $14c0b72509d70225$var$modifiedElementMap.set(target, target.style.userSelect);\n        target.style.userSelect = 'none';\n    }\n}\nfunction $14c0b72509d70225$export$b0d6fa1ab32e3295(target) {\n    if ($bx7SL$isIOS()) {\n        // If the state is already default, there's nothing to do.\n        // If it is restoring, then there's no need to queue a second restore.\n        if ($14c0b72509d70225$var$state !== 'disabled') return;\n        $14c0b72509d70225$var$state = 'restoring';\n        // There appears to be a delay on iOS where selection still might occur\n        // after pointer up, so wait a bit before removing user-select.\n        setTimeout(()=>{\n            // Wait for any CSS transitions to complete so we don't recompute style\n            // for the whole page in the middle of the animation and cause jank.\n            $bx7SL$runAfterTransition(()=>{\n                // Avoid race conditions\n                if ($14c0b72509d70225$var$state === 'restoring') {\n                    if (document.documentElement.style.webkitUserSelect === 'none') document.documentElement.style.webkitUserSelect = $14c0b72509d70225$var$savedUserSelect || '';\n                    $14c0b72509d70225$var$savedUserSelect = '';\n                    $14c0b72509d70225$var$state = 'default';\n                }\n            });\n        }, 300);\n    } else if (target instanceof HTMLElement || target instanceof SVGElement) // If not iOS, restore the target's original user-select if any\n    // Ignore state since it doesn't apply for non iOS\n    {\n        if (target && $14c0b72509d70225$var$modifiedElementMap.has(target)) {\n            let targetOldUserSelect = $14c0b72509d70225$var$modifiedElementMap.get(target);\n            if (target.style.userSelect === 'none') target.style.userSelect = targetOldUserSelect;\n            if (target.getAttribute('style') === '') target.removeAttribute('style');\n            $14c0b72509d70225$var$modifiedElementMap.delete(target);\n        }\n    }\n}\n\n\n\n\n\nfunction $8a9cb279dc87e130$export$60278871457622de(event) {\n    // JAWS/NVDA with Firefox.\n    if (event.mozInputSource === 0 && event.isTrusted) return true;\n    return event.detail === 0 && !event.pointerType;\n}\nclass $8a9cb279dc87e130$export$905e7fc544a71f36 {\n    isDefaultPrevented() {\n        return this.nativeEvent.defaultPrevented;\n    }\n    preventDefault() {\n        this.defaultPrevented = true;\n        this.nativeEvent.preventDefault();\n    }\n    stopPropagation() {\n        this.nativeEvent.stopPropagation();\n        this.isPropagationStopped = ()=>true\n        ;\n    }\n    isPropagationStopped() {\n        return false;\n    }\n    persist() {\n    }\n    constructor(type, nativeEvent){\n        this.nativeEvent = nativeEvent;\n        this.target = nativeEvent.target;\n        this.currentTarget = nativeEvent.currentTarget;\n        this.relatedTarget = nativeEvent.relatedTarget;\n        this.bubbles = nativeEvent.bubbles;\n        this.cancelable = nativeEvent.cancelable;\n        this.defaultPrevented = nativeEvent.defaultPrevented;\n        this.eventPhase = nativeEvent.eventPhase;\n        this.isTrusted = nativeEvent.isTrusted;\n        this.timeStamp = nativeEvent.timeStamp;\n        this.type = type;\n    }\n}\nfunction $8a9cb279dc87e130$export$715c682d09d639cc(onBlur) {\n    let stateRef = $bx7SL$useRef({\n        isFocused: false,\n        onBlur: onBlur,\n        observer: null\n    });\n    stateRef.current.onBlur = onBlur;\n    // Clean up MutationObserver on unmount. See below.\n    // eslint-disable-next-line arrow-body-style\n    $bx7SL$useLayoutEffect(()=>{\n        const state = stateRef.current;\n        return ()=>{\n            if (state.observer) {\n                state.observer.disconnect();\n                state.observer = null;\n            }\n        };\n    }, []);\n    // This function is called during a React onFocus event.\n    return $bx7SL$useCallback((e1)=>{\n        // React does not fire onBlur when an element is disabled. https://github.com/facebook/react/issues/9142\n        // Most browsers fire a native focusout event in this case, except for Firefox. In that case, we use a\n        // MutationObserver to watch for the disabled attribute, and dispatch these events ourselves.\n        // For browsers that do, focusout fires before the MutationObserver, so onBlur should not fire twice.\n        if (e1.target instanceof HTMLButtonElement || e1.target instanceof HTMLInputElement || e1.target instanceof HTMLTextAreaElement || e1.target instanceof HTMLSelectElement) {\n            stateRef.current.isFocused = true;\n            let target = e1.target;\n            let onBlurHandler = (e)=>{\n                var // For backward compatibility, dispatch a (fake) React synthetic event.\n                _current, ref;\n                stateRef.current.isFocused = false;\n                if (target.disabled) (ref = (_current = stateRef.current).onBlur) === null || ref === void 0 ? void 0 : ref.call(_current, new $8a9cb279dc87e130$export$905e7fc544a71f36('blur', e));\n                // We no longer need the MutationObserver once the target is blurred.\n                if (stateRef.current.observer) {\n                    stateRef.current.observer.disconnect();\n                    stateRef.current.observer = null;\n                }\n            };\n            target.addEventListener('focusout', onBlurHandler, {\n                once: true\n            });\n            stateRef.current.observer = new MutationObserver(()=>{\n                if (stateRef.current.isFocused && target.disabled) {\n                    stateRef.current.observer.disconnect();\n                    target.dispatchEvent(new FocusEvent('blur'));\n                    target.dispatchEvent(new FocusEvent('focusout', {\n                        bubbles: true\n                    }));\n                }\n            });\n            stateRef.current.observer.observe(target, {\n                attributes: true,\n                attributeFilter: [\n                    'disabled'\n                ]\n            });\n        }\n    }, []);\n}\n\n\n\nconst $ae1eeba8b9eafd08$export$5165eccb35aaadb5 = $bx7SL$react.createContext(null);\n$ae1eeba8b9eafd08$export$5165eccb35aaadb5.displayName = 'PressResponderContext';\n\n\n\nfunction $f6c31cce2adf654f$var$usePressResponderContext(props) {\n    // Consume context from <PressResponder> and merge with props.\n    let context = $bx7SL$useContext($ae1eeba8b9eafd08$export$5165eccb35aaadb5);\n    if (context) {\n        let { register: register , ...contextProps } = context;\n        props = $bx7SL$mergeProps(contextProps, props);\n        register();\n    }\n    $bx7SL$useSyncRef(context, props.ref);\n    return props;\n}\nfunction $f6c31cce2adf654f$export$45712eceda6fad21(props) {\n    let { onPress: onPress1 , onPressChange: onPressChange1 , onPressStart: onPressStart1 , onPressEnd: onPressEnd1 , onPressUp: onPressUp1 , isDisabled: isDisabled1 , isPressed: isPressedProp , preventFocusOnPress: preventFocusOnPress , shouldCancelOnPointerExit: shouldCancelOnPointerExit , allowTextSelectionOnPress: allowTextSelectionOnPress , // eslint-disable-next-line @typescript-eslint/no-unused-vars\n    ref: _ , ...domProps } = $f6c31cce2adf654f$var$usePressResponderContext(props);\n    let propsRef = $bx7SL$useRef(null);\n    propsRef.current = {\n        onPress: onPress1,\n        onPressChange: onPressChange1,\n        onPressStart: onPressStart1,\n        onPressEnd: onPressEnd1,\n        onPressUp: onPressUp1,\n        isDisabled: isDisabled1,\n        shouldCancelOnPointerExit: shouldCancelOnPointerExit\n    };\n    let [isPressed, setPressed] = $bx7SL$useState(false);\n    let ref = $bx7SL$useRef({\n        isPressed: false,\n        ignoreEmulatedMouseEvents: false,\n        ignoreClickAfterPress: false,\n        didFirePressStart: false,\n        activePointerId: null,\n        target: null,\n        isOverTarget: false,\n        pointerType: null\n    });\n    let { addGlobalListener: addGlobalListener , removeAllGlobalListeners: removeAllGlobalListeners  } = $bx7SL$useGlobalListeners();\n    let pressProps1 = $bx7SL$useMemo(()=>{\n        let state = ref.current;\n        let triggerPressStart = (originalEvent, pointerType)=>{\n            let { onPressStart: onPressStart , onPressChange: onPressChange , isDisabled: isDisabled  } = propsRef.current;\n            if (isDisabled || state.didFirePressStart) return;\n            if (onPressStart) onPressStart({\n                type: 'pressstart',\n                pointerType: pointerType,\n                target: originalEvent.currentTarget,\n                shiftKey: originalEvent.shiftKey,\n                metaKey: originalEvent.metaKey,\n                ctrlKey: originalEvent.ctrlKey,\n                altKey: originalEvent.altKey\n            });\n            if (onPressChange) onPressChange(true);\n            state.didFirePressStart = true;\n            setPressed(true);\n        };\n        let triggerPressEnd = (originalEvent, pointerType, wasPressed = true)=>{\n            let { onPressEnd: onPressEnd , onPressChange: onPressChange , onPress: onPress , isDisabled: isDisabled  } = propsRef.current;\n            if (!state.didFirePressStart) return;\n            state.ignoreClickAfterPress = true;\n            state.didFirePressStart = false;\n            if (onPressEnd) onPressEnd({\n                type: 'pressend',\n                pointerType: pointerType,\n                target: originalEvent.currentTarget,\n                shiftKey: originalEvent.shiftKey,\n                metaKey: originalEvent.metaKey,\n                ctrlKey: originalEvent.ctrlKey,\n                altKey: originalEvent.altKey\n            });\n            if (onPressChange) onPressChange(false);\n            setPressed(false);\n            if (onPress && wasPressed && !isDisabled) onPress({\n                type: 'press',\n                pointerType: pointerType,\n                target: originalEvent.currentTarget,\n                shiftKey: originalEvent.shiftKey,\n                metaKey: originalEvent.metaKey,\n                ctrlKey: originalEvent.ctrlKey,\n                altKey: originalEvent.altKey\n            });\n        };\n        let triggerPressUp = (originalEvent, pointerType)=>{\n            let { onPressUp: onPressUp , isDisabled: isDisabled  } = propsRef.current;\n            if (isDisabled) return;\n            if (onPressUp) onPressUp({\n                type: 'pressup',\n                pointerType: pointerType,\n                target: originalEvent.currentTarget,\n                shiftKey: originalEvent.shiftKey,\n                metaKey: originalEvent.metaKey,\n                ctrlKey: originalEvent.ctrlKey,\n                altKey: originalEvent.altKey\n            });\n        };\n        let cancel = (e)=>{\n            if (state.isPressed) {\n                if (state.isOverTarget) triggerPressEnd($f6c31cce2adf654f$var$createEvent(state.target, e), state.pointerType, false);\n                state.isPressed = false;\n                state.isOverTarget = false;\n                state.activePointerId = null;\n                state.pointerType = null;\n                removeAllGlobalListeners();\n                if (!allowTextSelectionOnPress) $14c0b72509d70225$export$b0d6fa1ab32e3295(state.target);\n            }\n        };\n        let pressProps = {\n            onKeyDown (e) {\n                if ($f6c31cce2adf654f$var$isValidKeyboardEvent(e.nativeEvent, e.currentTarget) && e.currentTarget.contains(e.target)) {\n                    if ($f6c31cce2adf654f$var$shouldPreventDefaultKeyboard(e.target, e.key)) e.preventDefault();\n                    e.stopPropagation();\n                    // If the event is repeating, it may have started on a different element\n                    // after which focus moved to the current element. Ignore these events and\n                    // only handle the first key down event.\n                    if (!state.isPressed && !e.repeat) {\n                        state.target = e.currentTarget;\n                        state.isPressed = true;\n                        triggerPressStart(e, 'keyboard');\n                        // Focus may move before the key up event, so register the event on the document\n                        // instead of the same element where the key down event occurred.\n                        addGlobalListener(document, 'keyup', onKeyUp, false);\n                    }\n                } else if (e.key === 'Enter' && $f6c31cce2adf654f$var$isHTMLAnchorLink(e.currentTarget)) // If the target is a link, we won't have handled this above because we want the default\n                // browser behavior to open the link when pressing Enter. But we still need to prevent\n                // default so that elements above do not also handle it (e.g. table row).\n                e.stopPropagation();\n            },\n            onKeyUp (e) {\n                if ($f6c31cce2adf654f$var$isValidKeyboardEvent(e.nativeEvent, e.currentTarget) && !e.repeat && e.currentTarget.contains(e.target)) triggerPressUp($f6c31cce2adf654f$var$createEvent(state.target, e), 'keyboard');\n            },\n            onClick (e) {\n                if (e && !e.currentTarget.contains(e.target)) return;\n                if (e && e.button === 0) {\n                    e.stopPropagation();\n                    if (isDisabled1) e.preventDefault();\n                    // If triggered from a screen reader or by using element.click(),\n                    // trigger as if it were a keyboard click.\n                    if (!state.ignoreClickAfterPress && !state.ignoreEmulatedMouseEvents && (state.pointerType === 'virtual' || $8a9cb279dc87e130$export$60278871457622de(e.nativeEvent))) {\n                        // Ensure the element receives focus (VoiceOver on iOS does not do this)\n                        if (!isDisabled1 && !preventFocusOnPress) $bx7SL$focusWithoutScrolling(e.currentTarget);\n                        triggerPressStart(e, 'virtual');\n                        triggerPressUp(e, 'virtual');\n                        triggerPressEnd(e, 'virtual');\n                    }\n                    state.ignoreEmulatedMouseEvents = false;\n                    state.ignoreClickAfterPress = false;\n                }\n            }\n        };\n        let onKeyUp = (e)=>{\n            if (state.isPressed && $f6c31cce2adf654f$var$isValidKeyboardEvent(e, state.target)) {\n                if ($f6c31cce2adf654f$var$shouldPreventDefaultKeyboard(e.target, e.key)) e.preventDefault();\n                e.stopPropagation();\n                state.isPressed = false;\n                let target = e.target;\n                triggerPressEnd($f6c31cce2adf654f$var$createEvent(state.target, e), 'keyboard', state.target.contains(target));\n                removeAllGlobalListeners();\n                // If the target is a link, trigger the click method to open the URL,\n                // but defer triggering pressEnd until onClick event handler.\n                if (state.target instanceof HTMLElement && state.target.contains(target) && ($f6c31cce2adf654f$var$isHTMLAnchorLink(state.target) || state.target.getAttribute('role') === 'link')) state.target.click();\n            }\n        };\n        if (typeof PointerEvent !== 'undefined') {\n            pressProps.onPointerDown = (e)=>{\n                // Only handle left clicks, and ignore events that bubbled through portals.\n                if (e.button !== 0 || !e.currentTarget.contains(e.target)) return;\n                // iOS safari fires pointer events from VoiceOver with incorrect coordinates/target.\n                // Ignore and let the onClick handler take care of it instead.\n                // https://bugs.webkit.org/show_bug.cgi?id=222627\n                // https://bugs.webkit.org/show_bug.cgi?id=223202\n                if ($f6c31cce2adf654f$var$isVirtualPointerEvent(e.nativeEvent)) {\n                    state.pointerType = 'virtual';\n                    return;\n                }\n                // Due to browser inconsistencies, especially on mobile browsers, we prevent\n                // default on pointer down and handle focusing the pressable element ourselves.\n                if ($f6c31cce2adf654f$var$shouldPreventDefault(e.currentTarget)) e.preventDefault();\n                state.pointerType = e.pointerType;\n                e.stopPropagation();\n                if (!state.isPressed) {\n                    state.isPressed = true;\n                    state.isOverTarget = true;\n                    state.activePointerId = e.pointerId;\n                    state.target = e.currentTarget;\n                    if (!isDisabled1 && !preventFocusOnPress) $bx7SL$focusWithoutScrolling(e.currentTarget);\n                    if (!allowTextSelectionOnPress) $14c0b72509d70225$export$16a4697467175487(state.target);\n                    triggerPressStart(e, state.pointerType);\n                    addGlobalListener(document, 'pointermove', onPointerMove, false);\n                    addGlobalListener(document, 'pointerup', onPointerUp, false);\n                    addGlobalListener(document, 'pointercancel', onPointerCancel, false);\n                }\n            };\n            pressProps.onMouseDown = (e)=>{\n                if (!e.currentTarget.contains(e.target)) return;\n                if (e.button === 0) {\n                    // Chrome and Firefox on touch Windows devices require mouse down events\n                    // to be canceled in addition to pointer events, or an extra asynchronous\n                    // focus event will be fired.\n                    if ($f6c31cce2adf654f$var$shouldPreventDefault(e.currentTarget)) e.preventDefault();\n                    e.stopPropagation();\n                }\n            };\n            pressProps.onPointerUp = (e)=>{\n                // iOS fires pointerup with zero width and height, so check the pointerType recorded during pointerdown.\n                if (!e.currentTarget.contains(e.target) || state.pointerType === 'virtual') return;\n                // Only handle left clicks\n                // Safari on iOS sometimes fires pointerup events, even\n                // when the touch isn't over the target, so double check.\n                if (e.button === 0 && $f6c31cce2adf654f$var$isOverTarget(e, e.currentTarget)) triggerPressUp(e, state.pointerType || e.pointerType);\n            };\n            // Safari on iOS < 13.2 does not implement pointerenter/pointerleave events correctly.\n            // Use pointer move events instead to implement our own hit testing.\n            // See https://bugs.webkit.org/show_bug.cgi?id=199803\n            let onPointerMove = (e)=>{\n                if (e.pointerId !== state.activePointerId) return;\n                if ($f6c31cce2adf654f$var$isOverTarget(e, state.target)) {\n                    if (!state.isOverTarget) {\n                        state.isOverTarget = true;\n                        triggerPressStart($f6c31cce2adf654f$var$createEvent(state.target, e), state.pointerType);\n                    }\n                } else if (state.isOverTarget) {\n                    state.isOverTarget = false;\n                    triggerPressEnd($f6c31cce2adf654f$var$createEvent(state.target, e), state.pointerType, false);\n                    if (propsRef.current.shouldCancelOnPointerExit) cancel(e);\n                }\n            };\n            let onPointerUp = (e)=>{\n                if (e.pointerId === state.activePointerId && state.isPressed && e.button === 0) {\n                    if ($f6c31cce2adf654f$var$isOverTarget(e, state.target)) triggerPressEnd($f6c31cce2adf654f$var$createEvent(state.target, e), state.pointerType);\n                    else if (state.isOverTarget) triggerPressEnd($f6c31cce2adf654f$var$createEvent(state.target, e), state.pointerType, false);\n                    state.isPressed = false;\n                    state.isOverTarget = false;\n                    state.activePointerId = null;\n                    state.pointerType = null;\n                    removeAllGlobalListeners();\n                    if (!allowTextSelectionOnPress) $14c0b72509d70225$export$b0d6fa1ab32e3295(state.target);\n                }\n            };\n            let onPointerCancel = (e)=>{\n                cancel(e);\n            };\n            pressProps.onDragStart = (e)=>{\n                if (!e.currentTarget.contains(e.target)) return;\n                // Safari does not call onPointerCancel when a drag starts, whereas Chrome and Firefox do.\n                cancel(e);\n            };\n        } else {\n            pressProps.onMouseDown = (e)=>{\n                // Only handle left clicks\n                if (e.button !== 0 || !e.currentTarget.contains(e.target)) return;\n                // Due to browser inconsistencies, especially on mobile browsers, we prevent\n                // default on mouse down and handle focusing the pressable element ourselves.\n                if ($f6c31cce2adf654f$var$shouldPreventDefault(e.currentTarget)) e.preventDefault();\n                e.stopPropagation();\n                if (state.ignoreEmulatedMouseEvents) return;\n                state.isPressed = true;\n                state.isOverTarget = true;\n                state.target = e.currentTarget;\n                state.pointerType = $8a9cb279dc87e130$export$60278871457622de(e.nativeEvent) ? 'virtual' : 'mouse';\n                if (!isDisabled1 && !preventFocusOnPress) $bx7SL$focusWithoutScrolling(e.currentTarget);\n                triggerPressStart(e, state.pointerType);\n                addGlobalListener(document, 'mouseup', onMouseUp, false);\n            };\n            pressProps.onMouseEnter = (e)=>{\n                if (!e.currentTarget.contains(e.target)) return;\n                e.stopPropagation();\n                if (state.isPressed && !state.ignoreEmulatedMouseEvents) {\n                    state.isOverTarget = true;\n                    triggerPressStart(e, state.pointerType);\n                }\n            };\n            pressProps.onMouseLeave = (e)=>{\n                if (!e.currentTarget.contains(e.target)) return;\n                e.stopPropagation();\n                if (state.isPressed && !state.ignoreEmulatedMouseEvents) {\n                    state.isOverTarget = false;\n                    triggerPressEnd(e, state.pointerType, false);\n                    if (propsRef.current.shouldCancelOnPointerExit) cancel(e);\n                }\n            };\n            pressProps.onMouseUp = (e)=>{\n                if (!e.currentTarget.contains(e.target)) return;\n                if (!state.ignoreEmulatedMouseEvents && e.button === 0) triggerPressUp(e, state.pointerType);\n            };\n            let onMouseUp = (e)=>{\n                // Only handle left clicks\n                if (e.button !== 0) return;\n                state.isPressed = false;\n                removeAllGlobalListeners();\n                if (state.ignoreEmulatedMouseEvents) {\n                    state.ignoreEmulatedMouseEvents = false;\n                    return;\n                }\n                if ($f6c31cce2adf654f$var$isOverTarget(e, state.target)) triggerPressEnd($f6c31cce2adf654f$var$createEvent(state.target, e), state.pointerType);\n                else if (state.isOverTarget) triggerPressEnd($f6c31cce2adf654f$var$createEvent(state.target, e), state.pointerType, false);\n                state.isOverTarget = false;\n            };\n            pressProps.onTouchStart = (e)=>{\n                if (!e.currentTarget.contains(e.target)) return;\n                e.stopPropagation();\n                let touch = $f6c31cce2adf654f$var$getTouchFromEvent(e.nativeEvent);\n                if (!touch) return;\n                state.activePointerId = touch.identifier;\n                state.ignoreEmulatedMouseEvents = true;\n                state.isOverTarget = true;\n                state.isPressed = true;\n                state.target = e.currentTarget;\n                state.pointerType = 'touch';\n                // Due to browser inconsistencies, especially on mobile browsers, we prevent default\n                // on the emulated mouse event and handle focusing the pressable element ourselves.\n                if (!isDisabled1 && !preventFocusOnPress) $bx7SL$focusWithoutScrolling(e.currentTarget);\n                if (!allowTextSelectionOnPress) $14c0b72509d70225$export$16a4697467175487(state.target);\n                triggerPressStart(e, state.pointerType);\n                addGlobalListener(window, 'scroll', onScroll, true);\n            };\n            pressProps.onTouchMove = (e)=>{\n                if (!e.currentTarget.contains(e.target)) return;\n                e.stopPropagation();\n                if (!state.isPressed) return;\n                let touch = $f6c31cce2adf654f$var$getTouchById(e.nativeEvent, state.activePointerId);\n                if (touch && $f6c31cce2adf654f$var$isOverTarget(touch, e.currentTarget)) {\n                    if (!state.isOverTarget) {\n                        state.isOverTarget = true;\n                        triggerPressStart(e, state.pointerType);\n                    }\n                } else if (state.isOverTarget) {\n                    state.isOverTarget = false;\n                    triggerPressEnd(e, state.pointerType, false);\n                    if (propsRef.current.shouldCancelOnPointerExit) cancel(e);\n                }\n            };\n            pressProps.onTouchEnd = (e)=>{\n                if (!e.currentTarget.contains(e.target)) return;\n                e.stopPropagation();\n                if (!state.isPressed) return;\n                let touch = $f6c31cce2adf654f$var$getTouchById(e.nativeEvent, state.activePointerId);\n                if (touch && $f6c31cce2adf654f$var$isOverTarget(touch, e.currentTarget)) {\n                    triggerPressUp(e, state.pointerType);\n                    triggerPressEnd(e, state.pointerType);\n                } else if (state.isOverTarget) triggerPressEnd(e, state.pointerType, false);\n                state.isPressed = false;\n                state.activePointerId = null;\n                state.isOverTarget = false;\n                state.ignoreEmulatedMouseEvents = true;\n                if (!allowTextSelectionOnPress) $14c0b72509d70225$export$b0d6fa1ab32e3295(state.target);\n                removeAllGlobalListeners();\n            };\n            pressProps.onTouchCancel = (e)=>{\n                if (!e.currentTarget.contains(e.target)) return;\n                e.stopPropagation();\n                if (state.isPressed) cancel(e);\n            };\n            let onScroll = (e)=>{\n                if (state.isPressed && e.target.contains(state.target)) cancel({\n                    currentTarget: state.target,\n                    shiftKey: false,\n                    ctrlKey: false,\n                    metaKey: false,\n                    altKey: false\n                });\n            };\n            pressProps.onDragStart = (e)=>{\n                if (!e.currentTarget.contains(e.target)) return;\n                cancel(e);\n            };\n        }\n        return pressProps;\n    }, [\n        addGlobalListener,\n        isDisabled1,\n        preventFocusOnPress,\n        removeAllGlobalListeners,\n        allowTextSelectionOnPress\n    ]);\n    // Remove user-select: none in case component unmounts immediately after pressStart\n    // eslint-disable-next-line arrow-body-style\n    $bx7SL$useEffect(()=>{\n        return ()=>{\n            if (!allowTextSelectionOnPress) $14c0b72509d70225$export$b0d6fa1ab32e3295(ref.current.target);\n        };\n    }, [\n        allowTextSelectionOnPress\n    ]);\n    return {\n        isPressed: isPressedProp || isPressed,\n        pressProps: $bx7SL$mergeProps(domProps, pressProps1)\n    };\n}\nfunction $f6c31cce2adf654f$var$isHTMLAnchorLink(target) {\n    return target.tagName === 'A' && target.hasAttribute('href');\n}\nfunction $f6c31cce2adf654f$var$isValidKeyboardEvent(event, currentTarget) {\n    const { key: key , code: code  } = event;\n    const element = currentTarget;\n    const role = element.getAttribute('role');\n    // Accessibility for keyboards. Space and Enter only.\n    // \"Spacebar\" is for IE 11\n    return (key === 'Enter' || key === ' ' || key === 'Spacebar' || code === 'Space') && !(element instanceof HTMLInputElement && !$f6c31cce2adf654f$var$isValidInputKey(element, key) || element instanceof HTMLTextAreaElement || element.isContentEditable) && (!$f6c31cce2adf654f$var$isHTMLAnchorLink(element) || role === 'button' && key !== 'Enter') && // An element with role='link' should only trigger with Enter key\n    !(role === 'link' && key !== 'Enter');\n}\nfunction $f6c31cce2adf654f$var$getTouchFromEvent(event) {\n    const { targetTouches: targetTouches  } = event;\n    if (targetTouches.length > 0) return targetTouches[0];\n    return null;\n}\nfunction $f6c31cce2adf654f$var$getTouchById(event, pointerId) {\n    const changedTouches = event.changedTouches;\n    for(let i = 0; i < changedTouches.length; i++){\n        const touch = changedTouches[i];\n        if (touch.identifier === pointerId) return touch;\n    }\n    return null;\n}\nfunction $f6c31cce2adf654f$var$createEvent(target, e) {\n    return {\n        currentTarget: target,\n        shiftKey: e.shiftKey,\n        ctrlKey: e.ctrlKey,\n        metaKey: e.metaKey,\n        altKey: e.altKey\n    };\n}\nfunction $f6c31cce2adf654f$var$getPointClientRect(point) {\n    let offsetX = point.width / 2 || point.radiusX || 0;\n    let offsetY = point.height / 2 || point.radiusY || 0;\n    return {\n        top: point.clientY - offsetY,\n        right: point.clientX + offsetX,\n        bottom: point.clientY + offsetY,\n        left: point.clientX - offsetX\n    };\n}\nfunction $f6c31cce2adf654f$var$areRectanglesOverlapping(a, b) {\n    // check if they cannot overlap on x axis\n    if (a.left > b.right || b.left > a.right) return false;\n    // check if they cannot overlap on y axis\n    if (a.top > b.bottom || b.top > a.bottom) return false;\n    return true;\n}\nfunction $f6c31cce2adf654f$var$isOverTarget(point, target) {\n    let rect = target.getBoundingClientRect();\n    let pointRect = $f6c31cce2adf654f$var$getPointClientRect(point);\n    return $f6c31cce2adf654f$var$areRectanglesOverlapping(rect, pointRect);\n}\nfunction $f6c31cce2adf654f$var$shouldPreventDefault(target) {\n    // We cannot prevent default if the target is a draggable element.\n    return !(target instanceof HTMLElement) || !target.draggable;\n}\nfunction $f6c31cce2adf654f$var$shouldPreventDefaultKeyboard(target, key) {\n    if (target instanceof HTMLInputElement) return !$f6c31cce2adf654f$var$isValidInputKey(target, key);\n    if (target instanceof HTMLButtonElement) return target.type !== 'submit';\n    return true;\n}\nconst $f6c31cce2adf654f$var$nonTextInputTypes = new Set([\n    'checkbox',\n    'radio',\n    'range',\n    'color',\n    'file',\n    'image',\n    'button',\n    'submit',\n    'reset'\n]);\nfunction $f6c31cce2adf654f$var$isValidInputKey(target, key) {\n    // Only space should toggle checkboxes and radios, not enter.\n    return target.type === 'checkbox' || target.type === 'radio' ? key === ' ' : $f6c31cce2adf654f$var$nonTextInputTypes.has(target.type);\n}\nfunction $f6c31cce2adf654f$var$isVirtualPointerEvent(event) {\n    // If the pointer size is zero, then we assume it's from a screen reader.\n    // Android TalkBack double tap will sometimes return a event with width and height of 1\n    // and pointerType === 'mouse' so we need to check for a specific combination of event attributes.\n    // Cannot use \"event.pressure === 0\" as the sole check due to Safari pointer events always returning pressure === 0\n    // instead of .5, see https://bugs.webkit.org/show_bug.cgi?id=206216. event.pointerType === 'mouse' is to distingush\n    // Talkback double tap from Windows Firefox touch screen press\n    return event.width === 0 && event.height === 0 || event.width === 1 && event.height === 1 && event.pressure === 0 && event.detail === 0 && event.pointerType === 'mouse';\n}\n\n\n\nconst $3b117e43dc0ca95d$export$27c701ed9e449e99 = /*#__PURE__*/ $bx7SL$react.forwardRef(({ children: children , ...props }, ref)=>{\n    let newRef = $bx7SL$useRef();\n    ref = ref !== null && ref !== void 0 ? ref : newRef;\n    let { pressProps: pressProps  } = $f6c31cce2adf654f$export$45712eceda6fad21({\n        ...props,\n        ref: ref\n    });\n    let child = $bx7SL$react.Children.only(children);\n    return(/*#__PURE__*/ $bx7SL$react.cloneElement(child, // @ts-ignore\n    {\n        ref: ref,\n        ...$bx7SL$mergeProps(child.props, pressProps)\n    }));\n});\n\n\n\n\n\nconst $f1ab8c75478c6f73$export$3351871ee4b288b8 = /*#__PURE__*/ $bx7SL$react.forwardRef(({ children: children , ...props }, ref)=>{\n    let isRegistered = $bx7SL$useRef(false);\n    let prevContext = $bx7SL$useContext($ae1eeba8b9eafd08$export$5165eccb35aaadb5);\n    let context = $bx7SL$mergeProps(prevContext || {\n    }, {\n        ...props,\n        ref: ref || (prevContext === null || prevContext === void 0 ? void 0 : prevContext.ref),\n        register () {\n            isRegistered.current = true;\n            if (prevContext) prevContext.register();\n        }\n    });\n    $bx7SL$useSyncRef(prevContext, ref);\n    $bx7SL$useEffect(()=>{\n        if (!isRegistered.current) console.warn(\"A PressResponder was rendered without a pressable child. Either call the usePress hook, or wrap your DOM node with <Pressable> component.\");\n    }, []);\n    return(/*#__PURE__*/ $bx7SL$react.createElement($ae1eeba8b9eafd08$export$5165eccb35aaadb5.Provider, {\n        value: context\n    }, children));\n});\n\n\n\n\nfunction $a1ea59d68270f0dd$export$f8168d8dd8fd66e6(props) {\n    let { isDisabled: isDisabled , onFocus: onFocusProp , onBlur: onBlurProp , onFocusChange: onFocusChange  } = props;\n    const onBlur = $bx7SL$useCallback((e)=>{\n        if (e.target === e.currentTarget) {\n            if (onBlurProp) onBlurProp(e);\n            if (onFocusChange) onFocusChange(false);\n            return true;\n        }\n    }, [\n        onBlurProp,\n        onFocusChange\n    ]);\n    const onSyntheticFocus = $8a9cb279dc87e130$export$715c682d09d639cc(onBlur);\n    const onFocus = $bx7SL$useCallback((e)=>{\n        if (e.target === e.currentTarget) {\n            if (onFocusProp) onFocusProp(e);\n            if (onFocusChange) onFocusChange(true);\n            onSyntheticFocus(e);\n        }\n    }, [\n        onFocusChange,\n        onFocusProp,\n        onSyntheticFocus\n    ]);\n    return {\n        focusProps: {\n            onFocus: !isDisabled && (onFocusProp || onFocusChange || onBlurProp) ? onFocus : undefined,\n            onBlur: !isDisabled && (onBlurProp || onFocusChange) ? onBlur : null\n        }\n    };\n}\n\n\n\n\n\nlet $507fabe10e71c6fb$var$currentModality = null;\nlet $507fabe10e71c6fb$var$changeHandlers = new Set();\nlet $507fabe10e71c6fb$var$hasSetupGlobalListeners = false;\nlet $507fabe10e71c6fb$var$hasEventBeforeFocus = false;\nlet $507fabe10e71c6fb$var$hasBlurredWindowRecently = false;\n// Only Tab or Esc keys will make focus visible on text input elements\nconst $507fabe10e71c6fb$var$FOCUS_VISIBLE_INPUT_KEYS = {\n    Tab: true,\n    Escape: true\n};\nfunction $507fabe10e71c6fb$var$triggerChangeHandlers(modality, e) {\n    for (let handler of $507fabe10e71c6fb$var$changeHandlers)handler(modality, e);\n}\n/**\n * Helper function to determine if a KeyboardEvent is unmodified and could make keyboard focus styles visible.\n */ function $507fabe10e71c6fb$var$isValidKey(e) {\n    // Control and Shift keys trigger when navigating back to the tab with keyboard.\n    return !(e.metaKey || !$bx7SL$isMac() && e.altKey || e.ctrlKey || e.key === 'Control' || e.key === 'Shift' || e.key === 'Meta');\n}\nfunction $507fabe10e71c6fb$var$handleKeyboardEvent(e) {\n    $507fabe10e71c6fb$var$hasEventBeforeFocus = true;\n    if ($507fabe10e71c6fb$var$isValidKey(e)) {\n        $507fabe10e71c6fb$var$currentModality = 'keyboard';\n        $507fabe10e71c6fb$var$triggerChangeHandlers('keyboard', e);\n    }\n}\nfunction $507fabe10e71c6fb$var$handlePointerEvent(e) {\n    $507fabe10e71c6fb$var$currentModality = 'pointer';\n    if (e.type === 'mousedown' || e.type === 'pointerdown') {\n        $507fabe10e71c6fb$var$hasEventBeforeFocus = true;\n        $507fabe10e71c6fb$var$triggerChangeHandlers('pointer', e);\n    }\n}\nfunction $507fabe10e71c6fb$var$handleClickEvent(e) {\n    if ($8a9cb279dc87e130$export$60278871457622de(e)) {\n        $507fabe10e71c6fb$var$hasEventBeforeFocus = true;\n        $507fabe10e71c6fb$var$currentModality = 'virtual';\n    }\n}\nfunction $507fabe10e71c6fb$var$handleFocusEvent(e) {\n    // Firefox fires two extra focus events when the user first clicks into an iframe:\n    // first on the window, then on the document. We ignore these events so they don't\n    // cause keyboard focus rings to appear.\n    if (e.target === window || e.target === document) return;\n    // If a focus event occurs without a preceding keyboard or pointer event, switch to virtual modality.\n    // This occurs, for example, when navigating a form with the next/previous buttons on iOS.\n    if (!$507fabe10e71c6fb$var$hasEventBeforeFocus && !$507fabe10e71c6fb$var$hasBlurredWindowRecently) {\n        $507fabe10e71c6fb$var$currentModality = 'virtual';\n        $507fabe10e71c6fb$var$triggerChangeHandlers('virtual', e);\n    }\n    $507fabe10e71c6fb$var$hasEventBeforeFocus = false;\n    $507fabe10e71c6fb$var$hasBlurredWindowRecently = false;\n}\nfunction $507fabe10e71c6fb$var$handleWindowBlur() {\n    // When the window is blurred, reset state. This is necessary when tabbing out of the window,\n    // for example, since a subsequent focus event won't be fired.\n    $507fabe10e71c6fb$var$hasEventBeforeFocus = false;\n    $507fabe10e71c6fb$var$hasBlurredWindowRecently = true;\n}\n/**\n * Setup global event listeners to control when keyboard focus style should be visible.\n */ function $507fabe10e71c6fb$var$setupGlobalFocusEvents() {\n    if (typeof window === 'undefined' || $507fabe10e71c6fb$var$hasSetupGlobalListeners) return;\n    // Programmatic focus() calls shouldn't affect the current input modality.\n    // However, we need to detect other cases when a focus event occurs without\n    // a preceding user event (e.g. screen reader focus). Overriding the focus\n    // method on HTMLElement.prototype is a bit hacky, but works.\n    let focus = HTMLElement.prototype.focus;\n    HTMLElement.prototype.focus = function() {\n        $507fabe10e71c6fb$var$hasEventBeforeFocus = true;\n        focus.apply(this, arguments);\n    };\n    document.addEventListener('keydown', $507fabe10e71c6fb$var$handleKeyboardEvent, true);\n    document.addEventListener('keyup', $507fabe10e71c6fb$var$handleKeyboardEvent, true);\n    document.addEventListener('click', $507fabe10e71c6fb$var$handleClickEvent, true);\n    // Register focus events on the window so they are sure to happen\n    // before React's event listeners (registered on the document).\n    window.addEventListener('focus', $507fabe10e71c6fb$var$handleFocusEvent, true);\n    window.addEventListener('blur', $507fabe10e71c6fb$var$handleWindowBlur, false);\n    if (typeof PointerEvent !== 'undefined') {\n        document.addEventListener('pointerdown', $507fabe10e71c6fb$var$handlePointerEvent, true);\n        document.addEventListener('pointermove', $507fabe10e71c6fb$var$handlePointerEvent, true);\n        document.addEventListener('pointerup', $507fabe10e71c6fb$var$handlePointerEvent, true);\n    } else {\n        document.addEventListener('mousedown', $507fabe10e71c6fb$var$handlePointerEvent, true);\n        document.addEventListener('mousemove', $507fabe10e71c6fb$var$handlePointerEvent, true);\n        document.addEventListener('mouseup', $507fabe10e71c6fb$var$handlePointerEvent, true);\n    }\n    $507fabe10e71c6fb$var$hasSetupGlobalListeners = true;\n}\nif (typeof document !== 'undefined') {\n    if (document.readyState !== 'loading') $507fabe10e71c6fb$var$setupGlobalFocusEvents();\n    else document.addEventListener('DOMContentLoaded', $507fabe10e71c6fb$var$setupGlobalFocusEvents);\n}\nfunction $507fabe10e71c6fb$export$b9b3dfddab17db27() {\n    return $507fabe10e71c6fb$var$currentModality !== 'pointer';\n}\nfunction $507fabe10e71c6fb$export$630ff653c5ada6a9() {\n    return $507fabe10e71c6fb$var$currentModality;\n}\nfunction $507fabe10e71c6fb$export$8397ddfc504fdb9a(modality) {\n    $507fabe10e71c6fb$var$currentModality = modality;\n    $507fabe10e71c6fb$var$triggerChangeHandlers(modality, null);\n}\nfunction $507fabe10e71c6fb$export$98e20ec92f614cfe() {\n    $507fabe10e71c6fb$var$setupGlobalFocusEvents();\n    let [modality, setModality] = $bx7SL$useState($507fabe10e71c6fb$var$currentModality);\n    $bx7SL$useEffect(()=>{\n        let handler = ()=>{\n            setModality($507fabe10e71c6fb$var$currentModality);\n        };\n        $507fabe10e71c6fb$var$changeHandlers.add(handler);\n        return ()=>{\n            $507fabe10e71c6fb$var$changeHandlers.delete(handler);\n        };\n    }, []);\n    return modality;\n}\n/**\n * If this is attached to text input component, return if the event is a focus event (Tab/Escape keys pressed) so that\n * focus visible style can be properly set.\n */ function $507fabe10e71c6fb$var$isKeyboardFocusEvent(isTextInput, modality, e) {\n    return !(isTextInput && modality === 'keyboard' && e instanceof KeyboardEvent && !$507fabe10e71c6fb$var$FOCUS_VISIBLE_INPUT_KEYS[e.key]);\n}\nfunction $507fabe10e71c6fb$export$ffd9e5021c1fb2d6(props = {\n}) {\n    let { isTextInput: isTextInput , autoFocus: autoFocus  } = props;\n    let [isFocusVisibleState, setFocusVisible] = $bx7SL$useState(autoFocus || $507fabe10e71c6fb$export$b9b3dfddab17db27());\n    $507fabe10e71c6fb$export$ec71b4b83ac08ec3(($507fabe10e71c6fb$export$b9b3dfddab17db27)=>{\n        setFocusVisible($507fabe10e71c6fb$export$b9b3dfddab17db27);\n    }, [\n        isTextInput\n    ], {\n        isTextInput: isTextInput\n    });\n    return {\n        isFocusVisible: isFocusVisibleState\n    };\n}\nfunction $507fabe10e71c6fb$export$ec71b4b83ac08ec3(fn, deps, opts) {\n    $507fabe10e71c6fb$var$setupGlobalFocusEvents();\n    $bx7SL$useEffect(()=>{\n        let handler = (modality, e)=>{\n            if (!$507fabe10e71c6fb$var$isKeyboardFocusEvent(opts === null || opts === void 0 ? void 0 : opts.isTextInput, modality, e)) return;\n            fn($507fabe10e71c6fb$export$b9b3dfddab17db27());\n        };\n        $507fabe10e71c6fb$var$changeHandlers.add(handler);\n        return ()=>{\n            $507fabe10e71c6fb$var$changeHandlers.delete(handler);\n        };\n    }, deps);\n}\n\n\n\n\nfunction $9ab94262bd0047c7$export$420e68273165f4ec(props) {\n    let { isDisabled: isDisabled , onBlurWithin: onBlurWithin , onFocusWithin: onFocusWithin , onFocusWithinChange: onFocusWithinChange  } = props;\n    let state = $bx7SL$useRef({\n        isFocusWithin: false\n    });\n    let onBlur = $bx7SL$useCallback((e)=>{\n        // We don't want to trigger onBlurWithin and then immediately onFocusWithin again\n        // when moving focus inside the element. Only trigger if the currentTarget doesn't\n        // include the relatedTarget (where focus is moving).\n        if (state.current.isFocusWithin && !e.currentTarget.contains(e.relatedTarget)) {\n            state.current.isFocusWithin = false;\n            if (onBlurWithin) onBlurWithin(e);\n            if (onFocusWithinChange) onFocusWithinChange(false);\n        }\n    }, [\n        onBlurWithin,\n        onFocusWithinChange,\n        state\n    ]);\n    let onSyntheticFocus = $8a9cb279dc87e130$export$715c682d09d639cc(onBlur);\n    let onFocus = $bx7SL$useCallback((e)=>{\n        if (!state.current.isFocusWithin) {\n            if (onFocusWithin) onFocusWithin(e);\n            if (onFocusWithinChange) onFocusWithinChange(true);\n            state.current.isFocusWithin = true;\n            onSyntheticFocus(e);\n        }\n    }, [\n        onFocusWithin,\n        onFocusWithinChange,\n        onSyntheticFocus\n    ]);\n    if (isDisabled) return {\n        focusWithinProps: {\n            onFocus: null,\n            onBlur: null\n        }\n    };\n    return {\n        focusWithinProps: {\n            onFocus: onFocus,\n            onBlur: onBlur\n        }\n    };\n}\n\n\n\n// iOS fires onPointerEnter twice: once with pointerType=\"touch\" and again with pointerType=\"mouse\".\n// We want to ignore these emulated events so they do not trigger hover behavior.\n// See https://bugs.webkit.org/show_bug.cgi?id=214609.\nlet $6179b936705e76d3$var$globalIgnoreEmulatedMouseEvents = false;\nlet $6179b936705e76d3$var$hoverCount = 0;\nfunction $6179b936705e76d3$var$setGlobalIgnoreEmulatedMouseEvents() {\n    $6179b936705e76d3$var$globalIgnoreEmulatedMouseEvents = true;\n    // Clear globalIgnoreEmulatedMouseEvents after a short timeout. iOS fires onPointerEnter\n    // with pointerType=\"mouse\" immediately after onPointerUp and before onFocus. On other\n    // devices that don't have this quirk, we don't want to ignore a mouse hover sometime in\n    // the distant future because a user previously touched the element.\n    setTimeout(()=>{\n        $6179b936705e76d3$var$globalIgnoreEmulatedMouseEvents = false;\n    }, 50);\n}\nfunction $6179b936705e76d3$var$handleGlobalPointerEvent(e) {\n    if (e.pointerType === 'touch') $6179b936705e76d3$var$setGlobalIgnoreEmulatedMouseEvents();\n}\nfunction $6179b936705e76d3$var$setupGlobalTouchEvents() {\n    if (typeof document === 'undefined') return;\n    if (typeof PointerEvent !== 'undefined') document.addEventListener('pointerup', $6179b936705e76d3$var$handleGlobalPointerEvent);\n    else document.addEventListener('touchend', $6179b936705e76d3$var$setGlobalIgnoreEmulatedMouseEvents);\n    $6179b936705e76d3$var$hoverCount++;\n    return ()=>{\n        $6179b936705e76d3$var$hoverCount--;\n        if ($6179b936705e76d3$var$hoverCount > 0) return;\n        if (typeof PointerEvent !== 'undefined') document.removeEventListener('pointerup', $6179b936705e76d3$var$handleGlobalPointerEvent);\n        else document.removeEventListener('touchend', $6179b936705e76d3$var$setGlobalIgnoreEmulatedMouseEvents);\n    };\n}\nfunction $6179b936705e76d3$export$ae780daf29e6d456(props) {\n    let { onHoverStart: onHoverStart , onHoverChange: onHoverChange , onHoverEnd: onHoverEnd , isDisabled: isDisabled  } = props;\n    let [isHovered, setHovered] = $bx7SL$useState(false);\n    let state = $bx7SL$useRef({\n        isHovered: false,\n        ignoreEmulatedMouseEvents: false,\n        pointerType: '',\n        target: null\n    }).current;\n    $bx7SL$useEffect($6179b936705e76d3$var$setupGlobalTouchEvents, []);\n    let { hoverProps: hoverProps1 , triggerHoverEnd: triggerHoverEnd1  } = $bx7SL$useMemo(()=>{\n        let triggerHoverStart = (event, pointerType)=>{\n            state.pointerType = pointerType;\n            if (isDisabled || pointerType === 'touch' || state.isHovered || !event.currentTarget.contains(event.target)) return;\n            state.isHovered = true;\n            let target = event.currentTarget;\n            state.target = target;\n            if (onHoverStart) onHoverStart({\n                type: 'hoverstart',\n                target: target,\n                pointerType: pointerType\n            });\n            if (onHoverChange) onHoverChange(true);\n            setHovered(true);\n        };\n        let triggerHoverEnd = (event, pointerType)=>{\n            state.pointerType = '';\n            state.target = null;\n            if (pointerType === 'touch' || !state.isHovered) return;\n            state.isHovered = false;\n            let target = event.currentTarget;\n            if (onHoverEnd) onHoverEnd({\n                type: 'hoverend',\n                target: target,\n                pointerType: pointerType\n            });\n            if (onHoverChange) onHoverChange(false);\n            setHovered(false);\n        };\n        let hoverProps = {\n        };\n        if (typeof PointerEvent !== 'undefined') {\n            hoverProps.onPointerEnter = (e)=>{\n                if ($6179b936705e76d3$var$globalIgnoreEmulatedMouseEvents && e.pointerType === 'mouse') return;\n                triggerHoverStart(e, e.pointerType);\n            };\n            hoverProps.onPointerLeave = (e)=>{\n                if (!isDisabled && e.currentTarget.contains(e.target)) triggerHoverEnd(e, e.pointerType);\n            };\n        } else {\n            hoverProps.onTouchStart = ()=>{\n                state.ignoreEmulatedMouseEvents = true;\n            };\n            hoverProps.onMouseEnter = (e)=>{\n                if (!state.ignoreEmulatedMouseEvents && !$6179b936705e76d3$var$globalIgnoreEmulatedMouseEvents) triggerHoverStart(e, 'mouse');\n                state.ignoreEmulatedMouseEvents = false;\n            };\n            hoverProps.onMouseLeave = (e)=>{\n                if (!isDisabled && e.currentTarget.contains(e.target)) triggerHoverEnd(e, 'mouse');\n            };\n        }\n        return {\n            hoverProps: hoverProps,\n            triggerHoverEnd: triggerHoverEnd\n        };\n    }, [\n        onHoverStart,\n        onHoverChange,\n        onHoverEnd,\n        isDisabled,\n        state\n    ]);\n    $bx7SL$useEffect(()=>{\n        // Call the triggerHoverEnd as soon as isDisabled changes to true\n        // Safe to call triggerHoverEnd, it will early return if we aren't currently hovering\n        if (isDisabled) triggerHoverEnd1({\n            currentTarget: state.target\n        }, state.pointerType);\n    }, [\n        isDisabled\n    ]);\n    return {\n        hoverProps: hoverProps1,\n        isHovered: isHovered\n    };\n}\n\n\n\nfunction $e0b6e0b68ec7f50f$export$872b660ac5a1ff98(props) {\n    let { ref: ref , onInteractOutside: onInteractOutside , isDisabled: isDisabled , onInteractOutsideStart: onInteractOutsideStart  } = props;\n    let stateRef = $bx7SL$useRef({\n        isPointerDown: false,\n        ignoreEmulatedMouseEvents: false,\n        onInteractOutside: onInteractOutside,\n        onInteractOutsideStart: onInteractOutsideStart\n    });\n    let state = stateRef.current;\n    state.onInteractOutside = onInteractOutside;\n    state.onInteractOutsideStart = onInteractOutsideStart;\n    $bx7SL$useEffect(()=>{\n        if (isDisabled) return;\n        let onPointerDown = (e)=>{\n            if ($e0b6e0b68ec7f50f$var$isValidEvent(e, ref) && state.onInteractOutside) {\n                if (state.onInteractOutsideStart) state.onInteractOutsideStart(e);\n                state.isPointerDown = true;\n            }\n        };\n        // Use pointer events if available. Otherwise, fall back to mouse and touch events.\n        if (typeof PointerEvent !== 'undefined') {\n            let onPointerUp = (e)=>{\n                if (state.isPointerDown && state.onInteractOutside && $e0b6e0b68ec7f50f$var$isValidEvent(e, ref)) {\n                    state.isPointerDown = false;\n                    state.onInteractOutside(e);\n                }\n            };\n            // changing these to capture phase fixed combobox\n            document.addEventListener('pointerdown', onPointerDown, true);\n            document.addEventListener('pointerup', onPointerUp, true);\n            return ()=>{\n                document.removeEventListener('pointerdown', onPointerDown, true);\n                document.removeEventListener('pointerup', onPointerUp, true);\n            };\n        } else {\n            let onMouseUp = (e)=>{\n                if (state.ignoreEmulatedMouseEvents) state.ignoreEmulatedMouseEvents = false;\n                else if (state.isPointerDown && state.onInteractOutside && $e0b6e0b68ec7f50f$var$isValidEvent(e, ref)) {\n                    state.isPointerDown = false;\n                    state.onInteractOutside(e);\n                }\n            };\n            let onTouchEnd = (e)=>{\n                state.ignoreEmulatedMouseEvents = true;\n                if (state.onInteractOutside && state.isPointerDown && $e0b6e0b68ec7f50f$var$isValidEvent(e, ref)) {\n                    state.isPointerDown = false;\n                    state.onInteractOutside(e);\n                }\n            };\n            document.addEventListener('mousedown', onPointerDown, true);\n            document.addEventListener('mouseup', onMouseUp, true);\n            document.addEventListener('touchstart', onPointerDown, true);\n            document.addEventListener('touchend', onTouchEnd, true);\n            return ()=>{\n                document.removeEventListener('mousedown', onPointerDown, true);\n                document.removeEventListener('mouseup', onMouseUp, true);\n                document.removeEventListener('touchstart', onPointerDown, true);\n                document.removeEventListener('touchend', onTouchEnd, true);\n            };\n        }\n    }, [\n        ref,\n        state,\n        isDisabled\n    ]);\n}\nfunction $e0b6e0b68ec7f50f$var$isValidEvent(event, ref) {\n    if (event.button > 0) return false;\n    // if the event target is no longer in the document\n    if (event.target) {\n        const ownerDocument = event.target.ownerDocument;\n        if (!ownerDocument || !ownerDocument.documentElement.contains(event.target)) return false;\n    }\n    return ref.current && !ref.current.contains(event.target);\n}\n\n\nfunction $93925083ecbb358c$export$48d1ea6320830260(handler) {\n    if (!handler) return;\n    let shouldStopPropagation = true;\n    return (e)=>{\n        let event = {\n            ...e,\n            preventDefault () {\n                e.preventDefault();\n            },\n            isDefaultPrevented () {\n                return e.isDefaultPrevented();\n            },\n            stopPropagation () {\n                console.error('stopPropagation is now the default behavior for events in React Spectrum. You can use continuePropagation() to revert this behavior.');\n            },\n            continuePropagation () {\n                shouldStopPropagation = false;\n            }\n        };\n        handler(event);\n        if (shouldStopPropagation) e.stopPropagation();\n    };\n}\n\n\nfunction $46d819fcbaf35654$export$8f71654801c2f7cd(props) {\n    return {\n        keyboardProps: props.isDisabled ? {\n        } : {\n            onKeyDown: $93925083ecbb358c$export$48d1ea6320830260(props.onKeyDown),\n            onKeyUp: $93925083ecbb358c$export$48d1ea6320830260(props.onKeyUp)\n        }\n    };\n}\n\n\n\n\n\nfunction $e8a7022cf87cba2a$export$36da96379f79f245(props) {\n    let { onMoveStart: onMoveStart , onMove: onMove , onMoveEnd: onMoveEnd  } = props;\n    let state = $bx7SL$useRef({\n        didMove: false,\n        lastPosition: null,\n        id: null\n    });\n    let { addGlobalListener: addGlobalListener , removeGlobalListener: removeGlobalListener  } = $bx7SL$useGlobalListeners();\n    let moveProps1 = $bx7SL$useMemo(()=>{\n        let moveProps = {\n        };\n        let start = ()=>{\n            $14c0b72509d70225$export$16a4697467175487();\n            state.current.didMove = false;\n        };\n        let move = (originalEvent, pointerType, deltaX, deltaY)=>{\n            if (deltaX === 0 && deltaY === 0) return;\n            if (!state.current.didMove) {\n                state.current.didMove = true;\n                onMoveStart === null || onMoveStart === void 0 ? void 0 : onMoveStart({\n                    type: 'movestart',\n                    pointerType: pointerType,\n                    shiftKey: originalEvent.shiftKey,\n                    metaKey: originalEvent.metaKey,\n                    ctrlKey: originalEvent.ctrlKey,\n                    altKey: originalEvent.altKey\n                });\n            }\n            onMove({\n                type: 'move',\n                pointerType: pointerType,\n                deltaX: deltaX,\n                deltaY: deltaY,\n                shiftKey: originalEvent.shiftKey,\n                metaKey: originalEvent.metaKey,\n                ctrlKey: originalEvent.ctrlKey,\n                altKey: originalEvent.altKey\n            });\n        };\n        let end = (originalEvent, pointerType)=>{\n            $14c0b72509d70225$export$b0d6fa1ab32e3295();\n            if (state.current.didMove) onMoveEnd === null || onMoveEnd === void 0 ? void 0 : onMoveEnd({\n                type: 'moveend',\n                pointerType: pointerType,\n                shiftKey: originalEvent.shiftKey,\n                metaKey: originalEvent.metaKey,\n                ctrlKey: originalEvent.ctrlKey,\n                altKey: originalEvent.altKey\n            });\n        };\n        if (typeof PointerEvent === 'undefined') {\n            let onMouseMove = (e)=>{\n                if (e.button === 0) {\n                    move(e, 'mouse', e.pageX - state.current.lastPosition.pageX, e.pageY - state.current.lastPosition.pageY);\n                    state.current.lastPosition = {\n                        pageX: e.pageX,\n                        pageY: e.pageY\n                    };\n                }\n            };\n            let onMouseUp = (e)=>{\n                if (e.button === 0) {\n                    end(e, 'mouse');\n                    removeGlobalListener(window, 'mousemove', onMouseMove, false);\n                    removeGlobalListener(window, 'mouseup', onMouseUp, false);\n                }\n            };\n            moveProps.onMouseDown = (e)=>{\n                if (e.button === 0) {\n                    start();\n                    e.stopPropagation();\n                    e.preventDefault();\n                    state.current.lastPosition = {\n                        pageX: e.pageX,\n                        pageY: e.pageY\n                    };\n                    addGlobalListener(window, 'mousemove', onMouseMove, false);\n                    addGlobalListener(window, 'mouseup', onMouseUp, false);\n                }\n            };\n            let onTouchMove = (e)=>{\n                let touch = [\n                    ...e.changedTouches\n                ].findIndex(({ identifier: identifier  })=>identifier === state.current.id\n                );\n                if (touch >= 0) {\n                    let { pageX: pageX , pageY: pageY  } = e.changedTouches[touch];\n                    move(e, 'touch', pageX - state.current.lastPosition.pageX, pageY - state.current.lastPosition.pageY);\n                    state.current.lastPosition = {\n                        pageX: pageX,\n                        pageY: pageY\n                    };\n                }\n            };\n            let onTouchEnd = (e)=>{\n                let touch = [\n                    ...e.changedTouches\n                ].findIndex(({ identifier: identifier  })=>identifier === state.current.id\n                );\n                if (touch >= 0) {\n                    end(e, 'touch');\n                    state.current.id = null;\n                    removeGlobalListener(window, 'touchmove', onTouchMove);\n                    removeGlobalListener(window, 'touchend', onTouchEnd);\n                    removeGlobalListener(window, 'touchcancel', onTouchEnd);\n                }\n            };\n            moveProps.onTouchStart = (e)=>{\n                if (e.changedTouches.length === 0 || state.current.id != null) return;\n                let { pageX: pageX , pageY: pageY , identifier: identifier  } = e.changedTouches[0];\n                start();\n                e.stopPropagation();\n                e.preventDefault();\n                state.current.lastPosition = {\n                    pageX: pageX,\n                    pageY: pageY\n                };\n                state.current.id = identifier;\n                addGlobalListener(window, 'touchmove', onTouchMove, false);\n                addGlobalListener(window, 'touchend', onTouchEnd, false);\n                addGlobalListener(window, 'touchcancel', onTouchEnd, false);\n            };\n        } else {\n            let onPointerMove = (e)=>{\n                if (e.pointerId === state.current.id) {\n                    let pointerType = e.pointerType || 'mouse';\n                    // Problems with PointerEvent#movementX/movementY:\n                    // 1. it is always 0 on macOS Safari.\n                    // 2. On Chrome Android, it's scaled by devicePixelRatio, but not on Chrome macOS\n                    move(e, pointerType, e.pageX - state.current.lastPosition.pageX, e.pageY - state.current.lastPosition.pageY);\n                    state.current.lastPosition = {\n                        pageX: e.pageX,\n                        pageY: e.pageY\n                    };\n                }\n            };\n            let onPointerUp = (e)=>{\n                if (e.pointerId === state.current.id) {\n                    let pointerType = e.pointerType || 'mouse';\n                    end(e, pointerType);\n                    state.current.id = null;\n                    removeGlobalListener(window, 'pointermove', onPointerMove, false);\n                    removeGlobalListener(window, 'pointerup', onPointerUp, false);\n                    removeGlobalListener(window, 'pointercancel', onPointerUp, false);\n                }\n            };\n            moveProps.onPointerDown = (e)=>{\n                if (e.button === 0 && state.current.id == null) {\n                    start();\n                    e.stopPropagation();\n                    e.preventDefault();\n                    state.current.lastPosition = {\n                        pageX: e.pageX,\n                        pageY: e.pageY\n                    };\n                    state.current.id = e.pointerId;\n                    addGlobalListener(window, 'pointermove', onPointerMove, false);\n                    addGlobalListener(window, 'pointerup', onPointerUp, false);\n                    addGlobalListener(window, 'pointercancel', onPointerUp, false);\n                }\n            };\n        }\n        let triggerKeyboardMove = (e, deltaX, deltaY)=>{\n            start();\n            move(e, 'keyboard', deltaX, deltaY);\n            end(e, 'keyboard');\n        };\n        moveProps.onKeyDown = (e)=>{\n            switch(e.key){\n                case 'Left':\n                case 'ArrowLeft':\n                    e.preventDefault();\n                    e.stopPropagation();\n                    triggerKeyboardMove(e, -1, 0);\n                    break;\n                case 'Right':\n                case 'ArrowRight':\n                    e.preventDefault();\n                    e.stopPropagation();\n                    triggerKeyboardMove(e, 1, 0);\n                    break;\n                case 'Up':\n                case 'ArrowUp':\n                    e.preventDefault();\n                    e.stopPropagation();\n                    triggerKeyboardMove(e, 0, -1);\n                    break;\n                case 'Down':\n                case 'ArrowDown':\n                    e.preventDefault();\n                    e.stopPropagation();\n                    triggerKeyboardMove(e, 0, 1);\n                    break;\n            }\n        };\n        return moveProps;\n    }, [\n        state,\n        onMoveStart,\n        onMove,\n        onMoveEnd,\n        addGlobalListener,\n        removeGlobalListener\n    ]);\n    return {\n        moveProps: moveProps1\n    };\n}\n\n\n\n\n\nfunction $7d0a636d7a4dcefd$export$2123ff2b87c81ca(props, ref) {\n    let { onScroll: onScroll , isDisabled: isDisabled  } = props;\n    let onScrollHandler = $bx7SL$useCallback((e)=>{\n        // If the ctrlKey is pressed, this is a zoom event, do nothing.\n        if (e.ctrlKey) return;\n        // stop scrolling the page\n        e.preventDefault();\n        e.stopPropagation();\n        if (onScroll) onScroll({\n            deltaX: e.deltaX,\n            deltaY: e.deltaY\n        });\n    }, [\n        onScroll\n    ]);\n    $bx7SL$useEvent(ref, 'wheel', isDisabled ? null : onScrollHandler);\n}\n\n\n\n\n\nconst $8a26561d2877236e$var$DEFAULT_THRESHOLD = 500;\nfunction $8a26561d2877236e$export$c24ed0104d07eab9(props) {\n    let { isDisabled: isDisabled , onLongPressStart: onLongPressStart , onLongPressEnd: onLongPressEnd , onLongPress: onLongPress , threshold: threshold = $8a26561d2877236e$var$DEFAULT_THRESHOLD , accessibilityDescription: accessibilityDescription  } = props;\n    const timeRef = $bx7SL$useRef(null);\n    let { addGlobalListener: addGlobalListener , removeGlobalListener: removeGlobalListener  } = $bx7SL$useGlobalListeners();\n    let { pressProps: pressProps  } = $f6c31cce2adf654f$export$45712eceda6fad21({\n        isDisabled: isDisabled,\n        onPressStart (e1) {\n            if (e1.pointerType === 'mouse' || e1.pointerType === 'touch') {\n                if (onLongPressStart) onLongPressStart({\n                    ...e1,\n                    type: 'longpressstart'\n                });\n                timeRef.current = setTimeout(()=>{\n                    // Prevent other usePress handlers from also handling this event.\n                    e1.target.dispatchEvent(new PointerEvent('pointercancel', {\n                        bubbles: true\n                    }));\n                    if (onLongPress) onLongPress({\n                        ...e1,\n                        type: 'longpress'\n                    });\n                    timeRef.current = null;\n                }, threshold);\n                // Prevent context menu, which may be opened on long press on touch devices\n                if (e1.pointerType === 'touch') {\n                    let onContextMenu = (e)=>{\n                        e.preventDefault();\n                    };\n                    addGlobalListener(e1.target, 'contextmenu', onContextMenu, {\n                        once: true\n                    });\n                    addGlobalListener(window, 'pointerup', ()=>{\n                        // If no contextmenu event is fired quickly after pointerup, remove the handler\n                        // so future context menu events outside a long press are not prevented.\n                        setTimeout(()=>{\n                            removeGlobalListener(e1.target, 'contextmenu', onContextMenu);\n                        }, 30);\n                    }, {\n                        once: true\n                    });\n                }\n            }\n        },\n        onPressEnd (e) {\n            if (timeRef.current) clearTimeout(timeRef.current);\n            if (onLongPressEnd && (e.pointerType === 'mouse' || e.pointerType === 'touch')) onLongPressEnd({\n                ...e,\n                type: 'longpressend'\n            });\n        }\n    });\n    let descriptionProps = $bx7SL$useDescription(onLongPress && !isDisabled ? accessibilityDescription : null);\n    return {\n        longPressProps: $bx7SL$mergeProps(pressProps, descriptionProps)\n    };\n}\n\n\n\n\nexport {$3b117e43dc0ca95d$export$27c701ed9e449e99 as Pressable, $f1ab8c75478c6f73$export$3351871ee4b288b8 as PressResponder, $a1ea59d68270f0dd$export$f8168d8dd8fd66e6 as useFocus, $507fabe10e71c6fb$export$b9b3dfddab17db27 as isFocusVisible, $507fabe10e71c6fb$export$630ff653c5ada6a9 as getInteractionModality, $507fabe10e71c6fb$export$8397ddfc504fdb9a as setInteractionModality, $507fabe10e71c6fb$export$98e20ec92f614cfe as useInteractionModality, $507fabe10e71c6fb$export$ffd9e5021c1fb2d6 as useFocusVisible, $507fabe10e71c6fb$export$ec71b4b83ac08ec3 as useFocusVisibleListener, $9ab94262bd0047c7$export$420e68273165f4ec as useFocusWithin, $6179b936705e76d3$export$ae780daf29e6d456 as useHover, $e0b6e0b68ec7f50f$export$872b660ac5a1ff98 as useInteractOutside, $46d819fcbaf35654$export$8f71654801c2f7cd as useKeyboard, $e8a7022cf87cba2a$export$36da96379f79f245 as useMove, $f6c31cce2adf654f$export$45712eceda6fad21 as usePress, $7d0a636d7a4dcefd$export$2123ff2b87c81ca as useScrollWheel, $8a26561d2877236e$export$c24ed0104d07eab9 as useLongPress};\n//# sourceMappingURL=module.js.map\n","import $6nfFC$react, {useRef as $6nfFC$useRef, useContext as $6nfFC$useContext, useEffect as $6nfFC$useEffect, useState as $6nfFC$useState, useCallback as $6nfFC$useCallback} from \"react\";\nimport {useLayoutEffect as $6nfFC$useLayoutEffect, runAfterTransition as $6nfFC$runAfterTransition, focusWithoutScrolling as $6nfFC$focusWithoutScrolling, mergeProps as $6nfFC$mergeProps, useSyncRef as $6nfFC$useSyncRef} from \"@react-aria/utils\";\nimport {getInteractionModality as $6nfFC$getInteractionModality, isFocusVisible as $6nfFC$isFocusVisible, useFocusVisibleListener as $6nfFC$useFocusVisibleListener, useFocus as $6nfFC$useFocus, useFocusWithin as $6nfFC$useFocusWithin, useKeyboard as $6nfFC$useKeyboard} from \"@react-aria/interactions\";\nimport $6nfFC$clsx from \"clsx\";\n\n\n\nfunction $6a99195332edec8b$export$80f3e147d781571c(element) {\n    // If the user is interacting with a virtual cursor, e.g. screen reader, then\n    // wait until after any animated transitions that are currently occurring on\n    // the page before shifting focus. This avoids issues with VoiceOver on iOS\n    // causing the page to scroll when moving focus if the element is transitioning\n    // from off the screen.\n    if ($6nfFC$getInteractionModality() === 'virtual') {\n        let lastFocusedElement = document.activeElement;\n        $6nfFC$runAfterTransition(()=>{\n            // If focus did not move and the element is still in the document, focus it.\n            if (document.activeElement === lastFocusedElement && document.contains(element)) $6nfFC$focusWithoutScrolling(element);\n        });\n    } else $6nfFC$focusWithoutScrolling(element);\n}\n\n\n/*\n * Copyright 2021 Adobe. All rights reserved.\n * This file is licensed to you under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License. You may obtain a copy\n * of the License at http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software distributed under\n * the License is distributed on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR REPRESENTATIONS\n * OF ANY KIND, either express or implied. See the License for the specific language\n * governing permissions and limitations under the License.\n */ function $645f2e67b85a24c9$var$isStyleVisible(element) {\n    if (!(element instanceof HTMLElement) && !(element instanceof SVGElement)) return false;\n    let { display: display , visibility: visibility  } = element.style;\n    let isVisible = display !== 'none' && visibility !== 'hidden' && visibility !== 'collapse';\n    if (isVisible) {\n        const { getComputedStyle: getComputedStyle  } = element.ownerDocument.defaultView;\n        let { display: computedDisplay , visibility: computedVisibility  } = getComputedStyle(element);\n        isVisible = computedDisplay !== 'none' && computedVisibility !== 'hidden' && computedVisibility !== 'collapse';\n    }\n    return isVisible;\n}\nfunction $645f2e67b85a24c9$var$isAttributeVisible(element, childElement) {\n    return !element.hasAttribute('hidden') && (element.nodeName === 'DETAILS' && childElement && childElement.nodeName !== 'SUMMARY' ? element.hasAttribute('open') : true);\n}\nfunction $645f2e67b85a24c9$export$e989c0fffaa6b27a(element, childElement) {\n    return element.nodeName !== '#comment' && $645f2e67b85a24c9$var$isStyleVisible(element) && $645f2e67b85a24c9$var$isAttributeVisible(element, childElement) && (!element.parentElement || $645f2e67b85a24c9$export$e989c0fffaa6b27a(element.parentElement, element));\n}\n\n\n\n\nconst $9bf71ea28793e738$var$FocusContext = /*#__PURE__*/ $6nfFC$react.createContext(null);\nlet $9bf71ea28793e738$var$activeScope = null;\nlet $9bf71ea28793e738$var$scopes = new Map();\nfunction $9bf71ea28793e738$export$20e40289641fbbb6(props) {\n    let { children: children , contain: contain , restoreFocus: restoreFocus , autoFocus: autoFocus  } = props;\n    let startRef = $6nfFC$useRef();\n    let endRef = $6nfFC$useRef();\n    let scopeRef = $6nfFC$useRef([]);\n    let ctx = $6nfFC$useContext($9bf71ea28793e738$var$FocusContext);\n    let parentScope = ctx === null || ctx === void 0 ? void 0 : ctx.scopeRef;\n    $6nfFC$useLayoutEffect(()=>{\n        // Find all rendered nodes between the sentinels and add them to the scope.\n        let node = startRef.current.nextSibling;\n        let nodes = [];\n        while(node && node !== endRef.current){\n            nodes.push(node);\n            node = node.nextSibling;\n        }\n        scopeRef.current = nodes;\n    }, [\n        children,\n        parentScope\n    ]);\n    $6nfFC$useLayoutEffect(()=>{\n        $9bf71ea28793e738$var$scopes.set(scopeRef, parentScope);\n        return ()=>{\n            // Restore the active scope on unmount if this scope or a descendant scope is active.\n            // Parent effect cleanups run before children, so we need to check if the\n            // parent scope actually still exists before restoring the active scope to it.\n            if ((scopeRef === $9bf71ea28793e738$var$activeScope || $9bf71ea28793e738$var$isAncestorScope(scopeRef, $9bf71ea28793e738$var$activeScope)) && (!parentScope || $9bf71ea28793e738$var$scopes.has(parentScope))) $9bf71ea28793e738$var$activeScope = parentScope;\n            $9bf71ea28793e738$var$scopes.delete(scopeRef);\n        };\n    }, [\n        scopeRef,\n        parentScope\n    ]);\n    $9bf71ea28793e738$var$useFocusContainment(scopeRef, contain);\n    $9bf71ea28793e738$var$useRestoreFocus(scopeRef, restoreFocus, contain);\n    $9bf71ea28793e738$var$useAutoFocus(scopeRef, autoFocus);\n    let focusManager = $9bf71ea28793e738$var$createFocusManagerForScope(scopeRef);\n    return(/*#__PURE__*/ $6nfFC$react.createElement($9bf71ea28793e738$var$FocusContext.Provider, {\n        value: {\n            scopeRef: scopeRef,\n            focusManager: focusManager\n        }\n    }, /*#__PURE__*/ $6nfFC$react.createElement(\"span\", {\n        \"data-focus-scope-start\": true,\n        hidden: true,\n        ref: startRef\n    }), children, /*#__PURE__*/ $6nfFC$react.createElement(\"span\", {\n        \"data-focus-scope-end\": true,\n        hidden: true,\n        ref: endRef\n    })));\n}\nfunction $9bf71ea28793e738$export$10c5169755ce7bd7() {\n    var ref;\n    return (ref = $6nfFC$useContext($9bf71ea28793e738$var$FocusContext)) === null || ref === void 0 ? void 0 : ref.focusManager;\n}\nfunction $9bf71ea28793e738$var$createFocusManagerForScope(scopeRef) {\n    return {\n        focusNext (opts = {\n        }) {\n            let scope = scopeRef.current;\n            let { from: from , tabbable: tabbable , wrap: wrap , accept: accept  } = opts;\n            let node = from || document.activeElement;\n            let sentinel = scope[0].previousElementSibling;\n            let walker = $9bf71ea28793e738$export$2d6ec8fc375ceafa($9bf71ea28793e738$var$getScopeRoot(scope), {\n                tabbable: tabbable,\n                accept: accept\n            }, scope);\n            walker.currentNode = $9bf71ea28793e738$var$isElementInScope(node, scope) ? node : sentinel;\n            let nextNode = walker.nextNode();\n            if (!nextNode && wrap) {\n                walker.currentNode = sentinel;\n                nextNode = walker.nextNode();\n            }\n            if (nextNode) $9bf71ea28793e738$var$focusElement(nextNode, true);\n            return nextNode;\n        },\n        focusPrevious (opts = {\n        }) {\n            let scope = scopeRef.current;\n            let { from: from , tabbable: tabbable , wrap: wrap , accept: accept  } = opts;\n            let node = from || document.activeElement;\n            let sentinel = scope[scope.length - 1].nextElementSibling;\n            let walker = $9bf71ea28793e738$export$2d6ec8fc375ceafa($9bf71ea28793e738$var$getScopeRoot(scope), {\n                tabbable: tabbable,\n                accept: accept\n            }, scope);\n            walker.currentNode = $9bf71ea28793e738$var$isElementInScope(node, scope) ? node : sentinel;\n            let previousNode = walker.previousNode();\n            if (!previousNode && wrap) {\n                walker.currentNode = sentinel;\n                previousNode = walker.previousNode();\n            }\n            if (previousNode) $9bf71ea28793e738$var$focusElement(previousNode, true);\n            return previousNode;\n        },\n        focusFirst (opts = {\n        }) {\n            let scope = scopeRef.current;\n            let { tabbable: tabbable , accept: accept  } = opts;\n            let walker = $9bf71ea28793e738$export$2d6ec8fc375ceafa($9bf71ea28793e738$var$getScopeRoot(scope), {\n                tabbable: tabbable,\n                accept: accept\n            }, scope);\n            walker.currentNode = scope[0].previousElementSibling;\n            let nextNode = walker.nextNode();\n            if (nextNode) $9bf71ea28793e738$var$focusElement(nextNode, true);\n            return nextNode;\n        },\n        focusLast (opts = {\n        }) {\n            let scope = scopeRef.current;\n            let { tabbable: tabbable , accept: accept  } = opts;\n            let walker = $9bf71ea28793e738$export$2d6ec8fc375ceafa($9bf71ea28793e738$var$getScopeRoot(scope), {\n                tabbable: tabbable,\n                accept: accept\n            }, scope);\n            walker.currentNode = scope[scope.length - 1].nextElementSibling;\n            let previousNode = walker.previousNode();\n            if (previousNode) $9bf71ea28793e738$var$focusElement(previousNode, true);\n            return previousNode;\n        }\n    };\n}\nconst $9bf71ea28793e738$var$focusableElements = [\n    'input:not([disabled]):not([type=hidden])',\n    'select:not([disabled])',\n    'textarea:not([disabled])',\n    'button:not([disabled])',\n    'a[href]',\n    'area[href]',\n    'summary',\n    'iframe',\n    'object',\n    'embed',\n    'audio[controls]',\n    'video[controls]',\n    '[contenteditable]'\n];\nconst $9bf71ea28793e738$var$FOCUSABLE_ELEMENT_SELECTOR = $9bf71ea28793e738$var$focusableElements.join(':not([hidden]),') + ',[tabindex]:not([disabled]):not([hidden])';\n$9bf71ea28793e738$var$focusableElements.push('[tabindex]:not([tabindex=\"-1\"]):not([disabled])');\nconst $9bf71ea28793e738$var$TABBABLE_ELEMENT_SELECTOR = $9bf71ea28793e738$var$focusableElements.join(':not([hidden]):not([tabindex=\"-1\"]),');\nfunction $9bf71ea28793e738$var$getScopeRoot(scope) {\n    return scope[0].parentElement;\n}\nfunction $9bf71ea28793e738$var$useFocusContainment(scopeRef, contain) {\n    let focusedNode = $6nfFC$useRef();\n    let raf = $6nfFC$useRef(null);\n    $6nfFC$useLayoutEffect(()=>{\n        let scope1 = scopeRef.current;\n        if (!contain) {\n            // if contain was changed, then we should cancel any ongoing waits to pull focus back into containment\n            if (raf.current) {\n                cancelAnimationFrame(raf.current);\n                raf.current = null;\n            }\n            return;\n        }\n        // Handle the Tab key to contain focus within the scope\n        let onKeyDown = (e)=>{\n            if (e.key !== 'Tab' || e.altKey || e.ctrlKey || e.metaKey || scopeRef !== $9bf71ea28793e738$var$activeScope) return;\n            let focusedElement = document.activeElement;\n            let scope = scopeRef.current;\n            if (!$9bf71ea28793e738$var$isElementInScope(focusedElement, scope)) return;\n            let walker = $9bf71ea28793e738$export$2d6ec8fc375ceafa($9bf71ea28793e738$var$getScopeRoot(scope), {\n                tabbable: true\n            }, scope);\n            walker.currentNode = focusedElement;\n            let nextElement = e.shiftKey ? walker.previousNode() : walker.nextNode();\n            if (!nextElement) {\n                walker.currentNode = e.shiftKey ? scope[scope.length - 1].nextElementSibling : scope[0].previousElementSibling;\n                nextElement = e.shiftKey ? walker.previousNode() : walker.nextNode();\n            }\n            e.preventDefault();\n            if (nextElement) $9bf71ea28793e738$var$focusElement(nextElement, true);\n        };\n        let onFocus = (e)=>{\n            // If focusing an element in a child scope of the currently active scope, the child becomes active.\n            // Moving out of the active scope to an ancestor is not allowed.\n            if (!$9bf71ea28793e738$var$activeScope || $9bf71ea28793e738$var$isAncestorScope($9bf71ea28793e738$var$activeScope, scopeRef)) {\n                $9bf71ea28793e738$var$activeScope = scopeRef;\n                focusedNode.current = e.target;\n            } else if (scopeRef === $9bf71ea28793e738$var$activeScope && !$9bf71ea28793e738$var$isElementInChildScope(e.target, scopeRef)) {\n                // If a focus event occurs outside the active scope (e.g. user tabs from browser location bar),\n                // restore focus to the previously focused node or the first tabbable element in the active scope.\n                if (focusedNode.current) focusedNode.current.focus();\n                else if ($9bf71ea28793e738$var$activeScope) $9bf71ea28793e738$var$focusFirstInScope($9bf71ea28793e738$var$activeScope.current);\n            } else if (scopeRef === $9bf71ea28793e738$var$activeScope) focusedNode.current = e.target;\n        };\n        let onBlur = (e)=>{\n            // Firefox doesn't shift focus back to the Dialog properly without this\n            raf.current = requestAnimationFrame(()=>{\n                // Use document.activeElement instead of e.relatedTarget so we can tell if user clicked into iframe\n                if (scopeRef === $9bf71ea28793e738$var$activeScope && !$9bf71ea28793e738$var$isElementInChildScope(document.activeElement, scopeRef)) {\n                    $9bf71ea28793e738$var$activeScope = scopeRef;\n                    focusedNode.current = e.target;\n                    focusedNode.current.focus();\n                }\n            });\n        };\n        document.addEventListener('keydown', onKeyDown, false);\n        document.addEventListener('focusin', onFocus, false);\n        scope1.forEach((element)=>element.addEventListener('focusin', onFocus, false)\n        );\n        scope1.forEach((element)=>element.addEventListener('focusout', onBlur, false)\n        );\n        return ()=>{\n            document.removeEventListener('keydown', onKeyDown, false);\n            document.removeEventListener('focusin', onFocus, false);\n            scope1.forEach((element)=>element.removeEventListener('focusin', onFocus, false)\n            );\n            scope1.forEach((element)=>element.removeEventListener('focusout', onBlur, false)\n            );\n        };\n    }, [\n        scopeRef,\n        contain\n    ]);\n    // eslint-disable-next-line arrow-body-style\n    $6nfFC$useEffect(()=>{\n        return ()=>{\n            if (raf.current) cancelAnimationFrame(raf.current);\n        };\n    }, [\n        raf\n    ]);\n}\nfunction $9bf71ea28793e738$var$isElementInAnyScope(element) {\n    for (let scope of $9bf71ea28793e738$var$scopes.keys()){\n        if ($9bf71ea28793e738$var$isElementInScope(element, scope.current)) return true;\n    }\n    return false;\n}\nfunction $9bf71ea28793e738$var$isElementInScope(element, scope) {\n    return scope.some((node)=>node.contains(element)\n    );\n}\nfunction $9bf71ea28793e738$var$isElementInChildScope(element, scope) {\n    // node.contains in isElementInScope covers child scopes that are also DOM children,\n    // but does not cover child scopes in portals.\n    for (let s of $9bf71ea28793e738$var$scopes.keys()){\n        if ((s === scope || $9bf71ea28793e738$var$isAncestorScope(scope, s)) && $9bf71ea28793e738$var$isElementInScope(element, s.current)) return true;\n    }\n    return false;\n}\nfunction $9bf71ea28793e738$var$isAncestorScope(ancestor, scope) {\n    let parent = $9bf71ea28793e738$var$scopes.get(scope);\n    if (!parent) return false;\n    if (parent === ancestor) return true;\n    return $9bf71ea28793e738$var$isAncestorScope(ancestor, parent);\n}\nfunction $9bf71ea28793e738$var$focusElement(element, scroll = false) {\n    if (element != null && !scroll) try {\n        $6a99195332edec8b$export$80f3e147d781571c(element);\n    } catch (err) {\n    // ignore\n    }\n    else if (element != null) try {\n        element.focus();\n    } catch (err1) {\n    // ignore\n    }\n}\nfunction $9bf71ea28793e738$var$focusFirstInScope(scope) {\n    let sentinel = scope[0].previousElementSibling;\n    let walker = $9bf71ea28793e738$export$2d6ec8fc375ceafa($9bf71ea28793e738$var$getScopeRoot(scope), {\n        tabbable: true\n    }, scope);\n    walker.currentNode = sentinel;\n    $9bf71ea28793e738$var$focusElement(walker.nextNode());\n}\nfunction $9bf71ea28793e738$var$useAutoFocus(scopeRef, autoFocus) {\n    const autoFocusRef = $6nfFC$react.useRef(autoFocus);\n    $6nfFC$useEffect(()=>{\n        if (autoFocusRef.current) {\n            $9bf71ea28793e738$var$activeScope = scopeRef;\n            if (!$9bf71ea28793e738$var$isElementInScope(document.activeElement, $9bf71ea28793e738$var$activeScope.current)) $9bf71ea28793e738$var$focusFirstInScope(scopeRef.current);\n        }\n        autoFocusRef.current = false;\n    }, []);\n}\nfunction $9bf71ea28793e738$var$useRestoreFocus(scopeRef, restoreFocus, contain) {\n    // create a ref during render instead of useLayoutEffect so the active element is saved before a child with autoFocus=true mounts.\n    const nodeToRestoreRef = $6nfFC$useRef(typeof document !== 'undefined' ? document.activeElement : null);\n    // useLayoutEffect instead of useEffect so the active element is saved synchronously instead of asynchronously.\n    $6nfFC$useLayoutEffect(()=>{\n        let nodeToRestore = nodeToRestoreRef.current;\n        if (!restoreFocus) return;\n        // Handle the Tab key so that tabbing out of the scope goes to the next element\n        // after the node that had focus when the scope mounted. This is important when\n        // using portals for overlays, so that focus goes to the expected element when\n        // tabbing out of the overlay.\n        let onKeyDown = (e)=>{\n            if (e.key !== 'Tab' || e.altKey || e.ctrlKey || e.metaKey) return;\n            let focusedElement = document.activeElement;\n            if (!$9bf71ea28793e738$var$isElementInScope(focusedElement, scopeRef.current)) return;\n            // Create a DOM tree walker that matches all tabbable elements\n            let walker = $9bf71ea28793e738$export$2d6ec8fc375ceafa(document.body, {\n                tabbable: true\n            });\n            // Find the next tabbable element after the currently focused element\n            walker.currentNode = focusedElement;\n            let nextElement = e.shiftKey ? walker.previousNode() : walker.nextNode();\n            if (!document.body.contains(nodeToRestore) || nodeToRestore === document.body) nodeToRestore = null;\n            // If there is no next element, or it is outside the current scope, move focus to the\n            // next element after the node to restore to instead.\n            if ((!nextElement || !$9bf71ea28793e738$var$isElementInScope(nextElement, scopeRef.current)) && nodeToRestore) {\n                walker.currentNode = nodeToRestore;\n                // Skip over elements within the scope, in case the scope immediately follows the node to restore.\n                do nextElement = e.shiftKey ? walker.previousNode() : walker.nextNode();\n                while ($9bf71ea28793e738$var$isElementInScope(nextElement, scopeRef.current))\n                e.preventDefault();\n                e.stopPropagation();\n                if (nextElement) $9bf71ea28793e738$var$focusElement(nextElement, true);\n                else // If there is no next element and the nodeToRestore isn't within a FocusScope (i.e. we are leaving the top level focus scope)\n                // then move focus to the body.\n                // Otherwise restore focus to the nodeToRestore (e.g menu within a popover -> tabbing to close the menu should move focus to menu trigger)\n                if (!$9bf71ea28793e738$var$isElementInAnyScope(nodeToRestore)) focusedElement.blur();\n                else $9bf71ea28793e738$var$focusElement(nodeToRestore, true);\n            }\n        };\n        if (!contain) document.addEventListener('keydown', onKeyDown, true);\n        return ()=>{\n            if (!contain) document.removeEventListener('keydown', onKeyDown, true);\n            if (restoreFocus && nodeToRestore && $9bf71ea28793e738$var$isElementInScope(document.activeElement, scopeRef.current)) requestAnimationFrame(()=>{\n                // Only restore focus if we've lost focus to the body, the alternative is that focus has been purposefully moved elsewhere\n                if (document.body.contains(nodeToRestore) && document.activeElement === document.body) $9bf71ea28793e738$var$focusElement(nodeToRestore);\n            });\n        };\n    }, [\n        scopeRef,\n        restoreFocus,\n        contain\n    ]);\n}\nfunction $9bf71ea28793e738$export$2d6ec8fc375ceafa(root, opts, scope) {\n    let selector = (opts === null || opts === void 0 ? void 0 : opts.tabbable) ? $9bf71ea28793e738$var$TABBABLE_ELEMENT_SELECTOR : $9bf71ea28793e738$var$FOCUSABLE_ELEMENT_SELECTOR;\n    let walker = document.createTreeWalker(root, NodeFilter.SHOW_ELEMENT, {\n        acceptNode (node) {\n            var ref;\n            // Skip nodes inside the starting node.\n            if (opts === null || opts === void 0 ? void 0 : (ref = opts.from) === null || ref === void 0 ? void 0 : ref.contains(node)) return NodeFilter.FILTER_REJECT;\n            if (node.matches(selector) && $645f2e67b85a24c9$export$e989c0fffaa6b27a(node) && (!scope || $9bf71ea28793e738$var$isElementInScope(node, scope)) && (!(opts === null || opts === void 0 ? void 0 : opts.accept) || opts.accept(node))) return NodeFilter.FILTER_ACCEPT;\n            return NodeFilter.FILTER_SKIP;\n        }\n    });\n    if (opts === null || opts === void 0 ? void 0 : opts.from) walker.currentNode = opts.from;\n    return walker;\n}\nfunction $9bf71ea28793e738$export$c5251b9e124bf29(ref, defaultOptions = {\n}) {\n    return {\n        focusNext (opts = {\n        }) {\n            let root = ref.current;\n            if (!root) return;\n            let { from: from , tabbable: tabbable = defaultOptions.tabbable , wrap: wrap = defaultOptions.wrap , accept: accept = defaultOptions.accept  } = opts;\n            let node = from || document.activeElement;\n            let walker = $9bf71ea28793e738$export$2d6ec8fc375ceafa(root, {\n                tabbable: tabbable,\n                accept: accept\n            });\n            if (root.contains(node)) walker.currentNode = node;\n            let nextNode = walker.nextNode();\n            if (!nextNode && wrap) {\n                walker.currentNode = root;\n                nextNode = walker.nextNode();\n            }\n            if (nextNode) $9bf71ea28793e738$var$focusElement(nextNode, true);\n            return nextNode;\n        },\n        focusPrevious (opts = defaultOptions) {\n            let root = ref.current;\n            if (!root) return;\n            let { from: from , tabbable: tabbable = defaultOptions.tabbable , wrap: wrap = defaultOptions.wrap , accept: accept = defaultOptions.accept  } = opts;\n            let node = from || document.activeElement;\n            let walker = $9bf71ea28793e738$export$2d6ec8fc375ceafa(root, {\n                tabbable: tabbable,\n                accept: accept\n            });\n            if (root.contains(node)) walker.currentNode = node;\n            else {\n                let next = $9bf71ea28793e738$var$last(walker);\n                if (next) $9bf71ea28793e738$var$focusElement(next, true);\n                return next;\n            }\n            let previousNode = walker.previousNode();\n            if (!previousNode && wrap) {\n                walker.currentNode = root;\n                previousNode = $9bf71ea28793e738$var$last(walker);\n            }\n            if (previousNode) $9bf71ea28793e738$var$focusElement(previousNode, true);\n            return previousNode;\n        },\n        focusFirst (opts = defaultOptions) {\n            let root = ref.current;\n            if (!root) return;\n            let { tabbable: tabbable = defaultOptions.tabbable , accept: accept = defaultOptions.accept  } = opts;\n            let walker = $9bf71ea28793e738$export$2d6ec8fc375ceafa(root, {\n                tabbable: tabbable,\n                accept: accept\n            });\n            let nextNode = walker.nextNode();\n            if (nextNode) $9bf71ea28793e738$var$focusElement(nextNode, true);\n            return nextNode;\n        },\n        focusLast (opts = defaultOptions) {\n            let root = ref.current;\n            if (!root) return;\n            let { tabbable: tabbable = defaultOptions.tabbable , accept: accept = defaultOptions.accept  } = opts;\n            let walker = $9bf71ea28793e738$export$2d6ec8fc375ceafa(root, {\n                tabbable: tabbable,\n                accept: accept\n            });\n            let next = $9bf71ea28793e738$var$last(walker);\n            if (next) $9bf71ea28793e738$var$focusElement(next, true);\n            return next;\n        }\n    };\n}\nfunction $9bf71ea28793e738$var$last(walker) {\n    let next;\n    let last;\n    do {\n        last = walker.lastChild();\n        if (last) next = last;\n    }while (last)\n    return next;\n}\n\n\n\n\n\n\n\n\nfunction $f7dceffc5ad7768b$export$4e328f61c538687f(props = {\n}) {\n    let { autoFocus: autoFocus = false , isTextInput: isTextInput , within: within  } = props;\n    let state = $6nfFC$useRef({\n        isFocused: false,\n        isFocusVisible: autoFocus || $6nfFC$isFocusVisible()\n    });\n    let [isFocused1, setFocused] = $6nfFC$useState(false);\n    let [isFocusVisibleState, setFocusVisible] = $6nfFC$useState(()=>state.current.isFocused && state.current.isFocusVisible\n    );\n    let updateState = $6nfFC$useCallback(()=>setFocusVisible(state.current.isFocused && state.current.isFocusVisible)\n    , []);\n    let onFocusChange = $6nfFC$useCallback((isFocused)=>{\n        state.current.isFocused = isFocused;\n        setFocused(isFocused);\n        updateState();\n    }, [\n        updateState\n    ]);\n    $6nfFC$useFocusVisibleListener((isFocusVisible)=>{\n        state.current.isFocusVisible = isFocusVisible;\n        updateState();\n    }, [], {\n        isTextInput: isTextInput\n    });\n    let { focusProps: focusProps  } = $6nfFC$useFocus({\n        isDisabled: within,\n        onFocusChange: onFocusChange\n    });\n    let { focusWithinProps: focusWithinProps  } = $6nfFC$useFocusWithin({\n        isDisabled: !within,\n        onFocusWithinChange: onFocusChange\n    });\n    return {\n        isFocused: isFocused1,\n        isFocusVisible: state.current.isFocused && isFocusVisibleState,\n        focusProps: within ? focusWithinProps : focusProps\n    };\n}\n\n\nfunction $907718708eab68af$export$1a38b4ad7f578e1d(props) {\n    let { children: children , focusClass: focusClass , focusRingClass: focusRingClass  } = props;\n    let { isFocused: isFocused , isFocusVisible: isFocusVisible , focusProps: focusProps  } = $f7dceffc5ad7768b$export$4e328f61c538687f(props);\n    let child = $6nfFC$react.Children.only(children);\n    return(/*#__PURE__*/ $6nfFC$react.cloneElement(child, $6nfFC$mergeProps(child.props, {\n        ...focusProps,\n        className: $6nfFC$clsx({\n            [focusClass || '']: isFocused,\n            [focusRingClass || '']: isFocusVisible\n        })\n    })));\n}\n\n\n\n\n\n\nlet $e6afbd83fe6ebbd2$var$FocusableContext = /*#__PURE__*/ $6nfFC$react.createContext(null);\nfunction $e6afbd83fe6ebbd2$var$useFocusableContext(ref) {\n    let context = $6nfFC$useContext($e6afbd83fe6ebbd2$var$FocusableContext) || {\n    };\n    $6nfFC$useSyncRef(context, ref);\n    // eslint-disable-next-line\n    let { ref: _ , ...otherProps } = context;\n    return otherProps;\n}\n/**\n * Provides DOM props to the nearest focusable child.\n */ function $e6afbd83fe6ebbd2$var$FocusableProvider(props, ref) {\n    let { children: children , ...otherProps } = props;\n    let context = {\n        ...otherProps,\n        ref: ref\n    };\n    return(/*#__PURE__*/ $6nfFC$react.createElement($e6afbd83fe6ebbd2$var$FocusableContext.Provider, {\n        value: context\n    }, children));\n}\nlet $e6afbd83fe6ebbd2$export$13f3202a3e5ddd5 = /*#__PURE__*/ $6nfFC$react.forwardRef($e6afbd83fe6ebbd2$var$FocusableProvider);\nfunction $e6afbd83fe6ebbd2$export$4c014de7c8940b4c(props, domRef) {\n    let { focusProps: focusProps  } = $6nfFC$useFocus(props);\n    let { keyboardProps: keyboardProps  } = $6nfFC$useKeyboard(props);\n    let interactions = $6nfFC$mergeProps(focusProps, keyboardProps);\n    let domProps = $e6afbd83fe6ebbd2$var$useFocusableContext(domRef);\n    let interactionProps = props.isDisabled ? {\n    } : domProps;\n    let autoFocusRef = $6nfFC$useRef(props.autoFocus);\n    $6nfFC$useEffect(()=>{\n        if (autoFocusRef.current && domRef.current) $6a99195332edec8b$export$80f3e147d781571c(domRef.current);\n        autoFocusRef.current = false;\n    }, [\n        domRef\n    ]);\n    return {\n        focusableProps: $6nfFC$mergeProps({\n            ...interactions,\n            tabIndex: props.excludeFromTabOrder && !props.isDisabled ? -1 : undefined\n        }, interactionProps)\n    };\n}\n\n\n\n\n\n\nexport {$9bf71ea28793e738$export$20e40289641fbbb6 as FocusScope, $9bf71ea28793e738$export$10c5169755ce7bd7 as useFocusManager, $9bf71ea28793e738$export$2d6ec8fc375ceafa as getFocusableTreeWalker, $9bf71ea28793e738$export$c5251b9e124bf29 as createFocusManager, $907718708eab68af$export$1a38b4ad7f578e1d as FocusRing, $e6afbd83fe6ebbd2$export$13f3202a3e5ddd5 as FocusableProvider, $e6afbd83fe6ebbd2$export$4c014de7c8940b4c as useFocusable, $f7dceffc5ad7768b$export$4e328f61c538687f as useFocusRing, $6a99195332edec8b$export$80f3e147d781571c as focusSafely};\n//# sourceMappingURL=module.js.map\n","class $5b160d28a433310d$export$c17fa47878dc55b6 {\n    /** Returns a localized string for the given key and locale. */ getStringForLocale(key, locale) {\n        let strings = this.strings[locale];\n        if (!strings) {\n            strings = $5b160d28a433310d$var$getStringsForLocale(locale, this.strings, this.defaultLocale);\n            this.strings[locale] = strings;\n        }\n        let string = strings[key];\n        if (!string) throw new Error(`Could not find intl message ${key} in ${locale} locale`);\n        return string;\n    }\n    constructor(messages, defaultLocale = 'en-US'){\n        // Clone messages so we don't modify the original object.\n        this.strings = {\n            ...messages\n        };\n        this.defaultLocale = defaultLocale;\n    }\n}\nfunction $5b160d28a433310d$var$getStringsForLocale(locale, strings, defaultLocale = 'en-US') {\n    // If there is an exact match, use it.\n    if (strings[locale]) return strings[locale];\n    // Attempt to find the closest match by language.\n    // For example, if the locale is fr-CA (French Canadian), but there is only\n    // an fr-FR (France) set of strings, use that.\n    // This could be replaced with Intl.LocaleMatcher once it is supported.\n    // https://github.com/tc39/proposal-intl-localematcher\n    let language = $5b160d28a433310d$var$getLanguage(locale);\n    if (strings[language]) return strings[language];\n    for(let key in strings){\n        if (key.startsWith(language + '-')) return strings[key];\n    }\n    // Nothing close, use english.\n    return strings[defaultLocale];\n}\nfunction $5b160d28a433310d$var$getLanguage(locale) {\n    // @ts-ignore\n    if (Intl.Locale) // @ts-ignore\n    return new Intl.Locale(locale).language;\n    return locale.split('-')[0];\n}\n\n\nconst $6db58dc88e78b024$var$pluralRulesCache = new Map();\nconst $6db58dc88e78b024$var$numberFormatCache = new Map();\nclass $6db58dc88e78b024$export$2f817fcdc4b89ae0 {\n    /** Formats a localized string for the given key with the provided variables. */ format(key, variables) {\n        let message = this.strings.getStringForLocale(key, this.locale);\n        return typeof message === 'function' ? message(variables, this) : message;\n    }\n    plural(count, options, type = 'cardinal') {\n        let opt = options['=' + count];\n        if (opt) return typeof opt === 'function' ? opt() : opt;\n        let key = this.locale + ':' + type;\n        let pluralRules = $6db58dc88e78b024$var$pluralRulesCache.get(key);\n        if (!pluralRules) {\n            pluralRules = new Intl.PluralRules(this.locale, {\n                type: type\n            });\n            $6db58dc88e78b024$var$pluralRulesCache.set(key, pluralRules);\n        }\n        let selected = pluralRules.select(count);\n        opt = options[selected] || options.other;\n        return typeof opt === 'function' ? opt() : opt;\n    }\n    number(value) {\n        let numberFormat = $6db58dc88e78b024$var$numberFormatCache.get(this.locale);\n        if (!numberFormat) {\n            numberFormat = new Intl.NumberFormat(this.locale);\n            $6db58dc88e78b024$var$numberFormatCache.set(this.locale, numberFormat);\n        }\n        return numberFormat.format(value);\n    }\n    select(options, value) {\n        let opt = options[value] || options.other;\n        return typeof opt === 'function' ? opt() : opt;\n    }\n    constructor(locale, strings){\n        this.locale = locale;\n        this.strings = strings;\n    }\n}\n\n\n\n\nexport {$5b160d28a433310d$export$c17fa47878dc55b6 as LocalizedStringDictionary, $6db58dc88e78b024$export$2f817fcdc4b89ae0 as LocalizedStringFormatter};\n//# sourceMappingURL=module.js.map\n","/*\n * Copyright 2020 Adobe. All rights reserved.\n * This file is licensed to you under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License. You may obtain a copy\n * of the License at http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software distributed under\n * the License is distributed on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR REPRESENTATIONS\n * OF ANY KIND, either express or implied. See the License for the specific language\n * governing permissions and limitations under the License.\n */ let $488c6ddbf4ef74c2$var$formatterCache = new Map();\nlet $488c6ddbf4ef74c2$var$supportsSignDisplay = false;\ntry {\n    // @ts-ignore\n    $488c6ddbf4ef74c2$var$supportsSignDisplay = new Intl.NumberFormat('de-DE', {\n        signDisplay: 'exceptZero'\n    }).resolvedOptions().signDisplay === 'exceptZero';\n// eslint-disable-next-line no-empty\n} catch (e) {\n}\nlet $488c6ddbf4ef74c2$var$supportsUnit = false;\ntry {\n    // @ts-ignore\n    $488c6ddbf4ef74c2$var$supportsUnit = new Intl.NumberFormat('de-DE', {\n        style: 'unit',\n        unit: 'degree'\n    }).resolvedOptions().style === 'unit';\n// eslint-disable-next-line no-empty\n} catch (e1) {\n}\n// Polyfill for units since Safari doesn't support them yet. See https://bugs.webkit.org/show_bug.cgi?id=215438.\n// Currently only polyfilling the unit degree in narrow format for ColorSlider in our supported locales.\n// Values were determined by switching to each locale manually in Chrome.\nconst $488c6ddbf4ef74c2$var$UNITS = {\n    degree: {\n        narrow: {\n            default: '°',\n            'ja-JP': ' 度',\n            'zh-TW': '度',\n            'sl-SI': ' °'\n        }\n    }\n};\nclass $488c6ddbf4ef74c2$export$cc77c4ff7e8673c5 {\n    /** Formats a number value as a string, according to the locale and options provided to the constructor. */ format(value) {\n        let res = '';\n        if (!$488c6ddbf4ef74c2$var$supportsSignDisplay && this.options.signDisplay != null) res = $488c6ddbf4ef74c2$export$711b50b3c525e0f2(this.numberFormatter, this.options.signDisplay, value);\n        else res = this.numberFormatter.format(value);\n        if (this.options.style === 'unit' && !$488c6ddbf4ef74c2$var$supportsUnit) {\n            var ref;\n            let { unit: unit , unitDisplay: unitDisplay = 'short' , locale: locale  } = this.resolvedOptions();\n            let values = (ref = $488c6ddbf4ef74c2$var$UNITS[unit]) === null || ref === void 0 ? void 0 : ref[unitDisplay];\n            res += values[locale] || values.default;\n        }\n        return res;\n    }\n    /** Formats a number to an array of parts such as separators, digits, punctuation, and more. */ formatToParts(value) {\n        // TODO: implement signDisplay for formatToParts\n        // @ts-ignore\n        return this.numberFormatter.formatToParts(value);\n    }\n    /** Formats a number range as a string. */ formatRange(start, end) {\n        // @ts-ignore\n        if (typeof this.numberFormatter.formatRange === 'function') // @ts-ignore\n        return this.numberFormatter.formatRange(start, end);\n        if (end < start) throw new RangeError('End date must be >= start date');\n        // Very basic fallback for old browsers.\n        return `${this.format(start)} – ${this.format(end)}`;\n    }\n    /** Formats a number range as an array of parts. */ formatRangeToParts(start, end) {\n        // @ts-ignore\n        if (typeof this.numberFormatter.formatRangeToParts === 'function') // @ts-ignore\n        return this.numberFormatter.formatRangeToParts(start, end);\n        if (end < start) throw new RangeError('End date must be >= start date');\n        let startParts = this.numberFormatter.formatToParts(start);\n        let endParts = this.numberFormatter.formatToParts(end);\n        return [\n            ...startParts.map((p)=>({\n                    ...p,\n                    source: 'startRange'\n                })\n            ),\n            {\n                type: 'literal',\n                value: ' – ',\n                source: 'shared'\n            },\n            ...endParts.map((p)=>({\n                    ...p,\n                    source: 'endRange'\n                })\n            )\n        ];\n    }\n    /** Returns the resolved formatting options based on the values passed to the constructor. */ resolvedOptions() {\n        let options = this.numberFormatter.resolvedOptions();\n        if (!$488c6ddbf4ef74c2$var$supportsSignDisplay && this.options.signDisplay != null) options = {\n            ...options,\n            signDisplay: this.options.signDisplay\n        };\n        if (!$488c6ddbf4ef74c2$var$supportsUnit && this.options.style === 'unit') options = {\n            ...options,\n            style: 'unit',\n            unit: this.options.unit,\n            unitDisplay: this.options.unitDisplay\n        };\n        return options;\n    }\n    constructor(locale, options = {\n    }){\n        this.numberFormatter = $488c6ddbf4ef74c2$var$getCachedNumberFormatter(locale, options);\n        this.options = options;\n    }\n}\nfunction $488c6ddbf4ef74c2$var$getCachedNumberFormatter(locale, options = {\n}) {\n    let { numberingSystem: numberingSystem  } = options;\n    if (numberingSystem && locale.indexOf('-u-nu-') === -1) locale = `${locale}-u-nu-${numberingSystem}`;\n    if (options.style === 'unit' && !$488c6ddbf4ef74c2$var$supportsUnit) {\n        var ref;\n        let { unit: unit , unitDisplay: unitDisplay = 'short'  } = options;\n        if (!unit) throw new Error('unit option must be provided with style: \"unit\"');\n        if (!((ref = $488c6ddbf4ef74c2$var$UNITS[unit]) === null || ref === void 0 ? void 0 : ref[unitDisplay])) throw new Error(`Unsupported unit ${unit} with unitDisplay = ${unitDisplay}`);\n        options = {\n            ...options,\n            style: 'decimal'\n        };\n    }\n    let cacheKey = locale + (options ? Object.entries(options).sort((a, b)=>a[0] < b[0] ? -1 : 1\n    ).join() : '');\n    if ($488c6ddbf4ef74c2$var$formatterCache.has(cacheKey)) return $488c6ddbf4ef74c2$var$formatterCache.get(cacheKey);\n    let numberFormatter = new Intl.NumberFormat(locale, options);\n    $488c6ddbf4ef74c2$var$formatterCache.set(cacheKey, numberFormatter);\n    return numberFormatter;\n}\nfunction $488c6ddbf4ef74c2$export$711b50b3c525e0f2(numberFormat, signDisplay, num) {\n    if (signDisplay === 'auto') return numberFormat.format(num);\n    else if (signDisplay === 'never') return numberFormat.format(Math.abs(num));\n    else {\n        let needsPositiveSign = false;\n        if (signDisplay === 'always') needsPositiveSign = num > 0 || Object.is(num, 0);\n        else if (signDisplay === 'exceptZero') {\n            if (Object.is(num, -0) || Object.is(num, 0)) num = Math.abs(num);\n            else needsPositiveSign = num > 0;\n        }\n        if (needsPositiveSign) {\n            let negative = numberFormat.format(-num);\n            let noSign = numberFormat.format(num);\n            // ignore RTL/LTR marker character\n            let minus = negative.replace(noSign, '').replace(/\\u200e|\\u061C/, '');\n            if ([\n                ...minus\n            ].length !== 1) console.warn('@react-aria/i18n polyfill for NumberFormat signDisplay: Unsupported case');\n            let positive = negative.replace(noSign, '!!!').replace(minus, '+').replace('!!!', noSign);\n            return positive;\n        } else return numberFormat.format(num);\n    }\n}\n\n\nconst $6c7bd7858deea686$var$CURRENCY_SIGN_REGEX = new RegExp('^.*\\\\(.*\\\\).*$');\nconst $6c7bd7858deea686$var$NUMBERING_SYSTEMS = [\n    'latn',\n    'arab',\n    'hanidec'\n];\nclass $6c7bd7858deea686$export$cd11ab140839f11d {\n    /**\n   * Parses the given string to a number. Returns NaN if a valid number could not be parsed.\n   */ parse(value) {\n        return $6c7bd7858deea686$var$getNumberParserImpl(this.locale, this.options, value).parse(value);\n    }\n    /**\n   * Returns whether the given string could potentially be a valid number. This should be used to\n   * validate user input as the user types. If a `minValue` or `maxValue` is provided, the validity\n   * of the minus/plus sign characters can be checked.\n   */ isValidPartialNumber(value, minValue, maxValue) {\n        return $6c7bd7858deea686$var$getNumberParserImpl(this.locale, this.options, value).isValidPartialNumber(value, minValue, maxValue);\n    }\n    /**\n   * Returns a numbering system for which the given string is valid in the current locale.\n   * If no numbering system could be detected, the default numbering system for the current\n   * locale is returned.\n   */ getNumberingSystem(value) {\n        return $6c7bd7858deea686$var$getNumberParserImpl(this.locale, this.options, value).options.numberingSystem;\n    }\n    constructor(locale, options = {\n    }){\n        this.locale = locale;\n        this.options = options;\n    }\n}\nconst $6c7bd7858deea686$var$numberParserCache = new Map();\nfunction $6c7bd7858deea686$var$getNumberParserImpl(locale, options, value) {\n    // First try the default numbering system for the provided locale\n    let defaultParser = $6c7bd7858deea686$var$getCachedNumberParser(locale, options);\n    // If that doesn't match, and the locale doesn't include a hard coded numbering system,\n    // try each of the other supported numbering systems until we find one that matches.\n    if (!locale.includes('-nu-') && !defaultParser.isValidPartialNumber(value)) {\n        for (let numberingSystem of $6c7bd7858deea686$var$NUMBERING_SYSTEMS)if (numberingSystem !== defaultParser.options.numberingSystem) {\n            let parser = $6c7bd7858deea686$var$getCachedNumberParser(locale + (locale.includes('-u-') ? '-nu-' : '-u-nu-') + numberingSystem, options);\n            if (parser.isValidPartialNumber(value)) return parser;\n        }\n    }\n    return defaultParser;\n}\nfunction $6c7bd7858deea686$var$getCachedNumberParser(locale, options) {\n    let cacheKey = locale + (options ? Object.entries(options).sort((a, b)=>a[0] < b[0] ? -1 : 1\n    ).join() : '');\n    let parser = $6c7bd7858deea686$var$numberParserCache.get(cacheKey);\n    if (!parser) {\n        parser = new $6c7bd7858deea686$var$NumberParserImpl(locale, options);\n        $6c7bd7858deea686$var$numberParserCache.set(cacheKey, parser);\n    }\n    return parser;\n}\n// The actual number parser implementation. Instances of this class are cached\n// based on the locale, options, and detected numbering system.\nclass $6c7bd7858deea686$var$NumberParserImpl {\n    parse(value) {\n        // to parse the number, we need to remove anything that isn't actually part of the number, for example we want '-10.40' not '-10.40 USD'\n        let fullySanitizedValue = this.sanitize(value);\n        // Remove group characters, and replace decimal points and numerals with ASCII values.\n        fullySanitizedValue = $6c7bd7858deea686$var$replaceAll(fullySanitizedValue, this.symbols.group, '').replace(this.symbols.decimal, '.').replace(this.symbols.minusSign, '-').replace(this.symbols.numeral, this.symbols.index);\n        let newValue = fullySanitizedValue ? +fullySanitizedValue : NaN;\n        if (isNaN(newValue)) return NaN;\n        // accounting will always be stripped to a positive number, so if it's accounting and has a () around everything, then we need to make it negative again\n        if (this.options.currencySign === 'accounting' && $6c7bd7858deea686$var$CURRENCY_SIGN_REGEX.test(value)) newValue = -1 * newValue;\n        // when reading the number, if it's a percent, then it should be interpreted as being divided by 100\n        if (this.options.style === 'percent') {\n            newValue /= 100;\n            var _maximumFractionDigits;\n            // after dividing to get the percent value, javascript may get .0210999999 instead of .0211, so fix the number of fraction digits\n            newValue = +newValue.toFixed(((_maximumFractionDigits = this.options.maximumFractionDigits) !== null && _maximumFractionDigits !== void 0 ? _maximumFractionDigits : 0) + 2);\n        }\n        return newValue;\n    }\n    sanitize(value) {\n        // Remove literals and whitespace, which are allowed anywhere in the string\n        value = value.replace(this.symbols.literals, '');\n        // Replace the ASCII minus sign with the minus sign used in the current locale\n        // so that both are allowed in case the user's keyboard doesn't have the locale's minus sign.\n        value = value.replace('-', this.symbols.minusSign);\n        // In arab numeral system, their decimal character is 1643, but most keyboards don't type that\n        // instead they use the , (44) character or apparently the (1548) character.\n        if (this.options.numberingSystem === 'arab') {\n            value = value.replace(',', this.symbols.decimal);\n            value = value.replace(String.fromCharCode(1548), this.symbols.decimal);\n            value = $6c7bd7858deea686$var$replaceAll(value, '.', this.symbols.group);\n        }\n        // fr-FR group character is char code 8239, but that's not a key on the french keyboard,\n        // so allow 'period' as a group char and replace it with a space\n        if (this.options.locale === 'fr-FR') value = $6c7bd7858deea686$var$replaceAll(value, '.', String.fromCharCode(8239));\n        return value;\n    }\n    isValidPartialNumber(value, minValue = -Infinity, maxValue = Infinity) {\n        value = this.sanitize(value);\n        // Remove minus or plus sign, which must be at the start of the string.\n        if (value.startsWith(this.symbols.minusSign) && minValue < 0) value = value.slice(this.symbols.minusSign.length);\n        else if (this.symbols.plusSign && value.startsWith(this.symbols.plusSign) && maxValue > 0) value = value.slice(this.symbols.plusSign.length);\n        // Numbers cannot start with a group separator\n        if (value.startsWith(this.symbols.group)) return false;\n        // Remove numerals, groups, and decimals\n        value = $6c7bd7858deea686$var$replaceAll(value, this.symbols.group, '').replace(this.symbols.numeral, '').replace(this.symbols.decimal, '');\n        // The number is valid if there are no remaining characters\n        return value.length === 0;\n    }\n    constructor(locale, options = {\n    }){\n        this.formatter = new Intl.NumberFormat(locale, options);\n        this.options = this.formatter.resolvedOptions();\n        this.symbols = $6c7bd7858deea686$var$getSymbols(this.formatter, this.options, options);\n    }\n}\nconst $6c7bd7858deea686$var$nonLiteralParts = new Set([\n    'decimal',\n    'fraction',\n    'integer',\n    'minusSign',\n    'plusSign',\n    'group'\n]);\nfunction $6c7bd7858deea686$var$getSymbols(formatter, intlOptions, originalOptions) {\n    var ref, ref1, ref2, ref3;\n    // Note: some locale's don't add a group symbol until there is a ten thousands place\n    let allParts = formatter.formatToParts(-10000.111);\n    let posAllParts = formatter.formatToParts(10000.111);\n    let singularParts = formatter.formatToParts(1);\n    var ref4;\n    let minusSign = (ref4 = (ref = allParts.find((p)=>p.type === 'minusSign'\n    )) === null || ref === void 0 ? void 0 : ref.value) !== null && ref4 !== void 0 ? ref4 : '-';\n    let plusSign = (ref1 = posAllParts.find((p)=>p.type === 'plusSign'\n    )) === null || ref1 === void 0 ? void 0 : ref1.value;\n    // Safari does not support the signDisplay option, but our number parser polyfills it.\n    // If no plus sign was returned, but the original options contained signDisplay, default to the '+' character.\n    // @ts-ignore\n    if (!plusSign && ((originalOptions === null || originalOptions === void 0 ? void 0 : originalOptions.signDisplay) === 'exceptZero' || (originalOptions === null || originalOptions === void 0 ? void 0 : originalOptions.signDisplay) === 'always')) plusSign = '+';\n    let decimal = (ref2 = allParts.find((p)=>p.type === 'decimal'\n    )) === null || ref2 === void 0 ? void 0 : ref2.value;\n    let group = (ref3 = allParts.find((p)=>p.type === 'group'\n    )) === null || ref3 === void 0 ? void 0 : ref3.value;\n    // this set is also for a regex, it's all literals that might be in the string we want to eventually parse that\n    // don't contribute to the numerical value\n    let pluralLiterals = allParts.filter((p)=>!$6c7bd7858deea686$var$nonLiteralParts.has(p.type)\n    ).map((p)=>$6c7bd7858deea686$var$escapeRegex(p.value)\n    );\n    let singularLiterals = singularParts.filter((p)=>!$6c7bd7858deea686$var$nonLiteralParts.has(p.type)\n    ).map((p)=>$6c7bd7858deea686$var$escapeRegex(p.value)\n    );\n    let sortedLiterals = [\n        ...new Set([\n            ...singularLiterals,\n            ...pluralLiterals\n        ])\n    ].sort((a, b)=>b.length - a.length\n    );\n    let literals = sortedLiterals.length === 0 ? new RegExp('[\\\\p{White_Space}]', 'gu') : new RegExp(`${sortedLiterals.join('|')}|[\\\\p{White_Space}]`, 'gu');\n    // These are for replacing non-latn characters with the latn equivalent\n    let numerals = [\n        ...new Intl.NumberFormat(intlOptions.locale, {\n            useGrouping: false\n        }).format(9876543210)\n    ].reverse();\n    let indexes = new Map(numerals.map((d, i)=>[\n            d,\n            i\n        ]\n    ));\n    let numeral = new RegExp(`[${numerals.join('')}]`, 'g');\n    let index = (d)=>String(indexes.get(d))\n    ;\n    return {\n        minusSign: minusSign,\n        plusSign: plusSign,\n        decimal: decimal,\n        group: group,\n        literals: literals,\n        numeral: numeral,\n        index: index\n    };\n}\nfunction $6c7bd7858deea686$var$replaceAll(str, find, replace) {\n    // @ts-ignore\n    if (str.replaceAll) // @ts-ignore\n    return str.replaceAll(find, replace);\n    return str.split(find).join(replace);\n}\nfunction $6c7bd7858deea686$var$escapeRegex(string) {\n    return string.replace(/[-/\\\\^$*+?.()|[\\]{}]/g, '\\\\$&');\n}\n\n\n\n\nexport {$488c6ddbf4ef74c2$export$cc77c4ff7e8673c5 as NumberFormatter, $6c7bd7858deea686$export$cd11ab140839f11d as NumberParser};\n//# sourceMappingURL=module.js.map\n","import $k7QOs$react, {useState as $k7QOs$useState, useCallback as $k7QOs$useCallback, useRef as $k7QOs$useRef, useEffect as $k7QOs$useEffect, useContext as $k7QOs$useContext, useMemo as $k7QOs$useMemo} from \"react\";\nimport {useLayoutEffect as $k7QOs$useLayoutEffect, useId as $k7QOs$useId, isIOS as $k7QOs$isIOS, chain as $k7QOs$chain, getScrollParent as $k7QOs$getScrollParent, useLabels as $k7QOs$useLabels} from \"@react-aria/utils\";\nimport {useLocale as $k7QOs$useLocale, useLocalizedStringFormatter as $k7QOs$useLocalizedStringFormatter} from \"@react-aria/i18n\";\nimport {useInteractOutside as $k7QOs$useInteractOutside, useFocusWithin as $k7QOs$useFocusWithin} from \"@react-aria/interactions\";\nimport $k7QOs$reactdom from \"react-dom\";\nimport {useIsSSR as $k7QOs$useIsSSR} from \"@react-aria/ssr\";\nimport {VisuallyHidden as $k7QOs$VisuallyHidden} from \"@react-aria/visually-hidden\";\n\nfunction $parcel$interopDefault(a) {\n  return a && a.__esModule ? a.default : a;\n}\nconst $edcf132a9284368a$var$AXIS = {\n    top: 'top',\n    bottom: 'top',\n    left: 'left',\n    right: 'left'\n};\nconst $edcf132a9284368a$var$FLIPPED_DIRECTION = {\n    top: 'bottom',\n    bottom: 'top',\n    left: 'right',\n    right: 'left'\n};\nconst $edcf132a9284368a$var$CROSS_AXIS = {\n    top: 'left',\n    left: 'top'\n};\nconst $edcf132a9284368a$var$AXIS_SIZE = {\n    top: 'height',\n    left: 'width'\n};\nconst $edcf132a9284368a$var$PARSED_PLACEMENT_CACHE = {\n};\n// @ts-ignore\nlet $edcf132a9284368a$var$visualViewport = typeof window !== 'undefined' && window.visualViewport;\nfunction $edcf132a9284368a$var$getContainerDimensions(containerNode) {\n    let width = 0, height = 0, top = 0, left = 0;\n    let scroll = {\n    };\n    if (containerNode.tagName === 'BODY') {\n        let documentElement = document.documentElement;\n        var ref;\n        width = (ref = $edcf132a9284368a$var$visualViewport === null || $edcf132a9284368a$var$visualViewport === void 0 ? void 0 : $edcf132a9284368a$var$visualViewport.width) !== null && ref !== void 0 ? ref : documentElement.clientWidth;\n        var ref1;\n        height = (ref1 = $edcf132a9284368a$var$visualViewport === null || $edcf132a9284368a$var$visualViewport === void 0 ? void 0 : $edcf132a9284368a$var$visualViewport.height) !== null && ref1 !== void 0 ? ref1 : documentElement.clientHeight;\n        scroll.top = documentElement.scrollTop || containerNode.scrollTop;\n        scroll.left = documentElement.scrollLeft || containerNode.scrollLeft;\n    } else {\n        ({ width: width , height: height , top: top , left: left  } = $edcf132a9284368a$var$getOffset(containerNode));\n        scroll.top = containerNode.scrollTop;\n        scroll.left = containerNode.scrollLeft;\n    }\n    return {\n        width: width,\n        height: height,\n        scroll: scroll,\n        top: top,\n        left: left\n    };\n}\nfunction $edcf132a9284368a$var$getScroll(node) {\n    return {\n        top: node.scrollTop,\n        left: node.scrollLeft,\n        width: node.scrollWidth,\n        height: node.scrollHeight\n    };\n}\nfunction $edcf132a9284368a$var$getDelta(axis, offset, size, containerDimensions, padding) {\n    let containerScroll = containerDimensions.scroll[axis];\n    let containerHeight = containerDimensions[$edcf132a9284368a$var$AXIS_SIZE[axis]];\n    let startEdgeOffset = offset - padding - containerScroll;\n    let endEdgeOffset = offset + padding - containerScroll + size;\n    if (startEdgeOffset < 0) return -startEdgeOffset;\n    else if (endEdgeOffset > containerHeight) return Math.max(containerHeight - endEdgeOffset, -startEdgeOffset);\n    else return 0;\n}\nfunction $edcf132a9284368a$var$getMargins(node) {\n    let style = window.getComputedStyle(node);\n    return {\n        top: parseInt(style.marginTop, 10) || 0,\n        bottom: parseInt(style.marginBottom, 10) || 0,\n        left: parseInt(style.marginLeft, 10) || 0,\n        right: parseInt(style.marginRight, 10) || 0\n    };\n}\nfunction $edcf132a9284368a$var$parsePlacement(input) {\n    if ($edcf132a9284368a$var$PARSED_PLACEMENT_CACHE[input]) return $edcf132a9284368a$var$PARSED_PLACEMENT_CACHE[input];\n    let [placement, crossPlacement] = input.split(' ');\n    let axis = $edcf132a9284368a$var$AXIS[placement] || 'right';\n    let crossAxis = $edcf132a9284368a$var$CROSS_AXIS[axis];\n    if (!$edcf132a9284368a$var$AXIS[crossPlacement]) crossPlacement = 'center';\n    let size = $edcf132a9284368a$var$AXIS_SIZE[axis];\n    let crossSize = $edcf132a9284368a$var$AXIS_SIZE[crossAxis];\n    $edcf132a9284368a$var$PARSED_PLACEMENT_CACHE[input] = {\n        placement: placement,\n        crossPlacement: crossPlacement,\n        axis: axis,\n        crossAxis: crossAxis,\n        size: size,\n        crossSize: crossSize\n    };\n    return $edcf132a9284368a$var$PARSED_PLACEMENT_CACHE[input];\n}\nfunction $edcf132a9284368a$var$computePosition(childOffset, boundaryDimensions, overlaySize, placementInfo, offset, crossOffset, containerOffsetWithBoundary, isContainerPositioned) {\n    let { placement: placement , crossPlacement: crossPlacement , axis: axis , crossAxis: crossAxis , size: size , crossSize: crossSize  } = placementInfo;\n    let position = {\n    };\n    // button position\n    position[crossAxis] = childOffset[crossAxis];\n    if (crossPlacement === 'center') //  + (button size / 2) - (overlay size / 2)\n    // at this point the overlay center should match the button center\n    position[crossAxis] += (childOffset[crossSize] - overlaySize[crossSize]) / 2;\n    else if (crossPlacement !== crossAxis) //  + (button size) - (overlay size)\n    // at this point the overlay bottom should match the button bottom\n    position[crossAxis] += childOffset[crossSize] - overlaySize[crossSize];\n     /* else {\n    the overlay top should match the button top\n  } */ \n    // add the crossOffset from props\n    position[crossAxis] += crossOffset;\n    // this is button center position - the overlay size + half of the button to align bottom of overlay with button center\n    let minViablePosition = childOffset[crossAxis] + childOffset[crossSize] / 2 - overlaySize[crossSize];\n    // this is button position of center, aligns top of overlay with button center\n    let maxViablePosition = childOffset[crossAxis] + childOffset[crossSize] / 2;\n    // clamp it into the range of the min/max positions\n    position[crossAxis] = Math.min(Math.max(minViablePosition, position[crossAxis]), maxViablePosition);\n    // Floor these so the position isn't placed on a partial pixel, only whole pixels. Shouldn't matter if it was floored or ceiled, so chose one.\n    if (placement === axis) {\n        // If the container is positioned (non-static), then we use the container's actual\n        // height, as `bottom` will be relative to this height.  But if the container is static,\n        // then it can only be the `document.body`, and `bottom` will be relative to _its_\n        // container, which should be as large as boundaryDimensions.\n        const containerHeight = isContainerPositioned ? containerOffsetWithBoundary[size] : boundaryDimensions[size];\n        position[$edcf132a9284368a$var$FLIPPED_DIRECTION[axis]] = Math.floor(containerHeight - childOffset[axis] + offset);\n    } else position[axis] = Math.floor(childOffset[axis] + childOffset[size] + offset);\n    return position;\n}\nfunction $edcf132a9284368a$var$getMaxHeight(position, boundaryDimensions, containerOffsetWithBoundary, childOffset, margins, padding) {\n    return position.top != null ? Math.max(0, boundaryDimensions.height + boundaryDimensions.top + boundaryDimensions.scroll.top - (containerOffsetWithBoundary.top + position.top) - (margins.top + margins.bottom + padding) // save additional space for margin and padding\n    ) : Math.max(0, childOffset.top + containerOffsetWithBoundary.top - (boundaryDimensions.top + boundaryDimensions.scroll.top) - (margins.top + margins.bottom + padding) // save additional space for margin and padding\n    );\n}\nfunction $edcf132a9284368a$var$getAvailableSpace(boundaryDimensions, containerOffsetWithBoundary, childOffset, margins, padding, placementInfo) {\n    let { placement: placement , axis: axis , size: size  } = placementInfo;\n    if (placement === axis) return Math.max(0, childOffset[axis] - boundaryDimensions[axis] - boundaryDimensions.scroll[axis] + containerOffsetWithBoundary[axis] - margins[axis] - margins[$edcf132a9284368a$var$FLIPPED_DIRECTION[axis]] - padding);\n    return Math.max(0, boundaryDimensions[size] + boundaryDimensions[axis] + boundaryDimensions.scroll[axis] - containerOffsetWithBoundary[axis] - childOffset[axis] - childOffset[size] - margins[axis] - margins[$edcf132a9284368a$var$FLIPPED_DIRECTION[axis]] - padding);\n}\nfunction $edcf132a9284368a$export$6839422d1f33cee9(placementInput, childOffset, overlaySize, scrollSize, margins, padding, flip, boundaryDimensions, containerOffsetWithBoundary, offset, crossOffset, isContainerPositioned, userSetMaxHeight) {\n    let placementInfo = $edcf132a9284368a$var$parsePlacement(placementInput);\n    let { size: size , crossAxis: crossAxis , crossSize: crossSize , placement: placement , crossPlacement: crossPlacement  } = placementInfo;\n    let position = $edcf132a9284368a$var$computePosition(childOffset, boundaryDimensions, overlaySize, placementInfo, offset, crossOffset, containerOffsetWithBoundary, isContainerPositioned);\n    let normalizedOffset = offset;\n    let space = $edcf132a9284368a$var$getAvailableSpace(boundaryDimensions, containerOffsetWithBoundary, childOffset, margins, padding + offset, placementInfo);\n    // Check if the scroll size of the overlay is greater than the available space to determine if we need to flip\n    if (flip && scrollSize[size] > space) {\n        let flippedPlacementInfo = $edcf132a9284368a$var$parsePlacement(`${$edcf132a9284368a$var$FLIPPED_DIRECTION[placement]} ${crossPlacement}`);\n        let flippedPosition = $edcf132a9284368a$var$computePosition(childOffset, boundaryDimensions, overlaySize, flippedPlacementInfo, offset, crossOffset, containerOffsetWithBoundary, isContainerPositioned);\n        let flippedSpace = $edcf132a9284368a$var$getAvailableSpace(boundaryDimensions, containerOffsetWithBoundary, childOffset, margins, padding + offset, flippedPlacementInfo);\n        // If the available space for the flipped position is greater than the original available space, flip.\n        if (flippedSpace > space) {\n            placementInfo = flippedPlacementInfo;\n            position = flippedPosition;\n            normalizedOffset = offset;\n        }\n    }\n    let delta = $edcf132a9284368a$var$getDelta(crossAxis, position[crossAxis], overlaySize[crossSize], boundaryDimensions, padding);\n    position[crossAxis] += delta;\n    let maxHeight = $edcf132a9284368a$var$getMaxHeight(position, boundaryDimensions, containerOffsetWithBoundary, childOffset, margins, padding);\n    if (userSetMaxHeight && userSetMaxHeight < maxHeight) maxHeight = userSetMaxHeight;\n    overlaySize.height = Math.min(overlaySize.height, maxHeight);\n    position = $edcf132a9284368a$var$computePosition(childOffset, boundaryDimensions, overlaySize, placementInfo, normalizedOffset, crossOffset, containerOffsetWithBoundary, isContainerPositioned);\n    delta = $edcf132a9284368a$var$getDelta(crossAxis, position[crossAxis], overlaySize[crossSize], boundaryDimensions, padding);\n    position[crossAxis] += delta;\n    let arrowPosition = {\n    };\n    arrowPosition[crossAxis] = childOffset[crossAxis] - position[crossAxis] + childOffset[crossSize] / 2;\n    return {\n        position: position,\n        maxHeight: maxHeight,\n        arrowOffsetLeft: arrowPosition.left,\n        arrowOffsetTop: arrowPosition.top,\n        placement: placementInfo.placement\n    };\n}\nfunction $edcf132a9284368a$export$b3ceb0cbf1056d98(opts) {\n    let { placement: placement , targetNode: targetNode , overlayNode: overlayNode , scrollNode: scrollNode , padding: padding , shouldFlip: shouldFlip , boundaryElement: boundaryElement , offset: offset , crossOffset: crossOffset , maxHeight: maxHeight  } = opts;\n    let container = overlayNode instanceof HTMLElement && overlayNode.offsetParent || document.body;\n    let isBodyContainer = container.tagName === 'BODY';\n    const containerPositionStyle = window.getComputedStyle(container).position;\n    let isContainerPositioned = !!containerPositionStyle && containerPositionStyle !== 'static';\n    let childOffset = isBodyContainer ? $edcf132a9284368a$var$getOffset(targetNode) : $edcf132a9284368a$var$getPosition(targetNode, container);\n    if (!isBodyContainer) {\n        let { marginTop: marginTop , marginLeft: marginLeft  } = window.getComputedStyle(targetNode);\n        childOffset.top += parseInt(marginTop, 10) || 0;\n        childOffset.left += parseInt(marginLeft, 10) || 0;\n    }\n    let overlaySize = $edcf132a9284368a$var$getOffset(overlayNode);\n    let margins = $edcf132a9284368a$var$getMargins(overlayNode);\n    overlaySize.width += margins.left + margins.right;\n    overlaySize.height += margins.top + margins.bottom;\n    let scrollSize = $edcf132a9284368a$var$getScroll(scrollNode);\n    let boundaryDimensions = $edcf132a9284368a$var$getContainerDimensions(boundaryElement);\n    let containerOffsetWithBoundary = boundaryElement.tagName === 'BODY' ? $edcf132a9284368a$var$getOffset(container) : $edcf132a9284368a$var$getPosition(container, boundaryElement);\n    return $edcf132a9284368a$export$6839422d1f33cee9(placement, childOffset, overlaySize, scrollSize, margins, padding, shouldFlip, boundaryDimensions, containerOffsetWithBoundary, offset, crossOffset, isContainerPositioned, maxHeight);\n}\nfunction $edcf132a9284368a$var$getOffset(node) {\n    let { top: top , left: left , width: width , height: height  } = node.getBoundingClientRect();\n    let { scrollTop: scrollTop , scrollLeft: scrollLeft , clientTop: clientTop , clientLeft: clientLeft  } = document.documentElement;\n    return {\n        top: top + scrollTop - clientTop,\n        left: left + scrollLeft - clientLeft,\n        width: width,\n        height: height\n    };\n}\nfunction $edcf132a9284368a$var$getPosition(node, parent) {\n    let style = window.getComputedStyle(node);\n    let offset;\n    if (style.position === 'fixed') {\n        let { top: top , left: left , width: width , height: height  } = node.getBoundingClientRect();\n        offset = {\n            top: top,\n            left: left,\n            width: width,\n            height: height\n        };\n    } else {\n        offset = $edcf132a9284368a$var$getOffset(node);\n        let parentOffset = $edcf132a9284368a$var$getOffset(parent);\n        let parentStyle = window.getComputedStyle(parent);\n        parentOffset.top += (parseInt(parentStyle.borderTopWidth, 10) || 0) - parent.scrollTop;\n        parentOffset.left += (parseInt(parentStyle.borderLeftWidth, 10) || 0) - parent.scrollLeft;\n        offset.top -= parentOffset.top;\n        offset.left -= parentOffset.left;\n    }\n    offset.top -= parseInt(style.marginTop, 10) || 0;\n    offset.left -= parseInt(style.marginLeft, 10) || 0;\n    return offset;\n}\n\n\n\n\nconst $dd149f63282afbbf$export$f6211563215e3b37 = new WeakMap();\nfunction $dd149f63282afbbf$export$18fc8428861184da(opts) {\n    let { triggerRef: triggerRef , isOpen: isOpen , onClose: onClose  } = opts;\n    $k7QOs$useEffect(()=>{\n        if (!isOpen) return;\n        let onScroll = (e)=>{\n            // Ignore if scrolling an scrollable region outside the trigger's tree.\n            let target = e.target;\n            // window is not a Node and doesn't have contain, but window contains everything\n            if (!triggerRef.current || target instanceof Node && !target.contains(triggerRef.current)) return;\n            let onCloseHandler = onClose || $dd149f63282afbbf$export$f6211563215e3b37.get(triggerRef.current);\n            if (onCloseHandler) onCloseHandler();\n        };\n        window.addEventListener('scroll', onScroll, true);\n        return ()=>{\n            window.removeEventListener('scroll', onScroll, true);\n        };\n    }, [\n        isOpen,\n        onClose,\n        triggerRef\n    ]);\n}\n\n\n\n\n// @ts-ignore\nlet $2a41e45df1593e64$var$visualViewport = typeof window !== 'undefined' && window.visualViewport;\nfunction $2a41e45df1593e64$export$d39e1813b3bdd0e1(props) {\n    let { direction: direction  } = $k7QOs$useLocale();\n    let { targetRef: targetRef , overlayRef: overlayRef , scrollRef: scrollRef = overlayRef , placement: placement = 'bottom' , containerPadding: containerPadding = 12 , shouldFlip: shouldFlip = true , boundaryElement: boundaryElement = typeof document !== 'undefined' ? document.body : null , offset: offset = 0 , crossOffset: crossOffset = 0 , shouldUpdatePosition: shouldUpdatePosition = true , isOpen: isOpen = true , onClose: onClose , maxHeight: maxHeight  } = props;\n    let [position, setPosition] = $k7QOs$useState({\n        position: {\n        },\n        arrowOffsetLeft: undefined,\n        arrowOffsetTop: undefined,\n        maxHeight: undefined,\n        placement: undefined\n    });\n    let deps = [\n        shouldUpdatePosition,\n        placement,\n        overlayRef.current,\n        targetRef.current,\n        scrollRef.current,\n        containerPadding,\n        shouldFlip,\n        boundaryElement,\n        offset,\n        crossOffset,\n        isOpen,\n        direction,\n        maxHeight\n    ];\n    let updatePosition = $k7QOs$useCallback(()=>{\n        if (shouldUpdatePosition === false || !isOpen || !overlayRef.current || !targetRef.current || !scrollRef.current || !boundaryElement) return;\n        setPosition($edcf132a9284368a$export$b3ceb0cbf1056d98({\n            placement: $2a41e45df1593e64$var$translateRTL(placement, direction),\n            overlayNode: overlayRef.current,\n            targetNode: targetRef.current,\n            scrollNode: scrollRef.current,\n            padding: containerPadding,\n            shouldFlip: shouldFlip,\n            boundaryElement: boundaryElement,\n            offset: offset,\n            crossOffset: crossOffset,\n            maxHeight: maxHeight\n        }));\n    }, deps);\n    // Update position when anything changes\n    $k7QOs$useLayoutEffect(updatePosition, deps);\n    // Update position on window resize\n    $2a41e45df1593e64$var$useResize(updatePosition);\n    // Reposition the overlay and do not close on scroll while the visual viewport is resizing.\n    // This will ensure that overlays adjust their positioning when the iOS virtual keyboard appears.\n    let isResizing = $k7QOs$useRef(false);\n    $k7QOs$useLayoutEffect(()=>{\n        let timeout;\n        let onResize = ()=>{\n            isResizing.current = true;\n            clearTimeout(timeout);\n            timeout = setTimeout(()=>{\n                isResizing.current = false;\n            }, 500);\n            updatePosition();\n        };\n        $2a41e45df1593e64$var$visualViewport === null || $2a41e45df1593e64$var$visualViewport === void 0 ? void 0 : $2a41e45df1593e64$var$visualViewport.addEventListener('resize', onResize);\n        return ()=>{\n            $2a41e45df1593e64$var$visualViewport === null || $2a41e45df1593e64$var$visualViewport === void 0 ? void 0 : $2a41e45df1593e64$var$visualViewport.removeEventListener('resize', onResize);\n        };\n    }, [\n        updatePosition\n    ]);\n    let close = $k7QOs$useCallback(()=>{\n        if (!isResizing.current) onClose();\n    }, [\n        onClose,\n        isResizing\n    ]);\n    // When scrolling a parent scrollable region of the trigger (other than the body),\n    // we hide the popover. Otherwise, its position would be incorrect.\n    $dd149f63282afbbf$export$18fc8428861184da({\n        triggerRef: targetRef,\n        isOpen: isOpen,\n        onClose: onClose ? close : undefined\n    });\n    return {\n        overlayProps: {\n            style: {\n                position: 'absolute',\n                zIndex: 100000,\n                ...position.position,\n                maxHeight: position.maxHeight\n            }\n        },\n        placement: position.placement,\n        arrowProps: {\n            style: {\n                left: position.arrowOffsetLeft,\n                top: position.arrowOffsetTop\n            }\n        },\n        updatePosition: updatePosition\n    };\n}\nfunction $2a41e45df1593e64$var$useResize(onResize) {\n    $k7QOs$useLayoutEffect(()=>{\n        window.addEventListener('resize', onResize, false);\n        return ()=>{\n            window.removeEventListener('resize', onResize, false);\n        };\n    }, [\n        onResize\n    ]);\n}\nfunction $2a41e45df1593e64$var$translateRTL(position, direction) {\n    if (direction === 'rtl') return position.replace('start', 'right').replace('end', 'left');\n    return position.replace('start', 'left').replace('end', 'right');\n}\n\n\n\n\nconst $a11501f3d1d39e6c$var$visibleOverlays = [];\nfunction $a11501f3d1d39e6c$export$ea8f71083e90600f(props, ref) {\n    let { onClose: onClose , shouldCloseOnBlur: shouldCloseOnBlur , isOpen: isOpen , isDismissable: isDismissable = false , isKeyboardDismissDisabled: isKeyboardDismissDisabled = false , shouldCloseOnInteractOutside: shouldCloseOnInteractOutside  } = props;\n    // Add the overlay ref to the stack of visible overlays on mount, and remove on unmount.\n    $k7QOs$useEffect(()=>{\n        if (isOpen) $a11501f3d1d39e6c$var$visibleOverlays.push(ref);\n        return ()=>{\n            let index = $a11501f3d1d39e6c$var$visibleOverlays.indexOf(ref);\n            if (index >= 0) $a11501f3d1d39e6c$var$visibleOverlays.splice(index, 1);\n        };\n    }, [\n        isOpen,\n        ref\n    ]);\n    // Only hide the overlay when it is the topmost visible overlay in the stack.\n    let onHide = ()=>{\n        if ($a11501f3d1d39e6c$var$visibleOverlays[$a11501f3d1d39e6c$var$visibleOverlays.length - 1] === ref && onClose) onClose();\n    };\n    let onInteractOutsideStart = (e)=>{\n        if (!shouldCloseOnInteractOutside || shouldCloseOnInteractOutside(e.target)) {\n            if ($a11501f3d1d39e6c$var$visibleOverlays[$a11501f3d1d39e6c$var$visibleOverlays.length - 1] === ref) {\n                e.stopPropagation();\n                e.preventDefault();\n            }\n        }\n    };\n    let onInteractOutside = (e)=>{\n        if (!shouldCloseOnInteractOutside || shouldCloseOnInteractOutside(e.target)) {\n            if ($a11501f3d1d39e6c$var$visibleOverlays[$a11501f3d1d39e6c$var$visibleOverlays.length - 1] === ref) {\n                e.stopPropagation();\n                e.preventDefault();\n            }\n            onHide();\n        }\n    };\n    // Handle the escape key\n    let onKeyDown = (e)=>{\n        if (e.key === 'Escape' && !isKeyboardDismissDisabled) {\n            e.stopPropagation();\n            e.preventDefault();\n            onHide();\n        }\n    };\n    // Handle clicking outside the overlay to close it\n    $k7QOs$useInteractOutside({\n        ref: ref,\n        onInteractOutside: isDismissable ? onInteractOutside : null,\n        onInteractOutsideStart: onInteractOutsideStart\n    });\n    let { focusWithinProps: focusWithinProps  } = $k7QOs$useFocusWithin({\n        isDisabled: !shouldCloseOnBlur,\n        onBlurWithin: (e)=>{\n            if (!shouldCloseOnInteractOutside || shouldCloseOnInteractOutside(e.relatedTarget)) onClose();\n        }\n    });\n    let onPointerDownUnderlay = (e)=>{\n        // fixes a firefox issue that starts text selection https://bugzilla.mozilla.org/show_bug.cgi?id=1675846\n        if (e.target === e.currentTarget) e.preventDefault();\n    };\n    return {\n        overlayProps: {\n            onKeyDown: onKeyDown,\n            ...focusWithinProps\n        },\n        underlayProps: {\n            onPointerDown: onPointerDownUnderlay\n        }\n    };\n}\n\n\n\n\n\nfunction $628037886ba31236$export$f9d5c8beee7d008d(props, state, ref) {\n    let { type: type  } = props;\n    let { isOpen: isOpen  } = state;\n    // Backward compatibility. Share state close function with useOverlayPosition so it can close on scroll\n    // without forcing users to pass onClose.\n    $k7QOs$useEffect(()=>{\n        if (ref && ref.current) $dd149f63282afbbf$export$f6211563215e3b37.set(ref.current, state.close);\n    });\n    // Aria 1.1 supports multiple values for aria-haspopup other than just menus.\n    // https://www.w3.org/TR/wai-aria-1.1/#aria-haspopup\n    // However, we only add it for menus for now because screen readers often\n    // announce it as a menu even for other values.\n    let ariaHasPopup = undefined;\n    if (type === 'menu') ariaHasPopup = true;\n    else if (type === 'listbox') ariaHasPopup = 'listbox';\n    let overlayId = $k7QOs$useId();\n    return {\n        triggerProps: {\n            'aria-haspopup': ariaHasPopup,\n            'aria-expanded': isOpen,\n            'aria-controls': isOpen ? overlayId : null,\n            onPress: state.toggle\n        },\n        overlayProps: {\n            id: overlayId\n        }\n    };\n}\n\n\n\n// @ts-ignore\nconst $49c51c25361d4cd2$var$visualViewport = typeof window !== 'undefined' && window.visualViewport;\n// HTML input types that do not cause the software keyboard to appear.\nconst $49c51c25361d4cd2$var$nonTextInputTypes = new Set([\n    'checkbox',\n    'radio',\n    'range',\n    'color',\n    'file',\n    'image',\n    'button',\n    'submit',\n    'reset'\n]);\nfunction $49c51c25361d4cd2$export$ee0f7cc6afcd1c18(options = {\n}) {\n    let { isDisabled: isDisabled  } = options;\n    $k7QOs$useLayoutEffect(()=>{\n        if (isDisabled) return;\n        if ($k7QOs$isIOS()) return $49c51c25361d4cd2$var$preventScrollMobileSafari();\n        else return $49c51c25361d4cd2$var$preventScrollStandard();\n    }, [\n        isDisabled\n    ]);\n}\n// For most browsers, all we need to do is set `overflow: hidden` on the root element, and\n// add some padding to prevent the page from shifting when the scrollbar is hidden.\nfunction $49c51c25361d4cd2$var$preventScrollStandard() {\n    return $k7QOs$chain($49c51c25361d4cd2$var$setStyle(document.documentElement, 'paddingRight', `${window.innerWidth - document.documentElement.clientWidth}px`), $49c51c25361d4cd2$var$setStyle(document.documentElement, 'overflow', 'hidden'));\n}\n// Mobile Safari is a whole different beast. Even with overflow: hidden,\n// it still scrolls the page in many situations:\n//\n// 1. When the bottom toolbar and address bar are collapsed, page scrolling is always allowed.\n// 2. When the keyboard is visible, the viewport does not resize. Instead, the keyboard covers part of\n//    it, so it becomes scrollable.\n// 3. When tapping on an input, the page always scrolls so that the input is centered in the visual viewport.\n//    This may cause even fixed position elements to scroll off the screen.\n// 4. When using the next/previous buttons in the keyboard to navigate between inputs, the whole page always\n//    scrolls, even if the input is inside a nested scrollable element that could be scrolled instead.\n//\n// In order to work around these cases, and prevent scrolling without jankiness, we do a few things:\n//\n// 1. Prevent default on `touchmove` events that are not in a scrollable element. This prevents touch scrolling\n//    on the window.\n// 2. Prevent default on `touchmove` events inside a scrollable element when the scroll position is at the\n//    top or bottom. This avoids the whole page scrolling instead, but does prevent overscrolling.\n// 3. Prevent default on `touchend` events on input elements and handle focusing the element ourselves.\n// 4. When focusing an input, apply a transform to trick Safari into thinking the input is at the top\n//    of the page, which prevents it from scrolling the page. After the input is focused, scroll the element\n//    into view ourselves, without scrolling the whole page.\n// 5. Offset the body by the scroll position using a negative margin and scroll to the top. This should appear the\n//    same visually, but makes the actual scroll position always zero. This is required to make all of the\n//    above work or Safari will still try to scroll the page when focusing an input.\n// 6. As a last resort, handle window scroll events, and scroll back to the top. This can happen when attempting\n//    to navigate to an input with the next/previous buttons that's outside a modal.\nfunction $49c51c25361d4cd2$var$preventScrollMobileSafari() {\n    let scrollable;\n    let lastY = 0;\n    let onTouchStart = (e)=>{\n        // Store the nearest scrollable parent element from the element that the user touched.\n        scrollable = $k7QOs$getScrollParent(e.target);\n        if (scrollable === document.documentElement && scrollable === document.body) return;\n        lastY = e.changedTouches[0].pageY;\n    };\n    let onTouchMove = (e)=>{\n        // Prevent scrolling the window.\n        if (scrollable === document.documentElement || scrollable === document.body) {\n            e.preventDefault();\n            return;\n        }\n        // Prevent scrolling up when at the top and scrolling down when at the bottom\n        // of a nested scrollable area, otherwise mobile Safari will start scrolling\n        // the window instead. Unfortunately, this disables bounce scrolling when at\n        // the top but it's the best we can do.\n        let y = e.changedTouches[0].pageY;\n        let scrollTop = scrollable.scrollTop;\n        let bottom = scrollable.scrollHeight - scrollable.clientHeight;\n        if (scrollTop <= 0 && y > lastY || scrollTop >= bottom && y < lastY) e.preventDefault();\n        lastY = y;\n    };\n    let onTouchEnd = (e)=>{\n        let target = e.target;\n        // Apply this change if we're not already focused on the target element\n        if ($49c51c25361d4cd2$var$willOpenKeyboard(target) && target !== document.activeElement) {\n            e.preventDefault();\n            // Apply a transform to trick Safari into thinking the input is at the top of the page\n            // so it doesn't try to scroll it into view. When tapping on an input, this needs to\n            // be done before the \"focus\" event, so we have to focus the element ourselves.\n            target.style.transform = 'translateY(-2000px)';\n            target.focus();\n            requestAnimationFrame(()=>{\n                target.style.transform = '';\n            });\n        }\n    };\n    let onFocus = (e)=>{\n        let target = e.target;\n        if ($49c51c25361d4cd2$var$willOpenKeyboard(target)) {\n            // Transform also needs to be applied in the focus event in cases where focus moves\n            // other than tapping on an input directly, e.g. the next/previous buttons in the\n            // software keyboard. In these cases, it seems applying the transform in the focus event\n            // is good enough, whereas when tapping an input, it must be done before the focus event. 🤷‍♂️\n            target.style.transform = 'translateY(-2000px)';\n            requestAnimationFrame(()=>{\n                target.style.transform = '';\n                // This will have prevented the browser from scrolling the focused element into view,\n                // so we need to do this ourselves in a way that doesn't cause the whole page to scroll.\n                if ($49c51c25361d4cd2$var$visualViewport) {\n                    if ($49c51c25361d4cd2$var$visualViewport.height < window.innerHeight) // If the keyboard is already visible, do this after one additional frame\n                    // to wait for the transform to be removed.\n                    requestAnimationFrame(()=>{\n                        $49c51c25361d4cd2$var$scrollIntoView(target);\n                    });\n                    else // Otherwise, wait for the visual viewport to resize before scrolling so we can\n                    // measure the correct position to scroll to.\n                    $49c51c25361d4cd2$var$visualViewport.addEventListener('resize', ()=>$49c51c25361d4cd2$var$scrollIntoView(target)\n                    , {\n                        once: true\n                    });\n                }\n            });\n        }\n    };\n    let onWindowScroll = ()=>{\n        // Last resort. If the window scrolled, scroll it back to the top.\n        // It should always be at the top because the body will have a negative margin (see below).\n        window.scrollTo(0, 0);\n    };\n    // Record the original scroll position so we can restore it.\n    // Then apply a negative margin to the body to offset it by the scroll position. This will\n    // enable us to scroll the window to the top, which is required for the rest of this to work.\n    let scrollX = window.pageXOffset;\n    let scrollY = window.pageYOffset;\n    let restoreStyles = $k7QOs$chain($49c51c25361d4cd2$var$setStyle(document.documentElement, 'paddingRight', `${window.innerWidth - document.documentElement.clientWidth}px`), $49c51c25361d4cd2$var$setStyle(document.documentElement, 'overflow', 'hidden'), $49c51c25361d4cd2$var$setStyle(document.body, 'marginTop', `-${scrollY}px`));\n    // Scroll to the top. The negative margin on the body will make this appear the same.\n    window.scrollTo(0, 0);\n    let removeEvents = $k7QOs$chain($49c51c25361d4cd2$var$addEvent(document, 'touchstart', onTouchStart, {\n        passive: false,\n        capture: true\n    }), $49c51c25361d4cd2$var$addEvent(document, 'touchmove', onTouchMove, {\n        passive: false,\n        capture: true\n    }), $49c51c25361d4cd2$var$addEvent(document, 'touchend', onTouchEnd, {\n        passive: false,\n        capture: true\n    }), $49c51c25361d4cd2$var$addEvent(document, 'focus', onFocus, true), $49c51c25361d4cd2$var$addEvent(window, 'scroll', onWindowScroll));\n    return ()=>{\n        // Restore styles and scroll the page back to where it was.\n        restoreStyles();\n        removeEvents();\n        window.scrollTo(scrollX, scrollY);\n    };\n}\n// Sets a CSS property on an element, and returns a function to revert it to the previous value.\nfunction $49c51c25361d4cd2$var$setStyle(element, style, value) {\n    let cur = element.style[style];\n    element.style[style] = value;\n    return ()=>{\n        element.style[style] = cur;\n    };\n}\n// Adds an event listener to an element, and returns a function to remove it.\nfunction $49c51c25361d4cd2$var$addEvent(target, event, handler, options) {\n    target.addEventListener(event, handler, options);\n    return ()=>{\n        target.removeEventListener(event, handler, options);\n    };\n}\nfunction $49c51c25361d4cd2$var$scrollIntoView(target) {\n    let root = document.scrollingElement || document.documentElement;\n    while(target && target !== root){\n        // Find the parent scrollable element and adjust the scroll position if the target is not already in view.\n        let scrollable = $k7QOs$getScrollParent(target);\n        if (scrollable !== document.documentElement && scrollable !== document.body && scrollable !== target) {\n            let scrollableTop = scrollable.getBoundingClientRect().top;\n            let targetTop = target.getBoundingClientRect().top;\n            if (targetTop > scrollableTop + target.clientHeight) scrollable.scrollTop += targetTop - scrollableTop;\n        }\n        target = scrollable.parentElement;\n    }\n}\nfunction $49c51c25361d4cd2$var$willOpenKeyboard(target) {\n    return target instanceof HTMLInputElement && !$49c51c25361d4cd2$var$nonTextInputTypes.has(target.type) || target instanceof HTMLTextAreaElement || target instanceof HTMLElement && target.isContentEditable;\n}\n\n\n\n\n\nconst $f57aed4a881a3485$var$Context = /*#__PURE__*/ $k7QOs$react.createContext(null);\nfunction $f57aed4a881a3485$export$178405afcd8c5eb(props) {\n    let { children: children  } = props;\n    let parent = $k7QOs$useContext($f57aed4a881a3485$var$Context);\n    let [modalCount, setModalCount] = $k7QOs$useState(0);\n    let context = $k7QOs$useMemo(()=>({\n            parent: parent,\n            modalCount: modalCount,\n            addModal () {\n                setModalCount((count)=>count + 1\n                );\n                if (parent) parent.addModal();\n            },\n            removeModal () {\n                setModalCount((count)=>count - 1\n                );\n                if (parent) parent.removeModal();\n            }\n        })\n    , [\n        parent,\n        modalCount\n    ]);\n    return(/*#__PURE__*/ $k7QOs$react.createElement($f57aed4a881a3485$var$Context.Provider, {\n        value: context\n    }, children));\n}\nfunction $f57aed4a881a3485$export$d9aaed4c3ece1bc0() {\n    let context = $k7QOs$useContext($f57aed4a881a3485$var$Context);\n    return {\n        modalProviderProps: {\n            'aria-hidden': context && context.modalCount > 0 ? true : null\n        }\n    };\n}\n/**\n * Creates a root node that will be aria-hidden if there are other modals open.\n */ function $f57aed4a881a3485$var$OverlayContainerDOM(props) {\n    let { modalProviderProps: modalProviderProps  } = $f57aed4a881a3485$export$d9aaed4c3ece1bc0();\n    return(/*#__PURE__*/ $k7QOs$react.createElement(\"div\", {\n        \"data-overlay-container\": true,\n        ...props,\n        ...modalProviderProps\n    }));\n}\nfunction $f57aed4a881a3485$export$bf688221f59024e5(props) {\n    return(/*#__PURE__*/ $k7QOs$react.createElement($f57aed4a881a3485$export$178405afcd8c5eb, null, /*#__PURE__*/ $k7QOs$react.createElement($f57aed4a881a3485$var$OverlayContainerDOM, props)));\n}\nfunction $f57aed4a881a3485$export$b47c3594eab58386(props) {\n    let isSSR = $k7QOs$useIsSSR();\n    let { portalContainer: portalContainer = isSSR ? null : document.body , ...rest } = props;\n    $k7QOs$react.useEffect(()=>{\n        if (portalContainer === null || portalContainer === void 0 ? void 0 : portalContainer.closest('[data-overlay-container]')) throw new Error('An OverlayContainer must not be inside another container. Please change the portalContainer prop.');\n    }, [\n        portalContainer\n    ]);\n    if (!portalContainer) return null;\n    let contents = /*#__PURE__*/ $k7QOs$react.createElement($f57aed4a881a3485$export$bf688221f59024e5, rest);\n    return(/*#__PURE__*/ $k7QOs$reactdom.createPortal(contents, portalContainer));\n}\nfunction $f57aed4a881a3485$export$33ffd74ebf07f060(options) {\n    // Add aria-hidden to all parent providers on mount, and restore on unmount.\n    let context = $k7QOs$useContext($f57aed4a881a3485$var$Context);\n    if (!context) throw new Error('Modal is not contained within a provider');\n    $k7QOs$useEffect(()=>{\n        if ((options === null || options === void 0 ? void 0 : options.isDisabled) || !context || !context.parent) return;\n        // The immediate context is from the provider containing this modal, so we only\n        // want to trigger aria-hidden on its parents not on the modal provider itself.\n        context.parent.addModal();\n        return ()=>{\n            if (context && context.parent) context.parent.removeModal();\n        };\n    }, [\n        context,\n        context.parent,\n        options === null || options === void 0 ? void 0 : options.isDisabled\n    ]);\n    return {\n        modalProps: {\n            'data-ismodal': !(options === null || options === void 0 ? void 0 : options.isDisabled)\n        }\n    };\n}\n\n\nvar $61fe14465afefc5e$exports = {};\nvar $773d5888b972f1cf$exports = {};\n$773d5888b972f1cf$exports = {\n    \"dismiss\": `تجاهل`\n};\n\n\nvar $d11f19852b941573$exports = {};\n$d11f19852b941573$exports = {\n    \"dismiss\": `Отхвърляне`\n};\n\n\nvar $b983974c2ee1efb3$exports = {};\n$b983974c2ee1efb3$exports = {\n    \"dismiss\": `Odstranit`\n};\n\n\nvar $5809cc9d4e92de73$exports = {};\n$5809cc9d4e92de73$exports = {\n    \"dismiss\": `Luk`\n};\n\n\nvar $c68c2e4fc74398d1$exports = {};\n$c68c2e4fc74398d1$exports = {\n    \"dismiss\": `Schließen`\n};\n\n\nvar $0898b4c153db2b77$exports = {};\n$0898b4c153db2b77$exports = {\n    \"dismiss\": `Απόρριψη`\n};\n\n\nvar $6d74810286a15183$exports = {};\n$6d74810286a15183$exports = {\n    \"dismiss\": `Dismiss`\n};\n\n\nvar $309d73dc65f78055$exports = {};\n$309d73dc65f78055$exports = {\n    \"dismiss\": `Descartar`\n};\n\n\nvar $44ad94f7205cf593$exports = {};\n$44ad94f7205cf593$exports = {\n    \"dismiss\": `Lõpeta`\n};\n\n\nvar $7c28f5687f0779a9$exports = {};\n$7c28f5687f0779a9$exports = {\n    \"dismiss\": `Hylkää`\n};\n\n\nvar $e6d75df4b68bd73a$exports = {};\n$e6d75df4b68bd73a$exports = {\n    \"dismiss\": `Rejeter`\n};\n\n\nvar $87505c9dab186d0f$exports = {};\n$87505c9dab186d0f$exports = {\n    \"dismiss\": `התעלם`\n};\n\n\nvar $553439c3ffb3e492$exports = {};\n$553439c3ffb3e492$exports = {\n    \"dismiss\": `Odbaci`\n};\n\n\nvar $74cf411061b983a2$exports = {};\n$74cf411061b983a2$exports = {\n    \"dismiss\": `Elutasítás`\n};\n\n\nvar $e933f298574dc435$exports = {};\n$e933f298574dc435$exports = {\n    \"dismiss\": `Ignora`\n};\n\n\nvar $ac91fc9fe02f71f6$exports = {};\n$ac91fc9fe02f71f6$exports = {\n    \"dismiss\": `閉じる`\n};\n\n\nvar $52b96f86422025af$exports = {};\n$52b96f86422025af$exports = {\n    \"dismiss\": `무시`\n};\n\n\nvar $c0d724c3e51dafa6$exports = {};\n$c0d724c3e51dafa6$exports = {\n    \"dismiss\": `Atmesti`\n};\n\n\nvar $c92899672a3fe72e$exports = {};\n$c92899672a3fe72e$exports = {\n    \"dismiss\": `Nerādīt`\n};\n\n\nvar $9f576b39d8e7a9d6$exports = {};\n$9f576b39d8e7a9d6$exports = {\n    \"dismiss\": `Lukk`\n};\n\n\nvar $9d025808aeec81a7$exports = {};\n$9d025808aeec81a7$exports = {\n    \"dismiss\": `Negeren`\n};\n\n\nvar $fce709921e2c0fa6$exports = {};\n$fce709921e2c0fa6$exports = {\n    \"dismiss\": `Zignoruj`\n};\n\n\nvar $2599cf0c4ab37f59$exports = {};\n$2599cf0c4ab37f59$exports = {\n    \"dismiss\": `Descartar`\n};\n\n\nvar $3c220ae7ef8a35fd$exports = {};\n$3c220ae7ef8a35fd$exports = {\n    \"dismiss\": `Dispensar`\n};\n\n\nvar $93562b5094072f54$exports = {};\n$93562b5094072f54$exports = {\n    \"dismiss\": `Revocare`\n};\n\n\nvar $cd9e2abd0d06c7b4$exports = {};\n$cd9e2abd0d06c7b4$exports = {\n    \"dismiss\": `Пропустить`\n};\n\n\nvar $45375701f409adf1$exports = {};\n$45375701f409adf1$exports = {\n    \"dismiss\": `Zrušiť`\n};\n\n\nvar $27fab53a576de9dd$exports = {};\n$27fab53a576de9dd$exports = {\n    \"dismiss\": `Opusti`\n};\n\n\nvar $4438748d9952e7c7$exports = {};\n$4438748d9952e7c7$exports = {\n    \"dismiss\": `Odbaci`\n};\n\n\nvar $0936d7347ef4da4c$exports = {};\n$0936d7347ef4da4c$exports = {\n    \"dismiss\": `Avvisa`\n};\n\n\nvar $29700c92185d38f8$exports = {};\n$29700c92185d38f8$exports = {\n    \"dismiss\": `Kapat`\n};\n\n\nvar $662ccaf2be4c25b3$exports = {};\n$662ccaf2be4c25b3$exports = {\n    \"dismiss\": `Скасувати`\n};\n\n\nvar $d80a27deda7cdb3c$exports = {};\n$d80a27deda7cdb3c$exports = {\n    \"dismiss\": `取消`\n};\n\n\nvar $2b2734393847c884$exports = {};\n$2b2734393847c884$exports = {\n    \"dismiss\": `關閉`\n};\n\n\n$61fe14465afefc5e$exports = {\n    \"ar-AE\": $773d5888b972f1cf$exports,\n    \"bg-BG\": $d11f19852b941573$exports,\n    \"cs-CZ\": $b983974c2ee1efb3$exports,\n    \"da-DK\": $5809cc9d4e92de73$exports,\n    \"de-DE\": $c68c2e4fc74398d1$exports,\n    \"el-GR\": $0898b4c153db2b77$exports,\n    \"en-US\": $6d74810286a15183$exports,\n    \"es-ES\": $309d73dc65f78055$exports,\n    \"et-EE\": $44ad94f7205cf593$exports,\n    \"fi-FI\": $7c28f5687f0779a9$exports,\n    \"fr-FR\": $e6d75df4b68bd73a$exports,\n    \"he-IL\": $87505c9dab186d0f$exports,\n    \"hr-HR\": $553439c3ffb3e492$exports,\n    \"hu-HU\": $74cf411061b983a2$exports,\n    \"it-IT\": $e933f298574dc435$exports,\n    \"ja-JP\": $ac91fc9fe02f71f6$exports,\n    \"ko-KR\": $52b96f86422025af$exports,\n    \"lt-LT\": $c0d724c3e51dafa6$exports,\n    \"lv-LV\": $c92899672a3fe72e$exports,\n    \"nb-NO\": $9f576b39d8e7a9d6$exports,\n    \"nl-NL\": $9d025808aeec81a7$exports,\n    \"pl-PL\": $fce709921e2c0fa6$exports,\n    \"pt-BR\": $2599cf0c4ab37f59$exports,\n    \"pt-PT\": $3c220ae7ef8a35fd$exports,\n    \"ro-RO\": $93562b5094072f54$exports,\n    \"ru-RU\": $cd9e2abd0d06c7b4$exports,\n    \"sk-SK\": $45375701f409adf1$exports,\n    \"sl-SI\": $27fab53a576de9dd$exports,\n    \"sr-SP\": $4438748d9952e7c7$exports,\n    \"sv-SE\": $0936d7347ef4da4c$exports,\n    \"tr-TR\": $29700c92185d38f8$exports,\n    \"uk-UA\": $662ccaf2be4c25b3$exports,\n    \"zh-CN\": $d80a27deda7cdb3c$exports,\n    \"zh-TW\": $2b2734393847c884$exports\n};\n\n\n\n\n\n\nfunction $86ea4cb521eb2e37$export$2317d149ed6f78c4(props) {\n    let { onDismiss: onDismiss , ...otherProps } = props;\n    let stringFormatter = $k7QOs$useLocalizedStringFormatter((/*@__PURE__*/$parcel$interopDefault($61fe14465afefc5e$exports)));\n    let labels = $k7QOs$useLabels(otherProps, stringFormatter.format('dismiss'));\n    let onClick = ()=>{\n        if (onDismiss) onDismiss();\n    };\n    return(/*#__PURE__*/ $k7QOs$react.createElement($k7QOs$VisuallyHidden, null, /*#__PURE__*/ $k7QOs$react.createElement(\"button\", {\n        ...labels,\n        tabIndex: -1,\n        onClick: onClick\n    })));\n}\n\n\n/*\n * Copyright 2020 Adobe. All rights reserved.\n * This file is licensed to you under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License. You may obtain a copy\n * of the License at http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software distributed under\n * the License is distributed on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR REPRESENTATIONS\n * OF ANY KIND, either express or implied. See the License for the specific language\n * governing permissions and limitations under the License.\n */ // Keeps a ref count of all hidden elements. Added to when hiding an element, and\n// subtracted from when showing it again. When it reaches zero, aria-hidden is removed.\nlet $5e3802645cc19319$var$refCountMap = new WeakMap();\nfunction $5e3802645cc19319$export$1c3ebcada18427bf(targets, root = document.body) {\n    let visibleNodes = new Set(targets);\n    let hiddenNodes = new Set();\n    let walker = document.createTreeWalker(root, NodeFilter.SHOW_ELEMENT, {\n        acceptNode (node) {\n            // If this node is a live announcer, add it to the set of nodes to keep visible.\n            if ((node instanceof HTMLElement || node instanceof SVGElement) && node.dataset.liveAnnouncer === 'true') visibleNodes.add(node);\n            // Skip this node and its children if it is one of the target nodes, or a live announcer.\n            // Also skip children of already hidden nodes, as aria-hidden is recursive.\n            if (visibleNodes.has(node) || hiddenNodes.has(node.parentElement)) return NodeFilter.FILTER_REJECT;\n            // VoiceOver on iOS has issues hiding elements with role=\"row\". Hide the cells inside instead.\n            // https://bugs.webkit.org/show_bug.cgi?id=222623\n            if (node instanceof Element && node.getAttribute('role') === 'row') return NodeFilter.FILTER_SKIP;\n            // Skip this node but continue to children if one of the targets is inside the node.\n            if (targets.some((target)=>node.contains(target)\n            )) return NodeFilter.FILTER_SKIP;\n            return NodeFilter.FILTER_ACCEPT;\n        }\n    });\n    let hide = (node)=>{\n        var ref;\n        let refCount = (ref = $5e3802645cc19319$var$refCountMap.get(node)) !== null && ref !== void 0 ? ref : 0;\n        // If already aria-hidden, and the ref count is zero, then this element\n        // was already hidden and there's nothing for us to do.\n        if (node.getAttribute('aria-hidden') === 'true' && refCount === 0) return;\n        if (refCount === 0) node.setAttribute('aria-hidden', 'true');\n        hiddenNodes.add(node);\n        $5e3802645cc19319$var$refCountMap.set(node, refCount + 1);\n    };\n    let node1 = walker.nextNode();\n    while(node1 != null){\n        hide(node1);\n        node1 = walker.nextNode();\n    }\n    let observer = new MutationObserver((changes)=>{\n        for (let change of changes){\n            if (change.type !== 'childList' || change.addedNodes.length === 0) continue;\n            // If the parent element of the added nodes is not within one of the targets,\n            // and not already inside a hidden node, hide all of the new children.\n            if (![\n                ...visibleNodes,\n                ...hiddenNodes\n            ].some((node)=>node.contains(change.target)\n            )) for (let node2 of change.addedNodes){\n                if ((node2 instanceof HTMLElement || node2 instanceof SVGElement) && node2.dataset.liveAnnouncer === 'true') visibleNodes.add(node2);\n                else if (node2 instanceof Element) hide(node2);\n            }\n        }\n    });\n    observer.observe(root, {\n        childList: true,\n        subtree: true\n    });\n    return ()=>{\n        observer.disconnect();\n        for (let node of hiddenNodes){\n            let count = $5e3802645cc19319$var$refCountMap.get(node);\n            if (count === 1) {\n                node.removeAttribute('aria-hidden');\n                $5e3802645cc19319$var$refCountMap.delete(node);\n            } else $5e3802645cc19319$var$refCountMap.set(node, count - 1);\n        }\n    };\n}\n\n\n\n\nexport {$2a41e45df1593e64$export$d39e1813b3bdd0e1 as useOverlayPosition, $a11501f3d1d39e6c$export$ea8f71083e90600f as useOverlay, $628037886ba31236$export$f9d5c8beee7d008d as useOverlayTrigger, $49c51c25361d4cd2$export$ee0f7cc6afcd1c18 as usePreventScroll, $f57aed4a881a3485$export$178405afcd8c5eb as ModalProvider, $f57aed4a881a3485$export$d9aaed4c3ece1bc0 as useModalProvider, $f57aed4a881a3485$export$bf688221f59024e5 as OverlayProvider, $f57aed4a881a3485$export$b47c3594eab58386 as OverlayContainer, $f57aed4a881a3485$export$33ffd74ebf07f060 as useModal, $86ea4cb521eb2e37$export$2317d149ed6f78c4 as DismissButton, $5e3802645cc19319$export$1c3ebcada18427bf as ariaHideOutside};\n//# sourceMappingURL=module.js.map\n","import React, {forwardRef, useEffect} from 'react';\nimport {m} from 'framer-motion';\nimport {mergeProps, useObjectRef} from '@react-aria/utils';\nimport {PopoverAnimation} from './popover-animation';\nimport {OverlayProps} from './overlay-props';\nimport {useOverlayViewport} from './use-overlay-viewport';\nimport {FocusScope} from '@react-aria/focus';\nimport {useOverlay} from '@react-aria/overlays';\n\nexport const Popover = forwardRef<HTMLDivElement, OverlayProps>(\n  (\n    {\n      children,\n      style,\n      autoFocus = false,\n      restoreFocus = true,\n      isDismissable,\n      isOpen,\n      onClose,\n      triggerRef,\n      arrowRef,\n      arrowStyle,\n    },\n    ref\n  ) => {\n    const viewPortStyle = useOverlayViewport();\n    const objRef = useObjectRef(ref);\n\n    const {overlayProps} = useOverlay(\n      {\n        isDismissable,\n        isOpen,\n        onClose,\n        shouldCloseOnInteractOutside: el => {\n          // prevent closing on trigger click popover\n          if (triggerRef.current) {\n            return !triggerRef.current.contains?.(el);\n          }\n          return true;\n        },\n      },\n      objRef\n    );\n\n    // close popover on scroll\n    useEffect(() => {\n      if (!isOpen) {\n        return;\n      }\n\n      const onScroll = (e: Event) => {\n        // Ignore if scrolling a scrollable region outside the trigger's tree.\n        const target = e.target;\n\n        if (!triggerRef.current) {\n          return;\n        }\n\n        // always close context menu on scroll as there's no trigger node\n        if (!(triggerRef.current instanceof Node)) {\n          onClose();\n          return;\n        }\n\n        // window is not a Node and doesn't have contain, but window contains everything\n        if (!(target instanceof Node) || target.contains(triggerRef.current)) {\n          onClose();\n        }\n      };\n\n      // wait for floating-ui positioning to complete, otherwise scroll event\n      // might be fired on popover open and popover will close automatically\n      requestAnimationFrame(() => {\n        window.addEventListener('scroll', onScroll, true);\n      });\n      return () => {\n        window.removeEventListener('scroll', onScroll, true);\n      };\n    }, [isOpen, onClose, triggerRef]);\n\n    return (\n      <m.div\n        className=\"z-popover isolate\"\n        role=\"presentation\"\n        ref={objRef}\n        style={mergeProps(viewPortStyle, style!)}\n        {...PopoverAnimation}\n        {...(overlayProps as any)}\n      >\n        <FocusScope\n          restoreFocus={restoreFocus}\n          autoFocus={autoFocus}\n          contain={false}\n        >\n          {children}\n        </FocusScope>\n      </m.div>\n    );\n  }\n);\n","import {HTMLMotionProps} from 'framer-motion';\n\nexport const opacityAnimation: HTMLMotionProps<'div'> = {\n  initial: {opacity: 0},\n  animate: {opacity: 1},\n  exit: {opacity: 0},\n};\n","import {m} from 'framer-motion';\nimport clsx from 'clsx';\nimport {ComponentPropsWithoutRef} from 'react';\nimport {opacityAnimation} from '../animation/opacity-animation';\n\ninterface UnderlayProps\n  extends Omit<\n    ComponentPropsWithoutRef<'div'>,\n    'onAnimationStart' | 'onDragStart' | 'onDragEnd' | 'onDrag'\n  > {\n  position?: 'fixed' | 'absolute';\n  className?: string;\n  isTransparent?: boolean;\n  disableInitialTransition?: boolean;\n}\nexport function Underlay({\n  position = 'absolute',\n  className,\n  isTransparent = false,\n  disableInitialTransition,\n  ...domProps\n}: UnderlayProps) {\n  return (\n    <m.div\n      {...domProps}\n      className={clsx(\n        className,\n        !isTransparent && 'bg-black/30',\n        'w-full h-full inset-0 z-10',\n        position\n      )}\n      aria-hidden\n      initial={disableInitialTransition ? undefined : {opacity: 0}}\n      animate={{opacity: 1}}\n      exit={{opacity: 0}}\n      {...opacityAnimation}\n      transition={{duration: 0.3}}\n    />\n  );\n}\n","import {m} from 'framer-motion';\nimport {forwardRef} from 'react';\nimport {OverlayProps} from './overlay-props';\nimport {useOverlayViewport} from './use-overlay-viewport';\nimport {Underlay} from './underlay';\nimport {FocusScope} from '@react-aria/focus';\nimport {useObjectRef} from '@react-aria/utils';\n\nexport const Tray = forwardRef<HTMLDivElement, OverlayProps>(\n  (\n    {\n      children,\n      autoFocus = false,\n      restoreFocus = true,\n      isDismissable,\n      isOpen,\n      onClose,\n    },\n    ref\n  ) => {\n    const viewPortStyle = useOverlayViewport();\n    const objRef = useObjectRef(ref);\n\n    return (\n      <div className=\"isolate z-tray fixed inset-0\" style={viewPortStyle}>\n        <Underlay\n          key=\"tray-underlay\"\n          onClick={() => {\n            if (isDismissable) {\n              onClose();\n            }\n          }}\n        />\n        <m.div\n          ref={objRef}\n          className=\"absolute bottom-0 left-0 right-0 w-full z-20 rounded-t overflow-hidden max-w-375 max-h-tray mx-auto pb-safe-area\"\n          role=\"presentation\"\n          initial={{opacity: 0, y: '100%'}}\n          animate={{opacity: 1, y: 0}}\n          exit={{opacity: 0, y: '100%'}}\n          transition={{type: 'tween', duration: 0.2}}\n        >\n          <FocusScope restoreFocus={restoreFocus} autoFocus={autoFocus} contain>\n            {children}\n          </FocusScope>\n        </m.div>\n      </div>\n    );\n  }\n);\n","export function shallowEqual<\n  T extends Record<string, unknown> = Record<string, unknown>\n>(objA?: T, objB?: T) {\n  if (objA === objB) {\n    return true;\n  }\n\n  if (!objA || !objB) {\n    return false;\n  }\n\n  const aKeys = Object.keys(objA);\n  const bKeys = Object.keys(objB);\n  const len = aKeys.length;\n\n  if (bKeys.length !== len) {\n    return false;\n  }\n\n  for (let i = 0; i < len; i++) {\n    const key = aKeys[i];\n\n    if (\n      objA[key] !== objB[key] ||\n      !Object.prototype.hasOwnProperty.call(objB, key)\n    ) {\n      return false;\n    }\n  }\n\n  return true;\n}\n","import {BootstrapData} from './bootstrap-data';\nimport {createContext, useContext} from 'react';\n\nexport interface BoostrapDataContextValue<T = BootstrapData> {\n  data: T;\n  setBootstrapData: (data: string | T) => void;\n  mergeBootstrapData: (data: Partial<T>) => void;\n  invalidateBootstrapData: () => void;\n}\n\nexport const BoostrapDataContext = createContext<BoostrapDataContextValue>(\n  null!\n);\n\nexport function useBootstrapData() {\n  return useContext(BoostrapDataContext);\n}\n","import {useBootstrapData} from '../core/bootstrap-data/bootstrap-data-context';\n\nexport function useSelectedLocale() {\n  const {\n    data: {i18n},\n  } = useBootstrapData();\n  return {\n    locale: i18n,\n    localeCode: i18n?.language || 'en',\n    lines: i18n?.lines,\n  };\n}\n","import memoize from 'nano-memoize';\nimport {MessageDescriptor} from './message-descriptor';\n\n// this will get memoized by enclosing function (<Trans> or useTrans)\nexport function handlePluralMessage(\n  localeCode: string,\n  {message, values}: MessageDescriptor\n): string {\n  // find plural config e.g. [one 1 item|other {count} items]\n  const match = message.match(/\\[(.+?)]/);\n  const count = values?.count;\n  if (match && match[1] && !Number.isNaN(count)) {\n    // get config without brackets and split by pipe e.g. [one 1 item, other {count} items]\n    const [pluralPlaceholder, pluralConfig] = match;\n    const choices = pluralConfig.split('|');\n    if (!choices.length) return message;\n\n    // use Intl.PluralRules to determine which choice to use, based on special \"count\" value\n    const rules = getRules(localeCode);\n    const choiceName = rules.select(count as number);\n\n    // find the correct choice from config, or use first one\n    let choiceConfig = choices.find(c => {\n      return c.startsWith(choiceName);\n    });\n    if (!choiceConfig) {\n      choiceConfig = choices[0];\n    }\n\n    // get rid of plural prefix e.g. one 1 item => 1 item\n    const choice = choiceConfig.substring(choiceConfig.indexOf(' ') + 1);\n\n    return message.replace(pluralPlaceholder, choice);\n  }\n  return message;\n}\n\nconst getRules = memoize((localeCode: string) => {\n  return new Intl.PluralRules(localeCode);\n});\n","import {cloneElement, Fragment, isValidElement, memo} from 'react';\nimport {shallowEqual} from '../utils/shallow-equal';\nimport {useSelectedLocale} from './selected-locale';\nimport {handlePluralMessage} from './handle-plural-message';\nimport {MessageDescriptor} from './message-descriptor';\n\nexport const Trans = memo((props: MessageDescriptor) => {\n  const {message: initialMessage, values} = props;\n  const {lines, localeCode} = useSelectedLocale();\n  let translatedMessage = lines?.[initialMessage] || initialMessage;\n\n  if (!values) {\n    return <Fragment>{translatedMessage}</Fragment>;\n  }\n\n  translatedMessage = handlePluralMessage(localeCode, {\n    message: translatedMessage,\n    values,\n  });\n\n  // placeholders that need to be replaced with react element, eg. <Icon/>\n  const nodePlaceholders: string[] = [];\n  // placeholders that need to be replaced with render fn, eg. <a>link text</a>\n  const tagNames: string[] = [];\n\n  Object.entries(values).forEach(([key, value]) => {\n    // value is react render function\n    if (typeof value === 'function') {\n      tagNames.push(key);\n      // value is react element\n    } else if (isValidElement(value)) {\n      nodePlaceholders.push(key);\n      // value is primitive, can do simple string replace\n    } else if (value != undefined) {\n      translatedMessage = translatedMessage.replace(`:${key}`, `${value}`);\n    }\n  });\n\n  // if we need to replace placeholder with react element or render fn, we will need to split the\n  // string by these placeholders and replace static string values with matching react element value\n  if (tagNames.length || nodePlaceholders.length) {\n    // we'll build simple OR regex to split the string eg. (<[ab]>content</[ab]>)|({(?:icon|link)})\n    const regexArray: string[] = [];\n    if (tagNames.length) {\n      const tagNameMatchers = tagNames.join('');\n      regexArray.push(`(<[${tagNameMatchers}]>.+?<\\\\/[${tagNameMatchers}]>)`);\n    }\n    if (nodePlaceholders.length) {\n      const nodePlaceholderMatchers = nodePlaceholders.join('|');\n      regexArray.push(`(\\:(?:${nodePlaceholderMatchers}))`);\n    }\n\n    const regex = new RegExp(regexArray.join('|'), 'gm');\n    const parts = translatedMessage.split(regex);\n\n    // get rid of any empty strings or undefined from split by regex\n    const compiledMessage = parts.filter(Boolean).map((part, i) => {\n      // it's a tag name placeholder, eg. <a>content</a>\n      if (part.startsWith('<') && part.endsWith('>')) {\n        // grab tag content\n        const matches = part.match(/<([a-z]+)>(.+?)<\\/([a-z]+)>/);\n        if (matches) {\n          const [, tagName, content] = matches;\n          const renderFn = values?.[tagName];\n          if (typeof renderFn === 'function') {\n            // pass it to render fn from values\n            const node = renderFn(content);\n            // add a key to avoid react errors\n            return cloneElement(node, {key: i});\n          }\n        }\n      }\n\n      // it's a regular placeholder with react element value, eg. {icon}\n      if (part.startsWith(':')) {\n        const key = part.replace(':', '');\n        const node = values?.[key];\n        if (isValidElement(node)) {\n          return cloneElement(node, {key: i});\n        }\n      }\n\n      // it's a regular string\n      return part;\n    });\n    return <Fragment>{compiledMessage}</Fragment>;\n  }\n\n  return <Fragment>{translatedMessage}</Fragment>;\n}, areEqual);\n\nexport function areEqual<T extends MessageDescriptor = MessageDescriptor>(\n  prevProps: T,\n  nextProps: T\n): boolean {\n  const {values, ...otherProps} = prevProps;\n  const {values: nextValues, ...nextOtherProps} = nextProps;\n  return (\n    shallowEqual(nextValues, values) &&\n    shallowEqual(otherProps as any, nextOtherProps)\n  );\n}\n","import {AnimatePresence} from 'framer-motion';\nimport React, {\n  cloneElement,\n  ComponentPropsWithoutRef,\n  JSXElementConstructor,\n  ReactElement,\n  RefObject,\n  useEffect,\n  useMemo,\n  useRef,\n} from 'react';\nimport clsx from 'clsx';\nimport {ListBoxContext, useListboxContext} from './listbox-context';\nimport {useIsMobileDevice} from '../../../utils/hooks/is-mobile-device';\nimport {Popover} from '../../overlays/popover';\nimport {Tray} from '../../overlays/tray';\nimport {Trans} from '../../../i18n/trans';\nimport {createPortal} from 'react-dom';\nimport {UseListboxReturn} from './types';\nimport {OverlayProps} from '../../overlays/overlay-props';\nimport {rootEl} from '../../../core/root-el';\n\ninterface Props extends ComponentPropsWithoutRef<'div'> {\n  listbox: UseListboxReturn;\n  mobileOverlay?: JSXElementConstructor<OverlayProps>;\n  children?: ReactElement;\n  isLoading?: boolean;\n}\nexport function Listbox({\n  listbox,\n  children: trigger,\n  isLoading,\n  mobileOverlay = Tray,\n  ...domProps\n}: Props) {\n  const isMobile = useIsMobileDevice();\n  const {\n    floatingWidth,\n    floatingMinWidth = 'min-w-180',\n    collection,\n    showEmptyMessage,\n    state: {isOpen, setIsOpen},\n    positionStyle,\n    floating,\n    refs,\n  } = listbox;\n\n  const Overlay = isMobile ? mobileOverlay : Popover;\n\n  const className = clsx(\n    'py-4 text-base sm:text-sm outline-none bg-paper shadow-xl border max-h-inherit overflow-x-auto',\n\n    // tray will apply its own rounding and max width\n    Overlay === Popover && 'rounded',\n    Overlay === Popover && floatingWidth === 'auto'\n      ? `max-w-288 ${floatingMinWidth}`\n      : ''\n  );\n\n  const children = useMemo(() => {\n    let sectionIndex = 0;\n    const renderedSections: ReactElement[] = [];\n    return [...collection.values()].reduce<ReactElement[]>((prev, curr) => {\n      if (!curr.section) {\n        prev.push(\n          cloneElement(curr.element, {\n            key: curr.element.key || curr.element.props.value,\n          })\n        );\n      } else if (!renderedSections.includes(curr.section)) {\n        const section = cloneElement(curr.section, {\n          key: curr.section.key || sectionIndex,\n          index: sectionIndex,\n        });\n        prev.push(section);\n        // clone element will create new instance of object, need to keep\n        // track of original instance so sections are not duplicated\n        renderedSections.push(curr.section);\n        sectionIndex++;\n      }\n      return prev;\n    }, []);\n  }, [collection]);\n\n  return (\n    <ListBoxContext.Provider value={listbox}>\n      {trigger}\n      {rootEl &&\n        createPortal(\n          <AnimatePresence>\n            {isOpen && (children.length > 0 || showEmptyMessage) && (\n              <Overlay\n                triggerRef={refs.reference as RefObject<HTMLElement>}\n                restoreFocus\n                isOpen={isOpen}\n                onClose={() => {\n                  setIsOpen(false);\n                }}\n                isDismissable\n                style={positionStyle}\n                ref={floating}\n              >\n                <FocusContainer\n                  isLoading={isLoading}\n                  className={className}\n                  {...domProps}\n                >\n                  {children}\n                </FocusContainer>\n              </Overlay>\n            )}\n          </AnimatePresence>,\n          rootEl\n        )}\n    </ListBoxContext.Provider>\n  );\n}\n\ninterface WrapperProps extends ComponentPropsWithoutRef<'div'> {\n  isLoading?: boolean;\n  children: ReactElement[];\n}\nfunction FocusContainer({\n  className,\n  children,\n  isLoading,\n  ...domProps\n}: WrapperProps) {\n  const {\n    role,\n    listboxId,\n    virtualFocus,\n    focusItem,\n    state: {activeIndex, setActiveIndex},\n  } = useListboxContext();\n  const autoFocusRef = useRef(true);\n  const domRef = useRef<HTMLDivElement>(null);\n\n  // reset activeIndex on unmount\n  useEffect(() => {\n    return () => setActiveIndex(null);\n  }, [setActiveIndex]);\n\n  // focus active index or menu on mount, because menu will be closed\n  // on trigger keyDown and focus won't be applied to items\n  useEffect(() => {\n    if (autoFocusRef.current) {\n      // if no activeIndex, focus menu itself\n      if (activeIndex == null && !virtualFocus) {\n        requestAnimationFrame(() => {\n          domRef.current?.focus({preventScroll: true});\n        });\n      } else if (activeIndex != null) {\n        // wait until next frame, otherwise auto scroll might not work\n        requestAnimationFrame(() => {\n          focusItem('increment', activeIndex);\n        });\n      }\n    }\n    autoFocusRef.current = false;\n  }, [activeIndex, focusItem, virtualFocus]);\n\n  return (\n    <div\n      tabIndex={-1}\n      role={role}\n      id={listboxId}\n      className={className}\n      ref={domRef}\n      {...domProps}\n    >\n      {children.length ? children : <EmptyMessage isLoading={isLoading} />}\n    </div>\n  );\n}\n\ninterface EmptyMessageProps {\n  isLoading?: boolean;\n}\nfunction EmptyMessage({isLoading}: EmptyMessageProps) {\n  return (\n    <div className=\"italic px-8 py-4 text-sm text-muted\">\n      {isLoading ? (\n        <Trans message=\"Loading...\" />\n      ) : (\n        <Trans message=\"There are no items matching your query\" />\n      )}\n    </div>\n  );\n}\n","import React from 'react';\nimport {UseListboxReturn} from './types';\n\nexport function useListboxKeyboardNavigation({\n  state: {isOpen, setIsOpen, selectedIndex, activeIndex},\n  loopFocus,\n  collection,\n  focusItem,\n}: UseListboxReturn) {\n  const handleTriggerKeyDown = (e: React.KeyboardEvent): true | void => {\n    // ignore if dropdown is open or if event bubbled up from portal\n    if (isOpen || !e.currentTarget.contains(e.target as HTMLElement)) return;\n\n    if (e.key === 'ArrowDown') {\n      e.preventDefault();\n      setIsOpen(true);\n      focusItem('increment', selectedIndex != null ? selectedIndex : 0);\n      return true;\n    } else if (e.key === 'ArrowUp') {\n      e.preventDefault();\n      setIsOpen(true);\n      focusItem(\n        'decrement',\n        selectedIndex != null ? selectedIndex : collection.size - 1\n      );\n      return true;\n    } else if (e.key === 'Enter' || e.key === 'Space') {\n      e.preventDefault();\n      setIsOpen(true);\n      focusItem('increment', selectedIndex != null ? selectedIndex : 0);\n      return true;\n    }\n  };\n\n  const handleListboxKeyboardNavigation = (\n    e: React.KeyboardEvent\n  ): true | void => {\n    const lastIndex = Math.max(0, collection.size - 1);\n    // ignore if event bubbled up from portal, or dropdown is closed\n    if (!isOpen || !e.currentTarget.contains(e.target as HTMLElement)) return;\n\n    switch (e.key) {\n      case 'ArrowDown':\n        e.preventDefault();\n        if (activeIndex == null) {\n          focusItem('increment', 0);\n        } else if (activeIndex >= lastIndex) {\n          // if focus is not looping, stay on last index\n          if (loopFocus) {\n            focusItem('increment', 0);\n          }\n        } else {\n          focusItem('increment', activeIndex + 1);\n        }\n        return true;\n      case 'ArrowUp':\n        e.preventDefault();\n        if (activeIndex == null) {\n          focusItem('decrement', lastIndex);\n        } else if (activeIndex <= 0) {\n          // if focus is not looping, stay on first index\n          if (loopFocus) {\n            focusItem('decrement', lastIndex);\n          }\n        } else {\n          focusItem('decrement', activeIndex - 1);\n        }\n        return true;\n      case 'Home':\n        e.preventDefault();\n        focusItem('increment', 0);\n        return true;\n      case 'End':\n        e.preventDefault();\n        focusItem('decrement', lastIndex);\n        return true;\n      case 'Tab':\n        setIsOpen(false);\n        return true;\n    }\n  };\n\n  return {handleTriggerKeyDown, handleListboxKeyboardNavigation};\n}\n","import {useSelectedLocale} from './selected-locale';\n\nconst cache = new Map<string, Intl.Collator>();\n\nexport function useCollator(options?: Intl.CollatorOptions): Intl.Collator {\n  const {localeCode} = useSelectedLocale();\n\n  const cacheKey =\n    localeCode +\n    (options\n      ? Object.entries(options)\n          .sort((a, b) => (a[0] < b[0] ? -1 : 1))\n          .join()\n      : '');\n\n  if (cache.has(cacheKey)) {\n    return cache.get(cacheKey)!;\n  }\n\n  const formatter = new Intl.Collator(localeCode, options);\n  cache.set(cacheKey, formatter);\n  return formatter;\n}\n","import React, {useRef} from 'react';\nimport {useCollator} from '../../../i18n/use-collator';\n\ninterface UseTypeSelectReturn {\n  findMatchingItem: (\n    e: React.KeyboardEvent,\n    listContent: (string | null)[],\n    fromIndex?: number | null\n  ) => number | null;\n}\n\ninterface SearchState {\n  search: string;\n  timeout: ReturnType<typeof setTimeout> | undefined;\n}\n\nexport function useTypeSelect(): UseTypeSelectReturn {\n  const collator = useCollator({usage: 'search', sensitivity: 'base'});\n  const state = useRef<SearchState>({\n    search: '',\n    timeout: undefined,\n  }).current;\n\n  const getMatchingIndex = (\n    listContent: (string | null)[],\n    fromIndex?: number | null\n  ) => {\n    let index = fromIndex ?? 0;\n    while (index != null) {\n      const item = listContent[index];\n      const substring = item?.slice(0, state.search.length);\n\n      if (substring && collator.compare(substring, state.search) === 0) {\n        return index;\n      }\n\n      if (index < listContent.length - 1) {\n        index++;\n        // reached the end of list\n      } else {\n        return null;\n      }\n    }\n\n    return null;\n  };\n\n  const findMatchingItem: UseTypeSelectReturn['findMatchingItem'] = (\n    e,\n    listContent,\n    fromIndex = 0\n  ) => {\n    const character = getStringForKey(e.key);\n    if (!character || e.ctrlKey || e.metaKey) {\n      return null;\n    }\n\n    // Do not propagate the Spacebar event if it's meant to be part of the search.\n    // When we time out, the search term becomes empty, hence the check on length.\n    // Trimming is to account for the case of pressing the Spacebar more than once,\n    // which should cycle through the selection/deselection of the focused item.\n    if (character === ' ' && state.search.trim().length > 0) {\n      e.preventDefault();\n      e.stopPropagation();\n    }\n\n    state.search += character;\n\n    // Use the delegate to find a key to focus.\n    // Prioritize items after the currently focused item, falling back to searching the whole list.\n    let index = getMatchingIndex(listContent, fromIndex);\n\n    // If no key found, search from the top.\n    if (index == null) {\n      index = getMatchingIndex(listContent, 0);\n    }\n\n    clearTimeout(state.timeout);\n    state.timeout = setTimeout(() => {\n      state.search = '';\n    }, 500);\n\n    return index ?? null;\n  };\n\n  return {findMatchingItem};\n}\n\nfunction getStringForKey(key: string) {\n  // If the key is of length 1, it is an ASCII value.\n  // Otherwise, if there are no ASCII characters in the key name,\n  // it is a Unicode character.\n  // See https://www.w3.org/TR/uievents-key/\n  if (key.length === 1 || !/^[A-Z]/i.test(key)) {\n    return key;\n  }\n\n  return '';\n}\n","import { useEffect, useState } from \"react\";\n\nexport interface UseMediaQueryOptions {\n  noSSR?: boolean;\n}\n\nexport function useMediaQuery(\n  query: string,\n  { noSSR }: UseMediaQueryOptions = { noSSR: true }\n) {\n  const supportsMatchMedia =\n    typeof window !== \"undefined\" && typeof window.matchMedia === \"function\";\n  const [matches, setMatches] = useState(\n    noSSR\n      ? () => (supportsMatchMedia ? window.matchMedia(query).matches : false)\n      : null\n  );\n\n  useEffect(() => {\n    if (!supportsMatchMedia) {\n      return;\n    }\n\n    const mq = window.matchMedia(query);\n    const onChange = () => {\n      setMatches(mq.matches);\n    };\n\n    mq.addEventListener(\"change\", onChange);\n    if (!noSSR) {\n      onChange();\n    }\n\n    return () => {\n      mq.removeEventListener(\"change\", onChange);\n    };\n  }, [supportsMatchMedia, query, noSSR]);\n\n  // If in SSR, the media query should never match. Once the page hydrates,\n  // this will update and the real value will be returned.\n  return typeof window === \"undefined\" ? null : matches;\n}\n","import { useMediaQuery, UseMediaQueryOptions } from \"./use-media-query\";\n\nexport function useIsMobileMediaQuery(options?: UseMediaQueryOptions) {\n  return useMediaQuery(\"(max-width: 768px)\", options);\n}\n","import React, {cloneElement, forwardRef, ReactElement, useId} from 'react';\nimport {useListbox} from '../../forms/listbox/use-listbox';\nimport {Item} from '../../forms/listbox/item';\nimport {Section} from '../../forms/listbox/section';\nimport {Listbox} from '../../forms/listbox/listbox';\nimport {useListboxKeyboardNavigation} from '../../forms/listbox/use-listbox-keyboard-navigation';\nimport {createEventHandler} from '../../../utils/dom/create-event-handler';\nimport {useTypeSelect} from '../../forms/listbox/use-type-select';\nimport {ListBoxChildren, ListboxProps} from '../../forms/listbox/types';\nimport {useIsMobileMediaQuery} from '../../../utils/hooks/is-mobile-media-query';\n\ntype Props = ListboxProps & {\n  children: [ReactElement, ReactElement<ListBoxChildren<string | number>>];\n};\nexport const MenuTrigger = forwardRef<HTMLButtonElement, Props>(\n  (props, ref) => {\n    const {\n      children: [menuTrigger, menu],\n      floatingWidth = 'auto',\n    } = props;\n\n    const id = useId();\n\n    const isMobile = useIsMobileMediaQuery();\n    const listbox = useListbox(\n      {\n        ...props,\n        floatingWidth: isMobile ? floatingWidth : 'auto',\n        role: 'menu',\n        loopFocus: true,\n        children: menu.props.children,\n      },\n      ref\n    );\n\n    const {\n      state: {isOpen, setIsOpen, activeIndex},\n      listboxId,\n      focusItem,\n      listContent,\n      reference,\n    } = listbox;\n\n    const {handleTriggerKeyDown, handleListboxKeyboardNavigation} =\n      useListboxKeyboardNavigation(listbox);\n\n    const {findMatchingItem} = useTypeSelect();\n\n    return (\n      <Listbox\n        listbox={listbox}\n        aria-labelledby={id}\n        onKeyDownCapture={e => {\n          if (!isOpen) return;\n          const i = findMatchingItem(e, listContent, activeIndex);\n          if (i) {\n            focusItem('increment', i);\n          }\n        }}\n        onKeyDown={handleListboxKeyboardNavigation}\n      >\n        {cloneElement(menuTrigger, {\n          id,\n          'aria-expanded': isOpen ? 'true' : 'false',\n          'aria-haspopup': 'menu',\n          'aria-controls': isOpen ? listboxId : undefined,\n          ref: reference,\n          onKeyDown: handleTriggerKeyDown,\n          onClick: createEventHandler(e => {\n            menuTrigger.props?.onClick?.(e);\n            setIsOpen(!isOpen);\n          }),\n        })}\n      </Listbox>\n    );\n  }\n);\n\nexport function Menu({children}: ListBoxChildren<string | number>) {\n  return children as unknown as ReactElement;\n}\n\nexport {Item as MenuItem};\nexport {Section as MenuSection};\n","import React, {ReactElement} from 'react';\nimport type {MenubarItemProps} from './toolbar-item';\nimport {\n  Menu,\n  MenuTrigger,\n} from '../../../common/ui/navigation/menu/menu-trigger';\nimport {state} from '../../../state/utils';\nimport {Item} from '../../../common/ui/forms/listbox/item';\n\ninterface DropdownButtonProps extends MenubarItemProps {\n  button: ReactElement;\n}\n\nexport function DropdownButton({item, button}: DropdownButtonProps) {\n  return (\n    <MenuTrigger>\n      {button}\n      <Menu>\n        {(item.menuItems || []).map(item => (\n          <Item\n            key={item.label}\n            value={item.label}\n            onSelected={() => {\n              item.action(state().editor);\n            }}\n          >\n            {item.label}\n          </Item>\n        ))}\n      </Menu>\n    </MenuTrigger>\n  );\n}\n","import React, {forwardRef, ReactElement} from 'react';\nimport clsx from 'clsx';\nimport {ButtonSize, getButtonSizeStyle} from './button-size';\nimport {ButtonBase, ButtonBaseProps} from './button-base';\n\ninterface Props extends ButtonBaseProps {\n  children: ReactElement;\n  padding?: string;\n  size?: ButtonSize | null;\n  iconSize?: ButtonSize | null;\n  equalWidth?: boolean;\n}\nexport const IconButton = forwardRef<HTMLButtonElement, Props>(\n  (\n    {\n      children,\n      size = 'md',\n      iconSize = size || 'md',\n      variant = 'text',\n      radius = 'rounded-full',\n      className,\n      padding,\n      equalWidth = true,\n      ...other\n    },\n    ref\n  ) => {\n    const mergedClassName = clsx(\n      getButtonSizeStyle(size, {padding, equalWidth, variant}),\n      className\n    );\n\n    return (\n      <ButtonBase\n        {...other}\n        ref={ref}\n        radius={radius}\n        variant={variant}\n        className={mergedClassName}\n      >\n        {React.cloneElement(children, {size: iconSize})}\n      </ButtonBase>\n    );\n  }\n);\n","import React, {ComponentType, ReactElement} from 'react';\nimport clsx from 'clsx';\nimport {createSvgIconFromTree, IconTree} from '../common/icons/create-svg-icon';\nimport {IconSize, SvgIconProps} from '../common/icons/svg-icon';\n\ninterface MixedIconProps {\n  icon: ReactElement<{className: string}> | IconTree[] | string | ComponentType;\n  className?: string;\n  size?: IconSize;\n}\nfunction _MixedIcon({icon, className, size}: MixedIconProps) {\n  let iconEl: ReactElement;\n  // Regular JSX element\n  if (React.isValidElement(icon)) {\n    iconEl = React.cloneElement(icon, {\n      className: 'svg-iconEl',\n    });\n\n    // url for external icon\n  } else if (typeof icon === 'string') {\n    iconEl = <img className=\"w-font h-font\" src={icon} alt=\"\" />;\n\n    // Icon tree object\n  } else if (Array.isArray(icon)) {\n    iconEl = React.createElement(createSvgIconFromTree(icon), {size});\n\n    // Component type\n  } else {\n    iconEl = React.createElement<SvgIconProps>(icon, {size});\n  }\n  return <span className={clsx(className, 'leading-none')}>{iconEl}</span>;\n}\n\nexport const MixedIcon = React.memo(_MixedIcon);\n","import {MessageDescriptor} from './message-descriptor';\nimport {Trans} from './trans';\nimport {Fragment} from 'react';\n\ninterface Props {\n  value?: string | MessageDescriptor | null;\n}\nexport function MixedText({value}: Props) {\n  if (!value) {\n    return null;\n  }\n  if (typeof value === 'string') {\n    return <Fragment>{value}</Fragment>;\n  }\n  return <Trans {...value} />;\n}\n","import React, {forwardRef} from 'react';\nimport {Button, ButtonProps} from '../../../common/ui/buttons/button';\nimport type {MenubarItemProps} from './toolbar-item';\nimport {DropdownButton} from './dropdown-button';\nimport {IconButton} from '../../../common/ui/buttons/icon-button';\nimport {state} from '../../../state/utils';\nimport {MixedIcon} from '../../mixed-icon';\nimport {MixedText} from '../../../common/i18n/mixed-text';\n\nexport function ToolbarButton({item}: MenubarItemProps) {\n  const button = item.label ? (\n    <ButtonWithLabel item={item} />\n  ) : (\n    <IconOnlyButton item={item} />\n  );\n\n  if (item.menuItems) {\n    return <DropdownButton item={item} button={button} />;\n  }\n  return React.cloneElement<ButtonProps>(button, {\n    onClick: () => {\n      item.action?.(state().editor);\n    },\n  });\n}\n\nconst IconOnlyButton = forwardRef<HTMLButtonElement, MenubarItemProps>(\n  ({item, ...other}, ref) => {\n    return (\n      <IconButton ref={ref} radius=\"rounded-full\" size=\"sm\" {...other}>\n        <MixedIcon icon={item.icon!} />\n      </IconButton>\n    );\n  }\n);\n\nconst ButtonWithLabel = forwardRef<HTMLButtonElement, MenubarItemProps>(\n  ({item, ...other}, ref) => (\n    <Button\n      ref={ref}\n      radius=\"rounded-full\"\n      size=\"xs\"\n      color={item.buttonColor || 'primary'}\n      variant={item.buttonVariant || 'flat'}\n      startIcon={item.icon && <MixedIcon icon={item.icon} />}\n      {...other}\n    >\n      <MixedText value={item.label} />\n    </Button>\n  )\n);\n","import React from 'react';\nimport clsx from 'clsx';\nimport {ButtonColor, ButtonVariant} from './get-shared-button-style';\nimport {ButtonProps} from './button';\nimport {ButtonSize} from './button-size';\n\nexport interface ButtonGroupProps {\n  children: React.ReactNode[];\n  color?: ButtonColor;\n  variant?: ButtonVariant;\n  size?: ButtonSize;\n  radius?:\n    | 'rounded-none'\n    | 'rounded'\n    | 'rounded-sm'\n    | 'rounded-md'\n    | 'rounded-lg'\n    | 'rounded-full';\n  className?: string;\n  value?: any;\n  onChange?: (newValue: any) => void;\n  multiple?: boolean;\n  disabled?: boolean;\n}\nexport function ButtonGroup({\n  children,\n  color,\n  variant,\n  radius,\n  size,\n  className,\n  value,\n  onChange,\n  multiple,\n  disabled,\n}: ButtonGroupProps) {\n  const isActive = (childValue: any): boolean => {\n    // assume that button group is not used as a toggle group, if there is no value given\n    if (value === undefined) return false;\n    if (multiple) {\n      return (value as any[]).includes(childValue);\n    }\n    return childValue === value;\n  };\n\n  const toggleMultipleValue = (childValue: any) => {\n    const newValue = [...value];\n    const childIndex = value.indexOf(childValue);\n    if (childIndex > -1) {\n      newValue.splice(childIndex, 1);\n    } else {\n      newValue.push(childValue);\n    }\n    return newValue;\n  };\n\n  const buttons = React.Children.map(children, (button, i) => {\n    if (React.isValidElement(button)) {\n      const active = isActive(button.props.value);\n      const adjustedColor = active ? 'primary' : color;\n      return React.cloneElement<ButtonProps>(button as any, {\n        color: active ? 'primary' : color,\n        variant,\n        size,\n        radius: null,\n        disabled: button.props.disabled || disabled,\n        ...button.props,\n        onClick: e => {\n          if (button.props.onClick) {\n            button.props.onClick(e);\n          }\n          if (!onChange) return;\n          if (multiple) {\n            onChange?.(toggleMultipleValue(button.props.value));\n          } else {\n            onChange?.(button.props.value);\n          }\n        },\n        className: clsx(\n          button.props.className,\n          // borders are hidden via negative margin, make sure both are visible for active item\n          active ? 'z-20' : 'z-10',\n          getStyle(i, children, radius, adjustedColor)\n        ),\n      });\n    }\n  });\n  return (\n    <div className={clsx(radius, 'inline-flex isolate', className)}>\n      {buttons}\n    </div>\n  );\n}\n\nfunction getStyle(\n  i: number,\n  children: ButtonGroupProps['children'],\n  radius: ButtonGroupProps['radius'],\n  color?: ButtonColor\n): string {\n  // first\n  if (i === 0) {\n    return clsx(\n      radius,\n      'rounded-tr-none rounded-br-none',\n      !color && 'border-r-transparent disabled:border-r-transparent'\n    );\n  }\n  // last\n  if (i === children.length - 1) {\n    return clsx(radius, 'rounded-tl-none rounded-bl-none -ml-1');\n  }\n  return clsx(\n    'rounded-none -ml-1',\n    !color && 'border-r-transparent disabled:border-r-transparent'\n  );\n}\n","import {createSvgIcon} from '../create-svg-icon';\n\nexport const UndoIcon = createSvgIcon(\n  <path d=\"M12.5 8c-2.65 0-5.05.99-6.9 2.6L2 7v9h9l-3.62-3.62c1.39-1.16 3.16-1.88 5.12-1.88 3.54 0 6.55 2.31 7.6 5.5l2.37-.78C21.08 11.03 17.15 8 12.5 8z\" />\n, 'UndoOutlined');\n","import {createSvgIcon} from '../create-svg-icon';\n\nexport const RedoIcon = createSvgIcon(\n  <path d=\"M18.4 10.6C16.55 8.99 14.15 8 11.5 8c-4.65 0-8.58 3.03-9.96 7.22L3.9 16c1.05-3.19 4.05-5.5 7.6-5.5 1.95 0 3.73.72 5.12 1.88L13 16h9V7l-3.6 3.6z\" />\n, 'RedoOutlined');\n","import React from 'react';\nimport {useStore} from '../../../state/store';\nimport {ButtonGroup} from '../../../common/ui/buttons/button-group';\nimport {IconButton} from '../../../common/ui/buttons/icon-button';\nimport {tools} from '../../../state/utils';\nimport {UndoIcon} from '../../../common/icons/material/Undo';\nimport {RedoIcon} from '../../../common/icons/material/Redo';\n\nexport function UndoRedoBtns() {\n  const canUndo = useStore(s => s.history.canUndo);\n  const canRedo = useStore(s => s.history.canRedo);\n\n  return (\n    <ButtonGroup variant=\"outline\">\n      <IconButton\n        equalWidth={false}\n        size=\"xs\"\n        padding=\"pl-12 pr-10\"\n        radius=\"rounded-full\"\n        disabled={!canUndo}\n        onClick={() => {\n          tools().history.undo();\n        }}\n      >\n        <UndoIcon />\n      </IconButton>\n      <IconButton\n        equalWidth={false}\n        padding=\"pl-10 pr-12\"\n        size=\"xs\"\n        radius=\"rounded-full\"\n        disabled={!canRedo}\n        onClick={() => {\n          tools().history.redo();\n        }}\n      >\n        <RedoIcon />\n      </IconButton>\n    </ButtonGroup>\n  );\n}\n","import {createSvgIcon} from '../create-svg-icon';\n\nexport const RemoveIcon = createSvgIcon(\n  <path d=\"M19 13H5v-2h14v2z\" />\n, 'RemoveOutlined');\n","import {createSvgIcon} from '../create-svg-icon';\n\nexport const AddIcon = createSvgIcon(\n  <path d=\"M19 13h-6v6h-2v-6H5v-2h6V5h2v6h6v2z\" />\n, 'AddOutlined');\n","import React from 'react';\nimport {useStore} from '../../../state/store';\nimport {IconButton} from '../../../common/ui/buttons/icon-button';\nimport {RemoveIcon} from '../../../common/icons/material/Remove';\nimport {AddIcon} from '../../../common/icons/material/Add';\nimport {tools} from '../../../state/utils';\n\nexport function ZoomWidget() {\n  const zoom = useStore(s => s.zoom) || 1;\n  const allowUserZoom =\n    useStore(s => s.config.tools?.zoom?.allowUserZoom) ?? true;\n\n  if (!allowUserZoom) {\n    return null;\n  }\n\n  return (\n    <div className=\"flex items-center select-none\">\n      <IconButton\n        size=\"sm\"\n        disabled={!tools().zoom?.canZoomOut()}\n        onClick={() => {\n          tools().zoom.zoomOut(tools().zoom.step);\n        }}\n      >\n        <RemoveIcon />\n      </IconButton>\n      <div className=\"w-[4ch] text-sm text-center\">\n        {Math.round(zoom * 100)}%\n      </div>\n      <IconButton\n        size=\"sm\"\n        disabled={!tools().zoom?.canZoomIn()}\n        onClick={() => {\n          tools().zoom.zoomIn(tools().zoom.step);\n        }}\n      >\n        <AddIcon />\n      </IconButton>\n    </div>\n  );\n}\n","import React from 'react';\nimport {ToolbarItemConfig} from '../../../config/default-config';\nimport {ToolbarButton} from './toolbar-button';\nimport {UndoRedoBtns} from './undo-redo-btns';\nimport {ZoomWidget} from './zoom-widget';\nimport {assetUrl} from '../../../utils/asset-url';\n\nexport interface MenubarItemProps {\n  item: ToolbarItemConfig;\n}\n\nexport function ToolbarItem({item}: MenubarItemProps) {\n  switch (item.type) {\n    case 'undoWidget':\n      return <UndoRedoBtns />;\n    case 'zoomWidget':\n      return <ZoomWidget />;\n    case 'button':\n      return <ToolbarButton item={item} />;\n    case 'image':\n      return (\n        <img className=\"h-30 object-cover\" src={assetUrl(item.src)} alt=\"\" />\n      );\n    default:\n      return null;\n  }\n}\n","import {createSvgIcon} from '../create-svg-icon';\n\nexport const CloseIcon = createSvgIcon(\n  <path d=\"M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41z\" />\n, 'CloseOutlined');\n","import {state} from '../state/utils';\nimport {useStore} from '../state/store';\nimport {EditorMode} from '../config/editor-mode';\n\nexport function useEditorMode() {\n  let isModal = useStore(s => s.config.ui?.mode === EditorMode.OVERLAY);\n  const {width} = useStore(s => s.stageSize);\n  const isMobile = width <= 700;\n  if (isMobile && state().config.ui?.forceOverlayModeOnMobile) {\n    isModal = true;\n  }\n  return {isModal, isMobile};\n}\n","import {m} from 'framer-motion';\nimport React, {useMemo} from 'react';\nimport {useStore} from '../../state/store';\nimport {toolbarAnimation, toolbarStyle} from './toolbar-style';\nimport {ToolbarItemConfig} from '../../config/default-config';\nimport {ToolbarItem} from './toolbar-item/toolbar-item';\nimport {IconButton} from '../../common/ui/buttons/icon-button';\nimport {state} from '../../state/utils';\nimport {CloseIcon} from '../../common/icons/material/Close';\nimport {useEditorMode} from '../editor-mode';\n\nexport function MainToolbar() {\n  const {isModal, isMobile} = useEditorMode();\n  const allowEditorClose = useStore(s => s.config.ui?.allowEditorClose) ?? true;\n  const items = useStore(s => s.config.ui?.menubar?.items);\n\n  const {left, center, right} = useMemo(() => {\n    return groupMenuItems(items || [], isMobile);\n  }, [items, isMobile]);\n\n  const closeButton = isModal && isMobile && allowEditorClose && (\n    <IconButton\n      size=\"sm\"\n      className=\"ml-10\"\n      onClick={() => {\n        state().editor.close();\n      }}\n    >\n      <CloseIcon />\n    </IconButton>\n  );\n\n  return (\n    <m.div className={toolbarStyle} {...toolbarAnimation}>\n      <div className=\"mr-auto flex items-center gap-8\">\n        {left.map((item, i) => (\n          // eslint-disable-next-line react/no-array-index-key\n          <ToolbarItem item={item} key={i} />\n        ))}\n      </div>\n      <div className=\"flex items-center gap-10\">\n        {center.map((item, i) => (\n          // eslint-disable-next-line react/no-array-index-key\n          <ToolbarItem item={item} key={i} />\n        ))}\n      </div>\n      <div className=\"ml-auto flex items-center gap-8\">\n        {right.map((item, i) => (\n          // eslint-disable-next-line react/no-array-index-key\n          <ToolbarItem item={item} key={i} />\n        ))}\n      </div>\n      {closeButton}\n    </m.div>\n  );\n}\n\nfunction groupMenuItems(\n  items: ToolbarItemConfig[],\n  isMobile: boolean\n): {\n  left: ToolbarItemConfig[];\n  center: ToolbarItemConfig[];\n  right: ToolbarItemConfig[];\n} {\n  const groupedItems: Record<string, ToolbarItemConfig[]> = {\n    left: [],\n    center: [],\n    right: [],\n  };\n\n  (items || [])\n    .filter(\n      item => (!isMobile && !item.mobileOnly) || (isMobile && !item.desktopOnly)\n    )\n    .forEach(item => {\n      if (item.align === 'left') {\n        groupedItems.left.push({...item, position: item.position ?? 1});\n      } else if (item.align === 'right') {\n        groupedItems.right.push({...item, position: item.position ?? 1});\n      } else {\n        groupedItems.center.push({...item, position: item.position ?? 1});\n      }\n    });\n\n  // sort menubar items by \"position\" prop\n  const entries = Object.entries(groupedItems).map(([key, value]) => {\n    return [key, value.sort((a, b) => (a.position ?? 0) - (b.position ?? 0))];\n  });\n\n  return Object.fromEntries(entries);\n}\n","import React from 'react';\nimport {useStore} from '../../../../state/store';\n\nexport function CropzoneSizeIndicator() {\n  const width = useStore(s => s.crop.zoneRect?.width) || 1;\n  const height = useStore(s => s.crop.zoneRect?.height) || 1;\n\n  return <div className=\"text-sm\">{`${width}x${height}`}</div>;\n}\n","import React from 'react';\nimport {m} from 'framer-motion';\nimport {useStore} from '../../state/store';\nimport {IconButton} from '../../common/ui/buttons/icon-button';\nimport {ToolName} from '../../tools/tool-name';\nimport {CropzoneSizeIndicator} from '../../tools/crop/ui/crop-nav/cropzone-size-indicator';\nimport {toolbarAnimation, toolbarStyle} from './toolbar-style';\nimport {state} from '../../state/utils';\nimport {Button} from '../../common/ui/buttons/button';\nimport {CloseIcon} from '../../common/icons/material/Close';\nimport {CheckIcon} from '../../common/icons/material/Check';\nimport {useEditorMode} from '../editor-mode';\nimport {Trans} from '../../common/i18n/trans';\n\nexport function ActiveToolbar() {\n  const activeTool = useStore(s => s.activeTool);\n  return (\n    <m.div className={toolbarStyle} {...toolbarAnimation}>\n      <CancelButton />\n      {getToolName(activeTool)}\n      <ApplyButton />\n    </m.div>\n  );\n}\n\nfunction CancelButton() {\n  const {isMobile} = useEditorMode();\n  const isDirty = useStore(s => s.dirty);\n  if (isMobile) {\n    return (\n      <IconButton\n        size=\"sm\"\n        onClick={() => {\n          state().cancelChanges();\n        }}\n      >\n        <CloseIcon />\n      </IconButton>\n    );\n  }\n  return (\n    <Button\n      variant=\"outline\"\n      size=\"xs\"\n      startIcon={<CloseIcon />}\n      radius=\"rounded-full\"\n      onClick={() => {\n        state().cancelChanges();\n      }}\n    >\n      {isDirty ? <Trans message=\"Cancel\" /> : <Trans message=\"Close\" />}\n    </Button>\n  );\n}\n\nfunction getToolName(toolName: ToolName | null) {\n  const defaultCmp = <div className=\"capitalize text-sm\">{toolName}</div>;\n  switch (toolName) {\n    case ToolName.CROP: {\n      const allowCustom = state().config.tools?.crop?.allowCustomRatio ?? true;\n      if (allowCustom) {\n        return <CropzoneSizeIndicator />;\n      }\n      return defaultCmp;\n    }\n    default:\n      return defaultCmp;\n  }\n}\n\nfunction ApplyButton() {\n  const {isMobile} = useEditorMode();\n  const isDirty = useStore(s => s.dirty);\n  if (isMobile) {\n    return (\n      <IconButton\n        size=\"sm\"\n        disabled={!isDirty}\n        onClick={() => {\n          state().applyChanges();\n        }}\n      >\n        <CheckIcon />\n      </IconButton>\n    );\n  }\n  return (\n    <Button\n      variant=\"flat\"\n      color=\"primary\"\n      size=\"xs\"\n      disabled={!isDirty}\n      startIcon={<CheckIcon />}\n      radius=\"rounded-full\"\n      onClick={() => {\n        state().applyChanges();\n      }}\n    >\n      <Trans message=\"Apply\" />\n    </Button>\n  );\n}\n","import {AnimatePresence} from 'framer-motion';\nimport {useStore} from '../../state/store';\nimport {MainToolbar} from './main-toolbar';\nimport {ActiveToolbar} from './active-toolbar';\n\nexport function ToolbarContainer() {\n  const activeTool = useStore(s => s.activeTool);\n\n  return (\n    <AnimatePresence initial={false}>\n      {activeTool ? (\n        <ActiveToolbar key=\"activeToolbar\" />\n      ) : (\n        <MainToolbar key=\"mainToolbar\" />\n      )}\n    </AnimatePresence>\n  );\n}\n","import React, {useEffect, useState} from 'react';\nimport {AnimatePresence, m} from 'framer-motion';\nimport {useStore} from '../../state/store';\nimport {LoadingType} from '../../state/editor-state';\nimport {message} from '../../common/i18n/message';\nimport {Trans} from '../../common/i18n/trans';\n\nconst messages = {\n  newCanvas: message('Loading Canvas'),\n  mainImage: message('Loading Image'),\n  state: message('Loading State'),\n  merge: message('Processing Image'),\n};\n\nexport function LoadingIndicator() {\n  const [activeLoadState, setActiveLoadState] = useState<LoadingType | false>(\n    false\n  );\n\n  useEffect(() => {\n    useStore.subscribe(\n      s => s.loading,\n      loadState => {\n        if (loadState) {\n          setActiveLoadState(loadState);\n        }\n      }\n    );\n  }, []);\n\n  return (\n    <AnimatePresence>\n      {activeLoadState && (\n        <m.div\n          initial={{y: '60%', opacity: 0}}\n          animate={{y: 0, opacity: 1}}\n          exit={{y: '-60%', opacity: 0}}\n          transition={{type: 'tween', duration: 0.3}}\n          onAnimationComplete={() => {\n            setTimeout(() => {\n              setActiveLoadState(false);\n            }, 400);\n          }}\n          className=\"absolute z-loading-indicator inset-0 m-auto p-6 w-144 h-32 text-center text-sm bg-paper rounded-full shadow-lg\"\n        >\n          <Trans {...messages[activeLoadState]} />\n        </m.div>\n      )}\n    </AnimatePresence>\n  );\n}\n","function clamp(v, min, max) {\n  return Math.max(min, Math.min(v, max));\n}\nconst V = {\n  toVector(v, fallback) {\n    if (v === undefined) v = fallback;\n    return Array.isArray(v) ? v : [v, v];\n  },\n\n  add(v1, v2) {\n    return [v1[0] + v2[0], v1[1] + v2[1]];\n  },\n\n  sub(v1, v2) {\n    return [v1[0] - v2[0], v1[1] - v2[1]];\n  },\n\n  addTo(v1, v2) {\n    v1[0] += v2[0];\n    v1[1] += v2[1];\n  },\n\n  subTo(v1, v2) {\n    v1[0] -= v2[0];\n    v1[1] -= v2[1];\n  }\n\n};\n\nfunction rubberband(distance, dimension, constant) {\n  if (dimension === 0 || Math.abs(dimension) === Infinity) return Math.pow(distance, constant * 5);\n  return distance * dimension * constant / (dimension + constant * distance);\n}\n\nfunction rubberbandIfOutOfBounds(position, min, max, constant = 0.15) {\n  if (constant === 0) return clamp(position, min, max);\n  if (position < min) return -rubberband(min - position, max - min, constant) + min;\n  if (position > max) return +rubberband(position - max, max - min, constant) + max;\n  return position;\n}\nfunction computeRubberband(bounds, [Vx, Vy], [Rx, Ry]) {\n  const [[X0, X1], [Y0, Y1]] = bounds;\n  return [rubberbandIfOutOfBounds(Vx, X0, X1, Rx), rubberbandIfOutOfBounds(Vy, Y0, Y1, Ry)];\n}\n\nexport { V, computeRubberband as c, rubberbandIfOutOfBounds as r };\n","import { V, c as computeRubberband } from './maths-b2a210f4.esm.js';\n\nfunction _defineProperty(obj, key, value) {\n  if (key in obj) {\n    Object.defineProperty(obj, key, {\n      value: value,\n      enumerable: true,\n      configurable: true,\n      writable: true\n    });\n  } else {\n    obj[key] = value;\n  }\n\n  return obj;\n}\n\nfunction ownKeys(object, enumerableOnly) {\n  var keys = Object.keys(object);\n\n  if (Object.getOwnPropertySymbols) {\n    var symbols = Object.getOwnPropertySymbols(object);\n    enumerableOnly && (symbols = symbols.filter(function (sym) {\n      return Object.getOwnPropertyDescriptor(object, sym).enumerable;\n    })), keys.push.apply(keys, symbols);\n  }\n\n  return keys;\n}\n\nfunction _objectSpread2(target) {\n  for (var i = 1; i < arguments.length; i++) {\n    var source = null != arguments[i] ? arguments[i] : {};\n    i % 2 ? ownKeys(Object(source), !0).forEach(function (key) {\n      _defineProperty(target, key, source[key]);\n    }) : Object.getOwnPropertyDescriptors ? Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)) : ownKeys(Object(source)).forEach(function (key) {\n      Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key));\n    });\n  }\n\n  return target;\n}\n\nconst EVENT_TYPE_MAP = {\n  pointer: {\n    start: 'down',\n    change: 'move',\n    end: 'up'\n  },\n  mouse: {\n    start: 'down',\n    change: 'move',\n    end: 'up'\n  },\n  touch: {\n    start: 'start',\n    change: 'move',\n    end: 'end'\n  },\n  gesture: {\n    start: 'start',\n    change: 'change',\n    end: 'end'\n  }\n};\n\nfunction capitalize(string) {\n  if (!string) return '';\n  return string[0].toUpperCase() + string.slice(1);\n}\n\nconst actionsWithoutCaptureSupported = ['enter', 'leave'];\n\nfunction hasCapture(capture = false, actionKey) {\n  return capture && !actionsWithoutCaptureSupported.includes(actionKey);\n}\n\nfunction toHandlerProp(device, action = '', capture = false) {\n  const deviceProps = EVENT_TYPE_MAP[device];\n  const actionKey = deviceProps ? deviceProps[action] || action : action;\n  return 'on' + capitalize(device) + capitalize(actionKey) + (hasCapture(capture, actionKey) ? 'Capture' : '');\n}\nconst pointerCaptureEvents = ['gotpointercapture', 'lostpointercapture'];\nfunction parseProp(prop) {\n  let eventKey = prop.substring(2).toLowerCase();\n  const passive = !!~eventKey.indexOf('passive');\n  if (passive) eventKey = eventKey.replace('passive', '');\n  const captureKey = pointerCaptureEvents.includes(eventKey) ? 'capturecapture' : 'capture';\n  const capture = !!~eventKey.indexOf(captureKey);\n  if (capture) eventKey = eventKey.replace('capture', '');\n  return {\n    device: eventKey,\n    capture,\n    passive\n  };\n}\nfunction toDomEventType(device, action = '') {\n  const deviceProps = EVENT_TYPE_MAP[device];\n  const actionKey = deviceProps ? deviceProps[action] || action : action;\n  return device + actionKey;\n}\nfunction isTouch(event) {\n  return 'touches' in event;\n}\nfunction getPointerType(event) {\n  if (isTouch(event)) return 'touch';\n  if ('pointerType' in event) return event.pointerType;\n  return 'mouse';\n}\n\nfunction getCurrentTargetTouchList(event) {\n  return Array.from(event.touches).filter(e => {\n    var _event$currentTarget, _event$currentTarget$;\n\n    return e.target === event.currentTarget || ((_event$currentTarget = event.currentTarget) === null || _event$currentTarget === void 0 ? void 0 : (_event$currentTarget$ = _event$currentTarget.contains) === null || _event$currentTarget$ === void 0 ? void 0 : _event$currentTarget$.call(_event$currentTarget, e.target));\n  });\n}\n\nfunction getTouchList(event) {\n  return event.type === 'touchend' || event.type === 'touchcancel' ? event.changedTouches : event.targetTouches;\n}\n\nfunction getValueEvent(event) {\n  return isTouch(event) ? getTouchList(event)[0] : event;\n}\n\nfunction distanceAngle(P1, P2) {\n  const dx = P2.clientX - P1.clientX;\n  const dy = P2.clientY - P1.clientY;\n  const cx = (P2.clientX + P1.clientX) / 2;\n  const cy = (P2.clientY + P1.clientY) / 2;\n  const distance = Math.hypot(dx, dy);\n  const angle = -(Math.atan2(dx, dy) * 180) / Math.PI;\n  const origin = [cx, cy];\n  return {\n    angle,\n    distance,\n    origin\n  };\n}\nfunction touchIds(event) {\n  return getCurrentTargetTouchList(event).map(touch => touch.identifier);\n}\nfunction touchDistanceAngle(event, ids) {\n  const [P1, P2] = Array.from(event.touches).filter(touch => ids.includes(touch.identifier));\n  return distanceAngle(P1, P2);\n}\nfunction pointerId(event) {\n  const valueEvent = getValueEvent(event);\n  return isTouch(event) ? valueEvent.identifier : valueEvent.pointerId;\n}\nfunction pointerValues(event) {\n  const valueEvent = getValueEvent(event);\n  return [valueEvent.clientX, valueEvent.clientY];\n}\nconst LINE_HEIGHT = 40;\nconst PAGE_HEIGHT = 800;\nfunction wheelValues(event) {\n  let {\n    deltaX,\n    deltaY,\n    deltaMode\n  } = event;\n\n  if (deltaMode === 1) {\n    deltaX *= LINE_HEIGHT;\n    deltaY *= LINE_HEIGHT;\n  } else if (deltaMode === 2) {\n    deltaX *= PAGE_HEIGHT;\n    deltaY *= PAGE_HEIGHT;\n  }\n\n  return [deltaX, deltaY];\n}\nfunction scrollValues(event) {\n  var _ref, _ref2;\n\n  const {\n    scrollX,\n    scrollY,\n    scrollLeft,\n    scrollTop\n  } = event.currentTarget;\n  return [(_ref = scrollX !== null && scrollX !== void 0 ? scrollX : scrollLeft) !== null && _ref !== void 0 ? _ref : 0, (_ref2 = scrollY !== null && scrollY !== void 0 ? scrollY : scrollTop) !== null && _ref2 !== void 0 ? _ref2 : 0];\n}\nfunction getEventDetails(event) {\n  const payload = {};\n  if ('buttons' in event) payload.buttons = event.buttons;\n\n  if ('shiftKey' in event) {\n    const {\n      shiftKey,\n      altKey,\n      metaKey,\n      ctrlKey\n    } = event;\n    Object.assign(payload, {\n      shiftKey,\n      altKey,\n      metaKey,\n      ctrlKey\n    });\n  }\n\n  return payload;\n}\n\nfunction call(v, ...args) {\n  if (typeof v === 'function') {\n    return v(...args);\n  } else {\n    return v;\n  }\n}\nfunction noop() {}\nfunction chain(...fns) {\n  if (fns.length === 0) return noop;\n  if (fns.length === 1) return fns[0];\n  return function () {\n    let result;\n\n    for (const fn of fns) {\n      result = fn.apply(this, arguments) || result;\n    }\n\n    return result;\n  };\n}\nfunction assignDefault(value, fallback) {\n  return Object.assign({}, fallback, value || {});\n}\n\nconst BEFORE_LAST_KINEMATICS_DELAY = 32;\nclass Engine {\n  constructor(ctrl, args, key) {\n    this.ctrl = ctrl;\n    this.args = args;\n    this.key = key;\n\n    if (!this.state) {\n      this.state = {};\n      this.computeValues([0, 0]);\n      this.computeInitial();\n      if (this.init) this.init();\n      this.reset();\n    }\n  }\n\n  get state() {\n    return this.ctrl.state[this.key];\n  }\n\n  set state(state) {\n    this.ctrl.state[this.key] = state;\n  }\n\n  get shared() {\n    return this.ctrl.state.shared;\n  }\n\n  get eventStore() {\n    return this.ctrl.gestureEventStores[this.key];\n  }\n\n  get timeoutStore() {\n    return this.ctrl.gestureTimeoutStores[this.key];\n  }\n\n  get config() {\n    return this.ctrl.config[this.key];\n  }\n\n  get sharedConfig() {\n    return this.ctrl.config.shared;\n  }\n\n  get handler() {\n    return this.ctrl.handlers[this.key];\n  }\n\n  reset() {\n    const {\n      state,\n      shared,\n      ingKey,\n      args\n    } = this;\n    shared[ingKey] = state._active = state.active = state._blocked = state._force = false;\n    state._step = [false, false];\n    state.intentional = false;\n    state._movement = [0, 0];\n    state._distance = [0, 0];\n    state._direction = [0, 0];\n    state._delta = [0, 0];\n    state._bounds = [[-Infinity, Infinity], [-Infinity, Infinity]];\n    state.args = args;\n    state.axis = undefined;\n    state.memo = undefined;\n    state.elapsedTime = 0;\n    state.direction = [0, 0];\n    state.distance = [0, 0];\n    state.overflow = [0, 0];\n    state._movementBound = [false, false];\n    state.velocity = [0, 0];\n    state.movement = [0, 0];\n    state.delta = [0, 0];\n    state.timeStamp = 0;\n  }\n\n  start(event) {\n    const state = this.state;\n    const config = this.config;\n\n    if (!state._active) {\n      this.reset();\n      this.computeInitial();\n      state._active = true;\n      state.target = event.target;\n      state.currentTarget = event.currentTarget;\n      state.lastOffset = config.from ? call(config.from, state) : state.offset;\n      state.offset = state.lastOffset;\n    }\n\n    state.startTime = state.timeStamp = event.timeStamp;\n  }\n\n  computeValues(values) {\n    const state = this.state;\n    state._values = values;\n    state.values = this.config.transform(values);\n  }\n\n  computeInitial() {\n    const state = this.state;\n    state._initial = state._values;\n    state.initial = state.values;\n  }\n\n  compute(event) {\n    const {\n      state,\n      config,\n      shared\n    } = this;\n    state.args = this.args;\n    let dt = 0;\n\n    if (event) {\n      state.event = event;\n      if (config.preventDefault && event.cancelable) state.event.preventDefault();\n      state.type = event.type;\n      shared.touches = this.ctrl.pointerIds.size || this.ctrl.touchIds.size;\n      shared.locked = !!document.pointerLockElement;\n      Object.assign(shared, getEventDetails(event));\n      shared.down = shared.pressed = shared.buttons % 2 === 1 || shared.touches > 0;\n      dt = event.timeStamp - state.timeStamp;\n      state.timeStamp = event.timeStamp;\n      state.elapsedTime = state.timeStamp - state.startTime;\n    }\n\n    if (state._active) {\n      const _absoluteDelta = state._delta.map(Math.abs);\n\n      V.addTo(state._distance, _absoluteDelta);\n    }\n\n    if (this.axisIntent) this.axisIntent(event);\n    const [_m0, _m1] = state._movement;\n    const [t0, t1] = config.threshold;\n    const {\n      _step,\n      values\n    } = state;\n\n    if (config.hasCustomTransform) {\n      if (_step[0] === false) _step[0] = Math.abs(_m0) >= t0 && values[0];\n      if (_step[1] === false) _step[1] = Math.abs(_m1) >= t1 && values[1];\n    } else {\n      if (_step[0] === false) _step[0] = Math.abs(_m0) >= t0 && Math.sign(_m0) * t0;\n      if (_step[1] === false) _step[1] = Math.abs(_m1) >= t1 && Math.sign(_m1) * t1;\n    }\n\n    state.intentional = _step[0] !== false || _step[1] !== false;\n    if (!state.intentional) return;\n    const movement = [0, 0];\n\n    if (config.hasCustomTransform) {\n      const [v0, v1] = values;\n      movement[0] = _step[0] !== false ? v0 - _step[0] : 0;\n      movement[1] = _step[1] !== false ? v1 - _step[1] : 0;\n    } else {\n      movement[0] = _step[0] !== false ? _m0 - _step[0] : 0;\n      movement[1] = _step[1] !== false ? _m1 - _step[1] : 0;\n    }\n\n    if (this.restrictToAxis && !state._blocked) this.restrictToAxis(movement);\n    const previousOffset = state.offset;\n    const gestureIsActive = state._active && !state._blocked || state.active;\n\n    if (gestureIsActive) {\n      state.first = state._active && !state.active;\n      state.last = !state._active && state.active;\n      state.active = shared[this.ingKey] = state._active;\n\n      if (event) {\n        if (state.first) {\n          if ('bounds' in config) state._bounds = call(config.bounds, state);\n          if (this.setup) this.setup();\n        }\n\n        state.movement = movement;\n        this.computeOffset();\n      }\n    }\n\n    const [ox, oy] = state.offset;\n    const [[x0, x1], [y0, y1]] = state._bounds;\n    state.overflow = [ox < x0 ? -1 : ox > x1 ? 1 : 0, oy < y0 ? -1 : oy > y1 ? 1 : 0];\n    state._movementBound[0] = state.overflow[0] ? state._movementBound[0] === false ? state._movement[0] : state._movementBound[0] : false;\n    state._movementBound[1] = state.overflow[1] ? state._movementBound[1] === false ? state._movement[1] : state._movementBound[1] : false;\n    const rubberband = state._active ? config.rubberband || [0, 0] : [0, 0];\n    state.offset = computeRubberband(state._bounds, state.offset, rubberband);\n    state.delta = V.sub(state.offset, previousOffset);\n    this.computeMovement();\n\n    if (gestureIsActive && (!state.last || dt > BEFORE_LAST_KINEMATICS_DELAY)) {\n      state.delta = V.sub(state.offset, previousOffset);\n      const absoluteDelta = state.delta.map(Math.abs);\n      V.addTo(state.distance, absoluteDelta);\n      state.direction = state.delta.map(Math.sign);\n      state._direction = state._delta.map(Math.sign);\n\n      if (!state.first && dt > 0) {\n        state.velocity = [absoluteDelta[0] / dt, absoluteDelta[1] / dt];\n      }\n    }\n  }\n\n  emit() {\n    const state = this.state;\n    const shared = this.shared;\n    const config = this.config;\n    if (!state._active) this.clean();\n    if ((state._blocked || !state.intentional) && !state._force && !config.triggerAllEvents) return;\n    const memo = this.handler(_objectSpread2(_objectSpread2(_objectSpread2({}, shared), state), {}, {\n      [this.aliasKey]: state.values\n    }));\n    if (memo !== undefined) state.memo = memo;\n  }\n\n  clean() {\n    this.eventStore.clean();\n    this.timeoutStore.clean();\n  }\n\n}\n\nfunction selectAxis([dx, dy], threshold) {\n  const absDx = Math.abs(dx);\n  const absDy = Math.abs(dy);\n\n  if (absDx > absDy && absDx > threshold) {\n    return 'x';\n  }\n\n  if (absDy > absDx && absDy > threshold) {\n    return 'y';\n  }\n\n  return undefined;\n}\n\nclass CoordinatesEngine extends Engine {\n  constructor(...args) {\n    super(...args);\n\n    _defineProperty(this, \"aliasKey\", 'xy');\n  }\n\n  reset() {\n    super.reset();\n    this.state.axis = undefined;\n  }\n\n  init() {\n    this.state.offset = [0, 0];\n    this.state.lastOffset = [0, 0];\n  }\n\n  computeOffset() {\n    this.state.offset = V.add(this.state.lastOffset, this.state.movement);\n  }\n\n  computeMovement() {\n    this.state.movement = V.sub(this.state.offset, this.state.lastOffset);\n  }\n\n  axisIntent(event) {\n    const state = this.state;\n    const config = this.config;\n\n    if (!state.axis && event) {\n      const threshold = typeof config.axisThreshold === 'object' ? config.axisThreshold[getPointerType(event)] : config.axisThreshold;\n      state.axis = selectAxis(state._movement, threshold);\n    }\n\n    state._blocked = (config.lockDirection || !!config.axis) && !state.axis || !!config.axis && config.axis !== state.axis;\n  }\n\n  restrictToAxis(v) {\n    if (this.config.axis || this.config.lockDirection) {\n      switch (this.state.axis) {\n        case 'x':\n          v[1] = 0;\n          break;\n\n        case 'y':\n          v[0] = 0;\n          break;\n      }\n    }\n  }\n\n}\n\nconst identity = v => v;\nconst DEFAULT_RUBBERBAND = 0.15;\nconst commonConfigResolver = {\n  enabled(value = true) {\n    return value;\n  },\n\n  eventOptions(value, _k, config) {\n    return _objectSpread2(_objectSpread2({}, config.shared.eventOptions), value);\n  },\n\n  preventDefault(value = false) {\n    return value;\n  },\n\n  triggerAllEvents(value = false) {\n    return value;\n  },\n\n  rubberband(value = 0) {\n    switch (value) {\n      case true:\n        return [DEFAULT_RUBBERBAND, DEFAULT_RUBBERBAND];\n\n      case false:\n        return [0, 0];\n\n      default:\n        return V.toVector(value);\n    }\n  },\n\n  from(value) {\n    if (typeof value === 'function') return value;\n    if (value != null) return V.toVector(value);\n  },\n\n  transform(value, _k, config) {\n    const transform = value || config.shared.transform;\n    this.hasCustomTransform = !!transform;\n\n    if (process.env.NODE_ENV === 'development') {\n      const originalTransform = transform || identity;\n      return v => {\n        const r = originalTransform(v);\n\n        if (!isFinite(r[0]) || !isFinite(r[1])) {\n          console.warn(`[@use-gesture]: config.transform() must produce a valid result, but it was: [${r[0]},${[1]}]`);\n        }\n\n        return r;\n      };\n    }\n\n    return transform || identity;\n  },\n\n  threshold(value) {\n    return V.toVector(value, 0);\n  }\n\n};\n\nif (process.env.NODE_ENV === 'development') {\n  Object.assign(commonConfigResolver, {\n    domTarget(value) {\n      if (value !== undefined) {\n        throw Error(`[@use-gesture]: \\`domTarget\\` option has been renamed to \\`target\\`.`);\n      }\n\n      return NaN;\n    },\n\n    lockDirection(value) {\n      if (value !== undefined) {\n        throw Error(`[@use-gesture]: \\`lockDirection\\` option has been merged with \\`axis\\`. Use it as in \\`{ axis: 'lock' }\\``);\n      }\n\n      return NaN;\n    },\n\n    initial(value) {\n      if (value !== undefined) {\n        throw Error(`[@use-gesture]: \\`initial\\` option has been renamed to \\`from\\`.`);\n      }\n\n      return NaN;\n    }\n\n  });\n}\n\nconst DEFAULT_AXIS_THRESHOLD = 0;\nconst coordinatesConfigResolver = _objectSpread2(_objectSpread2({}, commonConfigResolver), {}, {\n  axis(_v, _k, {\n    axis\n  }) {\n    this.lockDirection = axis === 'lock';\n    if (!this.lockDirection) return axis;\n  },\n\n  axisThreshold(value = DEFAULT_AXIS_THRESHOLD) {\n    return value;\n  },\n\n  bounds(value = {}) {\n    if (typeof value === 'function') {\n      return state => coordinatesConfigResolver.bounds(value(state));\n    }\n\n    if ('current' in value) {\n      return () => value.current;\n    }\n\n    if (typeof HTMLElement === 'function' && value instanceof HTMLElement) {\n      return value;\n    }\n\n    const {\n      left = -Infinity,\n      right = Infinity,\n      top = -Infinity,\n      bottom = Infinity\n    } = value;\n    return [[left, right], [top, bottom]];\n  }\n\n});\n\nconst DISPLACEMENT = 10;\nconst KEYS_DELTA_MAP = {\n  ArrowRight: (factor = 1) => [DISPLACEMENT * factor, 0],\n  ArrowLeft: (factor = 1) => [-DISPLACEMENT * factor, 0],\n  ArrowUp: (factor = 1) => [0, -DISPLACEMENT * factor],\n  ArrowDown: (factor = 1) => [0, DISPLACEMENT * factor]\n};\nclass DragEngine extends CoordinatesEngine {\n  constructor(...args) {\n    super(...args);\n\n    _defineProperty(this, \"ingKey\", 'dragging');\n  }\n\n  reset() {\n    super.reset();\n    const state = this.state;\n    state._pointerId = undefined;\n    state._pointerActive = false;\n    state._keyboardActive = false;\n    state._preventScroll = false;\n    state._delayed = false;\n    state.swipe = [0, 0];\n    state.tap = false;\n    state.canceled = false;\n    state.cancel = this.cancel.bind(this);\n  }\n\n  setup() {\n    const state = this.state;\n\n    if (state._bounds instanceof HTMLElement) {\n      const boundRect = state._bounds.getBoundingClientRect();\n\n      const targetRect = state.currentTarget.getBoundingClientRect();\n      const _bounds = {\n        left: boundRect.left - targetRect.left + state.offset[0],\n        right: boundRect.right - targetRect.right + state.offset[0],\n        top: boundRect.top - targetRect.top + state.offset[1],\n        bottom: boundRect.bottom - targetRect.bottom + state.offset[1]\n      };\n      state._bounds = coordinatesConfigResolver.bounds(_bounds);\n    }\n  }\n\n  cancel() {\n    const state = this.state;\n    if (state.canceled) return;\n    state.canceled = true;\n    state._active = false;\n    setTimeout(() => {\n      this.compute();\n      this.emit();\n    }, 0);\n  }\n\n  setActive() {\n    this.state._active = this.state._pointerActive || this.state._keyboardActive;\n  }\n\n  clean() {\n    this.pointerClean();\n    this.state._pointerActive = false;\n    this.state._keyboardActive = false;\n    super.clean();\n  }\n\n  pointerDown(event) {\n    const config = this.config;\n    const state = this.state;\n    if (event.buttons != null && (Array.isArray(config.pointerButtons) ? !config.pointerButtons.includes(event.buttons) : config.pointerButtons !== -1 && config.pointerButtons !== event.buttons)) return;\n    const ctrlIds = this.ctrl.setEventIds(event);\n\n    if (config.pointerCapture) {\n      event.target.setPointerCapture(event.pointerId);\n    }\n\n    if (ctrlIds && ctrlIds.size > 1 && state._pointerActive) return;\n    this.start(event);\n    this.setupPointer(event);\n    state._pointerId = pointerId(event);\n    state._pointerActive = true;\n    this.computeValues(pointerValues(event));\n    this.computeInitial();\n\n    if (config.preventScrollAxis && getPointerType(event) !== 'mouse') {\n      state._active = false;\n      this.setupScrollPrevention(event);\n    } else if (config.delay > 0) {\n      this.setupDelayTrigger(event);\n\n      if (config.triggerAllEvents) {\n        this.compute(event);\n        this.emit();\n      }\n    } else {\n      this.startPointerDrag(event);\n    }\n  }\n\n  startPointerDrag(event) {\n    const state = this.state;\n    state._active = true;\n    state._preventScroll = true;\n    state._delayed = false;\n    this.compute(event);\n    this.emit();\n  }\n\n  pointerMove(event) {\n    const state = this.state;\n    const config = this.config;\n    if (!state._pointerActive) return;\n    if (state.type === event.type && event.timeStamp === state.timeStamp) return;\n    const id = pointerId(event);\n    if (state._pointerId !== undefined && id !== state._pointerId) return;\n\n    const _values = pointerValues(event);\n\n    if (document.pointerLockElement === event.target) {\n      state._delta = [event.movementX, event.movementY];\n    } else {\n      state._delta = V.sub(_values, state._values);\n      this.computeValues(_values);\n    }\n\n    V.addTo(state._movement, state._delta);\n    this.compute(event);\n\n    if (state._delayed && state.intentional) {\n      this.timeoutStore.remove('dragDelay');\n      state.active = false;\n      this.startPointerDrag(event);\n      return;\n    }\n\n    if (config.preventScrollAxis && !state._preventScroll) {\n      if (state.axis) {\n        if (state.axis === config.preventScrollAxis || config.preventScrollAxis === 'xy') {\n          state._active = false;\n          this.clean();\n          return;\n        } else {\n          this.timeoutStore.remove('startPointerDrag');\n          this.startPointerDrag(event);\n          return;\n        }\n      } else {\n        return;\n      }\n    }\n\n    this.emit();\n  }\n\n  pointerUp(event) {\n    this.ctrl.setEventIds(event);\n\n    try {\n      if (this.config.pointerCapture && event.target.hasPointerCapture(event.pointerId)) {\n        ;\n        event.target.releasePointerCapture(event.pointerId);\n      }\n    } catch (_unused) {\n      if (process.env.NODE_ENV === 'development') {\n        console.warn(`[@use-gesture]: If you see this message, it's likely that you're using an outdated version of \\`@react-three/fiber\\`. \\n\\nPlease upgrade to the latest version.`);\n      }\n    }\n\n    const state = this.state;\n    const config = this.config;\n    if (!state._active || !state._pointerActive) return;\n    const id = pointerId(event);\n    if (state._pointerId !== undefined && id !== state._pointerId) return;\n    this.state._pointerActive = false;\n    this.setActive();\n    this.compute(event);\n    const [dx, dy] = state._distance;\n    state.tap = dx <= config.tapsThreshold && dy <= config.tapsThreshold;\n\n    if (state.tap && config.filterTaps) {\n      state._force = true;\n    } else {\n      const [dirx, diry] = state.direction;\n      const [vx, vy] = state.velocity;\n      const [mx, my] = state.movement;\n      const [svx, svy] = config.swipe.velocity;\n      const [sx, sy] = config.swipe.distance;\n      const sdt = config.swipe.duration;\n\n      if (state.elapsedTime < sdt) {\n        if (Math.abs(vx) > svx && Math.abs(mx) > sx) state.swipe[0] = dirx;\n        if (Math.abs(vy) > svy && Math.abs(my) > sy) state.swipe[1] = diry;\n      }\n    }\n\n    this.emit();\n  }\n\n  pointerClick(event) {\n    if (!this.state.tap && event.detail > 0) {\n      event.preventDefault();\n      event.stopPropagation();\n    }\n  }\n\n  setupPointer(event) {\n    const config = this.config;\n    const device = config.device;\n\n    if (process.env.NODE_ENV === 'development') {\n      try {\n        if (device === 'pointer' && config.preventScrollDelay === undefined) {\n          const currentTarget = 'uv' in event ? event.sourceEvent.currentTarget : event.currentTarget;\n          const style = window.getComputedStyle(currentTarget);\n\n          if (style.touchAction === 'auto') {\n            console.warn(`[@use-gesture]: The drag target has its \\`touch-action\\` style property set to \\`auto\\`. It is recommended to add \\`touch-action: 'none'\\` so that the drag gesture behaves correctly on touch-enabled devices. For more information read this: https://use-gesture.netlify.app/docs/extras/#touch-action.\\n\\nThis message will only show in development mode. It won't appear in production. If this is intended, you can ignore it.`, currentTarget);\n          }\n        }\n      } catch (_unused2) {}\n    }\n\n    if (config.pointerLock) {\n      event.currentTarget.requestPointerLock();\n    }\n\n    if (!config.pointerCapture) {\n      this.eventStore.add(this.sharedConfig.window, device, 'change', this.pointerMove.bind(this));\n      this.eventStore.add(this.sharedConfig.window, device, 'end', this.pointerUp.bind(this));\n      this.eventStore.add(this.sharedConfig.window, device, 'cancel', this.pointerUp.bind(this));\n    }\n  }\n\n  pointerClean() {\n    if (this.config.pointerLock && document.pointerLockElement === this.state.currentTarget) {\n      document.exitPointerLock();\n    }\n  }\n\n  preventScroll(event) {\n    if (this.state._preventScroll && event.cancelable) {\n      event.preventDefault();\n    }\n  }\n\n  setupScrollPrevention(event) {\n    this.state._preventScroll = false;\n    persistEvent(event);\n    const remove = this.eventStore.add(this.sharedConfig.window, 'touch', 'change', this.preventScroll.bind(this), {\n      passive: false\n    });\n    this.eventStore.add(this.sharedConfig.window, 'touch', 'end', remove);\n    this.eventStore.add(this.sharedConfig.window, 'touch', 'cancel', remove);\n    this.timeoutStore.add('startPointerDrag', this.startPointerDrag.bind(this), this.config.preventScrollDelay, event);\n  }\n\n  setupDelayTrigger(event) {\n    this.state._delayed = true;\n    this.timeoutStore.add('dragDelay', () => {\n      this.state._step = [0, 0];\n      this.startPointerDrag(event);\n    }, this.config.delay);\n  }\n\n  keyDown(event) {\n    const deltaFn = KEYS_DELTA_MAP[event.key];\n\n    if (deltaFn) {\n      const state = this.state;\n      const factor = event.shiftKey ? 10 : event.altKey ? 0.1 : 1;\n      this.start(event);\n      state._delta = deltaFn(factor);\n      state._keyboardActive = true;\n      V.addTo(state._movement, state._delta);\n      this.compute(event);\n      this.emit();\n    }\n  }\n\n  keyUp(event) {\n    if (!(event.key in KEYS_DELTA_MAP)) return;\n    this.state._keyboardActive = false;\n    this.setActive();\n    this.compute(event);\n    this.emit();\n  }\n\n  bind(bindFunction) {\n    const device = this.config.device;\n    bindFunction(device, 'start', this.pointerDown.bind(this));\n\n    if (this.config.pointerCapture) {\n      bindFunction(device, 'change', this.pointerMove.bind(this));\n      bindFunction(device, 'end', this.pointerUp.bind(this));\n      bindFunction(device, 'cancel', this.pointerUp.bind(this));\n      bindFunction('lostPointerCapture', '', this.pointerUp.bind(this));\n    }\n\n    if (this.config.keys) {\n      bindFunction('key', 'down', this.keyDown.bind(this));\n      bindFunction('key', 'up', this.keyUp.bind(this));\n    }\n\n    if (this.config.filterTaps) {\n      bindFunction('click', '', this.pointerClick.bind(this), {\n        capture: true,\n        passive: false\n      });\n    }\n  }\n\n}\n\nfunction persistEvent(event) {\n  'persist' in event && typeof event.persist === 'function' && event.persist();\n}\n\nconst isBrowser = typeof window !== 'undefined' && window.document && window.document.createElement;\n\nfunction supportsTouchEvents() {\n  return isBrowser && 'ontouchstart' in window;\n}\n\nfunction isTouchScreen() {\n  return supportsTouchEvents() || isBrowser && window.navigator.maxTouchPoints > 1;\n}\n\nfunction supportsPointerEvents() {\n  return isBrowser && 'onpointerdown' in window;\n}\n\nfunction supportsPointerLock() {\n  return isBrowser && 'exitPointerLock' in window.document;\n}\n\nfunction supportsGestureEvents() {\n  try {\n    return 'constructor' in GestureEvent;\n  } catch (e) {\n    return false;\n  }\n}\n\nconst SUPPORT = {\n  isBrowser,\n  gesture: supportsGestureEvents(),\n  touch: isTouchScreen(),\n  touchscreen: isTouchScreen(),\n  pointer: supportsPointerEvents(),\n  pointerLock: supportsPointerLock()\n};\n\nconst DEFAULT_PREVENT_SCROLL_DELAY = 250;\nconst DEFAULT_DRAG_DELAY = 180;\nconst DEFAULT_SWIPE_VELOCITY = 0.5;\nconst DEFAULT_SWIPE_DISTANCE = 50;\nconst DEFAULT_SWIPE_DURATION = 250;\nconst DEFAULT_DRAG_AXIS_THRESHOLD = {\n  mouse: 0,\n  touch: 0,\n  pen: 8\n};\nconst dragConfigResolver = _objectSpread2(_objectSpread2({}, coordinatesConfigResolver), {}, {\n  device(_v, _k, {\n    pointer: {\n      touch = false,\n      lock = false,\n      mouse = false\n    } = {}\n  }) {\n    this.pointerLock = lock && SUPPORT.pointerLock;\n    if (SUPPORT.touch && touch) return 'touch';\n    if (this.pointerLock) return 'mouse';\n    if (SUPPORT.pointer && !mouse) return 'pointer';\n    if (SUPPORT.touch) return 'touch';\n    return 'mouse';\n  },\n\n  preventScrollAxis(value, _k, {\n    preventScroll\n  }) {\n    this.preventScrollDelay = typeof preventScroll === 'number' ? preventScroll : preventScroll || preventScroll === undefined && value ? DEFAULT_PREVENT_SCROLL_DELAY : undefined;\n    if (!SUPPORT.touchscreen || preventScroll === false) return undefined;\n    return value ? value : preventScroll !== undefined ? 'y' : undefined;\n  },\n\n  pointerCapture(_v, _k, {\n    pointer: {\n      capture = true,\n      buttons = 1\n    } = {}\n  }) {\n    this.pointerButtons = buttons;\n    return !this.pointerLock && this.device === 'pointer' && capture;\n  },\n\n  keys(value = true) {\n    return value;\n  },\n\n  threshold(value, _k, {\n    filterTaps = false,\n    tapsThreshold = 3,\n    axis = undefined\n  }) {\n    const threshold = V.toVector(value, filterTaps ? tapsThreshold : axis ? 1 : 0);\n    this.filterTaps = filterTaps;\n    this.tapsThreshold = tapsThreshold;\n    return threshold;\n  },\n\n  swipe({\n    velocity = DEFAULT_SWIPE_VELOCITY,\n    distance = DEFAULT_SWIPE_DISTANCE,\n    duration = DEFAULT_SWIPE_DURATION\n  } = {}) {\n    return {\n      velocity: this.transform(V.toVector(velocity)),\n      distance: this.transform(V.toVector(distance)),\n      duration\n    };\n  },\n\n  delay(value = 0) {\n    switch (value) {\n      case true:\n        return DEFAULT_DRAG_DELAY;\n\n      case false:\n        return 0;\n\n      default:\n        return value;\n    }\n  },\n\n  axisThreshold(value) {\n    if (!value) return DEFAULT_DRAG_AXIS_THRESHOLD;\n    return _objectSpread2(_objectSpread2({}, DEFAULT_DRAG_AXIS_THRESHOLD), value);\n  }\n\n});\n\nif (process.env.NODE_ENV === 'development') {\n  Object.assign(dragConfigResolver, {\n    useTouch(value) {\n      if (value !== undefined) {\n        throw Error(`[@use-gesture]: \\`useTouch\\` option has been renamed to \\`pointer.touch\\`. Use it as in \\`{ pointer: { touch: true } }\\`.`);\n      }\n\n      return NaN;\n    },\n\n    experimental_preventWindowScrollY(value) {\n      if (value !== undefined) {\n        throw Error(`[@use-gesture]: \\`experimental_preventWindowScrollY\\` option has been renamed to \\`preventScroll\\`.`);\n      }\n\n      return NaN;\n    },\n\n    swipeVelocity(value) {\n      if (value !== undefined) {\n        throw Error(`[@use-gesture]: \\`swipeVelocity\\` option has been renamed to \\`swipe.velocity\\`. Use it as in \\`{ swipe: { velocity: 0.5 } }\\`.`);\n      }\n\n      return NaN;\n    },\n\n    swipeDistance(value) {\n      if (value !== undefined) {\n        throw Error(`[@use-gesture]: \\`swipeDistance\\` option has been renamed to \\`swipe.distance\\`. Use it as in \\`{ swipe: { distance: 50 } }\\`.`);\n      }\n\n      return NaN;\n    },\n\n    swipeDuration(value) {\n      if (value !== undefined) {\n        throw Error(`[@use-gesture]: \\`swipeDuration\\` option has been renamed to \\`swipe.duration\\`. Use it as in \\`{ swipe: { duration: 250 } }\\`.`);\n      }\n\n      return NaN;\n    }\n\n  });\n}\n\nconst SCALE_ANGLE_RATIO_INTENT_DEG = 30;\nconst PINCH_WHEEL_RATIO = 100;\nclass PinchEngine extends Engine {\n  constructor(...args) {\n    super(...args);\n\n    _defineProperty(this, \"ingKey\", 'pinching');\n\n    _defineProperty(this, \"aliasKey\", 'da');\n  }\n\n  init() {\n    this.state.offset = [1, 0];\n    this.state.lastOffset = [1, 0];\n    this.state._pointerEvents = new Map();\n  }\n\n  reset() {\n    super.reset();\n    const state = this.state;\n    state._touchIds = [];\n    state.canceled = false;\n    state.cancel = this.cancel.bind(this);\n    state.turns = 0;\n  }\n\n  computeOffset() {\n    const {\n      type,\n      movement,\n      lastOffset\n    } = this.state;\n\n    if (type === 'wheel') {\n      this.state.offset = V.add(movement, lastOffset);\n    } else {\n      this.state.offset = [(1 + movement[0]) * lastOffset[0], movement[1] + lastOffset[1]];\n    }\n  }\n\n  computeMovement() {\n    const {\n      offset,\n      lastOffset\n    } = this.state;\n    this.state.movement = [offset[0] / lastOffset[0], offset[1] - lastOffset[1]];\n  }\n\n  axisIntent() {\n    const state = this.state;\n    const [_m0, _m1] = state._movement;\n\n    if (!state.axis) {\n      const axisMovementDifference = Math.abs(_m0) * SCALE_ANGLE_RATIO_INTENT_DEG - Math.abs(_m1);\n      if (axisMovementDifference < 0) state.axis = 'angle';else if (axisMovementDifference > 0) state.axis = 'scale';\n    }\n  }\n\n  restrictToAxis(v) {\n    if (this.config.lockDirection) {\n      if (this.state.axis === 'scale') v[1] = 0;else if (this.state.axis === 'angle') v[0] = 0;\n    }\n  }\n\n  cancel() {\n    const state = this.state;\n    if (state.canceled) return;\n    setTimeout(() => {\n      state.canceled = true;\n      state._active = false;\n      this.compute();\n      this.emit();\n    }, 0);\n  }\n\n  touchStart(event) {\n    this.ctrl.setEventIds(event);\n    const state = this.state;\n    const ctrlTouchIds = this.ctrl.touchIds;\n\n    if (state._active) {\n      if (state._touchIds.every(id => ctrlTouchIds.has(id))) return;\n    }\n\n    if (ctrlTouchIds.size < 2) return;\n    this.start(event);\n    state._touchIds = Array.from(ctrlTouchIds).slice(0, 2);\n    const payload = touchDistanceAngle(event, state._touchIds);\n    this.pinchStart(event, payload);\n  }\n\n  pointerStart(event) {\n    if (event.buttons != null && event.buttons % 2 !== 1) return;\n    this.ctrl.setEventIds(event);\n    event.target.setPointerCapture(event.pointerId);\n    const state = this.state;\n    const _pointerEvents = state._pointerEvents;\n    const ctrlPointerIds = this.ctrl.pointerIds;\n\n    if (state._active) {\n      if (Array.from(_pointerEvents.keys()).every(id => ctrlPointerIds.has(id))) return;\n    }\n\n    if (_pointerEvents.size < 2) {\n      _pointerEvents.set(event.pointerId, event);\n    }\n\n    if (state._pointerEvents.size < 2) return;\n    this.start(event);\n    const payload = distanceAngle(...Array.from(_pointerEvents.values()));\n    this.pinchStart(event, payload);\n  }\n\n  pinchStart(event, payload) {\n    const state = this.state;\n    state.origin = payload.origin;\n    this.computeValues([payload.distance, payload.angle]);\n    this.computeInitial();\n    this.compute(event);\n    this.emit();\n  }\n\n  touchMove(event) {\n    if (!this.state._active) return;\n    const payload = touchDistanceAngle(event, this.state._touchIds);\n    this.pinchMove(event, payload);\n  }\n\n  pointerMove(event) {\n    const _pointerEvents = this.state._pointerEvents;\n\n    if (_pointerEvents.has(event.pointerId)) {\n      _pointerEvents.set(event.pointerId, event);\n    }\n\n    if (!this.state._active) return;\n    const payload = distanceAngle(...Array.from(_pointerEvents.values()));\n    this.pinchMove(event, payload);\n  }\n\n  pinchMove(event, payload) {\n    const state = this.state;\n    const prev_a = state._values[1];\n    const delta_a = payload.angle - prev_a;\n    let delta_turns = 0;\n    if (Math.abs(delta_a) > 270) delta_turns += Math.sign(delta_a);\n    this.computeValues([payload.distance, payload.angle - 360 * delta_turns]);\n    state.origin = payload.origin;\n    state.turns = delta_turns;\n    state._movement = [state._values[0] / state._initial[0] - 1, state._values[1] - state._initial[1]];\n    this.compute(event);\n    this.emit();\n  }\n\n  touchEnd(event) {\n    this.ctrl.setEventIds(event);\n    if (!this.state._active) return;\n\n    if (this.state._touchIds.some(id => !this.ctrl.touchIds.has(id))) {\n      this.state._active = false;\n      this.compute(event);\n      this.emit();\n    }\n  }\n\n  pointerEnd(event) {\n    const state = this.state;\n    this.ctrl.setEventIds(event);\n\n    try {\n      event.target.releasePointerCapture(event.pointerId);\n    } catch (_unused) {}\n\n    if (state._pointerEvents.has(event.pointerId)) {\n      state._pointerEvents.delete(event.pointerId);\n    }\n\n    if (!state._active) return;\n\n    if (state._pointerEvents.size < 2) {\n      state._active = false;\n      this.compute(event);\n      this.emit();\n    }\n  }\n\n  gestureStart(event) {\n    if (event.cancelable) event.preventDefault();\n    const state = this.state;\n    if (state._active) return;\n    this.start(event);\n    this.computeValues([event.scale, event.rotation]);\n    state.origin = [event.clientX, event.clientY];\n    this.compute(event);\n    this.emit();\n  }\n\n  gestureMove(event) {\n    if (event.cancelable) event.preventDefault();\n    if (!this.state._active) return;\n    const state = this.state;\n    this.computeValues([event.scale, event.rotation]);\n    state.origin = [event.clientX, event.clientY];\n    const _previousMovement = state._movement;\n    state._movement = [event.scale - 1, event.rotation];\n    state._delta = V.sub(state._movement, _previousMovement);\n    this.compute(event);\n    this.emit();\n  }\n\n  gestureEnd(event) {\n    if (!this.state._active) return;\n    this.state._active = false;\n    this.compute(event);\n    this.emit();\n  }\n\n  wheel(event) {\n    const modifierKey = this.config.modifierKey;\n    if (modifierKey && !event[modifierKey]) return;\n    if (!this.state._active) this.wheelStart(event);else this.wheelChange(event);\n    this.timeoutStore.add('wheelEnd', this.wheelEnd.bind(this));\n  }\n\n  wheelStart(event) {\n    this.start(event);\n    this.wheelChange(event);\n  }\n\n  wheelChange(event) {\n    const isR3f = ('uv' in event);\n\n    if (!isR3f) {\n      if (event.cancelable) {\n        event.preventDefault();\n      }\n\n      if (process.env.NODE_ENV === 'development' && !event.defaultPrevented) {\n        console.warn(`[@use-gesture]: To properly support zoom on trackpads, try using the \\`target\\` option.\\n\\nThis message will only appear in development mode.`);\n      }\n    }\n\n    const state = this.state;\n    state._delta = [-wheelValues(event)[1] / PINCH_WHEEL_RATIO * state.offset[0], 0];\n    V.addTo(state._movement, state._delta);\n    this.state.origin = [event.clientX, event.clientY];\n    this.compute(event);\n    this.emit();\n  }\n\n  wheelEnd() {\n    if (!this.state._active) return;\n    this.state._active = false;\n    this.compute();\n    this.emit();\n  }\n\n  bind(bindFunction) {\n    const device = this.config.device;\n\n    if (!!device) {\n      bindFunction(device, 'start', this[device + 'Start'].bind(this));\n      bindFunction(device, 'change', this[device + 'Move'].bind(this));\n      bindFunction(device, 'end', this[device + 'End'].bind(this));\n      bindFunction(device, 'cancel', this[device + 'End'].bind(this));\n    }\n\n    bindFunction('wheel', '', this.wheel.bind(this), {\n      passive: false\n    });\n  }\n\n}\n\nconst pinchConfigResolver = _objectSpread2(_objectSpread2({}, commonConfigResolver), {}, {\n  device(_v, _k, {\n    shared,\n    pointer: {\n      touch = false\n    } = {}\n  }) {\n    const sharedConfig = shared;\n    if (sharedConfig.target && !SUPPORT.touch && SUPPORT.gesture) return 'gesture';\n    if (SUPPORT.touch && touch) return 'touch';\n\n    if (SUPPORT.touchscreen) {\n      if (SUPPORT.pointer) return 'pointer';\n      if (SUPPORT.touch) return 'touch';\n    }\n  },\n\n  bounds(_v, _k, {\n    scaleBounds = {},\n    angleBounds = {}\n  }) {\n    const _scaleBounds = state => {\n      const D = assignDefault(call(scaleBounds, state), {\n        min: -Infinity,\n        max: Infinity\n      });\n      return [D.min, D.max];\n    };\n\n    const _angleBounds = state => {\n      const A = assignDefault(call(angleBounds, state), {\n        min: -Infinity,\n        max: Infinity\n      });\n      return [A.min, A.max];\n    };\n\n    if (typeof scaleBounds !== 'function' && typeof angleBounds !== 'function') return [_scaleBounds(), _angleBounds()];\n    return state => [_scaleBounds(state), _angleBounds(state)];\n  },\n\n  threshold(value, _k, config) {\n    this.lockDirection = config.axis === 'lock';\n    const threshold = V.toVector(value, this.lockDirection ? [0.1, 3] : 0);\n    return threshold;\n  },\n\n  modifierKey(value) {\n    if (value === undefined) return 'ctrlKey';\n    return value;\n  }\n\n});\n\nclass MoveEngine extends CoordinatesEngine {\n  constructor(...args) {\n    super(...args);\n\n    _defineProperty(this, \"ingKey\", 'moving');\n  }\n\n  move(event) {\n    if (this.config.mouseOnly && event.pointerType !== 'mouse') return;\n    if (!this.state._active) this.moveStart(event);else this.moveChange(event);\n    this.timeoutStore.add('moveEnd', this.moveEnd.bind(this));\n  }\n\n  moveStart(event) {\n    this.start(event);\n    this.computeValues(pointerValues(event));\n    this.compute(event);\n    this.computeInitial();\n    this.emit();\n  }\n\n  moveChange(event) {\n    if (!this.state._active) return;\n    const values = pointerValues(event);\n    const state = this.state;\n    state._delta = V.sub(values, state._values);\n    V.addTo(state._movement, state._delta);\n    this.computeValues(values);\n    this.compute(event);\n    this.emit();\n  }\n\n  moveEnd(event) {\n    if (!this.state._active) return;\n    this.state._active = false;\n    this.compute(event);\n    this.emit();\n  }\n\n  bind(bindFunction) {\n    bindFunction('pointer', 'change', this.move.bind(this));\n    bindFunction('pointer', 'leave', this.moveEnd.bind(this));\n  }\n\n}\n\nconst moveConfigResolver = _objectSpread2(_objectSpread2({}, coordinatesConfigResolver), {}, {\n  mouseOnly: (value = true) => value\n});\n\nclass ScrollEngine extends CoordinatesEngine {\n  constructor(...args) {\n    super(...args);\n\n    _defineProperty(this, \"ingKey\", 'scrolling');\n  }\n\n  scroll(event) {\n    if (!this.state._active) this.start(event);\n    this.scrollChange(event);\n    this.timeoutStore.add('scrollEnd', this.scrollEnd.bind(this));\n  }\n\n  scrollChange(event) {\n    if (event.cancelable) event.preventDefault();\n    const state = this.state;\n    const values = scrollValues(event);\n    state._delta = V.sub(values, state._values);\n    V.addTo(state._movement, state._delta);\n    this.computeValues(values);\n    this.compute(event);\n    this.emit();\n  }\n\n  scrollEnd() {\n    if (!this.state._active) return;\n    this.state._active = false;\n    this.compute();\n    this.emit();\n  }\n\n  bind(bindFunction) {\n    bindFunction('scroll', '', this.scroll.bind(this));\n  }\n\n}\n\nconst scrollConfigResolver = coordinatesConfigResolver;\n\nclass WheelEngine extends CoordinatesEngine {\n  constructor(...args) {\n    super(...args);\n\n    _defineProperty(this, \"ingKey\", 'wheeling');\n  }\n\n  wheel(event) {\n    if (!this.state._active) this.start(event);\n    this.wheelChange(event);\n    this.timeoutStore.add('wheelEnd', this.wheelEnd.bind(this));\n  }\n\n  wheelChange(event) {\n    const state = this.state;\n    state._delta = wheelValues(event);\n    V.addTo(state._movement, state._delta);\n    const [ox, oy] = state.overflow;\n    const [dx, dy] = state._delta;\n    const [dirx, diry] = state._direction;\n\n    if (ox < 0 && dx > 0 && dirx < 0 || ox > 0 && dx < 0 && dirx > 0) {\n      state._movement[0] = state._movementBound[0];\n    }\n\n    if (oy < 0 && dy > 0 && diry < 0 || oy > 0 && dy < 0 && diry > 0) {\n      state._movement[1] = state._movementBound[1];\n    }\n\n    this.compute(event);\n    this.emit();\n  }\n\n  wheelEnd() {\n    if (!this.state._active) return;\n    this.state._active = false;\n    this.compute();\n    this.emit();\n  }\n\n  bind(bindFunction) {\n    bindFunction('wheel', '', this.wheel.bind(this));\n  }\n\n}\n\nconst wheelConfigResolver = coordinatesConfigResolver;\n\nclass HoverEngine extends CoordinatesEngine {\n  constructor(...args) {\n    super(...args);\n\n    _defineProperty(this, \"ingKey\", 'hovering');\n  }\n\n  enter(event) {\n    if (this.config.mouseOnly && event.pointerType !== 'mouse') return;\n    this.start(event);\n    this.computeValues(pointerValues(event));\n    this.compute(event);\n    this.emit();\n  }\n\n  leave(event) {\n    if (this.config.mouseOnly && event.pointerType !== 'mouse') return;\n    const state = this.state;\n    if (!state._active) return;\n    state._active = false;\n    const values = pointerValues(event);\n    state._movement = state._delta = V.sub(values, state._values);\n    this.computeValues(values);\n    this.compute(event);\n    state.delta = state.movement;\n    this.emit();\n  }\n\n  bind(bindFunction) {\n    bindFunction('pointer', 'enter', this.enter.bind(this));\n    bindFunction('pointer', 'leave', this.leave.bind(this));\n  }\n\n}\n\nconst hoverConfigResolver = _objectSpread2(_objectSpread2({}, coordinatesConfigResolver), {}, {\n  mouseOnly: (value = true) => value\n});\n\nconst EngineMap = new Map();\nconst ConfigResolverMap = new Map();\nfunction registerAction(action) {\n  EngineMap.set(action.key, action.engine);\n  ConfigResolverMap.set(action.key, action.resolver);\n}\nconst dragAction = {\n  key: 'drag',\n  engine: DragEngine,\n  resolver: dragConfigResolver\n};\nconst hoverAction = {\n  key: 'hover',\n  engine: HoverEngine,\n  resolver: hoverConfigResolver\n};\nconst moveAction = {\n  key: 'move',\n  engine: MoveEngine,\n  resolver: moveConfigResolver\n};\nconst pinchAction = {\n  key: 'pinch',\n  engine: PinchEngine,\n  resolver: pinchConfigResolver\n};\nconst scrollAction = {\n  key: 'scroll',\n  engine: ScrollEngine,\n  resolver: scrollConfigResolver\n};\nconst wheelAction = {\n  key: 'wheel',\n  engine: WheelEngine,\n  resolver: wheelConfigResolver\n};\n\nexport { ConfigResolverMap as C, EngineMap as E, SUPPORT as S, _objectSpread2 as _, _defineProperty as a, touchIds as b, chain as c, toHandlerProp as d, dragAction as e, pinchAction as f, hoverAction as h, isTouch as i, moveAction as m, parseProp as p, registerAction as r, scrollAction as s, toDomEventType as t, wheelAction as w };\n","import { S as SUPPORT, C as ConfigResolverMap, _ as _objectSpread2, a as _defineProperty, t as toDomEventType, i as isTouch, b as touchIds, E as EngineMap, c as chain, p as parseProp, d as toHandlerProp } from './actions-aeda4790.esm.js';\nimport './maths-b2a210f4.esm.js';\n\nfunction _objectWithoutPropertiesLoose(source, excluded) {\n  if (source == null) return {};\n  var target = {};\n  var sourceKeys = Object.keys(source);\n  var key, i;\n\n  for (i = 0; i < sourceKeys.length; i++) {\n    key = sourceKeys[i];\n    if (excluded.indexOf(key) >= 0) continue;\n    target[key] = source[key];\n  }\n\n  return target;\n}\n\nfunction _objectWithoutProperties(source, excluded) {\n  if (source == null) return {};\n  var target = _objectWithoutPropertiesLoose(source, excluded);\n  var key, i;\n\n  if (Object.getOwnPropertySymbols) {\n    var sourceSymbolKeys = Object.getOwnPropertySymbols(source);\n\n    for (i = 0; i < sourceSymbolKeys.length; i++) {\n      key = sourceSymbolKeys[i];\n      if (excluded.indexOf(key) >= 0) continue;\n      if (!Object.prototype.propertyIsEnumerable.call(source, key)) continue;\n      target[key] = source[key];\n    }\n  }\n\n  return target;\n}\n\nconst sharedConfigResolver = {\n  target(value) {\n    if (value) {\n      return () => 'current' in value ? value.current : value;\n    }\n\n    return undefined;\n  },\n\n  enabled(value = true) {\n    return value;\n  },\n\n  window(value = SUPPORT.isBrowser ? window : undefined) {\n    return value;\n  },\n\n  eventOptions({\n    passive = true,\n    capture = false\n  } = {}) {\n    return {\n      passive,\n      capture\n    };\n  },\n\n  transform(value) {\n    return value;\n  }\n\n};\n\nconst _excluded = [\"target\", \"eventOptions\", \"window\", \"enabled\", \"transform\"];\nfunction resolveWith(config = {}, resolvers) {\n  const result = {};\n\n  for (const [key, resolver] of Object.entries(resolvers)) {\n    switch (typeof resolver) {\n      case 'function':\n        if (process.env.NODE_ENV === 'development') {\n          const r = resolver.call(result, config[key], key, config);\n          if (!Number.isNaN(r)) result[key] = r;\n        } else {\n          result[key] = resolver.call(result, config[key], key, config);\n        }\n\n        break;\n\n      case 'object':\n        result[key] = resolveWith(config[key], resolver);\n        break;\n\n      case 'boolean':\n        if (resolver) result[key] = config[key];\n        break;\n    }\n  }\n\n  return result;\n}\nfunction parse(newConfig, gestureKey, _config = {}) {\n  const _ref = newConfig,\n        {\n    target,\n    eventOptions,\n    window,\n    enabled,\n    transform\n  } = _ref,\n        rest = _objectWithoutProperties(_ref, _excluded);\n\n  _config.shared = resolveWith({\n    target,\n    eventOptions,\n    window,\n    enabled,\n    transform\n  }, sharedConfigResolver);\n\n  if (gestureKey) {\n    const resolver = ConfigResolverMap.get(gestureKey);\n    _config[gestureKey] = resolveWith(_objectSpread2({\n      shared: _config.shared\n    }, rest), resolver);\n  } else {\n    for (const key in rest) {\n      const resolver = ConfigResolverMap.get(key);\n\n      if (resolver) {\n        _config[key] = resolveWith(_objectSpread2({\n          shared: _config.shared\n        }, rest[key]), resolver);\n      } else if (process.env.NODE_ENV === 'development') {\n        if (!['drag', 'pinch', 'scroll', 'wheel', 'move', 'hover'].includes(key)) {\n          if (key === 'domTarget') {\n            throw Error(`[@use-gesture]: \\`domTarget\\` option has been renamed to \\`target\\`.`);\n          }\n\n          console.warn(`[@use-gesture]: Unknown config key \\`${key}\\` was used. Please read the documentation for further information.`);\n        }\n      }\n    }\n  }\n\n  return _config;\n}\n\nclass EventStore {\n  constructor(ctrl, gestureKey) {\n    _defineProperty(this, \"_listeners\", new Set());\n\n    this._ctrl = ctrl;\n    this._gestureKey = gestureKey;\n  }\n\n  add(element, device, action, handler, options) {\n    const listeners = this._listeners;\n    const type = toDomEventType(device, action);\n\n    const _options = this._gestureKey ? this._ctrl.config[this._gestureKey].eventOptions : {};\n\n    const eventOptions = _objectSpread2(_objectSpread2({}, _options), options);\n\n    element.addEventListener(type, handler, eventOptions);\n\n    const remove = () => {\n      element.removeEventListener(type, handler, eventOptions);\n      listeners.delete(remove);\n    };\n\n    listeners.add(remove);\n    return remove;\n  }\n\n  clean() {\n    this._listeners.forEach(remove => remove());\n\n    this._listeners.clear();\n  }\n\n}\n\nclass TimeoutStore {\n  constructor() {\n    _defineProperty(this, \"_timeouts\", new Map());\n  }\n\n  add(key, callback, ms = 140, ...args) {\n    this.remove(key);\n\n    this._timeouts.set(key, window.setTimeout(callback, ms, ...args));\n  }\n\n  remove(key) {\n    const timeout = this._timeouts.get(key);\n\n    if (timeout) window.clearTimeout(timeout);\n  }\n\n  clean() {\n    this._timeouts.forEach(timeout => void window.clearTimeout(timeout));\n\n    this._timeouts.clear();\n  }\n\n}\n\nclass Controller {\n  constructor(handlers) {\n    _defineProperty(this, \"gestures\", new Set());\n\n    _defineProperty(this, \"_targetEventStore\", new EventStore(this));\n\n    _defineProperty(this, \"gestureEventStores\", {});\n\n    _defineProperty(this, \"gestureTimeoutStores\", {});\n\n    _defineProperty(this, \"handlers\", {});\n\n    _defineProperty(this, \"config\", {});\n\n    _defineProperty(this, \"pointerIds\", new Set());\n\n    _defineProperty(this, \"touchIds\", new Set());\n\n    _defineProperty(this, \"state\", {\n      shared: {\n        shiftKey: false,\n        metaKey: false,\n        ctrlKey: false,\n        altKey: false\n      }\n    });\n\n    resolveGestures(this, handlers);\n  }\n\n  setEventIds(event) {\n    if (isTouch(event)) {\n      this.touchIds = new Set(touchIds(event));\n      return this.touchIds;\n    } else if ('pointerId' in event) {\n      if (event.type === 'pointerup' || event.type === 'pointercancel') this.pointerIds.delete(event.pointerId);else if (event.type === 'pointerdown') this.pointerIds.add(event.pointerId);\n      return this.pointerIds;\n    }\n  }\n\n  applyHandlers(handlers, nativeHandlers) {\n    this.handlers = handlers;\n    this.nativeHandlers = nativeHandlers;\n  }\n\n  applyConfig(config, gestureKey) {\n    this.config = parse(config, gestureKey, this.config);\n  }\n\n  clean() {\n    this._targetEventStore.clean();\n\n    for (const key of this.gestures) {\n      this.gestureEventStores[key].clean();\n      this.gestureTimeoutStores[key].clean();\n    }\n  }\n\n  effect() {\n    if (this.config.shared.target) this.bind();\n    return () => this._targetEventStore.clean();\n  }\n\n  bind(...args) {\n    const sharedConfig = this.config.shared;\n    const props = {};\n    let target;\n\n    if (sharedConfig.target) {\n      target = sharedConfig.target();\n      if (!target) return;\n    }\n\n    if (sharedConfig.enabled) {\n      for (const gestureKey of this.gestures) {\n        const gestureConfig = this.config[gestureKey];\n        const bindFunction = bindToProps(props, gestureConfig.eventOptions, !!target);\n\n        if (gestureConfig.enabled) {\n          const Engine = EngineMap.get(gestureKey);\n          new Engine(this, args, gestureKey).bind(bindFunction);\n        }\n      }\n\n      const nativeBindFunction = bindToProps(props, sharedConfig.eventOptions, !!target);\n\n      for (const eventKey in this.nativeHandlers) {\n        nativeBindFunction(eventKey, '', event => this.nativeHandlers[eventKey](_objectSpread2(_objectSpread2({}, this.state.shared), {}, {\n          event,\n          args\n        })), undefined, true);\n      }\n    }\n\n    for (const handlerProp in props) {\n      props[handlerProp] = chain(...props[handlerProp]);\n    }\n\n    if (!target) return props;\n\n    for (const handlerProp in props) {\n      const {\n        device,\n        capture,\n        passive\n      } = parseProp(handlerProp);\n\n      this._targetEventStore.add(target, device, '', props[handlerProp], {\n        capture,\n        passive\n      });\n    }\n  }\n\n}\n\nfunction setupGesture(ctrl, gestureKey) {\n  ctrl.gestures.add(gestureKey);\n  ctrl.gestureEventStores[gestureKey] = new EventStore(ctrl, gestureKey);\n  ctrl.gestureTimeoutStores[gestureKey] = new TimeoutStore();\n}\n\nfunction resolveGestures(ctrl, internalHandlers) {\n  if (internalHandlers.drag) setupGesture(ctrl, 'drag');\n  if (internalHandlers.wheel) setupGesture(ctrl, 'wheel');\n  if (internalHandlers.scroll) setupGesture(ctrl, 'scroll');\n  if (internalHandlers.move) setupGesture(ctrl, 'move');\n  if (internalHandlers.pinch) setupGesture(ctrl, 'pinch');\n  if (internalHandlers.hover) setupGesture(ctrl, 'hover');\n}\n\nconst bindToProps = (props, eventOptions, withPassiveOption) => (device, action, handler, options = {}, isNative = false) => {\n  var _options$capture, _options$passive;\n\n  const capture = (_options$capture = options.capture) !== null && _options$capture !== void 0 ? _options$capture : eventOptions.capture;\n  const passive = (_options$passive = options.passive) !== null && _options$passive !== void 0 ? _options$passive : eventOptions.passive;\n  let handlerProp = isNative ? device : toHandlerProp(device, action, capture);\n  if (withPassiveOption && passive) handlerProp += 'Passive';\n  props[handlerProp] = props[handlerProp] || [];\n  props[handlerProp].push(handler);\n};\n\nconst RE_NOT_NATIVE = /^on(Drag|Wheel|Scroll|Move|Pinch|Hover)/;\n\nfunction sortHandlers(_handlers) {\n  const native = {};\n  const handlers = {};\n  const actions = new Set();\n\n  for (let key in _handlers) {\n    if (RE_NOT_NATIVE.test(key)) {\n      actions.add(RegExp.lastMatch);\n      handlers[key] = _handlers[key];\n    } else {\n      native[key] = _handlers[key];\n    }\n  }\n\n  return [handlers, native, actions];\n}\n\nfunction registerGesture(actions, handlers, handlerKey, key, internalHandlers, config) {\n  if (!actions.has(handlerKey)) return;\n\n  if (!EngineMap.has(key)) {\n    if (process.env.NODE_ENV === 'development') {\n      console.warn(`[@use-gesture]: You've created a custom handler that that uses the \\`${key}\\` gesture but isn't properly configured.\\n\\nPlease add \\`${key}Action\\` when creating your handler.`);\n    }\n\n    return;\n  }\n\n  const startKey = handlerKey + 'Start';\n  const endKey = handlerKey + 'End';\n\n  const fn = state => {\n    let memo = undefined;\n    if (state.first && startKey in handlers) handlers[startKey](state);\n    if (handlerKey in handlers) memo = handlers[handlerKey](state);\n    if (state.last && endKey in handlers) handlers[endKey](state);\n    return memo;\n  };\n\n  internalHandlers[key] = fn;\n  config[key] = config[key] || {};\n}\n\nfunction parseMergedHandlers(mergedHandlers, mergedConfig) {\n  const [handlers, nativeHandlers, actions] = sortHandlers(mergedHandlers);\n  const internalHandlers = {};\n  registerGesture(actions, handlers, 'onDrag', 'drag', internalHandlers, mergedConfig);\n  registerGesture(actions, handlers, 'onWheel', 'wheel', internalHandlers, mergedConfig);\n  registerGesture(actions, handlers, 'onScroll', 'scroll', internalHandlers, mergedConfig);\n  registerGesture(actions, handlers, 'onPinch', 'pinch', internalHandlers, mergedConfig);\n  registerGesture(actions, handlers, 'onMove', 'move', internalHandlers, mergedConfig);\n  registerGesture(actions, handlers, 'onHover', 'hover', internalHandlers, mergedConfig);\n  return {\n    handlers: internalHandlers,\n    config: mergedConfig,\n    nativeHandlers\n  };\n}\n\nexport { Controller, parseMergedHandlers };\n","import { registerAction, dragAction, pinchAction, wheelAction, scrollAction, moveAction, hoverAction } from '@use-gesture/core/actions';\nexport * from '@use-gesture/core/actions';\nimport React from 'react';\nimport { Controller, parseMergedHandlers } from '@use-gesture/core';\nexport * from '@use-gesture/core/utils';\nexport * from '@use-gesture/core/types';\n\nfunction useRecognizers(handlers, config = {}, gestureKey, nativeHandlers) {\n  const ctrl = React.useMemo(() => new Controller(handlers), []);\n  ctrl.applyHandlers(handlers, nativeHandlers);\n  ctrl.applyConfig(config, gestureKey);\n  React.useEffect(ctrl.effect.bind(ctrl));\n  React.useEffect(() => {\n    return ctrl.clean.bind(ctrl);\n  }, []);\n\n  if (config.target === undefined) {\n    return ctrl.bind.bind(ctrl);\n  }\n\n  return undefined;\n}\n\nfunction useDrag(handler, config) {\n  registerAction(dragAction);\n  return useRecognizers({\n    drag: handler\n  }, config || {}, 'drag');\n}\n\nfunction usePinch(handler, config) {\n  registerAction(pinchAction);\n  return useRecognizers({\n    pinch: handler\n  }, config || {}, 'pinch');\n}\n\nfunction useWheel(handler, config) {\n  registerAction(wheelAction);\n  return useRecognizers({\n    wheel: handler\n  }, config || {}, 'wheel');\n}\n\nfunction useScroll(handler, config) {\n  registerAction(scrollAction);\n  return useRecognizers({\n    scroll: handler\n  }, config || {}, 'scroll');\n}\n\nfunction useMove(handler, config) {\n  registerAction(moveAction);\n  return useRecognizers({\n    move: handler\n  }, config || {}, 'move');\n}\n\nfunction useHover(handler, config) {\n  registerAction(hoverAction);\n  return useRecognizers({\n    hover: handler\n  }, config || {}, 'hover');\n}\n\nfunction createUseGesture(actions) {\n  actions.forEach(registerAction);\n  return function useGesture(_handlers, _config) {\n    const {\n      handlers,\n      nativeHandlers,\n      config\n    } = parseMergedHandlers(_handlers, _config || {});\n    return useRecognizers(handlers, config, undefined, nativeHandlers);\n  };\n}\n\nfunction useGesture(handlers, config) {\n  const hook = createUseGesture([dragAction, pinchAction, scrollAction, wheelAction, moveAction, hoverAction]);\n  return hook(handlers, config || {});\n}\n\nexport { createUseGesture, useDrag, useGesture, useHover, useMove, usePinch, useScroll, useWheel };\n","import React from 'react';\n\ntype NativeEvent =\n  | React.PointerEvent\n  | PointerEvent\n  | React.DragEvent<HTMLElement>\n  | DragEvent;\n\nexport interface InteractableEvent {\n  x: number;\n  y: number;\n  deltaX: number;\n  deltaY: number;\n  rect: InteractableRect;\n  nativeEvent: NativeEvent;\n}\n\nexport interface InteractableRect {\n  left: number;\n  top: number;\n  width: number;\n  height: number;\n  angle?: number;\n}\n\nexport function interactableEvent({\n  e,\n  rect,\n  deltaX,\n  deltaY,\n}: {\n  e: NativeEvent;\n  rect: InteractableRect;\n  deltaX?: number;\n  deltaY?: number;\n}): InteractableEvent {\n  return {\n    rect,\n    x: e.clientX,\n    y: e.clientY,\n    deltaX: deltaX ?? 0,\n    deltaY: deltaY ?? 0,\n    nativeEvent: e,\n  };\n}\n","import React, {HTMLAttributes, useRef} from 'react';\nimport {createEventHandler} from '../../utils/dom/create-event-handler';\nimport {useGlobalListeners} from '@react-aria/utils';\n\ninterface PointerState {\n  lastPosition: {x: number; y: number};\n  id?: number;\n  started: boolean;\n  el?: HTMLElement;\n  originalTouchAction?: string;\n  originalUserSelect?: string;\n  longPressTimer?: any;\n  longPressTriggered?: boolean;\n}\n\ninterface UsePointerEventsReturn {\n  domProps: HTMLAttributes<HTMLElement>;\n}\n\nexport interface UsePointerEventsProps {\n  onMoveStart?: (e: PointerEvent, el: HTMLElement) => false | void;\n  onMove?: (e: PointerEvent, deltaX: number, deltaY: number) => void;\n  onMoveEnd?: (e: PointerEvent) => void;\n  onPointerDown?: (e: React.PointerEvent) => void | false;\n  onPointerUp?: (e: PointerEvent, el: HTMLElement) => void;\n  onPress?: (e: PointerEvent, el: HTMLElement) => void;\n  onLongPress?: (e: PointerEvent | React.PointerEvent, el: HTMLElement) => void;\n  preventDefault?: boolean;\n  stopPropagation?: boolean;\n  minimumMovement?: number;\n}\nexport function usePointerEvents({\n  onMoveStart,\n  onMove,\n  onMoveEnd,\n  minimumMovement = 0,\n  preventDefault,\n  stopPropagation = true,\n  onPress,\n  onLongPress,\n  ...props\n}: UsePointerEventsProps): UsePointerEventsReturn {\n  const stateRef = useRef<PointerState>({\n    lastPosition: {x: 0, y: 0},\n    started: false,\n    longPressTriggered: false,\n  });\n  const state = stateRef.current;\n\n  const {addGlobalListener, removeGlobalListener} = useGlobalListeners();\n\n  const start = (e: PointerEvent) => {\n    if (!state.el) return;\n    const result = onMoveStart?.(e, state.el);\n\n    // allow user to cancel interaction\n    if (result === false) return;\n\n    state.originalTouchAction = state.el.style.touchAction;\n    state.el.style.touchAction = 'none';\n    state.originalUserSelect = document.documentElement.style.userSelect;\n    document.documentElement.style.userSelect = 'none';\n    state.started = true;\n  };\n\n  const onPointerDown = (e: React.PointerEvent) => {\n    if (e.button === 0 && state.id == null) {\n      state.started = false;\n\n      const result = props.onPointerDown?.(e);\n      if (result === false) return;\n\n      if (stopPropagation) {\n        e.stopPropagation();\n      }\n      if (preventDefault) {\n        e.preventDefault();\n      }\n      state.id = e.pointerId;\n      state.el = e.currentTarget as HTMLElement;\n      state.lastPosition = {x: e.clientX, y: e.clientY};\n\n      // use global listeners, so we don't have to capture pointer,\n      // which would prevent click events on child nodes\n\n      if (onLongPress) {\n        state.longPressTimer = setTimeout(() => {\n          onLongPress(e, state.el!);\n          state.longPressTriggered = true;\n        }, 400);\n      }\n\n      if (onMoveStart || onMove) {\n        addGlobalListener(window, 'pointermove', onPointerMove, false);\n      }\n      addGlobalListener(window, 'pointerup', onPointerUp, false);\n      addGlobalListener(window, 'pointercancel', onPointerUp, false);\n    }\n  };\n\n  const onPointerMove = (e: PointerEvent) => {\n    if (e.pointerId === state.id) {\n      const deltaX = e.clientX - state.lastPosition.x;\n      const deltaY = e.clientY - state.lastPosition.y;\n\n      if (\n        (Math.abs(deltaX) >= minimumMovement ||\n          Math.abs(deltaY) >= minimumMovement) &&\n        !state.started\n      ) {\n        start(e);\n      }\n\n      if (state.started) {\n        onMove?.(e, deltaX, deltaY);\n        state.lastPosition = {x: e.clientX, y: e.clientY};\n      }\n    }\n  };\n\n  const onPointerUp = (e: PointerEvent) => {\n    if (e.pointerId === state.id) {\n      // cancel long press timer, if exists\n      if (state.longPressTimer) {\n        clearTimeout(state.longPressTimer);\n      }\n\n      const longPressTriggered = state.longPressTriggered;\n      state.longPressTriggered = false;\n\n      // only call onMoveEnd if we actually started moving\n      if (state.started) {\n        onMoveEnd?.(e);\n      }\n\n      if (state.el) {\n        // handle press only if event was not cancelled (via touch scroll on mobile for example)\n        if (e.type !== 'pointercancel') {\n          props.onPointerUp?.(e, state.el);\n\n          // only call onPress if pointer did not leave onPointerDown element\n          if (e.target && state.el.contains(e.target as HTMLElement)) {\n            // trigger either onPress or onLongPress\n            if (longPressTriggered) {\n              onLongPress?.(e, state.el);\n            } else {\n              onPress?.(e, state.el);\n            }\n          }\n        }\n\n        document.documentElement.style.userSelect =\n          state.originalUserSelect || '';\n        state.el.style.touchAction = state.originalTouchAction || '';\n      }\n      state.id = undefined;\n      state.started = false;\n      removeGlobalListener(window, 'pointermove', onPointerMove, false);\n      removeGlobalListener(window, 'pointerup', onPointerUp, false);\n      removeGlobalListener(window, 'pointercancel', onPointerUp, false);\n    }\n  };\n\n  return {\n    domProps: {\n      onPointerDown: createEventHandler(onPointerDown),\n    },\n  };\n}\n","import {InteractableRect} from '../interactable-event';\n\nexport function restrictResizableWithinBoundary(\n  rect: InteractableRect,\n  boundaryRect: InteractableRect\n) {\n  const boundedRect = {...rect};\n\n  // restrict to left edge of boundary\n  boundedRect.left = Math.max(0, boundedRect.left);\n  // compensate width when left is bounded\n  const leftRestriction = boundedRect.left - rect.left;\n  if (leftRestriction > 0) {\n    boundedRect.width -= leftRestriction;\n  }\n\n  // restrict to top edge of boundary\n  boundedRect.top = Math.max(0, boundedRect.top);\n  // compensate height when top is bounded\n  const topRestriction = boundedRect.top - rect.top;\n  if (topRestriction > 0) {\n    boundedRect.height -= topRestriction;\n  }\n\n  // restrict to right edge of boundary\n  boundedRect.width = Math.min(\n    boundedRect.width,\n    boundaryRect.width - boundedRect.left\n  );\n\n  // restrict to bottom edge of boundary\n  boundedRect.height = Math.min(\n    boundedRect.height,\n    boundaryRect.height - boundedRect.top\n  );\n\n  return boundedRect;\n}\n","import {InteractableRect} from '../interactable-event';\n\nexport function domRectToObj(rect: DOMRect): InteractableRect {\n  return {\n    left: rect.left,\n    top: rect.top,\n    width: rect.width,\n    height: rect.height,\n  };\n}\n","import {RefObject} from 'react';\nimport {\n  interactableEvent,\n  InteractableEvent,\n  InteractableRect,\n} from './interactable-event';\nimport {usePointerEvents, UsePointerEventsProps} from './use-pointer-events';\nimport {setActiveInteraction} from './active-interaction';\nimport {calcNewSizeFromAspectRatio} from './utils/calc-new-size-from-aspect-ratio';\nimport {restrictResizableWithinBoundary} from './utils/restrict-resizable-within-boundary';\nimport {domRectToObj} from './utils/dom-rect-to-obj';\n\nexport enum resizeHandlePosition {\n  topLeft = 'topLeft',\n  topRight = 'topRight',\n  bottomLeft = 'bottomLeft',\n  bottomRight = 'bottomRight',\n}\n\ntype AspectRatio = number | null | undefined;\ntype InitialAspectRatio = AspectRatio | 'initial';\n\ninterface ResizeState {\n  currentRect?: InteractableRect;\n  resizeDir?: resizeHandlePosition;\n  initialAspectRatio?: AspectRatio;\n  boundaryRect?: InteractableRect;\n}\n\nlet state: ResizeState = {};\n\nconst resetState = (value: ResizeState = {}) => {\n  setActiveInteraction(null);\n  state = value;\n};\n\ninterface UseResizeProps {\n  boundaryRect?: InteractableRect;\n  boundaryRef?: RefObject<HTMLElement> | null;\n  restrictWithinBoundary?: boolean;\n  aspectRatio?: InitialAspectRatio;\n  onResizeStart?: (e: InteractableEvent) => void;\n  onResize?: (e: InteractableEvent) => void;\n  onResizeEnd?: (e: InteractableEvent) => void;\n  minWidth?: number;\n  minHeight?: number;\n}\nexport function useResize({\n  aspectRatio,\n  boundaryRef,\n  boundaryRect,\n  restrictWithinBoundary = true,\n  minWidth = 50,\n  minHeight = 50,\n  ...props\n}: UseResizeProps) {\n  const pointerProps: UsePointerEventsProps = {\n    onMoveStart: (e, resizable) => {\n      const target = e.target as HTMLElement;\n\n      if (!target.dataset.resizeHandle) {\n        return false;\n      }\n\n      resetState({\n        currentRect: domRectToObj(resizable.getBoundingClientRect()),\n        resizeDir: target.dataset.resizeHandle as resizeHandlePosition,\n      });\n      if (!state.currentRect) {\n        return false;\n      }\n      setActiveInteraction('resize');\n\n      if (boundaryRect) {\n        state.boundaryRect = boundaryRect;\n      } else if (boundaryRef?.current) {\n        state.boundaryRect = domRectToObj(\n          boundaryRef.current.getBoundingClientRect()\n        );\n      }\n\n      // if we have a boundary, x, y will be relative to that boundary, otherwise it will be relative to window\n      if (state.currentRect && state.boundaryRect) {\n        state.currentRect.left -= state.boundaryRect.left;\n        state.currentRect.top -= state.boundaryRect.top;\n      }\n      state.initialAspectRatio =\n        state.currentRect.width / state.currentRect!.height;\n      props.onResizeStart?.(interactableEvent({rect: state.currentRect, e}));\n    },\n    onMove: (e, deltaX, deltaY) => {\n      if (!state.resizeDir || !state.currentRect) return;\n\n      const ratio =\n        aspectRatio === 'initial' ? state.initialAspectRatio : aspectRatio;\n      const newRect = resizeRect(state.currentRect, deltaX, deltaY, ratio);\n      const boundedRect = applyBounds(newRect, minWidth, minHeight, ratio);\n\n      props.onResize?.(\n        interactableEvent({rect: boundedRect, e, deltaX, deltaY})\n      );\n\n      state.currentRect = newRect;\n    },\n    onMoveEnd: e => {\n      if (state.currentRect) {\n        props.onResizeEnd?.(interactableEvent({rect: state.currentRect, e}));\n      }\n      resetState();\n    },\n  };\n\n  const {domProps} = usePointerEvents(pointerProps);\n\n  return {resizeProps: domProps};\n}\n\nfunction resizeRect(\n  rect: InteractableRect,\n  deltaX: number,\n  deltaY: number,\n  ratio: AspectRatio\n): InteractableRect {\n  const prevRect = {...rect};\n  const newRect = {...rect};\n\n  if (state.resizeDir === resizeHandlePosition.topRight) {\n    newRect.width = Math.floor(newRect.width + deltaX);\n    if (ratio) {\n      newRect.height = Math.floor(newRect.width / ratio);\n    } else {\n      newRect.height = Math.floor(newRect.height - deltaY);\n    }\n    newRect.top = Math.floor(newRect.top + (prevRect.height - newRect.height));\n  } else if (state.resizeDir === resizeHandlePosition.bottomRight) {\n    newRect.width = Math.floor(newRect.width + deltaX);\n    if (ratio) {\n      newRect.height = Math.floor(newRect.width / ratio);\n    } else {\n      newRect.height = Math.floor(newRect.height + deltaY);\n    }\n  } else if (state.resizeDir === resizeHandlePosition.topLeft) {\n    newRect.width = Math.floor(newRect.width - deltaX);\n    if (ratio) {\n      newRect.height = Math.floor(newRect.width / ratio);\n    } else {\n      newRect.height = Math.floor(newRect.height - deltaY);\n    }\n    newRect.left = Math.floor(newRect.left + (prevRect.width - newRect.width));\n    newRect.top = Math.floor(newRect.top + (prevRect.height - newRect.height));\n  } else if (state.resizeDir === resizeHandlePosition.bottomLeft) {\n    newRect.width = Math.floor(newRect.width - deltaX);\n    if (ratio) {\n      newRect.height = Math.floor(newRect.width / ratio);\n    } else {\n      newRect.height = Math.floor(newRect.height + deltaY);\n    }\n    newRect.left = Math.floor(newRect.left + deltaX);\n  }\n\n  return newRect;\n}\n\nfunction applyBounds(\n  rect: InteractableRect,\n  minWidth: number,\n  minHeight: number,\n  ratio: AspectRatio\n): InteractableRect {\n  const isLeftSideHandle =\n    state.resizeDir === resizeHandlePosition.bottomLeft ||\n    state.resizeDir === resizeHandlePosition.topLeft;\n  const isTopSideHandle =\n    state.resizeDir === resizeHandlePosition.topRight ||\n    state.resizeDir === resizeHandlePosition.topLeft;\n\n  // bound width and height\n  let boundedRect = {...rect};\n  boundedRect.width = Math.max(minWidth, rect.width);\n  boundedRect.height = Math.max(minHeight, rect.height);\n\n  // compensate left when width is bounded\n  const widthRestriction = boundedRect.width - rect.width;\n  if (isLeftSideHandle && widthRestriction > 0) {\n    boundedRect.left -= widthRestriction;\n  }\n\n  // compensate top when height is bounded\n  const heightRestriction = boundedRect.height - rect.height;\n  if (isTopSideHandle && heightRestriction > 0) {\n    boundedRect.top -= heightRestriction;\n  }\n\n  if (state.boundaryRect) {\n    boundedRect = restrictResizableWithinBoundary(\n      boundedRect,\n      state.boundaryRect\n    );\n  }\n\n  if (ratio) {\n    // adjust width/height based on specified aspect ratio\n    const oldWidth = boundedRect.width;\n    const oldHeight = boundedRect.height;\n    const size = calcNewSizeFromAspectRatio(\n      ratio,\n      boundedRect.width,\n      boundedRect.height\n    );\n    boundedRect.width = size.width;\n    boundedRect.height = size.height;\n\n    // compensate top/left that was bound previously\n    if (isTopSideHandle) {\n      boundedRect.top += oldHeight - boundedRect.height;\n    }\n\n    if (isLeftSideHandle) {\n      boundedRect.left += oldWidth - boundedRect.width;\n    }\n  }\n\n  return boundedRect;\n}\n","import {resizeHandlePosition} from '../../common/ui/interactions/use-resize';\n\ntype Props = {\n  position: resizeHandlePosition;\n  inset?: boolean;\n};\n\nexport function CornerHandle({position, inset = false}: Props) {\n  const className = getPositionClass(position, inset);\n  return (\n    <div\n      data-resize-handle={position}\n      className={`border-white absolute w-20 h-20 ${className}`}\n    />\n  );\n}\n\nfunction getPositionClass(\n  position: resizeHandlePosition,\n  inset: boolean\n): string {\n  const left = inset ? 'left-0' : '-left-5';\n  const top = inset ? 'top-0' : '-top-5';\n  const bottom = inset ? 'bottom-0' : '-bottom-5';\n  const right = inset ? 'right-0' : '-right-5';\n  switch (position) {\n    case resizeHandlePosition.topLeft:\n      return `${left} ${top} border-l-4 border-t-4 cursor-nwse-resize`;\n    case resizeHandlePosition.topRight:\n      return `${right} ${top} border-r-4 border-t-4 cursor-nesw-resize`;\n    case resizeHandlePosition.bottomRight:\n      return `${right} ${bottom} border-r-4 border-b-4 cursor-se-resize`;\n    case resizeHandlePosition.bottomLeft:\n      return `${left} ${bottom} border-l-4 border-b-4 cursor-sw-resize`;\n    default:\n      return '';\n  }\n}\n","import {MutableRefObject} from 'react';\nimport {CropzoneRefs} from './cropzone-refs';\n\nexport enum MaskPosition {\n  top = 'maskTop',\n  right = 'maskRight',\n  bottom = 'maskBottom',\n  left = 'maskLeft',\n}\n\ntype Props = {\n  position: MaskPosition;\n  refs: MutableRefObject<CropzoneRefs>;\n};\n\nexport function MaskPart({position, refs}: Props) {\n  const className = getClassNameByPosition(position);\n  return (\n    <div\n      className={`cropzone-transition bg-black/50 bottom absolute ${className}`}\n      ref={el => (refs.current[position] = el)}\n    />\n  );\n}\n\nfunction getClassNameByPosition(position: MaskPosition): string {\n  switch (position) {\n    case MaskPosition.top:\n      return 'left-0 top-0';\n    case MaskPosition.bottom:\n      return 'bottom-0 left-0';\n    default:\n      return '';\n  }\n}\n","import {MutableRefObject} from 'react';\nimport clsx from 'clsx';\nimport {CropzoneRefs} from './cropzone-refs';\n\ntype Props = {\n  name: 'lineVer1' | 'lineVer2' | 'lineHor1' | 'lineHor2';\n  refs: MutableRefObject<CropzoneRefs>;\n};\n\nexport function Line({name, refs}: Props) {\n  const className = clsx(\n    'cropzone-transition pointer-events-none absolute left-0 top-0 bg-white/50',\n    name.startsWith('lineHor') ? 'h-px' : 'w-px'\n  );\n  return (\n    <div\n      className={className}\n      ref={el => {\n        refs.current[name] = el;\n      }}\n    />\n  );\n}\n","export function clamp(num: number, min: number, max: number) {\n  return Math.min(Math.max(num, min), max);\n}\n","import {RefObject} from 'react';\nimport {\n  interactableEvent,\n  InteractableEvent,\n  InteractableRect,\n} from './interactable-event';\nimport {usePointerEvents, UsePointerEventsProps} from './use-pointer-events';\nimport {activeInteraction, setActiveInteraction} from './active-interaction';\nimport {domRectToObj} from './utils/dom-rect-to-obj';\nimport {clamp} from '../../utils/number/clamp';\n\nlet state: {\n  currentRect?: InteractableRect;\n  boundaryRect?: InteractableRect;\n} = {};\n\nexport interface UseMoveProps {\n  restrictWithinBoundary?: boolean;\n  minimumMovement?: number;\n  boundaryRef?: RefObject<HTMLElement> | null;\n  boundaryRect?: InteractableRect;\n  onMoveStart?: (e: InteractableEvent) => void;\n  onMove?: (e: InteractableEvent) => void;\n  onMoveEnd?: (e: InteractableEvent) => void;\n}\nexport function useMove({\n  boundaryRef,\n  boundaryRect,\n  minimumMovement,\n  restrictWithinBoundary = true,\n  ...props\n}: UseMoveProps) {\n  const pointerProps: UsePointerEventsProps = {\n    minimumMovement,\n    onMoveStart: (e, el) => {\n      if (activeInteraction) {\n        return false;\n      }\n      state = {\n        currentRect: domRectToObj(el.getBoundingClientRect()),\n      };\n\n      setActiveInteraction('move');\n\n      if (boundaryRect) {\n        state.boundaryRect = boundaryRect;\n      } else if (boundaryRef?.current) {\n        state.boundaryRect = domRectToObj(\n          boundaryRef.current.getBoundingClientRect()\n        );\n      }\n\n      // if we have a boundary, x, y will be relative to that boundary, otherwise it will be relative to window\n      if (state.currentRect && state.boundaryRect) {\n        state.currentRect.left -= state.boundaryRect.left;\n        state.currentRect.top -= state.boundaryRect.top;\n      }\n\n      props.onMoveStart?.(interactableEvent({rect: state.currentRect!, e}));\n    },\n    onMove: (e, deltaX, deltaY) => {\n      if (!state.currentRect) return;\n\n      const newRect = {\n        ...state.currentRect,\n        left: state.currentRect.left + deltaX,\n        top: state.currentRect.top + deltaY,\n      };\n\n      const boundedRect = {...newRect};\n\n      if (state.boundaryRect && restrictWithinBoundary) {\n        boundedRect.left = clamp(\n          newRect.left,\n          0,\n          state.boundaryRect.width - newRect.width\n        );\n        boundedRect.top = clamp(\n          newRect.top,\n          0,\n          state.boundaryRect.height - newRect.height\n        );\n      }\n\n      props.onMove?.(interactableEvent({rect: boundedRect, e, deltaX, deltaY}));\n\n      state.currentRect = newRect;\n    },\n    onMoveEnd: e => {\n      if (!state.currentRect) return;\n      props.onMoveEnd?.(interactableEvent({rect: state.currentRect, e}));\n      setActiveInteraction(null);\n      state = {};\n    },\n  };\n\n  const {domProps} = usePointerEvents(pointerProps);\n  return {moveProps: domProps};\n}\n","import {useLayoutEffect, useRef, useState} from 'react';\nimport clsx from 'clsx';\nimport {CornerHandle} from '../../../../objects/ui/corner-handle';\nimport {useStore} from '../../../../state/store';\nimport {MaskPart, MaskPosition} from './mask-part';\nimport {Line} from './cropzone-line';\nimport {CropzoneRefs} from './cropzone-refs';\nimport {tools} from '../../../../state/utils';\nimport {useMove} from '../../../../common/ui/interactions/use-move';\nimport {\n  resizeHandlePosition,\n  useResize,\n} from '../../../../common/ui/interactions/use-resize';\nimport {mergeProps} from '@react-aria/utils';\nimport {aspectRatioFromStr} from '../../../../common/ui/interactions/utils/calc-new-size-from-aspect-ratio';\n\nexport function Cropzone() {\n  const refs = useRef<CropzoneRefs>({} as CropzoneRefs);\n  const [isMoving, setIsMoving] = useState(true);\n  const boundaryRect = useStore(s => s.canvasSize);\n  const controlConfig = useStore(s => s.config.tools?.crop?.cropzone);\n  const defaultRatio =\n    useStore(s => s.config.tools?.crop?.defaultRatio) || null;\n  const selectedAspectRatio = useStore(s => s.crop.selectedAspectRatio) || null;\n\n  const {moveProps} = useMove({\n    boundaryRect,\n    onMoveStart: () => setIsMoving(true),\n    onMove: e => tools().crop.drawZone(e.rect),\n    onMoveEnd: () => setIsMoving(false),\n  });\n\n  const {resizeProps} = useResize({\n    boundaryRect,\n    minHeight: 50,\n    minWidth: 50,\n    aspectRatio: aspectRatioFromStr(selectedAspectRatio),\n    onResizeStart: () => setIsMoving(true),\n    onResize: e => tools().crop.drawZone(e.rect),\n    onResizeEnd: () => setIsMoving(false),\n  });\n\n  // redraw cropzone if default aspect ratio or canvas size change\n  useLayoutEffect(() => {\n    tools().crop.registerRefs(refs);\n    tools().crop.resetCropzone(defaultRatio);\n  }, [defaultRatio, boundaryRect]);\n\n  const className = clsx(\n    'cropzone absolute z-cropzone isolate left-0 top-0 w-full h-full overflow-hidden',\n    isMoving && 'moving'\n  );\n\n  return (\n    <div\n      className={className}\n      onPointerDown={e => {\n        e.stopPropagation();\n        e.preventDefault();\n      }}\n    >\n      <div\n        className=\"cropzone-transition border-white/50 absolute z-10 left-0 top-0 border\"\n        {...mergeProps(resizeProps, moveProps)}\n        ref={el => (refs.current.innerZone = el)}\n      >\n        {!controlConfig?.hideTopLeft && (\n          <CornerHandle position={resizeHandlePosition.topLeft} inset />\n        )}\n        {!controlConfig?.hideTopRight && (\n          <CornerHandle position={resizeHandlePosition.topRight} inset />\n        )}\n        {!controlConfig?.hideBottomLeft && (\n          <CornerHandle position={resizeHandlePosition.bottomLeft} inset />\n        )}\n        {!controlConfig?.hideBottomRight && (\n          <CornerHandle position={resizeHandlePosition.bottomRight} inset />\n        )}\n\n        <Line name=\"lineVer1\" refs={refs} />\n        <Line name=\"lineVer2\" refs={refs} />\n        <Line name=\"lineHor1\" refs={refs} />\n        <Line name=\"lineHor2\" refs={refs} />\n      </div>\n\n      <MaskPart refs={refs} position={MaskPosition.top} />\n      <MaskPart refs={refs} position={MaskPosition.left} />\n      <MaskPart refs={refs} position={MaskPosition.right} />\n      <MaskPart refs={refs} position={MaskPosition.bottom} />\n    </div>\n  );\n}\n","import React from 'react';\nimport {createSvgIcon} from '../../common/icons/create-svg-icon';\n\nexport const CustomDuplicateIcon = createSvgIcon(\n  <path d=\"M 7 2 C 6.448 2 6 2.448 6 3 C 6 3.552 6.448 4 7 4 L 20 4 L 20 17 C 20 17.552 20.448 18 21 18 C 21.552 18 22 17.552 22 17 L 22 4 C 22 2.895 21.105 2 20 2 L 7 2 z M 4 6 C 2.895 6 2 6.895 2 8 L 2 20 C 2 21.105 2.895 22 4 22 L 16 22 C 17.105 22 18 21.105 18 20 L 18 8 C 18 6.895 17.105 6 16 6 L 4 6 z M 10 10 C 10.552 10 11 10.448 11 11 L 11 13 L 13 13 C 13.552 13 14 13.448 14 14 C 14 14.552 13.552 15 13 15 L 11 15 L 11 17 C 11 17.552 10.552 18 10 18 C 9.448 18 9 17.552 9 17 L 9 15 L 7 15 C 6.448 15 6 14.552 6 14 C 6 13.448 6.448 13 7 13 L 9 13 L 9 11 C 9 10.448 9.448 10 10 10 z\" />\n);\n","import React from 'react';\nimport {createSvgIcon} from '../../common/icons/create-svg-icon';\n\nexport const CustomFlipIcon = createSvgIcon(\n  <path d=\"M 11 3 L 2 21 L 11 21 L 11 3 z M 13 3 L 13 21 L 22 21 L 13 3 z M 9 11.472656 L 9 19 L 5.2363281 19 L 9 11.472656 z\" />\n);\n","import React from 'react';\nimport {createSvgIcon} from '../../common/icons/create-svg-icon';\n\nexport const CustomFrontSortingIcon = createSvgIcon(\n  <path d=\"M 16.476562 2.4511719 C 16.392047 2.4657656 16.308531 2.5061719 16.238281 2.5761719 L 14.130859 4.6835938 C 13.956859 4.8575938 13.956859 5.1394531 14.130859 5.3144531 L 16.238281 7.4238281 C 16.519281 7.7048281 17 7.5054219 17 7.1074219 L 17 6 L 20 6 L 20 9 A 1.0001 1.0001 0 1 0 22 9 L 22 6 C 22 4.9069372 21.093063 4 20 4 L 17 4 L 17 2.8925781 C 17 2.5940781 16.730109 2.4073906 16.476562 2.4511719 z M 4 5 C 2.9069372 5 2 5.9069372 2 7 L 2 14 C 2 15.093063 2.9069372 16 4 16 L 7 16 L 7 19 C 7 20.105 7.895 21 9 21 L 16 21 C 17.105 21 18 20.105 18 19 L 18 12 C 18 10.895 17.105 10 16 10 L 13 10 L 13 7 C 13 5.9069372 12.093063 5 11 5 L 4 5 z M 4 7 L 11 7 L 11 14 L 4 14 L 4 7 z\" />\n);\n","import React from 'react';\nimport {createSvgIcon} from '../../common/icons/create-svg-icon';\n\nexport const CustomRemoveIcon = createSvgIcon(\n  <path d=\"M 10 2 L 9 3 L 3 3 L 3 5 L 21 5 L 21 3 L 15 3 L 14 2 L 10 2 z M 4.3652344 7 L 5.8925781 20.263672 C 6.0245781 21.253672 6.877 22 7.875 22 L 16.123047 22 C 17.121047 22 17.974422 21.254859 18.107422 20.255859 L 19.634766 7 L 4.3652344 7 z\" />\n);\n","import {Object} from 'fabric/fabric-impl';\nimport React from 'react';\nimport {IconButton} from '../../common/ui/buttons/icon-button';\nimport {useStore} from '../../state/store';\nimport {CustomDuplicateIcon} from '../../ui/icons/duplicate';\nimport {CustomFlipIcon} from '../../ui/icons/flip';\nimport {CustomFrontSortingIcon} from '../../ui/icons/front-sorting';\nimport {CustomRemoveIcon} from '../../ui/icons/remove';\nimport {state, tools} from '../../state/utils';\n\nconst floatingControlsSize = {\n  width: 120,\n  height: 30,\n};\n\nconst controls = [\n  {\n    name: 'Duplicate',\n    icon: CustomDuplicateIcon,\n    onClick: () => {\n      tools().objects.duplicate();\n    },\n  },\n  {\n    name: 'Flip',\n    icon: CustomFlipIcon,\n    onClick: () => {\n      tools().objects.flipHorizontally();\n    },\n  },\n  {\n    name: 'Bring to front',\n    icon: CustomFrontSortingIcon,\n    onClick: () => {\n      tools().objects.bringToFront();\n    },\n  },\n  {\n    name: 'Delete',\n    icon: CustomRemoveIcon,\n    onClick: () => {\n      tools().objects.delete();\n    },\n  },\n];\n\nexport const FloatingObjectControls = React.forwardRef<HTMLDivElement>(\n  (props, ref) => {\n    const isHidden = useStore(s => s.objects.active.isMoving);\n\n    const opacity = isHidden ? 'opacity-0' : 'opacity-100';\n    return (\n      <div\n        ref={ref}\n        className={`${opacity} absolute z-obj-box left-0 top-0 flex items-center text-white bg-controls rounded shadow transition-opacity overflow-hidden`}\n      >\n        {controls.map(control => {\n          const Icon = control.icon;\n          return (\n            <IconButton\n              size=\"sm\"\n              key={control.name}\n              className=\"w-30 h-30 hover:bg-white/hover\"\n              radius=\"rounded-none\"\n              onClick={control.onClick}\n            >\n              <Icon />\n            </IconButton>\n          );\n        })}\n      </div>\n    );\n  }\n);\n\nexport function repositionFloatingControls(\n  obj: Object,\n  el: HTMLElement | null\n) {\n  if (!el) return;\n  const angle = obj.angle || 0;\n  // make sure rotation handle is not covered when it's at the top\n  const floatingControlsTopOffset = angle > 168 && angle < 188 ? -30 : -15;\n  const canvas = state().canvasSize;\n  const stage = state().stageSize;\n  const size = floatingControlsSize;\n\n  // margin between canvas el and wrapper el edges\n  const canvasTopMargin = canvas.top - stage.top;\n  const canvasLeftMargin = canvas.left - stage.left;\n  const canvasRightMargin = stage.width - (canvasLeftMargin + canvas.width);\n  const canvasBottomMargin = stage.height - (canvasTopMargin + canvas.height);\n\n  // floating controls' max boundaries\n  const maxTop = -canvasTopMargin;\n  const maxLeft = -(canvas.left - stage.left);\n  const maxRight = canvas.width - size.width + canvasRightMargin;\n  const maxBottom = canvas.height - size.height + canvasBottomMargin;\n\n  // position floating controls\n  const boundingRect = obj.getBoundingRect();\n  let floatingTop = boundingRect.top - size.height + floatingControlsTopOffset;\n  let floatingLeft =\n    boundingRect.left + boundingRect.width / 2 - size.width / 2;\n\n  floatingTop = Math.min(maxBottom, Math.max(maxTop, floatingTop));\n  floatingLeft = Math.min(maxRight, Math.max(maxLeft, floatingLeft));\n\n  el.style.transform = `translate(${floatingLeft}px, ${floatingTop}px) rotate(0deg)`;\n}\n","import {RefObject} from 'react';\nimport {fabric} from 'fabric';\nimport {repositionFloatingControls} from '../floating-object-controls';\nimport {isText} from '../../utils/is-text';\nimport {ObjectOptions} from '../../object-modified-event';\nimport {state, tools} from '../../../state/utils';\nimport {\n  InteractableEvent,\n  InteractableRect,\n} from '../../../common/ui/interactions/interactable-event';\n\nexport function rotateActiveObj(e: {\n  rect: InteractableRect;\n  prevRect?: InteractableRect;\n}) {\n  const obj = tools().objects.getActive();\n  if (!obj || !e.rect.angle) return;\n  const newAngle = fabric.util.radiansToDegrees(e.rect.angle);\n  if (newAngle !== obj.angle) {\n    tools().objects.setValues({angle: newAngle});\n  }\n}\n\nexport function moveActiveObj(e: {\n  rect: InteractableRect;\n  prevRect?: InteractableRect;\n}) {\n  const centerX = e.rect.width / 2;\n  const centerY = e.rect.height / 2;\n  tools().objects.setValues({\n    left: (e.rect.left + centerX) / state().zoom,\n    top: (e.rect.top + centerY) / state().zoom,\n  });\n}\n\nexport function resizeActiveObj(e: InteractableEvent) {\n  const obj = tools().objects.getActive();\n  if (!obj) return;\n\n  const newValues: ObjectOptions = {};\n\n  if (isText(obj)) {\n    if (\n      e.deltaX > 0 ||\n      (obj.getScaledHeight() >= 20 && obj.getScaledWidth() >= 20)\n    ) {\n      newValues.fontSize = (obj.fontSize || 1) + e.deltaX;\n    }\n  } else {\n    if (obj.width) {\n      newValues.scaleX = e.rect.width / state().zoom / obj.width;\n    }\n    if (obj.height) {\n      newValues.scaleY = e.rect.height / state().zoom / obj.height;\n    }\n  }\n  tools().objects.setValues(newValues);\n}\n\nexport function syncBoxPositionWithActiveObj(\n  boxRef: RefObject<HTMLElement>,\n  floatingControlsRef: RefObject<HTMLElement>\n) {\n  const obj = tools().objects.getActive();\n  if (!obj || !boxRef.current) return;\n  const el = boxRef.current;\n\n  // bounding box position\n  const angleRad = fabric.util.degreesToRadians(obj.angle ?? 0);\n  let width = Math.round(obj.getScaledWidth() * state().zoom);\n  let height = Math.round(obj.getScaledHeight() * state().zoom);\n  let left = Math.round((obj.left ?? 0) * state().zoom);\n  let top = Math.round((obj.top ?? 0) * state().zoom);\n\n  const centerX = obj.originX === 'center' ? width / 2 : 0;\n  const centerY = obj.originY === 'center' ? height / 2 : 0;\n\n  if (obj.padding) {\n    width += obj.padding * 2;\n    height += obj.padding * 2;\n    left -= obj.padding;\n    top -= obj.padding;\n  }\n\n  // position bounding box\n  el.style.width = `${width}px`;\n  el.style.height = `${height}px`;\n  el.style.transform = `translate(${left - centerX}px, ${\n    top - centerY\n  }px) rotate(${angleRad}rad)`;\n\n  tools().canvas.render();\n\n  repositionFloatingControls(obj, floatingControlsRef.current);\n}\n\nexport function enableTextEditing() {\n  const obj = tools().objects.getActive();\n  if (isText(obj)) {\n    obj.enterEditing();\n    obj.hiddenTextarea?.focus();\n  }\n}\n","import React from 'react';\n\nexport function RotationControl() {\n  return (\n    <div className=\"absolute -bottom-20 left-1/2 w-2 h-20 bg-white cursor-default -translate-x-1/2\">\n      <div\n        data-rotate-handle={true}\n        className=\"w-18 h-18 absolute -bottom-10 -left-8 bg-white rounded-full cursor-move\"\n      />\n    </div>\n  );\n}\n","import {RefObject} from 'react';\nimport {\n  interactableEvent,\n  InteractableEvent,\n  InteractableRect,\n} from './interactable-event';\nimport {usePointerEvents, UsePointerEventsProps} from './use-pointer-events';\nimport {setActiveInteraction} from './active-interaction';\nimport {domRectToObj} from './utils/dom-rect-to-obj';\n\ninterface RotateState {\n  currentRect?: InteractableRect;\n  centerX?: number;\n  centerY?: number;\n  startAngle?: number;\n}\n\nlet state: RotateState = {};\n\ninterface UseRotateProps {\n  boundaryRect?: InteractableRect;\n  boundaryRef?: RefObject<HTMLElement> | null;\n  onRotateStart?: (e: InteractableEvent) => void;\n  onRotate?: (e: InteractableEvent) => void;\n  onRotateEnd?: (e: InteractableEvent) => void;\n}\nexport function useRotate(props: UseRotateProps) {\n  const pointerProps: UsePointerEventsProps = {\n    onMoveStart: (e, rotatable) => {\n      const target = e.target as HTMLElement;\n      if (!target.dataset.rotateHandle) {\n        return false;\n      }\n\n      const rect = domRectToObj(rotatable.getBoundingClientRect());\n      if (!rect) return false;\n\n      const rotateVal = rotatable.style.transform.match(/rotate\\((.+?)\\)/)?.[1];\n      const [rotation = '0'] = rotateVal ? rotateVal.split(',') : [];\n      resetState({\n        currentRect: rect,\n        // store the center because the element has css `transform-origin: center center`\n        centerX: rect.left + rect.width / 2,\n        centerY: rect.top + rect.height / 2,\n        startAngle: parseFloat(rotation),\n      });\n\n      setActiveInteraction('rotate');\n\n      // get the angle of the element when the drag starts\n      state.startAngle = getDragAngle(e);\n\n      props.onRotateStart?.(interactableEvent({rect, e}));\n    },\n    onMove: (e, deltaX, deltaY) => {\n      if (!state.currentRect) return;\n\n      const newRect = {...state.currentRect};\n      newRect.angle = getDragAngle(e);\n      newRect.left += deltaX;\n      newRect.top += deltaY;\n\n      props.onRotate?.(interactableEvent({rect: newRect, e, deltaX, deltaY}));\n\n      state.currentRect = newRect;\n    },\n    onMoveEnd: e => {\n      if (state.currentRect) {\n        props.onRotateEnd?.(interactableEvent({rect: state.currentRect, e}));\n      }\n      resetState();\n    },\n  };\n\n  const {domProps} = usePointerEvents(pointerProps);\n\n  return {rotateProps: domProps};\n}\n\nfunction getDragAngle(e: {pageX: number; pageY: number}) {\n  const center = {\n    x: state.centerX || 0,\n    y: state.centerY || 0,\n  };\n  const angle = Math.atan2(center.y - e.pageY, center.x - e.pageX);\n\n  return angle - (state.startAngle || 0);\n}\n\nconst resetState = (value: RotateState = {}) => {\n  setActiveInteraction(null);\n  state = value;\n};\n","import React, {useCallback, useEffect, useRef} from 'react';\nimport {useStore} from '../../../state/store';\nimport {CornerHandle} from '../corner-handle';\nimport {ObjectControlConfig, PixieConfig} from '../../../config/default-config';\nimport {FloatingObjectControls} from '../floating-object-controls';\nimport {\n  enableTextEditing,\n  moveActiveObj,\n  resizeActiveObj,\n  rotateActiveObj,\n  syncBoxPositionWithActiveObj,\n} from './object-box-actions';\nimport {RotationControl} from './ratation-control';\nimport {ObjectModifiedEvent} from '../../object-modified-event';\nimport {fabricCanvas, state, tools} from '../../../state/utils';\nimport {useMove} from '../../../common/ui/interactions/use-move';\nimport {\n  resizeHandlePosition,\n  useResize,\n} from '../../../common/ui/interactions/use-resize';\nimport {mergeProps} from '@react-aria/utils';\nimport {useRotate} from '../../../common/ui/interactions/use-rotate';\n\nexport function ObjectBox() {\n  const boxRef = useRef<HTMLDivElement>(null!);\n  const floatingControlsRef = useRef<HTMLDivElement>(null!);\n  const activeObjId = useStore(s => s.objects.active.id);\n  const isEditingText = useStore(s => s.objects.isEditingText);\n  const zoom = useStore(s => s.zoom);\n  const objTypeConfig = getObjTypeConfig();\n\n  const doubleTapTimer = useRef<NodeJS.Timeout | null>(null);\n  const doubleTapHandler = useCallback(() => {\n    if (!doubleTapTimer.current) {\n      doubleTapTimer.current = setTimeout(() => {\n        doubleTapTimer.current = null;\n      }, 300);\n    } else {\n      clearTimeout(doubleTapTimer.current);\n      doubleTapTimer.current = null;\n      enableTextEditing();\n    }\n  }, []);\n\n  let {moveProps} = useMove({\n    boundaryRef: state().canvasRef,\n    restrictWithinBoundary: false,\n    onMoveEnd: () => {\n      state().objects.setActiveIsMoving(false);\n    },\n    onMove: e => {\n      state().objects.setActiveIsMoving(true);\n      moveActiveObj(e);\n    },\n  });\n  // disable movement based on user specified config\n  if (objTypeConfig.lockMovement) {\n    moveProps = {};\n  }\n\n  const {resizeProps} = useResize({\n    minWidth: 50,\n    minHeight: 50,\n    aspectRatio: objTypeConfig.unlockAspectRatio ? null : 'initial',\n    boundaryRef: state().canvasRef,\n    restrictWithinBoundary: false,\n    onResizeEnd: () => {\n      state().objects.setActiveIsMoving(false);\n    },\n    onResize: e => {\n      state().objects.setActiveIsMoving(true);\n      resizeActiveObj(e);\n    },\n  });\n\n  const {rotateProps} = useRotate({\n    boundaryRef: state().canvasRef,\n    onRotateEnd: () => {\n      state().objects.setActiveIsMoving(false);\n    },\n    onRotate: e => {\n      state().objects.setActiveIsMoving(true);\n      rotateActiveObj(e);\n    },\n  });\n\n  useEffect(() => {\n    // wait until fabric is initialized\n    if (!fabricCanvas()) return;\n    state().editor.on('object:modified', (e: ObjectModifiedEvent) => {\n      if (e.sizeOrPositionChanged) {\n        syncBoxPositionWithActiveObj(boxRef, floatingControlsRef);\n      }\n    });\n  }, []);\n\n  // reposition when obj is selected/deselected, or zoom or after user is done with editing text\n  useEffect(() => {\n    syncBoxPositionWithActiveObj(boxRef, floatingControlsRef);\n  }, [activeObjId, zoom, isEditingText]);\n\n  const display = activeObjId && !isEditingText ? 'block' : 'hidden';\n\n  return (\n    <div className={display}>\n      <div\n        ref={boxRef}\n        {...mergeProps(rotateProps, resizeProps, moveProps)}\n        onClick={doubleTapHandler}\n        className=\"absolute z-obj-box border-2 border-white shadow-md cursor-move\"\n      >\n        {!objTypeConfig.hideTopLeft && (\n          <CornerHandle position={resizeHandlePosition.topLeft} />\n        )}\n        {!objTypeConfig.hideTopRight && (\n          <CornerHandle position={resizeHandlePosition.topRight} />\n        )}\n        {!objTypeConfig.hideBottomLeft && (\n          <CornerHandle position={resizeHandlePosition.bottomLeft} />\n        )}\n        {!objTypeConfig.hideBottomRight && (\n          <CornerHandle position={resizeHandlePosition.bottomRight} />\n        )}\n        {!objTypeConfig.hideRotatingPoint && <RotationControl />}\n      </div>\n      <FloatingObjectControls ref={floatingControlsRef} />\n    </div>\n  );\n}\n\nfunction getObjTypeConfig(): ObjectControlConfig {\n  const obj = tools().objects.getActive();\n  if (!obj || !obj.name) return {};\n  const userConfig = state().config.objectControls || {};\n  const objName = obj.name as keyof PixieConfig['objectControls'];\n  return {\n    ...userConfig.global,\n    ...(userConfig[objName] as ObjectControlConfig),\n  };\n}\n","import React from 'react';\nimport {Cropzone} from '../../tools/crop/ui/cropzone/cropzone';\nimport {ObjectBox} from '../../objects/ui/object-box/object-box';\nimport {useStore} from '../../state/store';\nimport {ToolName} from '../../tools/tool-name';\n\nexport function StageOverlays() {\n  const cropToolIsActive = useStore(s => s.activeTool === ToolName.CROP);\n  const objIsSelected = useStore(s => s.objects.active.id);\n  return (\n    <div>\n      {cropToolIsActive && <Cropzone />}\n      {objIsSelected && <ObjectBox />}\n    </div>\n  );\n}\n","import React, {useEffect, useRef, useState} from 'react';\nimport {m, Variants} from 'framer-motion';\nimport {\n  createUseGesture,\n  dragAction,\n  FullGestureState,\n  pinchAction,\n} from '@use-gesture/react';\nimport {StageOverlays} from './stage-overlays';\nimport {useStore} from '../../state/store';\nimport {fabricCanvas, tools} from '../../state/utils';\nimport {assetUrl} from '../../utils/asset-url';\n\nconst useGesture = createUseGesture([dragAction, pinchAction]);\n\nexport const CanvasWrapper = React.forwardRef<HTMLCanvasElement>(\n  (props, canvasRef) => {\n    const [isVisible, setIsVisible] = useState(false);\n\n    useEffect(() => {\n      return useStore.subscribe(\n        s => s.loading,\n        loading => {\n          if (!loading) {\n            setIsVisible(true);\n          } else {\n            setIsVisible(false);\n          }\n        }\n      );\n    }, []);\n\n    const variants: Variants = {\n      visible: {\n        opacity: 1,\n        transition: {duration: 0.35, delay: 0.5},\n      },\n      hidden: {opacity: 0, transition: {duration: 0}},\n    };\n\n    return (\n      <PanContainer>\n        <m.div\n          initial={{opacity: 0}}\n          variants={variants}\n          animate={isVisible ? 'visible' : 'hidden'}\n          className=\"relative m-auto\"\n          style={{\n            backgroundImage: `url(${assetUrl('images/empty-canvas-bg.png')})`,\n          }}\n        >\n          <StageOverlays />\n          <canvas ref={canvasRef} />\n        </m.div>\n      </PanContainer>\n    );\n  }\n);\n\ntype PanContainerProps = {\n  children: React.ReactNode;\n};\n\nfunction PanContainer({children}: PanContainerProps) {\n  const ref = useRef<HTMLDivElement>(null!);\n\n  const bind = useGesture({\n    onPinch: e => {\n      if (!tools().zoom.allowUserZoom || !shouldHandleGesture(e)) {\n        return e.cancel();\n      }\n      if (e.direction[0] === 1) {\n        tools().zoom.zoomIn(0.01);\n      } else {\n        tools().zoom.zoomOut(0.01);\n      }\n      e.event.stopPropagation();\n      e.event.preventDefault();\n    },\n    onDrag: e => {\n      if (e.pinching || !shouldHandleGesture(e)) {\n        return e.cancel();\n      }\n      ref.current.scrollLeft -= e.delta[0];\n      ref.current.scrollTop -= e.delta[1];\n    },\n  });\n\n  return (\n    <div\n      ref={ref}\n      className=\"flex items-center justify-center w-full h-full overflow-hidden touch-none\"\n      {...bind()}\n    >\n      {children}\n    </div>\n  );\n}\n\nfunction shouldHandleGesture(\n  e: FullGestureState<'drag'> | FullGestureState<'pinch'>\n): boolean {\n  return !(\n    fabricCanvas().findTarget(e.event, false) || fabricCanvas().isDrawingMode\n  );\n}\n","import React from 'react';\nimport clsx from 'clsx';\n\ntype Props = {\n  actionBtn?: React.ReactNode;\n  children?: React.ReactNode;\n  className?: string;\n};\n\nexport function ToolControlsOverlayWrapper({\n  actionBtn,\n  children,\n  className,\n}: Props) {\n  return (\n    <div className={clsx(className, 'flex gap-16 items-center h-full')}>\n      {actionBtn && <div className=\"flex-shrink-0\">{actionBtn}</div>}\n      <div className=\"w-full flex-auto\">{children}</div>\n      {actionBtn && <div className=\"w-96\" />}\n    </div>\n  );\n}\n","import e,{useRef as r,useMemo as t,useEffect as n,useState as o,useCallback as a,useLayoutEffect as l}from\"react\";function u(){return(u=Object.assign||function(e){for(var r=1;r<arguments.length;r++){var t=arguments[r];for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])}return e}).apply(this,arguments)}function c(e,r){if(null==e)return{};var t,n,o={},a=Object.keys(e);for(n=0;n<a.length;n++)r.indexOf(t=a[n])>=0||(o[t]=e[t]);return o}function i(e){var t=r(e),n=r(function(e){t.current&&t.current(e)});return t.current=e,n.current}var s=function(e,r,t){return void 0===r&&(r=0),void 0===t&&(t=1),e>t?t:e<r?r:e},f=function(e){return\"touches\"in e},v=function(e){return e&&e.ownerDocument.defaultView||self},d=function(e,r,t){var n=e.getBoundingClientRect(),o=f(r)?function(e,r){for(var t=0;t<e.length;t++)if(e[t].identifier===r)return e[t];return e[0]}(r.touches,t):r;return{left:s((o.pageX-(n.left+v(e).pageXOffset))/n.width),top:s((o.pageY-(n.top+v(e).pageYOffset))/n.height)}},h=function(e){!f(e)&&e.preventDefault()},m=e.memo(function(o){var a=o.onMove,l=o.onKey,s=c(o,[\"onMove\",\"onKey\"]),m=r(null),g=i(a),p=i(l),b=r(null),_=r(!1),x=t(function(){var e=function(e){h(e),(f(e)?e.touches.length>0:e.buttons>0)&&m.current?g(d(m.current,e,b.current)):t(!1)},r=function(){return t(!1)};function t(t){var n=_.current,o=v(m.current),a=t?o.addEventListener:o.removeEventListener;a(n?\"touchmove\":\"mousemove\",e),a(n?\"touchend\":\"mouseup\",r)}return[function(e){var r=e.nativeEvent,n=m.current;if(n&&(h(r),!function(e,r){return r&&!f(e)}(r,_.current)&&n)){if(f(r)){_.current=!0;var o=r.changedTouches||[];o.length&&(b.current=o[0].identifier)}n.focus(),g(d(n,r,b.current)),t(!0)}},function(e){var r=e.which||e.keyCode;r<37||r>40||(e.preventDefault(),p({left:39===r?.05:37===r?-.05:0,top:40===r?.05:38===r?-.05:0}))},t]},[p,g]),C=x[0],E=x[1],H=x[2];return n(function(){return H},[H]),e.createElement(\"div\",u({},s,{onTouchStart:C,onMouseDown:C,className:\"react-colorful__interactive\",ref:m,onKeyDown:E,tabIndex:0,role:\"slider\"}))}),g=function(e){return e.filter(Boolean).join(\" \")},p=function(r){var t=r.color,n=r.left,o=r.top,a=void 0===o?.5:o,l=g([\"react-colorful__pointer\",r.className]);return e.createElement(\"div\",{className:l,style:{top:100*a+\"%\",left:100*n+\"%\"}},e.createElement(\"div\",{className:\"react-colorful__pointer-fill\",style:{backgroundColor:t}}))},b=function(e,r,t){return void 0===r&&(r=0),void 0===t&&(t=Math.pow(10,r)),Math.round(t*e)/t},_={grad:.9,turn:360,rad:360/(2*Math.PI)},x=function(e){return L(C(e))},C=function(e){return\"#\"===e[0]&&(e=e.substring(1)),e.length<6?{r:parseInt(e[0]+e[0],16),g:parseInt(e[1]+e[1],16),b:parseInt(e[2]+e[2],16),a:4===e.length?b(parseInt(e[3]+e[3],16)/255,2):1}:{r:parseInt(e.substring(0,2),16),g:parseInt(e.substring(2,4),16),b:parseInt(e.substring(4,6),16),a:8===e.length?b(parseInt(e.substring(6,8),16)/255,2):1}},E=function(e,r){return void 0===r&&(r=\"deg\"),Number(e)*(_[r]||1)},H=function(e){var r=/hsla?\\(?\\s*(-?\\d*\\.?\\d+)(deg|rad|grad|turn)?[,\\s]+(-?\\d*\\.?\\d+)%?[,\\s]+(-?\\d*\\.?\\d+)%?,?\\s*[/\\s]*(-?\\d*\\.?\\d+)?(%)?\\s*\\)?/i.exec(e);return r?N({h:E(r[1],r[2]),s:Number(r[3]),l:Number(r[4]),a:void 0===r[5]?1:Number(r[5])/(r[6]?100:1)}):{h:0,s:0,v:0,a:1}},M=H,N=function(e){var r=e.s,t=e.l;return{h:e.h,s:(r*=(t<50?t:100-t)/100)>0?2*r/(t+r)*100:0,v:t+r,a:e.a}},w=function(e){return K(I(e))},y=function(e){var r=e.s,t=e.v,n=e.a,o=(200-r)*t/100;return{h:b(e.h),s:b(o>0&&o<200?r*t/100/(o<=100?o:200-o)*100:0),l:b(o/2),a:b(n,2)}},q=function(e){var r=y(e);return\"hsl(\"+r.h+\", \"+r.s+\"%, \"+r.l+\"%)\"},k=function(e){var r=y(e);return\"hsla(\"+r.h+\", \"+r.s+\"%, \"+r.l+\"%, \"+r.a+\")\"},I=function(e){var r=e.h,t=e.s,n=e.v,o=e.a;r=r/360*6,t/=100,n/=100;var a=Math.floor(r),l=n*(1-t),u=n*(1-(r-a)*t),c=n*(1-(1-r+a)*t),i=a%6;return{r:b(255*[n,u,l,l,c,n][i]),g:b(255*[c,n,n,u,l,l][i]),b:b(255*[l,l,c,n,n,u][i]),a:b(o,2)}},O=function(e){var r=/hsva?\\(?\\s*(-?\\d*\\.?\\d+)(deg|rad|grad|turn)?[,\\s]+(-?\\d*\\.?\\d+)%?[,\\s]+(-?\\d*\\.?\\d+)%?,?\\s*[/\\s]*(-?\\d*\\.?\\d+)?(%)?\\s*\\)?/i.exec(e);return r?A({h:E(r[1],r[2]),s:Number(r[3]),v:Number(r[4]),a:void 0===r[5]?1:Number(r[5])/(r[6]?100:1)}):{h:0,s:0,v:0,a:1}},j=O,z=function(e){var r=/rgba?\\(?\\s*(-?\\d*\\.?\\d+)(%)?[,\\s]+(-?\\d*\\.?\\d+)(%)?[,\\s]+(-?\\d*\\.?\\d+)(%)?,?\\s*[/\\s]*(-?\\d*\\.?\\d+)?(%)?\\s*\\)?/i.exec(e);return r?L({r:Number(r[1])/(r[2]?100/255:1),g:Number(r[3])/(r[4]?100/255:1),b:Number(r[5])/(r[6]?100/255:1),a:void 0===r[7]?1:Number(r[7])/(r[8]?100:1)}):{h:0,s:0,v:0,a:1}},B=z,D=function(e){var r=e.toString(16);return r.length<2?\"0\"+r:r},K=function(e){var r=e.r,t=e.g,n=e.b,o=e.a,a=o<1?D(b(255*o)):\"\";return\"#\"+D(r)+D(t)+D(n)+a},L=function(e){var r=e.r,t=e.g,n=e.b,o=e.a,a=Math.max(r,t,n),l=a-Math.min(r,t,n),u=l?a===r?(t-n)/l:a===t?2+(n-r)/l:4+(r-t)/l:0;return{h:b(60*(u<0?u+6:u)),s:b(a?l/a*100:0),v:b(a/255*100),a:o}},A=function(e){return{h:b(e.h),s:b(e.s),v:b(e.v),a:b(e.a,2)}},S=e.memo(function(r){var t=r.hue,n=r.onChange,o=g([\"react-colorful__hue\",r.className]);return e.createElement(\"div\",{className:o},e.createElement(m,{onMove:function(e){n({h:360*e.left})},onKey:function(e){n({h:s(t+360*e.left,0,360)})},\"aria-label\":\"Hue\",\"aria-valuenow\":b(t),\"aria-valuemax\":\"360\",\"aria-valuemin\":\"0\"},e.createElement(p,{className:\"react-colorful__hue-pointer\",left:t/360,color:q({h:t,s:100,v:100,a:1})})))}),T=e.memo(function(r){var t=r.hsva,n=r.onChange,o={backgroundColor:q({h:t.h,s:100,v:100,a:1})};return e.createElement(\"div\",{className:\"react-colorful__saturation\",style:o},e.createElement(m,{onMove:function(e){n({s:100*e.left,v:100-100*e.top})},onKey:function(e){n({s:s(t.s+100*e.left,0,100),v:s(t.v-100*e.top,0,100)})},\"aria-label\":\"Color\",\"aria-valuetext\":\"Saturation \"+b(t.s)+\"%, Brightness \"+b(t.v)+\"%\"},e.createElement(p,{className:\"react-colorful__saturation-pointer\",top:1-t.v/100,left:t.s/100,color:q(t)})))}),F=function(e,r){if(e===r)return!0;for(var t in e)if(e[t]!==r[t])return!1;return!0},P=function(e,r){return e.replace(/\\s/g,\"\")===r.replace(/\\s/g,\"\")},X=function(e,r){return e.toLowerCase()===r.toLowerCase()||F(C(e),C(r))};function Y(e,t,l){var u=i(l),c=o(function(){return e.toHsva(t)}),s=c[0],f=c[1],v=r({color:t,hsva:s});n(function(){if(!e.equal(t,v.current.color)){var r=e.toHsva(t);v.current={hsva:r,color:t},f(r)}},[t,e]),n(function(){var r;F(s,v.current.hsva)||e.equal(r=e.fromHsva(s),v.current.color)||(v.current={hsva:s,color:r},u(r))},[s,e,u]);var d=a(function(e){f(function(r){return Object.assign({},r,e)})},[]);return[s,d]}var R,V=\"undefined\"!=typeof window?l:n,$=function(){return R||(\"undefined\"!=typeof __webpack_nonce__?__webpack_nonce__:void 0)},G=function(e){R=e},J=new Map,Q=function(e){V(function(){var r=e.current?e.current.ownerDocument:document;if(void 0!==r&&!J.has(r)){var t=r.createElement(\"style\");t.innerHTML='.react-colorful{position:relative;display:flex;flex-direction:column;width:200px;height:200px;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none;cursor:default}.react-colorful__saturation{position:relative;flex-grow:1;border-color:transparent;border-bottom:12px solid #000;border-radius:8px 8px 0 0;background-image:linear-gradient(0deg,#000,transparent),linear-gradient(90deg,#fff,hsla(0,0%,100%,0))}.react-colorful__alpha-gradient,.react-colorful__pointer-fill{content:\"\";position:absolute;left:0;top:0;right:0;bottom:0;pointer-events:none;border-radius:inherit}.react-colorful__alpha-gradient,.react-colorful__saturation{box-shadow:inset 0 0 0 1px rgba(0,0,0,.05)}.react-colorful__alpha,.react-colorful__hue{position:relative;height:24px}.react-colorful__hue{background:linear-gradient(90deg,red 0,#ff0 17%,#0f0 33%,#0ff 50%,#00f 67%,#f0f 83%,red)}.react-colorful__last-control{border-radius:0 0 8px 8px}.react-colorful__interactive{position:absolute;left:0;top:0;right:0;bottom:0;border-radius:inherit;outline:none;touch-action:none}.react-colorful__pointer{position:absolute;z-index:1;box-sizing:border-box;width:28px;height:28px;transform:translate(-50%,-50%);background-color:#fff;border:2px solid #fff;border-radius:50%;box-shadow:0 2px 4px rgba(0,0,0,.2)}.react-colorful__interactive:focus .react-colorful__pointer{transform:translate(-50%,-50%) scale(1.1)}.react-colorful__alpha,.react-colorful__alpha-pointer{background-color:#fff;background-image:url(\\'data:image/svg+xml;charset=utf-8,<svg xmlns=\"http://www.w3.org/2000/svg\" width=\"16\" height=\"16\" fill-opacity=\".05\"><path d=\"M8 0h8v8H8zM0 8h8v8H0z\"/></svg>\\')}.react-colorful__saturation-pointer{z-index:3}.react-colorful__hue-pointer{z-index:2}',J.set(r,t);var n=$();n&&t.setAttribute(\"nonce\",n),r.head.appendChild(t)}},[])},U=function(t){var n=t.className,o=t.colorModel,a=t.color,l=void 0===a?o.defaultColor:a,i=t.onChange,s=c(t,[\"className\",\"colorModel\",\"color\",\"onChange\"]),f=r(null);Q(f);var v=Y(o,l,i),d=v[0],h=v[1],m=g([\"react-colorful\",n]);return e.createElement(\"div\",u({},s,{ref:f,className:m}),e.createElement(T,{hsva:d,onChange:h}),e.createElement(S,{hue:d.h,onChange:h,className:\"react-colorful__last-control\"}))},W={defaultColor:\"000\",toHsva:x,fromHsva:function(e){return w({h:e.h,s:e.s,v:e.v,a:1})},equal:X},Z=function(r){return e.createElement(U,u({},r,{colorModel:W}))},ee=function(r){var t=r.className,n=r.hsva,o=r.onChange,a={backgroundImage:\"linear-gradient(90deg, \"+k(Object.assign({},n,{a:0}))+\", \"+k(Object.assign({},n,{a:1}))+\")\"},l=g([\"react-colorful__alpha\",t]),u=b(100*n.a);return e.createElement(\"div\",{className:l},e.createElement(\"div\",{className:\"react-colorful__alpha-gradient\",style:a}),e.createElement(m,{onMove:function(e){o({a:e.left})},onKey:function(e){o({a:s(n.a+e.left)})},\"aria-label\":\"Alpha\",\"aria-valuetext\":u+\"%\",\"aria-valuenow\":u,\"aria-valuemin\":\"0\",\"aria-valuemax\":\"100\"},e.createElement(p,{className:\"react-colorful__alpha-pointer\",left:n.a,color:k(n)})))},re=function(t){var n=t.className,o=t.colorModel,a=t.color,l=void 0===a?o.defaultColor:a,i=t.onChange,s=c(t,[\"className\",\"colorModel\",\"color\",\"onChange\"]),f=r(null);Q(f);var v=Y(o,l,i),d=v[0],h=v[1],m=g([\"react-colorful\",n]);return e.createElement(\"div\",u({},s,{ref:f,className:m}),e.createElement(T,{hsva:d,onChange:h}),e.createElement(S,{hue:d.h,onChange:h}),e.createElement(ee,{hsva:d,onChange:h,className:\"react-colorful__last-control\"}))},te={defaultColor:\"0001\",toHsva:x,fromHsva:w,equal:X},ne=function(r){return e.createElement(re,u({},r,{colorModel:te}))},oe={defaultColor:{h:0,s:0,l:0,a:1},toHsva:N,fromHsva:y,equal:F},ae=function(r){return e.createElement(re,u({},r,{colorModel:oe}))},le={defaultColor:\"hsla(0, 0%, 0%, 1)\",toHsva:H,fromHsva:k,equal:P},ue=function(r){return e.createElement(re,u({},r,{colorModel:le}))},ce={defaultColor:{h:0,s:0,l:0},toHsva:function(e){return N({h:e.h,s:e.s,l:e.l,a:1})},fromHsva:function(e){return{h:(r=y(e)).h,s:r.s,l:r.l};var r},equal:F},ie=function(r){return e.createElement(U,u({},r,{colorModel:ce}))},se={defaultColor:\"hsl(0, 0%, 0%)\",toHsva:M,fromHsva:q,equal:P},fe=function(r){return e.createElement(U,u({},r,{colorModel:se}))},ve={defaultColor:{h:0,s:0,v:0,a:1},toHsva:function(e){return e},fromHsva:A,equal:F},de=function(r){return e.createElement(re,u({},r,{colorModel:ve}))},he={defaultColor:\"hsva(0, 0%, 0%, 1)\",toHsva:O,fromHsva:function(e){var r=A(e);return\"hsva(\"+r.h+\", \"+r.s+\"%, \"+r.v+\"%, \"+r.a+\")\"},equal:P},me=function(r){return e.createElement(re,u({},r,{colorModel:he}))},ge={defaultColor:{h:0,s:0,v:0},toHsva:function(e){return{h:e.h,s:e.s,v:e.v,a:1}},fromHsva:function(e){var r=A(e);return{h:r.h,s:r.s,v:r.v}},equal:F},pe=function(r){return e.createElement(U,u({},r,{colorModel:ge}))},be={defaultColor:\"hsv(0, 0%, 0%)\",toHsva:j,fromHsva:function(e){var r=A(e);return\"hsv(\"+r.h+\", \"+r.s+\"%, \"+r.v+\"%)\"},equal:P},_e=function(r){return e.createElement(U,u({},r,{colorModel:be}))},xe={defaultColor:{r:0,g:0,b:0,a:1},toHsva:L,fromHsva:I,equal:F},Ce=function(r){return e.createElement(re,u({},r,{colorModel:xe}))},Ee={defaultColor:\"rgba(0, 0, 0, 1)\",toHsva:z,fromHsva:function(e){var r=I(e);return\"rgba(\"+r.r+\", \"+r.g+\", \"+r.b+\", \"+r.a+\")\"},equal:P},He=function(r){return e.createElement(re,u({},r,{colorModel:Ee}))},Me={defaultColor:{r:0,g:0,b:0},toHsva:function(e){return L({r:e.r,g:e.g,b:e.b,a:1})},fromHsva:function(e){return{r:(r=I(e)).r,g:r.g,b:r.b};var r},equal:F},Ne=function(r){return e.createElement(U,u({},r,{colorModel:Me}))},we={defaultColor:\"rgb(0, 0, 0)\",toHsva:B,fromHsva:function(e){var r=I(e);return\"rgb(\"+r.r+\", \"+r.g+\", \"+r.b+\")\"},equal:P},ye=function(r){return e.createElement(U,u({},r,{colorModel:we}))},qe=/^#?([0-9A-F]{3,8})$/i,ke=function(r){var t=r.color,l=void 0===t?\"\":t,s=r.onChange,f=r.onBlur,v=r.escape,d=r.validate,h=r.format,m=r.process,g=c(r,[\"color\",\"onChange\",\"onBlur\",\"escape\",\"validate\",\"format\",\"process\"]),p=o(function(){return v(l)}),b=p[0],_=p[1],x=i(s),C=i(f),E=a(function(e){var r=v(e.target.value);_(r),d(r)&&x(m?m(r):r)},[v,m,d,x]),H=a(function(e){d(e.target.value)||_(v(l)),C(e)},[l,v,d,C]);return n(function(){_(v(l))},[l,v]),e.createElement(\"input\",u({},g,{value:h?h(b):b,spellCheck:\"false\",onChange:E,onBlur:H}))},Ie=function(e){return\"#\"+e},Oe=function(r){var t=r.prefixed,n=r.alpha,o=c(r,[\"prefixed\",\"alpha\"]),l=a(function(e){return e.replace(/([^0-9A-F]+)/gi,\"\").substring(0,n?8:6)},[n]),i=a(function(e){return function(e,r){var t=qe.exec(e),n=t?t[1].length:0;return 3===n||6===n||!!r&&4===n||!!r&&8===n}(e,n)},[n]);return e.createElement(ke,u({},o,{escape:l,format:t?Ie:void 0,process:Ie,validate:i}))};export{ne as HexAlphaColorPicker,Oe as HexColorInput,Z as HexColorPicker,ie as HslColorPicker,fe as HslStringColorPicker,ae as HslaColorPicker,ue as HslaStringColorPicker,pe as HsvColorPicker,_e as HsvStringColorPicker,de as HsvaColorPicker,me as HsvaStringColorPicker,Ne as RgbColorPicker,ye as RgbStringColorPicker,Ce as RgbaColorPicker,He as RgbaStringColorPicker,G as setNonce};\n//# sourceMappingURL=index.module.js.map\n","import {clamp as $cBgAy$clamp, toFixedNumber as $cBgAy$toFixedNumber, useControlledState as $cBgAy$useControlledState, snapValueToStep as $cBgAy$snapValueToStep} from \"@react-stately/utils\";\nimport {LocalizedStringDictionary as $cBgAy$LocalizedStringDictionary} from \"@internationalized/string\";\nimport {NumberFormatter as $cBgAy$NumberFormatter} from \"@internationalized/number\";\nimport {useRef as $cBgAy$useRef, useMemo as $cBgAy$useMemo, useState as $cBgAy$useState} from \"react\";\nimport {useSliderState as $cBgAy$useSliderState} from \"@react-stately/slider\";\n\nfunction $parcel$interopDefault(a) {\n  return a && a.__esModule ? a.default : a;\n}\n\nvar $7a451c0c6841e6b9$exports = {};\nvar $2d805fd52bb48883$exports = {};\n$2d805fd52bb48883$exports = {\n    \"alpha\": `ألفا`,\n    \"blue\": `أزرق`,\n    \"brightness\": `السطوع`,\n    \"green\": `أخضر`,\n    \"hue\": `درجة اللون`,\n    \"lightness\": `الإضاءة`,\n    \"red\": `أحمر`,\n    \"saturation\": `التشبع`\n};\n\n\nvar $6c28468dc1df643c$exports = {};\n$6c28468dc1df643c$exports = {\n    \"alpha\": `Алфа`,\n    \"blue\": `Синьо`,\n    \"brightness\": `Яркост`,\n    \"green\": `Зелено`,\n    \"hue\": `Оттенък`,\n    \"lightness\": `Лекота`,\n    \"red\": `Червено`,\n    \"saturation\": `Наситеност`\n};\n\n\nvar $807554f8230db0ed$exports = {};\n$807554f8230db0ed$exports = {\n    \"alpha\": `Alfa`,\n    \"blue\": `Modrá`,\n    \"brightness\": `Jas`,\n    \"green\": `Zelená`,\n    \"hue\": `Odstín`,\n    \"lightness\": `Světlost`,\n    \"red\": `Červená`,\n    \"saturation\": `Sytost`\n};\n\n\nvar $7097f64386f1761c$exports = {};\n$7097f64386f1761c$exports = {\n    \"alpha\": `Alfa`,\n    \"blue\": `Blå`,\n    \"brightness\": `Lysstyrke`,\n    \"green\": `Grøn`,\n    \"hue\": `Tone`,\n    \"lightness\": `Lyshed`,\n    \"red\": `Rød`,\n    \"saturation\": `Farvemætning`\n};\n\n\nvar $bdd847d8beb08799$exports = {};\n$bdd847d8beb08799$exports = {\n    \"alpha\": `Alpha`,\n    \"blue\": `Blau`,\n    \"brightness\": `Helligkeit`,\n    \"green\": `Grün`,\n    \"hue\": `Farbton`,\n    \"lightness\": `Leuchtkraft`,\n    \"red\": `Rot`,\n    \"saturation\": `Sättigung`\n};\n\n\nvar $a53e00b683950971$exports = {};\n$a53e00b683950971$exports = {\n    \"alpha\": `Άλφα`,\n    \"blue\": `Μπλε`,\n    \"brightness\": `Φωτεινότητα`,\n    \"green\": `Πράσινο`,\n    \"hue\": `Τόνος`,\n    \"lightness\": `Φωτεινότητα`,\n    \"red\": `Κόκκινο`,\n    \"saturation\": `Κορεσμός`\n};\n\n\nvar $21cdd87e84f28d89$exports = {};\n$21cdd87e84f28d89$exports = {\n    \"hue\": `Hue`,\n    \"saturation\": `Saturation`,\n    \"lightness\": `Lightness`,\n    \"brightness\": `Brightness`,\n    \"red\": `Red`,\n    \"green\": `Green`,\n    \"blue\": `Blue`,\n    \"alpha\": `Alpha`\n};\n\n\nvar $92fee9698e4d675a$exports = {};\n$92fee9698e4d675a$exports = {\n    \"alpha\": `Alpha`,\n    \"blue\": `Azul`,\n    \"brightness\": `Brillo`,\n    \"green\": `Verde`,\n    \"hue\": `Tono`,\n    \"lightness\": `Luminosidad`,\n    \"red\": `Rojo`,\n    \"saturation\": `Saturación`\n};\n\n\nvar $7ea012e91a5ad3ee$exports = {};\n$7ea012e91a5ad3ee$exports = {\n    \"alpha\": `Alfa`,\n    \"blue\": `Sinine`,\n    \"brightness\": `Heledus`,\n    \"green\": `Roheline`,\n    \"hue\": `Värv`,\n    \"lightness\": `Valgus`,\n    \"red\": `Punane`,\n    \"saturation\": `Küllastus`\n};\n\n\nvar $8460c13bb2d75345$exports = {};\n$8460c13bb2d75345$exports = {\n    \"alpha\": `Alpha`,\n    \"blue\": `Sininen`,\n    \"brightness\": `Kirkkaus`,\n    \"green\": `Vihreä`,\n    \"hue\": `Sävy`,\n    \"lightness\": `Valomäärä`,\n    \"red\": `Punainen`,\n    \"saturation\": `Värikylläisyys`\n};\n\n\nvar $2a2d5dc14e680587$exports = {};\n$2a2d5dc14e680587$exports = {\n    \"alpha\": `Alpha`,\n    \"blue\": `Bleu`,\n    \"brightness\": `Luminosité`,\n    \"green\": `Vert`,\n    \"hue\": `Teinte`,\n    \"lightness\": `Luminosité`,\n    \"red\": `Rouge`,\n    \"saturation\": `Saturation`\n};\n\n\nvar $9a3f292371bb0589$exports = {};\n$9a3f292371bb0589$exports = {\n    \"alpha\": `אלפא`,\n    \"blue\": `כחול`,\n    \"brightness\": `בהירות`,\n    \"green\": `ירוק`,\n    \"hue\": `גוון`,\n    \"lightness\": `כמות אור`,\n    \"red\": `אדום`,\n    \"saturation\": `רוויה`\n};\n\n\nvar $4742231a685fa068$exports = {};\n$4742231a685fa068$exports = {\n    \"alpha\": `Alfa`,\n    \"blue\": `Plava`,\n    \"brightness\": `Svjetlina`,\n    \"green\": `Zelena`,\n    \"hue\": `Nijansa`,\n    \"lightness\": `Osvijetljenost`,\n    \"red\": `Crvena`,\n    \"saturation\": `Zasićenost`\n};\n\n\nvar $05e247fd2960981e$exports = {};\n$05e247fd2960981e$exports = {\n    \"alpha\": `Alfa`,\n    \"blue\": `Kék`,\n    \"brightness\": `Fényesség`,\n    \"green\": `Zöld`,\n    \"hue\": `Színárnyalat`,\n    \"lightness\": `Világosság`,\n    \"red\": `Piros`,\n    \"saturation\": `Telítettség`\n};\n\n\nvar $a67524a79ccbe190$exports = {};\n$a67524a79ccbe190$exports = {\n    \"alpha\": `Alfa`,\n    \"blue\": `Blu`,\n    \"brightness\": `Luminosità`,\n    \"green\": `Verde`,\n    \"hue\": `Tonalità`,\n    \"lightness\": `Luminosità`,\n    \"red\": `Rosso`,\n    \"saturation\": `Saturazione`\n};\n\n\nvar $a9eefe9d6c8cb7d5$exports = {};\n$a9eefe9d6c8cb7d5$exports = {\n    \"alpha\": `アルファ`,\n    \"blue\": `青`,\n    \"brightness\": `明るさ`,\n    \"green\": `緑`,\n    \"hue\": `色相`,\n    \"lightness\": `明度`,\n    \"red\": `赤`,\n    \"saturation\": `彩度`\n};\n\n\nvar $4a6b836d4f1bfaba$exports = {};\n$4a6b836d4f1bfaba$exports = {\n    \"alpha\": `알파`,\n    \"blue\": `파랑`,\n    \"brightness\": `명도`,\n    \"green\": `초록`,\n    \"hue\": `색조`,\n    \"lightness\": `밝기`,\n    \"red\": `빨강`,\n    \"saturation\": `채도`\n};\n\n\nvar $c950e4b1c482abde$exports = {};\n$c950e4b1c482abde$exports = {\n    \"alpha\": `Alfa`,\n    \"blue\": `Mėlyna`,\n    \"brightness\": `Ryškumas`,\n    \"green\": `Žalia`,\n    \"hue\": `Atspalvis`,\n    \"lightness\": `Šviesumas`,\n    \"red\": `Raudona`,\n    \"saturation\": `Įsotinimas`\n};\n\n\nvar $d10d6b60dc50b438$exports = {};\n$d10d6b60dc50b438$exports = {\n    \"alpha\": `Alfa`,\n    \"blue\": `Zila`,\n    \"brightness\": `Spilgtums`,\n    \"green\": `Zaļa`,\n    \"hue\": `Nokrāsa`,\n    \"lightness\": `Gaišums`,\n    \"red\": `Sarkana`,\n    \"saturation\": `Piesātinājums`\n};\n\n\nvar $371a732b2494f452$exports = {};\n$371a732b2494f452$exports = {\n    \"alpha\": `Alfa`,\n    \"blue\": `Blå`,\n    \"brightness\": `Lysstyrke`,\n    \"green\": `Grønn`,\n    \"hue\": `Fargetone`,\n    \"lightness\": `Lyshet`,\n    \"red\": `Rød`,\n    \"saturation\": `Metning`\n};\n\n\nvar $6d042cae6243464b$exports = {};\n$6d042cae6243464b$exports = {\n    \"alpha\": `Alfa`,\n    \"blue\": `Blauw`,\n    \"brightness\": `Helderheid`,\n    \"green\": `Groen`,\n    \"hue\": `Kleurtoon`,\n    \"lightness\": `Lichtsterkte`,\n    \"red\": `Rood`,\n    \"saturation\": `Verzadiging`\n};\n\n\nvar $d9ab5c2611e0bcd3$exports = {};\n$d9ab5c2611e0bcd3$exports = {\n    \"alpha\": `Alfa`,\n    \"blue\": `Niebieski`,\n    \"brightness\": `Jasność`,\n    \"green\": `Zielony`,\n    \"hue\": `Odcień`,\n    \"lightness\": `Jaskrawość`,\n    \"red\": `Czerwony`,\n    \"saturation\": `Nasycenie`\n};\n\n\nvar $73f77c9902e29ca6$exports = {};\n$73f77c9902e29ca6$exports = {\n    \"alpha\": `Alfa`,\n    \"blue\": `Azul`,\n    \"brightness\": `Brilho`,\n    \"green\": `Verde`,\n    \"hue\": `Matiz`,\n    \"lightness\": `Luminosidade`,\n    \"red\": `Vermelho`,\n    \"saturation\": `Saturação`\n};\n\n\nvar $4f461eb266a95c10$exports = {};\n$4f461eb266a95c10$exports = {\n    \"alpha\": `Alfa`,\n    \"blue\": `Azul`,\n    \"brightness\": `Luminosidade`,\n    \"green\": `Verde`,\n    \"hue\": `Tonalidade`,\n    \"lightness\": `Claridade`,\n    \"red\": `Vermelho`,\n    \"saturation\": `Saturação`\n};\n\n\nvar $dc46bea2f2597899$exports = {};\n$dc46bea2f2597899$exports = {\n    \"alpha\": `Alfa`,\n    \"blue\": `Albastru`,\n    \"brightness\": `Luminozitate`,\n    \"green\": `Verde`,\n    \"hue\": `Nuanță`,\n    \"lightness\": `Luminozitate`,\n    \"red\": `Roșu`,\n    \"saturation\": `Saturație`\n};\n\n\nvar $622bbd6719cc95af$exports = {};\n$622bbd6719cc95af$exports = {\n    \"alpha\": `Альфа`,\n    \"blue\": `Синий`,\n    \"brightness\": `Яркость`,\n    \"green\": `Зеленый`,\n    \"hue\": `Оттенок`,\n    \"lightness\": `Освещенность`,\n    \"red\": `Красный`,\n    \"saturation\": `Насыщенность`\n};\n\n\nvar $4da03c1ecd9a9c7d$exports = {};\n$4da03c1ecd9a9c7d$exports = {\n    \"alpha\": `Alfa`,\n    \"blue\": `Modrá`,\n    \"brightness\": `Jas`,\n    \"green\": `Zelená`,\n    \"hue\": `Odtieň`,\n    \"lightness\": `Svetlosť`,\n    \"red\": `Červená`,\n    \"saturation\": `Sýtosť`\n};\n\n\nvar $edb6b2fe456ed4e8$exports = {};\n$edb6b2fe456ed4e8$exports = {\n    \"alpha\": `Alfa`,\n    \"blue\": `Modra`,\n    \"brightness\": `Svetlost`,\n    \"green\": `Zelena`,\n    \"hue\": `Barva`,\n    \"lightness\": `Lahkost`,\n    \"red\": `Rdeča`,\n    \"saturation\": `Nasičenost`\n};\n\n\nvar $264cd81c52b30815$exports = {};\n$264cd81c52b30815$exports = {\n    \"alpha\": `Alfa`,\n    \"blue\": `Plava`,\n    \"brightness\": `Osvetljenost`,\n    \"green\": `Zelena`,\n    \"hue\": `Nijansa`,\n    \"lightness\": `Osvetljenje`,\n    \"red\": `Crvena`,\n    \"saturation\": `Zasićenje`\n};\n\n\nvar $6f80afde0270dda7$exports = {};\n$6f80afde0270dda7$exports = {\n    \"alpha\": `Alfa`,\n    \"blue\": `Blått`,\n    \"brightness\": `Ljusstyrka`,\n    \"green\": `Grönt`,\n    \"hue\": `Nyans`,\n    \"lightness\": `Ljushet`,\n    \"red\": `Rött`,\n    \"saturation\": `Mättnad`\n};\n\n\nvar $23a92651c6957668$exports = {};\n$23a92651c6957668$exports = {\n    \"alpha\": `Alfa`,\n    \"blue\": `Mavi`,\n    \"brightness\": `Parlaklık`,\n    \"green\": `Yeşil`,\n    \"hue\": `Ton`,\n    \"lightness\": `Canlılık`,\n    \"red\": `Kırmızı`,\n    \"saturation\": `Doygunluk`\n};\n\n\nvar $0f9b1074d04f4954$exports = {};\n$0f9b1074d04f4954$exports = {\n    \"alpha\": `Альфа`,\n    \"blue\": `Синій`,\n    \"brightness\": `Яскравість`,\n    \"green\": `Зелений`,\n    \"hue\": `Тон`,\n    \"lightness\": `Освітленість`,\n    \"red\": `Червоний`,\n    \"saturation\": `Насиченість`\n};\n\n\nvar $a9cedf75b94e4916$exports = {};\n$a9cedf75b94e4916$exports = {\n    \"alpha\": `Alpha`,\n    \"blue\": `蓝色`,\n    \"brightness\": `亮度`,\n    \"green\": `绿色`,\n    \"hue\": `色相`,\n    \"lightness\": `明亮度`,\n    \"red\": `红色`,\n    \"saturation\": `饱和度`\n};\n\n\nvar $37cff576474bc8d4$exports = {};\n$37cff576474bc8d4$exports = {\n    \"alpha\": `Alpha`,\n    \"blue\": `藍色`,\n    \"brightness\": `亮度`,\n    \"green\": `綠色`,\n    \"hue\": `色相`,\n    \"lightness\": `明亮`,\n    \"red\": `紅色`,\n    \"saturation\": `飽和度`\n};\n\n\n$7a451c0c6841e6b9$exports = {\n    \"ar-AE\": $2d805fd52bb48883$exports,\n    \"bg-BG\": $6c28468dc1df643c$exports,\n    \"cs-CZ\": $807554f8230db0ed$exports,\n    \"da-DK\": $7097f64386f1761c$exports,\n    \"de-DE\": $bdd847d8beb08799$exports,\n    \"el-GR\": $a53e00b683950971$exports,\n    \"en-US\": $21cdd87e84f28d89$exports,\n    \"es-ES\": $92fee9698e4d675a$exports,\n    \"et-EE\": $7ea012e91a5ad3ee$exports,\n    \"fi-FI\": $8460c13bb2d75345$exports,\n    \"fr-FR\": $2a2d5dc14e680587$exports,\n    \"he-IL\": $9a3f292371bb0589$exports,\n    \"hr-HR\": $4742231a685fa068$exports,\n    \"hu-HU\": $05e247fd2960981e$exports,\n    \"it-IT\": $a67524a79ccbe190$exports,\n    \"ja-JP\": $a9eefe9d6c8cb7d5$exports,\n    \"ko-KR\": $4a6b836d4f1bfaba$exports,\n    \"lt-LT\": $c950e4b1c482abde$exports,\n    \"lv-LV\": $d10d6b60dc50b438$exports,\n    \"nb-NO\": $371a732b2494f452$exports,\n    \"nl-NL\": $6d042cae6243464b$exports,\n    \"pl-PL\": $d9ab5c2611e0bcd3$exports,\n    \"pt-BR\": $73f77c9902e29ca6$exports,\n    \"pt-PT\": $4f461eb266a95c10$exports,\n    \"ro-RO\": $dc46bea2f2597899$exports,\n    \"ru-RU\": $622bbd6719cc95af$exports,\n    \"sk-SK\": $4da03c1ecd9a9c7d$exports,\n    \"sl-SI\": $edb6b2fe456ed4e8$exports,\n    \"sr-SP\": $264cd81c52b30815$exports,\n    \"sv-SE\": $6f80afde0270dda7$exports,\n    \"tr-TR\": $23a92651c6957668$exports,\n    \"uk-UA\": $0f9b1074d04f4954$exports,\n    \"zh-CN\": $a9cedf75b94e4916$exports,\n    \"zh-TW\": $37cff576474bc8d4$exports\n};\n\n\n\n\nconst $799cddbef784668f$var$strings = new $cBgAy$LocalizedStringDictionary((/*@__PURE__*/$parcel$interopDefault($7a451c0c6841e6b9$exports)));\nfunction $799cddbef784668f$export$6e865ea70d7724f(value) {\n    let res = $799cddbef784668f$var$RGBColor.parse(value) || $799cddbef784668f$var$HSBColor.parse(value) || $799cddbef784668f$var$HSLColor.parse(value);\n    if (res) return res;\n    throw new Error('Invalid color value: ' + value);\n}\nfunction $799cddbef784668f$export$4cde5df63f53f473(v) {\n    if (typeof v === 'string') return $799cddbef784668f$export$6e865ea70d7724f(v);\n    else return v;\n}\nclass $799cddbef784668f$var$Color {\n    toHexInt() {\n        return this.toFormat('rgb').toHexInt();\n    }\n    getChannelValue(channel) {\n        if (channel in this) return this[channel];\n        throw new Error('Unsupported color channel: ' + channel);\n    }\n    withChannelValue(channel, value) {\n        if (channel in this) {\n            let x = this.clone();\n            x[channel] = value;\n            return x;\n        }\n        throw new Error('Unsupported color channel: ' + channel);\n    }\n    getChannelName(channel, locale) {\n        return $799cddbef784668f$var$strings.getStringForLocale(channel, locale);\n    }\n    getColorSpaceAxes(xyChannels) {\n        let { xChannel: xChannel , yChannel: yChannel  } = xyChannels;\n        let xCh = xChannel || this.getColorChannels().find((c)=>c !== yChannel\n        );\n        let yCh = yChannel || this.getColorChannels().find((c)=>c !== xCh\n        );\n        let zCh = this.getColorChannels().find((c)=>c !== xCh && c !== yCh\n        );\n        return {\n            xChannel: xCh,\n            yChannel: yCh,\n            zChannel: zCh\n        };\n    }\n}\nclass $799cddbef784668f$var$RGBColor extends $799cddbef784668f$var$Color {\n    static parse(value1) {\n        let colors = [];\n        // matching #rgb, #rgba, #rrggbb, #rrggbbaa\n        if (/^#[\\da-f]+$/i.test(value1) && [\n            4,\n            5,\n            7,\n            9\n        ].includes(value1.length)) {\n            const values = (value1.length < 6 ? value1.replace(/[^#]/gi, '$&$&') : value1).slice(1).split('');\n            while(values.length > 0)colors.push(parseInt(values.splice(0, 2).join(''), 16));\n            colors[3] = colors[3] !== undefined ? colors[3] / 255 : undefined;\n        }\n        // matching rgb(rrr, ggg, bbb), rgba(rrr, ggg, bbb, 0.a)\n        const match = value1.match(/^rgba?\\((.*)\\)$/);\n        if (match === null || match === void 0 ? void 0 : match[1]) {\n            colors = match[1].split(',').map((value)=>Number(value.trim())\n            );\n            colors = colors.map((num, i)=>$cBgAy$clamp(num, 0, i < 3 ? 255 : 1)\n            );\n        }\n        var ref;\n        return colors.length < 3 ? undefined : new $799cddbef784668f$var$RGBColor(colors[0], colors[1], colors[2], (ref = colors[3]) !== null && ref !== void 0 ? ref : 1);\n    }\n    toString(format) {\n        switch(format){\n            case 'hex':\n                return '#' + (this.red.toString(16).padStart(2, '0') + this.green.toString(16).padStart(2, '0') + this.blue.toString(16).padStart(2, '0')).toUpperCase();\n            case 'hexa':\n                return '#' + (this.red.toString(16).padStart(2, '0') + this.green.toString(16).padStart(2, '0') + this.blue.toString(16).padStart(2, '0') + Math.round(this.alpha * 255).toString(16).padStart(2, '0')).toUpperCase();\n            case 'rgb':\n                return `rgb(${this.red}, ${this.green}, ${this.blue})`;\n            case 'css':\n            case 'rgba':\n                return `rgba(${this.red}, ${this.green}, ${this.blue}, ${this.alpha})`;\n            default:\n                return this.toFormat(format).toString(format);\n        }\n    }\n    toFormat(format) {\n        switch(format){\n            case 'hex':\n            case 'hexa':\n            case 'rgb':\n            case 'rgba':\n                return this;\n            case 'hsb':\n            case 'hsba':\n                return this.toHSB();\n            case 'hsl':\n            case 'hsla':\n                return this.toHSL();\n            default:\n                throw new Error('Unsupported color conversion: rgb -> ' + format);\n        }\n    }\n    toHexInt() {\n        return this.red << 16 | this.green << 8 | this.blue;\n    }\n    /**\n   * Converts an RGB color value to HSB.\n   * Conversion formula adapted from https://en.wikipedia.org/wiki/HSL_and_HSV#From_RGB.\n   * @returns An HSBColor object.\n   */ toHSB() {\n        const red = this.red / 255;\n        const green = this.green / 255;\n        const blue = this.blue / 255;\n        const min = Math.min(red, green, blue);\n        const brightness = Math.max(red, green, blue);\n        const chroma = brightness - min;\n        const saturation = brightness === 0 ? 0 : chroma / brightness;\n        let hue = 0; // achromatic\n        if (chroma !== 0) {\n            switch(brightness){\n                case red:\n                    hue = (green - blue) / chroma + (green < blue ? 6 : 0);\n                    break;\n                case green:\n                    hue = (blue - red) / chroma + 2;\n                    break;\n                case blue:\n                    hue = (red - green) / chroma + 4;\n                    break;\n            }\n            hue /= 6;\n        }\n        return new $799cddbef784668f$var$HSBColor($cBgAy$toFixedNumber(hue * 360, 2), $cBgAy$toFixedNumber(saturation * 100, 2), $cBgAy$toFixedNumber(brightness * 100, 2), this.alpha);\n    }\n    /**\n   * Converts an RGB color value to HSL.\n   * Conversion formula adapted from https://en.wikipedia.org/wiki/HSL_and_HSV#From_RGB.\n   * @returns An HSLColor object.\n   */ toHSL() {\n        const red = this.red / 255;\n        const green = this.green / 255;\n        const blue = this.blue / 255;\n        const min = Math.min(red, green, blue);\n        const max = Math.max(red, green, blue);\n        const lightness = (max + min) / 2;\n        const chroma = max - min;\n        let hue;\n        let saturation;\n        if (chroma === 0) hue = saturation = 0; // achromatic\n        else {\n            saturation = chroma / (lightness < 0.5 ? max + min : 2 - max - min);\n            switch(max){\n                case red:\n                    hue = (green - blue) / chroma + (green < blue ? 6 : 0);\n                    break;\n                case green:\n                    hue = (blue - red) / chroma + 2;\n                    break;\n                case blue:\n                    hue = (red - green) / chroma + 4;\n                    break;\n            }\n            hue /= 6;\n        }\n        return new $799cddbef784668f$var$HSLColor($cBgAy$toFixedNumber(hue * 360, 2), $cBgAy$toFixedNumber(saturation * 100, 2), $cBgAy$toFixedNumber(lightness * 100, 2), this.alpha);\n    }\n    clone() {\n        return new $799cddbef784668f$var$RGBColor(this.red, this.green, this.blue, this.alpha);\n    }\n    getChannelRange(channel) {\n        switch(channel){\n            case 'red':\n            case 'green':\n            case 'blue':\n                return {\n                    minValue: 0,\n                    maxValue: 255,\n                    step: 1,\n                    pageSize: 17\n                };\n            case 'alpha':\n                return {\n                    minValue: 0,\n                    maxValue: 1,\n                    step: 0.01,\n                    pageSize: 0.1\n                };\n            default:\n                throw new Error('Unknown color channel: ' + channel);\n        }\n    }\n    formatChannelValue(channel, locale) {\n        let options;\n        let value = this.getChannelValue(channel);\n        switch(channel){\n            case 'red':\n            case 'green':\n            case 'blue':\n                options = {\n                    style: 'decimal'\n                };\n                break;\n            case 'alpha':\n                options = {\n                    style: 'percent'\n                };\n                break;\n            default:\n                throw new Error('Unknown color channel: ' + channel);\n        }\n        return new $cBgAy$NumberFormatter(locale, options).format(value);\n    }\n    getColorSpace() {\n        return 'rgb';\n    }\n    getColorChannels() {\n        return $799cddbef784668f$var$RGBColor.colorChannels;\n    }\n    constructor(red, green, blue, alpha){\n        super();\n        this.red = red;\n        this.green = green;\n        this.blue = blue;\n        this.alpha = alpha;\n    }\n}\n$799cddbef784668f$var$RGBColor.colorChannels = [\n    'red',\n    'green',\n    'blue'\n];\n// X = <negative/positive number with/without decimal places>\n// before/after a comma, 0 or more whitespaces are allowed\n// - hsb(X, X%, X%)\n// - hsba(X, X%, X%, X)\nconst $799cddbef784668f$var$HSB_REGEX = /hsb\\(([-+]?\\d+(?:.\\d+)?\\s*,\\s*[-+]?\\d+(?:.\\d+)?%\\s*,\\s*[-+]?\\d+(?:.\\d+)?%)\\)|hsba\\(([-+]?\\d+(?:.\\d+)?\\s*,\\s*[-+]?\\d+(?:.\\d+)?%\\s*,\\s*[-+]?\\d+(?:.\\d+)?%\\s*,\\s*[-+]?\\d(.\\d+)?)\\)/;\nclass $799cddbef784668f$var$HSBColor extends $799cddbef784668f$var$Color {\n    static parse(value) {\n        let m;\n        if (m = value.match($799cddbef784668f$var$HSB_REGEX)) {\n            var ref;\n            const [h, s, b, a] = ((ref = m[1]) !== null && ref !== void 0 ? ref : m[2]).split(',').map((n)=>Number(n.trim().replace('%', ''))\n            );\n            return new $799cddbef784668f$var$HSBColor($799cddbef784668f$var$mod(h, 360), $cBgAy$clamp(s, 0, 100), $cBgAy$clamp(b, 0, 100), $cBgAy$clamp(a !== null && a !== void 0 ? a : 1, 0, 1));\n        }\n    }\n    toString(format) {\n        switch(format){\n            case 'css':\n                return this.toHSL().toString('css');\n            case 'hex':\n                return this.toRGB().toString('hex');\n            case 'hexa':\n                return this.toRGB().toString('hexa');\n            case 'hsb':\n                return `hsb(${this.hue}, ${$cBgAy$toFixedNumber(this.saturation, 2)}%, ${$cBgAy$toFixedNumber(this.brightness, 2)}%)`;\n            case 'hsba':\n                return `hsba(${this.hue}, ${$cBgAy$toFixedNumber(this.saturation, 2)}%, ${$cBgAy$toFixedNumber(this.brightness, 2)}%, ${this.alpha})`;\n            default:\n                return this.toFormat(format).toString(format);\n        }\n    }\n    toFormat(format) {\n        switch(format){\n            case 'hsb':\n            case 'hsba':\n                return this;\n            case 'hsl':\n            case 'hsla':\n                return this.toHSL();\n            case 'rgb':\n            case 'rgba':\n                return this.toRGB();\n            default:\n                throw new Error('Unsupported color conversion: hsb -> ' + format);\n        }\n    }\n    /**\n   * Converts a HSB color to HSL.\n   * Conversion formula adapted from https://en.wikipedia.org/wiki/HSL_and_HSV#HSV_to_HSL.\n   * @returns An HSLColor object.\n   */ toHSL() {\n        let saturation = this.saturation / 100;\n        let brightness = this.brightness / 100;\n        let lightness = brightness * (1 - saturation / 2);\n        saturation = lightness === 0 || lightness === 1 ? 0 : (brightness - lightness) / Math.min(lightness, 1 - lightness);\n        return new $799cddbef784668f$var$HSLColor($cBgAy$toFixedNumber(this.hue, 2), $cBgAy$toFixedNumber(saturation * 100, 2), $cBgAy$toFixedNumber(lightness * 100, 2), this.alpha);\n    }\n    /**\n   * Converts a HSV color value to RGB.\n   * Conversion formula adapted from https://en.wikipedia.org/wiki/HSL_and_HSV#HSV_to_RGB_alternative.\n   * @returns An RGBColor object.\n   */ toRGB() {\n        let hue = this.hue;\n        let saturation = this.saturation / 100;\n        let brightness = this.brightness / 100;\n        let fn = (n, k = (n + hue / 60) % 6)=>brightness - saturation * brightness * Math.max(Math.min(k, 4 - k, 1), 0)\n        ;\n        return new $799cddbef784668f$var$RGBColor(Math.round(fn(5) * 255), Math.round(fn(3) * 255), Math.round(fn(1) * 255), this.alpha);\n    }\n    clone() {\n        return new $799cddbef784668f$var$HSBColor(this.hue, this.saturation, this.brightness, this.alpha);\n    }\n    getChannelRange(channel) {\n        switch(channel){\n            case 'hue':\n                return {\n                    minValue: 0,\n                    maxValue: 360,\n                    step: 1,\n                    pageSize: 15\n                };\n            case 'saturation':\n            case 'brightness':\n                return {\n                    minValue: 0,\n                    maxValue: 100,\n                    step: 1,\n                    pageSize: 10\n                };\n            case 'alpha':\n                return {\n                    minValue: 0,\n                    maxValue: 1,\n                    step: 0.01,\n                    pageSize: 0.1\n                };\n            default:\n                throw new Error('Unknown color channel: ' + channel);\n        }\n    }\n    formatChannelValue(channel, locale) {\n        let options;\n        let value = this.getChannelValue(channel);\n        switch(channel){\n            case 'hue':\n                options = {\n                    style: 'unit',\n                    unit: 'degree',\n                    unitDisplay: 'narrow'\n                };\n                break;\n            case 'saturation':\n            case 'brightness':\n                options = {\n                    style: 'percent'\n                };\n                value /= 100;\n                break;\n            case 'alpha':\n                options = {\n                    style: 'percent'\n                };\n                break;\n            default:\n                throw new Error('Unknown color channel: ' + channel);\n        }\n        return new $cBgAy$NumberFormatter(locale, options).format(value);\n    }\n    getColorSpace() {\n        return 'hsb';\n    }\n    getColorChannels() {\n        return $799cddbef784668f$var$HSBColor.colorChannels;\n    }\n    constructor(hue, saturation, brightness, alpha){\n        super();\n        this.hue = hue;\n        this.saturation = saturation;\n        this.brightness = brightness;\n        this.alpha = alpha;\n    }\n}\n$799cddbef784668f$var$HSBColor.colorChannels = [\n    'hue',\n    'saturation',\n    'brightness'\n];\n// X = <negative/positive number with/without decimal places>\n// before/after a comma, 0 or more whitespaces are allowed\n// - hsl(X, X%, X%)\n// - hsla(X, X%, X%, X)\nconst $799cddbef784668f$var$HSL_REGEX = /hsl\\(([-+]?\\d+(?:.\\d+)?\\s*,\\s*[-+]?\\d+(?:.\\d+)?%\\s*,\\s*[-+]?\\d+(?:.\\d+)?%)\\)|hsla\\(([-+]?\\d+(?:.\\d+)?\\s*,\\s*[-+]?\\d+(?:.\\d+)?%\\s*,\\s*[-+]?\\d+(?:.\\d+)?%\\s*,\\s*[-+]?\\d(.\\d+)?)\\)/;\nfunction $799cddbef784668f$var$mod(n, m) {\n    return (n % m + m) % m;\n}\nclass $799cddbef784668f$var$HSLColor extends $799cddbef784668f$var$Color {\n    static parse(value) {\n        let m;\n        if (m = value.match($799cddbef784668f$var$HSL_REGEX)) {\n            var ref;\n            const [h, s, l, a] = ((ref = m[1]) !== null && ref !== void 0 ? ref : m[2]).split(',').map((n)=>Number(n.trim().replace('%', ''))\n            );\n            return new $799cddbef784668f$var$HSLColor($799cddbef784668f$var$mod(h, 360), $cBgAy$clamp(s, 0, 100), $cBgAy$clamp(l, 0, 100), $cBgAy$clamp(a !== null && a !== void 0 ? a : 1, 0, 1));\n        }\n    }\n    toString(format) {\n        switch(format){\n            case 'hex':\n                return this.toRGB().toString('hex');\n            case 'hexa':\n                return this.toRGB().toString('hexa');\n            case 'hsl':\n                return `hsl(${this.hue}, ${$cBgAy$toFixedNumber(this.saturation, 2)}%, ${$cBgAy$toFixedNumber(this.lightness, 2)}%)`;\n            case 'css':\n            case 'hsla':\n                return `hsla(${this.hue}, ${$cBgAy$toFixedNumber(this.saturation, 2)}%, ${$cBgAy$toFixedNumber(this.lightness, 2)}%, ${this.alpha})`;\n            default:\n                return this.toFormat(format).toString(format);\n        }\n    }\n    toFormat(format) {\n        switch(format){\n            case 'hsl':\n            case 'hsla':\n                return this;\n            case 'hsb':\n            case 'hsba':\n                return this.toHSB();\n            case 'rgb':\n            case 'rgba':\n                return this.toRGB();\n            default:\n                throw new Error('Unsupported color conversion: hsl -> ' + format);\n        }\n    }\n    /**\n   * Converts a HSL color to HSB.\n   * Conversion formula adapted from https://en.wikipedia.org/wiki/HSL_and_HSV#HSL_to_HSV.\n   * @returns An HSBColor object.\n   */ toHSB() {\n        let saturation = this.saturation / 100;\n        let lightness = this.lightness / 100;\n        let brightness = lightness + saturation * Math.min(lightness, 1 - lightness);\n        saturation = brightness === 0 ? 0 : 2 * (1 - lightness / brightness);\n        return new $799cddbef784668f$var$HSBColor($cBgAy$toFixedNumber(this.hue, 2), $cBgAy$toFixedNumber(saturation * 100, 2), $cBgAy$toFixedNumber(brightness * 100, 2), this.alpha);\n    }\n    /**\n   * Converts a HSL color to RGB.\n   * Conversion formula adapted from https://en.wikipedia.org/wiki/HSL_and_HSV#HSL_to_RGB_alternative.\n   * @returns An RGBColor object.\n   */ toRGB() {\n        let hue = this.hue;\n        let saturation = this.saturation / 100;\n        let lightness = this.lightness / 100;\n        let a = saturation * Math.min(lightness, 1 - lightness);\n        let fn = (n, k = (n + hue / 30) % 12)=>lightness - a * Math.max(Math.min(k - 3, 9 - k, 1), -1)\n        ;\n        return new $799cddbef784668f$var$RGBColor(Math.round(fn(0) * 255), Math.round(fn(8) * 255), Math.round(fn(4) * 255), this.alpha);\n    }\n    clone() {\n        return new $799cddbef784668f$var$HSLColor(this.hue, this.saturation, this.lightness, this.alpha);\n    }\n    getChannelRange(channel) {\n        switch(channel){\n            case 'hue':\n                return {\n                    minValue: 0,\n                    maxValue: 360,\n                    step: 1,\n                    pageSize: 15\n                };\n            case 'saturation':\n            case 'lightness':\n                return {\n                    minValue: 0,\n                    maxValue: 100,\n                    step: 1,\n                    pageSize: 10\n                };\n            case 'alpha':\n                return {\n                    minValue: 0,\n                    maxValue: 1,\n                    step: 0.01,\n                    pageSize: 0.1\n                };\n            default:\n                throw new Error('Unknown color channel: ' + channel);\n        }\n    }\n    formatChannelValue(channel, locale) {\n        let options;\n        let value = this.getChannelValue(channel);\n        switch(channel){\n            case 'hue':\n                options = {\n                    style: 'unit',\n                    unit: 'degree',\n                    unitDisplay: 'narrow'\n                };\n                break;\n            case 'saturation':\n            case 'lightness':\n                options = {\n                    style: 'percent'\n                };\n                value /= 100;\n                break;\n            case 'alpha':\n                options = {\n                    style: 'percent'\n                };\n                break;\n            default:\n                throw new Error('Unknown color channel: ' + channel);\n        }\n        return new $cBgAy$NumberFormatter(locale, options).format(value);\n    }\n    getColorSpace() {\n        return 'hsl';\n    }\n    getColorChannels() {\n        return $799cddbef784668f$var$HSLColor.colorChannels;\n    }\n    constructor(hue, saturation, lightness, alpha){\n        super();\n        this.hue = hue;\n        this.saturation = saturation;\n        this.lightness = lightness;\n        this.alpha = alpha;\n    }\n}\n$799cddbef784668f$var$HSLColor.colorChannels = [\n    'hue',\n    'saturation',\n    'lightness'\n];\n\n\n\n\n\nconst $6e14a98a7f67141d$var$DEFAULT_COLOR = $799cddbef784668f$export$6e865ea70d7724f('#ffffff');\nfunction $6e14a98a7f67141d$export$6df7f0e2cabc7eef(props) {\n    let { value: value1 , defaultValue: defaultValue , xChannel: xChannel , yChannel: yChannel , onChange: onChange , onChangeEnd: onChangeEnd  } = props;\n    if (!value1 && !defaultValue) defaultValue = $6e14a98a7f67141d$var$DEFAULT_COLOR;\n    let [color, setColor] = $cBgAy$useControlledState(value1 && $799cddbef784668f$export$4cde5df63f53f473(value1), defaultValue && $799cddbef784668f$export$4cde5df63f53f473(defaultValue), onChange);\n    let valueRef = $cBgAy$useRef(color);\n    valueRef.current = color;\n    let channels = $cBgAy$useMemo(()=>valueRef.current.getColorSpaceAxes({\n            xChannel: xChannel,\n            yChannel: yChannel\n        })\n    , [\n        xChannel,\n        yChannel\n    ]);\n    let xChannelRange = color.getChannelRange(channels.xChannel);\n    let yChannelRange = color.getChannelRange(channels.yChannel);\n    let { minValue: minValueX , maxValue: maxValueX , step: stepX , pageSize: pageSizeX  } = xChannelRange;\n    let { minValue: minValueY , maxValue: maxValueY , step: stepY , pageSize: pageSizeY  } = yChannelRange;\n    let [isDragging1, setDragging] = $cBgAy$useState(false);\n    let isDraggingRef = $cBgAy$useRef(false).current;\n    let xValue = color.getChannelValue(channels.xChannel);\n    let yValue = color.getChannelValue(channels.yChannel);\n    let setXValue = (v)=>{\n        if (v === xValue) return;\n        valueRef.current = color.withChannelValue(channels.xChannel, v);\n        setColor(valueRef.current);\n    };\n    let setYValue = (v)=>{\n        if (v === yValue) return;\n        valueRef.current = color.withChannelValue(channels.yChannel, v);\n        setColor(valueRef.current);\n    };\n    return {\n        channels: channels,\n        xChannelStep: stepX,\n        yChannelStep: stepY,\n        xChannelPageStep: pageSizeX,\n        yChannelPageStep: pageSizeY,\n        value: color,\n        setValue (value) {\n            let c = $799cddbef784668f$export$4cde5df63f53f473(value);\n            valueRef.current = c;\n            setColor(c);\n        },\n        xValue: xValue,\n        setXValue: setXValue,\n        yValue: yValue,\n        setYValue: setYValue,\n        setColorFromPoint (x, y) {\n            let newXValue = minValueX + $cBgAy$clamp(x, 0, 1) * (maxValueX - minValueX);\n            let newYValue = minValueY + (1 - $cBgAy$clamp(y, 0, 1)) * (maxValueY - minValueY);\n            let newColor;\n            if (newXValue !== xValue) {\n                // Round new value to multiple of step, clamp value between min and max\n                newXValue = $cBgAy$snapValueToStep(newXValue, minValueX, maxValueX, stepX);\n                newColor = color.withChannelValue(channels.xChannel, newXValue);\n            }\n            if (newYValue !== yValue) {\n                // Round new value to multiple of step, clamp value between min and max\n                newYValue = $cBgAy$snapValueToStep(newYValue, minValueY, maxValueY, stepY);\n                newColor = (newColor || color).withChannelValue(channels.yChannel, newYValue);\n            }\n            if (newColor) setColor(newColor);\n        },\n        getThumbPosition () {\n            let x = (xValue - minValueX) / (maxValueX - minValueX);\n            let y = 1 - (yValue - minValueY) / (maxValueY - minValueY);\n            return {\n                x: x,\n                y: y\n            };\n        },\n        incrementX (stepSize) {\n            setXValue(xValue + stepSize > maxValueX ? maxValueX : $cBgAy$snapValueToStep(xValue + stepSize, minValueX, maxValueX, stepX));\n        },\n        incrementY (stepSize) {\n            setYValue(yValue + stepSize > maxValueY ? maxValueY : $cBgAy$snapValueToStep(yValue + stepSize, minValueY, maxValueY, stepY));\n        },\n        decrementX (stepSize) {\n            setXValue($cBgAy$snapValueToStep(xValue - stepSize, minValueX, maxValueX, stepX));\n        },\n        decrementY (stepSize) {\n            setYValue($cBgAy$snapValueToStep(yValue - stepSize, minValueY, maxValueY, stepY));\n        },\n        setDragging (isDragging) {\n            let wasDragging = isDraggingRef;\n            isDraggingRef = isDragging;\n            if (onChangeEnd && !isDragging && wasDragging) onChangeEnd(valueRef.current);\n            setDragging(isDragging);\n        },\n        isDragging: isDragging1,\n        getDisplayColor () {\n            return color.withChannelValue('alpha', 1);\n        }\n    };\n}\n\n\n\n\n\nfunction $25a25ac0d1624665$export$57bc203e1c9c6d44(props) {\n    let { channel: channel , value: value1 , defaultValue: defaultValue , onChange: onChange , locale: locale , ...otherProps } = props;\n    if (value1 == null && defaultValue == null) throw new Error('useColorSliderState requires a value or defaultValue');\n    let [color, setColor] = $cBgAy$useControlledState(value1 && $799cddbef784668f$export$4cde5df63f53f473(value1), defaultValue && $799cddbef784668f$export$4cde5df63f53f473(defaultValue), onChange);\n    let sliderState = $cBgAy$useSliderState({\n        ...color.getChannelRange(channel),\n        ...otherProps,\n        // Unused except in getThumbValueLabel, which is overridden below. null to appease TypeScript.\n        numberFormatter: null,\n        value: color.getChannelValue(channel),\n        onChange (v) {\n            setColor(color.withChannelValue(channel, v));\n        },\n        onChangeEnd (v) {\n            // onChange will have already been called with the right value, this is just to trigger onChangeEnd\n            if (props.onChangeEnd) props.onChangeEnd(color.withChannelValue(channel, v));\n        }\n    });\n    let { step: step , pageSize: pageSize  } = color.getChannelRange(channel);\n    return {\n        ...sliderState,\n        value: color,\n        setValue (value) {\n            setColor($799cddbef784668f$export$4cde5df63f53f473(value));\n        },\n        getDisplayColor () {\n            switch(channel){\n                case 'hue':\n                    return $799cddbef784668f$export$6e865ea70d7724f(`hsl(${color.getChannelValue('hue')}, 100%, 50%)`);\n                case 'lightness':\n                case 'brightness':\n                case 'saturation':\n                case 'red':\n                case 'green':\n                case 'blue':\n                    return color.withChannelValue('alpha', 1);\n                case 'alpha':\n                    return color;\n                default:\n                    throw new Error('Unknown color channel: ' + channel);\n            }\n        },\n        getThumbValueLabel () {\n            return color.formatChannelValue(channel, locale);\n        },\n        step: step,\n        pageSize: pageSize\n    };\n}\n\n\n\n\n\nconst $ee4262c74a467b07$var$DEFAULT_COLOR = $799cddbef784668f$export$6e865ea70d7724f('hsl(0, 100%, 50%)');\nfunction $ee4262c74a467b07$var$roundToStep(value, step) {\n    return Math.round(value / step) * step;\n}\nfunction $ee4262c74a467b07$var$mod(n, m) {\n    return (n % m + m) % m;\n}\nfunction $ee4262c74a467b07$var$roundDown(v) {\n    let r = Math.floor(v);\n    if (r === v) return v - 1;\n    else return r;\n}\nfunction $ee4262c74a467b07$var$degToRad(deg) {\n    return deg * Math.PI / 180;\n}\nfunction $ee4262c74a467b07$var$radToDeg(rad) {\n    return rad * 180 / Math.PI;\n}\n// 0deg = 3 o'clock. increases clockwise\nfunction $ee4262c74a467b07$var$angleToCartesian(angle, radius) {\n    let rad = $ee4262c74a467b07$var$degToRad(360 - angle + 90);\n    let x = Math.sin(rad) * radius;\n    let y = Math.cos(rad) * radius;\n    return {\n        x: x,\n        y: y\n    };\n}\nfunction $ee4262c74a467b07$var$cartesianToAngle(x, y, radius) {\n    let deg = $ee4262c74a467b07$var$radToDeg(Math.atan2(y / radius, x / radius));\n    return (deg + 360) % 360;\n}\nfunction $ee4262c74a467b07$export$f4301076d9336137(props) {\n    let { defaultValue: defaultValue , onChange: onChange , onChangeEnd: onChangeEnd  } = props;\n    if (!props.value && !defaultValue) defaultValue = $ee4262c74a467b07$var$DEFAULT_COLOR;\n    let [value, setValue] = $cBgAy$useControlledState($799cddbef784668f$export$4cde5df63f53f473(props.value), $799cddbef784668f$export$4cde5df63f53f473(defaultValue), onChange);\n    let valueRef = $cBgAy$useRef(value);\n    valueRef.current = value;\n    let channelRange = value.getChannelRange('hue');\n    let { minValue: minValueX , maxValue: maxValueX , step: step , pageSize: pageStep  } = channelRange;\n    let [isDragging1, setDragging] = $cBgAy$useState(false);\n    let isDraggingRef = $cBgAy$useRef(false).current;\n    let hue = value.getChannelValue('hue');\n    function setHue(v) {\n        if (v > 360) // Make sure you can always get back to 0.\n        v = 0;\n        v = $ee4262c74a467b07$var$roundToStep($ee4262c74a467b07$var$mod(v, 360), step);\n        if (hue !== v) {\n            let color = value.withChannelValue('hue', v);\n            valueRef.current = color;\n            setValue(color);\n        }\n    }\n    return {\n        value: value,\n        step: step,\n        pageStep: pageStep,\n        setValue (v) {\n            let color = $799cddbef784668f$export$4cde5df63f53f473(v);\n            valueRef.current = color;\n            setValue(color);\n        },\n        hue: hue,\n        setHue: setHue,\n        setHueFromPoint (x, y, radius) {\n            setHue($ee4262c74a467b07$var$cartesianToAngle(x, y, radius));\n        },\n        getThumbPosition (radius) {\n            return $ee4262c74a467b07$var$angleToCartesian(value.getChannelValue('hue'), radius);\n        },\n        increment (stepSize = 1) {\n            let s = Math.max(stepSize, step);\n            let newValue = hue + s;\n            if (newValue >= maxValueX) // Make sure you can always get back to 0.\n            newValue = minValueX;\n            setHue($ee4262c74a467b07$var$roundToStep($ee4262c74a467b07$var$mod(newValue, 360), s));\n        },\n        decrement (stepSize = 1) {\n            let s = Math.max(stepSize, step);\n            if (hue === 0) // We can't just subtract step because this might be the case:\n            // |(previous step) - 0| < step size\n            setHue($ee4262c74a467b07$var$roundDown(360 / s) * s);\n            else setHue($ee4262c74a467b07$var$roundToStep($ee4262c74a467b07$var$mod(hue - s, 360), s));\n        },\n        setDragging (isDragging) {\n            let wasDragging = isDraggingRef;\n            isDraggingRef = isDragging;\n            if (onChangeEnd && !isDragging && wasDragging) onChangeEnd(valueRef.current);\n            setDragging(isDragging);\n        },\n        isDragging: isDragging1,\n        getDisplayColor () {\n            return value.toFormat('hsl').withChannelValue('saturation', 100).withChannelValue('lightness', 50).withChannelValue('alpha', 1);\n        }\n    };\n}\n\n\n\n\n\nfunction $aa90ad8b2b1d015f$export$5aadd9c0606af5c2(value) {\n    return $cBgAy$useMemo(()=>{\n        if (typeof value === 'string') try {\n            return $799cddbef784668f$export$6e865ea70d7724f(value);\n        } catch (err) {\n            return undefined;\n        }\n        return value;\n    }, [\n        value\n    ]);\n}\n\n\n\n\nconst $b335ada08155d9c0$var$MIN_COLOR = $799cddbef784668f$export$6e865ea70d7724f('#000000');\nconst $b335ada08155d9c0$var$MAX_COLOR = $799cddbef784668f$export$6e865ea70d7724f('#FFFFFF');\nconst $b335ada08155d9c0$var$MIN_COLOR_INT = $b335ada08155d9c0$var$MIN_COLOR.toHexInt();\nconst $b335ada08155d9c0$var$MAX_COLOR_INT = $b335ada08155d9c0$var$MAX_COLOR.toHexInt();\nfunction $b335ada08155d9c0$export$d52a01683abdfcd6(props) {\n    let { value: value1 , defaultValue: defaultValue , onChange: onChange  } = props;\n    let { step: step  } = $b335ada08155d9c0$var$MIN_COLOR.getChannelRange('red');\n    let initialValue = $aa90ad8b2b1d015f$export$5aadd9c0606af5c2(value1);\n    let initialDefaultValue = $aa90ad8b2b1d015f$export$5aadd9c0606af5c2(defaultValue);\n    let [colorValue, setColorValue] = $cBgAy$useControlledState(initialValue, initialDefaultValue, onChange);\n    let [inputValue, setInputValue] = $cBgAy$useState(()=>(value1 || defaultValue) && colorValue ? colorValue.toString('hex') : ''\n    );\n    let safelySetColorValue = (newColor)=>{\n        if (!colorValue || !newColor) {\n            setColorValue(newColor);\n            return;\n        }\n        if (newColor.toHexInt() !== colorValue.toHexInt()) {\n            setColorValue(newColor);\n            return;\n        }\n    };\n    let prevValue = $cBgAy$useRef(colorValue);\n    if (prevValue.current !== colorValue) {\n        setInputValue(colorValue ? colorValue.toString('hex') : '');\n        prevValue.current = colorValue;\n    }\n    let parsedValue = $cBgAy$useMemo(()=>{\n        let color;\n        try {\n            color = $799cddbef784668f$export$6e865ea70d7724f(inputValue.startsWith('#') ? inputValue : `#${inputValue}`);\n        } catch (err) {\n            color = null;\n        }\n        return color;\n    }, [\n        inputValue\n    ]);\n    let parsed = $cBgAy$useRef(null);\n    parsed.current = parsedValue;\n    let commit = ()=>{\n        // Set to empty state if input value is empty\n        if (!inputValue.length) {\n            safelySetColorValue(null);\n            setInputValue(value1 === undefined ? '' : colorValue.toString('hex'));\n            return;\n        }\n        // if it failed to parse, then reset input to formatted version of current number\n        if (parsed.current == null) {\n            setInputValue(colorValue ? colorValue.toString('hex') : '');\n            return;\n        }\n        safelySetColorValue(parsed.current);\n        // in a controlled state, the numberValue won't change, so we won't go back to our old input without help\n        let newColorValue = '';\n        if (colorValue) newColorValue = colorValue.toString('hex');\n        setInputValue(newColorValue);\n    };\n    let increment = ()=>{\n        let newValue = $b335ada08155d9c0$var$addColorValue(parsed.current, step);\n        // if we've arrived at the same value that was previously in the state, the\n        // input value should be updated to match\n        // ex type 4, press increment, highlight the number in the input, type 4 again, press increment\n        // you'd be at 5, then incrementing to 5 again, so no re-render would happen and 4 would be left in the input\n        if (newValue === colorValue) setInputValue(newValue.toString('hex'));\n        safelySetColorValue(newValue);\n    };\n    let decrement = ()=>{\n        let newValue = $b335ada08155d9c0$var$addColorValue(parsed.current, -step);\n        // if we've arrived at the same value that was previously in the state, the\n        // input value should be updated to match\n        // ex type 4, press increment, highlight the number in the input, type 4 again, press increment\n        // you'd be at 5, then incrementing to 5 again, so no re-render would happen and 4 would be left in the input\n        if (newValue === colorValue) setInputValue(newValue.toString('hex'));\n        safelySetColorValue(newValue);\n    };\n    let incrementToMax = ()=>safelySetColorValue($b335ada08155d9c0$var$MAX_COLOR)\n    ;\n    let decrementToMin = ()=>safelySetColorValue($b335ada08155d9c0$var$MIN_COLOR)\n    ;\n    let validate = (value)=>{\n        var ref;\n        return value === '' || !!((ref = value.match(/^#?[0-9a-f]{0,6}$/i)) === null || ref === void 0 ? void 0 : ref[0]);\n    };\n    return {\n        validate: validate,\n        colorValue: colorValue,\n        inputValue: inputValue,\n        setInputValue: setInputValue,\n        commit: commit,\n        increment: increment,\n        incrementToMax: incrementToMax,\n        decrement: decrement,\n        decrementToMin: decrementToMin\n    };\n}\nfunction $b335ada08155d9c0$var$addColorValue(color, step) {\n    let newColor = color ? color : $b335ada08155d9c0$var$MIN_COLOR;\n    let colorInt = newColor.toHexInt();\n    let clampInt = Math.min(Math.max(colorInt + step, $b335ada08155d9c0$var$MIN_COLOR_INT), $b335ada08155d9c0$var$MAX_COLOR_INT);\n    if (clampInt !== colorInt) {\n        let newColorString = `#${clampInt.toString(16).padStart(6, '0').toUpperCase()}`;\n        newColor = $799cddbef784668f$export$6e865ea70d7724f(newColorString);\n    }\n    return newColor;\n}\n\n\n\n\nexport {$799cddbef784668f$export$6e865ea70d7724f as parseColor, $6e14a98a7f67141d$export$6df7f0e2cabc7eef as useColorAreaState, $25a25ac0d1624665$export$57bc203e1c9c6d44 as useColorSliderState, $ee4262c74a467b07$export$f4301076d9336137 as useColorWheelState, $b335ada08155d9c0$export$d52a01683abdfcd6 as useColorFieldState};\n//# sourceMappingURL=module.js.map\n","import React from 'react';\nimport clsx from 'clsx';\nimport {ButtonBase} from '../buttons/button-base';\n\ntype Props = {\n  onChange?: (e: string) => void;\n  value?: string;\n  colors: string[];\n};\nexport function ColorSwatch({onChange, value, colors}: Props) {\n  const presetButtons = colors.map(color => {\n    const isSelected = value === color;\n    return (\n      <ButtonBase\n        key={color}\n        onClick={() => {\n          onChange?.(color);\n        }}\n        className={clsx(\n          'relative block flex-shrink-0 w-26 h-26 border rounded',\n          isSelected && 'shadow-md'\n        )}\n        style={{backgroundColor: color}}\n      >\n        {isSelected && (\n          <span className=\"absolute inset-0 m-auto rounded-full w-8 h-8 bg-white\" />\n        )}\n      </ButtonBase>\n    );\n  });\n\n  return <div className=\"flex gap-6\">{presetButtons}</div>;\n}\n","import clsx from 'clsx';\nimport {BaseFieldProps} from './base-field-props';\nimport {getButtonSizeStyle, getIconSizeStyle} from '../../buttons/button-size';\n\nexport interface InputFieldStyle {\n  label: string;\n  input: string;\n  wrapper: string;\n  inputWrapper: string;\n  adornment: string;\n  append: {size: string; radius: string};\n  size: {font: string; height: string};\n  description: string;\n  error: string;\n}\n\nexport function getInputFieldClassNames(\n  props: Omit<BaseFieldProps, 'value' | 'defaultValue' | 'onChange'> = {}\n): InputFieldStyle {\n  const {\n    size = 'md',\n    startAdornment,\n    endAdornment,\n    startAppend,\n    endAppend,\n    className,\n    labelPosition,\n    labelDisplay = 'block',\n    inputClassName,\n    inputWrapperClassName,\n    unstyled,\n    invalid,\n    disabled,\n    background = 'transparent',\n    flexibleHeight,\n  } = {...props};\n\n  if (unstyled) {\n    return {\n      label: '',\n      input: inputClassName || '',\n      wrapper: className || '',\n      inputWrapper: inputWrapperClassName || '',\n      adornment: '',\n      append: {size: '', radius: ''},\n      size: {font: '', height: ''},\n      description: '',\n      error: '',\n    };\n  }\n\n  const sizeClass = inputSizeClass({\n    size: props.size,\n    flexibleHeight,\n  });\n  const isInputGroup = startAppend || endAppend;\n  const borderColor = invalid ? 'border-danger' : 'border-divider';\n  const ringColor = invalid\n    ? 'focus:ring-danger/focus focus:border-danger/60'\n    : 'focus:ring-primary/focus focus:border-primary/60';\n\n  return {\n    label: clsx(\n      labelDisplay,\n      'first-letter:capitalize text-left',\n      disabled && 'text-disabled',\n      sizeClass.font,\n      labelPosition === 'side' ? 'mr-16' : 'mb-4'\n    ),\n    input: clsx(\n      'block text-left relative w-full appearance-none transition-shadow text',\n      background === 'transparent' && 'bg-transparent',\n      background === 'bg-alt' && 'bg-alt',\n      background === 'bg-paper' && 'bg-paper',\n\n      // radius\n      !isInputGroup && 'rounded',\n      startAppend && 'rounded-r rounded-l-none',\n      endAppend && 'rounded-l rounded-r-none',\n\n      // border\n      !isInputGroup && `${borderColor} border`,\n      startAppend && `${borderColor} border-y border-r`,\n      endAppend && `${borderColor} border-y border-l`,\n      !disabled && `focus:ring ${ringColor} focus:outline-none shadow-sm`,\n      disabled && 'text-disabled cursor-not-allowed',\n      inputClassName,\n      sizeClass.font,\n      sizeClass.height,\n      startAdornment ? 'pl-46' : 'pl-12',\n      endAdornment ? 'pr-46' : 'pr-12'\n    ),\n    adornment: getIconSizeStyle(size),\n    append: {\n      size: getButtonSizeStyle(size),\n      radius: startAppend ? 'rounded-l' : 'rounded-r',\n    },\n    wrapper: clsx(className, sizeClass.font, {\n      'flex items-center': labelPosition === 'side',\n    }),\n    inputWrapper: clsx(\n      'relative',\n      inputWrapperClassName,\n      isInputGroup && 'flex items-stretch'\n    ),\n    size: sizeClass,\n    description: 'text-muted pt-10 text-xs',\n    error: 'text-danger pt-10 text-xs',\n  };\n}\n\nexport function inputSizeClass({size, flexibleHeight}: BaseFieldProps) {\n  switch (size) {\n    case 'xs':\n      return {font: 'text-xs', height: flexibleHeight ? 'min-h-30' : 'h-30'};\n    case 'sm':\n      return {font: 'text-sm', height: flexibleHeight ? 'min-h-36' : 'h-36'};\n    case 'lg':\n      return {font: 'text-lg', height: flexibleHeight ? 'min-h-50' : 'h-50'};\n    case 'xl':\n      return {font: 'text-xl', height: flexibleHeight ? 'min-h-60' : 'h-60'};\n    default:\n      return {font: 'text-sm', height: flexibleHeight ? 'min-h-42' : 'h-42'};\n  }\n}\n","import {HexColorInput, HexColorPicker} from 'react-colorful';\nimport React, {useState} from 'react';\nimport {parseColor} from '@react-stately/color';\nimport {ColorSwatch} from './color-swatch';\nimport {getInputFieldClassNames} from '../forms/input-field/get-input-field-class-names';\n\nconst defaultPresets = [\n  'rgb(0,0,0)',\n  'rgb(255, 255, 255)',\n  'rgb(242, 38, 19)',\n  'rgb(249, 105, 14)',\n  'rgb(253, 227, 167)',\n  'rgb(4, 147, 114)',\n  'rgb(30, 139, 195)',\n  'rgb(142, 68, 173)',\n];\n\ntype Props = {\n  defaultValue?: string;\n  onChange?: (e: string) => void;\n  colorPresets?: string[];\n  showInput?: boolean;\n};\nexport function ColorPicker({\n  defaultValue,\n  onChange,\n  colorPresets,\n  showInput,\n}: Props) {\n  const [color, setColor] = useState<string | undefined>(defaultValue);\n\n  const presets: string[] = colorPresets || defaultPresets;\n\n  const style = getInputFieldClassNames({size: 'sm'});\n\n  return (\n    <div>\n      <HexColorPicker\n        className=\"!w-auto\"\n        color={color}\n        onChange={newColor => {\n          onChange?.(newColor);\n          setColor(newColor);\n        }}\n      />\n      <div className=\"py-20 px-12\">\n        {presets && (\n          <ColorSwatch\n            colors={presets}\n            onChange={newColor => {\n              if (newColor) {\n                const hex = parseColor(newColor).toString('hex');\n                onChange?.(hex);\n                setColor(hex);\n              }\n            }}\n            value={color}\n          />\n        )}\n        {showInput && (\n          <div className=\"pt-20\">\n            <HexColorInput\n              autoComplete=\"off\"\n              role=\"textbox\"\n              autoCorrect=\"off\"\n              spellCheck=\"false\"\n              required\n              aria-label=\"Hex color\"\n              prefixed\n              className={style.input}\n              color={color}\n              onChange={newColor => {\n                onChange?.(newColor);\n                setColor(newColor);\n              }}\n            />\n          </div>\n        )}\n      </div>\n    </div>\n  );\n}\n","import React, {ComponentPropsWithRef, useContext} from 'react';\n\nexport type DialogType = 'modal' | 'popover' | 'tray';\n\nexport interface DialogContextValue {\n  labelId: string;\n  descriptionId: string;\n  type: DialogType;\n  isDismissable?: boolean;\n  close: (value?: any) => void;\n  formId: string;\n  dialogProps: ComponentPropsWithRef<'div'>;\n  disableInitialTransition?: boolean;\n}\n\nexport const DialogContext = React.createContext<DialogContextValue>(null!);\n\nexport function useDialogContext() {\n  return useContext(DialogContext);\n}\n","import {useCallback} from 'react';\nimport memoize from 'nano-memoize';\nimport {useSelectedLocale} from './selected-locale';\nimport {handlePluralMessage} from './handle-plural-message';\nimport {MessageDescriptor} from './message-descriptor';\nimport {shallowEqual} from '../utils/shallow-equal';\n\nexport interface UseTransReturn {\n  trans: (props: MessageDescriptor) => string;\n}\n\nexport function useTrans(): UseTransReturn {\n  const {lines, localeCode} = useSelectedLocale();\n  const trans = useCallback(\n    (props: MessageDescriptor): string => {\n      return translate({...props, lines, localeCode});\n    },\n    [lines, localeCode]\n  );\n\n  return {trans};\n}\n\ninterface TranslateProps extends MessageDescriptor {\n  lines?: Record<string, string>;\n  localeCode: string;\n}\nconst translate = memoize(\n  (props: TranslateProps) => {\n    let {lines, message, values, localeCode} = props;\n    message = lines?.[message] || message;\n\n    if (!values) {\n      return message;\n    }\n\n    message = handlePluralMessage(localeCode, props);\n\n    Object.entries(values).forEach(([key, value]) => {\n      message = message.replace(`:${key}`, `${value}`);\n    });\n\n    return message;\n  },\n  {equals: shallowEqual, callTimeout: 0}\n);\n","import React from 'react';\nimport {useTrans} from '../../../i18n/use-trans';\nimport {message} from '../../../i18n/message';\n\ninterface DismissButtonProps {\n  onDismiss?: () => void;\n}\nexport function DismissButton({onDismiss}: DismissButtonProps) {\n  const {trans} = useTrans();\n\n  const onClick = () => {\n    if (onDismiss) {\n      onDismiss();\n    }\n  };\n\n  return (\n    <button\n      className=\"sr-only\"\n      aria-label={trans(message('Dismiss'))}\n      tabIndex={-1}\n      onClick={onClick}\n    />\n  );\n}\n","import React, {\n  Children,\n  cloneElement,\n  ComponentPropsWithoutRef,\n  CSSProperties,\n  isValidElement,\n  ReactElement,\n  ReactNode,\n  useContext\n} from 'react';\nimport clsx from 'clsx';\nimport {mergeProps} from '@react-aria/utils';\nimport {DialogContext} from './dialog-context';\nimport {InputSize} from '../../forms/input-field/input-size';\nimport {DismissButton} from './dismiss-button';\n\nexport type DialogSize =\n  | InputSize\n  | '2xl'\n  | 'auto'\n  | 'fullscreen'\n  | 'fullscreenTakeover'\n  | string;\n\nexport interface DialogProps\n  extends Omit<ComponentPropsWithoutRef<'div'>, 'size'> {\n  children: ReactNode;\n  size?: DialogSize;\n  background?: string;\n  className?: string;\n  radius?: string;\n  maxWidth?: string;\n}\nexport function Dialog(props: DialogProps) {\n  const {\n    type = 'modal',\n    dialogProps,\n    ...contextProps\n  } = useContext(DialogContext);\n\n  const {\n    children,\n    className,\n    size = 'md',\n    background,\n    radius = 'rounded',\n    maxWidth = 'max-w-dialog',\n    ...domProps\n  } = props;\n\n  // If rendered in a popover or tray there won't be a visible dismiss button,\n  // so we render a hidden one for screen readers.\n  let dismissButton: ReactElement | null = null;\n  if (type === 'popover' || type === 'tray') {\n    dismissButton = <DismissButton onDismiss={contextProps.close} />;\n  }\n\n  const isTrayOrFullScreen = size === 'fullscreenTakeover' || type === 'tray';\n  const mergedClassName = clsx(\n    'mx-auto pointer-events-auto outline-none flex flex-col overflow-hidden',\n    background || 'bg-paper',\n    type !== 'tray' && sizeStyle(size),\n    type === 'tray' && 'rounded-t',\n    size !== 'fullscreenTakeover' && `shadow-2xl border max-h-dialog`,\n    !isTrayOrFullScreen && `${radius} ${maxWidth}`,\n    className\n  );\n\n  return (\n    <div\n      {...mergeProps({role: 'dialog', tabIndex: -1}, dialogProps, domProps)}\n      style={{'--be-dialog-padding': '24px'} as CSSProperties}\n      aria-modal\n      className={mergedClassName}\n    >\n      {Children.toArray(children).map(child => {\n        if (isValidElement<DialogProps>(child)) {\n          return cloneElement<DialogProps>(child, {size: child.props.size ?? size});\n        }\n        return child;\n      })}\n      {dismissButton}\n    </div>\n  );\n}\n\nfunction sizeStyle(dialogSize?: DialogSize) {\n  switch (dialogSize) {\n    case 'xs':\n      return 'w-320';\n    case 'sm':\n      return 'w-384';\n    case 'md':\n      return 'w-440';\n    case 'lg':\n      return 'w-620';\n    case 'xl':\n      return 'w-780';\n    case '2xl':\n      return 'w-850';\n    case 'fullscreenTakeover':\n      return 'w-full h-full';\n    default:\n      return dialogSize;\n  }\n}\n","import {createSvgIcon} from '../create-svg-icon';\n\nexport const KeyboardArrowDownIcon = createSvgIcon(\n  <path d=\"M7.41 8.59 12 13.17l4.59-4.58L18 10l-6 6-6-6 1.41-1.41z\" />\n, 'KeyboardArrowDownOutlined');\n","import {forwardRef} from 'react';\nimport {m} from 'framer-motion';\nimport {OverlayProps} from './overlay-props';\nimport {useOverlayViewport} from './use-overlay-viewport';\nimport {Underlay} from './underlay';\nimport {FocusScope} from '@react-aria/focus';\nimport {useObjectRef} from '@react-aria/utils';\n\nexport const Modal = forwardRef<HTMLDivElement, OverlayProps>(\n  (\n    {\n      children,\n      autoFocus = false,\n      restoreFocus = true,\n      isDismissable = true,\n      isOpen = false,\n      onClose,\n    },\n    ref\n  ) => {\n    const viewPortStyle = useOverlayViewport();\n    const objRef = useObjectRef(ref);\n\n    return (\n      <div className=\"isolate z-modal fixed inset-0\" style={viewPortStyle}>\n        <Underlay\n          key=\"modal-underlay\"\n          onClick={() => {\n            if (isDismissable) {\n              onClose();\n            }\n          }}\n        />\n        <m.div\n          ref={objRef}\n          className=\"absolute inset-0 w-full h-full z-20 flex items-center justify-center pointer-events-none\"\n          role=\"presentation\"\n          initial={{opacity: 0, scale: 0.7}}\n          animate={{opacity: 1, scale: 1}}\n          exit={{opacity: 0, scale: 1}}\n        >\n          <FocusScope restoreFocus={restoreFocus} autoFocus={autoFocus} contain>\n            {children}\n          </FocusScope>\n        </m.div>\n      </div>\n    );\n  }\n);\n","import React, {\n  cloneElement,\n  Fragment,\n  ReactElement,\n  ReactNode,\n  RefObject,\n  useCallback,\n  useId,\n  useMemo,\n} from 'react';\nimport {AnimatePresence} from 'framer-motion';\nimport {useControlledState} from '@react-stately/utils';\nimport {Options as OffsetOptions} from '@floating-ui/core/src/middleware/offset';\nimport {useLayoutEffect} from '@react-aria/utils';\nimport {useFloatingPosition} from '../floating-position';\nimport {useIsMobileMediaQuery} from '../../../utils/hooks/is-mobile-media-query';\nimport {DialogContext, DialogContextValue} from './dialog-context';\nimport {Popover} from '../popover';\nimport {Tray} from '../tray';\nimport {Modal} from '../modal';\nimport {createPortal} from 'react-dom';\nimport {createEventHandler} from '../../../utils/dom/create-event-handler';\nimport {Placement} from '@floating-ui/react-dom';\nimport {rootEl} from '../../../core/root-el';\n\ntype PopoverProps = {\n  type: 'popover';\n  placement?: Placement;\n  offset?: OffsetOptions;\n};\ntype ModalProps = {\n  type: 'modal' | 'tray';\n};\ntype Props = (PopoverProps | ModalProps) & {\n  children: ReactNode;\n  disableInitialTransition?: boolean;\n  onClose?: (value?: any) => void;\n  isDismissable?: boolean;\n  isOpen?: boolean;\n  onOpenChange?: (isOpen: boolean) => void;\n  defaultIsOpen?: boolean;\n  triggerRef?: RefObject<HTMLElement>;\n  moveFocusToDialog?: boolean;\n  returnFocusToTrigger?: boolean;\n};\nexport function DialogTrigger(props: Props) {\n  let {\n    children,\n    type,\n    disableInitialTransition,\n    onClose,\n    isDismissable = true,\n    triggerRef,\n    moveFocusToDialog = true,\n    returnFocusToTrigger = true,\n  } = props;\n  const [isOpen, setIsOpen] = useControlledState(\n    props.isOpen,\n    props.defaultIsOpen,\n    props.onOpenChange\n  );\n\n  const {dialogTrigger, dialog} = extractChildren(children);\n\n  // On small devices, show a modal or tray instead of a popover.\n  const isMobile = useIsMobileMediaQuery();\n  if (isMobile && type === 'popover') {\n    type = 'modal';\n  }\n\n  const {x, y, reference, floating, strategy, refs} = useFloatingPosition({\n    ...props,\n    disablePositioning: type === 'modal',\n  });\n\n  const floatingStyle =\n    type === 'popover'\n      ? {\n          position: strategy,\n          top: y ?? '',\n          left: x ?? '',\n        }\n      : {};\n\n  const id = useId();\n  const labelId = `${id}-label`;\n  const descriptionId = `${id}-description`;\n  const formId = `${id}-form`;\n\n  const close = useCallback(\n    (value?: any) => {\n      onClose?.(value);\n      setIsOpen(false);\n    },\n    [onClose, setIsOpen]\n  );\n\n  // position dropdown relative to provided ref, not the trigger\n  useLayoutEffect(() => {\n    if (triggerRef?.current && refs.reference.current !== triggerRef.current) {\n      reference(triggerRef.current);\n    }\n  }, [reference, triggerRef, refs]);\n\n  const dialogProps = useMemo(() => {\n    return {\n      'aria-labelledby': labelId,\n      'aria-describedby': descriptionId,\n    };\n  }, [labelId, descriptionId]);\n\n  let Overlay: typeof Modal | typeof Tray | typeof Popover;\n  if (type === 'modal') {\n    Overlay = Modal;\n  } else if (type === 'tray') {\n    Overlay = Tray;\n  } else {\n    Overlay = Popover;\n  }\n\n  const contextValue: DialogContextValue = useMemo(() => {\n    return {\n      dialogProps,\n      type,\n      labelId,\n      descriptionId,\n      isDismissable,\n      close,\n      formId,\n    };\n  }, [close, descriptionId, dialogProps, formId, labelId, type, isDismissable]);\n\n  return (\n    <Fragment>\n      {dialogTrigger &&\n        cloneElement(dialogTrigger, {\n          onClick: createEventHandler((e: React.MouseEvent) => {\n            // prevent propagating to parent, in case floating element\n            // is attached to input field and button is inside the field\n            e.stopPropagation();\n            setIsOpen(!isOpen);\n          }),\n          ref: triggerRef ? null : reference,\n          ...dialogTrigger.props,\n        })}\n      {rootEl &&\n        createPortal(\n          <AnimatePresence initial={!disableInitialTransition}>\n            {isOpen && (\n              <DialogContext.Provider value={contextValue}>\n                <Overlay\n                  ref={floating}\n                  triggerRef={refs.reference as RefObject<HTMLElement>}\n                  style={floatingStyle}\n                  restoreFocus={returnFocusToTrigger}\n                  autoFocus={moveFocusToDialog}\n                  isOpen={isOpen}\n                  onClose={close}\n                  isDismissable={isDismissable}\n                >\n                  {dialog}\n                </Overlay>\n              </DialogContext.Provider>\n            )}\n          </AnimatePresence>,\n          rootEl\n        )}\n    </Fragment>\n  );\n}\n\nfunction extractChildren(rawChildren: ReactNode) {\n  const children = React.Children.toArray(rawChildren);\n\n  // trigger and dialog passed as children\n  if (children && children.length === 2) {\n    return {\n      dialogTrigger: children[0] as ReactElement,\n      dialog: children[1] as ReactElement,\n    };\n  }\n\n  // only dialog passed as child\n  return {dialog: children[0] as ReactElement};\n}\n","import React, {ReactNode, useState} from 'react';\nimport clsx from 'clsx';\nimport {ColorPicker} from '../common/ui/color-picker/color-picker';\nimport {useStore} from '../state/store';\nimport {ButtonBase} from '../common/ui/buttons/button-base';\nimport {Dialog} from '../common/ui/overlays/dialog/dialog';\nimport {KeyboardArrowDownIcon} from '../common/icons/material/KeyboardArrowDown';\nimport {getInputFieldClassNames} from '../common/ui/forms/input-field/get-input-field-class-names';\nimport {DialogTrigger} from '../common/ui/overlays/dialog/dialog-trigger';\nimport {InputSize} from '../common/ui/forms/input-field/input-size';\n\ninterface ColorPickerButtonProps {\n  label?: ReactNode;\n  className?: string;\n  value?: string;\n  size?: InputSize;\n  onChange?: (value: string) => void;\n  ['aria-label']?: string;\n}\nexport function ColorPickerButton(props: ColorPickerButtonProps) {\n  const {label, className, value, onChange, size} = props;\n  const colors = useStore(s => s.config.ui?.colorPresets?.items) || [];\n  const style = getInputFieldClassNames({size});\n  const [selectedColor, setSelectedColor] = useState(value);\n  const [isOpen, setIsOpen] = useState(false);\n\n  const onColorChange = (newColor: string) => {\n    setSelectedColor(newColor);\n    onChange?.(newColor);\n  };\n\n  return (\n    <div className={clsx(className, 'w-max')}>\n      {label && <span className={style.label}>{label}</span>}\n      <DialogTrigger type=\"popover\" isOpen={isOpen} onOpenChange={setIsOpen}>\n        <ButtonBase\n          className={clsx(style.input, 'inline-flex items-center')}\n          aria-label={props['aria-label']}\n        >\n          <span\n            className=\"block flex-shrink-0 mr-5 border rounded h-2/4 aspect-square\"\n            style={{backgroundColor: selectedColor}}\n          />\n          <ArrowIcon isActive={isOpen} className={style.adornment} />\n        </ButtonBase>\n        <Dialog size=\"auto\">\n          <ColorPicker\n            onChange={onColorChange}\n            defaultValue={selectedColor}\n            colorPresets={colors}\n          />\n        </Dialog>\n      </DialogTrigger>\n    </div>\n  );\n}\n\ntype ArrowProps = {\n  isActive: boolean;\n  className: string;\n};\n\nexport function ArrowIcon({isActive, className}: ArrowProps) {\n  const rotation = isActive ? 'rotate-180' : 'rotate-0';\n  return (\n    <KeyboardArrowDownIcon\n      size=\"sm\"\n      className={`transition-transform ml-auto flex-shrink-0 ${rotation} ${className}`}\n    />\n  );\n}\n","import React, {ReactNode} from 'react';\nimport clsx from 'clsx';\nimport {getInputFieldClassNames} from '../input-field/get-input-field-class-names';\nimport {UseSliderProps, UseSliderReturn} from './use-slider';\n\nexport interface BaseSliderProps extends UseSliderProps {\n  slider: UseSliderReturn;\n  children: ReactNode;\n}\nexport function BaseSlider(props: BaseSliderProps) {\n  const {\n    size = 'md',\n    inline,\n    label,\n    showValueLabel = !!label,\n    className,\n    slider,\n    children,\n  } = props;\n\n  const {\n    domProps,\n    trackRef,\n    getThumbPercent,\n    getThumbValueLabel,\n    labelId,\n    groupId,\n    thumbIds,\n    isDisabled,\n    numberFormatter,\n    minValue,\n    maxValue,\n    step,\n    values,\n    getValueLabel,\n  } = slider;\n\n  let outputValue = '';\n  let maxLabelLength = Math.max(\n    [...numberFormatter.format(minValue)].length,\n    [...numberFormatter.format(maxValue)].length,\n    [...numberFormatter.format(step)].length\n  );\n\n  if (getValueLabel) {\n    outputValue = getValueLabel(values[0]);\n  } else if (values.length === 1) {\n    outputValue = getThumbValueLabel(0);\n  } else if (values.length === 2) {\n    // This should really use the NumberFormat#formatRange proposal...\n    // https://github.com/tc39/ecma402/issues/393\n    // https://github.com/tc39/proposal-intl-numberformat-v3#formatrange-ecma-402-393\n    outputValue = `${getThumbValueLabel(0)} – ${getThumbValueLabel(1)}`;\n    maxLabelLength =\n      3 +\n      2 *\n        Math.max(\n          maxLabelLength,\n          [...numberFormatter.format(minValue)].length,\n          [...numberFormatter.format(maxValue)].length\n        );\n  }\n  const style = getInputFieldClassNames({\n    size,\n    disabled: isDisabled,\n    labelDisplay: 'flex',\n  });\n\n  const wrapperClassname = clsx('w-full flex-shrink-0 touch-none', className, {\n    'flex items-center': inline,\n  });\n\n  return (\n    <div className={wrapperClassname} role=\"group\" id={groupId}>\n      <div className={clsx(style.label, 'select-none')}>\n        {label && (\n          <label\n            onClick={() => {\n              // Safari does not focus <input type=\"range\"> elements when clicking on an associated <label>,\n              // so do it manually. In addition, make sure we show the focus ring.\n              document.getElementById(thumbIds[0])?.focus();\n            }}\n            id={labelId}\n            htmlFor={groupId}\n          >\n            {label}\n          </label>\n        )}\n        {showValueLabel && (\n          <output\n            htmlFor={thumbIds[0]}\n            className=\"ml-auto text-right\"\n            aria-live=\"off\"\n            style={\n              !maxLabelLength\n                ? undefined\n                : {\n                    width: `${maxLabelLength}ch`,\n                    minWidth: `${maxLabelLength}ch`,\n                  }\n            }\n          >\n            {outputValue}\n          </output>\n        )}\n      </div>\n      <div\n        ref={trackRef}\n        className=\"h-30 relative\"\n        {...domProps}\n        role=\"presentation\"\n      >\n        <div\n          className={`absolute inset-0 m-auto h-4 rounded ${\n            isDisabled ? 'bg-disabled' : 'bg-primary-light'\n          }`}\n        />\n        <div\n          className={`absolute inset-0 my-auto h-4 rounded ${\n            isDisabled ? 'bg-disabled-fg' : 'bg-primary'\n          }`}\n          style={{width: `${getThumbPercent(0) * 100}%`}}\n        />\n        {children}\n      </div>\n    </div>\n  );\n}\n","import {NumberFormatOptions, NumberFormatter} from '@internationalized/number';\nimport {useMemo} from 'react';\nimport {useSelectedLocale} from './selected-locale';\n\nexport function useNumberFormatter(\n  options: NumberFormatOptions = {}\n): Intl.NumberFormat {\n  const {localeCode} = useSelectedLocale();\n  return useMemo(\n    () => new NumberFormatter(localeCode, options),\n    [localeCode, options]\n  );\n}\n","import {snapValueToStep, useGlobalListeners} from '@react-aria/utils';\nimport {useControlledState} from '@react-stately/utils';\nimport React, {\n  HTMLAttributes,\n  ReactNode,\n  RefObject,\n  useId,\n  useRef,\n  useState,\n} from 'react';\nimport {clamp} from '../../../utils/number/clamp';\nimport {usePointerEvents} from '../../interactions/use-pointer-events';\nimport {useNumberFormatter} from '../../../i18n/use-number-formatter';\nimport type {NumberFormatOptions} from '@internationalized/number';\nimport {InputSize} from '../input-field/input-size';\n\nexport interface UseSliderProps<T = number[]> {\n  formatOptions?: NumberFormatOptions;\n  onChange?: (value: T) => void;\n  onChangeEnd?: (value: T) => void;\n  value?: T;\n  defaultValue?: T;\n  getValueLabel?: (value: number) => string;\n  minValue?: number;\n  maxValue?: number;\n  step?: number;\n  isDisabled?: boolean;\n  size?: InputSize;\n  label?: ReactNode;\n  inline?: boolean;\n  className?: string;\n  showValueLabel?: boolean;\n}\n\nexport interface UseSliderReturn {\n  domProps: HTMLAttributes<HTMLElement>;\n  trackRef: RefObject<HTMLDivElement>;\n  step: number;\n  isDisabled: boolean;\n  values: number[];\n  minValue: number;\n  maxValue: number;\n  focusedThumb: number | undefined;\n  labelId: string | undefined;\n  groupId: string;\n  thumbIds: string[];\n  numberFormatter: Intl.NumberFormat;\n  getThumbPercent: (index: number) => number;\n  getThumbMinValue: (index: number) => number;\n  getThumbMaxValue: (index: number) => number;\n  getThumbValueLabel: (index: number) => string;\n  setThumbValue: (index: number, value: number) => void;\n  updateDraggedThumbs: (index: number, dragging: boolean) => void;\n  isThumbDragging: (index: number) => boolean;\n  setThumbEditable: (index: number, editable: boolean) => void;\n  setFocusedThumb: (index: number | undefined) => void;\n  getValueLabel?: (value: number) => string;\n}\n\nexport function useSlider({\n  minValue = 0,\n  maxValue = 100,\n  isDisabled = false,\n  step = 1,\n  formatOptions,\n  onChangeEnd,\n  label,\n  getValueLabel,\n  ...props\n}: UseSliderProps): UseSliderReturn {\n  const numberFormatter = useNumberFormatter(formatOptions);\n  const {addGlobalListener, removeGlobalListener} = useGlobalListeners();\n  const trackRef = useRef<HTMLDivElement>(null);\n\n  // values will be stored in internal state as an array for both slider and range slider\n  const [values, setValues] = useControlledState<number[]>(\n    props.value ? props.value : undefined,\n    props.defaultValue ?? ([minValue] as any),\n    props.onChange as any\n  );\n  // need to also store values in ref, because state value would\n  // lag behind by one between pointer down and move callbacks\n  const valuesRef = useRef<number[] | null>(null);\n  valuesRef.current = values;\n\n  // indices of thumbs that are being dragged currently (state and ref for same reasons as above)\n  const [draggedThumbs, setDraggedThumbs] = useState<boolean[]>(\n    new Array(values.length).fill(false)\n  );\n  const draggedThumbsRef = useRef<boolean[] | null>(null);\n  draggedThumbsRef.current = draggedThumbs;\n\n  // formatted value for <output> and thumb aria labels\n  function getFormattedValue(value: number) {\n    return numberFormatter.format(value);\n  }\n\n  const isThumbDragging = (index: number) => {\n    return draggedThumbsRef.current?.[index] || false;\n  };\n\n  const getThumbValueLabel = (index: number) =>\n    getFormattedValue(values[index]);\n\n  const getThumbMinValue = (index: number) =>\n    index === 0 ? minValue : values[index - 1];\n  const getThumbMaxValue = (index: number) =>\n    index === values.length - 1 ? maxValue : values[index + 1];\n\n  const setThumbValue = (index: number, value: number) => {\n    if (isDisabled || !isThumbEditable(index) || !valuesRef.current) {\n      return;\n    }\n    const thisMin = getThumbMinValue(index);\n    const thisMax = getThumbMaxValue(index);\n\n    // Round value to multiple of step, clamp value between min and max\n    value = snapValueToStep(value, thisMin, thisMax, step);\n    valuesRef.current = replaceIndex(valuesRef.current, index, value);\n    setValues(valuesRef.current);\n  };\n\n  // update \"dragging\" status of specified thumb\n  const updateDraggedThumbs = (index: number, dragging: boolean) => {\n    if (isDisabled || !isThumbEditable(index)) {\n      return;\n    }\n\n    const wasDragging = draggedThumbsRef.current?.[index];\n    draggedThumbsRef.current = replaceIndex(\n      draggedThumbsRef.current || [],\n      index,\n      dragging\n    );\n    setDraggedThumbs(draggedThumbsRef.current);\n\n    // Call onChangeEnd if no handles are dragging.\n    if (onChangeEnd && wasDragging && !draggedThumbsRef.current.some(Boolean)) {\n      onChangeEnd(valuesRef.current || []);\n    }\n  };\n\n  const [focusedThumb, setFocusedThumb] = useState<number | undefined>(\n    undefined\n  );\n\n  const getValuePercent = (value: number) =>\n    (value - minValue) / (maxValue - minValue);\n\n  const getThumbPercent = (index: number) =>\n    getValuePercent(valuesRef.current![index]);\n\n  const setThumbPercent = (index: number, percent: number) => {\n    setThumbValue(index, getPercentValue(percent));\n  };\n\n  const getRoundedValue = (value: number) =>\n    Math.round((value - minValue) / step) * step + minValue;\n\n  const getPercentValue = (percent: number) => {\n    const val = percent * (maxValue - minValue) + minValue;\n    return clamp(getRoundedValue(val), minValue, maxValue);\n  };\n\n  // allows disabling individual thumbs in range slider, instead of disable the whole slider\n  const editableThumbsRef = useRef<boolean[]>(\n    new Array(values.length).fill(true)\n  );\n  const isThumbEditable = (index: number) => editableThumbsRef.current[index];\n  const setThumbEditable = (index: number, editable: boolean) => {\n    editableThumbsRef.current[index] = editable;\n  };\n\n  // When the user clicks or drags the track, we want the motion to set and drag the\n  // closest thumb. Hence, we also need to install useMove() on the track element.\n  // Here, we keep track of which index is the \"closest\" to the drag start point.\n  // It is set onMouseDown/onTouchDown; see trackProps below.\n  const realTimeTrackDraggingIndex = useRef<number | null>(null);\n\n  const currentPointer = useRef<number | null | undefined>(undefined);\n  const handlePointerDown = (e: React.PointerEvent) => {\n    if (\n      e.pointerType === 'mouse' &&\n      (e.button !== 0 || e.altKey || e.ctrlKey || e.metaKey)\n    ) {\n      return;\n    }\n    // We only trigger track-dragging if the user clicks on the track itself and nothing is currently being dragged.\n    if (\n      trackRef.current &&\n      !isDisabled &&\n      values.every((_, i) => !draggedThumbs[i])\n    ) {\n      const size = trackRef.current.offsetWidth;\n      // Find the closest thumb\n      const trackPosition = trackRef.current.getBoundingClientRect().left;\n      const offset = e.clientX - trackPosition;\n      const percent = offset / size;\n      const value = getPercentValue(percent);\n\n      // to find the closet thumb we split the array based on the first thumb position to the \"right/end\" of the click.\n      let closestThumb;\n      const split = values.findIndex(v => value - v < 0);\n      if (split === 0) {\n        // If the index is zero then the closest thumb is the first one\n        closestThumb = split;\n      } else if (split === -1) {\n        // If no index is found they've clicked past all the thumbs\n        closestThumb = values.length - 1;\n      } else {\n        const lastLeft = values[split - 1];\n        const firstRight = values[split];\n        // Pick the last left/start thumb, unless they are stacked on top of each other, then pick the right/end one\n        if (Math.abs(lastLeft - value) < Math.abs(firstRight - value)) {\n          closestThumb = split - 1;\n        } else {\n          closestThumb = split;\n        }\n      }\n\n      // Confirm that the found closest thumb is editable, not disabled, and move it\n      if (closestThumb >= 0 && isThumbEditable(closestThumb)) {\n        // Don't un-focus anything\n        e.preventDefault();\n\n        realTimeTrackDraggingIndex.current = closestThumb;\n        setFocusedThumb(closestThumb);\n        currentPointer.current = e.pointerId;\n\n        updateDraggedThumbs(realTimeTrackDraggingIndex.current, true);\n        setThumbValue(closestThumb, value);\n\n        addGlobalListener(window, 'pointerup', onUpTrack, false);\n      } else {\n        realTimeTrackDraggingIndex.current = null;\n      }\n    }\n  };\n\n  const currentPosition = useRef<number | null>(null);\n  const {domProps} = usePointerEvents({\n    onPointerDown: handlePointerDown,\n    onMoveStart() {\n      currentPosition.current = null;\n    },\n    onMove(e, deltaX) {\n      const size = trackRef.current?.offsetWidth || 0;\n\n      if (currentPosition.current == null) {\n        currentPosition.current =\n          getThumbPercent(realTimeTrackDraggingIndex.current || 0) * size;\n      }\n\n      currentPosition.current += deltaX;\n\n      if (realTimeTrackDraggingIndex.current != null && trackRef.current) {\n        const percent = clamp(currentPosition.current / size, 0, 1);\n        setThumbPercent(realTimeTrackDraggingIndex.current, percent);\n      }\n    },\n    onMoveEnd() {\n      if (realTimeTrackDraggingIndex.current != null) {\n        updateDraggedThumbs(realTimeTrackDraggingIndex.current, false);\n        realTimeTrackDraggingIndex.current = null;\n      }\n    },\n  });\n\n  const onUpTrack = (e: PointerEvent) => {\n    const id = e.pointerId;\n    if (id === currentPointer.current) {\n      if (realTimeTrackDraggingIndex.current != null) {\n        updateDraggedThumbs(realTimeTrackDraggingIndex.current, false);\n        realTimeTrackDraggingIndex.current = null;\n      }\n\n      removeGlobalListener(window, 'pointerup', onUpTrack, false);\n    }\n  };\n\n  const id = useId();\n  const labelId = label ? `${id}-label` : undefined;\n  const groupId = `${id}-group`;\n  const thumbIds = [...Array(values.length)].map((v, i) => {\n    return `${id}-thumb-${i}`;\n  });\n\n  return {\n    domProps,\n    trackRef,\n    isDisabled,\n    step,\n    values,\n    minValue,\n    maxValue,\n    focusedThumb,\n    labelId,\n    groupId,\n    thumbIds,\n    numberFormatter,\n    getThumbPercent,\n    getThumbMinValue,\n    getThumbMaxValue,\n    getThumbValueLabel,\n    isThumbDragging,\n    setThumbValue,\n    updateDraggedThumbs,\n    setThumbEditable,\n    setFocusedThumb,\n    getValueLabel,\n  };\n}\n\nfunction replaceIndex<T>(array: T[], index: number, value: T) {\n  if (array[index] === value) {\n    return array;\n  }\n\n  return [...array.slice(0, index), value, ...array.slice(index + 1)];\n}\n","import React, {Ref, useCallback, useEffect, useRef} from 'react';\nimport clsx from 'clsx';\nimport {UseSliderReturn} from './use-slider';\nimport {useGlobalListeners, useObjectRef} from '@react-aria/utils';\nimport {createEventHandler} from '../../../utils/dom/create-event-handler';\n\ninterface SliderThumb {\n  index: number;\n  slider: UseSliderReturn;\n  isDisabled?: boolean;\n  ariaLabel?: string;\n  inputRef?: Ref<HTMLInputElement>;\n  onBlur?: React.FocusEventHandler;\n}\nexport function SliderThumb({\n  index,\n  slider,\n  isDisabled: isThumbDisabled,\n  ariaLabel,\n  inputRef,\n  onBlur,\n}: SliderThumb) {\n  const inputObjRef = useObjectRef(inputRef);\n  const {addGlobalListener, removeGlobalListener} = useGlobalListeners();\n\n  const {\n    step,\n    values,\n    focusedThumb,\n    labelId,\n    thumbIds,\n    isDisabled: isSliderDisabled,\n    getThumbPercent,\n    getThumbMinValue,\n    getThumbMaxValue,\n    getThumbValueLabel,\n    setThumbValue,\n    updateDraggedThumbs,\n    isThumbDragging,\n    setThumbEditable,\n    setFocusedThumb,\n  } = slider;\n  const value = values[index];\n\n  // Immediately register editability with the state\n  setThumbEditable(index, !isThumbDisabled);\n  const isDisabled = isThumbDisabled || isSliderDisabled;\n\n  const focusInput = useCallback(() => {\n    if (inputObjRef.current) {\n      inputObjRef.current.focus({preventScroll: true});\n    }\n  }, [inputObjRef]);\n\n  // we will focus the native range input when slider is clicked or thumb is\n  // focused in some other way, and let browser handle keyboard interactions\n  const isFocused = focusedThumb === index;\n  useEffect(() => {\n    if (isFocused) {\n      focusInput();\n    }\n  }, [isFocused, focusInput]);\n\n  const currentPointer = useRef<number | undefined>(undefined);\n  const handlePointerUp = (e: PointerEvent) => {\n    if (e.pointerId === currentPointer.current) {\n      focusInput();\n      updateDraggedThumbs(index, false);\n      removeGlobalListener(window, 'pointerup', handlePointerUp, false);\n    }\n  };\n\n  const className = clsx(\n    'outline-none rounded-full w-18 h-18 top-1/2 -translate-y-1/2 -translate-x-1/2 absolute inset-0 transition-button duration-200',\n    !isDisabled &&\n      'focus-within:ring focus-within:ring-primary-light shadow-md',\n    thumbColor({isDisabled, isDragging: isThumbDragging(index)})\n  );\n\n  return (\n    <div\n      role=\"presentation\"\n      className={className}\n      style={{\n        left: `${Math.max(getThumbPercent(index) * 100, 0)}%`,\n      }}\n      onPointerDown={e => {\n        if (e.button !== 0 || e.altKey || e.ctrlKey || e.metaKey) {\n          return;\n        }\n        focusInput();\n        currentPointer.current = e.pointerId;\n        updateDraggedThumbs(index, true);\n\n        addGlobalListener(window, 'pointerup', handlePointerUp, false);\n      }}\n    >\n      <input\n        id={thumbIds[index]}\n        onKeyDown={createEventHandler(() => {\n          updateDraggedThumbs(index, true);\n        })}\n        onKeyUp={createEventHandler(() => {\n          // make sure \"onChangeEnd\" is fired on keyboard navigation\n          updateDraggedThumbs(index, false);\n        })}\n        ref={inputObjRef}\n        tabIndex={!isDisabled ? 0 : undefined}\n        min={getThumbMinValue(index)}\n        max={getThumbMaxValue(index)}\n        step={step}\n        value={value}\n        disabled={isDisabled}\n        aria-label={ariaLabel}\n        aria-labelledby={labelId}\n        aria-orientation=\"horizontal\"\n        aria-valuetext={getThumbValueLabel(index)}\n        onFocus={() => {\n          setFocusedThumb(index);\n        }}\n        onBlur={e => {\n          setFocusedThumb(undefined);\n          updateDraggedThumbs(index, false);\n          onBlur?.(e);\n        }}\n        onChange={e => {\n          setThumbValue(index, parseFloat(e.target.value));\n        }}\n        type=\"range\"\n        className=\"sr-only\"\n      />\n    </div>\n  );\n}\n\ninterface SliderThumbColorProps {\n  isDisabled?: boolean;\n  isDragging: boolean;\n}\nfunction thumbColor({isDisabled, isDragging}: SliderThumbColorProps): string {\n  if (isDisabled) {\n    return 'bg-slider-disabled cursor-default';\n  }\n  return clsx(\n    'hover:bg-primary-dark',\n    isDragging ? 'bg-primary-dark' : 'bg-primary'\n  );\n}\n","import React from 'react';\n\nvar isCheckBoxInput = (element) => element.type === 'checkbox';\n\nvar isDateObject = (value) => value instanceof Date;\n\nvar isNullOrUndefined = (value) => value == null;\n\nconst isObjectType = (value) => typeof value === 'object';\r\nvar isObject = (value) => !isNullOrUndefined(value) &&\r\n    !Array.isArray(value) &&\r\n    isObjectType(value) &&\r\n    !isDateObject(value);\n\nvar getEventValue = (event) => isObject(event) && event.target\r\n    ? isCheckBoxInput(event.target)\r\n        ? event.target.checked\r\n        : event.target.value\r\n    : event;\n\nvar getNodeParentName = (name) => name.substring(0, name.search(/\\.\\d+(\\.|$)/)) || name;\n\nvar isNameInFieldArray = (names, name) => names.has(getNodeParentName(name));\n\nvar compact = (value) => Array.isArray(value) ? value.filter(Boolean) : [];\n\nvar isUndefined = (val) => val === undefined;\n\nvar get = (obj, path, defaultValue) => {\r\n    if (!path || !isObject(obj)) {\r\n        return defaultValue;\r\n    }\r\n    const result = compact(path.split(/[,[\\].]+?/)).reduce((result, key) => isNullOrUndefined(result) ? result : result[key], obj);\r\n    return isUndefined(result) || result === obj\r\n        ? isUndefined(obj[path])\r\n            ? defaultValue\r\n            : obj[path]\r\n        : result;\r\n};\n\nconst EVENTS = {\r\n    BLUR: 'blur',\r\n    FOCUS_OUT: 'focusout',\r\n    CHANGE: 'change',\r\n};\r\nconst VALIDATION_MODE = {\r\n    onBlur: 'onBlur',\r\n    onChange: 'onChange',\r\n    onSubmit: 'onSubmit',\r\n    onTouched: 'onTouched',\r\n    all: 'all',\r\n};\r\nconst INPUT_VALIDATION_RULES = {\r\n    max: 'max',\r\n    min: 'min',\r\n    maxLength: 'maxLength',\r\n    minLength: 'minLength',\r\n    pattern: 'pattern',\r\n    required: 'required',\r\n    validate: 'validate',\r\n};\n\nconst HookFormContext = React.createContext(null);\r\n/**\r\n * This custom hook allows you to access the form context. useFormContext is intended to be used in deeply nested structures, where it would become inconvenient to pass the context as a prop. To be used with {@link FormProvider}.\r\n *\r\n * @remarks\r\n * [API](https://react-hook-form.com/api/useformcontext) • [Demo](https://codesandbox.io/s/react-hook-form-v7-form-context-ytudi)\r\n *\r\n * @returns return all useForm methods\r\n *\r\n * @example\r\n * ```tsx\r\n * function App() {\r\n *   const methods = useForm();\r\n *   const onSubmit = data => console.log(data);\r\n *\r\n *   return (\r\n *     <FormProvider {...methods} >\r\n *       <form onSubmit={methods.handleSubmit(onSubmit)}>\r\n *         <NestedInput />\r\n *         <input type=\"submit\" />\r\n *       </form>\r\n *     </FormProvider>\r\n *   );\r\n * }\r\n *\r\n *  function NestedInput() {\r\n *   const { register } = useFormContext(); // retrieve all hook methods\r\n *   return <input {...register(\"test\")} />;\r\n * }\r\n * ```\r\n */\r\nconst useFormContext = () => React.useContext(HookFormContext);\r\n/**\r\n * A provider component that propagates the `useForm` methods to all children components via [React Context](https://reactjs.org/docs/context.html) API. To be used with {@link useFormContext}.\r\n *\r\n * @remarks\r\n * [API](https://react-hook-form.com/api/useformcontext) • [Demo](https://codesandbox.io/s/react-hook-form-v7-form-context-ytudi)\r\n *\r\n * @param props - all useFrom methods\r\n *\r\n * @example\r\n * ```tsx\r\n * function App() {\r\n *   const methods = useForm();\r\n *   const onSubmit = data => console.log(data);\r\n *\r\n *   return (\r\n *     <FormProvider {...methods} >\r\n *       <form onSubmit={methods.handleSubmit(onSubmit)}>\r\n *         <NestedInput />\r\n *         <input type=\"submit\" />\r\n *       </form>\r\n *     </FormProvider>\r\n *   );\r\n * }\r\n *\r\n *  function NestedInput() {\r\n *   const { register } = useFormContext(); // retrieve all hook methods\r\n *   return <input {...register(\"test\")} />;\r\n * }\r\n * ```\r\n */\r\nconst FormProvider = (props) => {\r\n    const { children, ...data } = props;\r\n    return (React.createElement(HookFormContext.Provider, { value: data }, children));\r\n};\n\nvar getProxyFormState = (formState, _proxyFormState, localProxyFormState, isRoot = true) => {\r\n    const result = {};\r\n    for (const key in formState) {\r\n        Object.defineProperty(result, key, {\r\n            get: () => {\r\n                const _key = key;\r\n                if (_proxyFormState[_key] !== VALIDATION_MODE.all) {\r\n                    _proxyFormState[_key] = !isRoot || VALIDATION_MODE.all;\r\n                }\r\n                localProxyFormState && (localProxyFormState[_key] = true);\r\n                return formState[_key];\r\n            },\r\n        });\r\n    }\r\n    return result;\r\n};\n\nvar isEmptyObject = (value) => isObject(value) && !Object.keys(value).length;\n\nvar shouldRenderFormState = (formStateData, _proxyFormState, isRoot) => {\r\n    const { name, ...formState } = formStateData;\r\n    return (isEmptyObject(formState) ||\r\n        Object.keys(formState).length >= Object.keys(_proxyFormState).length ||\r\n        Object.keys(formState).find((key) => _proxyFormState[key] ===\r\n            (!isRoot || VALIDATION_MODE.all)));\r\n};\n\nvar convertToArrayPayload = (value) => (Array.isArray(value) ? value : [value]);\n\nvar shouldSubscribeByName = (name, signalName, exact) => exact && signalName\r\n    ? name === signalName\r\n    : !name ||\r\n        !signalName ||\r\n        name === signalName ||\r\n        convertToArrayPayload(name).some((currentName) => currentName &&\r\n            (currentName.startsWith(signalName) ||\r\n                signalName.startsWith(currentName)));\n\nfunction useSubscribe(props) {\r\n    const _props = React.useRef(props);\r\n    _props.current = props;\r\n    React.useEffect(() => {\r\n        const tearDown = (subscription) => {\r\n            if (subscription) {\r\n                subscription.unsubscribe();\r\n            }\r\n        };\r\n        const subscription = !props.disabled &&\r\n            _props.current.subject.subscribe({\r\n                next: _props.current.callback,\r\n            });\r\n        return () => tearDown(subscription);\r\n    }, [props.disabled]);\r\n}\n\n/**\r\n * This custom hook allows you to subscribe to each form state, and isolate the re-render at the custom hook level. It has its scope in terms of form state subscription, so it would not affect other useFormState and useForm. Using this hook can reduce the re-render impact on large and complex form application.\r\n *\r\n * @remarks\r\n * [API](https://react-hook-form.com/api/useformstate) • [Demo](https://codesandbox.io/s/useformstate-75xly)\r\n *\r\n * @param props - include options on specify fields to subscribe. {@link UseFormStateReturn}\r\n *\r\n * @example\r\n * ```tsx\r\n * function App() {\r\n *   const { register, handleSubmit, control } = useForm({\r\n *     defaultValues: {\r\n *     firstName: \"firstName\"\r\n *   }});\r\n *   const { dirtyFields } = useFormState({\r\n *     control\r\n *   });\r\n *   const onSubmit = (data) => console.log(data);\r\n *\r\n *   return (\r\n *     <form onSubmit={handleSubmit(onSubmit)}>\r\n *       <input {...register(\"firstName\")} placeholder=\"First Name\" />\r\n *       {dirtyFields.firstName && <p>Field is dirty.</p>}\r\n *       <input type=\"submit\" />\r\n *     </form>\r\n *   );\r\n * }\r\n * ```\r\n */\r\nfunction useFormState(props) {\r\n    const methods = useFormContext();\r\n    const { control = methods.control, disabled, name, exact } = props || {};\r\n    const [formState, updateFormState] = React.useState(control._formState);\r\n    const _localProxyFormState = React.useRef({\r\n        isDirty: false,\r\n        dirtyFields: false,\r\n        touchedFields: false,\r\n        isValidating: false,\r\n        isValid: false,\r\n        errors: false,\r\n    });\r\n    const _name = React.useRef(name);\r\n    const _mounted = React.useRef(true);\r\n    _name.current = name;\r\n    const callback = React.useCallback((value) => _mounted.current &&\r\n        shouldSubscribeByName(_name.current, value.name, exact) &&\r\n        shouldRenderFormState(value, _localProxyFormState.current) &&\r\n        updateFormState({\r\n            ...control._formState,\r\n            ...value,\r\n        }), [control, exact]);\r\n    useSubscribe({\r\n        disabled,\r\n        callback,\r\n        subject: control._subjects.state,\r\n    });\r\n    React.useEffect(() => {\r\n        _mounted.current = true;\r\n        return () => {\r\n            _mounted.current = false;\r\n        };\r\n    }, []);\r\n    return getProxyFormState(formState, control._proxyFormState, _localProxyFormState.current, false);\r\n}\n\nvar isString = (value) => typeof value === 'string';\n\nvar generateWatchOutput = (names, _names, formValues, isGlobal) => {\r\n    const isArray = Array.isArray(names);\r\n    if (isString(names)) {\r\n        isGlobal && _names.watch.add(names);\r\n        return get(formValues, names);\r\n    }\r\n    if (isArray) {\r\n        return names.map((fieldName) => (isGlobal && _names.watch.add(fieldName),\r\n            get(formValues, fieldName)));\r\n    }\r\n    isGlobal && (_names.watchAll = true);\r\n    return formValues;\r\n};\n\nvar isFunction = (value) => typeof value === 'function';\n\nvar objectHasFunction = (data) => {\r\n    for (const key in data) {\r\n        if (isFunction(data[key])) {\r\n            return true;\r\n        }\r\n    }\r\n    return false;\r\n};\n\n/**\r\n * Custom hook to subscribe to field change and isolate re-rendering at the component level.\r\n *\r\n * @remarks\r\n *\r\n * [API](https://react-hook-form.com/api/usewatch) • [Demo](https://codesandbox.io/s/react-hook-form-v7-ts-usewatch-h9i5e)\r\n *\r\n * @example\r\n * ```tsx\r\n * const { watch } = useForm();\r\n * const values = useWatch({\r\n *   name: \"fieldName\"\r\n *   control,\r\n * })\r\n * ```\r\n */\r\nfunction useWatch(props) {\r\n    const methods = useFormContext();\r\n    const { control = methods.control, name, defaultValue, disabled, exact, } = props || {};\r\n    const _name = React.useRef(name);\r\n    _name.current = name;\r\n    const callback = React.useCallback((formState) => {\r\n        if (shouldSubscribeByName(_name.current, formState.name, exact)) {\r\n            const fieldValues = generateWatchOutput(_name.current, control._names, formState.values || control._formValues);\r\n            updateValue(isUndefined(_name.current) ||\r\n                (isObject(fieldValues) && !objectHasFunction(fieldValues))\r\n                ? { ...fieldValues }\r\n                : Array.isArray(fieldValues)\r\n                    ? [...fieldValues]\r\n                    : isUndefined(fieldValues)\r\n                        ? defaultValue\r\n                        : fieldValues);\r\n        }\r\n    }, [control, exact, defaultValue]);\r\n    useSubscribe({\r\n        disabled,\r\n        subject: control._subjects.watch,\r\n        callback,\r\n    });\r\n    const [value, updateValue] = React.useState(isUndefined(defaultValue)\r\n        ? control._getWatch(name)\r\n        : defaultValue);\r\n    React.useEffect(() => {\r\n        control._removeUnmounted();\r\n    });\r\n    return value;\r\n}\n\n/**\r\n * Custom hook to work with controlled component, this function provide you with both form and field level state. Re-render is isolated at the hook level.\r\n *\r\n * @remarks\r\n * [API](https://react-hook-form.com/api/usecontroller) • [Demo](https://codesandbox.io/s/usecontroller-0o8px)\r\n *\r\n * @param props - the path name to the form field value, and validation rules.\r\n *\r\n * @returns field properties, field and form state. {@link UseControllerReturn}\r\n *\r\n * @example\r\n * ```tsx\r\n * function Input(props) {\r\n *   const { field, fieldState, formState } = useController(props);\r\n *   return (\r\n *     <div>\r\n *       <input {...field} placeholder={props.name} />\r\n *       <p>{fieldState.isTouched && \"Touched\"}</p>\r\n *       <p>{formState.isSubmitted ? \"submitted\" : \"\"}</p>\r\n *     </div>\r\n *   );\r\n * }\r\n * ```\r\n */\r\nfunction useController(props) {\r\n    const methods = useFormContext();\r\n    const { name, control = methods.control, shouldUnregister } = props;\r\n    const isArrayField = isNameInFieldArray(control._names.array, name);\r\n    const value = useWatch({\r\n        control,\r\n        name,\r\n        defaultValue: get(control._formValues, name, get(control._defaultValues, name, props.defaultValue)),\r\n        exact: true,\r\n    });\r\n    const formState = useFormState({\r\n        control,\r\n        name,\r\n    });\r\n    const _registerProps = React.useRef(control.register(name, {\r\n        ...props.rules,\r\n        value,\r\n    }));\r\n    React.useEffect(() => {\r\n        const updateMounted = (name, value) => {\r\n            const field = get(control._fields, name);\r\n            if (field) {\r\n                field._f.mount = value;\r\n            }\r\n        };\r\n        updateMounted(name, true);\r\n        return () => {\r\n            const _shouldUnregisterField = control._options.shouldUnregister || shouldUnregister;\r\n            (isArrayField\r\n                ? _shouldUnregisterField && !control._stateFlags.action\r\n                : _shouldUnregisterField)\r\n                ? control.unregister(name)\r\n                : updateMounted(name, false);\r\n        };\r\n    }, [name, control, isArrayField, shouldUnregister]);\r\n    return {\r\n        field: {\r\n            name,\r\n            value,\r\n            onChange: React.useCallback((event) => {\r\n                _registerProps.current.onChange({\r\n                    target: {\r\n                        value: getEventValue(event),\r\n                        name: name,\r\n                    },\r\n                    type: EVENTS.CHANGE,\r\n                });\r\n            }, [name]),\r\n            onBlur: React.useCallback(() => {\r\n                _registerProps.current.onBlur({\r\n                    target: {\r\n                        value: get(control._formValues, name),\r\n                        name: name,\r\n                    },\r\n                    type: EVENTS.BLUR,\r\n                });\r\n            }, [name, control]),\r\n            ref: React.useCallback((elm) => {\r\n                const field = get(control._fields, name);\r\n                if (elm && field && elm.focus) {\r\n                    field._f.ref = {\r\n                        focus: () => elm.focus(),\r\n                        select: () => elm.select(),\r\n                        setCustomValidity: (message) => elm.setCustomValidity(message),\r\n                        reportValidity: () => elm.reportValidity(),\r\n                    };\r\n                }\r\n            }, [name, control._fields]),\r\n        },\r\n        formState,\r\n        fieldState: Object.defineProperties({}, {\r\n            invalid: {\r\n                enumerable: true,\r\n                get: () => !!get(formState.errors, name),\r\n            },\r\n            isDirty: {\r\n                enumerable: true,\r\n                get: () => !!get(formState.dirtyFields, name),\r\n            },\r\n            isTouched: {\r\n                enumerable: true,\r\n                get: () => !!get(formState.touchedFields, name),\r\n            },\r\n            error: {\r\n                enumerable: true,\r\n                get: () => get(formState.errors, name),\r\n            },\r\n        }),\r\n    };\r\n}\n\n/**\r\n * Component based on `useController` hook to work with controlled component.\r\n *\r\n * @remarks\r\n * [API](https://react-hook-form.com/api/usecontroller/controller) • [Demo](https://codesandbox.io/s/react-hook-form-v6-controller-ts-jwyzw) • [Video](https://www.youtube.com/watch?v=N2UNk_UCVyA)\r\n *\r\n * @param props - the path name to the form field value, and validation rules.\r\n *\r\n * @returns provide field handler functions, field and form state.\r\n *\r\n * @example\r\n * ```tsx\r\n * function App() {\r\n *   const { control } = useForm<FormValues>({\r\n *     defaultValues: {\r\n *       test: \"\"\r\n *     }\r\n *   });\r\n *\r\n *   return (\r\n *     <form>\r\n *       <Controller\r\n *         control={control}\r\n *         name=\"test\"\r\n *         render={({ field: { onChange, onBlur, value, ref }, formState, fieldState }) => (\r\n *           <>\r\n *             <input\r\n *               onChange={onChange} // send value to hook form\r\n *               onBlur={onBlur} // notify when input is touched\r\n *               value={value} // return updated value\r\n *               ref={ref} // set ref for focus management\r\n *             />\r\n *             <p>{formState.isSubmitted ? \"submitted\" : \"\"}</p>\r\n *             <p>{fieldState.isTouched ? \"touched\" : \"\"}</p>\r\n *           </>\r\n *         )}\r\n *       />\r\n *     </form>\r\n *   );\r\n * }\r\n * ```\r\n */\r\nconst Controller = (props) => props.render(useController(props));\n\nvar appendErrors = (name, validateAllFieldCriteria, errors, type, message) => validateAllFieldCriteria\r\n    ? {\r\n        ...errors[name],\r\n        types: {\r\n            ...(errors[name] && errors[name].types ? errors[name].types : {}),\r\n            [type]: message || true,\r\n        },\r\n    }\r\n    : {};\n\nvar isKey = (value) => /^\\w*$/.test(value);\n\nvar stringToPath = (input) => compact(input.replace(/[\"|']|\\]/g, '').split(/\\.|\\[/));\n\nfunction set(object, path, value) {\r\n    let index = -1;\r\n    const tempPath = isKey(path) ? [path] : stringToPath(path);\r\n    const length = tempPath.length;\r\n    const lastIndex = length - 1;\r\n    while (++index < length) {\r\n        const key = tempPath[index];\r\n        let newValue = value;\r\n        if (index !== lastIndex) {\r\n            const objValue = object[key];\r\n            newValue =\r\n                isObject(objValue) || Array.isArray(objValue)\r\n                    ? objValue\r\n                    : !isNaN(+tempPath[index + 1])\r\n                        ? []\r\n                        : {};\r\n        }\r\n        object[key] = newValue;\r\n        object = object[key];\r\n    }\r\n    return object;\r\n}\n\nconst focusFieldBy = (fields, callback, fieldsNames) => {\r\n    for (const key of fieldsNames || Object.keys(fields)) {\r\n        const field = get(fields, key);\r\n        if (field) {\r\n            const { _f, ...currentField } = field;\r\n            if (_f && callback(_f.name)) {\r\n                if (_f.ref.focus && isUndefined(_f.ref.focus())) {\r\n                    break;\r\n                }\r\n                else if (_f.refs) {\r\n                    _f.refs[0].focus();\r\n                    break;\r\n                }\r\n            }\r\n            else if (isObject(currentField)) {\r\n                focusFieldBy(currentField, callback);\r\n            }\r\n        }\r\n    }\r\n};\n\nvar generateId = () => {\r\n    const d = typeof performance === 'undefined' ? Date.now() : performance.now() * 1000;\r\n    return 'xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx'.replace(/[xy]/g, (c) => {\r\n        const r = (Math.random() * 16 + d) % 16 | 0;\r\n        return (c == 'x' ? r : (r & 0x3) | 0x8).toString(16);\r\n    });\r\n};\n\nvar getFocusFieldName = (name, index, options = {}) => options.shouldFocus || isUndefined(options.shouldFocus)\r\n    ? options.focusName ||\r\n        `${name}.${isUndefined(options.focusIndex) ? index : options.focusIndex}.`\r\n    : '';\n\nvar isWatched = (name, _names, isBlurEvent) => !isBlurEvent &&\r\n    (_names.watchAll ||\r\n        _names.watch.has(name) ||\r\n        [..._names.watch].some((watchName) => name.startsWith(watchName) &&\r\n            /^\\.\\w+/.test(name.slice(watchName.length))));\n\nvar updateFieldArrayRootError = (errors, error, name) => {\r\n    const fieldArrayErrors = compact(get(errors, name));\r\n    set(fieldArrayErrors, 'root', error[name]);\r\n    set(errors, name, fieldArrayErrors);\r\n    return errors;\r\n};\n\nvar isBoolean = (value) => typeof value === 'boolean';\n\nvar isFileInput = (element) => element.type === 'file';\n\nvar isMessage = (value) => isString(value) || React.isValidElement(value);\n\nvar isRadioInput = (element) => element.type === 'radio';\n\nvar isRegex = (value) => value instanceof RegExp;\n\nconst defaultResult = {\r\n    value: false,\r\n    isValid: false,\r\n};\r\nconst validResult = { value: true, isValid: true };\r\nvar getCheckboxValue = (options) => {\r\n    if (Array.isArray(options)) {\r\n        if (options.length > 1) {\r\n            const values = options\r\n                .filter((option) => option && option.checked && !option.disabled)\r\n                .map((option) => option.value);\r\n            return { value: values, isValid: !!values.length };\r\n        }\r\n        return options[0].checked && !options[0].disabled\r\n            ? // @ts-expect-error expected to work in the browser\r\n                options[0].attributes && !isUndefined(options[0].attributes.value)\r\n                    ? isUndefined(options[0].value) || options[0].value === ''\r\n                        ? validResult\r\n                        : { value: options[0].value, isValid: true }\r\n                    : validResult\r\n            : defaultResult;\r\n    }\r\n    return defaultResult;\r\n};\n\nconst defaultReturn = {\r\n    isValid: false,\r\n    value: null,\r\n};\r\nvar getRadioValue = (options) => Array.isArray(options)\r\n    ? options.reduce((previous, option) => option && option.checked && !option.disabled\r\n        ? {\r\n            isValid: true,\r\n            value: option.value,\r\n        }\r\n        : previous, defaultReturn)\r\n    : defaultReturn;\n\nfunction getValidateError(result, ref, type = 'validate') {\r\n    if (isMessage(result) ||\r\n        (Array.isArray(result) && result.every(isMessage)) ||\r\n        (isBoolean(result) && !result)) {\r\n        return {\r\n            type,\r\n            message: isMessage(result) ? result : '',\r\n            ref,\r\n        };\r\n    }\r\n}\n\nvar getValueAndMessage = (validationData) => isObject(validationData) && !isRegex(validationData)\r\n    ? validationData\r\n    : {\r\n        value: validationData,\r\n        message: '',\r\n    };\n\nvar validateField = async (field, inputValue, validateAllFieldCriteria, shouldUseNativeValidation, isFieldArray) => {\r\n    const { ref, refs, required, maxLength, minLength, min, max, pattern, validate, name, valueAsNumber, mount, disabled, } = field._f;\r\n    if (!mount || disabled) {\r\n        return {};\r\n    }\r\n    const inputRef = refs ? refs[0] : ref;\r\n    const setCustomValidity = (message) => {\r\n        if (shouldUseNativeValidation && inputRef.reportValidity) {\r\n            inputRef.setCustomValidity(isBoolean(message) ? '' : message || ' ');\r\n            inputRef.reportValidity();\r\n        }\r\n    };\r\n    const error = {};\r\n    const isRadio = isRadioInput(ref);\r\n    const isCheckBox = isCheckBoxInput(ref);\r\n    const isRadioOrCheckbox = isRadio || isCheckBox;\r\n    const isEmpty = ((valueAsNumber || isFileInput(ref)) && !ref.value) ||\r\n        inputValue === '' ||\r\n        (Array.isArray(inputValue) && !inputValue.length);\r\n    const appendErrorsCurry = appendErrors.bind(null, name, validateAllFieldCriteria, error);\r\n    const getMinMaxMessage = (exceedMax, maxLengthMessage, minLengthMessage, maxType = INPUT_VALIDATION_RULES.maxLength, minType = INPUT_VALIDATION_RULES.minLength) => {\r\n        const message = exceedMax ? maxLengthMessage : minLengthMessage;\r\n        error[name] = {\r\n            type: exceedMax ? maxType : minType,\r\n            message,\r\n            ref,\r\n            ...appendErrorsCurry(exceedMax ? maxType : minType, message),\r\n        };\r\n    };\r\n    if (isFieldArray\r\n        ? !Array.isArray(inputValue) || !inputValue.length\r\n        : required &&\r\n            ((!isRadioOrCheckbox && (isEmpty || isNullOrUndefined(inputValue))) ||\r\n                (isBoolean(inputValue) && !inputValue) ||\r\n                (isCheckBox && !getCheckboxValue(refs).isValid) ||\r\n                (isRadio && !getRadioValue(refs).isValid))) {\r\n        const { value, message } = isMessage(required)\r\n            ? { value: !!required, message: required }\r\n            : getValueAndMessage(required);\r\n        if (value) {\r\n            error[name] = {\r\n                type: INPUT_VALIDATION_RULES.required,\r\n                message,\r\n                ref: inputRef,\r\n                ...appendErrorsCurry(INPUT_VALIDATION_RULES.required, message),\r\n            };\r\n            if (!validateAllFieldCriteria) {\r\n                setCustomValidity(message);\r\n                return error;\r\n            }\r\n        }\r\n    }\r\n    if (!isEmpty && (!isNullOrUndefined(min) || !isNullOrUndefined(max))) {\r\n        let exceedMax;\r\n        let exceedMin;\r\n        const maxOutput = getValueAndMessage(max);\r\n        const minOutput = getValueAndMessage(min);\r\n        if (!isNullOrUndefined(inputValue) && !isNaN(inputValue)) {\r\n            const valueNumber = ref.valueAsNumber ||\r\n                (inputValue ? +inputValue : inputValue);\r\n            if (!isNullOrUndefined(maxOutput.value)) {\r\n                exceedMax = valueNumber > maxOutput.value;\r\n            }\r\n            if (!isNullOrUndefined(minOutput.value)) {\r\n                exceedMin = valueNumber < minOutput.value;\r\n            }\r\n        }\r\n        else {\r\n            const valueDate = ref.valueAsDate || new Date(inputValue);\r\n            if (isString(maxOutput.value)) {\r\n                exceedMax = valueDate > new Date(maxOutput.value);\r\n            }\r\n            if (isString(minOutput.value)) {\r\n                exceedMin = valueDate < new Date(minOutput.value);\r\n            }\r\n        }\r\n        if (exceedMax || exceedMin) {\r\n            getMinMaxMessage(!!exceedMax, maxOutput.message, minOutput.message, INPUT_VALIDATION_RULES.max, INPUT_VALIDATION_RULES.min);\r\n            if (!validateAllFieldCriteria) {\r\n                setCustomValidity(error[name].message);\r\n                return error;\r\n            }\r\n        }\r\n    }\r\n    if ((maxLength || minLength) &&\r\n        !isEmpty &&\r\n        (isString(inputValue) || (isFieldArray && Array.isArray(inputValue)))) {\r\n        const maxLengthOutput = getValueAndMessage(maxLength);\r\n        const minLengthOutput = getValueAndMessage(minLength);\r\n        const exceedMax = !isNullOrUndefined(maxLengthOutput.value) &&\r\n            inputValue.length > maxLengthOutput.value;\r\n        const exceedMin = !isNullOrUndefined(minLengthOutput.value) &&\r\n            inputValue.length < minLengthOutput.value;\r\n        if (exceedMax || exceedMin) {\r\n            getMinMaxMessage(exceedMax, maxLengthOutput.message, minLengthOutput.message);\r\n            if (!validateAllFieldCriteria) {\r\n                setCustomValidity(error[name].message);\r\n                return error;\r\n            }\r\n        }\r\n    }\r\n    if (pattern && !isEmpty && isString(inputValue)) {\r\n        const { value: patternValue, message } = getValueAndMessage(pattern);\r\n        if (isRegex(patternValue) && !inputValue.match(patternValue)) {\r\n            error[name] = {\r\n                type: INPUT_VALIDATION_RULES.pattern,\r\n                message,\r\n                ref,\r\n                ...appendErrorsCurry(INPUT_VALIDATION_RULES.pattern, message),\r\n            };\r\n            if (!validateAllFieldCriteria) {\r\n                setCustomValidity(message);\r\n                return error;\r\n            }\r\n        }\r\n    }\r\n    if (validate) {\r\n        if (isFunction(validate)) {\r\n            const result = await validate(inputValue);\r\n            const validateError = getValidateError(result, inputRef);\r\n            if (validateError) {\r\n                error[name] = {\r\n                    ...validateError,\r\n                    ...appendErrorsCurry(INPUT_VALIDATION_RULES.validate, validateError.message),\r\n                };\r\n                if (!validateAllFieldCriteria) {\r\n                    setCustomValidity(validateError.message);\r\n                    return error;\r\n                }\r\n            }\r\n        }\r\n        else if (isObject(validate)) {\r\n            let validationResult = {};\r\n            for (const key in validate) {\r\n                if (!isEmptyObject(validationResult) && !validateAllFieldCriteria) {\r\n                    break;\r\n                }\r\n                const validateError = getValidateError(await validate[key](inputValue), inputRef, key);\r\n                if (validateError) {\r\n                    validationResult = {\r\n                        ...validateError,\r\n                        ...appendErrorsCurry(key, validateError.message),\r\n                    };\r\n                    setCustomValidity(validateError.message);\r\n                    if (validateAllFieldCriteria) {\r\n                        error[name] = validationResult;\r\n                    }\r\n                }\r\n            }\r\n            if (!isEmptyObject(validationResult)) {\r\n                error[name] = {\r\n                    ref: inputRef,\r\n                    ...validationResult,\r\n                };\r\n                if (!validateAllFieldCriteria) {\r\n                    return error;\r\n                }\r\n            }\r\n        }\r\n    }\r\n    setCustomValidity(true);\r\n    return error;\r\n};\n\nfunction append(data, value) {\r\n    return [...data, ...convertToArrayPayload(value)];\r\n}\n\nvar isWeb = typeof window !== 'undefined' &&\r\n    typeof window.HTMLElement !== 'undefined' &&\r\n    typeof document !== 'undefined';\n\nfunction cloneObject(data) {\r\n    let copy;\r\n    const isArray = Array.isArray(data);\r\n    if (data instanceof Date) {\r\n        copy = new Date(data);\r\n    }\r\n    else if (data instanceof Set) {\r\n        copy = new Set(data);\r\n    }\r\n    else if (!(isWeb && (data instanceof Blob || data instanceof FileList)) &&\r\n        (isArray || isObject(data))) {\r\n        copy = isArray ? [] : {};\r\n        for (const key in data) {\r\n            if (isFunction(data[key])) {\r\n                copy = data;\r\n                break;\r\n            }\r\n            copy[key] = cloneObject(data[key]);\r\n        }\r\n    }\r\n    else {\r\n        return data;\r\n    }\r\n    return copy;\r\n}\n\nvar fillEmptyArray = (value) => Array.isArray(value) ? value.map(() => undefined) : undefined;\n\nvar getValidationModes = (mode) => ({\r\n    isOnSubmit: !mode || mode === VALIDATION_MODE.onSubmit,\r\n    isOnBlur: mode === VALIDATION_MODE.onBlur,\r\n    isOnChange: mode === VALIDATION_MODE.onChange,\r\n    isOnAll: mode === VALIDATION_MODE.all,\r\n    isOnTouch: mode === VALIDATION_MODE.onTouched,\r\n});\n\nfunction insert(data, index, value) {\r\n    return [\r\n        ...data.slice(0, index),\r\n        ...convertToArrayPayload(value),\r\n        ...data.slice(index),\r\n    ];\r\n}\n\nvar moveArrayAt = (data, from, to) => {\r\n    if (!Array.isArray(data)) {\r\n        return [];\r\n    }\r\n    if (isUndefined(data[to])) {\r\n        data[to] = undefined;\r\n    }\r\n    data.splice(to, 0, data.splice(from, 1)[0]);\r\n    return data;\r\n};\n\nfunction prepend(data, value) {\r\n    return [...convertToArrayPayload(value), ...convertToArrayPayload(data)];\r\n}\n\nfunction removeAtIndexes(data, indexes) {\r\n    let i = 0;\r\n    const temp = [...data];\r\n    for (const index of indexes) {\r\n        temp.splice(index - i, 1);\r\n        i++;\r\n    }\r\n    return compact(temp).length ? temp : [];\r\n}\r\nvar removeArrayAt = (data, index) => isUndefined(index)\r\n    ? []\r\n    : removeAtIndexes(data, convertToArrayPayload(index).sort((a, b) => a - b));\n\nvar swapArrayAt = (data, indexA, indexB) => {\r\n    data[indexA] = [data[indexB], (data[indexB] = data[indexA])][0];\r\n};\n\nfunction baseGet(object, updatePath) {\r\n    const length = updatePath.slice(0, -1).length;\r\n    let index = 0;\r\n    while (index < length) {\r\n        object = isUndefined(object) ? index++ : object[updatePath[index++]];\r\n    }\r\n    return object;\r\n}\r\nfunction isEmptyArray(obj) {\r\n    for (const key in obj) {\r\n        if (!isUndefined(obj[key])) {\r\n            return false;\r\n        }\r\n    }\r\n    return true;\r\n}\r\nfunction unset(object, path) {\r\n    const updatePath = isKey(path) ? [path] : stringToPath(path);\r\n    const childObject = updatePath.length == 1 ? object : baseGet(object, updatePath);\r\n    const key = updatePath[updatePath.length - 1];\r\n    let previousObjRef;\r\n    if (childObject) {\r\n        delete childObject[key];\r\n    }\r\n    for (let k = 0; k < updatePath.slice(0, -1).length; k++) {\r\n        let index = -1;\r\n        let objectRef;\r\n        const currentPaths = updatePath.slice(0, -(k + 1));\r\n        const currentPathsLength = currentPaths.length - 1;\r\n        if (k > 0) {\r\n            previousObjRef = object;\r\n        }\r\n        while (++index < currentPaths.length) {\r\n            const item = currentPaths[index];\r\n            objectRef = objectRef ? objectRef[item] : object[item];\r\n            if (currentPathsLength === index &&\r\n                ((isObject(objectRef) && isEmptyObject(objectRef)) ||\r\n                    (Array.isArray(objectRef) && isEmptyArray(objectRef)))) {\r\n                previousObjRef ? delete previousObjRef[item] : delete object[item];\r\n            }\r\n            previousObjRef = objectRef;\r\n        }\r\n    }\r\n    return object;\r\n}\n\nvar updateAt = (fieldValues, index, value) => {\r\n    fieldValues[index] = value;\r\n    return fieldValues;\r\n};\n\n/**\r\n * A custom hook that exposes convenient methods to perform operations with a list of dynamic inputs that need to be appended, updated, removed etc.\r\n *\r\n * @remarks\r\n * [API](https://react-hook-form.com/api/usefieldarray) • [Demo](https://codesandbox.io/s/react-hook-form-usefieldarray-ssugn)\r\n *\r\n * @param props - useFieldArray props\r\n *\r\n * @returns methods - functions to manipulate with the Field Arrays (dynamic inputs) {@link UseFieldArrayReturn}\r\n *\r\n * @example\r\n * ```tsx\r\n * function App() {\r\n *   const { register, control, handleSubmit, reset, trigger, setError } = useForm({\r\n *     defaultValues: {\r\n *       test: []\r\n *     }\r\n *   });\r\n *   const { fields, append } = useFieldArray({\r\n *     control,\r\n *     name: \"test\"\r\n *   });\r\n *\r\n *   return (\r\n *     <form onSubmit={handleSubmit(data => console.log(data))}>\r\n *       {fields.map((item, index) => (\r\n *          <input key={item.id} {...register(`test.${index}.firstName`)}  />\r\n *       ))}\r\n *       <button type=\"button\" onClick={() => append({ firstName: \"bill\" })}>\r\n *         append\r\n *       </button>\r\n *       <input type=\"submit\" />\r\n *     </form>\r\n *   );\r\n * }\r\n * ```\r\n */\r\nfunction useFieldArray(props) {\r\n    const methods = useFormContext();\r\n    const { control = methods.control, name, keyName = 'id', shouldUnregister, } = props;\r\n    const [fields, setFields] = React.useState(control._getFieldArray(name));\r\n    const ids = React.useRef(control._getFieldArray(name).map(generateId));\r\n    const _fieldIds = React.useRef(fields);\r\n    const _name = React.useRef(name);\r\n    const _actioned = React.useRef(false);\r\n    _name.current = name;\r\n    _fieldIds.current = fields;\r\n    control._names.array.add(name);\r\n    props.rules &&\r\n        control.register(name, props.rules);\r\n    const callback = React.useCallback(({ values, name: fieldArrayName, }) => {\r\n        if (fieldArrayName === _name.current || !fieldArrayName) {\r\n            const fieldValues = get(values, _name.current, []);\r\n            setFields(fieldValues);\r\n            ids.current = fieldValues.map(generateId);\r\n        }\r\n    }, []);\r\n    useSubscribe({\r\n        callback,\r\n        subject: control._subjects.array,\r\n    });\r\n    const updateValues = React.useCallback((updatedFieldArrayValues) => {\r\n        _actioned.current = true;\r\n        control._updateFieldArray(name, updatedFieldArrayValues);\r\n    }, [control, name]);\r\n    const append$1 = (value, options) => {\r\n        const appendValue = convertToArrayPayload(cloneObject(value));\r\n        const updatedFieldArrayValues = append(control._getFieldArray(name), appendValue);\r\n        control._names.focus = getFocusFieldName(name, updatedFieldArrayValues.length - 1, options);\r\n        ids.current = append(ids.current, appendValue.map(generateId));\r\n        updateValues(updatedFieldArrayValues);\r\n        setFields(updatedFieldArrayValues);\r\n        control._updateFieldArray(name, updatedFieldArrayValues, append, {\r\n            argA: fillEmptyArray(value),\r\n        });\r\n    };\r\n    const prepend$1 = (value, options) => {\r\n        const prependValue = convertToArrayPayload(cloneObject(value));\r\n        const updatedFieldArrayValues = prepend(control._getFieldArray(name), prependValue);\r\n        control._names.focus = getFocusFieldName(name, 0, options);\r\n        ids.current = prepend(ids.current, prependValue.map(generateId));\r\n        updateValues(updatedFieldArrayValues);\r\n        setFields(updatedFieldArrayValues);\r\n        control._updateFieldArray(name, updatedFieldArrayValues, prepend, {\r\n            argA: fillEmptyArray(value),\r\n        });\r\n    };\r\n    const remove = (index) => {\r\n        const updatedFieldArrayValues = removeArrayAt(control._getFieldArray(name), index);\r\n        ids.current = removeArrayAt(ids.current, index);\r\n        updateValues(updatedFieldArrayValues);\r\n        setFields(updatedFieldArrayValues);\r\n        control._updateFieldArray(name, updatedFieldArrayValues, removeArrayAt, {\r\n            argA: index,\r\n        });\r\n    };\r\n    const insert$1 = (index, value, options) => {\r\n        const insertValue = convertToArrayPayload(cloneObject(value));\r\n        const updatedFieldArrayValues = insert(control._getFieldArray(name), index, insertValue);\r\n        control._names.focus = getFocusFieldName(name, index, options);\r\n        ids.current = insert(ids.current, index, insertValue.map(generateId));\r\n        updateValues(updatedFieldArrayValues);\r\n        setFields(updatedFieldArrayValues);\r\n        control._updateFieldArray(name, updatedFieldArrayValues, insert, {\r\n            argA: index,\r\n            argB: fillEmptyArray(value),\r\n        });\r\n    };\r\n    const swap = (indexA, indexB) => {\r\n        const updatedFieldArrayValues = control._getFieldArray(name);\r\n        swapArrayAt(updatedFieldArrayValues, indexA, indexB);\r\n        swapArrayAt(ids.current, indexA, indexB);\r\n        updateValues(updatedFieldArrayValues);\r\n        setFields(updatedFieldArrayValues);\r\n        control._updateFieldArray(name, updatedFieldArrayValues, swapArrayAt, {\r\n            argA: indexA,\r\n            argB: indexB,\r\n        }, false);\r\n    };\r\n    const move = (from, to) => {\r\n        const updatedFieldArrayValues = control._getFieldArray(name);\r\n        moveArrayAt(updatedFieldArrayValues, from, to);\r\n        moveArrayAt(ids.current, from, to);\r\n        updateValues(updatedFieldArrayValues);\r\n        setFields(updatedFieldArrayValues);\r\n        control._updateFieldArray(name, updatedFieldArrayValues, moveArrayAt, {\r\n            argA: from,\r\n            argB: to,\r\n        }, false);\r\n    };\r\n    const update = (index, value) => {\r\n        const updateValue = cloneObject(value);\r\n        const updatedFieldArrayValues = updateAt(control._getFieldArray(name), index, updateValue);\r\n        ids.current = [...updatedFieldArrayValues].map((item, i) => !item || i === index ? generateId() : ids.current[i]);\r\n        updateValues(updatedFieldArrayValues);\r\n        setFields([...updatedFieldArrayValues]);\r\n        control._updateFieldArray(name, updatedFieldArrayValues, updateAt, {\r\n            argA: index,\r\n            argB: updateValue,\r\n        }, true, false);\r\n    };\r\n    const replace = (value) => {\r\n        const updatedFieldArrayValues = convertToArrayPayload(cloneObject(value));\r\n        ids.current = updatedFieldArrayValues.map(generateId);\r\n        updateValues([...updatedFieldArrayValues]);\r\n        setFields([...updatedFieldArrayValues]);\r\n        control._updateFieldArray(name, [...updatedFieldArrayValues], (data) => data, {}, true, false);\r\n    };\r\n    React.useEffect(() => {\r\n        control._stateFlags.action = false;\r\n        isWatched(name, control._names) && control._subjects.state.next({});\r\n        if (_actioned.current) {\r\n            if (control._options.resolver) {\r\n                control._executeSchema([name]).then((result) => {\r\n                    const error = get(result.errors, name);\r\n                    const existingError = get(control._formState.errors, name);\r\n                    if (existingError ? !error && existingError.type : error && error.type) {\r\n                        error\r\n                            ? set(control._formState.errors, name, error)\r\n                            : unset(control._formState.errors, name);\r\n                        control._subjects.state.next({\r\n                            errors: control._formState.errors,\r\n                        });\r\n                    }\r\n                });\r\n            }\r\n            else {\r\n                const field = get(control._fields, name);\r\n                const validationModeBeforeSubmit = getValidationModes(control._options.mode);\r\n                if ((!validationModeBeforeSubmit.isOnSubmit ||\r\n                    control._formState.isSubmitted) &&\r\n                    field &&\r\n                    field._f) {\r\n                    validateField(field, get(control._formValues, name), control._options.criteriaMode === VALIDATION_MODE.all, control._options.shouldUseNativeValidation, true).then((error) => !isEmptyObject(error) &&\r\n                        control._subjects.state.next({\r\n                            errors: updateFieldArrayRootError(control._formState.errors, error, name),\r\n                        }));\r\n                }\r\n            }\r\n        }\r\n        control._subjects.watch.next({\r\n            name,\r\n            values: control._formValues,\r\n        });\r\n        control._names.focus &&\r\n            focusFieldBy(control._fields, (key) => key.startsWith(control._names.focus));\r\n        control._names.focus = '';\r\n        control._proxyFormState.isValid && control._updateValid();\r\n    }, [fields, name, control]);\r\n    React.useEffect(() => {\r\n        !get(control._formValues, name) && control._updateFieldArray(name);\r\n        return () => {\r\n            (control._options.shouldUnregister || shouldUnregister) &&\r\n                control.unregister(name);\r\n        };\r\n    }, [name, control, keyName, shouldUnregister]);\r\n    return {\r\n        swap: React.useCallback(swap, [updateValues, name, control]),\r\n        move: React.useCallback(move, [updateValues, name, control]),\r\n        prepend: React.useCallback(prepend$1, [updateValues, name, control]),\r\n        append: React.useCallback(append$1, [updateValues, name, control]),\r\n        remove: React.useCallback(remove, [updateValues, name, control]),\r\n        insert: React.useCallback(insert$1, [updateValues, name, control]),\r\n        update: React.useCallback(update, [updateValues, name, control]),\r\n        replace: React.useCallback(replace, [updateValues, name, control]),\r\n        fields: React.useMemo(() => fields.map((field, index) => ({\r\n            ...field,\r\n            [keyName]: ids.current[index] || generateId(),\r\n        })), [fields, keyName]),\r\n    };\r\n}\n\nfunction createSubject() {\r\n    let _observers = [];\r\n    const next = (value) => {\r\n        for (const observer of _observers) {\r\n            observer.next(value);\r\n        }\r\n    };\r\n    const subscribe = (observer) => {\r\n        _observers.push(observer);\r\n        return {\r\n            unsubscribe: () => {\r\n                _observers = _observers.filter((o) => o !== observer);\r\n            },\r\n        };\r\n    };\r\n    const unsubscribe = () => {\r\n        _observers = [];\r\n    };\r\n    return {\r\n        get observers() {\r\n            return _observers;\r\n        },\r\n        next,\r\n        subscribe,\r\n        unsubscribe,\r\n    };\r\n}\n\nvar isPrimitive = (value) => isNullOrUndefined(value) || !isObjectType(value);\n\nfunction deepEqual(object1, object2) {\r\n    if (isPrimitive(object1) || isPrimitive(object2)) {\r\n        return object1 === object2;\r\n    }\r\n    if (isDateObject(object1) && isDateObject(object2)) {\r\n        return object1.getTime() === object2.getTime();\r\n    }\r\n    const keys1 = Object.keys(object1);\r\n    const keys2 = Object.keys(object2);\r\n    if (keys1.length !== keys2.length) {\r\n        return false;\r\n    }\r\n    for (const key of keys1) {\r\n        const val1 = object1[key];\r\n        if (!keys2.includes(key)) {\r\n            return false;\r\n        }\r\n        if (key !== 'ref') {\r\n            const val2 = object2[key];\r\n            if ((isDateObject(val1) && isDateObject(val2)) ||\r\n                (isObject(val1) && isObject(val2)) ||\r\n                (Array.isArray(val1) && Array.isArray(val2))\r\n                ? !deepEqual(val1, val2)\r\n                : val1 !== val2) {\r\n                return false;\r\n            }\r\n        }\r\n    }\r\n    return true;\r\n}\n\nvar isHTMLElement = (value) => {\r\n    const owner = value ? value.ownerDocument : 0;\r\n    const ElementClass = owner && owner.defaultView ? owner.defaultView.HTMLElement : HTMLElement;\r\n    return value instanceof ElementClass;\r\n};\n\nvar isMultipleSelect = (element) => element.type === `select-multiple`;\n\nvar isRadioOrCheckbox = (ref) => isRadioInput(ref) || isCheckBoxInput(ref);\n\nvar live = (ref) => isHTMLElement(ref) && ref.isConnected;\n\nfunction markFieldsDirty(data, fields = {}) {\r\n    const isParentNodeArray = Array.isArray(data);\r\n    if (isObject(data) || isParentNodeArray) {\r\n        for (const key in data) {\r\n            if (Array.isArray(data[key]) ||\r\n                (isObject(data[key]) && !objectHasFunction(data[key]))) {\r\n                fields[key] = Array.isArray(data[key]) ? [] : {};\r\n                markFieldsDirty(data[key], fields[key]);\r\n            }\r\n            else if (!isNullOrUndefined(data[key])) {\r\n                fields[key] = true;\r\n            }\r\n        }\r\n    }\r\n    return fields;\r\n}\r\nfunction getDirtyFieldsFromDefaultValues(data, formValues, dirtyFieldsFromValues) {\r\n    const isParentNodeArray = Array.isArray(data);\r\n    if (isObject(data) || isParentNodeArray) {\r\n        for (const key in data) {\r\n            if (Array.isArray(data[key]) ||\r\n                (isObject(data[key]) && !objectHasFunction(data[key]))) {\r\n                if (isUndefined(formValues) ||\r\n                    isPrimitive(dirtyFieldsFromValues[key])) {\r\n                    dirtyFieldsFromValues[key] = Array.isArray(data[key])\r\n                        ? markFieldsDirty(data[key], [])\r\n                        : { ...markFieldsDirty(data[key]) };\r\n                }\r\n                else {\r\n                    getDirtyFieldsFromDefaultValues(data[key], isNullOrUndefined(formValues) ? {} : formValues[key], dirtyFieldsFromValues[key]);\r\n                }\r\n            }\r\n            else {\r\n                dirtyFieldsFromValues[key] = !deepEqual(data[key], formValues[key]);\r\n            }\r\n        }\r\n    }\r\n    return dirtyFieldsFromValues;\r\n}\r\nvar getDirtyFields = (defaultValues, formValues) => getDirtyFieldsFromDefaultValues(defaultValues, formValues, markFieldsDirty(formValues));\n\nvar getFieldValueAs = (value, { valueAsNumber, valueAsDate, setValueAs }) => isUndefined(value)\r\n    ? value\r\n    : valueAsNumber\r\n        ? value === ''\r\n            ? NaN\r\n            : value\r\n                ? +value\r\n                : value\r\n        : valueAsDate && isString(value)\r\n            ? new Date(value)\r\n            : setValueAs\r\n                ? setValueAs(value)\r\n                : value;\n\nfunction getFieldValue(_f) {\r\n    const ref = _f.ref;\r\n    if (_f.refs ? _f.refs.every((ref) => ref.disabled) : ref.disabled) {\r\n        return;\r\n    }\r\n    if (isFileInput(ref)) {\r\n        return ref.files;\r\n    }\r\n    if (isRadioInput(ref)) {\r\n        return getRadioValue(_f.refs).value;\r\n    }\r\n    if (isMultipleSelect(ref)) {\r\n        return [...ref.selectedOptions].map(({ value }) => value);\r\n    }\r\n    if (isCheckBoxInput(ref)) {\r\n        return getCheckboxValue(_f.refs).value;\r\n    }\r\n    return getFieldValueAs(isUndefined(ref.value) ? _f.ref.value : ref.value, _f);\r\n}\n\nvar getResolverOptions = (fieldsNames, _fields, criteriaMode, shouldUseNativeValidation) => {\r\n    const fields = {};\r\n    for (const name of fieldsNames) {\r\n        const field = get(_fields, name);\r\n        field && set(fields, name, field._f);\r\n    }\r\n    return {\r\n        criteriaMode,\r\n        names: [...fieldsNames],\r\n        fields,\r\n        shouldUseNativeValidation,\r\n    };\r\n};\n\nvar getRuleValue = (rule) => isUndefined(rule)\r\n    ? undefined\r\n    : isRegex(rule)\r\n        ? rule.source\r\n        : isObject(rule)\r\n            ? isRegex(rule.value)\r\n                ? rule.value.source\r\n                : rule.value\r\n            : rule;\n\nvar hasValidation = (options) => options.mount &&\r\n    (options.required ||\r\n        options.min ||\r\n        options.max ||\r\n        options.maxLength ||\r\n        options.minLength ||\r\n        options.pattern ||\r\n        options.validate);\n\nfunction schemaErrorLookup(errors, _fields, name) {\r\n    const error = get(errors, name);\r\n    if (error || isKey(name)) {\r\n        return {\r\n            error,\r\n            name,\r\n        };\r\n    }\r\n    const names = name.split('.');\r\n    while (names.length) {\r\n        const fieldName = names.join('.');\r\n        const field = get(_fields, fieldName);\r\n        const foundError = get(errors, fieldName);\r\n        if (field && !Array.isArray(field) && name !== fieldName) {\r\n            return { name };\r\n        }\r\n        if (foundError && foundError.type) {\r\n            return {\r\n                name: fieldName,\r\n                error: foundError,\r\n            };\r\n        }\r\n        names.pop();\r\n    }\r\n    return {\r\n        name,\r\n    };\r\n}\n\nvar skipValidation = (isBlurEvent, isTouched, isSubmitted, reValidateMode, mode) => {\r\n    if (mode.isOnAll) {\r\n        return false;\r\n    }\r\n    else if (!isSubmitted && mode.isOnTouch) {\r\n        return !(isTouched || isBlurEvent);\r\n    }\r\n    else if (isSubmitted ? reValidateMode.isOnBlur : mode.isOnBlur) {\r\n        return !isBlurEvent;\r\n    }\r\n    else if (isSubmitted ? reValidateMode.isOnChange : mode.isOnChange) {\r\n        return isBlurEvent;\r\n    }\r\n    return true;\r\n};\n\nvar unsetEmptyArray = (ref, name) => !compact(get(ref, name)).length && unset(ref, name);\n\nconst defaultOptions = {\r\n    mode: VALIDATION_MODE.onSubmit,\r\n    reValidateMode: VALIDATION_MODE.onChange,\r\n    shouldFocusError: true,\r\n};\r\nfunction createFormControl(props = {}) {\r\n    let _options = {\r\n        ...defaultOptions,\r\n        ...props,\r\n    };\r\n    let _formState = {\r\n        isDirty: false,\r\n        isValidating: false,\r\n        dirtyFields: {},\r\n        isSubmitted: false,\r\n        submitCount: 0,\r\n        touchedFields: {},\r\n        isSubmitting: false,\r\n        isSubmitSuccessful: false,\r\n        isValid: false,\r\n        errors: {},\r\n    };\r\n    let _fields = {};\r\n    let _defaultValues = cloneObject(_options.defaultValues) || {};\r\n    let _formValues = _options.shouldUnregister\r\n        ? {}\r\n        : cloneObject(_defaultValues);\r\n    let _stateFlags = {\r\n        action: false,\r\n        mount: false,\r\n        watch: false,\r\n    };\r\n    let _names = {\r\n        mount: new Set(),\r\n        unMount: new Set(),\r\n        array: new Set(),\r\n        watch: new Set(),\r\n    };\r\n    let delayErrorCallback;\r\n    let timer = 0;\r\n    let validateFields = {};\r\n    const _proxyFormState = {\r\n        isDirty: false,\r\n        dirtyFields: false,\r\n        touchedFields: false,\r\n        isValidating: false,\r\n        isValid: false,\r\n        errors: false,\r\n    };\r\n    const _subjects = {\r\n        watch: createSubject(),\r\n        array: createSubject(),\r\n        state: createSubject(),\r\n    };\r\n    const validationModeBeforeSubmit = getValidationModes(_options.mode);\r\n    const validationModeAfterSubmit = getValidationModes(_options.reValidateMode);\r\n    const shouldDisplayAllAssociatedErrors = _options.criteriaMode === VALIDATION_MODE.all;\r\n    const debounce = (callback) => (wait) => {\r\n        clearTimeout(timer);\r\n        timer = window.setTimeout(callback, wait);\r\n    };\r\n    const _updateValid = async (shouldSkipRender) => {\r\n        let isValid = false;\r\n        if (_proxyFormState.isValid) {\r\n            isValid = _options.resolver\r\n                ? isEmptyObject((await _executeSchema()).errors)\r\n                : await executeBuiltInValidation(_fields, true);\r\n            if (!shouldSkipRender && isValid !== _formState.isValid) {\r\n                _formState.isValid = isValid;\r\n                _subjects.state.next({\r\n                    isValid,\r\n                });\r\n            }\r\n        }\r\n        return isValid;\r\n    };\r\n    const _updateFieldArray = (name, values = [], method, args, shouldSetValues = true, shouldUpdateFieldsAndState = true) => {\r\n        if (args && method) {\r\n            _stateFlags.action = true;\r\n            if (shouldUpdateFieldsAndState && Array.isArray(get(_fields, name))) {\r\n                const fieldValues = method(get(_fields, name), args.argA, args.argB);\r\n                shouldSetValues && set(_fields, name, fieldValues);\r\n            }\r\n            if (_proxyFormState.errors &&\r\n                shouldUpdateFieldsAndState &&\r\n                Array.isArray(get(_formState.errors, name))) {\r\n                const errors = method(get(_formState.errors, name), args.argA, args.argB);\r\n                shouldSetValues && set(_formState.errors, name, errors);\r\n                unsetEmptyArray(_formState.errors, name);\r\n            }\r\n            if (_proxyFormState.touchedFields &&\r\n                shouldUpdateFieldsAndState &&\r\n                Array.isArray(get(_formState.touchedFields, name))) {\r\n                const touchedFields = method(get(_formState.touchedFields, name), args.argA, args.argB);\r\n                shouldSetValues && set(_formState.touchedFields, name, touchedFields);\r\n            }\r\n            if (_proxyFormState.dirtyFields) {\r\n                _formState.dirtyFields = getDirtyFields(_defaultValues, _formValues);\r\n            }\r\n            _subjects.state.next({\r\n                isDirty: _getDirty(name, values),\r\n                dirtyFields: _formState.dirtyFields,\r\n                errors: _formState.errors,\r\n                isValid: _formState.isValid,\r\n            });\r\n        }\r\n        else {\r\n            set(_formValues, name, values);\r\n        }\r\n    };\r\n    const updateErrors = (name, error) => {\r\n        set(_formState.errors, name, error);\r\n        _subjects.state.next({\r\n            errors: _formState.errors,\r\n        });\r\n    };\r\n    const updateValidAndValue = (name, shouldSkipSetValueAs, value, ref) => {\r\n        const field = get(_fields, name);\r\n        if (field) {\r\n            const defaultValue = get(_formValues, name, isUndefined(value) ? get(_defaultValues, name) : value);\r\n            isUndefined(defaultValue) ||\r\n                (ref && ref.defaultChecked) ||\r\n                shouldSkipSetValueAs\r\n                ? set(_formValues, name, shouldSkipSetValueAs ? defaultValue : getFieldValue(field._f))\r\n                : setFieldValue(name, defaultValue);\r\n            _stateFlags.mount && _updateValid();\r\n        }\r\n    };\r\n    const updateTouchAndDirty = (name, fieldValue, isBlurEvent, shouldDirty, shouldRender) => {\r\n        let isFieldDirty = false;\r\n        const output = {\r\n            name,\r\n        };\r\n        const isPreviousFieldTouched = get(_formState.touchedFields, name);\r\n        if (_proxyFormState.isDirty) {\r\n            const isPreviousFormDirty = _formState.isDirty;\r\n            _formState.isDirty = output.isDirty = _getDirty();\r\n            isFieldDirty = isPreviousFormDirty !== output.isDirty;\r\n        }\r\n        if (_proxyFormState.dirtyFields && (!isBlurEvent || shouldDirty)) {\r\n            const isPreviousFieldDirty = get(_formState.dirtyFields, name);\r\n            const isCurrentFieldPristine = deepEqual(get(_defaultValues, name), fieldValue);\r\n            isCurrentFieldPristine\r\n                ? unset(_formState.dirtyFields, name)\r\n                : set(_formState.dirtyFields, name, true);\r\n            output.dirtyFields = _formState.dirtyFields;\r\n            isFieldDirty =\r\n                isFieldDirty ||\r\n                    isPreviousFieldDirty !== get(_formState.dirtyFields, name);\r\n        }\r\n        if (isBlurEvent && !isPreviousFieldTouched) {\r\n            set(_formState.touchedFields, name, isBlurEvent);\r\n            output.touchedFields = _formState.touchedFields;\r\n            isFieldDirty =\r\n                isFieldDirty ||\r\n                    (_proxyFormState.touchedFields &&\r\n                        isPreviousFieldTouched !== isBlurEvent);\r\n        }\r\n        isFieldDirty && shouldRender && _subjects.state.next(output);\r\n        return isFieldDirty ? output : {};\r\n    };\r\n    const shouldRenderByError = async (name, isValid, error, fieldState) => {\r\n        const previousFieldError = get(_formState.errors, name);\r\n        const shouldUpdateValid = _proxyFormState.isValid && _formState.isValid !== isValid;\r\n        if (props.delayError && error) {\r\n            delayErrorCallback = debounce(() => updateErrors(name, error));\r\n            delayErrorCallback(props.delayError);\r\n        }\r\n        else {\r\n            clearTimeout(timer);\r\n            delayErrorCallback = null;\r\n            error\r\n                ? set(_formState.errors, name, error)\r\n                : unset(_formState.errors, name);\r\n        }\r\n        if ((error ? !deepEqual(previousFieldError, error) : previousFieldError) ||\r\n            !isEmptyObject(fieldState) ||\r\n            shouldUpdateValid) {\r\n            const updatedFormState = {\r\n                ...fieldState,\r\n                ...(shouldUpdateValid ? { isValid } : {}),\r\n                errors: _formState.errors,\r\n                name,\r\n            };\r\n            _formState = {\r\n                ..._formState,\r\n                ...updatedFormState,\r\n            };\r\n            _subjects.state.next(updatedFormState);\r\n        }\r\n        validateFields[name]--;\r\n        if (_proxyFormState.isValidating &&\r\n            !Object.values(validateFields).some((v) => v)) {\r\n            _subjects.state.next({\r\n                isValidating: false,\r\n            });\r\n            validateFields = {};\r\n        }\r\n    };\r\n    const _executeSchema = async (name) => _options.resolver\r\n        ? await _options.resolver({ ..._formValues }, _options.context, getResolverOptions(name || _names.mount, _fields, _options.criteriaMode, _options.shouldUseNativeValidation))\r\n        : {};\r\n    const executeSchemaAndUpdateState = async (names) => {\r\n        const { errors } = await _executeSchema();\r\n        if (names) {\r\n            for (const name of names) {\r\n                const error = get(errors, name);\r\n                error\r\n                    ? set(_formState.errors, name, error)\r\n                    : unset(_formState.errors, name);\r\n            }\r\n        }\r\n        else {\r\n            _formState.errors = errors;\r\n        }\r\n        return errors;\r\n    };\r\n    const executeBuiltInValidation = async (fields, shouldOnlyCheckValid, context = {\r\n        valid: true,\r\n    }) => {\r\n        for (const name in fields) {\r\n            const field = fields[name];\r\n            if (field) {\r\n                const { _f, ...fieldValue } = field;\r\n                if (_f) {\r\n                    const isFieldArrayRoot = _names.array.has(_f.name);\r\n                    const fieldError = await validateField(field, get(_formValues, _f.name), shouldDisplayAllAssociatedErrors, _options.shouldUseNativeValidation, isFieldArrayRoot);\r\n                    if (fieldError[_f.name]) {\r\n                        context.valid = false;\r\n                        if (shouldOnlyCheckValid) {\r\n                            break;\r\n                        }\r\n                    }\r\n                    !shouldOnlyCheckValid &&\r\n                        (get(fieldError, _f.name)\r\n                            ? isFieldArrayRoot\r\n                                ? updateFieldArrayRootError(_formState.errors, fieldError, _f.name)\r\n                                : set(_formState.errors, _f.name, fieldError[_f.name])\r\n                            : unset(_formState.errors, _f.name));\r\n                }\r\n                fieldValue &&\r\n                    (await executeBuiltInValidation(fieldValue, shouldOnlyCheckValid, context));\r\n            }\r\n        }\r\n        return context.valid;\r\n    };\r\n    const _removeUnmounted = () => {\r\n        for (const name of _names.unMount) {\r\n            const field = get(_fields, name);\r\n            field &&\r\n                (field._f.refs\r\n                    ? field._f.refs.every((ref) => !live(ref))\r\n                    : !live(field._f.ref)) &&\r\n                unregister(name);\r\n        }\r\n        _names.unMount = new Set();\r\n    };\r\n    const _getDirty = (name, data) => (name && data && set(_formValues, name, data),\r\n        !deepEqual(getValues(), _defaultValues));\r\n    const _getWatch = (names, defaultValue, isGlobal) => {\r\n        const fieldValues = {\r\n            ...(_stateFlags.mount\r\n                ? _formValues\r\n                : isUndefined(defaultValue)\r\n                    ? _defaultValues\r\n                    : isString(names)\r\n                        ? { [names]: defaultValue }\r\n                        : defaultValue),\r\n        };\r\n        return generateWatchOutput(names, _names, fieldValues, isGlobal);\r\n    };\r\n    const _getFieldArray = (name) => compact(get(_stateFlags.mount ? _formValues : _defaultValues, name, props.shouldUnregister ? get(_defaultValues, name, []) : []));\r\n    const setFieldValue = (name, value, options = {}) => {\r\n        const field = get(_fields, name);\r\n        let fieldValue = value;\r\n        if (field) {\r\n            const fieldReference = field._f;\r\n            if (fieldReference) {\r\n                !fieldReference.disabled &&\r\n                    set(_formValues, name, getFieldValueAs(value, fieldReference));\r\n                fieldValue =\r\n                    isWeb && isHTMLElement(fieldReference.ref) && isNullOrUndefined(value)\r\n                        ? ''\r\n                        : value;\r\n                if (isMultipleSelect(fieldReference.ref)) {\r\n                    [...fieldReference.ref.options].forEach((selectRef) => (selectRef.selected = fieldValue.includes(selectRef.value)));\r\n                }\r\n                else if (fieldReference.refs) {\r\n                    if (isCheckBoxInput(fieldReference.ref)) {\r\n                        fieldReference.refs.length > 1\r\n                            ? fieldReference.refs.forEach((checkboxRef) => (!checkboxRef.defaultChecked || !checkboxRef.disabled) &&\r\n                                (checkboxRef.checked = Array.isArray(fieldValue)\r\n                                    ? !!fieldValue.find((data) => data === checkboxRef.value)\r\n                                    : fieldValue === checkboxRef.value))\r\n                            : fieldReference.refs[0] &&\r\n                                (fieldReference.refs[0].checked = !!fieldValue);\r\n                    }\r\n                    else {\r\n                        fieldReference.refs.forEach((radioRef) => (radioRef.checked = radioRef.value === fieldValue));\r\n                    }\r\n                }\r\n                else if (isFileInput(fieldReference.ref)) {\r\n                    fieldReference.ref.value = '';\r\n                }\r\n                else {\r\n                    fieldReference.ref.value = fieldValue;\r\n                    if (!fieldReference.ref.type) {\r\n                        _subjects.watch.next({\r\n                            name,\r\n                        });\r\n                    }\r\n                }\r\n            }\r\n        }\r\n        (options.shouldDirty || options.shouldTouch) &&\r\n            updateTouchAndDirty(name, fieldValue, options.shouldTouch, options.shouldDirty, true);\r\n        options.shouldValidate && trigger(name);\r\n    };\r\n    const setValues = (name, value, options) => {\r\n        for (const fieldKey in value) {\r\n            const fieldValue = value[fieldKey];\r\n            const fieldName = `${name}.${fieldKey}`;\r\n            const field = get(_fields, fieldName);\r\n            (_names.array.has(name) ||\r\n                !isPrimitive(fieldValue) ||\r\n                (field && !field._f)) &&\r\n                !isDateObject(fieldValue)\r\n                ? setValues(fieldName, fieldValue, options)\r\n                : setFieldValue(fieldName, fieldValue, options);\r\n        }\r\n    };\r\n    const setValue = (name, value, options = {}) => {\r\n        const field = get(_fields, name);\r\n        const isFieldArray = _names.array.has(name);\r\n        const cloneValue = cloneObject(value);\r\n        set(_formValues, name, cloneValue);\r\n        if (isFieldArray) {\r\n            _subjects.array.next({\r\n                name,\r\n                values: _formValues,\r\n            });\r\n            if ((_proxyFormState.isDirty || _proxyFormState.dirtyFields) &&\r\n                options.shouldDirty) {\r\n                _formState.dirtyFields = getDirtyFields(_defaultValues, _formValues);\r\n                _subjects.state.next({\r\n                    name,\r\n                    dirtyFields: _formState.dirtyFields,\r\n                    isDirty: _getDirty(name, cloneValue),\r\n                });\r\n            }\r\n        }\r\n        else {\r\n            field && !field._f && !isNullOrUndefined(cloneValue)\r\n                ? setValues(name, cloneValue, options)\r\n                : setFieldValue(name, cloneValue, options);\r\n        }\r\n        isWatched(name, _names) && _subjects.state.next({});\r\n        _subjects.watch.next({\r\n            name,\r\n        });\r\n    };\r\n    const onChange = async (event) => {\r\n        const target = event.target;\r\n        let name = target.name;\r\n        const field = get(_fields, name);\r\n        if (field) {\r\n            let error;\r\n            let isValid;\r\n            const fieldValue = target.type\r\n                ? getFieldValue(field._f)\r\n                : getEventValue(event);\r\n            const isBlurEvent = event.type === EVENTS.BLUR || event.type === EVENTS.FOCUS_OUT;\r\n            const shouldSkipValidation = (!hasValidation(field._f) &&\r\n                !_options.resolver &&\r\n                !get(_formState.errors, name) &&\r\n                !field._f.deps) ||\r\n                skipValidation(isBlurEvent, get(_formState.touchedFields, name), _formState.isSubmitted, validationModeAfterSubmit, validationModeBeforeSubmit);\r\n            const watched = isWatched(name, _names, isBlurEvent);\r\n            set(_formValues, name, fieldValue);\r\n            if (isBlurEvent) {\r\n                field._f.onBlur && field._f.onBlur(event);\r\n                delayErrorCallback && delayErrorCallback(0);\r\n            }\r\n            else if (field._f.onChange) {\r\n                field._f.onChange(event);\r\n            }\r\n            const fieldState = updateTouchAndDirty(name, fieldValue, isBlurEvent, false);\r\n            const shouldRender = !isEmptyObject(fieldState) || watched;\r\n            !isBlurEvent &&\r\n                _subjects.watch.next({\r\n                    name,\r\n                    type: event.type,\r\n                });\r\n            if (shouldSkipValidation) {\r\n                return (shouldRender &&\r\n                    _subjects.state.next({ name, ...(watched ? {} : fieldState) }));\r\n            }\r\n            !isBlurEvent && watched && _subjects.state.next({});\r\n            validateFields[name] = validateFields[name] ? +1 : 1;\r\n            _subjects.state.next({\r\n                isValidating: true,\r\n            });\r\n            if (_options.resolver) {\r\n                const { errors } = await _executeSchema([name]);\r\n                const previousErrorLookupResult = schemaErrorLookup(_formState.errors, _fields, name);\r\n                const errorLookupResult = schemaErrorLookup(errors, _fields, previousErrorLookupResult.name || name);\r\n                error = errorLookupResult.error;\r\n                name = errorLookupResult.name;\r\n                isValid = isEmptyObject(errors);\r\n            }\r\n            else {\r\n                error = (await validateField(field, get(_formValues, name), shouldDisplayAllAssociatedErrors, _options.shouldUseNativeValidation))[name];\r\n                isValid = await _updateValid(true);\r\n            }\r\n            field._f.deps &&\r\n                trigger(field._f.deps);\r\n            shouldRenderByError(name, isValid, error, fieldState);\r\n        }\r\n    };\r\n    const trigger = async (name, options = {}) => {\r\n        let isValid;\r\n        let validationResult;\r\n        const fieldNames = convertToArrayPayload(name);\r\n        _subjects.state.next({\r\n            isValidating: true,\r\n        });\r\n        if (_options.resolver) {\r\n            const errors = await executeSchemaAndUpdateState(isUndefined(name) ? name : fieldNames);\r\n            isValid = isEmptyObject(errors);\r\n            validationResult = name\r\n                ? !fieldNames.some((name) => get(errors, name))\r\n                : isValid;\r\n        }\r\n        else if (name) {\r\n            validationResult = (await Promise.all(fieldNames.map(async (fieldName) => {\r\n                const field = get(_fields, fieldName);\r\n                return await executeBuiltInValidation(field && field._f ? { [fieldName]: field } : field);\r\n            }))).every(Boolean);\r\n            !(!validationResult && !_formState.isValid) && _updateValid();\r\n        }\r\n        else {\r\n            validationResult = isValid = await executeBuiltInValidation(_fields);\r\n        }\r\n        _subjects.state.next({\r\n            ...(!isString(name) ||\r\n                (_proxyFormState.isValid && isValid !== _formState.isValid)\r\n                ? {}\r\n                : { name }),\r\n            ...(_options.resolver ? { isValid } : {}),\r\n            errors: _formState.errors,\r\n            isValidating: false,\r\n        });\r\n        options.shouldFocus &&\r\n            !validationResult &&\r\n            focusFieldBy(_fields, (key) => get(_formState.errors, key), name ? fieldNames : _names.mount);\r\n        return validationResult;\r\n    };\r\n    const getValues = (fieldNames) => {\r\n        const values = {\r\n            ..._defaultValues,\r\n            ...(_stateFlags.mount ? _formValues : {}),\r\n        };\r\n        return isUndefined(fieldNames)\r\n            ? values\r\n            : isString(fieldNames)\r\n                ? get(values, fieldNames)\r\n                : fieldNames.map((name) => get(values, name));\r\n    };\r\n    const getFieldState = (name, formState) => ({\r\n        invalid: !!get((formState || _formState).errors, name),\r\n        isDirty: !!get((formState || _formState).dirtyFields, name),\r\n        isTouched: !!get((formState || _formState).touchedFields, name),\r\n        error: get((formState || _formState).errors, name),\r\n    });\r\n    const clearErrors = (name) => {\r\n        name\r\n            ? convertToArrayPayload(name).forEach((inputName) => unset(_formState.errors, inputName))\r\n            : (_formState.errors = {});\r\n        _subjects.state.next({\r\n            errors: _formState.errors,\r\n        });\r\n    };\r\n    const setError = (name, error, options) => {\r\n        const ref = (get(_fields, name, { _f: {} })._f || {}).ref;\r\n        set(_formState.errors, name, {\r\n            ...error,\r\n            ref,\r\n        });\r\n        _subjects.state.next({\r\n            name,\r\n            errors: _formState.errors,\r\n            isValid: false,\r\n        });\r\n        options && options.shouldFocus && ref && ref.focus && ref.focus();\r\n    };\r\n    const watch = (name, defaultValue) => isFunction(name)\r\n        ? _subjects.watch.subscribe({\r\n            next: (info) => name(_getWatch(undefined, defaultValue), info),\r\n        })\r\n        : _getWatch(name, defaultValue, true);\r\n    const unregister = (name, options = {}) => {\r\n        for (const fieldName of name ? convertToArrayPayload(name) : _names.mount) {\r\n            _names.mount.delete(fieldName);\r\n            _names.array.delete(fieldName);\r\n            if (get(_fields, fieldName)) {\r\n                if (!options.keepValue) {\r\n                    unset(_fields, fieldName);\r\n                    unset(_formValues, fieldName);\r\n                }\r\n                !options.keepError && unset(_formState.errors, fieldName);\r\n                !options.keepDirty && unset(_formState.dirtyFields, fieldName);\r\n                !options.keepTouched && unset(_formState.touchedFields, fieldName);\r\n                !_options.shouldUnregister &&\r\n                    !options.keepDefaultValue &&\r\n                    unset(_defaultValues, fieldName);\r\n            }\r\n        }\r\n        _subjects.watch.next({});\r\n        _subjects.state.next({\r\n            ..._formState,\r\n            ...(!options.keepDirty ? {} : { isDirty: _getDirty() }),\r\n        });\r\n        !options.keepIsValid && _updateValid();\r\n    };\r\n    const register = (name, options = {}) => {\r\n        let field = get(_fields, name);\r\n        const disabledIsDefined = isBoolean(options.disabled);\r\n        set(_fields, name, {\r\n            ...(field || {}),\r\n            _f: {\r\n                ...(field && field._f ? field._f : { ref: { name } }),\r\n                name,\r\n                mount: true,\r\n                ...options,\r\n            },\r\n        });\r\n        _names.mount.add(name);\r\n        field\r\n            ? disabledIsDefined &&\r\n                set(_formValues, name, options.disabled\r\n                    ? undefined\r\n                    : get(_formValues, name, getFieldValue(field._f)))\r\n            : updateValidAndValue(name, true, options.value);\r\n        return {\r\n            ...(disabledIsDefined ? { disabled: options.disabled } : {}),\r\n            ...(_options.shouldUseNativeValidation\r\n                ? {\r\n                    required: !!options.required,\r\n                    min: getRuleValue(options.min),\r\n                    max: getRuleValue(options.max),\r\n                    minLength: getRuleValue(options.minLength),\r\n                    maxLength: getRuleValue(options.maxLength),\r\n                    pattern: getRuleValue(options.pattern),\r\n                }\r\n                : {}),\r\n            name,\r\n            onChange,\r\n            onBlur: onChange,\r\n            ref: (ref) => {\r\n                if (ref) {\r\n                    register(name, options);\r\n                    field = get(_fields, name);\r\n                    const fieldRef = isUndefined(ref.value)\r\n                        ? ref.querySelectorAll\r\n                            ? ref.querySelectorAll('input,select,textarea')[0] || ref\r\n                            : ref\r\n                        : ref;\r\n                    const radioOrCheckbox = isRadioOrCheckbox(fieldRef);\r\n                    const refs = field._f.refs || [];\r\n                    if (radioOrCheckbox\r\n                        ? refs.find((option) => option === fieldRef)\r\n                        : fieldRef === field._f.ref) {\r\n                        return;\r\n                    }\r\n                    set(_fields, name, {\r\n                        _f: {\r\n                            ...field._f,\r\n                            ...(radioOrCheckbox\r\n                                ? {\r\n                                    refs: [\r\n                                        ...refs.filter(live),\r\n                                        fieldRef,\r\n                                        ...(!!Array.isArray(get(_defaultValues, name))\r\n                                            ? [{}]\r\n                                            : []),\r\n                                    ],\r\n                                    ref: { type: fieldRef.type, name },\r\n                                }\r\n                                : { ref: fieldRef }),\r\n                        },\r\n                    });\r\n                    updateValidAndValue(name, false, undefined, fieldRef);\r\n                }\r\n                else {\r\n                    field = get(_fields, name, {});\r\n                    if (field._f) {\r\n                        field._f.mount = false;\r\n                    }\r\n                    (_options.shouldUnregister || options.shouldUnregister) &&\r\n                        !(isNameInFieldArray(_names.array, name) && _stateFlags.action) &&\r\n                        _names.unMount.add(name);\r\n                }\r\n            },\r\n        };\r\n    };\r\n    const handleSubmit = (onValid, onInvalid) => async (e) => {\r\n        if (e) {\r\n            e.preventDefault && e.preventDefault();\r\n            e.persist && e.persist();\r\n        }\r\n        let hasNoPromiseError = true;\r\n        let fieldValues = cloneObject(_formValues);\r\n        _subjects.state.next({\r\n            isSubmitting: true,\r\n        });\r\n        try {\r\n            if (_options.resolver) {\r\n                const { errors, values } = await _executeSchema();\r\n                _formState.errors = errors;\r\n                fieldValues = values;\r\n            }\r\n            else {\r\n                await executeBuiltInValidation(_fields);\r\n            }\r\n            if (isEmptyObject(_formState.errors)) {\r\n                _subjects.state.next({\r\n                    errors: {},\r\n                    isSubmitting: true,\r\n                });\r\n                await onValid(fieldValues, e);\r\n            }\r\n            else {\r\n                if (onInvalid) {\r\n                    await onInvalid({ ..._formState.errors }, e);\r\n                }\r\n                _options.shouldFocusError &&\r\n                    focusFieldBy(_fields, (key) => get(_formState.errors, key), _names.mount);\r\n            }\r\n        }\r\n        catch (err) {\r\n            hasNoPromiseError = false;\r\n            throw err;\r\n        }\r\n        finally {\r\n            _formState.isSubmitted = true;\r\n            _subjects.state.next({\r\n                isSubmitted: true,\r\n                isSubmitting: false,\r\n                isSubmitSuccessful: isEmptyObject(_formState.errors) && hasNoPromiseError,\r\n                submitCount: _formState.submitCount + 1,\r\n                errors: _formState.errors,\r\n            });\r\n        }\r\n    };\r\n    const resetField = (name, options = {}) => {\r\n        if (get(_fields, name)) {\r\n            if (isUndefined(options.defaultValue)) {\r\n                setValue(name, get(_defaultValues, name));\r\n            }\r\n            else {\r\n                setValue(name, options.defaultValue);\r\n                set(_defaultValues, name, options.defaultValue);\r\n            }\r\n            if (!options.keepTouched) {\r\n                unset(_formState.touchedFields, name);\r\n            }\r\n            if (!options.keepDirty) {\r\n                unset(_formState.dirtyFields, name);\r\n                _formState.isDirty = options.defaultValue\r\n                    ? _getDirty(name, get(_defaultValues, name))\r\n                    : _getDirty();\r\n            }\r\n            if (!options.keepError) {\r\n                unset(_formState.errors, name);\r\n                _proxyFormState.isValid && _updateValid();\r\n            }\r\n            _subjects.state.next({ ..._formState });\r\n        }\r\n    };\r\n    const _reset = (formValues, keepStateOptions = {}) => {\r\n        const updatedValues = formValues || _defaultValues;\r\n        const cloneUpdatedValues = cloneObject(updatedValues);\r\n        const values = formValues && !isEmptyObject(formValues)\r\n            ? cloneUpdatedValues\r\n            : _defaultValues;\r\n        if (!keepStateOptions.keepDefaultValues) {\r\n            _defaultValues = updatedValues;\r\n        }\r\n        if (!keepStateOptions.keepValues) {\r\n            if (keepStateOptions.keepDirtyValues) {\r\n                for (const fieldName of _names.mount) {\r\n                    get(_formState.dirtyFields, fieldName)\r\n                        ? set(values, fieldName, get(_formValues, fieldName))\r\n                        : setValue(fieldName, get(values, fieldName));\r\n                }\r\n            }\r\n            else {\r\n                if (isWeb && isUndefined(formValues)) {\r\n                    for (const name of _names.mount) {\r\n                        const field = get(_fields, name);\r\n                        if (field && field._f) {\r\n                            const fieldReference = Array.isArray(field._f.refs)\r\n                                ? field._f.refs[0]\r\n                                : field._f.ref;\r\n                            try {\r\n                                if (isHTMLElement(fieldReference)) {\r\n                                    fieldReference.closest('form').reset();\r\n                                    break;\r\n                                }\r\n                            }\r\n                            catch (_a) { }\r\n                        }\r\n                    }\r\n                }\r\n                _fields = {};\r\n            }\r\n            _formValues = props.shouldUnregister\r\n                ? keepStateOptions.keepDefaultValues\r\n                    ? cloneObject(_defaultValues)\r\n                    : {}\r\n                : cloneUpdatedValues;\r\n            _subjects.array.next({\r\n                values,\r\n            });\r\n            _subjects.watch.next({\r\n                values,\r\n            });\r\n        }\r\n        _names = {\r\n            mount: new Set(),\r\n            unMount: new Set(),\r\n            array: new Set(),\r\n            watch: new Set(),\r\n            watchAll: false,\r\n            focus: '',\r\n        };\r\n        _stateFlags.mount =\r\n            !_proxyFormState.isValid || !!keepStateOptions.keepIsValid;\r\n        _stateFlags.watch = !!props.shouldUnregister;\r\n        _subjects.state.next({\r\n            submitCount: keepStateOptions.keepSubmitCount\r\n                ? _formState.submitCount\r\n                : 0,\r\n            isDirty: keepStateOptions.keepDirty || keepStateOptions.keepDirtyValues\r\n                ? _formState.isDirty\r\n                : !!(keepStateOptions.keepDefaultValues &&\r\n                    !deepEqual(formValues, _defaultValues)),\r\n            isSubmitted: keepStateOptions.keepIsSubmitted\r\n                ? _formState.isSubmitted\r\n                : false,\r\n            dirtyFields: keepStateOptions.keepDirty || keepStateOptions.keepDirtyValues\r\n                ? _formState.dirtyFields\r\n                : keepStateOptions.keepDefaultValues && formValues\r\n                    ? getDirtyFields(_defaultValues, formValues)\r\n                    : {},\r\n            touchedFields: keepStateOptions.keepTouched\r\n                ? _formState.touchedFields\r\n                : {},\r\n            errors: keepStateOptions.keepErrors\r\n                ? _formState.errors\r\n                : {},\r\n            isSubmitting: false,\r\n            isSubmitSuccessful: false,\r\n        });\r\n    };\r\n    const reset = (formValues, keepStateOptions) => _reset(isFunction(formValues)\r\n        ? formValues(_formValues)\r\n        : formValues, keepStateOptions);\r\n    const setFocus = (name, options = {}) => {\r\n        const field = get(_fields, name);\r\n        const fieldReference = field && field._f;\r\n        if (fieldReference) {\r\n            const fieldRef = fieldReference.refs\r\n                ? fieldReference.refs[0]\r\n                : fieldReference.ref;\r\n            fieldRef.focus();\r\n            options.shouldSelect && fieldRef.select();\r\n        }\r\n    };\r\n    return {\r\n        control: {\r\n            register,\r\n            unregister,\r\n            getFieldState,\r\n            _executeSchema,\r\n            _getWatch,\r\n            _getDirty,\r\n            _updateValid,\r\n            _removeUnmounted,\r\n            _updateFieldArray,\r\n            _getFieldArray,\r\n            _subjects,\r\n            _proxyFormState,\r\n            get _fields() {\r\n                return _fields;\r\n            },\r\n            get _formValues() {\r\n                return _formValues;\r\n            },\r\n            get _stateFlags() {\r\n                return _stateFlags;\r\n            },\r\n            set _stateFlags(value) {\r\n                _stateFlags = value;\r\n            },\r\n            get _defaultValues() {\r\n                return _defaultValues;\r\n            },\r\n            get _names() {\r\n                return _names;\r\n            },\r\n            set _names(value) {\r\n                _names = value;\r\n            },\r\n            get _formState() {\r\n                return _formState;\r\n            },\r\n            set _formState(value) {\r\n                _formState = value;\r\n            },\r\n            get _options() {\r\n                return _options;\r\n            },\r\n            set _options(value) {\r\n                _options = {\r\n                    ..._options,\r\n                    ...value,\r\n                };\r\n            },\r\n        },\r\n        trigger,\r\n        register,\r\n        handleSubmit,\r\n        watch,\r\n        setValue,\r\n        getValues,\r\n        reset,\r\n        resetField,\r\n        clearErrors,\r\n        unregister,\r\n        setError,\r\n        setFocus,\r\n        getFieldState,\r\n    };\r\n}\n\n/**\r\n * Custom hook to manage the entire form.\r\n *\r\n * @remarks\r\n * [API](https://react-hook-form.com/api/useform) • [Demo](https://codesandbox.io/s/react-hook-form-get-started-ts-5ksmm) • [Video](https://www.youtube.com/watch?v=RkXv4AXXC_4)\r\n *\r\n * @param props - form configuration and validation parameters.\r\n *\r\n * @returns methods - individual functions to manage the form state. {@link UseFormReturn}\r\n *\r\n * @example\r\n * ```tsx\r\n * function App() {\r\n *   const { register, handleSubmit, watch, formState: { errors } } = useForm();\r\n *   const onSubmit = data => console.log(data);\r\n *\r\n *   console.log(watch(\"example\"));\r\n *\r\n *   return (\r\n *     <form onSubmit={handleSubmit(onSubmit)}>\r\n *       <input defaultValue=\"test\" {...register(\"example\")} />\r\n *       <input {...register(\"exampleRequired\", { required: true })} />\r\n *       {errors.exampleRequired && <span>This field is required</span>}\r\n *       <input type=\"submit\" />\r\n *     </form>\r\n *   );\r\n * }\r\n * ```\r\n */\r\nfunction useForm(props = {}) {\r\n    const _formControl = React.useRef();\r\n    const [formState, updateFormState] = React.useState({\r\n        isDirty: false,\r\n        isValidating: false,\r\n        dirtyFields: {},\r\n        isSubmitted: false,\r\n        submitCount: 0,\r\n        touchedFields: {},\r\n        isSubmitting: false,\r\n        isSubmitSuccessful: false,\r\n        isValid: false,\r\n        errors: {},\r\n    });\r\n    if (_formControl.current) {\r\n        _formControl.current.control._options = props;\r\n    }\r\n    else {\r\n        _formControl.current = {\r\n            ...createFormControl(props),\r\n            formState,\r\n        };\r\n    }\r\n    const control = _formControl.current.control;\r\n    const callback = React.useCallback((value) => {\r\n        if (shouldRenderFormState(value, control._proxyFormState, true)) {\r\n            control._formState = {\r\n                ...control._formState,\r\n                ...value,\r\n            };\r\n            updateFormState({ ...control._formState });\r\n        }\r\n    }, [control]);\r\n    useSubscribe({\r\n        subject: control._subjects.state,\r\n        callback,\r\n    });\r\n    React.useEffect(() => {\r\n        if (!control._stateFlags.mount) {\r\n            control._proxyFormState.isValid && control._updateValid();\r\n            control._stateFlags.mount = true;\r\n        }\r\n        if (control._stateFlags.watch) {\r\n            control._stateFlags.watch = false;\r\n            control._subjects.state.next({});\r\n        }\r\n        control._removeUnmounted();\r\n    });\r\n    _formControl.current.formState = getProxyFormState(formState, control._proxyFormState);\r\n    return _formControl.current;\r\n}\n\nexport { Controller, FormProvider, appendErrors, get, set, useController, useFieldArray, useForm, useFormContext, useFormState, useWatch };\n//# sourceMappingURL=index.esm.mjs.map\n","import {BaseSlider} from './base-slider';\nimport {useSlider, UseSliderProps} from './use-slider';\nimport React, {Ref} from 'react';\nimport {SliderThumb} from './slider-thumb';\nimport {useController} from 'react-hook-form';\nimport {mergeProps} from '@react-aria/utils';\n\ninterface SliderProps extends UseSliderProps<number> {\n  inputRef?: Ref<HTMLInputElement>;\n  onBlur?: React.FocusEventHandler;\n}\nexport function Slider({inputRef, onBlur, ...props}: SliderProps) {\n  const {onChange, onChangeEnd, value, defaultValue, ...otherProps} = props;\n\n  const baseProps: UseSliderProps = {\n    ...otherProps,\n    // Normalize `value: number[]` to `value: number`\n    value: value != null ? [value] : undefined,\n    defaultValue: defaultValue != null ? [defaultValue] : undefined,\n    onChange: (v: number[]): void => {\n      onChange?.(v[0]);\n    },\n    onChangeEnd: (v: number[]): void => {\n      onChangeEnd?.(v[0]);\n    },\n  };\n\n  const slider = useSlider(baseProps);\n\n  return (\n    <BaseSlider {...baseProps} slider={slider}>\n      <SliderThumb\n        index={0}\n        slider={slider}\n        inputRef={inputRef}\n        onBlur={onBlur}\n      />\n    </BaseSlider>\n  );\n}\n\nexport interface FormSliderProps extends SliderProps {\n  name: string;\n}\nexport function FormSlider({name, ...props}: FormSliderProps) {\n  const {\n    field: {onChange, onBlur, value = '', ref},\n  } = useController({\n    name,\n  });\n\n  const formProps: SliderProps = {\n    onChange,\n    onBlur,\n    value: value || '', // avoid issues with \"null\" value when setting form defaults from backend model\n  };\n\n  return <Slider inputRef={ref} {...mergeProps(formProps, props)} />;\n}\n","import React from 'react';\nimport clsx from 'clsx';\n\ntype AdornmentProps = {\n  children: React.ReactNode;\n  direction: 'start' | 'end';\n  className?: string;\n};\n\nexport function Adornment({children, direction, className}: AdornmentProps) {\n  const dirClass = direction === 'start' ? 'left-0' : 'right-0';\n  if (!children) return null;\n  return (\n    <div\n      className={clsx(\n        'absolute h-full min-w-42 flex items-center justify-center top-0 text-muted z-10',\n        dirClass,\n        className\n      )}\n    >\n      {children}\n    </div>\n  );\n}\n","import React, {ComponentPropsWithoutRef, ReactElement, ReactNode} from 'react';\nimport {Adornment} from './adornment';\nimport {InputFieldStyle} from './get-input-field-class-names';\nimport {BaseFieldProps} from './base-field-props';\n\nexport interface FieldProps extends BaseFieldProps {\n  children: ReactNode;\n  wrapperProps?: ComponentPropsWithoutRef<'div'>;\n  labelProps?: ComponentPropsWithoutRef<'label' | 'span'>;\n  descriptionProps?: ComponentPropsWithoutRef<'div'>;\n  errorMessageProps?: ComponentPropsWithoutRef<'div'>;\n  fieldClassNames: InputFieldStyle;\n}\nexport const Field = React.forwardRef<HTMLDivElement, FieldProps>(\n  (props, ref) => {\n    const {\n      children,\n      // Not every component that uses <Field> supports help text.\n      description,\n      errorMessage,\n      descriptionProps = {},\n      errorMessageProps = {},\n      startAdornment,\n      endAdornment,\n      startAppend,\n      endAppend,\n      fieldClassNames,\n      disabled,\n      wrapperProps,\n    } = props;\n\n    return (\n      <div className={fieldClassNames.wrapper} ref={ref} {...wrapperProps}>\n        <Label {...props} />\n        <div className={fieldClassNames.inputWrapper}>\n          <Adornment direction=\"start\" className={fieldClassNames.adornment}>\n            {startAdornment}\n          </Adornment>\n          {startAppend && (\n            <Append style={fieldClassNames.append} disabled={disabled}>\n              {startAppend}\n            </Append>\n          )}\n          {children}\n          {endAppend && (\n            <Append style={fieldClassNames.append} disabled={disabled}>\n              {endAppend}\n            </Append>\n          )}\n          <Adornment direction=\"end\" className={fieldClassNames.adornment}>\n            {endAdornment}\n          </Adornment>\n        </div>\n        {description && !errorMessage && (\n          <div className={fieldClassNames.description} {...descriptionProps}>\n            {description}\n          </div>\n        )}\n        {errorMessage && (\n          <div className={fieldClassNames.error} {...errorMessageProps}>\n            {errorMessage}\n          </div>\n        )}\n      </div>\n    );\n  }\n);\n\nfunction Label({\n  labelElementType,\n  fieldClassNames,\n  labelProps,\n  label,\n  labelSuffix,\n  required,\n}: Omit<FieldProps, 'children'>) {\n  if (!label) {\n    return null;\n  }\n  const ElementType = labelElementType || 'label';\n  const labelNode = (\n    <ElementType className={fieldClassNames.label} {...labelProps}>\n      {label}\n      {required && <span className=\"text-danger\"> *</span>}\n    </ElementType>\n  );\n\n  if (labelSuffix) {\n    return (\n      <div className=\"flex items-center gap-14 w-full\">\n        {labelNode}\n        <div className=\"ml-auto mb-4 text-muted text-xs\">{labelSuffix}</div>\n      </div>\n    );\n  }\n\n  return labelNode;\n}\n\ninterface AppendProps {\n  children: ReactElement;\n  style: InputFieldStyle['append'];\n  disabled?: boolean;\n}\nfunction Append({children, style, disabled}: AppendProps) {\n  return React.cloneElement(children, {\n    ...children.props,\n    disabled: children.props.disabled || disabled,\n    ...style,\n  });\n}\n","import {RefObject, useEffect, useRef} from 'react';\n\nexport interface AutoFocusProps {\n  autoFocus?: boolean;\n  autoSelectText?: boolean;\n  disabled?: boolean;\n}\nexport function useAutoFocus(\n  {autoFocus, autoSelectText}: AutoFocusProps,\n  ref: RefObject<HTMLElement>\n) {\n  const autoFocusRef = useRef(autoFocus);\n\n  useEffect(() => {\n    if (autoFocusRef.current && ref.current) {\n      ref.current?.focus();\n      if (autoSelectText && ref.current.nodeName.toLowerCase() === 'input') {\n        requestAnimationFrame(() => {\n          (ref.current as HTMLInputElement).select();\n        });\n      }\n    }\n    autoFocusRef.current = false;\n  }, [ref, autoSelectText]);\n}\n","import {HTMLAttributes, HTMLProps, RefObject, useId} from 'react';\nimport {BaseFieldPropsWithDom} from './base-field-props';\nimport {useAutoFocus} from '../../focus/use-auto-focus';\nimport type {FieldProps} from './field';\n\ninterface UseFieldReturn<T> {\n  fieldProps: Omit<FieldProps, 'fieldClassNames' | 'children'>;\n  inputProps: HTMLAttributes<T>;\n}\n\ninterface Props<T> extends BaseFieldPropsWithDom<T> {\n  focusRef: RefObject<HTMLElement>;\n}\nexport function useField<T>(props: Props<T>): UseFieldReturn<T> {\n  const {\n    focusRef,\n    labelElementType = 'label',\n    label,\n    labelSuffix,\n    autoFocus,\n    autoSelectText,\n    labelPosition,\n    size,\n    errorMessage,\n    description,\n    flexibleHeight,\n    startAdornment,\n    endAdornment,\n    startAppend,\n    endAppend,\n    className,\n    inputClassName,\n    inputWrapperClassName,\n    unstyled,\n    background,\n    invalid,\n    disabled,\n    id,\n    ...inputDomProps\n  } = props;\n\n  useAutoFocus(props, focusRef);\n\n  const defaultId = useId();\n  const inputId = id || defaultId;\n  const labelId = `${inputId}-label`;\n  const descriptionId = `${inputId}-description`;\n  const errorId = `${inputId}-error`;\n\n  const labelProps = {\n    id: labelId,\n    htmlFor: labelElementType === 'label' ? inputId : undefined,\n  };\n  const descriptionProps = {\n    id: descriptionId,\n  };\n  const errorMessageProps = {\n    id: errorId,\n  };\n\n  const ariaLabel =\n    !props.label && !props['aria-label'] && props.placeholder\n      ? props.placeholder\n      : props['aria-label'];\n\n  const inputProps: HTMLProps<T> = {\n    'aria-label': ariaLabel,\n    'aria-invalid': invalid || undefined,\n    id: inputId,\n    disabled,\n    ...inputDomProps,\n  };\n\n  const labelledBy = [];\n  if (label) {\n    labelledBy.push(labelProps.id);\n  }\n  if (inputProps['aria-labelledby']) {\n    labelledBy.push(inputProps['aria-labelledby']);\n  }\n  inputProps['aria-labelledby'] = labelledBy.length\n    ? labelledBy.join(' ')\n    : undefined;\n\n  const describedBy = [];\n  if (description) {\n    describedBy.push(descriptionProps.id);\n  }\n  if (errorMessage) {\n    describedBy.push(errorMessageProps.id);\n  }\n  if (inputProps['aria-describedby']) {\n    describedBy.push(inputProps['aria-describedby']);\n  }\n  inputProps['aria-describedby'] = describedBy.length\n    ? describedBy.join(' ')\n    : undefined;\n\n  return {\n    fieldProps: {\n      errorMessageProps,\n      descriptionProps,\n      labelProps,\n      disabled,\n      label,\n      labelSuffix,\n      autoFocus,\n      autoSelectText,\n      labelPosition,\n      size,\n      errorMessage,\n      description,\n      flexibleHeight,\n      startAdornment,\n      endAdornment,\n      startAppend,\n      endAppend,\n      className,\n      inputClassName,\n      inputWrapperClassName,\n      unstyled,\n      background,\n      invalid,\n    },\n    inputProps,\n  };\n}\n","import React, {RefObject} from 'react';\nimport clsx from 'clsx';\nimport {useController} from 'react-hook-form';\nimport {mergeProps} from '@react-aria/utils';\nimport {getInputFieldClassNames} from '../input-field/get-input-field-class-names';\nimport {KeyboardArrowDownIcon} from '../../../icons/material/KeyboardArrowDown';\nimport {Field} from '../input-field/field';\nimport {BaseFieldPropsWithDom} from '../input-field/base-field-props';\nimport {Adornment} from '../input-field/adornment';\nimport {useListbox} from '../listbox/use-listbox';\nimport {useField} from '../input-field/use-field';\nimport {Item} from '../listbox/item';\nimport {Section} from '../listbox/section';\nimport {Listbox} from '../listbox/listbox';\nimport {Trans} from '../../../i18n/trans';\nimport {useListboxKeyboardNavigation} from '../listbox/use-listbox-keyboard-navigation';\nimport {useTypeSelect} from '../listbox/use-type-select';\nimport {ListBoxChildren, ListboxProps} from '../listbox/types';\nimport {useIsMobileMediaQuery} from '../../../utils/hooks/is-mobile-media-query';\n\ntype SelectProps = Omit<BaseFieldPropsWithDom<HTMLButtonElement>, 'value'> &\n  ListboxProps &\n  ListBoxChildren<string | number> & {\n    hideCaret?: boolean;\n    selectionMode: 'single';\n    minWidth?: string;\n  };\nexport const Select = React.forwardRef<HTMLButtonElement, SelectProps>(\n  (props, ref) => {\n    const {\n      hideCaret,\n      placeholder = <Trans message=\"Select an option...\" />,\n      selectedValue,\n      onItemSelected,\n      onOpenChange,\n      onInputValueChange,\n      onSelectionChange,\n      selectionMode,\n      minWidth = 'min-w-128',\n      children,\n      ...inputFieldProps\n    } = props;\n\n    const isMobile = useIsMobileMediaQuery();\n    const listbox = useListbox(\n      {\n        ...props,\n        floatingWidth: isMobile ? 'auto' : 'matchTrigger',\n        selectionMode: 'single',\n        role: 'listbox',\n      },\n      ref\n    );\n    const {\n      state: {selectedValues, isOpen, setIsOpen, activeIndex, setSelectedIndex},\n      focusItem,\n      listboxId,\n      reference,\n      refs,\n      listContent,\n    } = listbox;\n\n    const {fieldProps, inputProps} = useField({\n      ...inputFieldProps,\n      focusRef: refs.reference as RefObject<HTMLButtonElement>,\n    });\n\n    const selectedOption = listbox.collection.get(selectedValues[0]);\n    const content = selectedOption ? (\n      <span className=\"flex items-center gap-10\">\n        {selectedOption.element.props.startIcon}\n        {selectedOption.element.props.children}\n      </span>\n    ) : (\n      <span className=\"italic\">{placeholder}</span>\n    );\n\n    const fieldClassNames = getInputFieldClassNames({\n      ...props,\n      endAdornment: true,\n    });\n\n    const {handleTriggerKeyDown, handleListboxKeyboardNavigation} =\n      useListboxKeyboardNavigation(listbox);\n\n    const {findMatchingItem} = useTypeSelect();\n\n    // focus matching item when user types, if dropdown is open\n    const handleListboxTypeSelect = (e: React.KeyboardEvent) => {\n      if (!isOpen) return;\n      const i = findMatchingItem(e, listContent, activeIndex);\n      if (i != null) {\n        focusItem('increment', i);\n      }\n    };\n\n    // select matching item when user types, if dropdown is closed\n    const handleTriggerTypeSelect = (e: React.KeyboardEvent) => {\n      if (isOpen) return undefined;\n      const i = findMatchingItem(e, listContent, activeIndex);\n      if (i != null) {\n        setSelectedIndex(i);\n      }\n    };\n\n    return (\n      <Listbox\n        listbox={listbox}\n        onKeyDownCapture={handleListboxTypeSelect}\n        onKeyDown={handleListboxKeyboardNavigation}\n      >\n        <Field fieldClassNames={fieldClassNames} {...fieldProps}>\n          <button\n            {...inputProps}\n            type=\"button\"\n            aria-expanded={isOpen ? 'true' : 'false'}\n            aria-haspopup=\"listbox\"\n            aria-controls={isOpen ? listboxId : undefined}\n            ref={reference}\n            onKeyDown={handleTriggerKeyDown}\n            onKeyDownCapture={handleTriggerTypeSelect}\n            disabled={inputFieldProps.disabled}\n            onClick={() => {\n              setIsOpen(!isOpen);\n            }}\n            className={clsx(\n              fieldClassNames.input,\n              !fieldProps.unstyled && minWidth\n            )}\n          >\n            {content}\n            {!hideCaret && (\n              <Adornment direction=\"end\">\n                <KeyboardArrowDownIcon className={fieldClassNames.adornment} />\n              </Adornment>\n            )}\n          </button>\n        </Field>\n      </Listbox>\n    );\n  }\n);\n\ntype FormSelectProps = SelectProps & {\n  name: string;\n};\nexport function FormSelect({children, ...props}: FormSelectProps) {\n  const {\n    field: {onChange, onBlur, value = null, ref},\n    fieldState: {invalid, error},\n  } = useController({\n    name: props.name,\n  });\n\n  const formProps: Partial<SelectProps> = {\n    onSelectionChange: onChange,\n    onBlur,\n    selectedValue: value,\n    invalid,\n    errorMessage: error?.message,\n  };\n\n  return (\n    <Select ref={ref} {...mergeProps(formProps, props)}>\n      {children}\n    </Select>\n  );\n}\n\nexport {Item as Option};\nexport {Section as OptionGroup};\n","import {useStore} from '../../../state/store';\nimport {ToolControlsOverlayWrapper} from '../../../ui/navbar/tool-controls-overlay-wrapper';\nimport {ColorPickerButton} from '../../../ui/color-picker-button';\nimport {FabricFilter} from '../filter-tool';\nimport {filterOptionMessages} from '../filter-list';\nimport {state, tools} from '../../../state/utils';\nimport {Slider} from '../../../common/ui/forms/slider/slider';\nimport {Trans} from '../../../common/i18n/trans';\nimport {Select} from '../../../common/ui/forms/select/select';\nimport {Item} from '../../../common/ui/forms/listbox/item';\n\nexport function FilterControls() {\n  const selectedFilter = useStore(s => s.filter.selected);\n  if (!selectedFilter) return null;\n  const options = tools().filter.getByName(selectedFilter).options;\n\n  const applyValue = (optionName: string, value: string | number) => {\n    tools().filter?.applyValue(selectedFilter, optionName, value);\n    state().setDirty(true);\n  };\n\n  const activeFilters = tools().canvas.getMainImage().filters as FabricFilter[];\n  const i = tools().filter.findFilterIndex(selectedFilter, activeFilters);\n  const fabricFilter = activeFilters?.[i];\n\n  if (options) {\n    const controls = Object.entries(options).map(([optionName, config]) => {\n      let component;\n      const value = fabricFilter ? fabricFilter[optionName] : config.current;\n      if (config.type === 'slider') {\n        component = (\n          <Slider\n            label={<Trans {...filterOptionMessages[optionName]} />}\n            minValue={config.min}\n            maxValue={config.max}\n            step={config.step}\n            defaultValue={value}\n            formatOptions={{style: 'percent'}}\n            size=\"sm\"\n            onChange={newValue => {\n              applyValue(optionName, newValue);\n            }}\n          />\n        );\n      } else if (config.type === 'colorPicker') {\n        component = (\n          <ColorPickerButton\n            label={<Trans {...filterOptionMessages[optionName]} />}\n            size=\"sm\"\n            className=\"w-full\"\n            value={value}\n            onChange={newValue => {\n              applyValue(optionName, newValue);\n            }}\n          />\n        );\n      } else if (config.type === 'select') {\n        component = (\n          <Select\n            selectionMode=\"single\"\n            size=\"sm\"\n            label={<Trans {...filterOptionMessages[optionName]} />}\n            defaultValue={value}\n            onSelectionChange={newValue => {\n              applyValue(optionName, newValue);\n            }}\n          >\n            {config.available.map(item => (\n              <Item key={item.key} value={item.key}>\n                <span className=\"capitalize\">{item.key}</span>\n              </Item>\n            ))}\n          </Select>\n        );\n      }\n\n      return (\n        <div className=\"pb-10\" key={optionName}>\n          {component}\n        </div>\n      );\n    });\n    return (\n      <ToolControlsOverlayWrapper>\n        <div className=\"max-w-240 pt-10 mx-auto\">{controls}</div>\n      </ToolControlsOverlayWrapper>\n    );\n  }\n\n  return null;\n}\n","import {useStore} from '../../../state/store';\nimport {ColorPickerButton} from '../../../ui/color-picker-button';\nimport {ToolControlsOverlayWrapper} from '../../../ui/navbar/tool-controls-overlay-wrapper';\nimport {tools} from '../../../state/utils';\nimport {Slider} from '../../../common/ui/forms/slider/slider';\nimport {Trans} from '../../../common/i18n/trans';\nimport {useCallback} from 'react';\n\nexport function ActiveFrameControls() {\n  const activeFrame = useStore(s => s.frame.active);\n\n  const showColorPicker = activeFrame?.mode === 'basic';\n\n  const getValueLabel = useCallback((value: number) => {\n    return `${value}%`;\n  }, []);\n\n  return (\n    <ToolControlsOverlayWrapper className=\"pb-18 pt-6\">\n      <div className=\"max-w-288 m-auto\">\n        {showColorPicker && (\n          <ColorPickerButton\n            className=\"w-full mb-20\"\n            size=\"sm\"\n            label={<Trans message=\"Color\" />}\n            value={tools().frame.builder.defaultColor}\n            onChange={newColor => {\n              tools().frame.active.changeColor(newColor);\n            }}\n          />\n        )}\n        <Slider\n          size=\"sm\"\n          label={<Trans message=\"Size\" />}\n          step={1}\n          minValue={tools().frame.active.getMinSize()}\n          maxValue={tools().frame.active.getMaxSize()}\n          defaultValue={tools().frame.active.currentSizeInPercent}\n          getValueLabel={getValueLabel}\n          onChange={value => {\n            tools().frame.resize(value);\n          }}\n        />\n      </div>\n    </ToolControlsOverlayWrapper>\n  );\n}\n","import React, {RefObject} from 'react';\n\ninterface TabsContext {\n  selectedTab: number;\n  setSelectedTab: (newTab: number) => void;\n  tabsRef: RefObject<HTMLButtonElement[]>;\n  size: 'sm' | 'md';\n  isLazy?: boolean;\n  id: string;\n}\n\nexport const TabContext = React.createContext<TabsContext>(null!);\n","import React, {useContext, useState} from 'react';\nimport {useLayoutEffect} from '@react-aria/utils';\nimport clsx from 'clsx';\nimport {TabContext} from './tabs-context';\n\ninterface TabLineStyle {\n  width?: string;\n  transform?: string;\n  className?: string;\n}\n\nexport function TabLine() {\n  const {tabsRef, selectedTab} = useContext(TabContext);\n  const [style, setStyle] = useState<TabLineStyle>({\n    width: undefined,\n    transform: undefined,\n    className: undefined,\n  });\n\n  useLayoutEffect(() => {\n    if (selectedTab != null && tabsRef.current) {\n      const el = tabsRef.current[selectedTab];\n      setStyle(prevState => {\n        return {\n          width: `${el.offsetWidth}px`,\n          transform: `translateX(${el.offsetLeft}px)`,\n          // disable initial transition for tabline\n          className: prevState.width === undefined ? '' : 'transition-all',\n        };\n      });\n    }\n  }, [setStyle, selectedTab, tabsRef]);\n\n  return (\n    <div\n      className={clsx(\n        'absolute bottom-0 left-0 h-2 bg-primary',\n        style.className\n      )}\n      role=\"presentation\"\n      style={{width: style.width, transform: style.transform}}\n    />\n  );\n}\n","import React, {Children, cloneElement, isValidElement, ReactNode} from 'react';\nimport clsx from 'clsx';\nimport {FocusScope} from '@react-aria/focus';\nimport {TabProps} from './tab';\nimport {TabLine} from './tab-line';\n\nexport interface TabListProps {\n  children: ReactNode;\n  center?: boolean;\n}\nexport function TabList({children, center}: TabListProps) {\n  const childrenArray = Children.toArray(children);\n\n  return (\n    <FocusScope>\n      <div\n        className=\"flex relative max-w-full overflow-auto border-b\"\n        role=\"tablist\"\n        aria-orientation=\"horizontal\"\n      >\n        {childrenArray.map((child, index) => {\n          if (isValidElement<TabProps>(child)) {\n            return cloneElement<TabProps>(child, {\n              index,\n              className: clsx(\n                child.props.className,\n                center && index === 0 && 'ml-auto',\n                center && index === childrenArray.length - 1 && 'mr-auto'\n              ),\n            });\n          }\n          return null;\n        })}\n        <TabLine />\n      </div>\n    </FocusScope>\n  );\n}\n","import React, {ReactElement, useId, useMemo, useRef} from 'react';\nimport clsx from 'clsx';\nimport {useControlledState} from '@react-stately/utils';\nimport {TabContext} from './tabs-context';\nimport {TabListProps} from './tab-list';\nimport {TabPanelsProps} from './tab-panels';\n\nexport interface TabsProps {\n  children: [ReactElement<TabListProps>, ReactElement<TabPanelsProps>];\n  size?: 'sm' | 'md';\n  className?: string;\n  selectedTab?: number;\n  defaultSelectedTab?: number;\n  onTabChange?: (newTab: number) => void;\n  isLazy?: boolean;\n}\n\nexport function Tabs(props: TabsProps) {\n  const {size = 'md', children, className, isLazy} = props;\n\n  const tabsRef = useRef<HTMLButtonElement[]>([]);\n  const id = useId();\n\n  const [selectedTab, setSelectedTab] = useControlledState(\n    props.selectedTab,\n    props.defaultSelectedTab || 0,\n    props.onTabChange\n  );\n\n  const ContextValue = useMemo(() => {\n    return {\n      selectedTab,\n      setSelectedTab,\n      tabsRef,\n      size,\n      isLazy,\n      id,\n    };\n  }, [selectedTab, id, isLazy, setSelectedTab, size]);\n\n  return (\n    <TabContext.Provider value={ContextValue}>\n      <div className={clsx(className, 'max-w-full overflow-hidden')}>\n        {children}\n      </div>\n    </TabContext.Provider>\n  );\n}\n","import {createSvgIcon} from '../create-svg-icon';\n\nexport const FormatUnderlinedIcon = createSvgIcon(\n  <path d=\"M12 17c3.31 0 6-2.69 6-6V3h-2.5v8c0 1.93-1.57 3.5-3.5 3.5S8.5 12.93 8.5 11V3H6v8c0 3.31 2.69 6 6 6zm-7 2v2h14v-2H5z\" />\n, 'FormatUnderlinedOutlined');\n","import {createSvgIcon} from '../create-svg-icon';\n\nexport const FormatStrikethroughIcon = createSvgIcon(\n  <path d=\"M10 19h4v-3h-4v3zM5 4v3h5v3h4V7h5V4H5zM3 14h18v-2H3v2z\" />\n, 'FormatStrikethroughOutlined');\n","import {createSvgIcon} from '../create-svg-icon';\n\nexport const FormatItalicIcon = createSvgIcon(\n  <path d=\"M10 4v3h2.21l-3.42 8H6v3h8v-3h-2.21l3.42-8H18V4h-8z\" />\n, 'FormatItalicOutlined');\n","import {createSvgIcon} from '../create-svg-icon';\n\nexport const FormatAlignRightIcon = createSvgIcon(\n  <path d=\"M3 21h18v-2H3v2zm6-4h12v-2H9v2zm-6-4h18v-2H3v2zm6-4h12V7H9v2zM3 3v2h18V3H3z\" />\n, 'FormatAlignRightOutlined');\n","import {createSvgIcon} from '../create-svg-icon';\n\nexport const FormatAlignLeftIcon = createSvgIcon(\n  <path d=\"M15 15H3v2h12v-2zm0-8H3v2h12V7zM3 13h18v-2H3v2zm0 8h18v-2H3v2zM3 3v2h18V3H3z\" />\n, 'FormatAlignLeftOutlined');\n","import {createSvgIcon} from '../create-svg-icon';\n\nexport const FormatAlignCenterIcon = createSvgIcon(\n  <path d=\"M7 15v2h10v-2H7zm-4 6h18v-2H3v2zm0-8h18v-2H3v2zm4-6v2h10V7H7zM3 3v2h18V3H3z\" />\n, 'FormatAlignCenterOutlined');\n","import React, {forwardRef, HTMLProps, Ref} from 'react';\nimport {useController} from 'react-hook-form';\nimport {mergeProps, useObjectRef} from '@react-aria/utils';\nimport {BaseFieldPropsWithDom} from '../base-field-props';\nimport {getInputFieldClassNames} from '../get-input-field-class-names';\nimport {Field} from '../field';\nimport {useField} from '../use-field';\n\nexport interface TextFieldProps\n  extends BaseFieldPropsWithDom<HTMLInputElement> {\n  rows?: number;\n  inputElementType?: 'input' | 'textarea';\n  inputRef?: Ref<HTMLInputElement>;\n  value?: string | number;\n  onChange?: (e: React.ChangeEvent<HTMLInputElement>) => void;\n}\nexport const TextField = forwardRef<HTMLDivElement, TextFieldProps>(\n  ({inputElementType = 'input', flexibleHeight, inputRef, ...props}, ref) => {\n    const inputObjRef = useObjectRef(inputRef);\n\n    const {fieldProps, inputProps} = useField<HTMLInputElement>({\n      ...props,\n      focusRef: inputObjRef,\n    });\n\n    const isTextArea = inputElementType === 'textarea';\n    const ElementType: React.ElementType = isTextArea ? 'textarea' : 'input';\n    const inputFieldClassNames = getInputFieldClassNames({\n      ...props,\n      flexibleHeight: flexibleHeight || inputElementType === 'textarea',\n    });\n\n    if (inputElementType === 'textarea' && !props.unstyled) {\n      inputFieldClassNames.input = `${inputFieldClassNames.input} py-12`;\n    }\n\n    return (\n      <Field ref={ref} fieldClassNames={inputFieldClassNames} {...fieldProps}>\n        <ElementType\n          ref={inputObjRef}\n          {...(inputProps as any)}\n          rows={\n            isTextArea\n              ? (inputProps as HTMLProps<HTMLTextAreaElement>).rows || 4\n              : undefined\n          }\n          className={inputFieldClassNames.input}\n        />\n      </Field>\n    );\n  }\n);\n\nexport interface FormTextFieldProps extends TextFieldProps {\n  name: string;\n}\nexport const FormTextField = React.forwardRef<\n  HTMLDivElement,\n  FormTextFieldProps\n>(({name, ...props}, ref) => {\n  const {\n    field: {onChange, onBlur, value = '', ref: inputRef},\n    fieldState: {invalid, error},\n  } = useController({\n    name,\n  });\n\n  const formProps: TextFieldProps = {\n    onChange,\n    onBlur,\n    value: value == null ? '' : value, // avoid issues with \"null\" value when setting form defaults from backend model\n    invalid,\n    errorMessage: error?.message,\n    inputRef,\n  };\n\n  return <TextField ref={ref} {...mergeProps(formProps, props)} />;\n});\n","import React, {useState} from 'react';\nimport {useStore} from '../../../state/store';\nimport {ButtonGroup} from '../../../common/ui/buttons/button-group';\nimport {IconButton} from '../../../common/ui/buttons/icon-button';\nimport {state, tools} from '../../../state/utils';\nimport {FormatUnderlinedIcon} from '../../../common/icons/material/FormatUnderlined';\nimport {FormatStrikethroughIcon} from '../../../common/icons/material/FormatStrikethrough';\nimport {FormatItalicIcon} from '../../../common/icons/material/FormatItalic';\nimport {FormatAlignRightIcon} from '../../../common/icons/material/FormatAlignRight';\nimport {FormatAlignLeftIcon} from '../../../common/icons/material/FormatAlignLeft';\nimport {FormatAlignCenterIcon} from '../../../common/icons/material/FormatAlignCenter';\nimport {useTrans} from '../../../common/i18n/use-trans';\nimport {TextField} from '../../../common/ui/forms/input-field/text-field/text-field';\n\nexport function TextStyleTabPanel() {\n  return (\n    <div className=\"flex gap-20 justify-center\">\n      <FontSizeSelector />\n      <StyleSelector />\n      <AlignmentSelector />\n    </div>\n  );\n}\n\nfunction FontSizeSelector() {\n  const fontSize = useStore(s => s.objects.active.editableProps.fontSize) ?? 40;\n  const {trans} = useTrans();\n  return (\n    <TextField\n      type=\"number\"\n      size=\"xs\"\n      aria-label={trans({message: 'Font Size'})}\n      min={1}\n      max={300}\n      className=\"w-64 flex-shrink-0\"\n      value={fontSize}\n      onChange={e => {\n        tools().objects.setValues({\n          fontSize: e.target.valueAsNumber,\n        });\n        state().setDirty(true);\n      }}\n    />\n  );\n}\n\nfunction StyleSelector() {\n  const fontStyle = useStore(s => s.objects.active.editableProps.fontStyle);\n  const underline = useStore(s => s.objects.active.editableProps.underline);\n  const linethrough = useStore(s => s.objects.active.editableProps.linethrough);\n\n  const [styles, setStyles] = useState([\n    fontStyle,\n    underline && 'underline',\n    linethrough && 'linethrough',\n  ]);\n\n  return (\n    <ButtonGroup\n      size=\"xs\"\n      variant=\"outline\"\n      radius=\"rounded\"\n      value={styles}\n      multiple\n      onChange={(newStyles: string[]) => {\n        setStyles(newStyles);\n        tools().objects.setValues({\n          underline: newStyles.includes('underline'),\n          linethrough: newStyles.includes('linethrough'),\n          fontStyle: newStyles.includes('italic') ? 'italic' : '',\n        });\n        state().setDirty(true);\n      }}\n    >\n      <IconButton value=\"underline\">\n        <FormatUnderlinedIcon />\n      </IconButton>\n      <IconButton value=\"linethrough\">\n        <FormatStrikethroughIcon />\n      </IconButton>\n      <IconButton value=\"italic\">\n        <FormatItalicIcon />\n      </IconButton>\n    </ButtonGroup>\n  );\n}\n\nfunction AlignmentSelector() {\n  const textAlign = useStore(s => s.objects.active.editableProps.textAlign);\n  return (\n    <ButtonGroup\n      size=\"xs\"\n      variant=\"outline\"\n      radius=\"rounded\"\n      value={textAlign}\n      onChange={newAlign => {\n        tools().objects.setValues({\n          textAlign: newAlign,\n        });\n        state().setDirty(true);\n      }}\n    >\n      <IconButton value=\"left\">\n        <FormatAlignLeftIcon />\n      </IconButton>\n      <IconButton value=\"center\">\n        <FormatAlignCenterIcon />\n      </IconButton>\n      <IconButton value=\"right\">\n        <FormatAlignRightIcon />\n      </IconButton>\n    </ButtonGroup>\n  );\n}\n","import React, {\n  Children,\n  cloneElement,\n  ComponentPropsWithoutRef,\n  isValidElement,\n  ReactElement,\n  ReactNode,\n  useContext,\n  useRef,\n  useState,\n} from 'react';\nimport clsx from 'clsx';\nimport {useLayoutEffect} from '@react-aria/utils';\nimport {getFocusableTreeWalker} from '@react-aria/focus';\nimport {TabContext} from './tabs-context';\n\nexport interface TabPanelsProps {\n  children: ReactNode;\n  className?: string;\n}\nexport function TabPanels({children, className}: TabPanelsProps) {\n  const {selectedTab, isLazy} = useContext(TabContext);\n\n  const panelArray = Children.toArray(children);\n\n  let rendered: ReactNode;\n  if (isLazy) {\n    rendered = cloneElement<TabPanelProps>(\n      panelArray[selectedTab] as ReactElement,\n      {index: selectedTab}\n    );\n  } else {\n    rendered = panelArray.map((panel, index) => {\n      if (isValidElement<TabPanelsProps>(panel)) {\n        const isSelected = index === selectedTab;\n        return cloneElement<TabPanelProps>(panel, {\n          index,\n          'aria-hidden': !isSelected,\n          className: !isSelected\n            ? clsx(panel.props.className, 'hidden')\n            : panel.props.className,\n        });\n      }\n      return null;\n    });\n  }\n\n  return <div className={className}>{rendered}</div>;\n}\n\ninterface TabPanelProps extends ComponentPropsWithoutRef<'div'> {\n  className?: string;\n  children: ReactNode;\n  index?: number;\n}\nexport function TabPanel({\n  className,\n  children,\n  index,\n  ...domProps\n}: TabPanelProps) {\n  const {id} = useContext(TabContext);\n\n  const [tabIndex, setTabIndex] = useState<number | undefined>(0);\n  const ref = useRef<HTMLDivElement>(null);\n\n  // The tabpanel should have tabIndex=0 when there are no tabbable elements within it.\n  // Otherwise, tabbing from the focused tab should go directly to the first tabbable element\n  // within the tabpanel.\n  useLayoutEffect(() => {\n    if (ref?.current) {\n      const update = () => {\n        // Detect if there are any tabbable elements and update the tabIndex accordingly.\n        const walker = getFocusableTreeWalker(ref.current!, {tabbable: true});\n        setTabIndex(walker.nextNode() ? undefined : 0);\n      };\n\n      update();\n\n      // Update when new elements are inserted, or the tabIndex/disabled attribute updates.\n      const observer = new MutationObserver(update);\n      observer.observe(ref.current, {\n        subtree: true,\n        childList: true,\n        attributes: true,\n        attributeFilter: ['tabIndex', 'disabled'],\n      });\n\n      return () => {\n        observer.disconnect();\n      };\n    }\n  }, [ref]);\n\n  return (\n    <div\n      tabIndex={tabIndex}\n      ref={ref}\n      id={`${id}-${index}-tabpanel`}\n      aria-labelledby={`${id}-${index}-tab`}\n      className={clsx(className, 'focus-visible:outline-primary-light')}\n      role=\"tabpanel\"\n      {...domProps}\n    >\n      {children}\n    </div>\n  );\n}\n","import {IGradientOptions} from 'fabric/fabric-impl';\n\nexport const DEFAULT_GRADIENTS: IGradientOptions[] = [\n  {\n    type: 'linear',\n    coords: {\n      x1: -80,\n      y1: 0,\n      x2: 80,\n      y2: 0,\n    },\n    colorStops: [\n      {color: '#ffe47b', offset: 0},\n      {color: 'rgb(111,154,211)', offset: 1},\n    ],\n  },\n  {\n    type: 'linear',\n    coords: {\n      x1: 0,\n      y1: -120,\n      x2: 0,\n      y2: 120,\n    },\n    colorStops: [\n      {color: '#ff4040', offset: 0},\n      {color: '#e6399b', offset: 1},\n    ],\n  },\n  {\n    type: 'linear',\n    coords: {\n      x1: -90,\n      y1: -90,\n      x2: 90,\n      y2: 90,\n    },\n    colorStops: [\n      {offset: 0, color: 'rgb(166,111,213)'},\n      {offset: 0.5, color: 'rgba(106, 72, 215, 0.5)'},\n      {offset: 1, color: '#200772'},\n    ],\n  },\n  {\n    type: 'radial',\n    coords: {\n      r1: 100,\n      r2: 10,\n      x1: 0,\n      y1: 0,\n      x2: 0,\n      y2: 0,\n    },\n    colorStops: [\n      {offset: 0, color: '#FF4F4F'},\n      {offset: 1, color: 'rgb(255, 239, 64)'},\n    ],\n  },\n  {\n    type: 'radial',\n    coords: {\n      r1: 100,\n      r2: 10,\n      x1: 0,\n      y1: 0,\n      x2: 20,\n      y2: 20,\n    },\n    colorStops: [\n      {offset: 0, color: '#ffe47b'},\n      {offset: 0.5, color: 'rgb(111,154,211)'},\n      {offset: 1, color: 'rgb(166,111,213)'},\n    ],\n  },\n  {\n    type: 'radial',\n    coords: {\n      r1: 50,\n      r2: 80,\n      x1: 45,\n      y1: 45,\n      x2: 52,\n      y2: 50,\n    },\n    colorStops: [\n      {offset: 0, color: 'rgb(155, 237, 0)'},\n      {offset: 1, color: 'rgba(0, 164, 128,0.4)'},\n    ],\n  },\n  {\n    type: 'linear',\n    coords: {\n      x1: -90,\n      y1: -90,\n      x2: 90,\n      y2: 90,\n    },\n    colorStops: [\n      {offset: 0, color: '#9ecb2d'},\n      {offset: 0.5, color: '#72aa00'},\n      {offset: 1, color: '#bfd255'},\n    ],\n  },\n  {\n    type: 'radial',\n    coords: {\n      r1: 100,\n      r2: 50,\n      x1: 30,\n      y1: 0,\n      x2: 0,\n      y2: 0,\n    },\n    colorStops: [\n      {offset: 0, color: '#aebcbf'},\n      {offset: 1, color: '#0a0809'},\n    ],\n  },\n  {\n    type: 'linear',\n    coords: {\n      x1: -80,\n      y1: 0,\n      x2: 80,\n      y2: 0,\n    },\n    colorStops: [\n      {offset: 0, color: '#ffffff'},\n      {offset: 1, color: '#f6f6f6'},\n    ],\n  },\n  {\n    type: 'linear',\n    coords: {\n      x1: 0,\n      y1: -120,\n      x2: 0,\n      y2: 120,\n    },\n    colorStops: [\n      {offset: 0, color: '#fefcea'},\n      {offset: 1, color: '#f1da36'},\n    ],\n  },\n  {\n    type: 'linear',\n    coords: {\n      x1: -90,\n      y1: -90,\n      x2: 90,\n      y2: 90,\n    },\n    colorStops: [\n      {offset: 0, color: 'rgb(166,111,213)'},\n      {offset: 0.5, color: 'rgba(106, 72, 215, 0.5)'},\n      {offset: 1, color: '#ff1a00'},\n    ],\n  },\n  {\n    type: 'linear',\n    coords: {\n      x1: 0,\n      y1: -120,\n      x2: 0,\n      y2: 120,\n    },\n    colorStops: [\n      {offset: 0, color: '#b7deed'},\n      {offset: 1, color: '#21b4e2'},\n    ],\n  },\n  {\n    type: 'linear',\n    coords: {\n      x1: -80,\n      y1: 100,\n      x2: 80,\n      y2: -100,\n    },\n    colorStops: [\n      {offset: 0, color: '#ffe47b'},\n      {offset: 1, color: 'rgb(111,154,211)'},\n    ],\n  },\n];\n","import {createSvgIcon} from '../create-svg-icon';\n\nexport const TextureIcon = createSvgIcon(\n  <path d=\"M19.51 3.08 3.08 19.51c.09.34.27.65.51.9.25.24.56.42.9.51L20.93 4.49c-.19-.69-.73-1.23-1.42-1.41zM11.88 3 3 11.88v2.83L14.71 3h-2.83zM5 3c-1.1 0-2 .9-2 2v2l4-4H5zm14 18c.55 0 1.05-.22 1.41-.59.37-.36.59-.86.59-1.41v-2l-4 4h2zm-9.71 0h2.83L21 12.12V9.29L9.29 21z\" />\n, 'TextureOutlined');\n","import {createSvgIcon} from '../create-svg-icon';\n\nexport const GradientIcon = createSvgIcon(\n  <path d=\"M11 9h2v2h-2V9zm-2 2h2v2H9v-2zm4 0h2v2h-2v-2zm2-2h2v2h-2V9zM7 9h2v2H7V9zm12-6H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zM9 18H7v-2h2v2zm4 0h-2v-2h2v2zm4 0h-2v-2h2v2zm2-7h-2v2h2v2h-2v-2h-2v2h-2v-2h-2v2H9v-2H7v2H5v-2h2v-2H5V5h14v6z\" />\n, 'GradientOutlined');\n","import {createSvgIcon} from '../create-svg-icon';\n\nexport const AddPhotoAlternateIcon = createSvgIcon(\n  <path d=\"M18 20H4V6h9V4H4c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2v-9h-2v9zm-7.79-3.17-1.96-2.36L5.5 18h11l-3.54-4.71zM20 4V1h-2v3h-3c.01.01 0 2 0 2h3v2.99c.01.01 2 0 2 0V6h3V4h-3z\" />\n, 'AddPhotoAlternateOutlined');\n","import React, {Fragment} from 'react';\nimport {fabric} from 'fabric';\nimport {Pattern} from 'fabric/fabric-impl';\nimport {useStore} from '../../../state/store';\nimport {ColorPickerButton} from '../../../ui/color-picker-button';\nimport {Button} from '../../../common/ui/buttons/button';\nimport {DEFAULT_GRADIENTS} from '../../../config/default-gradients';\nimport {ButtonBase} from '../../../common/ui/buttons/button-base';\nimport {defaultObjectProps} from '../../../config/default-object-props';\nimport {state, tools} from '../../../state/utils';\nimport {TextureIcon} from '../../../common/icons/material/Texture';\nimport {GradientIcon} from '../../../common/icons/material/Gradient';\nimport {KeyboardArrowDownIcon} from '../../../common/icons/material/KeyboardArrowDown';\nimport {AddPhotoAlternateIcon} from '../../../common/icons/material/AddPhotoAlternate';\nimport {assetUrl} from '../../../utils/asset-url';\nimport {Dialog} from '../../../common/ui/overlays/dialog/dialog';\nimport {useTrans} from '../../../common/i18n/use-trans';\nimport {DialogTrigger} from '../../../common/ui/overlays/dialog/dialog-trigger';\nimport {Trans} from '../../../common/i18n/trans';\nimport {useDialogContext} from '../../../common/ui/overlays/dialog/dialog-context';\n\ninterface Props {\n  property: 'fill' | 'backgroundColor';\n}\n\nexport function ColorTabPanel({property}: Props) {\n  const {trans} = useTrans();\n  const currentColor = useStore(s => s.objects.active.editableProps[property]);\n\n  return (\n    <div className=\"flex items-center justify-center gap-14\">\n      <ColorPickerButton\n        className=\"flex-shrink-0\"\n        size=\"xs\"\n        aria-label={trans({message: 'Color'})}\n        value={\n          typeof currentColor === 'string'\n            ? currentColor\n            : defaultObjectProps.fill\n        }\n        onChange={newColor => {\n          tools().objects.setValues({[property]: newColor});\n          state().setDirty(true);\n        }}\n      />\n      <FillSelector type=\"gradient\" property={property} />\n      <FillSelector type=\"texture\" property={property} />\n    </div>\n  );\n}\n\ninterface FillSelectorProps extends Props {\n  type: 'gradient' | 'texture';\n}\n\nfunction FillSelector({type, property}: FillSelectorProps) {\n  const startIcon = type === 'texture' ? <TextureIcon /> : <GradientIcon />;\n  return (\n    <Fragment>\n      <DialogTrigger type=\"popover\">\n        <Button\n          className=\"flex-shrink-0\"\n          id={`${type}-panel-trigger`}\n          variant=\"outline\"\n          size=\"xs\"\n          startIcon={startIcon}\n          endIcon={<KeyboardArrowDownIcon />}\n        >\n          <span className=\"capitalize\">\n            {type === 'gradient' ? (\n              <Trans message=\"Gradient\" />\n            ) : (\n              <Trans message=\"Texture\" />\n            )}\n          </span>\n        </Button>\n        <Dialog size=\"auto\">\n          <div className=\"grid gap-8 grid-cols-5-min-content p-10 bg-paper rounded shadow-md\">\n            <PreviewButtons property={property} type={type} />\n          </div>\n        </Dialog>\n      </DialogTrigger>\n    </Fragment>\n  );\n}\nfunction PreviewButtons({type, property}: FillSelectorProps) {\n  const {close} = useDialogContext();\n  const iterator = Array.from(\n    Array(type === 'gradient' ? DEFAULT_GRADIENTS.length : 28).keys()\n  );\n\n  const previewBtnClass = 'w-56 h-56 bg border shadow-sm hover:scale-110';\n\n  const previewBtns = iterator.map(index => {\n    const previewUrl = assetUrl(`images/${type}s/${index}.png`);\n\n    return (\n      <ButtonBase\n        radius=\"rounded\"\n        className={previewBtnClass}\n        key={index}\n        style={{backgroundImage: `url(${previewUrl})`}}\n        aria-label={`Select ${type} #${index}`}\n        onClick={async () => {\n          close();\n          const value =\n            type === 'gradient'\n              ? new fabric.Gradient(DEFAULT_GRADIENTS[index])\n              : await patternFromUrlOrData(previewUrl);\n          tools().objects.setValues({[property]: value});\n          state().setDirty(true);\n        }}\n      />\n    );\n  });\n\n  if (type === 'texture') {\n    previewBtns.unshift(\n      <UploadButton\n        property={property}\n        key=\"upload-btn\"\n        className={previewBtnClass}\n      />\n    );\n  }\n\n  return <Fragment>{previewBtns}</Fragment>;\n}\n\ninterface UploadButtonProps extends Props {\n  className: string;\n}\nfunction UploadButton({className, property}: UploadButtonProps) {\n  const {close} = useDialogContext();\n  return (\n    <ButtonBase\n      radius=\"rounded\"\n      className={className}\n      aria-label=\"Upload an image\"\n      onClick={async () => {\n        const file = await tools().import.openUploadWindow();\n        close();\n        if (file) {\n          const pattern = await patternFromUrlOrData(await file.data);\n          tools().objects.setValues({[property]: pattern});\n        }\n      }}\n    >\n      <AddPhotoAlternateIcon className=\"icon-md\" />\n    </ButtonBase>\n  );\n}\n\nfunction patternFromUrlOrData(data: string): Promise<Pattern> {\n  return new Promise(resolve => {\n    fabric.util.loadImage(data, img => {\n      const pattern = new fabric.Pattern({\n        source: img,\n        repeat: 'repeat',\n      });\n      resolve(pattern);\n    });\n  });\n}\n","import {useStore} from '../../../state/store';\nimport {state, tools} from '../../../state/utils';\nimport {Slider} from '../../../common/ui/forms/slider/slider';\n\nexport function OpacityTabPanel() {\n  const opacity = useStore(s => s.objects.active.editableProps.opacity);\n\n  return (\n    <Slider\n      className=\"max-w-240 w-full mx-auto\"\n      aria-label=\"Opacity\"\n      value={opacity}\n      minValue={0.1}\n      step={0.1}\n      maxValue={1}\n      onChange={newOpacity => {\n        tools().objects.setValues({opacity: newOpacity});\n        state().setDirty(true);\n      }}\n    />\n  );\n}\n","import {useStore} from '../../../state/store';\nimport {ColorPickerButton} from '../../../ui/color-picker-button';\nimport {state, tools} from '../../../state/utils';\nimport {Slider} from '../../../common/ui/forms/slider/slider';\nimport {useTrans} from '../../../common/i18n/use-trans';\n\nexport function OutlineTabPanel() {\n  const {trans} = useTrans();\n  const outlineColor = useStore(s => s.objects.active.editableProps.stroke);\n  const outlineWidth = useStore(\n    s => s.objects.active.editableProps.strokeWidth\n  );\n\n  return (\n    <div className=\"flex items-center gap-40\">\n      <ColorPickerButton\n        className=\"ml-auto flex-shrink-0\"\n        size=\"xs\"\n        value={outlineColor}\n        aria-label={trans({message: 'Outline Color'})}\n        onChange={newColor => {\n          tools().objects.setValues({stroke: newColor});\n          state().setDirty(true);\n        }}\n      />\n      <Slider\n        aria-label=\"Outline Width\"\n        className=\"max-w-240 mr-auto flex-shrink-0\"\n        value={outlineWidth}\n        onChange={newWidth => {\n          tools().objects.setValues({strokeWidth: newWidth});\n          state().setDirty(true);\n        }}\n      />\n    </div>\n  );\n}\n","import {createSvgIcon} from '../create-svg-icon';\n\nexport const ImageIcon = createSvgIcon(\n  <path d=\"M19 5v14H5V5h14m0-2H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zm-4.86 8.86-3 3.87L9 13.14 6 17h12l-3.86-5.14z\" />\n, 'ImageOutlined');\n","import {Image} from 'fabric/fabric-impl';\nimport {Button} from '../../../common/ui/buttons/button';\nimport {fireObjModifiedEvent} from '../../object-modified-event';\nimport {ImageIcon} from '../../../common/icons/material/Image';\nimport {tools} from '../../../state/utils';\nimport {Trans} from '../../../common/i18n/trans';\n\nexport function ImageTabPanel() {\n  return (\n    <div>\n      <Button\n        type=\"button\"\n        variant=\"outline\"\n        size=\"xs\"\n        startIcon={<ImageIcon />}\n        radius=\"rounded-full\"\n        onClick={async () => {\n          const file = await tools().import.openUploadWindow();\n          if (file) {\n            const active = tools().objects.getActive();\n            if (active && 'setSrc' in active) {\n              const fileData = await file.data;\n              (active as Image).setSrc(fileData, () => {\n                fireObjModifiedEvent({\n                  src: fileData,\n                });\n                tools().canvas.render();\n              });\n            }\n          }\n        }}\n      >\n        <Trans message=\"Replace Image\" />\n      </Button>\n    </div>\n  );\n}\n","import {fabric} from 'fabric';\nimport React from 'react';\nimport {IShadowOptions, Shadow} from 'fabric/fabric-impl';\nimport {useStore} from '../../../state/store';\nimport {ColorPickerButton} from '../../../ui/color-picker-button';\nimport {state, tools} from '../../../state/utils';\nimport {Slider} from '../../../common/ui/forms/slider/slider';\nimport {useTrans} from '../../../common/i18n/use-trans';\n\nconst shadowDefaults = {\n  color: 'rgba(0, 0, 0, 0.6)',\n  blur: 3,\n  offsetX: -1,\n  offsetY: 0,\n};\n\nexport function ShadowTabPanel() {\n  const {trans} = useTrans();\n  const shadow =\n    useStore(s => s.objects.active.editableProps.shadow) || shadowDefaults;\n\n  return (\n    <div className=\"flex items-center gap-40\">\n      <ColorPickerButton\n        className=\"ml-auto flex-shrink-0\"\n        value={shadow.color}\n        size=\"xs\"\n        aria-label={trans({message: 'Shadow Color'})}\n        onChange={color => {\n          tools().objects.setValues({shadow: modifiedShadow({color})});\n          state().setDirty(true);\n        }}\n      />\n      <Slider\n        aria-label=\"Shadow Blur\"\n        className=\"max-w-240 mr-auto flex-shrink-0\"\n        defaultValue={shadow.blur}\n        onChange={blur => {\n          tools().objects.setValues({\n            shadow: modifiedShadow({blur}),\n          });\n          state().setDirty(true);\n        }}\n      />\n    </div>\n  );\n}\n\nfunction modifiedShadow(options: IShadowOptions) {\n  const current = tools().objects.getActive()?.shadow as Shadow | null;\n  if (current) {\n    Object.entries(options).forEach(([key, val]) => {\n      current[key as keyof IShadowOptions] = val;\n    });\n    return current;\n  }\n  return new fabric.Shadow({\n    ...shadowDefaults,\n    ...options,\n  });\n}\n","import React, {ReactNode, useContext} from 'react';\nimport clsx from 'clsx';\nimport {useFocusManager} from '@react-aria/focus';\nimport {TabContext} from './tabs-context';\n\nexport interface TabProps {\n  className?: string;\n  index?: number;\n  children: ReactNode;\n  isDisabled?: boolean;\n}\nexport function Tab({index, className, isDisabled, children}: TabProps) {\n  const {selectedTab, setSelectedTab, tabsRef, size, id} =\n    useContext(TabContext);\n  const isSelected = index === selectedTab;\n  const focusManager = useFocusManager();\n\n  const mergedClassname = clsx(\n    'tracking-wide overflow-hidden capitalize text-sm flex-shrink-0 flex items-center justify-center outline-none transition-colors',\n    'focus-visible:ring focus-visible:ring-2 ring-inset rounded',\n    textColor({isDisabled, isSelected}),\n    className,\n    {\n      'px-18 h-48': !size || size === 'md',\n      'px-12 h-32': size === 'sm',\n      'cursor-pointer': !isDisabled,\n    }\n  );\n\n  const onKeyDown = (e: React.KeyboardEvent<HTMLButtonElement>) => {\n    switch (e.key) {\n      case 'ArrowLeft':\n        focusManager.focusPrevious();\n        break;\n      case 'ArrowRight':\n        focusManager.focusNext();\n        break;\n      case 'Home':\n        focusManager.focusFirst();\n        break;\n      case 'End':\n        focusManager.focusLast();\n        break;\n    }\n  };\n\n  const tabIndex = isSelected ? 0 : -1;\n\n  return (\n    <button\n      disabled={isDisabled}\n      id={`${id}-${index}-tab`}\n      aria-controls={`${id}-${index}-tabpanel`}\n      type=\"button\"\n      role=\"tab\"\n      aria-selected={isSelected}\n      tabIndex={isDisabled ? undefined : tabIndex}\n      onKeyDown={onKeyDown}\n      onClick={() => {\n        setSelectedTab(index!);\n      }}\n      className={mergedClassname}\n      ref={el => {\n        if (tabsRef.current && el) {\n          tabsRef.current[index!] = el;\n        }\n      }}\n    >\n      {children}\n    </button>\n  );\n}\n\ninterface TextColorProps {\n  isDisabled?: boolean;\n  isSelected: boolean;\n}\nfunction textColor({isDisabled, isSelected}: TextColorProps): string {\n  if (isDisabled) {\n    return 'text-disabled cursor-default';\n  }\n  if (isSelected) {\n    return 'text-primary';\n  }\n  return 'text-muted hover:text-main';\n}\n","import React from 'react';\nimport {TabList} from '../../../common/ui/tabs/tab-list';\nimport {Tabs} from '../../../common/ui/tabs/tabs';\nimport {TextStyleTabPanel} from './text-style-tab-panel';\nimport {TabPanel, TabPanels} from '../../../common/ui/tabs/tab-panels';\nimport {ColorTabPanel} from './color-tab-panel';\nimport {OpacityTabPanel} from './opacity-tab-panel';\nimport {OutlineTabPanel} from './outline-tab-panel';\nimport {useStore} from '../../../state/store';\nimport {ImageTabPanel} from './image-tab-panel';\nimport {ShadowTabPanel} from './shadow-tab-panel';\nimport {Trans} from '../../../common/i18n/trans';\nimport {Tab} from '../../../common/ui/tabs/tab';\n\nexport function ActiveObjectControls() {\n  const active = useStore(s => s.objects.active);\n\n  return (\n    <Tabs size=\"sm\" className=\"pb-18 pt-6\">\n      <TabList center>\n        {active.isText && (\n          <Tab>\n            <Trans message=\"Font\" />\n          </Tab>\n        )}\n        {!active.isImage && (\n          <Tab>\n            <Trans message=\"Color\" />\n          </Tab>\n        )}\n        {!active.isImage && (\n          <Tab>\n            <Trans message=\"Background\" />\n          </Tab>\n        )}\n        {active.isImage && (\n          <Tab>\n            <Trans message=\"Image\" />\n          </Tab>\n        )}\n        <Tab>\n          <Trans message=\"Opacity\" />\n        </Tab>\n        <Tab>\n          <Trans message=\"Outline\" />\n        </Tab>\n        <Tab>\n          <Trans message=\"Shadow\" />\n        </Tab>\n      </TabList>\n      <TabPanels className=\"pt-16 h-50\">\n        {active.isText && (\n          <TabPanel key=\"font\">\n            <TextStyleTabPanel />\n          </TabPanel>\n        )}\n        {!active.isImage && (\n          <TabPanel>\n            <ColorTabPanel property=\"fill\" />\n          </TabPanel>\n        )}\n        {!active.isImage && (\n          <TabPanel>\n            <ColorTabPanel property=\"backgroundColor\" />\n          </TabPanel>\n        )}\n        {active.isImage && (\n          <TabPanel>\n            <ImageTabPanel />\n          </TabPanel>\n        )}\n        <TabPanel>\n          <OpacityTabPanel />\n        </TabPanel>\n        <TabPanel>\n          <OutlineTabPanel />\n        </TabPanel>\n        <TabPanel>\n          <ShadowTabPanel />\n        </TabPanel>\n      </TabPanels>\n    </Tabs>\n  );\n}\n","import {Button} from '../../../common/ui/buttons/button';\nimport {ActiveObjectControls} from '../../../objects/ui/active-obj-controls/active-object-controls';\nimport {ToolControlsOverlayWrapper} from '../../../ui/navbar/tool-controls-overlay-wrapper';\nimport {state, tools} from '../../../state/utils';\nimport {useIsMobileMediaQuery} from '../../../common/utils/hooks/is-mobile-media-query';\nimport {Trans} from '../../../common/i18n/trans';\n\nexport function ActiveTextControls() {\n  const isMobile = useIsMobileMediaQuery();\n  const actionBtn = !isMobile && (\n    <Button\n      size=\"sm\"\n      color=\"primary\"\n      variant=\"outline\"\n      onClick={() => {\n        tools().text.add();\n        state().setDirty(true);\n      }}\n    >\n      <Trans message=\"New Text\" />\n    </Button>\n  );\n  return (\n    <ToolControlsOverlayWrapper actionBtn={actionBtn}>\n      <ActiveObjectControls />\n    </ToolControlsOverlayWrapper>\n  );\n}\n","import {AnimatePresence, m} from 'framer-motion';\nimport {FilterControls} from '../../tools/filter/ui/filter-controls';\nimport {useStore} from '../../state/store';\nimport {ActiveFrameControls} from '../../tools/frame/ui/active-frame-controls';\nimport {ActiveTextControls} from '../../tools/text/ui/active-text-controls';\nimport {ActiveObjectControls} from '../../objects/ui/active-obj-controls/active-object-controls';\nimport {ActiveToolOverlay} from '../../state/editor-state';\n\nexport function ToolControlsOverlay() {\n  const activeOverlay = useStore(s => s.activeToolOverlay);\n  const activeObjId = useStore(s => s.objects.active.id);\n  const overlayCmp = getOverlay(activeOverlay, activeObjId);\n\n  return (\n    <div className=\"relative z-tool-overlay text-sm\">\n      <AnimatePresence>\n        {overlayCmp && (\n          <m.div\n            initial={{y: 0, opacity: 0}}\n            animate={{y: '-100%', opacity: 1}}\n            exit={{y: 0, opacity: 0}}\n            transition={{type: 'tween', duration: 0.15}}\n            key=\"tool-controls-overlay\"\n            className=\"absolute inset-x-0 gap-16 px-5vw bg bg-opacity-95 border-t\"\n          >\n            {overlayCmp}\n          </m.div>\n        )}\n      </AnimatePresence>\n    </div>\n  );\n}\n\nfunction getOverlay(\n  activeOverlay: ActiveToolOverlay | null,\n  activeObjId: string | null\n) {\n  switch (activeOverlay) {\n    case ActiveToolOverlay.Filter:\n      return <FilterControls />;\n    case ActiveToolOverlay.Frame:\n      return <ActiveFrameControls />;\n    case ActiveToolOverlay.Text:\n      return activeObjId && <ActiveTextControls />;\n    case ActiveToolOverlay.ActiveObject:\n      return activeObjId && <ActiveObjectControls />;\n    default:\n      return null;\n  }\n}\n","import {createSvgIcon} from '../create-svg-icon';\n\nexport const CancelIcon = createSvgIcon(\n  <path d=\"M12 2C6.47 2 2 6.47 2 12s4.47 10 10 10 10-4.47 10-10S17.53 2 12 2zm0 18c-4.41 0-8-3.59-8-8s3.59-8 8-8 8 3.59 8 8-3.59 8-8 8zm3.59-13L12 10.59 8.41 7 7 8.41 10.59 12 7 15.59 8.41 17 12 13.41 15.59 17 17 15.59 13.41 12 17 8.41z\" />,\n  'CancelOutlined'\n);\n","import clsx from 'clsx';\nimport {useStore} from '../../../state/store';\nimport {ActiveToolOverlay} from '../../../state/editor-state';\nimport {filterNameMessages} from '../filter-list';\nimport {state, tools} from '../../../state/utils';\nimport {assetUrl} from '../../../utils/asset-url';\nimport {Trans} from '../../../common/i18n/trans';\nimport {ButtonBase} from '../../../common/ui/buttons/button-base';\nimport {IconButton} from '../../../common/ui/buttons/icon-button';\nimport {CancelIcon} from '../../../common/icons/material/Cancel';\nimport {TuneIcon} from '../../../common/icons/material/Tune';\n\ntype FilterButtonProps = {\n  filter: string;\n};\n\nexport function FilterButton({filter}: FilterButtonProps) {\n  const isActive = useStore(s => s.filter.applied.includes(filter));\n  const hasOptions = tools().filter.hasOptions(filter);\n\n  const className = clsx('block flex-shrink-0 rounded', {\n    'text-primary border-primary': isActive,\n  });\n\n  const msg = filterNameMessages[filter];\n  const content = (\n    <>\n      <div className=\"relative\">\n        <FilterImg filter={filter} />\n        {isActive && <ActiveOverlay filter={filter} hasOptions={hasOptions} />}\n      </div>\n      <div className=\"mt-4 text-center text-xs capitalize\">\n        {msg ? <Trans {...msg} /> : filter}\n      </div>\n    </>\n  );\n\n  if (isActive && hasOptions) {\n    return <div className={className}>{content}</div>;\n  }\n  return (\n    <ButtonBase\n      className={className}\n      onClick={() => {\n        if (isActive) {\n          tools().filter.remove(filter);\n        } else {\n          tools().filter.apply(filter);\n        }\n      }}\n    >\n      {content}\n    </ButtonBase>\n  );\n}\n\ntype FilterImgProps = {\n  filter: string;\n};\n\nfunction FilterImg({filter}: FilterImgProps) {\n  const isSelected = useStore(s => s.filter.selected === filter);\n  const className = clsx('m-auto w-96 h-56 border rounded object-cover', {\n    shadow: isSelected,\n  });\n  return (\n    <img\n      src={assetUrl(`images/filter/${filter}.jpg`)}\n      className={className}\n      alt=\"\"\n    />\n  );\n}\n\ntype ActiveOverlayProps = {\n  hasOptions: boolean;\n  filter: string;\n};\n\nfunction ActiveOverlay({filter, hasOptions}: ActiveOverlayProps) {\n  const removeBtn = (\n    <IconButton\n      color=\"primary\"\n      size=\"md\"\n      onClick={() => {\n        tools().filter.remove(filter);\n      }}\n    >\n      <CancelIcon />\n    </IconButton>\n  );\n  return (\n    <div className=\"flex items-center justify-center bg-background/70 absolute inset-0 border-2 border-primary rounded\">\n      {hasOptions ? removeBtn : <CancelIcon className=\"svg-icon icon-md\" />}\n      {hasOptions && (\n        <ToggleSettingsButton filter={filter} hasOptions={hasOptions} />\n      )}\n    </div>\n  );\n}\n\ntype ToggleSettingsButtonProps = {\n  hasOptions: boolean;\n  filter: string;\n};\n\nfunction ToggleSettingsButton({filter, hasOptions}: ToggleSettingsButtonProps) {\n  return (\n    <IconButton\n      color=\"primary\"\n      size=\"md\"\n      onClick={() => {\n        if (\n          state().activeToolOverlay === ActiveToolOverlay.Filter &&\n          state().filter.selected === filter\n        ) {\n          state().setActiveTool(state().activeTool, null);\n        } else {\n          state().filter.select(filter, hasOptions);\n        }\n      }}\n    >\n      <TuneIcon />\n    </IconButton>\n  );\n}\n","import React, {forwardRef} from 'react';\nimport clsx from 'clsx';\n\ntype ScrollableListProps = {\n  children: React.ReactNode;\n  className?: string;\n  gap?: string;\n};\n\nexport const ScrollableView = forwardRef<HTMLDivElement, ScrollableListProps>(\n  ({children, className, gap}, ref) => {\n    const extendedChildren = React.Children.map(children, (child, i) => {\n      if (React.isValidElement<ScrollableListItemProps>(child)) {\n        return React.cloneElement<ScrollableListItemProps>(child, {\n          isFirst: i === 0,\n          isLast: React.Children.count(children) === i + 1,\n        });\n      }\n      return child;\n    });\n    return (\n      <div\n        ref={ref}\n        className={`tiny-scrollbar pb-4 overflow-x-auto relative flex items-center ${\n          gap || 'gap-10'\n        } ${className}`}\n      >\n        {extendedChildren}\n      </div>\n    );\n  }\n);\n\nexport type ScrollableListItemProps = {\n  children: React.ReactNode;\n  className?: string;\n  isFirst?: boolean;\n  isLast?: boolean;\n};\nexport function ScrollableViewItem({\n  isFirst,\n  isLast,\n  children,\n  className,\n}: ScrollableListItemProps) {\n  const mergedClass = clsx(className, 'flex-shrink-0', {\n    'ml-auto': isFirst,\n    'mr-auto': isLast,\n  });\n  return <div className={mergedClass}>{children}</div>;\n}\n","import {useEffect} from 'react';\nimport {useStore} from '../../../state/store';\nimport {FilterButton} from './filter-button';\nimport {\n  ScrollableView,\n  ScrollableViewItem,\n} from '../../../ui/navbar/scrollable-view';\nimport {tools} from '../../../state/utils';\n\nexport function FilterNav() {\n  const filters = useStore(s => s.config.tools?.filter?.items) || [];\n\n  useEffect(() => {\n    tools().filter.syncState();\n  }, []);\n\n  const filterBtns = filters.map(filter => (\n    <ScrollableViewItem key={filter}>\n      <FilterButton filter={filter} />\n    </ScrollableViewItem>\n  ));\n  return <ScrollableView>{filterBtns}</ScrollableView>;\n}\n","import {createSvgIcon} from '../create-svg-icon';\n\nexport const LockIcon = createSvgIcon(\n  <path d=\"M18 8h-1V6c0-2.76-2.24-5-5-5S7 3.24 7 6v2H6c-1.1 0-2 .9-2 2v10c0 1.1.9 2 2 2h12c1.1 0 2-.9 2-2V10c0-1.1-.9-2-2-2zM9 6c0-1.66 1.34-3 3-3s3 1.34 3 3v2H9V6zm9 14H6V10h12v10zm-6-3c1.1 0 2-.9 2-2s-.9-2-2-2-2 .9-2 2 .9 2 2 2z\" />\n, 'LockOutlined');\n","import {createSvgIcon} from '../create-svg-icon';\n\nexport const LockOpenIcon = createSvgIcon(\n  <path d=\"M18 8h-1V6c0-2.76-2.24-5-5-5S7 3.24 7 6h2c0-1.66 1.34-3 3-3s3 1.34 3 3v2H6c-1.1 0-2 .9-2 2v10c0 1.1.9 2 2 2h12c1.1 0 2-.9 2-2V10c0-1.1-.9-2-2-2zm0 12H6V10h12v10zm-6-3c1.1 0 2-.9 2-2s-.9-2-2-2-2 .9-2 2 .9 2 2 2z\" />\n, 'LockOpenOutlined');\n","import {createSvgIcon} from '../create-svg-icon';\n\nexport const CheckBoxOutlineBlankIcon = createSvgIcon(\n  <path d=\"M19 5v14H5V5h14m0-2H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2z\" />\n, 'CheckBoxOutlineBlankOutlined');\n","import {createSvgIcon} from '../../../icons/create-svg-icon';\n\nexport const CheckboxFilledIcon = createSvgIcon(\n  <path d=\"M19 3H5c-1.11 0-2 .9-2 2v14c0 1.1.89 2 2 2h14c1.11 0 2-.9 2-2V5c0-1.1-.89-2-2-2zm-9 14-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8l-9 9z\" />,\n  'CheckBox'\n);\n","import {createSvgIcon} from \"../../../icons/create-svg-icon\";\n\nexport const IndeterminateCheckboxFilledIcon = createSvgIcon(\n  <path d=\"M19,3H5C3.9,3,3,3.9,3,5v14c0,1.1,0.9,2,2,2h14c1.1,0,2-0.9,2-2V5C21,3.9,20.1,3,19,3z M17,13H7v-2h10V13z\" />,\n  'CheckBox'\n);\n","import React, {\n  ChangeEventHandler,\n  ComponentPropsWithoutRef,\n  ComponentType,\n  forwardRef,\n  useCallback,\n  useEffect,\n} from \"react\";\nimport clsx from \"clsx\";\nimport { useController } from \"react-hook-form\";\nimport { mergeProps, useObjectRef } from \"@react-aria/utils\";\nimport { useControlledState } from \"@react-stately/utils\";\nimport { InputSize } from \"../input-field/input-size\";\nimport { getInputFieldClassNames } from \"../input-field/get-input-field-class-names\";\nimport { CheckBoxOutlineBlankIcon } from \"../../../icons/material/CheckBoxOutlineBlank\";\nimport { CheckboxFilledIcon } from \"./checkbox-filled-icon\";\nimport { IndeterminateCheckboxFilledIcon } from \"./indeterminate-checkbox-filled-icon\";\nimport { SvgIconProps } from \"../../../icons/svg-icon\";\nimport { Orientation } from \"../orientation\";\nimport { AutoFocusProps, useAutoFocus } from \"../../focus/use-auto-focus\";\n\nexport interface CheckboxProps\n  extends AutoFocusProps,\n    Omit<ComponentPropsWithoutRef<\"input\">, \"size\"> {\n  size?: InputSize;\n  className?: string;\n  icon?: React.ComponentType;\n  checkedIcon?: React.ComponentType;\n  orientation?: Orientation;\n  errorMessage?: string;\n  isIndeterminate?: boolean;\n  invalid?: boolean;\n}\nexport const Checkbox = forwardRef<HTMLInputElement, CheckboxProps>(\n  (props, ref) => {\n    const {\n      size = \"md\",\n      children,\n      className,\n      icon,\n      checkedIcon,\n      disabled,\n      isIndeterminate,\n      errorMessage,\n      invalid,\n      orientation = \"horizontal\",\n      onChange,\n      autoFocus,\n      required,\n      value,\n    } = props;\n\n    const style = getInputFieldClassNames({ ...props, label: children });\n    const Icon = icon || CheckBoxOutlineBlankIcon;\n    const CheckedIcon =\n      checkedIcon ||\n      (isIndeterminate ? IndeterminateCheckboxFilledIcon : CheckboxFilledIcon);\n\n    const inputObjRef = useObjectRef(ref);\n    useAutoFocus({ autoFocus }, inputObjRef);\n\n    useEffect(() => {\n      // indeterminate is a property, but it can only be set via javascript\n      if (inputObjRef.current) {\n        inputObjRef.current.indeterminate = isIndeterminate || false;\n      }\n    });\n\n    const [isSelected, setSelected] = useControlledState(\n      props.checked,\n      props.defaultChecked || false\n    );\n\n    const updateChecked: ChangeEventHandler<HTMLInputElement> = useCallback(\n      (e) => {\n        onChange?.(e);\n        setSelected(e.target.checked);\n      },\n      [onChange, setSelected]\n    );\n\n    const mergedClassName = clsx(\n      \"select-none\",\n      className,\n      invalid && \"text-danger\",\n      !invalid && disabled && \"text-disabled\"\n    );\n\n    let CheckboxIcon: ComponentType<SvgIconProps>;\n    let checkboxColor = invalid ? \"text-danger\" : null;\n    if (isIndeterminate) {\n      CheckboxIcon = IndeterminateCheckboxFilledIcon;\n      checkboxColor = checkboxColor || \"text-primary\";\n    } else if (isSelected) {\n      CheckboxIcon = CheckedIcon;\n      checkboxColor = checkboxColor || \"text-primary\";\n    } else {\n      CheckboxIcon = Icon;\n      checkboxColor = checkboxColor || \"text-muted\";\n    }\n\n    // input and icon sizes need to match, as checkbox input is being clicked and not the icon due to pointer-events-none\n    return (\n      <div>\n        <label className={mergedClassName}>\n          <div\n            className={clsx(\n              \"relative flex items-center\",\n              orientation === \"vertical\" && \"flex-col flex-col-reverse\"\n            )}\n          >\n            <input\n              className=\"focus-visible:ring ring-inset transition-shadow outline-none absolute left-0 top-0 w-24 h-24 rounded appearance-none\"\n              type=\"checkbox\"\n              aria-checked={isIndeterminate ? \"mixed\" : isSelected}\n              aria-invalid={invalid || undefined}\n              onChange={updateChecked}\n              ref={inputObjRef}\n              required={required}\n              disabled={disabled}\n              value={value}\n            />\n            <CheckboxIcon\n              size={size}\n              className={clsx(\n                \"pointer-events-none\",\n                disabled ? \"text-disabled\" : checkboxColor\n              )}\n            />\n            {children && (\n              <div\n                className={clsx(\n                  \"first-letter:capitalize\",\n                  style.size.font,\n                  orientation === \"vertical\" ? \"mb-6\" : \"ml-6\"\n                )}\n              >\n                {children}\n              </div>\n            )}\n          </div>\n        </label>\n        {errorMessage && <div className={style.error}>{errorMessage}</div>}\n      </div>\n    );\n  }\n);\n\ninterface FormCheckboxProps extends CheckboxProps {\n  name: string;\n}\nexport function FormCheckbox(props: FormCheckboxProps) {\n  const {\n    field: { onChange, onBlur, value = false, ref },\n    fieldState: { invalid, error },\n  } = useController({\n    name: props.name,\n  });\n\n  const formProps: Partial<CheckboxProps> = {\n    onChange,\n    onBlur,\n    checked: value,\n    invalid,\n    errorMessage: error?.message,\n  };\n\n  return <Checkbox ref={ref} {...mergeProps(formProps, props)} />;\n}\n","import React, {useEffect} from 'react';\nimport {useStore} from '../../../state/store';\nimport {aspectToHeight, aspectToWidth} from '../clamp-resize-payload';\nimport {state} from '../../../state/utils';\nimport {LockIcon} from '../../../common/icons/material/Lock';\nimport {LockOpenIcon} from '../../../common/icons/material/LockOpen';\nimport {useTrans} from '../../../common/i18n/use-trans';\nimport {Checkbox} from '../../../common/ui/forms/toggle/checkbox';\nimport {Trans} from '../../../common/i18n/trans';\nimport {TextField} from '../../../common/ui/forms/input-field/text-field/text-field';\n\nexport function ResizeNav() {\n  const {trans} = useTrans();\n  const {\n    minWidth = 50,\n    minHeight = 50,\n    maxHeight = 2400,\n    maxWidth = 2400,\n  } = useStore(s => s.config.tools?.resize) || {};\n  const originalSize = useStore(s => s.original);\n  const formVal = useStore(s => s.resize.formValue);\n\n  useEffect(() => {\n    state().resize.setFormValue({...originalSize});\n  }, [originalSize]);\n\n  useEffect(() => {\n    // setting dirty in above useEffect will prevent tool selection after resize\n    state().setDirty(true);\n  }, []);\n\n  const onWidthChange = (newWidth: number) => {\n    const newVal = {...formVal, width: newWidth};\n    if (formVal.maintainAspect) {\n      newVal.height = aspectToHeight(newWidth, formVal.usePercentages);\n    }\n    state().resize.setFormValue(newVal);\n  };\n\n  const onHeightChange = (newHeight: number) => {\n    const newVal = {...formVal, height: newHeight};\n    if (newHeight && formVal.maintainAspect) {\n      newVal.width = aspectToWidth(newHeight, formVal.usePercentages);\n    }\n    state().resize.setFormValue(newVal);\n  };\n\n  const onAspectChange = (isChecked: boolean) => {\n    const newVal = {...formVal, maintainAspect: isChecked};\n    if (isChecked) {\n      newVal.height = aspectToHeight(newVal.width, newVal.usePercentages);\n    }\n    state().resize.setFormValue(newVal);\n  };\n\n  const onSubmit = (e: React.FormEvent<HTMLFormElement>) => {\n    e.preventDefault();\n    state().applyChanges();\n  };\n\n  return (\n    <form\n      className=\"flex items-center justify-center gap-16 w-full\"\n      onSubmit={onSubmit}\n    >\n      <TextField\n        type=\"number\"\n        min={minWidth}\n        max={maxWidth}\n        size=\"sm\"\n        className=\"w-full max-w-112\"\n        label=\"Width\"\n        value={formVal.width}\n        onChange={e => {\n          onWidthChange(e.target.valueAsNumber);\n        }}\n      />\n      <div className=\"mt-24\">\n        <Checkbox\n          size=\"md\"\n          checked={formVal.maintainAspect}\n          onChange={e => {\n            onAspectChange(!formVal.maintainAspect);\n          }}\n          aria-label={trans({message: 'Maintain aspect ratio'})}\n          checkedIcon={LockIcon}\n          icon={LockOpenIcon}\n        />\n      </div>\n      <TextField\n        type=\"number\"\n        min={minHeight}\n        max={maxHeight}\n        size=\"sm\"\n        className=\"w-full max-w-112\"\n        label=\"Height\"\n        value={formVal.height}\n        onChange={e => {\n          onHeightChange(e.target.valueAsNumber);\n        }}\n      />\n      <button type=\"submit\" className=\"hidden\">\n        <Trans message=\"Resize\" />\n      </button>\n    </form>\n  );\n}\n","import clsx from 'clsx';\nimport {\n  aspectRatioFromStr,\n  calcNewSizeFromAspectRatio,\n} from '../../../../common/ui/interactions/utils/calc-new-size-from-aspect-ratio';\nimport {useStore} from '../../../../state/store';\nimport {tools} from '../../../../state/utils';\nimport {\n  ScrollableView,\n  ScrollableViewItem,\n} from '../../../../ui/navbar/scrollable-view';\nimport {ButtonBase} from '../../../../common/ui/buttons/button-base';\n\nexport function CropPresetBtns() {\n  const presets = useStore(s => s.config.tools?.crop?.presets) || [];\n  const selectedRatio = useStore(s => s.crop.selectedAspectRatio);\n  const allowCustomRatio =\n    useStore(s => s.config.tools?.crop?.allowCustomRatio) ?? true;\n\n  const btns = presets\n    .filter(preset => {\n      return preset.ratio || (!preset.ratio && allowCustomRatio);\n    })\n    .map(preset => (\n      <ScrollableViewItem key={preset.ratio || preset.name}>\n        <ButtonBase\n          onClick={() => tools().crop.resetCropzone(preset.ratio)}\n          className=\"flex flex-col items-center justify-between cursor-pointer h-56\"\n        >\n          <PresetPreview preset={preset} selectedRatio={selectedRatio} />\n          <PresetName preset={preset} selectedRatio={selectedRatio} />\n        </ButtonBase>\n      </ScrollableViewItem>\n    ));\n\n  return <ScrollableView gap=\"gap-18\">{btns}</ScrollableView>;\n}\n\ntype PresetProps = {\n  preset: {ratio: string | null; name?: string};\n  selectedRatio: string | null;\n};\n\nfunction PresetPreview({preset, selectedRatio}: PresetProps) {\n  let width = 40;\n  let height = 30;\n  if (preset.ratio) {\n    const ratio = aspectRatioFromStr(preset.ratio);\n    ({width, height} = calcNewSizeFromAspectRatio(ratio, width, height));\n  }\n  const className = clsx('border-2', {\n    'border-dotted': preset.ratio === null,\n    'border-primary': selectedRatio === preset.ratio,\n  });\n  return (\n    <div\n      style={{width: `${width}px`, height: `${height}px`}}\n      className={className}\n    />\n  );\n}\n\nfunction PresetName({preset, selectedRatio}: PresetProps) {\n  const className = clsx('mt-4 text-center text-xs', {\n    'text-primary': selectedRatio === preset.ratio,\n  });\n  return <div className={className}>{preset.name || preset.ratio}</div>;\n}\n","import {createSvgIcon} from '../create-svg-icon';\n\nexport const FlipIcon = createSvgIcon(\n  <path d=\"M15 21h2v-2h-2v2zm4-12h2V7h-2v2zM3 5v14c0 1.1.9 2 2 2h4v-2H5V5h4V3H5c-1.1 0-2 .9-2 2zm16-2v2h2c0-1.1-.9-2-2-2zm-8 20h2V1h-2v22zm8-6h2v-2h-2v2zM15 5h2V3h-2v2zm4 8h2v-2h-2v2zm0 8c1.1 0 2-.9 2-2h-2v2z\" />\n, 'FlipOutlined');\n","import React from 'react';\nimport {IconButton} from '../../../common/ui/buttons/icon-button';\nimport {state, tools} from '../../../state/utils';\nimport {FlipIcon} from '../../../common/icons/material/Flip';\n\nexport function FlipBtns() {\n  return (\n    <div>\n      <IconButton\n        size=\"sm\"\n        onClick={() => {\n          tools().transform.flip('vertical');\n          state().setDirty(true);\n        }}\n      >\n        <FlipIcon />\n      </IconButton>\n      <IconButton\n        size=\"sm\"\n        onClick={() => {\n          tools().transform.flip('horizontal');\n          state().setDirty(true);\n        }}\n      >\n        <FlipIcon className=\"rotate-90\" />\n      </IconButton>\n    </div>\n  );\n}\n","import {createSvgIcon} from '../create-svg-icon';\n\nexport const RotateLeftIcon = createSvgIcon(\n  <path d=\"M7.11 8.53 5.7 7.11C4.8 8.27 4.24 9.61 4.07 11h2.02c.14-.87.49-1.72 1.02-2.47zM6.09 13H4.07c.17 1.39.72 2.73 1.62 3.89l1.41-1.42c-.52-.75-.87-1.59-1.01-2.47zm1.01 5.32c1.16.9 2.51 1.44 3.9 1.61V17.9c-.87-.15-1.71-.49-2.46-1.03L7.1 18.32zM13 4.07V1L8.45 5.55 13 10V6.09c2.84.48 5 2.94 5 5.91s-2.16 5.43-5 5.91v2.02c3.95-.49 7-3.85 7-7.93s-3.05-7.44-7-7.93z\" />\n, 'RotateLeftOutlined');\n","import {createSvgIcon} from '../create-svg-icon';\n\nexport const RotateRightIcon = createSvgIcon(\n  <path d=\"M15.55 5.55 11 1v3.07C7.06 4.56 4 7.92 4 12s3.05 7.44 7 7.93v-2.02c-2.84-.48-5-2.94-5-5.91s2.16-5.43 5-5.91V10l4.55-4.45zM19.93 11c-.17-1.39-.72-2.73-1.62-3.89l-1.42 1.42c.54.75.88 1.6 1.02 2.47h2.02zM13 17.9v2.02c1.39-.17 2.74-.71 3.9-1.61l-1.44-1.44c-.75.54-1.59.89-2.46 1.03zm3.89-2.42 1.42 1.41c.9-1.16 1.45-2.5 1.62-3.89h-2.02c-.14.87-.48 1.72-1.02 2.48z\" />\n, 'RotateRightOutlined');\n","import React from 'react';\nimport {IconButton} from '../../../common/ui/buttons/icon-button';\nimport {state, tools} from '../../../state/utils';\nimport {RotateLeftIcon} from '../../../common/icons/material/RotateLeft';\nimport {RotateRightIcon} from '../../../common/icons/material/RotateRight';\n\nexport function RotateBtns() {\n  return (\n    <div>\n      <IconButton\n        size=\"sm\"\n        onClick={() => {\n          tools().transform.rotateLeft();\n          state().setDirty(true);\n        }}\n      >\n        <RotateLeftIcon />\n      </IconButton>\n      <IconButton\n        size=\"sm\"\n        onClick={() => {\n          tools().transform.rotateRight();\n          state().setDirty(true);\n        }}\n      >\n        <RotateRightIcon />\n      </IconButton>\n    </div>\n  );\n}\n","import React, {useRef} from 'react';\nimport {FlipBtns} from './flip-btns';\nimport {RotateBtns} from './rotate-btns';\nimport {state, tools} from '../../../state/utils';\nimport {useSlider} from '../../../common/ui/forms/slider/use-slider';\n\nexport function TransformWidget() {\n  return (\n    <div className=\"flex items-center justify-center gap-16\">\n      <FlipBtns />\n      <StraightenSlider />\n      <RotateBtns />\n    </div>\n  );\n}\n\nfunction StraightenSlider() {\n  const svgRef = useRef<SVGSVGElement>(null!);\n  const {domProps, groupId, thumbIds, trackRef, getThumbValueLabel} = useSlider(\n    {\n      minValue: -45,\n      maxValue: 45,\n      step: 1,\n      defaultValue: [state().crop.straightenAngle],\n      onChange: (val: number[]) => {\n        const newValue = val[0];\n        tools().transform.straighten(newValue);\n        state().crop.setTransformAngle(newValue);\n        state().setDirty(true);\n        svgRef.current.style.transform = `translateX(${newValue}px)`;\n      },\n    }\n  );\n\n  return (\n    <div\n      id={groupId}\n      role=\"group\"\n      className=\"flex-auto flex-shrink-0 max-w-320 touch-none isolate\"\n    >\n      <div {...domProps} ref={trackRef} className=\"h-36 relative\">\n        <output\n          htmlFor={thumbIds[0]}\n          aria-live=\"off\"\n          className=\"absolute left-1/2 top-1/2 w-40 text-center bg -translate-x-1/2 -translate-y-1/2 z-10\"\n        >\n          {getThumbValueLabel(0)}°\n        </output>\n        <FreeTransformTrack ref={svgRef} />\n      </div>\n    </div>\n  );\n}\n\nconst FreeTransformTrack = React.forwardRef<SVGSVGElement>((props, ref) => {\n  const numberOfDots = [...Array(80).keys()];\n  const circles = numberOfDots.map(index => {\n    return (\n      <circle\n        key={index}\n        cx={2 + index * 10}\n        cy=\"20\"\n        r={!(index % 5) ? 2 : 0.75}\n      />\n    );\n  });\n\n  return (\n    <div className=\"relative h-full cursor-pointer overflow-hidden\">\n      <svg\n        ref={ref}\n        style={{width: numberOfDots.length * 10}}\n        className=\"absolute -left-80 h-full fill-current\"\n        xmlns=\"http://www.w3.org/2000/svg\"\n        aria-hidden=\"true\"\n        focusable=\"false\"\n      >\n        {circles}\n      </svg>\n    </div>\n  );\n});\n","import React, {useEffect} from 'react';\nimport {CropPresetBtns} from './crop-preset-btns';\nimport {TransformWidget} from '../../../transform/ui/transform-widget';\nimport {state, tools} from '../../../../state/utils';\n\nexport function CropNav() {\n  useEffect(() => {\n    state().setDirty(true);\n    tools().frame.active.hide();\n    return () => {\n      tools().frame.active.show();\n    };\n  }, []);\n\n  return (\n    <div className=\"pb-16\">\n      <div className=\"mb-10\">\n        <TransformWidget />\n      </div>\n      <CropPresetBtns />\n    </div>\n  );\n}\n","import React from 'react';\nimport {createSvgIcon} from '../../common/icons/create-svg-icon';\n\nexport const CustomEllipseIcon = createSvgIcon(\n  <path d=\"M 16 6 C 12.484375 6 9.273438 7.070313 6.90625 8.84375 C 4.539063 10.617188 3 13.15625 3 16 C 3 18.84375 4.539063 21.382813 6.90625 23.15625 C 9.273438 24.929688 12.484375 26 16 26 C 19.515625 26 22.726563 24.929688 25.09375 23.15625 C 27.460938 21.382813 29 18.84375 29 16 C 29 13.15625 27.460938 10.617188 25.09375 8.84375 C 22.726563 7.070313 19.515625 6 16 6 Z M 16 8 C 19.109375 8 21.898438 8.957031 23.875 10.4375 C 25.851563 11.917969 27 13.875 27 16 C 27 18.125 25.851563 20.082031 23.875 21.5625 C 21.898438 23.042969 19.109375 24 16 24 C 12.890625 24 10.101563 23.042969 8.125 21.5625 C 6.148438 20.082031 5 18.125 5 16 C 5 13.875 6.148438 11.917969 8.125 10.4375 C 10.101563 8.957031 12.890625 8 16 8 Z \" />\n);\n","import React from 'react';\nimport {createSvgIcon} from '../../common/icons/create-svg-icon';\n\nexport const CustomCircleIcon = createSvgIcon(\n  <path d=\"M 16 4 C 9.382813 4 4 9.382813 4 16 C 4 22.617188 9.382813 28 16 28 C 22.617188 28 28 22.617188 28 16 C 28 9.382813 22.617188 4 16 4 Z M 16 6 C 21.535156 6 26 10.464844 26 16 C 26 21.535156 21.535156 26 16 26 C 10.464844 26 6 21.535156 6 16 C 6 10.464844 10.464844 6 16 6 Z \" />\n);\n","import React from 'react';\nimport {createSvgIcon} from '../../common/icons/create-svg-icon';\n\nexport const CustomSquareIcon = createSvgIcon(\n  <path d=\"M 3 6 L 3 26 L 29 26 L 29 6 Z M 5 8 L 27 8 L 27 24 L 5 24 Z \" />\n);\n","import React from 'react';\nimport {createSvgIcon} from '../../common/icons/create-svg-icon';\n\nexport const CustomTriangleIcon = createSvgIcon(\n  <path d=\"M 16 4.90625 L 15.125 6.40625 L 4.71875 24.5 L 3.875 26 L 28.125 26 L 27.28125 24.5 L 16.875 6.40625 Z M 16 8.9375 L 24.65625 24 L 7.34375 24 Z \" />\n);\n","import React, {ReactElement} from 'react';\nimport {useStore} from '../../../state/store';\nimport {BasicShape, PathOptions} from '../../../config/default-shapes';\nimport {\n  ScrollableView,\n  ScrollableViewItem,\n} from '../../../ui/navbar/scrollable-view';\nimport {IconButton} from '../../../common/ui/buttons/icon-button';\nimport {CustomEllipseIcon} from '../../../ui/icons/ellipse';\nimport {CustomCircleIcon} from '../../../ui/icons/circle';\nimport {CustomSquareIcon} from '../../../ui/icons/square';\nimport {CustomTriangleIcon} from '../../../ui/icons/triangle';\nimport {state, tools} from '../../../state/utils';\n\nexport function ShapeNav() {\n  const shapes = useStore(s => s.config.tools?.shapes?.items) || [];\n  const shapeBtns = shapes.map(shape => {\n    return (\n      <ScrollableViewItem key={shape.name}>\n        <IconButton\n          variant=\"outline\"\n          radius=\"rounded-2xl\"\n          size=\"xl\"\n          onClick={() => {\n            tools().shape.addBasicShape(shape.name);\n            state().setDirty(true);\n          }}\n        >\n          <ShapeIcon shape={shape} />\n        </IconButton>\n      </ScrollableViewItem>\n    );\n  });\n  return <ScrollableView>{shapeBtns}</ScrollableView>;\n}\n\ntype ShapeIconProps = {\n  shape: BasicShape;\n};\n\nfunction ShapeIcon({shape}: ShapeIconProps) {\n  if (shape.type === 'Path') {\n    return (\n      <svg\n        className=\"m-auto w-36 h-36\"\n        xmlns=\"http://www.w3.org/2000/svg\"\n        viewBox=\"0 -100 512 700\"\n      >\n        <path\n          className=\"fill-transparent stroke-current\"\n          d={(shape.options as PathOptions)?.path}\n          strokeWidth={25}\n        />\n      </svg>\n    );\n  }\n  return React.cloneElement(shapeIconMap[shape.name], {className: 'w-30 h-30'});\n}\n\nconst shapeIconMap: Record<string, ReactElement> = {\n  circle: <CustomCircleIcon viewBox=\"0 0 32 32\" />,\n  square: <CustomSquareIcon viewBox=\"0 0 32 32\" />,\n  triangle: <CustomTriangleIcon viewBox=\"0 0 32 32\" />,\n  ellipse: <CustomEllipseIcon viewBox=\"0 0 32 32\" />,\n};\n","/**\n * react-virtual\n *\n * Copyright (c) TanStack\n *\n * This source code is licensed under the MIT license found in the\n * LICENSE.md file in the root directory of this source tree.\n *\n * @license MIT\n */\nimport * as React from 'react';\n\n/**\n * virtual-core\n *\n * Copyright (c) TanStack\n *\n * This source code is licensed under the MIT license found in the\n * LICENSE.md file in the root directory of this source tree.\n *\n * @license MIT\n */\nfunction memo(getDeps, fn, opts) {\n  let deps = [];\n  let result;\n  return () => {\n    let depTime;\n    if (opts.key && opts.debug != null && opts.debug()) depTime = Date.now();\n    const newDeps = getDeps();\n    const depsChanged = newDeps.length !== deps.length || newDeps.some((dep, index) => deps[index] !== dep);\n\n    if (!depsChanged) {\n      return result;\n    }\n\n    deps = newDeps;\n    let resultTime;\n    if (opts.key && opts.debug != null && opts.debug()) resultTime = Date.now();\n    result = fn(...newDeps);\n    opts == null ? void 0 : opts.onChange == null ? void 0 : opts.onChange(result);\n\n    if (opts.key && opts.debug != null && opts.debug()) {\n      const depEndTime = Math.round((Date.now() - depTime) * 100) / 100;\n      const resultEndTime = Math.round((Date.now() - resultTime) * 100) / 100;\n      const resultFpsPercentage = resultEndTime / 16;\n\n      const pad = (str, num) => {\n        str = String(str);\n\n        while (str.length < num) {\n          str = ' ' + str;\n        }\n\n        return str;\n      };\n\n      console.info(\"%c\\u23F1 \" + pad(resultEndTime, 5) + \" /\" + pad(depEndTime, 5) + \" ms\", \"\\n            font-size: .6rem;\\n            font-weight: bold;\\n            color: hsl(\" + Math.max(0, Math.min(120 - 120 * resultFpsPercentage, 120)) + \"deg 100% 31%);\", opts == null ? void 0 : opts.key);\n    }\n\n    return result;\n  };\n}\n\n//\nconst defaultKeyExtractor = index => index;\nconst defaultRangeExtractor = range => {\n  const start = Math.max(range.startIndex - range.overscan, 0);\n  const end = Math.min(range.endIndex + range.overscan, range.count - 1);\n  const arr = [];\n\n  for (let i = start; i <= end; i++) {\n    arr.push(i);\n  }\n\n  return arr;\n};\n\nconst memoRectCallback = (instance, cb) => {\n  let prev = {\n    height: -1,\n    width: -1\n  };\n  return rect => {\n    if (instance.options.horizontal ? rect.width !== prev.width : rect.height !== prev.height) {\n      cb(rect);\n    }\n\n    prev = rect;\n  };\n};\n\nconst observeElementRect = (instance, cb) => {\n  const observer = new ResizeObserver(entries => {\n    var _entries$, _entries$2;\n\n    cb({\n      width: (_entries$ = entries[0]) == null ? void 0 : _entries$.contentRect.width,\n      height: (_entries$2 = entries[0]) == null ? void 0 : _entries$2.contentRect.height\n    });\n  });\n\n  if (!instance.scrollElement) {\n    return;\n  }\n\n  cb(instance.scrollElement.getBoundingClientRect());\n  observer.observe(instance.scrollElement);\n  return () => {\n    observer.unobserve(instance.scrollElement);\n  };\n};\nconst observeWindowRect = (instance, cb) => {\n  const memoizedCallback = memoRectCallback(instance, cb);\n\n  const onResize = () => memoizedCallback({\n    width: instance.scrollElement.innerWidth,\n    height: instance.scrollElement.innerHeight\n  });\n\n  if (!instance.scrollElement) {\n    return;\n  }\n\n  onResize();\n  instance.scrollElement.addEventListener('resize', onResize, {\n    capture: false,\n    passive: true\n  });\n  return () => {\n    instance.scrollElement.removeEventListener('resize', onResize);\n  };\n};\nconst scrollProps = {\n  element: ['scrollLeft', 'scrollTop'],\n  window: ['scrollX', 'scrollY']\n};\n\nconst createOffsetObserver = mode => {\n  return (instance, cb) => {\n    if (!instance.scrollElement) {\n      return;\n    }\n\n    const propX = scrollProps[mode][0];\n    const propY = scrollProps[mode][1];\n    let prevX = instance.scrollElement[propX];\n    let prevY = instance.scrollElement[propY];\n\n    const scroll = () => {\n      cb(instance.scrollElement[instance.options.horizontal ? propX : propY]);\n    };\n\n    scroll();\n\n    const onScroll = e => {\n      const target = e.currentTarget;\n      const scrollX = target[propX];\n      const scrollY = target[propY];\n\n      if (instance.options.horizontal ? prevX - scrollX : prevY - scrollY) {\n        scroll();\n      }\n\n      prevX = scrollX;\n      prevY = scrollY;\n    };\n\n    instance.scrollElement.addEventListener('scroll', onScroll, {\n      capture: false,\n      passive: true\n    });\n    return () => {\n      instance.scrollElement.removeEventListener('scroll', onScroll);\n    };\n  };\n};\n\nconst observeElementOffset = createOffsetObserver('element');\nconst observeWindowOffset = createOffsetObserver('window');\nconst measureElement = (element, instance) => {\n  return element.getBoundingClientRect()[instance.options.horizontal ? 'width' : 'height'];\n};\nconst windowScroll = (offset, canSmooth, instance) => {\n  var _instance$scrollEleme;\n  (_instance$scrollEleme = instance.scrollElement) == null ? void 0 : _instance$scrollEleme.scrollTo == null ? void 0 : _instance$scrollEleme.scrollTo({\n    [instance.options.horizontal ? 'left' : 'top']: offset,\n    behavior: canSmooth ? 'smooth' : undefined\n  });\n};\nconst elementScroll = (offset, canSmooth, instance) => {\n  var _instance$scrollEleme2;\n  (_instance$scrollEleme2 = instance.scrollElement) == null ? void 0 : _instance$scrollEleme2.scrollTo == null ? void 0 : _instance$scrollEleme2.scrollTo({\n    [instance.options.horizontal ? 'left' : 'top']: offset,\n    behavior: canSmooth ? 'smooth' : undefined\n  });\n};\nclass Virtualizer {\n  constructor(_opts) {\n    var _this = this;\n\n    this.unsubs = [];\n    this.scrollElement = null;\n    this.measurementsCache = [];\n    this.itemMeasurementsCache = {};\n    this.pendingMeasuredCacheIndexes = [];\n    this.measureElementCache = {};\n    this.range = {\n      startIndex: 0,\n      endIndex: 0\n    };\n\n    this.setOptions = opts => {\n      Object.entries(opts).forEach(_ref => {\n        let [key, value] = _ref;\n        if (typeof value === 'undefined') delete opts[key];\n      });\n      this.options = {\n        debug: false,\n        initialOffset: 0,\n        overscan: 1,\n        paddingStart: 0,\n        paddingEnd: 0,\n        scrollPaddingStart: 0,\n        scrollPaddingEnd: 0,\n        horizontal: false,\n        getItemKey: defaultKeyExtractor,\n        rangeExtractor: defaultRangeExtractor,\n        enableSmoothScroll: true,\n        onChange: () => {},\n        measureElement,\n        initialRect: {\n          width: 0,\n          height: 0\n        },\n        ...opts\n      };\n    };\n\n    this.notify = () => {\n      var _this$options$onChang, _this$options;\n\n      (_this$options$onChang = (_this$options = this.options).onChange) == null ? void 0 : _this$options$onChang.call(_this$options, this);\n    };\n\n    this.cleanup = () => {\n      this.unsubs.filter(Boolean).forEach(d => d());\n      this.unsubs = [];\n      this.scrollElement = null;\n    };\n\n    this._didMount = () => {\n      return () => {\n        this.cleanup();\n      };\n    };\n\n    this._willUpdate = () => {\n      const scrollElement = this.options.getScrollElement();\n\n      if (this.scrollElement !== scrollElement) {\n        this.cleanup();\n        this.scrollElement = scrollElement;\n\n        this._scrollToOffset(this.scrollOffset, false);\n\n        this.unsubs.push(this.options.observeElementRect(this, rect => {\n          this.scrollRect = rect;\n          this.calculateRange();\n        }));\n        this.unsubs.push(this.options.observeElementOffset(this, offset => {\n          this.scrollOffset = offset;\n          this.calculateRange();\n        }));\n      }\n    };\n\n    this.getSize = () => {\n      return this.scrollRect[this.options.horizontal ? 'width' : 'height'];\n    };\n\n    this.getMeasurements = memo(() => [this.options.count, this.options.paddingStart, this.options.getItemKey, this.itemMeasurementsCache], (count, paddingStart, getItemKey, measurementsCache) => {\n      const min = this.pendingMeasuredCacheIndexes.length > 0 ? Math.min(...this.pendingMeasuredCacheIndexes) : 0;\n      this.pendingMeasuredCacheIndexes = [];\n      const measurements = this.measurementsCache.slice(0, min);\n\n      for (let i = min; i < count; i++) {\n        const key = getItemKey(i);\n        const measuredSize = measurementsCache[key];\n        const start = measurements[i - 1] ? measurements[i - 1].end : paddingStart;\n        const size = typeof measuredSize === 'number' ? measuredSize : this.options.estimateSize(i);\n        const end = start + size;\n        measurements[i] = {\n          index: i,\n          start,\n          size,\n          end,\n          key\n        };\n      }\n\n      this.measurementsCache = measurements;\n      return measurements;\n    }, {\n      key: process.env.NODE_ENV !== 'production' && 'getMeasurements',\n      debug: () => this.options.debug\n    });\n    this.calculateRange = memo(() => [this.getMeasurements(), this.getSize(), this.scrollOffset], (measurements, outerSize, scrollOffset) => {\n      const range = calculateRange({\n        measurements,\n        outerSize,\n        scrollOffset\n      });\n\n      if (range.startIndex !== this.range.startIndex || range.endIndex !== this.range.endIndex) {\n        this.range = range;\n        this.notify();\n      }\n\n      return this.range;\n    }, {\n      key: process.env.NODE_ENV !== 'production' && 'calculateRange',\n      debug: () => this.options.debug\n    });\n    this.getIndexes = memo(() => [this.options.rangeExtractor, this.range, this.options.overscan, this.options.count], (rangeExtractor, range, overscan, count) => {\n      return rangeExtractor({ ...range,\n        overscan,\n        count: count\n      });\n    }, {\n      key: process.env.NODE_ENV !== 'production' && 'getIndexes',\n      debug: () => this.options.debug\n    });\n    this.getVirtualItems = memo(() => [this.getIndexes(), this.getMeasurements(), this.options.measureElement], (indexes, measurements, measureElement) => {\n      const makeMeasureElement = index => measurableItem => {\n        var _this$itemMeasurement;\n\n        const item = this.measurementsCache[index];\n\n        if (!measurableItem) {\n          return;\n        }\n\n        const measuredItemSize = measureElement(measurableItem, this);\n        const itemSize = (_this$itemMeasurement = this.itemMeasurementsCache[item.key]) != null ? _this$itemMeasurement : item.size;\n\n        if (measuredItemSize !== itemSize) {\n          if (item.start < this.scrollOffset) {\n            if (process.env.NODE_ENV !== 'production' && this.options.debug) {\n              console.info('correction', measuredItemSize - itemSize);\n            }\n\n            if (!this.destinationOffset) {\n              this._scrollToOffset(this.scrollOffset + (measuredItemSize - itemSize), false);\n            }\n          }\n\n          this.pendingMeasuredCacheIndexes.push(index);\n          this.itemMeasurementsCache = { ...this.itemMeasurementsCache,\n            [item.key]: measuredItemSize\n          };\n          this.notify();\n        }\n      };\n\n      const virtualItems = [];\n      const currentMeasureElements = {};\n\n      for (let k = 0, len = indexes.length; k < len; k++) {\n        var _this$measureElementC;\n\n        const i = indexes[k];\n        const measurement = measurements[i];\n        const item = { ...measurement,\n          measureElement: currentMeasureElements[i] = (_this$measureElementC = this.measureElementCache[i]) != null ? _this$measureElementC : makeMeasureElement(i)\n        };\n        virtualItems.push(item);\n      }\n\n      this.measureElementCache = currentMeasureElements;\n      return virtualItems;\n    }, {\n      key: process.env.NODE_ENV !== 'production' && 'getIndexes',\n      debug: () => this.options.debug\n    });\n\n    this.scrollToOffset = function (toOffset, _temp) {\n      let {\n        align = 'start',\n        smoothScroll = _this.options.enableSmoothScroll\n      } = _temp === void 0 ? {} : _temp;\n      const offset = _this.scrollOffset;\n\n      const size = _this.getSize();\n\n      if (align === 'auto') {\n        if (toOffset <= offset) {\n          align = 'start';\n        } else if (toOffset >= offset + size) {\n          align = 'end';\n        } else {\n          align = 'start';\n        }\n      }\n\n      if (align === 'start') {\n        _this._scrollToOffset(toOffset, smoothScroll);\n      } else if (align === 'end') {\n        _this._scrollToOffset(toOffset - size, smoothScroll);\n      } else if (align === 'center') {\n        _this._scrollToOffset(toOffset - size / 2, smoothScroll);\n      }\n    };\n\n    this.scrollToIndex = function (index, _temp2) {\n      let {\n        align = 'auto',\n        smoothScroll = _this.options.enableSmoothScroll,\n        ...rest\n      } = _temp2 === void 0 ? {} : _temp2;\n\n      const measurements = _this.getMeasurements();\n\n      const offset = _this.scrollOffset;\n\n      const size = _this.getSize();\n\n      const {\n        count\n      } = _this.options;\n      const measurement = measurements[Math.max(0, Math.min(index, count - 1))];\n\n      if (!measurement) {\n        return;\n      }\n\n      if (align === 'auto') {\n        if (measurement.end >= offset + size - _this.options.scrollPaddingEnd) {\n          align = 'end';\n        } else if (measurement.start <= offset + _this.options.scrollPaddingStart) {\n          align = 'start';\n        } else {\n          return;\n        }\n      }\n\n      const toOffset = align === 'end' ? measurement.end + _this.options.scrollPaddingEnd : measurement.start - _this.options.scrollPaddingStart;\n\n      _this.scrollToOffset(toOffset, {\n        align,\n        smoothScroll,\n        ...rest\n      });\n    };\n\n    this.getTotalSize = () => {\n      var _this$getMeasurements;\n\n      return (((_this$getMeasurements = this.getMeasurements()[this.options.count - 1]) == null ? void 0 : _this$getMeasurements.end) || this.options.paddingStart) + this.options.paddingEnd;\n    };\n\n    this._scrollToOffset = (offset, canSmooth) => {\n      clearTimeout(this.scrollCheckFrame);\n      this.destinationOffset = offset;\n      this.options.scrollToFn(offset, canSmooth, this);\n      let scrollCheckFrame;\n\n      const check = () => {\n        let lastOffset = this.scrollOffset;\n        this.scrollCheckFrame = scrollCheckFrame = setTimeout(() => {\n          if (this.scrollCheckFrame !== scrollCheckFrame) {\n            return;\n          }\n\n          if (this.scrollOffset === lastOffset) {\n            this.destinationOffset = undefined;\n            return;\n          }\n\n          lastOffset = this.scrollOffset;\n          check();\n        }, 100);\n      };\n\n      check();\n    };\n\n    this.measure = () => {\n      this.itemMeasurementsCache = {};\n      this.notify();\n    };\n\n    this.setOptions(_opts);\n    this.scrollRect = this.options.initialRect;\n    this.scrollOffset = this.options.initialOffset;\n    this.calculateRange();\n  }\n\n}\n\nconst findNearestBinarySearch = (low, high, getCurrentValue, value) => {\n  while (low <= high) {\n    const middle = (low + high) / 2 | 0;\n    const currentValue = getCurrentValue(middle);\n\n    if (currentValue < value) {\n      low = middle + 1;\n    } else if (currentValue > value) {\n      high = middle - 1;\n    } else {\n      return middle;\n    }\n  }\n\n  if (low > 0) {\n    return low - 1;\n  } else {\n    return 0;\n  }\n};\n\nfunction calculateRange(_ref2) {\n  let {\n    measurements,\n    outerSize,\n    scrollOffset\n  } = _ref2;\n  const count = measurements.length - 1;\n\n  const getOffset = index => measurements[index].start;\n\n  const startIndex = findNearestBinarySearch(0, count, getOffset, scrollOffset);\n  let endIndex = startIndex;\n\n  while (endIndex < count && measurements[endIndex].end < scrollOffset + outerSize) {\n    endIndex++;\n  }\n\n  return {\n    startIndex,\n    endIndex\n  };\n}\n\nconst useIsomorphicLayoutEffect = typeof window !== 'undefined' ? React.useLayoutEffect : React.useEffect;\n\nfunction useVirtualizerBase(options) {\n  const rerender = React.useReducer(() => ({}), {})[1];\n  const resolvedOptions = { ...options,\n    onChange: instance => {\n      rerender();\n      options.onChange == null ? void 0 : options.onChange(instance);\n    }\n  };\n  const [instance] = React.useState(() => new Virtualizer(resolvedOptions));\n  instance.setOptions(resolvedOptions);\n  React.useEffect(() => {\n    return instance._didMount();\n  }, []);\n  useIsomorphicLayoutEffect(() => {\n    return instance._willUpdate();\n  });\n  return instance;\n}\n\nfunction useVirtualizer(options) {\n  return useVirtualizerBase({\n    observeElementRect: observeElementRect,\n    observeElementOffset: observeElementOffset,\n    scrollToFn: elementScroll,\n    ...options\n  });\n}\nfunction useWindowVirtualizer(options) {\n  return useVirtualizerBase({\n    getScrollElement: () => typeof window !== 'undefined' ? window : null,\n    observeElementRect: observeWindowRect,\n    observeElementOffset: observeWindowOffset,\n    scrollToFn: windowScroll,\n    ...options\n  });\n}\n\nexport { Virtualizer, defaultKeyExtractor, defaultRangeExtractor, elementScroll, measureElement, memo, observeElementOffset, observeElementRect, observeWindowOffset, observeWindowRect, useVirtualizer, useWindowVirtualizer, windowScroll };\n//# sourceMappingURL=index.js.map\n","import {useStore} from '../state/store';\n\nexport function useActiveTheme() {\n  const activeTheme = useStore(s => s.config.ui?.activeTheme);\n  return useStore(s =>\n    (s.config.ui?.themes || []).find(t => t.name === activeTheme)\n  );\n}\n","import React, {Fragment, useCallback, useEffect, useRef} from 'react';\nimport clsx from 'clsx';\nimport {StickerCategory} from '../../../../config/default-stickers';\nimport {stickerUrl} from '../../shape-tool';\nimport {Button} from '../../../../common/ui/buttons/button';\nimport {state, tools} from '../../../../state/utils';\nimport {useVirtualizer} from '@tanstack/react-virtual';\nimport {useActiveTheme} from '../../../../utils/use-active-theme';\n\ntype Props = {\n  category: StickerCategory;\n};\n\nexport function StickerList({category}: Props) {\n  const activeTheme = useActiveTheme();\n  const name = category.name;\n  const iterable = category.list\n    ? category.list\n    : Array.from(Array(category.items).keys());\n\n  const parentRef = useRef<HTMLDivElement>(null);\n\n  const virtualizer = useVirtualizer({\n    horizontal: true,\n    count: iterable.length,\n    getScrollElement: () => parentRef.current,\n    estimateSize: useCallback(() => 52, []),\n    overscan: 5,\n  });\n\n  useEffect(() => {\n    virtualizer.scrollToIndex(0);\n    // don't add virtualizer to deps, otherwise there will be infinite rerender\n    // eslint-disable-next-line\n  }, [name]);\n\n  return (\n    <Fragment>\n      <div\n        ref={parentRef}\n        className=\"tiny-scrollbar overflow-x-auto overflow-y-hidden\"\n        style={{height: `52px`}}\n      >\n        <div\n          className=\"h-full relative mx-auto\"\n          style={{width: `${virtualizer.getTotalSize()}px`}}\n        >\n          {virtualizer.getVirtualItems().map(virtualColumn => {\n            const stickerName = `${iterable[virtualColumn.index]}`;\n            return (\n              <div\n                key={virtualColumn.index}\n                className=\"absolute top-0 left-0 h-full\"\n                style={{\n                  width: `${virtualColumn.size}px`,\n                  transform: `translateX(${virtualColumn.start}px)`,\n                }}\n              >\n                <Button\n                  variant=\"outline\"\n                  radius=\"rounded-xl\"\n                  size=\"md\"\n                  equalWidth\n                  onClick={async () => {\n                    await tools().shape.addSticker(category.name, stickerName);\n                    state().setDirty(true);\n                  }}\n                >\n                  <img\n                    className={clsx(\n                      'm-auto m-auto w-28 h-28',\n                      category.invertPreview && activeTheme?.isDark && 'invert'\n                    )}\n                    src={stickerUrl(category, stickerName)}\n                    alt={stickerName}\n                  />\n                </Button>\n              </div>\n            );\n          })}\n        </div>\n      </div>\n    </Fragment>\n  );\n}\n","import {useState} from 'react';\nimport {useStore} from '../../../../state/store';\nimport {\n  StickerCategory,\n  StickerCategoryMessages,\n} from '../../../../config/default-stickers';\nimport {ButtonGroup} from '../../../../common/ui/buttons/button-group';\nimport {Button} from '../../../../common/ui/buttons/button';\nimport {StickerList} from './sticker-list';\nimport {Trans} from '../../../../common/i18n/trans';\n\nexport function StickerNav() {\n  const categories = useStore(s => s.config.tools?.stickers?.items) || [];\n  const [selectedCategory, setSelectedCategory] =\n    useState<StickerCategory | null>(categories[0]);\n\n  const categoryBtns = categories.map(category => {\n    const isSelected = selectedCategory === category;\n    const msg = StickerCategoryMessages[category.name];\n    return (\n      <Button\n        key={category.name}\n        size=\"xs\"\n        color={isSelected ? 'primary' : null}\n        value={category}\n      >\n        <span className=\"capitalize\">\n          {msg ? <Trans {...msg} /> : category.name}\n        </span>\n      </Button>\n    );\n  });\n\n  return (\n    <div className=\"h-92\">\n      <ButtonGroup\n        value={selectedCategory}\n        onChange={newCategory => setSelectedCategory(newCategory)}\n        className=\"mb-10 w-full justify-center\"\n        variant=\"outline\"\n        radius=\"rounded-full\"\n      >\n        {categoryBtns}\n      </ButtonGroup>\n      {selectedCategory && <StickerList category={selectedCategory} />}\n    </div>\n  );\n}\n","import {useEffect} from 'react';\nimport {\n  ScrollableView,\n  ScrollableViewItem,\n} from '../../../ui/navbar/scrollable-view';\nimport {useStore} from '../../../state/store';\nimport {state, tools} from '../../../state/utils';\nimport {assetUrl} from '../../../utils/asset-url';\nimport {CancelIcon} from '../../../common/icons/material/Cancel';\n\nexport function FrameNav() {\n  const frames = useStore(s => s.config.tools?.frame?.items) || [];\n  const activeFrame = useStore(s => s.frame.active);\n\n  // open options' panel if not open already\n  useEffect(() => {\n    if (state().frame.active) {\n      state().frame.showOptionsPanel();\n    }\n  }, []);\n\n  const frameItems = frames.map(frame => {\n    const src = assetUrl(`images/frames/${frame.name}/thumbnail.png`);\n    const isActive = activeFrame?.name === frame.name;\n    const activeClass = isActive ? 'border-primary' : '';\n    return (\n      <ScrollableViewItem key={frame.name}>\n        <button\n          type=\"button\"\n          className={`border-2 overflow-hidden relative rounded border cursor-pointer ${activeClass}`}\n          onClick={() => {\n            state().setDirty(true);\n            if (isActive) {\n              tools().frame.remove();\n            } else {\n              tools().frame.add(frame.name);\n            }\n          }}\n        >\n          {isActive && <ActiveOverlay />}\n          <img\n            draggable=\"false\"\n            className=\"w-64 h-64\"\n            src={src}\n            alt={frame.name}\n          />\n        </button>\n      </ScrollableViewItem>\n    );\n  });\n  return <ScrollableView>{frameItems}</ScrollableView>;\n}\n\nfunction ActiveOverlay() {\n  return (\n    <span className=\"bg-background/70 absolute inset-0 text-primary\">\n      <CancelIcon className=\"svg-icon icon-md absolute inset-0 block m-auto\" />\n    </span>\n  );\n}\n","import {useEffect} from 'react';\nimport clsx from 'clsx';\nimport {\n  ScrollableView,\n  ScrollableViewItem,\n} from '../../../ui/navbar/scrollable-view';\nimport {useStore} from '../../../state/store';\nimport {loadFonts} from '../../../common/ui/font-picker/load-fonts';\nimport {FontFaceConfig} from '../../../common/ui/font-picker/font-face-config';\nimport {state, tools} from '../../../state/utils';\nimport {assetUrl} from '../../../utils/asset-url';\n\nexport function TextNav() {\n  const fonts = useStore(s => s.config.tools?.text?.items);\n\n  // load fonts into dom\n  useEffect(() => {\n    if (fonts) {\n      loadFonts(fonts, assetUrl).catch(() => {});\n    }\n  }, [fonts]);\n\n  // add text to canvas on text nav open\n  useEffect(() => {\n    const addedText = tools().text.selectOrAddText();\n    if (addedText) {\n      state().setDirty(true);\n    }\n  }, []);\n\n  const fontButtons = (fonts || []).map(fontConfig => {\n    return (\n      <ScrollableViewItem key={fontConfig.family}>\n        <FontButton fontConfig={fontConfig} />\n      </ScrollableViewItem>\n    );\n  });\n\n  return <ScrollableView className=\"pt-6\">{fontButtons}</ScrollableView>;\n}\n\ntype FontButtonProps = {\n  fontConfig: FontFaceConfig;\n};\n\nfunction FontButton({fontConfig}: FontButtonProps) {\n  const selectedFont = useStore(s => s.objects.active.editableProps.fontFamily);\n\n  const className = clsx(\n    'block px-6 w-110 h-68 text-sm bg border rounded-2xl',\n    {\n      'border-primary': selectedFont === fontConfig.family,\n      'text-primary': selectedFont === fontConfig.family,\n    }\n  );\n\n  return (\n    <button\n      type=\"button\"\n      className={className}\n      style={{\n        fontFamily: fontConfig.family,\n        fontWeight: fontConfig.descriptors?.weight || 'normal',\n      }}\n      onClick={async () => {\n        tools().text.selectOrAddText();\n        state().setDirty(true);\n        tools().objects.setValues({\n          fontFamily: fontConfig.family,\n        });\n      }}\n    >\n      {fontConfig.family}\n    </button>\n  );\n}\n","import React, {useEffect, useState} from 'react';\nimport {ColorPickerButton} from '../../../ui/color-picker-button';\nimport {useStore} from '../../../state/store';\nimport {tools} from '../../../state/utils';\nimport {assetUrl} from '../../../utils/asset-url';\nimport {\n  ScrollableView,\n  ScrollableViewItem,\n} from '../../../ui/navbar/scrollable-view';\nimport {Trans} from '../../../common/i18n/trans';\nimport {Select} from '../../../common/ui/forms/select/select';\nimport {Item} from '../../../common/ui/forms/listbox/item';\nimport {useActiveTheme} from '../../../utils/use-active-theme';\n\nexport function DrawNav() {\n  useEffect(() => {\n    tools().draw.enable();\n    return () => {\n      tools().draw.disable();\n    };\n  }, []);\n\n  return (\n    <ScrollableView gap=\"gap-16\" className=\"justify-center\">\n      <ScrollableViewItem>\n        <ColorPickerButton\n          size=\"sm\"\n          label={<Trans message=\"Brush Color\" />}\n          value={tools().draw.currentBrush.color}\n          onChange={newColor => {\n            tools().draw.setBrushColor(newColor);\n          }}\n        />\n      </ScrollableViewItem>\n      <ScrollableViewItem>\n        <TypeSelect />\n      </ScrollableViewItem>\n      <ScrollableViewItem>\n        <SizeSelect />\n      </ScrollableViewItem>\n    </ScrollableView>\n  );\n}\n\nfunction SizeSelect() {\n  const sizes = useStore(s => s.config.tools?.draw?.brushSizes) || [];\n  const [selectedSize, setSelectedSize] = useState(\n    tools().draw.currentBrush.width\n  );\n  return (\n    <Select\n      selectionMode=\"single\"\n      selectedValue={selectedSize}\n      onSelectionChange={newValue => {\n        setSelectedSize(newValue as number);\n        tools().draw.setBrushSize(newValue as number);\n      }}\n      size=\"sm\"\n      label=\"Brush Size\"\n    >\n      {sizes.map(size => (\n        <Item key={size} value={size}>\n          <div className=\"flex items-center\">\n            <div\n              className=\"flex-shrink-0 mr-8 border-[3px] rounded-full\"\n              style={{width: `${size}px`, height: `${size}px`}}\n            />\n            {size}\n          </div>\n        </Item>\n      ))}\n    </Select>\n  );\n}\n\nfunction TypeSelect() {\n  const types = useStore(s => s.config.tools?.draw?.brushTypes) || [];\n  const activeTheme = useActiveTheme();\n  const [selectedType, setSelectedType] = useState(\n    tools().draw.currentBrush.type\n  );\n\n  return (\n    <Select\n      selectionMode=\"single\"\n      selectedValue={selectedType}\n      onSelectionChange={value => {\n        setSelectedType(value as string);\n        tools().draw.setBrushType(value as string);\n      }}\n      size=\"sm\"\n      label=\"Brush Type\"\n    >\n      {types.map(type => (\n        <Item key={type} value={type}>\n          <div className=\"flex items-center\">\n            <img\n              className=\"flex-shrink-0 mr-8 w-24 h-24\"\n              src={getBrushPreview(type, activeTheme?.isDark)}\n              alt=\"\"\n            />\n            {type}\n          </div>\n        </Item>\n      ))}\n    </Select>\n  );\n}\n\nfunction getBrushPreview(type: string, isDarkMode = false): string {\n  const name = type.replace('Brush', '').toLowerCase();\n  const dir = isDarkMode ? 'white' : 'black';\n  return assetUrl(`images/brushes/${dir}/${name}.png`);\n}\n","import {useEffect} from 'react';\nimport {useStore} from '../../../state/store';\nimport {state, tools} from '../../../state/utils';\nimport {Slider} from '../../../common/ui/forms/slider/slider';\nimport {useTrans} from '../../../common/i18n/use-trans';\n\nexport function CornersNav() {\n  const {trans} = useTrans();\n  const radius = useStore(s => s.corners.radius);\n\n  useEffect(() => {\n    state().setDirty(true);\n    tools().corners.showPreview();\n    return () => tools().corners.hidePreview();\n  }, []);\n\n  return (\n    <div className=\"max-w-320 mx-auto\">\n      <Slider\n        minValue={1}\n        maxValue={300}\n        label={trans({message: 'Radius'})}\n        getValueLabel={value => {\n          return `${value}px`;\n        }}\n        onChange={val => {\n          tools().corners.updatePreview(val);\n          state().corners.setRadius(val);\n        }}\n        value={radius}\n      />\n    </div>\n  );\n}\n","import {HTMLMotionProps} from 'framer-motion';\n\nexport const navbarAnimation: HTMLMotionProps<'div'> = {\n  initial: {y: '130%', opacity: 0},\n  animate: {y: 0, opacity: 1},\n  exit: {\n    y: '130%',\n    opacity: 0,\n    left: 0,\n    position: 'absolute',\n    overflowY: 'hidden',\n  },\n  transition: {type: 'tween', duration: 0.15},\n};\n","import React from 'react';\nimport {m} from 'framer-motion';\nimport {ToolName} from '../../tools/tool-name';\nimport {FilterNav} from '../../tools/filter/ui/filter-nav';\nimport {ResizeNav} from '../../tools/resize/ui/resize-nav';\nimport {CropNav} from '../../tools/crop/ui/crop-nav/crop-nav';\nimport {ShapeNav} from '../../tools/shapes/ui/shape-nav';\nimport {StickerNav} from '../../tools/shapes/ui/sticker-nav/sticker-nav';\nimport {FrameNav} from '../../tools/frame/ui/frame-nav';\nimport {TextNav} from '../../tools/text/ui/text-nav';\nimport {DrawNav} from '../../tools/draw/ui/draw-nav';\nimport {CornersNav} from '../../tools/corners/ui/corners-nav';\nimport {navbarAnimation} from './navbar-animation';\n\ntype Props = {\n  activeTool: ToolName | null;\n};\n\nexport function ToolControls({activeTool}: Props) {\n  const toolNav = getToolNav(activeTool);\n\n  return (\n    <m.div\n      className=\"relative h-full w-full text-sm bg select-none overflow-hidden\"\n      {...navbarAnimation}\n    >\n      {toolNav}\n    </m.div>\n  );\n}\n\nfunction getToolNav(activeTool: ToolName | null) {\n  switch (activeTool) {\n    case ToolName.FILTER:\n      return <FilterNav />;\n    case ToolName.RESIZE:\n      return <ResizeNav />;\n    case ToolName.CROP:\n      return <CropNav />;\n    case ToolName.DRAW:\n      return <DrawNav />;\n    case ToolName.TEXT:\n      return <TextNav />;\n    case ToolName.SHAPES:\n      return <ShapeNav />;\n    case ToolName.STICKERS:\n      return <StickerNav />;\n    case ToolName.FRAME:\n      return <FrameNav />;\n    case ToolName.CORNERS:\n      return <CornersNav />;\n    default:\n      return null;\n  }\n}\n","import {AnimatePresence, m} from 'framer-motion';\nimport React from 'react';\nimport {useStore} from '../../state/store';\nimport {NavItem} from '../../config/default-config';\nimport {setActiveTool} from './set-active-tool';\nimport {ToolControls} from './tool-controls';\nimport {ButtonBase} from '../../common/ui/buttons/button-base';\nimport {navbarAnimation} from './navbar-animation';\nimport {navItemMessages} from '../../config/default-nav-items';\nimport {state} from '../../state/utils';\nimport {ScrollableView, ScrollableViewItem} from './scrollable-view';\nimport {MixedIcon} from '../mixed-icon';\nimport {Trans} from '../../common/i18n/trans';\nimport clsx from 'clsx';\n\ninterface NavbarProps {\n  className?: string;\n}\nexport function Navbar({className}: NavbarProps) {\n  const activeTool = useStore(s => s.activeTool);\n  return (\n    <nav\n      className={clsx(\n        'z-navbar min-h-86 flex-shrink-0 px-16 relative overflow-hidden',\n        className\n      )}\n    >\n      <AnimatePresence initial={false}>\n        {activeTool ? (\n          <ToolControls activeTool={activeTool} key=\"tool-controls\" />\n        ) : (\n          <NavItems key=\"nav-items\" />\n        )}\n      </AnimatePresence>\n    </nav>\n  );\n}\n\nfunction NavItems() {\n  const navItems = useStore(s => s.config.ui?.nav?.items) || [];\n  return (\n    <m.div className=\"w-full h-full\" {...navbarAnimation}>\n      <ScrollableView>\n        {navItems.map(item => (\n          <ScrollableViewItem key={item.name}>\n            <ToolButton item={item} />\n          </ScrollableViewItem>\n        ))}\n      </ScrollableView>\n    </m.div>\n  );\n}\n\ntype ToolButtonProps = {\n  item: NavItem;\n};\n\nfunction ToolButton({item}: ToolButtonProps) {\n  const clickHandler = () => {\n    if (typeof item.action === 'string') {\n      setActiveTool(item.action);\n    } else if (typeof item.action === 'function') {\n      item.action(state().editor);\n    }\n  };\n  const msg = navItemMessages[item.name];\n  return (\n    <ButtonBase\n      variant=\"outline\"\n      color=\"paper\"\n      className=\"flex-col flex-shrink-0 w-68 h-68\"\n      radius=\"rounded-2xl\"\n      onClick={clickHandler}\n    >\n      <div className=\"mb-1\">\n        <MixedIcon className=\"icon-md\" icon={item.icon} />\n      </div>\n      <div className=\"mt-6 text-xs capitalize max-w-[90%] overflow-hidden overflow-ellipsis\">\n        {msg ? <Trans {...msg} /> : item.name}\n      </div>\n    </ButtonBase>\n  );\n}\n","import React from 'react';\nimport {m} from 'framer-motion';\nimport clsx from 'clsx';\nimport {useStore} from '../../../state/store';\nimport {Button} from '../../../common/ui/buttons/button';\nimport {HISTORY_DISPLAY_NAMES} from '../history-display-names';\nimport {IconButton} from '../../../common/ui/buttons/icon-button';\nimport {state, tools} from '../../../state/utils';\nimport {CloseIcon} from '../../../common/icons/material/Close';\nimport {PopoverAnimation} from '../../../common/ui/overlays/popover-animation';\nimport {Trans} from '../../../common/i18n/trans';\n\nexport function HistoryPanel() {\n  const items = useStore(s => s.history.items);\n  const pointer = useStore(s => s.history.pointer);\n\n  return (\n    <m.div\n      {...PopoverAnimation}\n      className={`absolute bottom-20 right-20 w-224 max-w-[calc(100%-40px)] max-h-[calc(100%-40px)] bg-paper shadow-xl border focus:outline-none rounded overflow-hidden`}\n    >\n      <div className=\"px-10 py-2 mb-4 font-medium text-sm border-b flex items-center\">\n        <Trans message=\"History\" />\n        <IconButton\n          size=\"xs\"\n          className=\"ml-auto flex-shrink-0\"\n          onClick={() => {\n            state().togglePanel('history', false);\n          }}\n        >\n          <CloseIcon />\n        </IconButton>\n      </div>\n      <div className=\"p-10\">\n        {items.map(item => {\n          const isActive = item.id === items[pointer].id;\n          const displayName = HISTORY_DISPLAY_NAMES[item.name];\n          const startIcon =\n            displayName.icon &&\n            React.createElement(displayName.icon, {className: 'icon-sm'});\n          return (\n            <Button\n              onClick={() => {\n                if (isActive) return;\n                tools().history.load(item);\n              }}\n              variant=\"outline\"\n              color={isActive ? 'primary' : null}\n              size=\"sm\"\n              className={clsx('w-full mb-8', isActive && 'pointer-events-none')}\n              justify=\"justify-start\"\n              key={item.id}\n              startIcon={startIcon}\n            >\n              <Trans {...displayName.name} />\n            </Button>\n          );\n        })}\n      </div>\n    </m.div>\n  );\n}\n","import React, {ReactNode, useContext} from 'react';\nimport clsx from 'clsx';\nimport {DialogContext} from './dialog-context';\nimport {IconButton} from '../../buttons/icon-button';\nimport {CloseIcon} from '../../../icons/material/Close';\nimport {DialogSize} from './dialog';\n\ninterface DialogHeaderProps {\n  children: ReactNode;\n  className?: string;\n  color?: string | null;\n  onDismiss?: () => void;\n  hideDismissButton?: boolean;\n  leftAdornment?: ReactNode;\n  rightAdornment?: ReactNode;\n  size?: DialogSize;\n  padding?: string;\n  showDivider?: boolean;\n}\nexport function DialogHeader(props: DialogHeaderProps) {\n  const {\n    children,\n    className,\n    color,\n    onDismiss,\n    leftAdornment,\n    rightAdornment,\n    hideDismissButton = false,\n    size,\n    showDivider,\n  } = props;\n  const {labelId, isDismissable, close} = useContext(DialogContext);\n\n  return (\n    <div\n      className={clsx(\n        className,\n        'flex items-center justify-between gap-10 flex-shrink-0',\n        showDivider && 'border-b',\n        getPadding(props),\n        color || 'text-main'\n      )}\n    >\n      {leftAdornment}\n      <h3\n        id={labelId}\n        className={clsx(\n          className,\n          size === 'xs' ? 'text-xs' : 'text-sm',\n          'font-semibold leading-5 opacity-90'\n        )}\n      >\n        {children}\n      </h3>\n      {rightAdornment}\n      {isDismissable && !hideDismissButton && (\n        <IconButton\n          aria-label=\"Dismiss\"\n          onClick={() => {\n            if (onDismiss) {\n              onDismiss();\n            } else {\n              close();\n            }\n          }}\n          size={size === 'xs' ? 'xs' : 'sm'}\n          className={clsx('text-muted ml-auto', rightAdornment && 'sr-only')}\n        >\n          <CloseIcon />\n        </IconButton>\n      )}\n    </div>\n  );\n}\n\nfunction getPadding({size, padding}: DialogHeaderProps) {\n  if (padding) {\n    return padding;\n  }\n  switch (size) {\n    case 'xs':\n      return 'px-14 py-4';\n    case 'sm':\n      return 'px-18 py-4';\n    default:\n      return 'px-24 py-6';\n  }\n}\n","import React, {forwardRef, ReactNode} from 'react';\nimport clsx from 'clsx';\nimport {DialogSize} from './dialog';\n\ninterface DialogBodyProps {\n  children: ReactNode;\n  className?: string;\n  padding?: string;\n  size?: DialogSize;\n}\nexport const DialogBody = forwardRef<HTMLDivElement, DialogBodyProps>(\n  (props, ref) => {\n    const {children, className} = props;\n    return (\n      <div\n        ref={ref}\n        className={clsx(\n          className,\n          getPadding(props),\n          'overflow-y-auto overflow-x-hidden text-sm'\n        )}\n      >\n        {children}\n      </div>\n    );\n  }\n);\n\nfunction getPadding({size, padding}: DialogBodyProps) {\n  if (padding) {\n    return padding;\n  }\n  switch (size) {\n    case 'xs':\n      return 'p-14';\n    case 'sm':\n      return 'p-18';\n    default:\n      return 'px-24 py-20';\n  }\n}\n","import React, {useState} from 'react';\nimport {Button} from '../common/ui/buttons/button';\nimport {useStore} from '../state/store';\nimport {Dialog} from '../common/ui/overlays/dialog/dialog';\nimport {DialogHeader} from '../common/ui/overlays/dialog/dialog-header';\nimport {DialogBody} from '../common/ui/overlays/dialog/dialog-body';\nimport {ColorPickerButton} from './color-picker-button';\nimport {state, tools} from '../state/utils';\nimport {fetchStateJsonFromUrl} from '../tools/import/fetch-state-json-from-url';\nimport {assetUrl} from '../utils/asset-url';\nimport {DialogTrigger} from '../common/ui/overlays/dialog/dialog-trigger';\nimport {Trans} from '../common/i18n/trans';\nimport {TextField} from '../common/ui/forms/input-field/text-field/text-field';\n\ntype ActivePanel = 'default' | 'newCanvas';\n\nexport function NewImageDialogTrigger() {\n  const isOpen = useStore(s => s.openPanels.newImage);\n  return (\n    <DialogTrigger\n      isOpen={isOpen}\n      disableInitialTransition\n      type=\"modal\"\n      isDismissable={false}\n    >\n      <NewImageDialog />\n    </DialogTrigger>\n  );\n}\n\nfunction NewImageDialog() {\n  const [activePanel, setActivePanel] = useState<ActivePanel>('default');\n\n  return (\n    <Dialog className=\"text-center max-w-max\" size=\"auto\">\n      <DialogHeader padding=\"px-24 pt-24 pb-12\" showDivider={false}>\n        <Trans message=\"Open a photo or design to get started\" />\n      </DialogHeader>\n      <DialogBody>\n        {activePanel === 'default' ? (\n          <DefaultPanel setActivePanel={setActivePanel} />\n        ) : (\n          <NewCanvasPanel setActivePanel={setActivePanel} />\n        )}\n      </DialogBody>\n    </Dialog>\n  );\n}\n\ntype PanelProps = {\n  setActivePanel: (panel: ActivePanel) => void;\n};\n\nfunction DefaultPanel({setActivePanel}: PanelProps) {\n  return (\n    <>\n      <Button\n        className=\"mr-20\"\n        size=\"sm\"\n        variant=\"raised\"\n        color=\"primary\"\n        onClick={() => {\n          tools().import.uploadAndReplaceMainImage();\n        }}\n      >\n        <Trans message=\"Open Photo\" />\n      </Button>\n      <Button\n        variant=\"outline\"\n        size=\"sm\"\n        color=\"primary\"\n        onClick={() => {\n          setActivePanel('newCanvas');\n        }}\n      >\n        <Trans message=\"Create New\" />\n      </Button>\n      <SampleImagesPanel />\n    </>\n  );\n}\n\nfunction SampleImagesPanel() {\n  const sampleImages = useStore(\n    s => s.config.ui?.openImageDialog?.sampleImages\n  );\n  if (!sampleImages?.length) return null;\n  return (\n    <>\n      <div className=\"relative py-20\">\n        <hr className=\"absolute h-1 border-none bg-divider w-full top inset-0 m-auto\" />\n        <span className=\"text-sm bg-paper px-6 relative\">\n          <Trans message=\"or use sample\" />\n        </span>\n      </div>\n      <ul className=\"flex items-center gap-16\">\n        {sampleImages.map(img => (\n          <li className=\"shrink-0\" key={img.url || img.thumbnail}>\n            <button\n              type=\"button\"\n              onClick={async () => {\n                if (typeof img.action === 'function') {\n                  img.action();\n                } else if (img.url.endsWith('.json')) {\n                  await fetchStateJsonFromUrl(assetUrl(img.url));\n                  state().togglePanel('newImage', false);\n                } else {\n                  await tools().import.openBackgroundImage(assetUrl(img.url));\n                  state().togglePanel('newImage', false);\n                }\n              }}\n            >\n              <img\n                className=\"w-80 h-80 rounded overflow-hidden transition-shadow hover:shadow-md\"\n                src={assetUrl(img.thumbnail)}\n                alt=\"\"\n              />\n            </button>\n          </li>\n        ))}\n      </ul>\n    </>\n  );\n}\n\nfunction NewCanvasPanel({setActivePanel}: PanelProps) {\n  const [formVal, setFormVal] = useState<{\n    width: number;\n    height: number;\n    bgColor: string;\n  }>({\n    width: 800,\n    height: 600,\n    bgColor: 'transparent',\n  });\n\n  return (\n    <form\n      onSubmit={e => {\n        e.preventDefault();\n        const {width, height, bgColor} = formVal;\n        if (width && height) {\n          state().setConfig({blankCanvasSize: {width, height}});\n          tools().canvas.openNew(width, height, bgColor);\n          state().togglePanel('newImage', false);\n          tools().history.addInitial();\n        }\n      }}\n    >\n      <TextField\n        type=\"number\"\n        label={<Trans message=\"Width\" />}\n        value={formVal.width}\n        min={1}\n        required\n        className=\"mb-16\"\n        onChange={e => {\n          setFormVal({...formVal, width: e.target.valueAsNumber});\n        }}\n      />\n      <TextField\n        type=\"number\"\n        label={<Trans message=\"Height\" />}\n        value={formVal.height}\n        min={1}\n        required\n        className=\"mb-16\"\n        onChange={e => {\n          setFormVal({...formVal, height: e.target.valueAsNumber});\n        }}\n      />\n      <ColorPickerButton\n        onChange={newColor => {\n          setFormVal({...formVal, bgColor: newColor});\n        }}\n        className=\"mb-16\"\n        value={formVal.bgColor}\n        label={<Trans message=\"Background color\" />}\n      />\n      <div className=\"text-right\">\n        <Button\n          size=\"sm\"\n          variant=\"text\"\n          className=\"mr-10\"\n          onClick={() => {\n            setActivePanel('default');\n          }}\n        >\n          <Trans message=\"Cancel\" />\n        </Button>\n        <Button size=\"sm\" type=\"submit\" variant=\"raised\" color=\"primary\">\n          <Trans message=\"Create\" />\n        </Button>\n      </div>\n    </form>\n  );\n}\n","import {\n  Children,\n  cloneElement,\n  forwardRef,\n  isValidElement,\n  ReactNode,\n  useId,\n} from 'react';\nimport clsx from 'clsx';\nimport {useController} from 'react-hook-form';\nimport {Orientation} from '../orientation';\nimport {RadioProps} from './radio';\nimport {getInputFieldClassNames} from '../input-field/get-input-field-class-names';\n\nexport interface RadioGroupProps {\n  children: ReactNode;\n  orientation?: Orientation;\n  size?: 'xs' | 'sm' | 'md' | 'lg';\n  className?: string;\n  label?: ReactNode;\n  disabled?: boolean;\n  name?: string;\n  errorMessage?: ReactNode;\n  description?: ReactNode;\n  invalid?: boolean;\n  required?: boolean;\n}\nexport const RadioGroup = forwardRef<HTMLFieldSetElement, RadioGroupProps>(\n  (props, ref) => {\n    const style = getInputFieldClassNames(props);\n    const {\n      label,\n      children,\n      size,\n      className,\n      orientation = 'horizontal',\n      disabled,\n      required,\n      invalid,\n      errorMessage,\n      description,\n    } = props;\n\n    const labelProps = {};\n    const id = useId();\n    const name = props.name || id;\n\n    return (\n      <fieldset\n        aria-describedby={description ? `${id}-description` : undefined}\n        ref={ref}\n        className={clsx('text-left', className)}\n      >\n        {label && (\n          <legend className={style.label} {...labelProps}>\n            {label}\n          </legend>\n        )}\n        <div\n          className={clsx(\n            'flex',\n            orientation === 'vertical' ? 'flex-col gap-10' : 'flex-row gap-16'\n          )}\n        >\n          {Children.map(children, child => {\n            if (isValidElement<RadioProps>(child)) {\n              return cloneElement<RadioProps>(child, {\n                name,\n                size,\n                invalid: child.props.invalid || invalid || undefined,\n                disabled: child.props.disabled || disabled,\n                required: child.props.required || required,\n              });\n            }\n          })}\n        </div>\n        {description && !errorMessage && (\n          <div className={style.description} id={`${id}-description`}>\n            {description}\n          </div>\n        )}\n        {errorMessage && <div className={style.error}>{errorMessage}</div>}\n      </fieldset>\n    );\n  }\n);\n\ninterface FormRadioGroupProps extends RadioGroupProps {\n  name: string;\n}\nexport function FormRadioGroup({children, ...props}: FormRadioGroupProps) {\n  const {\n    fieldState: {error},\n  } = useController({\n    name: props.name!,\n  });\n  return (\n    <RadioGroup errorMessage={error?.message} {...props}>\n      {children}\n    </RadioGroup>\n  );\n}\n","import React, {ComponentPropsWithoutRef, forwardRef} from 'react';\nimport clsx from 'clsx';\nimport {mergeProps, useObjectRef} from '@react-aria/utils';\nimport {useController} from 'react-hook-form';\nimport {AutoFocusProps, useAutoFocus} from '../../focus/use-auto-focus';\n\ntype RadioSize = 'xs' | 'sm' | 'md' | 'lg' | undefined;\n\nexport interface RadioProps\n  extends AutoFocusProps,\n    Omit<ComponentPropsWithoutRef<'input'>, 'size'> {\n  size?: RadioSize;\n  value: string;\n  invalid?: boolean;\n  isFirst?: boolean;\n}\nexport const Radio = forwardRef<HTMLInputElement, RadioProps>((props, ref) => {\n  const {children, autoFocus, size, invalid, isFirst, ...domProps} = props;\n\n  const inputRef = useObjectRef(ref);\n  useAutoFocus({autoFocus}, inputRef);\n\n  const sizeClassNames = getSizeClassNames(size);\n\n  return (\n    <label\n      className={clsx(\n        'inline-flex gap-8 select-none items-center whitespace-nowrap align-middle',\n        sizeClassNames.label,\n        props.disabled && 'text-disabled pointer-events-none',\n        props.invalid && 'text-danger'\n      )}\n    >\n      <input\n        type=\"radio\"\n        className={clsx(\n          'focus-visible:ring outline-none',\n          'rounded-full transition-button border-2 appearance-none',\n          'border-text-muted disabled:border-disabled-fg checked:border-primary checked:hover:border-primary-dark',\n          'before:bg-primary disabled:before:bg-disabled-fg before:hover:bg-primary-dark',\n          'before:h-full before:w-full before:block before:rounded-full before:scale-10 before:opacity-0 before:transition before:duration-200',\n          'checked:before:scale-[.65] checked:before:opacity-100',\n          sizeClassNames.circle\n        )}\n        ref={inputRef}\n        {...domProps}\n      />\n      {children && <span>{children}</span>}\n    </label>\n  );\n});\n\nexport function FormRadio(props: RadioProps) {\n  const {\n    field: {onChange, onBlur, value, ref},\n    fieldState: {invalid},\n  } = useController({\n    name: props.name!,\n  });\n\n  const formProps: Partial<RadioProps> = {\n    onChange,\n    onBlur,\n    checked: props.value === value,\n    invalid: props.invalid || invalid,\n  };\n\n  return <Radio ref={ref} {...mergeProps(formProps, props)} />;\n}\n\nfunction getSizeClassNames(size?: RadioSize): {\n  circle: string;\n  label: string;\n} {\n  switch (size) {\n    case 'xs':\n      return {circle: 'h-12 w-12', label: 'text-xs'};\n    case 'sm':\n      return {circle: 'h-16 w-16', label: 'text-sm'};\n    case 'lg':\n      return {circle: 'h-24 w-24', label: 'text-lg'};\n    default:\n      return {circle: 'h-20 w-20', label: 'text-base'};\n  }\n}\n","import React, {useState} from 'react';\nimport {useStore} from '../../state/store';\nimport {Dialog} from '../../common/ui/overlays/dialog/dialog';\nimport {DialogBody} from '../../common/ui/overlays/dialog/dialog-body';\nimport {state, tools} from '../../state/utils';\nimport {Button} from '../../common/ui/buttons/button';\nimport {RadioGroup} from '../../common/ui/forms/radio-group/radio-group';\nimport {Slider} from '../../common/ui/forms/slider/slider';\nimport {Radio} from '../../common/ui/forms/radio-group/radio';\nimport {DialogTrigger} from '../../common/ui/overlays/dialog/dialog-trigger';\nimport {TextField} from '../../common/ui/forms/input-field/text-field/text-field';\nimport {Trans} from '../../common/i18n/trans';\n\nexport function ExportDialogTrigger() {\n  const isOpen = useStore(s => s.openPanels.export);\n  return (\n    <DialogTrigger\n      isOpen={isOpen}\n      onOpenChange={visible => {\n        if (!visible) {\n          state().togglePanel('export', false);\n        }\n      }}\n      type=\"modal\"\n    >\n      <ExportDialog />\n    </DialogTrigger>\n  );\n}\n\nfunction ExportDialog() {\n  const [formVal, setFormVal] = useState(() => {\n    return {\n      filename: state().config.tools?.export?.defaultName || 'image',\n      format: state().config.tools?.export?.defaultFormat || 'jpeg',\n      quality: state().config.tools?.export?.defaultQuality || 0.8,\n    };\n  });\n  return (\n    <Dialog className=\"text-center max-w-max\" size=\"auto\">\n      <DialogBody>\n        <form\n          onSubmit={e => {\n            e.preventDefault();\n            tools().export.save(\n              formVal.filename,\n              formVal.format,\n              formVal.quality\n            );\n            state().togglePanel('export', false);\n          }}\n        >\n          <TextField\n            required\n            size=\"sm\"\n            label={<Trans message=\"Save As\" />}\n            value={formVal.filename}\n            onChange={e => {\n              setFormVal({...formVal, filename: e.target.value});\n            }}\n          />\n          <RadioGroup size=\"sm\" className=\"my-20\" aria-label=\"Image format\">\n            <Radio\n              value=\"jpeg\"\n              checked={formVal.format === 'jpeg'}\n              onChange={e => {\n                setFormVal({...formVal, format: e.target.value as 'jpeg'});\n              }}\n            >\n              JPEG\n            </Radio>\n            <Radio\n              value=\"png\"\n              checked={formVal.format === 'png'}\n              onChange={e => {\n                setFormVal({...formVal, format: e.target.value as 'png'});\n              }}\n            >\n              PNG\n            </Radio>\n            <Radio\n              value=\"json\"\n              checked={formVal.format === 'json'}\n              onChange={e => {\n                setFormVal({...formVal, format: e.target.value as 'json'});\n              }}\n            >\n              JSON\n            </Radio>\n          </RadioGroup>\n          <Slider\n            size=\"sm\"\n            minValue={0.1}\n            step={0.1}\n            maxValue={1}\n            value={formVal.quality}\n            onChange={quality => {\n              setFormVal({...formVal, quality});\n            }}\n            formatOptions={{style: 'percent'}}\n            label={<Trans message=\"Quality\" />}\n          />\n          <Button\n            variant=\"raised\"\n            color=\"primary\"\n            type=\"submit\"\n            className=\"mt-20 w-full\"\n            size=\"sm\"\n          >\n            <Trans message=\"Save\" />\n          </Button>\n        </form>\n      </DialogBody>\n    </Dialog>\n  );\n}\n","import {m} from 'framer-motion';\nimport clsx from 'clsx';\nimport React from 'react';\nimport {useStore} from '../../state/store';\nimport {IconButton} from '../../common/ui/buttons/icon-button';\nimport {state, tools} from '../../state/utils';\nimport {CloseIcon} from '../../common/icons/material/Close';\nimport {Button} from '../../common/ui/buttons/button';\nimport {OBJ_DISPLAY_NAMES, ObjectName} from '../object-name';\nimport {PopoverAnimation} from '../../common/ui/overlays/popover-animation';\nimport {Trans} from '../../common/i18n/trans';\n\nexport function ObjListPanel() {\n  const objects = useStore(s => s.objects.all);\n  const activeId = useStore(s => s.objects.active.id);\n\n  return (\n    <m.div\n      {...PopoverAnimation}\n      className={`absolute bottom-20 right-20 w-224 max-w-[calc(100%-40px)] max-h-[calc(100%-40px)] bg-paper shadow-xl border focus:outline-none rounded overflow-hidden`}\n    >\n      <div className=\"px-10 py-2 mb-4 font-medium text-sm border-b flex items-center\">\n        <Trans message=\"Objects\" />\n        <IconButton\n          size=\"xs\"\n          className=\"ml-auto flex-shrink-0\"\n          onClick={() => {\n            state().togglePanel('objects', false);\n          }}\n        >\n          <CloseIcon />\n        </IconButton>\n      </div>\n      <div className=\"p-8\">\n        {objects.map(obj => {\n          const isActive = obj.id === activeId;\n          const objName = obj.name as Exclude<\n            ObjectName,\n            ObjectName.StraightenAnchor\n          >;\n          const displayName = OBJ_DISPLAY_NAMES[objName];\n          const startIcon =\n            displayName.icon &&\n            React.createElement(displayName.icon, {className: 'icon-sm'});\n          return (\n            <Button\n              onClick={() => {\n                if (isActive || !obj.selectable) return;\n                tools().objects.select(obj.id);\n              }}\n              variant=\"outline\"\n              color={isActive ? 'primary' : null}\n              size=\"sm\"\n              className={clsx(\n                'w-full mb-8',\n                (isActive || !obj.selectable) && 'pointer-events-none'\n              )}\n              justify=\"justify-start\"\n              key={obj.id}\n              startIcon={startIcon}\n            >\n              <Trans {...displayName.name} />\n            </Button>\n          );\n        })}\n      </div>\n    </m.div>\n  );\n}\n","import React from 'react';\nimport {AnimatePresence} from 'framer-motion';\nimport {useStore} from '../state/store';\nimport {HistoryPanel} from '../tools/history/ui/history-panel';\nimport {NewImageDialogTrigger} from './new-image-dialog';\nimport {ExportDialogTrigger} from '../tools/export/export-dialog-trigger';\nimport {ObjListPanel} from '../objects/ui/obj-list-panel';\n\nexport function OverlayPanelContainer() {\n  const historyVisible = useStore(s => s.openPanels.history);\n  const objectsVisible = useStore(s => s.openPanels.objects);\n  return (\n    <div className=\"z-modal\">\n      <AnimatePresence>\n        {historyVisible && <HistoryPanel key=\"historyPanel\" />}\n        {objectsVisible && <ObjListPanel key=\"objListPanel\" />}\n      </AnimatePresence>\n      <NewImageDialogTrigger />\n      <ExportDialogTrigger />\n    </div>\n  );\n}\n","/**\n * @remix-run/router v1.0.1\n *\n * Copyright (c) Remix Software Inc.\n *\n * This source code is licensed under the MIT license found in the\n * LICENSE.md file in the root directory of this source tree.\n *\n * @license MIT\n */\nfunction _extends() {\n  _extends = Object.assign ? Object.assign.bind() : function (target) {\n    for (var i = 1; i < arguments.length; i++) {\n      var source = arguments[i];\n\n      for (var key in source) {\n        if (Object.prototype.hasOwnProperty.call(source, key)) {\n          target[key] = source[key];\n        }\n      }\n    }\n\n    return target;\n  };\n  return _extends.apply(this, arguments);\n}\n\n////////////////////////////////////////////////////////////////////////////////\n//#region Types and Constants\n////////////////////////////////////////////////////////////////////////////////\n\n/**\n * Actions represent the type of change to a location value.\n */\nvar Action;\n\n(function (Action) {\n  /**\n   * A POP indicates a change to an arbitrary index in the history stack, such\n   * as a back or forward navigation. It does not describe the direction of the\n   * navigation, only that the current index changed.\n   *\n   * Note: This is the default action for newly created history objects.\n   */\n  Action[\"Pop\"] = \"POP\";\n  /**\n   * A PUSH indicates a new entry being added to the history stack, such as when\n   * a link is clicked and a new page loads. When this happens, all subsequent\n   * entries in the stack are lost.\n   */\n\n  Action[\"Push\"] = \"PUSH\";\n  /**\n   * A REPLACE indicates the entry at the current index in the history stack\n   * being replaced by a new one.\n   */\n\n  Action[\"Replace\"] = \"REPLACE\";\n})(Action || (Action = {}));\n\nconst PopStateEventType = \"popstate\";\n/**\n * Memory history stores the current location in memory. It is designed for use\n * in stateful non-browser environments like tests and React Native.\n */\n\nfunction createMemoryHistory(options) {\n  if (options === void 0) {\n    options = {};\n  }\n\n  let {\n    initialEntries = [\"/\"],\n    initialIndex,\n    v5Compat = false\n  } = options;\n  let entries; // Declare so we can access from createMemoryLocation\n\n  entries = initialEntries.map((entry, index) => createMemoryLocation(entry, typeof entry === \"string\" ? null : entry.state, index === 0 ? \"default\" : undefined));\n  let index = clampIndex(initialIndex == null ? entries.length - 1 : initialIndex);\n  let action = Action.Pop;\n  let listener = null;\n\n  function clampIndex(n) {\n    return Math.min(Math.max(n, 0), entries.length - 1);\n  }\n\n  function getCurrentLocation() {\n    return entries[index];\n  }\n\n  function createMemoryLocation(to, state, key) {\n    if (state === void 0) {\n      state = null;\n    }\n\n    let location = createLocation(entries ? getCurrentLocation().pathname : \"/\", to, state, key);\n    warning$1(location.pathname.charAt(0) === \"/\", \"relative pathnames are not supported in memory history: \" + JSON.stringify(to));\n    return location;\n  }\n\n  let history = {\n    get index() {\n      return index;\n    },\n\n    get action() {\n      return action;\n    },\n\n    get location() {\n      return getCurrentLocation();\n    },\n\n    createHref(to) {\n      return typeof to === \"string\" ? to : createPath(to);\n    },\n\n    push(to, state) {\n      action = Action.Push;\n      let nextLocation = createMemoryLocation(to, state);\n      index += 1;\n      entries.splice(index, entries.length, nextLocation);\n\n      if (v5Compat && listener) {\n        listener({\n          action,\n          location: nextLocation\n        });\n      }\n    },\n\n    replace(to, state) {\n      action = Action.Replace;\n      let nextLocation = createMemoryLocation(to, state);\n      entries[index] = nextLocation;\n\n      if (v5Compat && listener) {\n        listener({\n          action,\n          location: nextLocation\n        });\n      }\n    },\n\n    go(delta) {\n      action = Action.Pop;\n      index = clampIndex(index + delta);\n\n      if (listener) {\n        listener({\n          action,\n          location: getCurrentLocation()\n        });\n      }\n    },\n\n    listen(fn) {\n      listener = fn;\n      return () => {\n        listener = null;\n      };\n    }\n\n  };\n  return history;\n}\n/**\n * Browser history stores the location in regular URLs. This is the standard for\n * most web apps, but it requires some configuration on the server to ensure you\n * serve the same app at multiple URLs.\n *\n * @see https://github.com/remix-run/history/tree/main/docs/api-reference.md#createbrowserhistory\n */\n\nfunction createBrowserHistory(options) {\n  if (options === void 0) {\n    options = {};\n  }\n\n  function createBrowserLocation(window, globalHistory) {\n    let {\n      pathname,\n      search,\n      hash\n    } = window.location;\n    return createLocation(\"\", {\n      pathname,\n      search,\n      hash\n    }, // state defaults to `null` because `window.history.state` does\n    globalHistory.state && globalHistory.state.usr || null, globalHistory.state && globalHistory.state.key || \"default\");\n  }\n\n  function createBrowserHref(window, to) {\n    return typeof to === \"string\" ? to : createPath(to);\n  }\n\n  return getUrlBasedHistory(createBrowserLocation, createBrowserHref, null, options);\n}\n/**\n * Hash history stores the location in window.location.hash. This makes it ideal\n * for situations where you don't want to send the location to the server for\n * some reason, either because you do cannot configure it or the URL space is\n * reserved for something else.\n *\n * @see https://github.com/remix-run/history/tree/main/docs/api-reference.md#createhashhistory\n */\n\nfunction createHashHistory(options) {\n  if (options === void 0) {\n    options = {};\n  }\n\n  function createHashLocation(window, globalHistory) {\n    let {\n      pathname = \"/\",\n      search = \"\",\n      hash = \"\"\n    } = parsePath(window.location.hash.substr(1));\n    return createLocation(\"\", {\n      pathname,\n      search,\n      hash\n    }, // state defaults to `null` because `window.history.state` does\n    globalHistory.state && globalHistory.state.usr || null, globalHistory.state && globalHistory.state.key || \"default\");\n  }\n\n  function createHashHref(window, to) {\n    let base = window.document.querySelector(\"base\");\n    let href = \"\";\n\n    if (base && base.getAttribute(\"href\")) {\n      let url = window.location.href;\n      let hashIndex = url.indexOf(\"#\");\n      href = hashIndex === -1 ? url : url.slice(0, hashIndex);\n    }\n\n    return href + \"#\" + (typeof to === \"string\" ? to : createPath(to));\n  }\n\n  function validateHashLocation(location, to) {\n    warning$1(location.pathname.charAt(0) === \"/\", \"relative pathnames are not supported in hash history.push(\" + JSON.stringify(to) + \")\");\n  }\n\n  return getUrlBasedHistory(createHashLocation, createHashHref, validateHashLocation, options);\n} //#endregion\n////////////////////////////////////////////////////////////////////////////////\n//#region UTILS\n////////////////////////////////////////////////////////////////////////////////\n\nfunction warning$1(cond, message) {\n  if (!cond) {\n    // eslint-disable-next-line no-console\n    if (typeof console !== \"undefined\") console.warn(message);\n\n    try {\n      // Welcome to debugging history!\n      //\n      // This error is thrown as a convenience so you can more easily\n      // find the source for a warning that appears in the console by\n      // enabling \"pause on exceptions\" in your JavaScript debugger.\n      throw new Error(message); // eslint-disable-next-line no-empty\n    } catch (e) {}\n  }\n}\n\nfunction createKey() {\n  return Math.random().toString(36).substr(2, 8);\n}\n/**\n * For browser-based histories, we combine the state and key into an object\n */\n\n\nfunction getHistoryState(location) {\n  return {\n    usr: location.state,\n    key: location.key\n  };\n}\n/**\n * Creates a Location object with a unique key from the given Path\n */\n\n\nfunction createLocation(current, to, state, key) {\n  if (state === void 0) {\n    state = null;\n  }\n\n  let location = _extends({\n    pathname: typeof current === \"string\" ? current : current.pathname,\n    search: \"\",\n    hash: \"\"\n  }, typeof to === \"string\" ? parsePath(to) : to, {\n    state,\n    // TODO: This could be cleaned up.  push/replace should probably just take\n    // full Locations now and avoid the need to run through this flow at all\n    // But that's a pretty big refactor to the current test suite so going to\n    // keep as is for the time being and just let any incoming keys take precedence\n    key: to && to.key || key || createKey()\n  });\n\n  return location;\n}\n/**\n * Creates a string URL path from the given pathname, search, and hash components.\n */\n\nfunction createPath(_ref) {\n  let {\n    pathname = \"/\",\n    search = \"\",\n    hash = \"\"\n  } = _ref;\n  if (search && search !== \"?\") pathname += search.charAt(0) === \"?\" ? search : \"?\" + search;\n  if (hash && hash !== \"#\") pathname += hash.charAt(0) === \"#\" ? hash : \"#\" + hash;\n  return pathname;\n}\n/**\n * Parses a string URL path into its separate pathname, search, and hash components.\n */\n\nfunction parsePath(path) {\n  let parsedPath = {};\n\n  if (path) {\n    let hashIndex = path.indexOf(\"#\");\n\n    if (hashIndex >= 0) {\n      parsedPath.hash = path.substr(hashIndex);\n      path = path.substr(0, hashIndex);\n    }\n\n    let searchIndex = path.indexOf(\"?\");\n\n    if (searchIndex >= 0) {\n      parsedPath.search = path.substr(searchIndex);\n      path = path.substr(0, searchIndex);\n    }\n\n    if (path) {\n      parsedPath.pathname = path;\n    }\n  }\n\n  return parsedPath;\n}\n\nfunction getUrlBasedHistory(getLocation, createHref, validateLocation, options) {\n  if (options === void 0) {\n    options = {};\n  }\n\n  let {\n    window = document.defaultView,\n    v5Compat = false\n  } = options;\n  let globalHistory = window.history;\n  let action = Action.Pop;\n  let listener = null;\n\n  function handlePop() {\n    action = Action.Pop;\n\n    if (listener) {\n      listener({\n        action,\n        location: history.location\n      });\n    }\n  }\n\n  function push(to, state) {\n    action = Action.Push;\n    let location = createLocation(history.location, to, state);\n    if (validateLocation) validateLocation(location, to);\n    let historyState = getHistoryState(location);\n    let url = history.createHref(location); // try...catch because iOS limits us to 100 pushState calls :/\n\n    try {\n      globalHistory.pushState(historyState, \"\", url);\n    } catch (error) {\n      // They are going to lose state here, but there is no real\n      // way to warn them about it since the page will refresh...\n      window.location.assign(url);\n    }\n\n    if (v5Compat && listener) {\n      listener({\n        action,\n        location\n      });\n    }\n  }\n\n  function replace(to, state) {\n    action = Action.Replace;\n    let location = createLocation(history.location, to, state);\n    if (validateLocation) validateLocation(location, to);\n    let historyState = getHistoryState(location);\n    let url = history.createHref(location);\n    globalHistory.replaceState(historyState, \"\", url);\n\n    if (v5Compat && listener) {\n      listener({\n        action,\n        location: location\n      });\n    }\n  }\n\n  let history = {\n    get action() {\n      return action;\n    },\n\n    get location() {\n      return getLocation(window, globalHistory);\n    },\n\n    listen(fn) {\n      if (listener) {\n        throw new Error(\"A history only accepts one active listener\");\n      }\n\n      window.addEventListener(PopStateEventType, handlePop);\n      listener = fn;\n      return () => {\n        window.removeEventListener(PopStateEventType, handlePop);\n        listener = null;\n      };\n    },\n\n    createHref(to) {\n      return createHref(window, to);\n    },\n\n    push,\n    replace,\n\n    go(n) {\n      return globalHistory.go(n);\n    }\n\n  };\n  return history;\n} //#endregion\n\nvar ResultType;\n\n(function (ResultType) {\n  ResultType[\"data\"] = \"data\";\n  ResultType[\"deferred\"] = \"deferred\";\n  ResultType[\"redirect\"] = \"redirect\";\n  ResultType[\"error\"] = \"error\";\n})(ResultType || (ResultType = {})); // Walk the route tree generating unique IDs where necessary so we are working\n// solely with AgnosticDataRouteObject's within the Router\n\n\nfunction convertRoutesToDataRoutes(routes, parentPath, allIds) {\n  if (parentPath === void 0) {\n    parentPath = [];\n  }\n\n  if (allIds === void 0) {\n    allIds = new Set();\n  }\n\n  return routes.map((route, index) => {\n    let treePath = [...parentPath, index];\n    let id = typeof route.id === \"string\" ? route.id : treePath.join(\"-\");\n    invariant(!allIds.has(id), \"Found a route id collision on id \\\"\" + id + \"\\\".  Route \" + \"id's must be globally unique within Data Router usages\");\n    allIds.add(id);\n\n    let dataRoute = _extends({}, route, {\n      id,\n      children: route.children ? convertRoutesToDataRoutes(route.children, treePath, allIds) : undefined\n    });\n\n    return dataRoute;\n  });\n}\n/**\n * Matches the given routes to a location and returns the match data.\n *\n * @see https://reactrouter.com/docs/en/v6/utils/match-routes\n */\n\nfunction matchRoutes(routes, locationArg, basename) {\n  if (basename === void 0) {\n    basename = \"/\";\n  }\n\n  let location = typeof locationArg === \"string\" ? parsePath(locationArg) : locationArg;\n  let pathname = stripBasename(location.pathname || \"/\", basename);\n\n  if (pathname == null) {\n    return null;\n  }\n\n  let branches = flattenRoutes(routes);\n  rankRouteBranches(branches);\n  let matches = null;\n\n  for (let i = 0; matches == null && i < branches.length; ++i) {\n    matches = matchRouteBranch(branches[i], pathname);\n  }\n\n  return matches;\n}\n\nfunction flattenRoutes(routes, branches, parentsMeta, parentPath) {\n  if (branches === void 0) {\n    branches = [];\n  }\n\n  if (parentsMeta === void 0) {\n    parentsMeta = [];\n  }\n\n  if (parentPath === void 0) {\n    parentPath = \"\";\n  }\n\n  routes.forEach((route, index) => {\n    let meta = {\n      relativePath: route.path || \"\",\n      caseSensitive: route.caseSensitive === true,\n      childrenIndex: index,\n      route\n    };\n\n    if (meta.relativePath.startsWith(\"/\")) {\n      invariant(meta.relativePath.startsWith(parentPath), \"Absolute route path \\\"\" + meta.relativePath + \"\\\" nested under path \" + (\"\\\"\" + parentPath + \"\\\" is not valid. An absolute child route path \") + \"must start with the combined path of all its parent routes.\");\n      meta.relativePath = meta.relativePath.slice(parentPath.length);\n    }\n\n    let path = joinPaths([parentPath, meta.relativePath]);\n    let routesMeta = parentsMeta.concat(meta); // Add the children before adding this route to the array so we traverse the\n    // route tree depth-first and child routes appear before their parents in\n    // the \"flattened\" version.\n\n    if (route.children && route.children.length > 0) {\n      invariant(route.index !== true, \"Index routes must not have child routes. Please remove \" + (\"all child routes from route path \\\"\" + path + \"\\\".\"));\n      flattenRoutes(route.children, branches, routesMeta, path);\n    } // Routes without a path shouldn't ever match by themselves unless they are\n    // index routes, so don't add them to the list of possible branches.\n\n\n    if (route.path == null && !route.index) {\n      return;\n    }\n\n    branches.push({\n      path,\n      score: computeScore(path, route.index),\n      routesMeta\n    });\n  });\n  return branches;\n}\n\nfunction rankRouteBranches(branches) {\n  branches.sort((a, b) => a.score !== b.score ? b.score - a.score // Higher score first\n  : compareIndexes(a.routesMeta.map(meta => meta.childrenIndex), b.routesMeta.map(meta => meta.childrenIndex)));\n}\n\nconst paramRe = /^:\\w+$/;\nconst dynamicSegmentValue = 3;\nconst indexRouteValue = 2;\nconst emptySegmentValue = 1;\nconst staticSegmentValue = 10;\nconst splatPenalty = -2;\n\nconst isSplat = s => s === \"*\";\n\nfunction computeScore(path, index) {\n  let segments = path.split(\"/\");\n  let initialScore = segments.length;\n\n  if (segments.some(isSplat)) {\n    initialScore += splatPenalty;\n  }\n\n  if (index) {\n    initialScore += indexRouteValue;\n  }\n\n  return segments.filter(s => !isSplat(s)).reduce((score, segment) => score + (paramRe.test(segment) ? dynamicSegmentValue : segment === \"\" ? emptySegmentValue : staticSegmentValue), initialScore);\n}\n\nfunction compareIndexes(a, b) {\n  let siblings = a.length === b.length && a.slice(0, -1).every((n, i) => n === b[i]);\n  return siblings ? // If two routes are siblings, we should try to match the earlier sibling\n  // first. This allows people to have fine-grained control over the matching\n  // behavior by simply putting routes with identical paths in the order they\n  // want them tried.\n  a[a.length - 1] - b[b.length - 1] : // Otherwise, it doesn't really make sense to rank non-siblings by index,\n  // so they sort equally.\n  0;\n}\n\nfunction matchRouteBranch(branch, pathname) {\n  let {\n    routesMeta\n  } = branch;\n  let matchedParams = {};\n  let matchedPathname = \"/\";\n  let matches = [];\n\n  for (let i = 0; i < routesMeta.length; ++i) {\n    let meta = routesMeta[i];\n    let end = i === routesMeta.length - 1;\n    let remainingPathname = matchedPathname === \"/\" ? pathname : pathname.slice(matchedPathname.length) || \"/\";\n    let match = matchPath({\n      path: meta.relativePath,\n      caseSensitive: meta.caseSensitive,\n      end\n    }, remainingPathname);\n    if (!match) return null;\n    Object.assign(matchedParams, match.params);\n    let route = meta.route;\n    matches.push({\n      // TODO: Can this as be avoided?\n      params: matchedParams,\n      pathname: joinPaths([matchedPathname, match.pathname]),\n      pathnameBase: normalizePathname(joinPaths([matchedPathname, match.pathnameBase])),\n      route\n    });\n\n    if (match.pathnameBase !== \"/\") {\n      matchedPathname = joinPaths([matchedPathname, match.pathnameBase]);\n    }\n  }\n\n  return matches;\n}\n/**\n * Returns a path with params interpolated.\n *\n * @see https://reactrouter.com/docs/en/v6/utils/generate-path\n */\n\n\nfunction generatePath(path, params) {\n  if (params === void 0) {\n    params = {};\n  }\n\n  return path.replace(/:(\\w+)/g, (_, key) => {\n    invariant(params[key] != null, \"Missing \\\":\" + key + \"\\\" param\");\n    return params[key];\n  }).replace(/(\\/?)\\*/, (_, prefix, __, str) => {\n    const star = \"*\";\n\n    if (params[star] == null) {\n      // If no splat was provided, trim the trailing slash _unless_ it's\n      // the entire path\n      return str === \"/*\" ? \"/\" : \"\";\n    } // Apply the splat\n\n\n    return \"\" + prefix + params[star];\n  });\n}\n/**\n * Performs pattern matching on a URL pathname and returns information about\n * the match.\n *\n * @see https://reactrouter.com/docs/en/v6/utils/match-path\n */\n\nfunction matchPath(pattern, pathname) {\n  if (typeof pattern === \"string\") {\n    pattern = {\n      path: pattern,\n      caseSensitive: false,\n      end: true\n    };\n  }\n\n  let [matcher, paramNames] = compilePath(pattern.path, pattern.caseSensitive, pattern.end);\n  let match = pathname.match(matcher);\n  if (!match) return null;\n  let matchedPathname = match[0];\n  let pathnameBase = matchedPathname.replace(/(.)\\/+$/, \"$1\");\n  let captureGroups = match.slice(1);\n  let params = paramNames.reduce((memo, paramName, index) => {\n    // We need to compute the pathnameBase here using the raw splat value\n    // instead of using params[\"*\"] later because it will be decoded then\n    if (paramName === \"*\") {\n      let splatValue = captureGroups[index] || \"\";\n      pathnameBase = matchedPathname.slice(0, matchedPathname.length - splatValue.length).replace(/(.)\\/+$/, \"$1\");\n    }\n\n    memo[paramName] = safelyDecodeURIComponent(captureGroups[index] || \"\", paramName);\n    return memo;\n  }, {});\n  return {\n    params,\n    pathname: matchedPathname,\n    pathnameBase,\n    pattern\n  };\n}\n\nfunction compilePath(path, caseSensitive, end) {\n  if (caseSensitive === void 0) {\n    caseSensitive = false;\n  }\n\n  if (end === void 0) {\n    end = true;\n  }\n\n  warning(path === \"*\" || !path.endsWith(\"*\") || path.endsWith(\"/*\"), \"Route path \\\"\" + path + \"\\\" will be treated as if it were \" + (\"\\\"\" + path.replace(/\\*$/, \"/*\") + \"\\\" because the `*` character must \") + \"always follow a `/` in the pattern. To get rid of this warning, \" + (\"please change the route path to \\\"\" + path.replace(/\\*$/, \"/*\") + \"\\\".\"));\n  let paramNames = [];\n  let regexpSource = \"^\" + path.replace(/\\/*\\*?$/, \"\") // Ignore trailing / and /*, we'll handle it below\n  .replace(/^\\/*/, \"/\") // Make sure it has a leading /\n  .replace(/[\\\\.*+^$?{}|()[\\]]/g, \"\\\\$&\") // Escape special regex chars\n  .replace(/:(\\w+)/g, (_, paramName) => {\n    paramNames.push(paramName);\n    return \"([^\\\\/]+)\";\n  });\n\n  if (path.endsWith(\"*\")) {\n    paramNames.push(\"*\");\n    regexpSource += path === \"*\" || path === \"/*\" ? \"(.*)$\" // Already matched the initial /, just match the rest\n    : \"(?:\\\\/(.+)|\\\\/*)$\"; // Don't include the / in params[\"*\"]\n  } else {\n    regexpSource += end ? \"\\\\/*$\" // When matching to the end, ignore trailing slashes\n    : // Otherwise, match a word boundary or a proceeding /. The word boundary restricts\n    // parent routes to matching only their own words and nothing more, e.g. parent\n    // route \"/home\" should not match \"/home2\".\n    // Additionally, allow paths starting with `.`, `-`, `~`, and url-encoded entities,\n    // but do not consume the character in the matched path so they can match against\n    // nested paths.\n    \"(?:(?=[@.~-]|%[0-9A-F]{2})|\\\\b|\\\\/|$)\";\n  }\n\n  let matcher = new RegExp(regexpSource, caseSensitive ? undefined : \"i\");\n  return [matcher, paramNames];\n}\n\nfunction safelyDecodeURIComponent(value, paramName) {\n  try {\n    return decodeURIComponent(value);\n  } catch (error) {\n    warning(false, \"The value for the URL param \\\"\" + paramName + \"\\\" will not be decoded because\" + (\" the string \\\"\" + value + \"\\\" is a malformed URL segment. This is probably\") + (\" due to a bad percent encoding (\" + error + \").\"));\n    return value;\n  }\n}\n/**\n * @private\n */\n\n\nfunction stripBasename(pathname, basename) {\n  if (basename === \"/\") return pathname;\n\n  if (!pathname.toLowerCase().startsWith(basename.toLowerCase())) {\n    return null;\n  } // We want to leave trailing slash behavior in the user's control, so if they\n  // specify a basename with a trailing slash, we should support it\n\n\n  let startIndex = basename.endsWith(\"/\") ? basename.length - 1 : basename.length;\n  let nextChar = pathname.charAt(startIndex);\n\n  if (nextChar && nextChar !== \"/\") {\n    // pathname does not start with basename/\n    return null;\n  }\n\n  return pathname.slice(startIndex) || \"/\";\n}\nfunction invariant(value, message) {\n  if (value === false || value === null || typeof value === \"undefined\") {\n    throw new Error(message);\n  }\n}\n/**\n * @private\n */\n\nfunction warning(cond, message) {\n  if (!cond) {\n    // eslint-disable-next-line no-console\n    if (typeof console !== \"undefined\") console.warn(message);\n\n    try {\n      // Welcome to debugging React Router!\n      //\n      // This error is thrown as a convenience so you can more easily\n      // find the source for a warning that appears in the console by\n      // enabling \"pause on exceptions\" in your JavaScript debugger.\n      throw new Error(message); // eslint-disable-next-line no-empty\n    } catch (e) {}\n  }\n}\n/**\n * Returns a resolved path object relative to the given pathname.\n *\n * @see https://reactrouter.com/docs/en/v6/utils/resolve-path\n */\n\nfunction resolvePath(to, fromPathname) {\n  if (fromPathname === void 0) {\n    fromPathname = \"/\";\n  }\n\n  let {\n    pathname: toPathname,\n    search = \"\",\n    hash = \"\"\n  } = typeof to === \"string\" ? parsePath(to) : to;\n  let pathname = toPathname ? toPathname.startsWith(\"/\") ? toPathname : resolvePathname(toPathname, fromPathname) : fromPathname;\n  return {\n    pathname,\n    search: normalizeSearch(search),\n    hash: normalizeHash(hash)\n  };\n}\n\nfunction resolvePathname(relativePath, fromPathname) {\n  let segments = fromPathname.replace(/\\/+$/, \"\").split(\"/\");\n  let relativeSegments = relativePath.split(\"/\");\n  relativeSegments.forEach(segment => {\n    if (segment === \"..\") {\n      // Keep the root \"\" segment so the pathname starts at /\n      if (segments.length > 1) segments.pop();\n    } else if (segment !== \".\") {\n      segments.push(segment);\n    }\n  });\n  return segments.length > 1 ? segments.join(\"/\") : \"/\";\n}\n/**\n * @private\n */\n\n\nfunction resolveTo(toArg, routePathnames, locationPathname, isPathRelative) {\n  if (isPathRelative === void 0) {\n    isPathRelative = false;\n  }\n\n  let to = typeof toArg === \"string\" ? parsePath(toArg) : _extends({}, toArg);\n  let isEmptyPath = toArg === \"\" || to.pathname === \"\";\n  let toPathname = isEmptyPath ? \"/\" : to.pathname;\n  let from; // Routing is relative to the current pathname if explicitly requested.\n  //\n  // If a pathname is explicitly provided in `to`, it should be relative to the\n  // route context. This is explained in `Note on `<Link to>` values` in our\n  // migration guide from v5 as a means of disambiguation between `to` values\n  // that begin with `/` and those that do not. However, this is problematic for\n  // `to` values that do not provide a pathname. `to` can simply be a search or\n  // hash string, in which case we should assume that the navigation is relative\n  // to the current location's pathname and *not* the route pathname.\n\n  if (isPathRelative || toPathname == null) {\n    from = locationPathname;\n  } else {\n    let routePathnameIndex = routePathnames.length - 1;\n\n    if (toPathname.startsWith(\"..\")) {\n      let toSegments = toPathname.split(\"/\"); // Each leading .. segment means \"go up one route\" instead of \"go up one\n      // URL segment\".  This is a key difference from how <a href> works and a\n      // major reason we call this a \"to\" value instead of a \"href\".\n\n      while (toSegments[0] === \"..\") {\n        toSegments.shift();\n        routePathnameIndex -= 1;\n      }\n\n      to.pathname = toSegments.join(\"/\");\n    } // If there are more \"..\" segments than parent routes, resolve relative to\n    // the root / URL.\n\n\n    from = routePathnameIndex >= 0 ? routePathnames[routePathnameIndex] : \"/\";\n  }\n\n  let path = resolvePath(to, from); // Ensure the pathname has a trailing slash if the original \"to\" had one\n\n  let hasExplicitTrailingSlash = toPathname && toPathname !== \"/\" && toPathname.endsWith(\"/\"); // Or if this was a link to the current path which has a trailing slash\n\n  let hasCurrentTrailingSlash = (isEmptyPath || toPathname === \".\") && locationPathname.endsWith(\"/\");\n\n  if (!path.pathname.endsWith(\"/\") && (hasExplicitTrailingSlash || hasCurrentTrailingSlash)) {\n    path.pathname += \"/\";\n  }\n\n  return path;\n}\n/**\n * @private\n */\n\nfunction getToPathname(to) {\n  // Empty strings should be treated the same as / paths\n  return to === \"\" || to.pathname === \"\" ? \"/\" : typeof to === \"string\" ? parsePath(to).pathname : to.pathname;\n}\n/**\n * @private\n */\n\nconst joinPaths = paths => paths.join(\"/\").replace(/\\/\\/+/g, \"/\");\n/**\n * @private\n */\n\nconst normalizePathname = pathname => pathname.replace(/\\/+$/, \"\").replace(/^\\/*/, \"/\");\n/**\n * @private\n */\n\nconst normalizeSearch = search => !search || search === \"?\" ? \"\" : search.startsWith(\"?\") ? search : \"?\" + search;\n/**\n * @private\n */\n\nconst normalizeHash = hash => !hash || hash === \"#\" ? \"\" : hash.startsWith(\"#\") ? hash : \"#\" + hash;\n/**\n * This is a shortcut for creating `application/json` responses. Converts `data`\n * to JSON and sets the `Content-Type` header.\n */\n\nconst json = function json(data, init) {\n  if (init === void 0) {\n    init = {};\n  }\n\n  let responseInit = typeof init === \"number\" ? {\n    status: init\n  } : init;\n  let headers = new Headers(responseInit.headers);\n\n  if (!headers.has(\"Content-Type\")) {\n    headers.set(\"Content-Type\", \"application/json; charset=utf-8\");\n  }\n\n  return new Response(JSON.stringify(data), _extends({}, responseInit, {\n    headers\n  }));\n};\nclass AbortedDeferredError extends Error {}\nclass DeferredData {\n  constructor(data) {\n    this.pendingKeys = new Set();\n    this.subscriber = undefined;\n    invariant(data && typeof data === \"object\" && !Array.isArray(data), \"defer() only accepts plain objects\"); // Set up an AbortController + Promise we can race against to exit early\n    // cancellation\n\n    let reject;\n    this.abortPromise = new Promise((_, r) => reject = r);\n    this.controller = new AbortController();\n\n    let onAbort = () => reject(new AbortedDeferredError(\"Deferred data aborted\"));\n\n    this.unlistenAbortSignal = () => this.controller.signal.removeEventListener(\"abort\", onAbort);\n\n    this.controller.signal.addEventListener(\"abort\", onAbort);\n    this.data = Object.entries(data).reduce((acc, _ref) => {\n      let [key, value] = _ref;\n      return Object.assign(acc, {\n        [key]: this.trackPromise(key, value)\n      });\n    }, {});\n  }\n\n  trackPromise(key, value) {\n    if (!(value instanceof Promise)) {\n      return value;\n    }\n\n    this.pendingKeys.add(key); // We store a little wrapper promise that will be extended with\n    // _data/_error props upon resolve/reject\n\n    let promise = Promise.race([value, this.abortPromise]).then(data => this.onSettle(promise, key, null, data), error => this.onSettle(promise, key, error)); // Register rejection listeners to avoid uncaught promise rejections on\n    // errors or aborted deferred values\n\n    promise.catch(() => {});\n    Object.defineProperty(promise, \"_tracked\", {\n      get: () => true\n    });\n    return promise;\n  }\n\n  onSettle(promise, key, error, data) {\n    if (this.controller.signal.aborted && error instanceof AbortedDeferredError) {\n      this.unlistenAbortSignal();\n      Object.defineProperty(promise, \"_error\", {\n        get: () => error\n      });\n      return Promise.reject(error);\n    }\n\n    this.pendingKeys.delete(key);\n\n    if (this.done) {\n      // Nothing left to abort!\n      this.unlistenAbortSignal();\n    }\n\n    const subscriber = this.subscriber;\n\n    if (error) {\n      Object.defineProperty(promise, \"_error\", {\n        get: () => error\n      });\n      subscriber && subscriber(false);\n      return Promise.reject(error);\n    }\n\n    Object.defineProperty(promise, \"_data\", {\n      get: () => data\n    });\n    subscriber && subscriber(false);\n    return data;\n  }\n\n  subscribe(fn) {\n    this.subscriber = fn;\n  }\n\n  cancel() {\n    this.controller.abort();\n    this.pendingKeys.forEach((v, k) => this.pendingKeys.delete(k));\n    let subscriber = this.subscriber;\n    subscriber && subscriber(true);\n  }\n\n  async resolveData(signal) {\n    let aborted = false;\n\n    if (!this.done) {\n      let onAbort = () => this.cancel();\n\n      signal.addEventListener(\"abort\", onAbort);\n      aborted = await new Promise(resolve => {\n        this.subscribe(aborted => {\n          signal.removeEventListener(\"abort\", onAbort);\n\n          if (aborted || this.done) {\n            resolve(aborted);\n          }\n        });\n      });\n    }\n\n    return aborted;\n  }\n\n  get done() {\n    return this.pendingKeys.size === 0;\n  }\n\n  get unwrappedData() {\n    invariant(this.data !== null && this.done, \"Can only unwrap data on initialized and settled deferreds\");\n    return Object.entries(this.data).reduce((acc, _ref2) => {\n      let [key, value] = _ref2;\n      return Object.assign(acc, {\n        [key]: unwrapTrackedPromise(value)\n      });\n    }, {});\n  }\n\n}\n\nfunction isTrackedPromise(value) {\n  return value instanceof Promise && value._tracked === true;\n}\n\nfunction unwrapTrackedPromise(value) {\n  if (!isTrackedPromise(value)) {\n    return value;\n  }\n\n  if (value._error) {\n    throw value._error;\n  }\n\n  return value._data;\n}\n\nfunction defer(data) {\n  return new DeferredData(data);\n}\n/**\n * A redirect response. Sets the status code and the `Location` header.\n * Defaults to \"302 Found\".\n */\n\nconst redirect = function redirect(url, init) {\n  if (init === void 0) {\n    init = 302;\n  }\n\n  let responseInit = init;\n\n  if (typeof responseInit === \"number\") {\n    responseInit = {\n      status: responseInit\n    };\n  } else if (typeof responseInit.status === \"undefined\") {\n    responseInit.status = 302;\n  }\n\n  let headers = new Headers(responseInit.headers);\n  headers.set(\"Location\", url);\n  return new Response(null, _extends({}, responseInit, {\n    headers\n  }));\n};\n/**\n * @private\n * Utility class we use to hold auto-unwrapped 4xx/5xx Response bodies\n */\n\nclass ErrorResponse {\n  constructor(status, statusText, data) {\n    this.status = status;\n    this.statusText = statusText || \"\";\n    this.data = data;\n  }\n\n}\n/**\n * Check if the given error is an ErrorResponse generated from a 4xx/5xx\n * Response throw from an action/loader\n */\n\nfunction isRouteErrorResponse(e) {\n  return e instanceof ErrorResponse;\n}\n\nconst IDLE_NAVIGATION = {\n  state: \"idle\",\n  location: undefined,\n  formMethod: undefined,\n  formAction: undefined,\n  formEncType: undefined,\n  formData: undefined\n};\nconst IDLE_FETCHER = {\n  state: \"idle\",\n  data: undefined,\n  formMethod: undefined,\n  formAction: undefined,\n  formEncType: undefined,\n  formData: undefined\n}; //#endregion\n////////////////////////////////////////////////////////////////////////////////\n//#region createRouter\n////////////////////////////////////////////////////////////////////////////////\n\n/**\n * Create a router and listen to history POP navigations\n */\n\nfunction createRouter(init) {\n  invariant(init.routes.length > 0, \"You must provide a non-empty routes array to createRouter\");\n  let dataRoutes = convertRoutesToDataRoutes(init.routes); // Cleanup function for history\n\n  let unlistenHistory = null; // Externally-provided functions to call on all state changes\n\n  let subscribers = new Set(); // Externally-provided object to hold scroll restoration locations during routing\n\n  let savedScrollPositions = null; // Externally-provided function to get scroll restoration keys\n\n  let getScrollRestorationKey = null; // Externally-provided function to get current scroll position\n\n  let getScrollPosition = null; // One-time flag to control the initial hydration scroll restoration.  Because\n  // we don't get the saved positions from <ScrollRestoration /> until _after_\n  // the initial render, we need to manually trigger a separate updateState to\n  // send along the restoreScrollPosition\n\n  let initialScrollRestored = false;\n  let initialMatches = matchRoutes(dataRoutes, init.history.location, init.basename);\n  let initialErrors = null;\n\n  if (initialMatches == null) {\n    // If we do not match a user-provided-route, fall back to the root\n    // to allow the error boundary to take over\n    let {\n      matches,\n      route,\n      error\n    } = getNotFoundMatches(dataRoutes);\n    initialMatches = matches;\n    initialErrors = {\n      [route.id]: error\n    };\n  }\n\n  let initialized = !initialMatches.some(m => m.route.loader) || init.hydrationData != null;\n  let router;\n  let state = {\n    historyAction: init.history.action,\n    location: init.history.location,\n    matches: initialMatches,\n    initialized,\n    navigation: IDLE_NAVIGATION,\n    restoreScrollPosition: null,\n    preventScrollReset: false,\n    revalidation: \"idle\",\n    loaderData: init.hydrationData && init.hydrationData.loaderData || {},\n    actionData: init.hydrationData && init.hydrationData.actionData || null,\n    errors: init.hydrationData && init.hydrationData.errors || initialErrors,\n    fetchers: new Map()\n  }; // -- Stateful internal variables to manage navigations --\n  // Current navigation in progress (to be committed in completeNavigation)\n\n  let pendingAction = Action.Pop; // Should the current navigation prevent the scroll reset if scroll cannot\n  // be restored?\n\n  let pendingPreventScrollReset = false; // AbortController for the active navigation\n\n  let pendingNavigationController; // We use this to avoid touching history in completeNavigation if a\n  // revalidation is entirely uninterrupted\n\n  let isUninterruptedRevalidation = false; // Use this internal flag to force revalidation of all loaders:\n  //  - submissions (completed or interrupted)\n  //  - useRevalidate()\n  //  - X-Remix-Revalidate (from redirect)\n\n  let isRevalidationRequired = false; // Use this internal array to capture routes that require revalidation due\n  // to a cancelled deferred on action submission\n\n  let cancelledDeferredRoutes = []; // Use this internal array to capture fetcher loads that were cancelled by an\n  // action navigation and require revalidation\n\n  let cancelledFetcherLoads = []; // AbortControllers for any in-flight fetchers\n\n  let fetchControllers = new Map(); // Track loads based on the order in which they started\n\n  let incrementingLoadId = 0; // Track the outstanding pending navigation data load to be compared against\n  // the globally incrementing load when a fetcher load lands after a completed\n  // navigation\n\n  let pendingNavigationLoadId = -1; // Fetchers that triggered data reloads as a result of their actions\n\n  let fetchReloadIds = new Map(); // Fetchers that triggered redirect navigations from their actions\n\n  let fetchRedirectIds = new Set(); // Most recent href/match for fetcher.load calls for fetchers\n\n  let fetchLoadMatches = new Map(); // Store DeferredData instances for active route matches.  When a\n  // route loader returns defer() we stick one in here.  Then, when a nested\n  // promise resolves we update loaderData.  If a new navigation starts we\n  // cancel active deferreds for eliminated routes.\n\n  let activeDeferreds = new Map(); // Initialize the router, all side effects should be kicked off from here.\n  // Implemented as a Fluent API for ease of:\n  //   let router = createRouter(init).initialize();\n\n  function initialize() {\n    // If history informs us of a POP navigation, start the navigation but do not update\n    // state.  We'll update our own state once the navigation completes\n    unlistenHistory = init.history.listen(_ref => {\n      let {\n        action: historyAction,\n        location\n      } = _ref;\n      return startNavigation(historyAction, location);\n    }); // Kick off initial data load if needed.  Use Pop to avoid modifying history\n\n    if (!state.initialized) {\n      startNavigation(Action.Pop, state.location);\n    }\n\n    return router;\n  } // Clean up a router and it's side effects\n\n\n  function dispose() {\n    if (unlistenHistory) {\n      unlistenHistory();\n    }\n\n    subscribers.clear();\n    pendingNavigationController && pendingNavigationController.abort();\n    state.fetchers.forEach((_, key) => deleteFetcher(key));\n  } // Subscribe to state updates for the router\n\n\n  function subscribe(fn) {\n    subscribers.add(fn);\n    return () => subscribers.delete(fn);\n  } // Update our state and notify the calling context of the change\n\n\n  function updateState(newState) {\n    state = _extends({}, state, newState);\n    subscribers.forEach(subscriber => subscriber(state));\n  } // Complete a navigation returning the state.navigation back to the IDLE_NAVIGATION\n  // and setting state.[historyAction/location/matches] to the new route.\n  // - Location is a required param\n  // - Navigation will always be set to IDLE_NAVIGATION\n  // - Can pass any other state in newState\n\n\n  function completeNavigation(location, newState) {\n    // Deduce if we're in a loading/actionReload state:\n    // - We have committed actionData in the store\n    // - The current navigation was a submission\n    // - We're past the submitting state and into the loading state\n    // - This should not be susceptible to false positives for\n    //   loading/submissionRedirect since there would not be actionData in the\n    //   state since the prior action would have returned a redirect response\n    //   and short circuited\n    let isActionReload = state.actionData != null && state.navigation.formMethod != null && state.navigation.state === \"loading\"; // Always preserve any existing loaderData from re-used routes\n\n    let newLoaderData = newState.loaderData ? {\n      loaderData: mergeLoaderData(state.loaderData, newState.loaderData, newState.matches || [])\n    } : {};\n    updateState(_extends({}, isActionReload ? {} : {\n      actionData: null\n    }, newState, newLoaderData, {\n      historyAction: pendingAction,\n      location,\n      initialized: true,\n      navigation: IDLE_NAVIGATION,\n      revalidation: \"idle\",\n      // Don't restore on submission navigations\n      restoreScrollPosition: state.navigation.formData ? false : getSavedScrollPosition(location, newState.matches || state.matches),\n      preventScrollReset: pendingPreventScrollReset\n    }));\n\n    if (isUninterruptedRevalidation) ; else if (pendingAction === Action.Pop) ; else if (pendingAction === Action.Push) {\n      init.history.push(location, location.state);\n    } else if (pendingAction === Action.Replace) {\n      init.history.replace(location, location.state);\n    } // Reset stateful navigation vars\n\n\n    pendingAction = Action.Pop;\n    pendingPreventScrollReset = false;\n    isUninterruptedRevalidation = false;\n    isRevalidationRequired = false;\n    cancelledDeferredRoutes = [];\n    cancelledFetcherLoads = [];\n  } // Trigger a navigation event, which can either be a numerical POP or a PUSH\n  // replace with an optional submission\n\n\n  async function navigate(to, opts) {\n    if (typeof to === \"number\") {\n      init.history.go(to);\n      return;\n    }\n\n    let {\n      path,\n      submission,\n      error\n    } = normalizeNavigateOptions(to, opts);\n    let location = createLocation(state.location, path, opts && opts.state);\n    let historyAction = (opts && opts.replace) === true || submission != null ? Action.Replace : Action.Push;\n    let preventScrollReset = opts && \"preventScrollReset\" in opts ? opts.preventScrollReset === true : undefined;\n    return await startNavigation(historyAction, location, {\n      submission,\n      // Send through the formData serialization error if we have one so we can\n      // render at the right error boundary after we match routes\n      pendingError: error,\n      preventScrollReset,\n      replace: opts && opts.replace\n    });\n  } // Revalidate all current loaders.  If a navigation is in progress or if this\n  // is interrupted by a navigation, allow this to \"succeed\" by calling all\n  // loaders during the next loader round\n\n\n  function revalidate() {\n    interruptActiveLoads();\n    updateState({\n      revalidation: \"loading\"\n    }); // If we're currently submitting an action, we don't need to start a new\n    // navigation, we'll just let the follow up loader execution call all loaders\n\n    if (state.navigation.state === \"submitting\") {\n      return;\n    } // If we're currently in an idle state, start a new navigation for the current\n    // action/location and mark it as uninterrupted, which will skip the history\n    // update in completeNavigation\n\n\n    if (state.navigation.state === \"idle\") {\n      startNavigation(state.historyAction, state.location, {\n        startUninterruptedRevalidation: true\n      });\n      return;\n    } // Otherwise, if we're currently in a loading state, just start a new\n    // navigation to the navigation.location but do not trigger an uninterrupted\n    // revalidation so that history correctly updates once the navigation completes\n\n\n    startNavigation(pendingAction || state.historyAction, state.navigation.location, {\n      overrideNavigation: state.navigation\n    });\n  } // Start a navigation to the given action/location.  Can optionally provide a\n  // overrideNavigation which will override the normalLoad in the case of a redirect\n  // navigation\n\n\n  async function startNavigation(historyAction, location, opts) {\n    // Abort any in-progress navigations and start a new one. Unset any ongoing\n    // uninterrupted revalidations unless told otherwise, since we want this\n    // new navigation to update history normally\n    pendingNavigationController && pendingNavigationController.abort();\n    pendingNavigationController = null;\n    pendingAction = historyAction;\n    isUninterruptedRevalidation = (opts && opts.startUninterruptedRevalidation) === true; // Save the current scroll position every time we start a new navigation,\n    // and track whether we should reset scroll on completion\n\n    saveScrollPosition(state.location, state.matches);\n    pendingPreventScrollReset = (opts && opts.preventScrollReset) === true;\n    let loadingNavigation = opts && opts.overrideNavigation;\n    let matches = matchRoutes(dataRoutes, location, init.basename); // Short circuit with a 404 on the root error boundary if we match nothing\n\n    if (!matches) {\n      let {\n        matches: notFoundMatches,\n        route,\n        error\n      } = getNotFoundMatches(dataRoutes); // Cancel all pending deferred on 404s since we don't keep any routes\n\n      cancelActiveDeferreds();\n      completeNavigation(location, {\n        matches: notFoundMatches,\n        loaderData: {},\n        errors: {\n          [route.id]: error\n        }\n      });\n      return;\n    } // Short circuit if it's only a hash change\n\n\n    if (isHashChangeOnly(state.location, location)) {\n      completeNavigation(location, {\n        matches\n      });\n      return;\n    } // Create a controller/Request for this navigation\n\n\n    pendingNavigationController = new AbortController();\n    let request = createRequest(location, pendingNavigationController.signal, opts && opts.submission);\n    let pendingActionData;\n    let pendingError;\n\n    if (opts && opts.pendingError) {\n      // If we have a pendingError, it means the user attempted a GET submission\n      // with binary FormData so assign here and skip to handleLoaders.  That\n      // way we handle calling loaders above the boundary etc.  It's not really\n      // different from an actionError in that sense.\n      pendingError = {\n        [findNearestBoundary(matches).route.id]: opts.pendingError\n      };\n    } else if (opts && opts.submission) {\n      // Call action if we received an action submission\n      let actionOutput = await handleAction(request, location, opts.submission, matches, {\n        replace: opts.replace\n      });\n\n      if (actionOutput.shortCircuited) {\n        return;\n      }\n\n      pendingActionData = actionOutput.pendingActionData;\n      pendingError = actionOutput.pendingActionError;\n\n      let navigation = _extends({\n        state: \"loading\",\n        location\n      }, opts.submission);\n\n      loadingNavigation = navigation;\n    } // Call loaders\n\n\n    let {\n      shortCircuited,\n      loaderData,\n      errors\n    } = await handleLoaders(request, location, matches, loadingNavigation, opts && opts.submission, opts && opts.replace, pendingActionData, pendingError);\n\n    if (shortCircuited) {\n      return;\n    } // Clean up now that the action/loaders have completed.  Don't clean up if\n    // we short circuited because pendingNavigationController will have already\n    // been assigned to a new controller for the next navigation\n\n\n    pendingNavigationController = null;\n    completeNavigation(location, {\n      matches,\n      loaderData,\n      errors\n    });\n  } // Call the action matched by the leaf route for this navigation and handle\n  // redirects/errors\n\n\n  async function handleAction(request, location, submission, matches, opts) {\n    interruptActiveLoads(); // Put us in a submitting state\n\n    let navigation = _extends({\n      state: \"submitting\",\n      location\n    }, submission);\n\n    updateState({\n      navigation\n    }); // Call our action and get the result\n\n    let result;\n    let actionMatch = getTargetMatch(matches, location);\n\n    if (!actionMatch.route.action) {\n      result = getMethodNotAllowedResult(location);\n    } else {\n      result = await callLoaderOrAction(\"action\", request, actionMatch);\n\n      if (request.signal.aborted) {\n        return {\n          shortCircuited: true\n        };\n      }\n    }\n\n    if (isRedirectResult(result)) {\n      let redirectNavigation = _extends({\n        state: \"loading\",\n        location: createLocation(state.location, result.location)\n      }, submission);\n\n      await startRedirectNavigation(result, redirectNavigation, opts && opts.replace);\n      return {\n        shortCircuited: true\n      };\n    }\n\n    if (isErrorResult(result)) {\n      // Store off the pending error - we use it to determine which loaders\n      // to call and will commit it when we complete the navigation\n      let boundaryMatch = findNearestBoundary(matches, actionMatch.route.id); // By default, all submissions are REPLACE navigations, but if the\n      // action threw an error that'll be rendered in an errorElement, we fall\n      // back to PUSH so that the user can use the back button to get back to\n      // the pre-submission form location to try again\n\n      if ((opts && opts.replace) !== true) {\n        pendingAction = Action.Push;\n      }\n\n      return {\n        pendingActionError: {\n          [boundaryMatch.route.id]: result.error\n        }\n      };\n    }\n\n    if (isDeferredResult(result)) {\n      throw new Error(\"defer() is not supported in actions\");\n    }\n\n    return {\n      pendingActionData: {\n        [actionMatch.route.id]: result.data\n      }\n    };\n  } // Call all applicable loaders for the given matches, handling redirects,\n  // errors, etc.\n\n\n  async function handleLoaders(request, location, matches, overrideNavigation, submission, replace, pendingActionData, pendingError) {\n    // Figure out the right navigation we want to use for data loading\n    let loadingNavigation = overrideNavigation;\n\n    if (!loadingNavigation) {\n      let navigation = {\n        state: \"loading\",\n        location,\n        formMethod: undefined,\n        formAction: undefined,\n        formEncType: undefined,\n        formData: undefined\n      };\n      loadingNavigation = navigation;\n    }\n\n    let [matchesToLoad, revalidatingFetchers] = getMatchesToLoad(state, matches, submission, location, isRevalidationRequired, cancelledDeferredRoutes, cancelledFetcherLoads, pendingActionData, pendingError, fetchLoadMatches); // Cancel pending deferreds for no-longer-matched routes or routes we're\n    // about to reload.  Note that if this is an action reload we would have\n    // already cancelled all pending deferreds so this would be a no-op\n\n    cancelActiveDeferreds(routeId => !(matches && matches.some(m => m.route.id === routeId)) || matchesToLoad && matchesToLoad.some(m => m.route.id === routeId)); // Short circuit if we have no loaders to run\n\n    if (matchesToLoad.length === 0 && revalidatingFetchers.length === 0) {\n      completeNavigation(location, {\n        matches,\n        loaderData: mergeLoaderData(state.loaderData, {}, matches),\n        // Commit pending error if we're short circuiting\n        errors: pendingError || null,\n        actionData: pendingActionData || null\n      });\n      return {\n        shortCircuited: true\n      };\n    } // If this is an uninterrupted revalidation, we remain in our current idle\n    // state.  If not, we need to switch to our loading state and load data,\n    // preserving any new action data or existing action data (in the case of\n    // a revalidation interrupting an actionReload)\n\n\n    if (!isUninterruptedRevalidation) {\n      revalidatingFetchers.forEach(_ref2 => {\n        let [key] = _ref2;\n        const fetcher = state.fetchers.get(key);\n        let revalidatingFetcher = {\n          state: \"loading\",\n          data: fetcher && fetcher.data,\n          formMethod: undefined,\n          formAction: undefined,\n          formEncType: undefined,\n          formData: undefined\n        };\n        state.fetchers.set(key, revalidatingFetcher);\n      });\n      updateState(_extends({\n        navigation: loadingNavigation,\n        actionData: pendingActionData || state.actionData || null\n      }, revalidatingFetchers.length > 0 ? {\n        fetchers: new Map(state.fetchers)\n      } : {}));\n    }\n\n    pendingNavigationLoadId = ++incrementingLoadId;\n    revalidatingFetchers.forEach(_ref3 => {\n      let [key] = _ref3;\n      return fetchControllers.set(key, pendingNavigationController);\n    });\n    let {\n      results,\n      loaderResults,\n      fetcherResults\n    } = await callLoadersAndMaybeResolveData(state.matches, matchesToLoad, revalidatingFetchers, request);\n\n    if (request.signal.aborted) {\n      return {\n        shortCircuited: true\n      };\n    } // Clean up _after_ loaders have completed.  Don't clean up if we short\n    // circuited because fetchControllers would have been aborted and\n    // reassigned to new controllers for the next navigation\n\n\n    revalidatingFetchers.forEach(_ref4 => {\n      let [key] = _ref4;\n      return fetchControllers.delete(key);\n    }); // If any loaders returned a redirect Response, start a new REPLACE navigation\n\n    let redirect = findRedirect(results);\n\n    if (redirect) {\n      let redirectNavigation = getLoaderRedirect(state, redirect);\n      await startRedirectNavigation(redirect, redirectNavigation, replace);\n      return {\n        shortCircuited: true\n      };\n    } // Process and commit output from loaders\n\n\n    let {\n      loaderData,\n      errors\n    } = processLoaderData(state, matches, matchesToLoad, loaderResults, pendingError, revalidatingFetchers, fetcherResults, activeDeferreds); // Wire up subscribers to update loaderData as promises settle\n\n    activeDeferreds.forEach((deferredData, routeId) => {\n      deferredData.subscribe(aborted => {\n        // Note: No need to updateState here since the TrackedPromise on\n        // loaderData is stable across resolve/reject\n        // Remove this instance if we were aborted or if promises have settled\n        if (aborted || deferredData.done) {\n          activeDeferreds.delete(routeId);\n        }\n      });\n    });\n    markFetchRedirectsDone();\n    let didAbortFetchLoads = abortStaleFetchLoads(pendingNavigationLoadId);\n    return _extends({\n      loaderData,\n      errors\n    }, didAbortFetchLoads || revalidatingFetchers.length > 0 ? {\n      fetchers: new Map(state.fetchers)\n    } : {});\n  }\n\n  function getFetcher(key) {\n    return state.fetchers.get(key) || IDLE_FETCHER;\n  } // Trigger a fetcher load/submit for the given fetcher key\n\n\n  function fetch(key, routeId, href, opts) {\n    if (typeof AbortController === \"undefined\") {\n      throw new Error(\"router.fetch() was called during the server render, but it shouldn't be. \" + \"You are likely calling a useFetcher() method in the body of your component. \" + \"Try moving it to a useEffect or a callback.\");\n    }\n\n    if (fetchControllers.has(key)) abortFetcher(key);\n    let matches = matchRoutes(dataRoutes, href, init.basename);\n\n    if (!matches) {\n      setFetcherError(key, routeId, new ErrorResponse(404, \"Not Found\", null));\n      return;\n    }\n\n    let {\n      path,\n      submission\n    } = normalizeNavigateOptions(href, opts, true);\n    let match = getTargetMatch(matches, path);\n\n    if (submission) {\n      handleFetcherAction(key, routeId, path, match, submission);\n      return;\n    } // Store off the match so we can call it's shouldRevalidate on subsequent\n    // revalidations\n\n\n    fetchLoadMatches.set(key, [path, match]);\n    handleFetcherLoader(key, routeId, path, match);\n  } // Call the action for the matched fetcher.submit(), and then handle redirects,\n  // errors, and revalidation\n\n\n  async function handleFetcherAction(key, routeId, path, match, submission) {\n    interruptActiveLoads();\n    fetchLoadMatches.delete(key);\n\n    if (!match.route.action) {\n      let {\n        error\n      } = getMethodNotAllowedResult(path);\n      setFetcherError(key, routeId, error);\n      return;\n    } // Put this fetcher into it's submitting state\n\n\n    let existingFetcher = state.fetchers.get(key);\n\n    let fetcher = _extends({\n      state: \"submitting\"\n    }, submission, {\n      data: existingFetcher && existingFetcher.data\n    });\n\n    state.fetchers.set(key, fetcher);\n    updateState({\n      fetchers: new Map(state.fetchers)\n    }); // Call the action for the fetcher\n\n    let abortController = new AbortController();\n    let fetchRequest = createRequest(path, abortController.signal, submission);\n    fetchControllers.set(key, abortController);\n    let actionResult = await callLoaderOrAction(\"action\", fetchRequest, match);\n\n    if (fetchRequest.signal.aborted) {\n      // We can delete this so long as we weren't aborted by ou our own fetcher\n      // re-submit which would have put _new_ controller is in fetchControllers\n      if (fetchControllers.get(key) === abortController) {\n        fetchControllers.delete(key);\n      }\n\n      return;\n    }\n\n    if (isRedirectResult(actionResult)) {\n      fetchControllers.delete(key);\n      fetchRedirectIds.add(key);\n\n      let loadingFetcher = _extends({\n        state: \"loading\"\n      }, submission, {\n        data: undefined\n      });\n\n      state.fetchers.set(key, loadingFetcher);\n      updateState({\n        fetchers: new Map(state.fetchers)\n      });\n\n      let redirectNavigation = _extends({\n        state: \"loading\",\n        location: createLocation(state.location, actionResult.location)\n      }, submission);\n\n      await startRedirectNavigation(actionResult, redirectNavigation);\n      return;\n    } // Process any non-redirect errors thrown\n\n\n    if (isErrorResult(actionResult)) {\n      setFetcherError(key, routeId, actionResult.error);\n      return;\n    }\n\n    if (isDeferredResult(actionResult)) {\n      invariant(false, \"defer() is not supported in actions\");\n    } // Start the data load for current matches, or the next location if we're\n    // in the middle of a navigation\n\n\n    let nextLocation = state.navigation.location || state.location;\n    let revalidationRequest = createRequest(nextLocation, abortController.signal);\n    let matches = state.navigation.state !== \"idle\" ? matchRoutes(dataRoutes, state.navigation.location, init.basename) : state.matches;\n    invariant(matches, \"Didn't find any matches after fetcher action\");\n    let loadId = ++incrementingLoadId;\n    fetchReloadIds.set(key, loadId);\n\n    let loadFetcher = _extends({\n      state: \"loading\",\n      data: actionResult.data\n    }, submission);\n\n    state.fetchers.set(key, loadFetcher);\n    let [matchesToLoad, revalidatingFetchers] = getMatchesToLoad(state, matches, submission, nextLocation, isRevalidationRequired, cancelledDeferredRoutes, cancelledFetcherLoads, {\n      [match.route.id]: actionResult.data\n    }, undefined, // No need to send through errors since we short circuit above\n    fetchLoadMatches); // Put all revalidating fetchers into the loading state, except for the\n    // current fetcher which we want to keep in it's current loading state which\n    // contains it's action submission info + action data\n\n    revalidatingFetchers.filter(_ref5 => {\n      let [staleKey] = _ref5;\n      return staleKey !== key;\n    }).forEach(_ref6 => {\n      let [staleKey] = _ref6;\n      let existingFetcher = state.fetchers.get(staleKey);\n      let revalidatingFetcher = {\n        state: \"loading\",\n        data: existingFetcher && existingFetcher.data,\n        formMethod: undefined,\n        formAction: undefined,\n        formEncType: undefined,\n        formData: undefined\n      };\n      state.fetchers.set(staleKey, revalidatingFetcher);\n      fetchControllers.set(staleKey, abortController);\n    });\n    updateState({\n      fetchers: new Map(state.fetchers)\n    });\n    let {\n      results,\n      loaderResults,\n      fetcherResults\n    } = await callLoadersAndMaybeResolveData(state.matches, matchesToLoad, revalidatingFetchers, revalidationRequest);\n\n    if (abortController.signal.aborted) {\n      return;\n    }\n\n    fetchReloadIds.delete(key);\n    fetchControllers.delete(key);\n    revalidatingFetchers.forEach(_ref7 => {\n      let [staleKey] = _ref7;\n      return fetchControllers.delete(staleKey);\n    });\n    let redirect = findRedirect(results);\n\n    if (redirect) {\n      let redirectNavigation = getLoaderRedirect(state, redirect);\n      await startRedirectNavigation(redirect, redirectNavigation);\n      return;\n    } // Process and commit output from loaders\n\n\n    let {\n      loaderData,\n      errors\n    } = processLoaderData(state, state.matches, matchesToLoad, loaderResults, undefined, revalidatingFetchers, fetcherResults, activeDeferreds);\n    let doneFetcher = {\n      state: \"idle\",\n      data: actionResult.data,\n      formMethod: undefined,\n      formAction: undefined,\n      formEncType: undefined,\n      formData: undefined\n    };\n    state.fetchers.set(key, doneFetcher);\n    let didAbortFetchLoads = abortStaleFetchLoads(loadId); // If we are currently in a navigation loading state and this fetcher is\n    // more recent than the navigation, we want the newer data so abort the\n    // navigation and complete it with the fetcher data\n\n    if (state.navigation.state === \"loading\" && loadId > pendingNavigationLoadId) {\n      invariant(pendingAction, \"Expected pending action\");\n      pendingNavigationController && pendingNavigationController.abort();\n      completeNavigation(state.navigation.location, {\n        matches,\n        loaderData,\n        errors,\n        fetchers: new Map(state.fetchers)\n      });\n    } else {\n      // otherwise just update with the fetcher data, preserving any existing\n      // loaderData for loaders that did not need to reload.  We have to\n      // manually merge here since we aren't going through completeNavigation\n      updateState(_extends({\n        errors,\n        loaderData: mergeLoaderData(state.loaderData, loaderData, matches)\n      }, didAbortFetchLoads ? {\n        fetchers: new Map(state.fetchers)\n      } : {}));\n      isRevalidationRequired = false;\n    }\n  } // Call the matched loader for fetcher.load(), handling redirects, errors, etc.\n\n\n  async function handleFetcherLoader(key, routeId, path, match) {\n    let existingFetcher = state.fetchers.get(key); // Put this fetcher into it's loading state\n\n    let loadingFetcher = {\n      state: \"loading\",\n      formMethod: undefined,\n      formAction: undefined,\n      formEncType: undefined,\n      formData: undefined,\n      data: existingFetcher && existingFetcher.data\n    };\n    state.fetchers.set(key, loadingFetcher);\n    updateState({\n      fetchers: new Map(state.fetchers)\n    }); // Call the loader for this fetcher route match\n\n    let abortController = new AbortController();\n    let fetchRequest = createRequest(path, abortController.signal);\n    fetchControllers.set(key, abortController);\n    let result = await callLoaderOrAction(\"loader\", fetchRequest, match); // Deferred isn't supported or fetcher loads, await everything and treat it\n    // as a normal load.  resolveDeferredData will return undefined if this\n    // fetcher gets aborted, so we just leave result untouched and short circuit\n    // below if that happens\n\n    if (isDeferredResult(result)) {\n      result = (await resolveDeferredData(result, fetchRequest.signal, true)) || result;\n    } // We can delete this so long as we weren't aborted by ou our own fetcher\n    // re-load which would have put _new_ controller is in fetchControllers\n\n\n    if (fetchControllers.get(key) === abortController) {\n      fetchControllers.delete(key);\n    }\n\n    if (fetchRequest.signal.aborted) {\n      return;\n    } // If the loader threw a redirect Response, start a new REPLACE navigation\n\n\n    if (isRedirectResult(result)) {\n      let redirectNavigation = getLoaderRedirect(state, result);\n      await startRedirectNavigation(result, redirectNavigation);\n      return;\n    } // Process any non-redirect errors thrown\n\n\n    if (isErrorResult(result)) {\n      let boundaryMatch = findNearestBoundary(state.matches, routeId);\n      state.fetchers.delete(key); // TODO: In remix, this would reset to IDLE_NAVIGATION if it was a catch -\n      // do we need to behave any differently with our non-redirect errors?\n      // What if it was a non-redirect Response?\n\n      updateState({\n        fetchers: new Map(state.fetchers),\n        errors: {\n          [boundaryMatch.route.id]: result.error\n        }\n      });\n      return;\n    }\n\n    invariant(!isDeferredResult(result), \"Unhandled fetcher deferred data\"); // Put the fetcher back into an idle state\n\n    let doneFetcher = {\n      state: \"idle\",\n      data: result.data,\n      formMethod: undefined,\n      formAction: undefined,\n      formEncType: undefined,\n      formData: undefined\n    };\n    state.fetchers.set(key, doneFetcher);\n    updateState({\n      fetchers: new Map(state.fetchers)\n    });\n  }\n  /**\n   * Utility function to handle redirects returned from an action or loader.\n   * Normally, a redirect \"replaces\" the navigation that triggered it.  So, for\n   * example:\n   *\n   *  - user is on /a\n   *  - user clicks a link to /b\n   *  - loader for /b redirects to /c\n   *\n   * In a non-JS app the browser would track the in-flight navigation to /b and\n   * then replace it with /c when it encountered the redirect response.  In\n   * the end it would only ever update the URL bar with /c.\n   *\n   * In client-side routing using pushState/replaceState, we aim to emulate\n   * this behavior and we also do not update history until the end of the\n   * navigation (including processed redirects).  This means that we never\n   * actually touch history until we've processed redirects, so we just use\n   * the history action from the original navigation (PUSH or REPLACE).\n   */\n\n\n  async function startRedirectNavigation(redirect, navigation, replace) {\n    if (redirect.revalidate) {\n      isRevalidationRequired = true;\n    }\n\n    invariant(navigation.location, \"Expected a location on the redirect navigation\"); // There's no need to abort on redirects, since we don't detect the\n    // redirect until the action/loaders have settled\n\n    pendingNavigationController = null;\n    let redirectHistoryAction = replace === true ? Action.Replace : Action.Push;\n    await startNavigation(redirectHistoryAction, navigation.location, {\n      overrideNavigation: navigation\n    });\n  }\n\n  async function callLoadersAndMaybeResolveData(currentMatches, matchesToLoad, fetchersToLoad, request) {\n    // Call all navigation loaders and revalidating fetcher loaders in parallel,\n    // then slice off the results into separate arrays so we can handle them\n    // accordingly\n    let results = await Promise.all([...matchesToLoad.map(m => callLoaderOrAction(\"loader\", request, m)), ...fetchersToLoad.map(_ref8 => {\n      let [, href, match] = _ref8;\n      return callLoaderOrAction(\"loader\", createRequest(href, request.signal), match);\n    })]);\n    let loaderResults = results.slice(0, matchesToLoad.length);\n    let fetcherResults = results.slice(matchesToLoad.length);\n    await Promise.all([resolveDeferredResults(currentMatches, matchesToLoad, loaderResults, request.signal, false, state.loaderData), resolveDeferredResults(currentMatches, fetchersToLoad.map(_ref9 => {\n      let [,, match] = _ref9;\n      return match;\n    }), fetcherResults, request.signal, true)]);\n    return {\n      results,\n      loaderResults,\n      fetcherResults\n    };\n  }\n\n  function interruptActiveLoads() {\n    // Every interruption triggers a revalidation\n    isRevalidationRequired = true; // Cancel pending route-level deferreds and mark cancelled routes for\n    // revalidation\n\n    cancelledDeferredRoutes.push(...cancelActiveDeferreds()); // Abort in-flight fetcher loads\n\n    fetchLoadMatches.forEach((_, key) => {\n      if (fetchControllers.has(key)) {\n        cancelledFetcherLoads.push(key);\n        abortFetcher(key);\n      }\n    });\n  }\n\n  function setFetcherError(key, routeId, error) {\n    let boundaryMatch = findNearestBoundary(state.matches, routeId);\n    deleteFetcher(key);\n    updateState({\n      errors: {\n        [boundaryMatch.route.id]: error\n      },\n      fetchers: new Map(state.fetchers)\n    });\n  }\n\n  function deleteFetcher(key) {\n    if (fetchControllers.has(key)) abortFetcher(key);\n    fetchLoadMatches.delete(key);\n    fetchReloadIds.delete(key);\n    fetchRedirectIds.delete(key);\n    state.fetchers.delete(key);\n  }\n\n  function abortFetcher(key) {\n    let controller = fetchControllers.get(key);\n    invariant(controller, \"Expected fetch controller: \" + key);\n    controller.abort();\n    fetchControllers.delete(key);\n  }\n\n  function markFetchersDone(keys) {\n    for (let key of keys) {\n      let fetcher = getFetcher(key);\n      let doneFetcher = {\n        state: \"idle\",\n        data: fetcher.data,\n        formMethod: undefined,\n        formAction: undefined,\n        formEncType: undefined,\n        formData: undefined\n      };\n      state.fetchers.set(key, doneFetcher);\n    }\n  }\n\n  function markFetchRedirectsDone() {\n    let doneKeys = [];\n\n    for (let key of fetchRedirectIds) {\n      let fetcher = state.fetchers.get(key);\n      invariant(fetcher, \"Expected fetcher: \" + key);\n\n      if (fetcher.state === \"loading\") {\n        fetchRedirectIds.delete(key);\n        doneKeys.push(key);\n      }\n    }\n\n    markFetchersDone(doneKeys);\n  }\n\n  function abortStaleFetchLoads(landedId) {\n    let yeetedKeys = [];\n\n    for (let [key, id] of fetchReloadIds) {\n      if (id < landedId) {\n        let fetcher = state.fetchers.get(key);\n        invariant(fetcher, \"Expected fetcher: \" + key);\n\n        if (fetcher.state === \"loading\") {\n          abortFetcher(key);\n          fetchReloadIds.delete(key);\n          yeetedKeys.push(key);\n        }\n      }\n    }\n\n    markFetchersDone(yeetedKeys);\n    return yeetedKeys.length > 0;\n  }\n\n  function cancelActiveDeferreds(predicate) {\n    let cancelledRouteIds = [];\n    activeDeferreds.forEach((dfd, routeId) => {\n      if (!predicate || predicate(routeId)) {\n        // Cancel the deferred - but do not remove from activeDeferreds here -\n        // we rely on the subscribers to do that so our tests can assert proper\n        // cleanup via _internalActiveDeferreds\n        dfd.cancel();\n        cancelledRouteIds.push(routeId);\n        activeDeferreds.delete(routeId);\n      }\n    });\n    return cancelledRouteIds;\n  } // Opt in to capturing and reporting scroll positions during navigations,\n  // used by the <ScrollRestoration> component\n\n\n  function enableScrollRestoration(positions, getPosition, getKey) {\n    savedScrollPositions = positions;\n    getScrollPosition = getPosition;\n\n    getScrollRestorationKey = getKey || (location => location.key); // Perform initial hydration scroll restoration, since we miss the boat on\n    // the initial updateState() because we've not yet rendered <ScrollRestoration/>\n    // and therefore have no savedScrollPositions available\n\n\n    if (!initialScrollRestored && state.navigation === IDLE_NAVIGATION) {\n      initialScrollRestored = true;\n      let y = getSavedScrollPosition(state.location, state.matches);\n\n      if (y != null) {\n        updateState({\n          restoreScrollPosition: y\n        });\n      }\n    }\n\n    return () => {\n      savedScrollPositions = null;\n      getScrollPosition = null;\n      getScrollRestorationKey = null;\n    };\n  }\n\n  function saveScrollPosition(location, matches) {\n    if (savedScrollPositions && getScrollRestorationKey && getScrollPosition) {\n      let userMatches = matches.map(m => createUseMatchesMatch(m, state.loaderData));\n      let key = getScrollRestorationKey(location, userMatches) || location.key;\n      savedScrollPositions[key] = getScrollPosition();\n    }\n  }\n\n  function getSavedScrollPosition(location, matches) {\n    if (savedScrollPositions && getScrollRestorationKey && getScrollPosition) {\n      let userMatches = matches.map(m => createUseMatchesMatch(m, state.loaderData));\n      let key = getScrollRestorationKey(location, userMatches) || location.key;\n      let y = savedScrollPositions[key];\n\n      if (typeof y === \"number\") {\n        return y;\n      }\n    }\n\n    return null;\n  }\n\n  router = {\n    get basename() {\n      return init.basename;\n    },\n\n    get state() {\n      return state;\n    },\n\n    get routes() {\n      return dataRoutes;\n    },\n\n    initialize,\n    subscribe,\n    enableScrollRestoration,\n    navigate,\n    fetch,\n    revalidate,\n    createHref,\n    getFetcher,\n    deleteFetcher,\n    dispose,\n    _internalFetchControllers: fetchControllers,\n    _internalActiveDeferreds: activeDeferreds\n  };\n  return router;\n} //#endregion\n////////////////////////////////////////////////////////////////////////////////\n//#region createStaticHandler\n////////////////////////////////////////////////////////////////////////////////\n\nfunction unstable_createStaticHandler(routes) {\n  invariant(routes.length > 0, \"You must provide a non-empty routes array to unstable_createStaticHandler\");\n  let dataRoutes = convertRoutesToDataRoutes(routes);\n\n  async function query(request) {\n    let {\n      location,\n      result\n    } = await queryImpl(request);\n\n    if (result instanceof Response) {\n      return result;\n    } // When returning StaticHandlerContext, we patch back in the location here\n    // since we need it for React Context.  But this helps keep our submit and\n    // loadRouteData operating on a Request instead of a Location\n\n\n    return _extends({\n      location\n    }, result);\n  }\n\n  async function queryRoute(request, routeId) {\n    let {\n      result\n    } = await queryImpl(request, routeId);\n\n    if (result instanceof Response) {\n      return result;\n    } // Pick off the right state value to return\n\n\n    let routeData = [result.errors, result.actionData, result.loaderData].find(v => v);\n    let value = Object.values(routeData || {})[0];\n\n    if (isRouteErrorResponse(value)) {\n      return new Response(value.data, {\n        status: value.status,\n        statusText: value.statusText\n      });\n    }\n\n    return value;\n  }\n\n  async function queryImpl(request, routeId) {\n    invariant(request.method !== \"HEAD\", \"query()/queryRoute() do not support HEAD requests\");\n    invariant(request.signal, \"query()/queryRoute() requests must contain an AbortController signal\");\n    let {\n      location,\n      matches,\n      shortCircuitState\n    } = matchRequest(request, routeId);\n\n    try {\n      if (shortCircuitState) {\n        return {\n          location,\n          result: shortCircuitState\n        };\n      }\n\n      if (request.method !== \"GET\") {\n        let result = await submit(request, matches, getTargetMatch(matches, location), routeId != null);\n        return {\n          location,\n          result\n        };\n      }\n\n      let result = await loadRouteData(request, matches, routeId != null);\n      return {\n        location,\n        result: _extends({}, result, {\n          actionData: null,\n          actionHeaders: {}\n        })\n      };\n    } catch (e) {\n      if (e instanceof Response) {\n        return {\n          location,\n          result: e\n        };\n      }\n\n      throw e;\n    }\n  }\n\n  async function submit(request, matches, actionMatch, isRouteRequest) {\n    let result;\n\n    if (!actionMatch.route.action) {\n      let href = createHref(new URL(request.url));\n      result = getMethodNotAllowedResult(href);\n    } else {\n      result = await callLoaderOrAction(\"action\", request, actionMatch, true, isRouteRequest);\n\n      if (request.signal.aborted) {\n        let method = isRouteRequest ? \"queryRoute\" : \"query\";\n        throw new Error(method + \"() call aborted\");\n      }\n    }\n\n    if (isRedirectResult(result)) {\n      // Uhhhh - this should never happen, we should always throw these from\n      // calLoaderOrAction, but the type narrowing here keeps TS happy and we\n      // can get back on the \"throw all redirect responses\" train here should\n      // this ever happen :/\n      throw new Response(null, {\n        status: result.status,\n        headers: {\n          Location: result.location\n        }\n      });\n    }\n\n    if (isDeferredResult(result)) {\n      throw new Error(\"defer() is not supported in actions\");\n    }\n\n    if (isRouteRequest) {\n      if (isErrorResult(result)) {\n        let boundaryMatch = findNearestBoundary(matches, actionMatch.route.id);\n        return {\n          matches: [actionMatch],\n          loaderData: {},\n          actionData: null,\n          errors: {\n            [boundaryMatch.route.id]: result.error\n          },\n          // Note: statusCode + headers are unused here since queryRoute will\n          // return the raw Response or value\n          statusCode: 500,\n          loaderHeaders: {},\n          actionHeaders: {}\n        };\n      }\n\n      return {\n        matches: [actionMatch],\n        loaderData: {},\n        actionData: {\n          [actionMatch.route.id]: result.data\n        },\n        errors: null,\n        // Note: statusCode + headers are unused here since queryRoute will\n        // return the raw Response or value\n        statusCode: 200,\n        loaderHeaders: {},\n        actionHeaders: {}\n      };\n    }\n\n    if (isErrorResult(result)) {\n      // Store off the pending error - we use it to determine which loaders\n      // to call and will commit it when we complete the navigation\n      let boundaryMatch = findNearestBoundary(matches, actionMatch.route.id);\n      let context = await loadRouteData(request, matches, isRouteRequest, {\n        [boundaryMatch.route.id]: result.error\n      }); // action status codes take precedence over loader status codes\n\n      return _extends({}, context, {\n        statusCode: isRouteErrorResponse(result.error) ? result.error.status : 500,\n        actionData: null,\n        actionHeaders: _extends({}, result.headers ? {\n          [actionMatch.route.id]: result.headers\n        } : {})\n      });\n    }\n\n    let context = await loadRouteData(request, matches, isRouteRequest);\n    return _extends({}, context, result.statusCode ? {\n      statusCode: result.statusCode\n    } : {}, {\n      actionData: {\n        [actionMatch.route.id]: result.data\n      },\n      actionHeaders: _extends({}, result.headers ? {\n        [actionMatch.route.id]: result.headers\n      } : {})\n    });\n  }\n\n  async function loadRouteData(request, matches, isRouteRequest, pendingActionError) {\n    let matchesToLoad = getLoaderMatchesUntilBoundary(matches, Object.keys(pendingActionError || {})[0]).filter(m => m.route.loader); // Short circuit if we have no loaders to run\n\n    if (matchesToLoad.length === 0) {\n      return {\n        matches,\n        loaderData: {},\n        errors: pendingActionError || null,\n        statusCode: 200,\n        loaderHeaders: {}\n      };\n    }\n\n    let results = await Promise.all([...matchesToLoad.map(m => callLoaderOrAction(\"loader\", request, m, true, isRouteRequest))]);\n\n    if (request.signal.aborted) {\n      let method = isRouteRequest ? \"queryRoute\" : \"query\";\n      throw new Error(method + \"() call aborted\");\n    } // Can't do anything with these without the Remix side of things, so just\n    // cancel them for now\n\n\n    results.forEach(result => {\n      if (isDeferredResult(result)) {\n        result.deferredData.cancel();\n      }\n    }); // Process and commit output from loaders\n\n    let context = processRouteLoaderData(matches, matchesToLoad, results, pendingActionError);\n    return _extends({}, context, {\n      matches\n    });\n  }\n\n  function matchRequest(req, routeId) {\n    let url = new URL(req.url);\n    let location = createLocation(\"\", createPath(url), null, \"default\");\n    let matches = matchRoutes(dataRoutes, location);\n\n    if (matches && routeId) {\n      matches = matches.filter(m => m.route.id === routeId);\n    } // Short circuit with a 404 if we match nothing\n\n\n    if (!matches) {\n      let {\n        matches: notFoundMatches,\n        route,\n        error\n      } = getNotFoundMatches(dataRoutes);\n      return {\n        location,\n        matches: notFoundMatches,\n        shortCircuitState: {\n          matches: notFoundMatches,\n          loaderData: {},\n          actionData: null,\n          errors: {\n            [route.id]: error\n          },\n          statusCode: 404,\n          loaderHeaders: {},\n          actionHeaders: {}\n        }\n      };\n    }\n\n    return {\n      location,\n      matches\n    };\n  }\n\n  return {\n    dataRoutes,\n    query,\n    queryRoute\n  };\n} //#endregion\n////////////////////////////////////////////////////////////////////////////////\n//#region Helpers\n////////////////////////////////////////////////////////////////////////////////\n\n/**\n * Given an existing StaticHandlerContext and an error thrown at render time,\n * provide an updated StaticHandlerContext suitable for a second SSR render\n */\n\nfunction getStaticContextFromError(routes, context, error) {\n  let newContext = _extends({}, context, {\n    statusCode: 500,\n    errors: {\n      [context._deepestRenderedBoundaryId || routes[0].id]: error\n    }\n  });\n\n  return newContext;\n} // Normalize navigation options by converting formMethod=GET formData objects to\n// URLSearchParams so they behave identically to links with query params\n\nfunction normalizeNavigateOptions(to, opts, isFetcher) {\n  if (isFetcher === void 0) {\n    isFetcher = false;\n  }\n\n  let path = typeof to === \"string\" ? to : createPath(to); // Return location verbatim on non-submission navigations\n\n  if (!opts || !(\"formMethod\" in opts) && !(\"formData\" in opts)) {\n    return {\n      path\n    };\n  } // Create a Submission on non-GET navigations\n\n\n  if (opts.formMethod != null && opts.formMethod !== \"get\") {\n    return {\n      path,\n      submission: {\n        formMethod: opts.formMethod,\n        formAction: createHref(parsePath(path)),\n        formEncType: opts && opts.formEncType || \"application/x-www-form-urlencoded\",\n        formData: opts.formData\n      }\n    };\n  } // No formData to flatten for GET submission\n\n\n  if (!opts.formData) {\n    return {\n      path\n    };\n  } // Flatten submission onto URLSearchParams for GET submissions\n\n\n  let parsedPath = parsePath(path);\n\n  try {\n    let searchParams = convertFormDataToSearchParams(opts.formData); // Since fetcher GET submissions only run a single loader (as opposed to\n    // navigation GET submissions which run all loaders), we need to preserve\n    // any incoming ?index params\n\n    if (isFetcher && parsedPath.search && hasNakedIndexQuery(parsedPath.search)) {\n      searchParams.append(\"index\", \"\");\n    }\n\n    parsedPath.search = \"?\" + searchParams;\n  } catch (e) {\n    return {\n      path,\n      error: new ErrorResponse(400, \"Bad Request\", \"Cannot submit binary form data using GET\")\n    };\n  }\n\n  return {\n    path: createPath(parsedPath)\n  };\n}\n\nfunction getLoaderRedirect(state, redirect) {\n  let {\n    formMethod,\n    formAction,\n    formEncType,\n    formData\n  } = state.navigation;\n  let navigation = {\n    state: \"loading\",\n    location: createLocation(state.location, redirect.location),\n    formMethod: formMethod || undefined,\n    formAction: formAction || undefined,\n    formEncType: formEncType || undefined,\n    formData: formData || undefined\n  };\n  return navigation;\n} // Filter out all routes below any caught error as they aren't going to\n// render so we don't need to load them\n\n\nfunction getLoaderMatchesUntilBoundary(matches, boundaryId) {\n  let boundaryMatches = matches;\n\n  if (boundaryId) {\n    let index = matches.findIndex(m => m.route.id === boundaryId);\n\n    if (index >= 0) {\n      boundaryMatches = matches.slice(0, index);\n    }\n  }\n\n  return boundaryMatches;\n}\n\nfunction getMatchesToLoad(state, matches, submission, location, isRevalidationRequired, cancelledDeferredRoutes, cancelledFetcherLoads, pendingActionData, pendingError, fetchLoadMatches) {\n  let actionResult = pendingError ? Object.values(pendingError)[0] : pendingActionData ? Object.values(pendingActionData)[0] : null; // Pick navigation matches that are net-new or qualify for revalidation\n\n  let boundaryId = pendingError ? Object.keys(pendingError)[0] : undefined;\n  let boundaryMatches = getLoaderMatchesUntilBoundary(matches, boundaryId);\n  let navigationMatches = boundaryMatches.filter((match, index) => match.route.loader != null && (isNewLoader(state.loaderData, state.matches[index], match) || // If this route had a pending deferred cancelled it must be revalidated\n  cancelledDeferredRoutes.some(id => id === match.route.id) || shouldRevalidateLoader(state.location, state.matches[index], submission, location, match, isRevalidationRequired, actionResult))); // Pick fetcher.loads that need to be revalidated\n\n  let revalidatingFetchers = [];\n  fetchLoadMatches && fetchLoadMatches.forEach((_ref10, key) => {\n    let [href, match] = _ref10;\n\n    // This fetcher was cancelled from a prior action submission - force reload\n    if (cancelledFetcherLoads.includes(key)) {\n      revalidatingFetchers.push([key, href, match]);\n    } else if (isRevalidationRequired) {\n      let shouldRevalidate = shouldRevalidateLoader(href, match, submission, href, match, isRevalidationRequired, actionResult);\n\n      if (shouldRevalidate) {\n        revalidatingFetchers.push([key, href, match]);\n      }\n    }\n  });\n  return [navigationMatches, revalidatingFetchers];\n}\n\nfunction isNewLoader(currentLoaderData, currentMatch, match) {\n  let isNew = // [a] -> [a, b]\n  !currentMatch || // [a, b] -> [a, c]\n  match.route.id !== currentMatch.route.id; // Handle the case that we don't have data for a re-used route, potentially\n  // from a prior error or from a cancelled pending deferred\n\n  let isMissingData = currentLoaderData[match.route.id] === undefined; // Always load if this is a net-new route or we don't yet have data\n\n  return isNew || isMissingData;\n}\n\nfunction isNewRouteInstance(currentMatch, match) {\n  let currentPath = currentMatch.route.path;\n  return (// param change for this match, /users/123 -> /users/456\n    currentMatch.pathname !== match.pathname || // splat param changed, which is not present in match.path\n    // e.g. /files/images/avatar.jpg -> files/finances.xls\n    currentPath && currentPath.endsWith(\"*\") && currentMatch.params[\"*\"] !== match.params[\"*\"]\n  );\n}\n\nfunction shouldRevalidateLoader(currentLocation, currentMatch, submission, location, match, isRevalidationRequired, actionResult) {\n  let currentUrl = createURL(currentLocation);\n  let currentParams = currentMatch.params;\n  let nextUrl = createURL(location);\n  let nextParams = match.params; // This is the default implementation as to when we revalidate.  If the route\n  // provides it's own implementation, then we give them full control but\n  // provide this value so they can leverage it if needed after they check\n  // their own specific use cases\n  // Note that fetchers always provide the same current/next locations so the\n  // URL-based checks here don't apply to fetcher shouldRevalidate calls\n\n  let defaultShouldRevalidate = isNewRouteInstance(currentMatch, match) || // Clicked the same link, resubmitted a GET form\n  currentUrl.toString() === nextUrl.toString() || // Search params affect all loaders\n  currentUrl.search !== nextUrl.search || // Forced revalidation due to submission, useRevalidate, or X-Remix-Revalidate\n  isRevalidationRequired;\n\n  if (match.route.shouldRevalidate) {\n    let routeChoice = match.route.shouldRevalidate(_extends({\n      currentUrl,\n      currentParams,\n      nextUrl,\n      nextParams\n    }, submission, {\n      actionResult,\n      defaultShouldRevalidate\n    }));\n\n    if (typeof routeChoice === \"boolean\") {\n      return routeChoice;\n    }\n  }\n\n  return defaultShouldRevalidate;\n}\n\nasync function callLoaderOrAction(type, request, match, skipRedirects, isRouteRequest) {\n  if (skipRedirects === void 0) {\n    skipRedirects = false;\n  }\n\n  if (isRouteRequest === void 0) {\n    isRouteRequest = false;\n  }\n\n  let resultType;\n  let result; // Setup a promise we can race against so that abort signals short circuit\n\n  let reject;\n  let abortPromise = new Promise((_, r) => reject = r);\n\n  let onReject = () => reject();\n\n  request.signal.addEventListener(\"abort\", onReject);\n\n  try {\n    let handler = match.route[type];\n    invariant(handler, \"Could not find the \" + type + \" to run on the \\\"\" + match.route.id + \"\\\" route\");\n    result = await Promise.race([handler({\n      request,\n      params: match.params\n    }), abortPromise]);\n  } catch (e) {\n    resultType = ResultType.error;\n    result = e;\n  } finally {\n    request.signal.removeEventListener(\"abort\", onReject);\n  }\n\n  if (result instanceof Response) {\n    // Process redirects\n    let status = result.status;\n    let location = result.headers.get(\"Location\"); // For SSR single-route requests, we want to hand Responses back directly\n    // without unwrapping\n\n    if (isRouteRequest) {\n      throw result;\n    }\n\n    if (status >= 300 && status <= 399 && location != null) {\n      // Don't process redirects in the router during SSR document requests.\n      // Instead, throw the Response and let the server handle it with an HTTP\n      // redirect\n      if (skipRedirects) {\n        throw result;\n      }\n\n      return {\n        type: ResultType.redirect,\n        status,\n        location,\n        revalidate: result.headers.get(\"X-Remix-Revalidate\") !== null\n      };\n    }\n\n    let data;\n    let contentType = result.headers.get(\"Content-Type\");\n\n    if (contentType && contentType.startsWith(\"application/json\")) {\n      data = await result.json();\n    } else {\n      data = await result.text();\n    }\n\n    if (resultType === ResultType.error) {\n      return {\n        type: resultType,\n        error: new ErrorResponse(status, result.statusText, data),\n        headers: result.headers\n      };\n    }\n\n    return {\n      type: ResultType.data,\n      data,\n      statusCode: result.status,\n      headers: result.headers\n    };\n  }\n\n  if (resultType === ResultType.error) {\n    return {\n      type: resultType,\n      error: result\n    };\n  }\n\n  if (result instanceof DeferredData) {\n    return {\n      type: ResultType.deferred,\n      deferredData: result\n    };\n  }\n\n  return {\n    type: ResultType.data,\n    data: result\n  };\n}\n\nfunction createRequest(location, signal, submission) {\n  let url = createURL(location).toString();\n  let init = {\n    signal\n  };\n\n  if (submission) {\n    let {\n      formMethod,\n      formEncType,\n      formData\n    } = submission;\n    init.method = formMethod.toUpperCase();\n    init.body = formEncType === \"application/x-www-form-urlencoded\" ? convertFormDataToSearchParams(formData) : formData;\n  } // Content-Type is inferred (https://fetch.spec.whatwg.org/#dom-request)\n\n\n  return new Request(url, init);\n}\n\nfunction convertFormDataToSearchParams(formData) {\n  let searchParams = new URLSearchParams();\n\n  for (let [key, value] of formData.entries()) {\n    invariant(typeof value === \"string\", 'File inputs are not supported with encType \"application/x-www-form-urlencoded\", ' + 'please use \"multipart/form-data\" instead.');\n    searchParams.append(key, value);\n  }\n\n  return searchParams;\n}\n\nfunction processRouteLoaderData(matches, matchesToLoad, results, pendingError, activeDeferreds) {\n  // Fill in loaderData/errors from our loaders\n  let loaderData = {};\n  let errors = null;\n  let statusCode;\n  let foundError = false;\n  let loaderHeaders = {}; // Process loader results into state.loaderData/state.errors\n\n  results.forEach((result, index) => {\n    let id = matchesToLoad[index].route.id;\n    invariant(!isRedirectResult(result), \"Cannot handle redirect results in processLoaderData\");\n\n    if (isErrorResult(result)) {\n      // Look upwards from the matched route for the closest ancestor\n      // error boundary, defaulting to the root match\n      let boundaryMatch = findNearestBoundary(matches, id);\n      let error = result.error; // If we have a pending action error, we report it at the highest-route\n      // that throws a loader error, and then clear it out to indicate that\n      // it was consumed\n\n      if (pendingError) {\n        error = Object.values(pendingError)[0];\n        pendingError = undefined;\n      }\n\n      errors = Object.assign(errors || {}, {\n        [boundaryMatch.route.id]: error\n      }); // Once we find our first (highest) error, we set the status code and\n      // prevent deeper status codes from overriding\n\n      if (!foundError) {\n        foundError = true;\n        statusCode = isRouteErrorResponse(result.error) ? result.error.status : 500;\n      }\n\n      if (result.headers) {\n        loaderHeaders[id] = result.headers;\n      }\n    } else if (isDeferredResult(result)) {\n      activeDeferreds && activeDeferreds.set(id, result.deferredData);\n      loaderData[id] = result.deferredData.data; // TODO: Add statusCode/headers once we wire up streaming in Remix\n    } else {\n      loaderData[id] = result.data; // Error status codes always override success status codes, but if all\n      // loaders are successful we take the deepest status code.\n\n      if (result.statusCode !== 200 && !foundError) {\n        statusCode = result.statusCode;\n      }\n\n      if (result.headers) {\n        loaderHeaders[id] = result.headers;\n      }\n    }\n  }); // If we didn't consume the pending action error (i.e., all loaders\n  // resolved), then consume it here\n\n  if (pendingError) {\n    errors = pendingError;\n  }\n\n  return {\n    loaderData,\n    errors,\n    statusCode: statusCode || 200,\n    loaderHeaders\n  };\n}\n\nfunction processLoaderData(state, matches, matchesToLoad, results, pendingError, revalidatingFetchers, fetcherResults, activeDeferreds) {\n  let {\n    loaderData,\n    errors\n  } = processRouteLoaderData(matches, matchesToLoad, results, pendingError, activeDeferreds); // Process results from our revalidating fetchers\n\n  for (let index = 0; index < revalidatingFetchers.length; index++) {\n    let [key,, match] = revalidatingFetchers[index];\n    invariant(fetcherResults !== undefined && fetcherResults[index] !== undefined, \"Did not find corresponding fetcher result\");\n    let result = fetcherResults[index]; // Process fetcher non-redirect errors\n\n    if (isErrorResult(result)) {\n      let boundaryMatch = findNearestBoundary(state.matches, match.route.id);\n\n      if (!(errors && errors[boundaryMatch.route.id])) {\n        errors = _extends({}, errors, {\n          [boundaryMatch.route.id]: result.error\n        });\n      }\n\n      state.fetchers.delete(key);\n    } else if (isRedirectResult(result)) {\n      // Should never get here, redirects should get processed above, but we\n      // keep this to type narrow to a success result in the else\n      throw new Error(\"Unhandled fetcher revalidation redirect\");\n    } else if (isDeferredResult(result)) {\n      // Should never get here, deferred data should be awaited for fetchers\n      // in resolveDeferredResults\n      throw new Error(\"Unhandled fetcher deferred data\");\n    } else {\n      let doneFetcher = {\n        state: \"idle\",\n        data: result.data,\n        formMethod: undefined,\n        formAction: undefined,\n        formEncType: undefined,\n        formData: undefined\n      };\n      state.fetchers.set(key, doneFetcher);\n    }\n  }\n\n  return {\n    loaderData,\n    errors\n  };\n}\n\nfunction mergeLoaderData(loaderData, newLoaderData, matches) {\n  let mergedLoaderData = _extends({}, newLoaderData);\n\n  matches.forEach(match => {\n    let id = match.route.id;\n\n    if (newLoaderData[id] === undefined && loaderData[id] !== undefined) {\n      mergedLoaderData[id] = loaderData[id];\n    }\n  });\n  return mergedLoaderData;\n} // Find the nearest error boundary, looking upwards from the leaf route (or the\n// route specified by routeId) for the closest ancestor error boundary,\n// defaulting to the root match\n\n\nfunction findNearestBoundary(matches, routeId) {\n  let eligibleMatches = routeId ? matches.slice(0, matches.findIndex(m => m.route.id === routeId) + 1) : [...matches];\n  return eligibleMatches.reverse().find(m => m.route.hasErrorBoundary === true) || matches[0];\n}\n\nfunction getNotFoundMatches(routes) {\n  // Prefer a root layout route if present, otherwise shim in a route object\n  let route = routes.find(r => r.index || r.path === \"\" || r.path === \"/\") || {\n    id: \"__shim-404-route__\"\n  };\n  return {\n    matches: [{\n      params: {},\n      pathname: \"\",\n      pathnameBase: \"\",\n      route\n    }],\n    route,\n    error: new ErrorResponse(404, \"Not Found\", null)\n  };\n}\n\nfunction getMethodNotAllowedResult(path) {\n  let href = typeof path === \"string\" ? path : createHref(path);\n  console.warn(\"You're trying to submit to a route that does not have an action.  To \" + \"fix this, please add an `action` function to the route for \" + (\"[\" + href + \"]\"));\n  return {\n    type: ResultType.error,\n    error: new ErrorResponse(405, \"Method Not Allowed\", \"No action found for [\" + href + \"]\")\n  };\n} // Find any returned redirect errors, starting from the lowest match\n\n\nfunction findRedirect(results) {\n  for (let i = results.length - 1; i >= 0; i--) {\n    let result = results[i];\n\n    if (isRedirectResult(result)) {\n      return result;\n    }\n  }\n} // Create an href to represent a \"server\" URL without the hash\n\n\nfunction createHref(location) {\n  return (location.pathname || \"\") + (location.search || \"\");\n}\n\nfunction isHashChangeOnly(a, b) {\n  return a.pathname === b.pathname && a.search === b.search && a.hash !== b.hash;\n}\n\nfunction isDeferredResult(result) {\n  return result.type === ResultType.deferred;\n}\n\nfunction isErrorResult(result) {\n  return result.type === ResultType.error;\n}\n\nfunction isRedirectResult(result) {\n  return (result && result.type) === ResultType.redirect;\n}\n\nasync function resolveDeferredResults(currentMatches, matchesToLoad, results, signal, isFetcher, currentLoaderData) {\n  for (let index = 0; index < results.length; index++) {\n    let result = results[index];\n    let match = matchesToLoad[index];\n    let currentMatch = currentMatches.find(m => m.route.id === match.route.id);\n    let isRevalidatingLoader = currentMatch != null && !isNewRouteInstance(currentMatch, match) && (currentLoaderData && currentLoaderData[match.route.id]) !== undefined;\n\n    if (isDeferredResult(result) && (isFetcher || isRevalidatingLoader)) {\n      // Note: we do not have to touch activeDeferreds here since we race them\n      // against the signal in resolveDeferredData and they'll get aborted\n      // there if needed\n      await resolveDeferredData(result, signal, isFetcher).then(result => {\n        if (result) {\n          results[index] = result || results[index];\n        }\n      });\n    }\n  }\n}\n\nasync function resolveDeferredData(result, signal, unwrap) {\n  if (unwrap === void 0) {\n    unwrap = false;\n  }\n\n  let aborted = await result.deferredData.resolveData(signal);\n\n  if (aborted) {\n    return;\n  }\n\n  if (unwrap) {\n    try {\n      return {\n        type: ResultType.data,\n        data: result.deferredData.unwrappedData\n      };\n    } catch (e) {\n      // Handle any TrackedPromise._error values encountered while unwrapping\n      return {\n        type: ResultType.error,\n        error: e\n      };\n    }\n  }\n\n  return {\n    type: ResultType.data,\n    data: result.deferredData.data\n  };\n}\n\nfunction hasNakedIndexQuery(search) {\n  return new URLSearchParams(search).getAll(\"index\").some(v => v === \"\");\n} // Note: This should match the format exported by useMatches, so if you change\n// this please also change that :)  Eventually we'll DRY this up\n\n\nfunction createUseMatchesMatch(match, loaderData) {\n  let {\n    route,\n    pathname,\n    params\n  } = match;\n  return {\n    id: route.id,\n    pathname,\n    params,\n    data: loaderData[route.id],\n    handle: route.handle\n  };\n}\n\nfunction getTargetMatch(matches, location) {\n  let search = typeof location === \"string\" ? parsePath(location).search : location.search;\n\n  if (matches[matches.length - 1].route.index && !hasNakedIndexQuery(search || \"\")) {\n    return matches.slice(-2)[0];\n  }\n\n  return matches.slice(-1)[0];\n}\n\nfunction createURL(location) {\n  let base = typeof window !== \"undefined\" && typeof window.location !== \"undefined\" ? window.location.origin : \"unknown://unknown\";\n  let href = typeof location === \"string\" ? location : createHref(location);\n  return new URL(href, base);\n} //#endregion\n\nexport { AbortedDeferredError, Action, ErrorResponse, IDLE_FETCHER, IDLE_NAVIGATION, convertRoutesToDataRoutes as UNSAFE_convertRoutesToDataRoutes, createBrowserHistory, createHashHistory, createMemoryHistory, createPath, createRouter, defer, generatePath, getStaticContextFromError, getToPathname, invariant, isRouteErrorResponse, joinPaths, json, matchPath, matchRoutes, normalizePathname, parsePath, redirect, resolvePath, resolveTo, stripBasename, unstable_createStaticHandler, warning };\n//# sourceMappingURL=router.js.map\n","/**\n * React Router v6.4.1\n *\n * Copyright (c) Remix Software Inc.\n *\n * This source code is licensed under the MIT license found in the\n * LICENSE.md file in the root directory of this source tree.\n *\n * @license MIT\n */\nimport { invariant, resolveTo, joinPaths, matchPath, warning, parsePath, matchRoutes, Action, isRouteErrorResponse, createMemoryHistory, stripBasename, AbortedDeferredError, createRouter } from '@remix-run/router';\nexport { AbortedDeferredError, Action as NavigationType, createPath, defer, generatePath, isRouteErrorResponse, json, matchPath, matchRoutes, parsePath, redirect, resolvePath } from '@remix-run/router';\nimport * as React from 'react';\n\nfunction _extends() {\n  _extends = Object.assign ? Object.assign.bind() : function (target) {\n    for (var i = 1; i < arguments.length; i++) {\n      var source = arguments[i];\n\n      for (var key in source) {\n        if (Object.prototype.hasOwnProperty.call(source, key)) {\n          target[key] = source[key];\n        }\n      }\n    }\n\n    return target;\n  };\n  return _extends.apply(this, arguments);\n}\n\n/**\n * Copyright (c) Facebook, Inc. and its affiliates.\n *\n * This source code is licensed under the MIT license found in the\n * LICENSE file in the root directory of this source tree.\n */\n/**\n * inlined Object.is polyfill to avoid requiring consumers ship their own\n * https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object/is\n */\n\nfunction isPolyfill(x, y) {\n  return x === y && (x !== 0 || 1 / x === 1 / y) || x !== x && y !== y // eslint-disable-line no-self-compare\n  ;\n}\n\nconst is = typeof Object.is === \"function\" ? Object.is : isPolyfill; // Intentionally not using named imports because Rollup uses dynamic\n// dispatch for CommonJS interop named imports.\n\nconst {\n  useState,\n  useEffect,\n  useLayoutEffect,\n  useDebugValue\n} = React;\nlet didWarnOld18Alpha = false;\nlet didWarnUncachedGetSnapshot = false; // Disclaimer: This shim breaks many of the rules of React, and only works\n// because of a very particular set of implementation details and assumptions\n// -- change any one of them and it will break. The most important assumption\n// is that updates are always synchronous, because concurrent rendering is\n// only available in versions of React that also have a built-in\n// useSyncExternalStore API. And we only use this shim when the built-in API\n// does not exist.\n//\n// Do not assume that the clever hacks used by this hook also work in general.\n// The point of this shim is to replace the need for hacks by other libraries.\n\nfunction useSyncExternalStore$2(subscribe, getSnapshot, // Note: The shim does not use getServerSnapshot, because pre-18 versions of\n// React do not expose a way to check if we're hydrating. So users of the shim\n// will need to track that themselves and return the correct value\n// from `getSnapshot`.\ngetServerSnapshot) {\n  if (process.env.NODE_ENV !== \"production\") {\n    if (!didWarnOld18Alpha) {\n      if (\"startTransition\" in React) {\n        didWarnOld18Alpha = true;\n        console.error(\"You are using an outdated, pre-release alpha of React 18 that \" + \"does not support useSyncExternalStore. The \" + \"use-sync-external-store shim will not work correctly. Upgrade \" + \"to a newer pre-release.\");\n      }\n    }\n  } // Read the current snapshot from the store on every render. Again, this\n  // breaks the rules of React, and only works here because of specific\n  // implementation details, most importantly that updates are\n  // always synchronous.\n\n\n  const value = getSnapshot();\n\n  if (process.env.NODE_ENV !== \"production\") {\n    if (!didWarnUncachedGetSnapshot) {\n      const cachedValue = getSnapshot();\n\n      if (!is(value, cachedValue)) {\n        console.error(\"The result of getSnapshot should be cached to avoid an infinite loop\");\n        didWarnUncachedGetSnapshot = true;\n      }\n    }\n  } // Because updates are synchronous, we don't queue them. Instead we force a\n  // re-render whenever the subscribed state changes by updating an some\n  // arbitrary useState hook. Then, during render, we call getSnapshot to read\n  // the current value.\n  //\n  // Because we don't actually use the state returned by the useState hook, we\n  // can save a bit of memory by storing other stuff in that slot.\n  //\n  // To implement the early bailout, we need to track some things on a mutable\n  // object. Usually, we would put that in a useRef hook, but we can stash it in\n  // our useState hook instead.\n  //\n  // To force a re-render, we call forceUpdate({inst}). That works because the\n  // new object always fails an equality check.\n\n\n  const [{\n    inst\n  }, forceUpdate] = useState({\n    inst: {\n      value,\n      getSnapshot\n    }\n  }); // Track the latest getSnapshot function with a ref. This needs to be updated\n  // in the layout phase so we can access it during the tearing check that\n  // happens on subscribe.\n\n  useLayoutEffect(() => {\n    inst.value = value;\n    inst.getSnapshot = getSnapshot; // Whenever getSnapshot or subscribe changes, we need to check in the\n    // commit phase if there was an interleaved mutation. In concurrent mode\n    // this can happen all the time, but even in synchronous mode, an earlier\n    // effect may have mutated the store.\n\n    if (checkIfSnapshotChanged(inst)) {\n      // Force a re-render.\n      forceUpdate({\n        inst\n      });\n    } // eslint-disable-next-line react-hooks/exhaustive-deps\n\n  }, [subscribe, value, getSnapshot]);\n  useEffect(() => {\n    // Check for changes right before subscribing. Subsequent changes will be\n    // detected in the subscription handler.\n    if (checkIfSnapshotChanged(inst)) {\n      // Force a re-render.\n      forceUpdate({\n        inst\n      });\n    }\n\n    const handleStoreChange = () => {\n      // TODO: Because there is no cross-renderer API for batching updates, it's\n      // up to the consumer of this library to wrap their subscription event\n      // with unstable_batchedUpdates. Should we try to detect when this isn't\n      // the case and print a warning in development?\n      // The store changed. Check if the snapshot changed since the last time we\n      // read from the store.\n      if (checkIfSnapshotChanged(inst)) {\n        // Force a re-render.\n        forceUpdate({\n          inst\n        });\n      }\n    }; // Subscribe to the store and return a clean-up function.\n\n\n    return subscribe(handleStoreChange); // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [subscribe]);\n  useDebugValue(value);\n  return value;\n}\n\nfunction checkIfSnapshotChanged(inst) {\n  const latestGetSnapshot = inst.getSnapshot;\n  const prevValue = inst.value;\n\n  try {\n    const nextValue = latestGetSnapshot();\n    return !is(prevValue, nextValue);\n  } catch (error) {\n    return true;\n  }\n}\n\n/**\n * Copyright (c) Facebook, Inc. and its affiliates.\n *\n * This source code is licensed under the MIT license found in the\n * LICENSE file in the root directory of this source tree.\n *\n * @flow\n */\nfunction useSyncExternalStore$1(subscribe, getSnapshot, getServerSnapshot) {\n  // Note: The shim does not use getServerSnapshot, because pre-18 versions of\n  // React do not expose a way to check if we're hydrating. So users of the shim\n  // will need to track that themselves and return the correct value\n  // from `getSnapshot`.\n  return getSnapshot();\n}\n\n/**\n * Inlined into the react-router repo since use-sync-external-store does not\n * provide a UMD-compatible package, so we need this to be able to distribute\n * UMD react-router bundles\n */\nconst canUseDOM = !!(typeof window !== \"undefined\" && typeof window.document !== \"undefined\" && typeof window.document.createElement !== \"undefined\");\nconst isServerEnvironment = !canUseDOM;\nconst shim = isServerEnvironment ? useSyncExternalStore$1 : useSyncExternalStore$2;\nconst useSyncExternalStore = \"useSyncExternalStore\" in React ? (module => module.useSyncExternalStore)(React) : shim;\n\n// Contexts for data routers\nconst DataStaticRouterContext = /*#__PURE__*/React.createContext(null);\n\nif (process.env.NODE_ENV !== \"production\") {\n  DataStaticRouterContext.displayName = \"DataStaticRouterContext\";\n}\n\nconst DataRouterContext = /*#__PURE__*/React.createContext(null);\n\nif (process.env.NODE_ENV !== \"production\") {\n  DataRouterContext.displayName = \"DataRouter\";\n}\n\nconst DataRouterStateContext = /*#__PURE__*/React.createContext(null);\n\nif (process.env.NODE_ENV !== \"production\") {\n  DataRouterStateContext.displayName = \"DataRouterState\";\n}\n\nconst AwaitContext = /*#__PURE__*/React.createContext(null);\n\nif (process.env.NODE_ENV !== \"production\") {\n  AwaitContext.displayName = \"Await\";\n}\n\nconst NavigationContext = /*#__PURE__*/React.createContext(null);\n\nif (process.env.NODE_ENV !== \"production\") {\n  NavigationContext.displayName = \"Navigation\";\n}\n\nconst LocationContext = /*#__PURE__*/React.createContext(null);\n\nif (process.env.NODE_ENV !== \"production\") {\n  LocationContext.displayName = \"Location\";\n}\n\nconst RouteContext = /*#__PURE__*/React.createContext({\n  outlet: null,\n  matches: []\n});\n\nif (process.env.NODE_ENV !== \"production\") {\n  RouteContext.displayName = \"Route\";\n}\n\nconst RouteErrorContext = /*#__PURE__*/React.createContext(null);\n\nif (process.env.NODE_ENV !== \"production\") {\n  RouteErrorContext.displayName = \"RouteError\";\n}\n\n/**\n * Returns the full href for the given \"to\" value. This is useful for building\n * custom links that are also accessible and preserve right-click behavior.\n *\n * @see https://reactrouter.com/docs/en/v6/hooks/use-href\n */\n\nfunction useHref(to, _temp) {\n  let {\n    relative\n  } = _temp === void 0 ? {} : _temp;\n  !useInRouterContext() ? process.env.NODE_ENV !== \"production\" ? invariant(false, // TODO: This error is probably because they somehow have 2 versions of the\n  // router loaded. We can help them understand how to avoid that.\n  \"useHref() may be used only in the context of a <Router> component.\") : invariant(false) : void 0;\n  let {\n    basename,\n    navigator\n  } = React.useContext(NavigationContext);\n  let {\n    hash,\n    pathname,\n    search\n  } = useResolvedPath(to, {\n    relative\n  });\n  let joinedPathname = pathname; // If we're operating within a basename, prepend it to the pathname prior\n  // to creating the href.  If this is a root navigation, then just use the raw\n  // basename which allows the basename to have full control over the presence\n  // of a trailing slash on root links\n\n  if (basename !== \"/\") {\n    joinedPathname = pathname === \"/\" ? basename : joinPaths([basename, pathname]);\n  }\n\n  return navigator.createHref({\n    pathname: joinedPathname,\n    search,\n    hash\n  });\n}\n/**\n * Returns true if this component is a descendant of a <Router>.\n *\n * @see https://reactrouter.com/docs/en/v6/hooks/use-in-router-context\n */\n\nfunction useInRouterContext() {\n  return React.useContext(LocationContext) != null;\n}\n/**\n * Returns the current location object, which represents the current URL in web\n * browsers.\n *\n * Note: If you're using this it may mean you're doing some of your own\n * \"routing\" in your app, and we'd like to know what your use case is. We may\n * be able to provide something higher-level to better suit your needs.\n *\n * @see https://reactrouter.com/docs/en/v6/hooks/use-location\n */\n\nfunction useLocation() {\n  !useInRouterContext() ? process.env.NODE_ENV !== \"production\" ? invariant(false, // TODO: This error is probably because they somehow have 2 versions of the\n  // router loaded. We can help them understand how to avoid that.\n  \"useLocation() may be used only in the context of a <Router> component.\") : invariant(false) : void 0;\n  return React.useContext(LocationContext).location;\n}\n/**\n * Returns the current navigation action which describes how the router came to\n * the current location, either by a pop, push, or replace on the history stack.\n *\n * @see https://reactrouter.com/docs/en/v6/hooks/use-navigation-type\n */\n\nfunction useNavigationType() {\n  return React.useContext(LocationContext).navigationType;\n}\n/**\n * Returns true if the URL for the given \"to\" value matches the current URL.\n * This is useful for components that need to know \"active\" state, e.g.\n * <NavLink>.\n *\n * @see https://reactrouter.com/docs/en/v6/hooks/use-match\n */\n\nfunction useMatch(pattern) {\n  !useInRouterContext() ? process.env.NODE_ENV !== \"production\" ? invariant(false, // TODO: This error is probably because they somehow have 2 versions of the\n  // router loaded. We can help them understand how to avoid that.\n  \"useMatch() may be used only in the context of a <Router> component.\") : invariant(false) : void 0;\n  let {\n    pathname\n  } = useLocation();\n  return React.useMemo(() => matchPath(pattern, pathname), [pathname, pattern]);\n}\n/**\n * The interface for the navigate() function returned from useNavigate().\n */\n\n/**\n * When processing relative navigation we want to ignore ancestor routes that\n * do not contribute to the path, such that index/pathless layout routes don't\n * interfere.\n *\n * For example, when moving a route element into an index route and/or a\n * pathless layout route, relative link behavior contained within should stay\n * the same.  Both of the following examples should link back to the root:\n *\n *   <Route path=\"/\">\n *     <Route path=\"accounts\" element={<Link to=\"..\"}>\n *   </Route>\n *\n *   <Route path=\"/\">\n *     <Route path=\"accounts\">\n *       <Route element={<AccountsLayout />}>       // <-- Does not contribute\n *         <Route index element={<Link to=\"..\"} />  // <-- Does not contribute\n *       </Route\n *     </Route>\n *   </Route>\n */\nfunction getPathContributingMatches(matches) {\n  return matches.filter((match, index) => index === 0 || !match.route.index && match.pathnameBase !== matches[index - 1].pathnameBase);\n}\n/**\n * Returns an imperative method for changing the location. Used by <Link>s, but\n * may also be used by other elements to change the location.\n *\n * @see https://reactrouter.com/docs/en/v6/hooks/use-navigate\n */\n\n\nfunction useNavigate() {\n  !useInRouterContext() ? process.env.NODE_ENV !== \"production\" ? invariant(false, // TODO: This error is probably because they somehow have 2 versions of the\n  // router loaded. We can help them understand how to avoid that.\n  \"useNavigate() may be used only in the context of a <Router> component.\") : invariant(false) : void 0;\n  let {\n    basename,\n    navigator\n  } = React.useContext(NavigationContext);\n  let {\n    matches\n  } = React.useContext(RouteContext);\n  let {\n    pathname: locationPathname\n  } = useLocation();\n  let routePathnamesJson = JSON.stringify(getPathContributingMatches(matches).map(match => match.pathnameBase));\n  let activeRef = React.useRef(false);\n  React.useEffect(() => {\n    activeRef.current = true;\n  });\n  let navigate = React.useCallback(function (to, options) {\n    if (options === void 0) {\n      options = {};\n    }\n\n    process.env.NODE_ENV !== \"production\" ? warning(activeRef.current, \"You should call navigate() in a React.useEffect(), not when \" + \"your component is first rendered.\") : void 0;\n    if (!activeRef.current) return;\n\n    if (typeof to === \"number\") {\n      navigator.go(to);\n      return;\n    }\n\n    let path = resolveTo(to, JSON.parse(routePathnamesJson), locationPathname, options.relative === \"path\"); // If we're operating within a basename, prepend it to the pathname prior\n    // to handing off to history.  If this is a root navigation, then we\n    // navigate to the raw basename which allows the basename to have full\n    // control over the presence of a trailing slash on root links\n\n    if (basename !== \"/\") {\n      path.pathname = path.pathname === \"/\" ? basename : joinPaths([basename, path.pathname]);\n    }\n\n    (!!options.replace ? navigator.replace : navigator.push)(path, options.state, options);\n  }, [basename, navigator, routePathnamesJson, locationPathname]);\n  return navigate;\n}\nconst OutletContext = /*#__PURE__*/React.createContext(null);\n/**\n * Returns the context (if provided) for the child route at this level of the route\n * hierarchy.\n * @see https://reactrouter.com/docs/en/v6/hooks/use-outlet-context\n */\n\nfunction useOutletContext() {\n  return React.useContext(OutletContext);\n}\n/**\n * Returns the element for the child route at this level of the route\n * hierarchy. Used internally by <Outlet> to render child routes.\n *\n * @see https://reactrouter.com/docs/en/v6/hooks/use-outlet\n */\n\nfunction useOutlet(context) {\n  let outlet = React.useContext(RouteContext).outlet;\n\n  if (outlet) {\n    return /*#__PURE__*/React.createElement(OutletContext.Provider, {\n      value: context\n    }, outlet);\n  }\n\n  return outlet;\n}\n/**\n * Returns an object of key/value pairs of the dynamic params from the current\n * URL that were matched by the route path.\n *\n * @see https://reactrouter.com/docs/en/v6/hooks/use-params\n */\n\nfunction useParams() {\n  let {\n    matches\n  } = React.useContext(RouteContext);\n  let routeMatch = matches[matches.length - 1];\n  return routeMatch ? routeMatch.params : {};\n}\n/**\n * Resolves the pathname of the given `to` value against the current location.\n *\n * @see https://reactrouter.com/docs/en/v6/hooks/use-resolved-path\n */\n\nfunction useResolvedPath(to, _temp2) {\n  let {\n    relative\n  } = _temp2 === void 0 ? {} : _temp2;\n  let {\n    matches\n  } = React.useContext(RouteContext);\n  let {\n    pathname: locationPathname\n  } = useLocation();\n  let routePathnamesJson = JSON.stringify(getPathContributingMatches(matches).map(match => match.pathnameBase));\n  return React.useMemo(() => resolveTo(to, JSON.parse(routePathnamesJson), locationPathname, relative === \"path\"), [to, routePathnamesJson, locationPathname, relative]);\n}\n/**\n * Returns the element of the route that matched the current location, prepared\n * with the correct context to render the remainder of the route tree. Route\n * elements in the tree must render an <Outlet> to render their child route's\n * element.\n *\n * @see https://reactrouter.com/docs/en/v6/hooks/use-routes\n */\n\nfunction useRoutes(routes, locationArg) {\n  !useInRouterContext() ? process.env.NODE_ENV !== \"production\" ? invariant(false, // TODO: This error is probably because they somehow have 2 versions of the\n  // router loaded. We can help them understand how to avoid that.\n  \"useRoutes() may be used only in the context of a <Router> component.\") : invariant(false) : void 0;\n  let dataRouterStateContext = React.useContext(DataRouterStateContext);\n  let {\n    matches: parentMatches\n  } = React.useContext(RouteContext);\n  let routeMatch = parentMatches[parentMatches.length - 1];\n  let parentParams = routeMatch ? routeMatch.params : {};\n  let parentPathname = routeMatch ? routeMatch.pathname : \"/\";\n  let parentPathnameBase = routeMatch ? routeMatch.pathnameBase : \"/\";\n  let parentRoute = routeMatch && routeMatch.route;\n\n  if (process.env.NODE_ENV !== \"production\") {\n    // You won't get a warning about 2 different <Routes> under a <Route>\n    // without a trailing *, but this is a best-effort warning anyway since we\n    // cannot even give the warning unless they land at the parent route.\n    //\n    // Example:\n    //\n    // <Routes>\n    //   {/* This route path MUST end with /* because otherwise\n    //       it will never match /blog/post/123 */}\n    //   <Route path=\"blog\" element={<Blog />} />\n    //   <Route path=\"blog/feed\" element={<BlogFeed />} />\n    // </Routes>\n    //\n    // function Blog() {\n    //   return (\n    //     <Routes>\n    //       <Route path=\"post/:id\" element={<Post />} />\n    //     </Routes>\n    //   );\n    // }\n    let parentPath = parentRoute && parentRoute.path || \"\";\n    warningOnce(parentPathname, !parentRoute || parentPath.endsWith(\"*\"), \"You rendered descendant <Routes> (or called `useRoutes()`) at \" + (\"\\\"\" + parentPathname + \"\\\" (under <Route path=\\\"\" + parentPath + \"\\\">) but the \") + \"parent route path has no trailing \\\"*\\\". This means if you navigate \" + \"deeper, the parent won't match anymore and therefore the child \" + \"routes will never render.\\n\\n\" + (\"Please change the parent <Route path=\\\"\" + parentPath + \"\\\"> to <Route \") + (\"path=\\\"\" + (parentPath === \"/\" ? \"*\" : parentPath + \"/*\") + \"\\\">.\"));\n  }\n\n  let locationFromContext = useLocation();\n  let location;\n\n  if (locationArg) {\n    var _parsedLocationArg$pa;\n\n    let parsedLocationArg = typeof locationArg === \"string\" ? parsePath(locationArg) : locationArg;\n    !(parentPathnameBase === \"/\" || ((_parsedLocationArg$pa = parsedLocationArg.pathname) == null ? void 0 : _parsedLocationArg$pa.startsWith(parentPathnameBase))) ? process.env.NODE_ENV !== \"production\" ? invariant(false, \"When overriding the location using `<Routes location>` or `useRoutes(routes, location)`, \" + \"the location pathname must begin with the portion of the URL pathname that was \" + (\"matched by all parent routes. The current pathname base is \\\"\" + parentPathnameBase + \"\\\" \") + (\"but pathname \\\"\" + parsedLocationArg.pathname + \"\\\" was given in the `location` prop.\")) : invariant(false) : void 0;\n    location = parsedLocationArg;\n  } else {\n    location = locationFromContext;\n  }\n\n  let pathname = location.pathname || \"/\";\n  let remainingPathname = parentPathnameBase === \"/\" ? pathname : pathname.slice(parentPathnameBase.length) || \"/\";\n  let matches = matchRoutes(routes, {\n    pathname: remainingPathname\n  });\n\n  if (process.env.NODE_ENV !== \"production\") {\n    process.env.NODE_ENV !== \"production\" ? warning(parentRoute || matches != null, \"No routes matched location \\\"\" + location.pathname + location.search + location.hash + \"\\\" \") : void 0;\n    process.env.NODE_ENV !== \"production\" ? warning(matches == null || matches[matches.length - 1].route.element !== undefined, \"Matched leaf route at location \\\"\" + location.pathname + location.search + location.hash + \"\\\" does not have an element. \" + \"This means it will render an <Outlet /> with a null value by default resulting in an \\\"empty\\\" page.\") : void 0;\n  }\n\n  let renderedMatches = _renderMatches(matches && matches.map(match => Object.assign({}, match, {\n    params: Object.assign({}, parentParams, match.params),\n    pathname: joinPaths([parentPathnameBase, match.pathname]),\n    pathnameBase: match.pathnameBase === \"/\" ? parentPathnameBase : joinPaths([parentPathnameBase, match.pathnameBase])\n  })), parentMatches, dataRouterStateContext || undefined); // When a user passes in a `locationArg`, the associated routes need to\n  // be wrapped in a new `LocationContext.Provider` in order for `useLocation`\n  // to use the scoped location instead of the global location.\n\n\n  if (locationArg) {\n    return /*#__PURE__*/React.createElement(LocationContext.Provider, {\n      value: {\n        location: _extends({\n          pathname: \"/\",\n          search: \"\",\n          hash: \"\",\n          state: null,\n          key: \"default\"\n        }, location),\n        navigationType: Action.Pop\n      }\n    }, renderedMatches);\n  }\n\n  return renderedMatches;\n}\n\nfunction DefaultErrorElement() {\n  let error = useRouteError();\n  let message = isRouteErrorResponse(error) ? error.status + \" \" + error.statusText : error instanceof Error ? error.message : JSON.stringify(error);\n  let stack = error instanceof Error ? error.stack : null;\n  let lightgrey = \"rgba(200,200,200, 0.5)\";\n  let preStyles = {\n    padding: \"0.5rem\",\n    backgroundColor: lightgrey\n  };\n  let codeStyles = {\n    padding: \"2px 4px\",\n    backgroundColor: lightgrey\n  };\n  return /*#__PURE__*/React.createElement(React.Fragment, null, /*#__PURE__*/React.createElement(\"h2\", null, \"Unhandled Thrown Error!\"), /*#__PURE__*/React.createElement(\"h3\", {\n    style: {\n      fontStyle: \"italic\"\n    }\n  }, message), stack ? /*#__PURE__*/React.createElement(\"pre\", {\n    style: preStyles\n  }, stack) : null, /*#__PURE__*/React.createElement(\"p\", null, \"\\uD83D\\uDCBF Hey developer \\uD83D\\uDC4B\"), /*#__PURE__*/React.createElement(\"p\", null, \"You can provide a way better UX than this when your app throws errors by providing your own\\xA0\", /*#__PURE__*/React.createElement(\"code\", {\n    style: codeStyles\n  }, \"errorElement\"), \" props on\\xA0\", /*#__PURE__*/React.createElement(\"code\", {\n    style: codeStyles\n  }, \"<Route>\")));\n}\n\nclass RenderErrorBoundary extends React.Component {\n  constructor(props) {\n    super(props);\n    this.state = {\n      location: props.location,\n      error: props.error\n    };\n  }\n\n  static getDerivedStateFromError(error) {\n    return {\n      error: error\n    };\n  }\n\n  static getDerivedStateFromProps(props, state) {\n    // When we get into an error state, the user will likely click \"back\" to the\n    // previous page that didn't have an error. Because this wraps the entire\n    // application, that will have no effect--the error page continues to display.\n    // This gives us a mechanism to recover from the error when the location changes.\n    //\n    // Whether we're in an error state or not, we update the location in state\n    // so that when we are in an error state, it gets reset when a new location\n    // comes in and the user recovers from the error.\n    if (state.location !== props.location) {\n      return {\n        error: props.error,\n        location: props.location\n      };\n    } // If we're not changing locations, preserve the location but still surface\n    // any new errors that may come through. We retain the existing error, we do\n    // this because the error provided from the app state may be cleared without\n    // the location changing.\n\n\n    return {\n      error: props.error || state.error,\n      location: state.location\n    };\n  }\n\n  componentDidCatch(error, errorInfo) {\n    console.error(\"React Router caught the following error during render\", error, errorInfo);\n  }\n\n  render() {\n    return this.state.error ? /*#__PURE__*/React.createElement(RouteErrorContext.Provider, {\n      value: this.state.error,\n      children: this.props.component\n    }) : this.props.children;\n  }\n\n}\n\nfunction RenderedRoute(_ref) {\n  let {\n    routeContext,\n    match,\n    children\n  } = _ref;\n  let dataStaticRouterContext = React.useContext(DataStaticRouterContext); // Track how deep we got in our render pass to emulate SSR componentDidCatch\n  // in a DataStaticRouter\n\n  if (dataStaticRouterContext && match.route.errorElement) {\n    dataStaticRouterContext._deepestRenderedBoundaryId = match.route.id;\n  }\n\n  return /*#__PURE__*/React.createElement(RouteContext.Provider, {\n    value: routeContext\n  }, children);\n}\n\nfunction _renderMatches(matches, parentMatches, dataRouterState) {\n  if (parentMatches === void 0) {\n    parentMatches = [];\n  }\n\n  if (matches == null) {\n    if (dataRouterState != null && dataRouterState.errors) {\n      // Don't bail if we have data router errors so we can render them in the\n      // boundary.  Use the pre-matched (or shimmed) matches\n      matches = dataRouterState.matches;\n    } else {\n      return null;\n    }\n  }\n\n  let renderedMatches = matches; // If we have data errors, trim matches to the highest error boundary\n\n  let errors = dataRouterState == null ? void 0 : dataRouterState.errors;\n\n  if (errors != null) {\n    let errorIndex = renderedMatches.findIndex(m => m.route.id && (errors == null ? void 0 : errors[m.route.id]));\n    !(errorIndex >= 0) ? process.env.NODE_ENV !== \"production\" ? invariant(false, \"Could not find a matching route for the current errors: \" + errors) : invariant(false) : void 0;\n    renderedMatches = renderedMatches.slice(0, Math.min(renderedMatches.length, errorIndex + 1));\n  }\n\n  return renderedMatches.reduceRight((outlet, match, index) => {\n    let error = match.route.id ? errors == null ? void 0 : errors[match.route.id] : null; // Only data routers handle errors\n\n    let errorElement = dataRouterState ? match.route.errorElement || /*#__PURE__*/React.createElement(DefaultErrorElement, null) : null;\n\n    let getChildren = () => /*#__PURE__*/React.createElement(RenderedRoute, {\n      match: match,\n      routeContext: {\n        outlet,\n        matches: parentMatches.concat(renderedMatches.slice(0, index + 1))\n      }\n    }, error ? errorElement : match.route.element !== undefined ? match.route.element : outlet); // Only wrap in an error boundary within data router usages when we have an\n    // errorElement on this route.  Otherwise let it bubble up to an ancestor\n    // errorElement\n\n\n    return dataRouterState && (match.route.errorElement || index === 0) ? /*#__PURE__*/React.createElement(RenderErrorBoundary, {\n      location: dataRouterState.location,\n      component: errorElement,\n      error: error,\n      children: getChildren()\n    }) : getChildren();\n  }, null);\n}\nvar DataRouterHook;\n\n(function (DataRouterHook) {\n  DataRouterHook[\"UseLoaderData\"] = \"useLoaderData\";\n  DataRouterHook[\"UseActionData\"] = \"useActionData\";\n  DataRouterHook[\"UseRouteError\"] = \"useRouteError\";\n  DataRouterHook[\"UseNavigation\"] = \"useNavigation\";\n  DataRouterHook[\"UseRouteLoaderData\"] = \"useRouteLoaderData\";\n  DataRouterHook[\"UseMatches\"] = \"useMatches\";\n  DataRouterHook[\"UseRevalidator\"] = \"useRevalidator\";\n})(DataRouterHook || (DataRouterHook = {}));\n\nfunction useDataRouterState(hookName) {\n  let state = React.useContext(DataRouterStateContext);\n  !state ? process.env.NODE_ENV !== \"production\" ? invariant(false, hookName + \" must be used within a DataRouterStateContext\") : invariant(false) : void 0;\n  return state;\n}\n/**\n * Returns the current navigation, defaulting to an \"idle\" navigation when\n * no navigation is in progress\n */\n\n\nfunction useNavigation() {\n  let state = useDataRouterState(DataRouterHook.UseNavigation);\n  return state.navigation;\n}\n/**\n * Returns a revalidate function for manually triggering revalidation, as well\n * as the current state of any manual revalidations\n */\n\nfunction useRevalidator() {\n  let dataRouterContext = React.useContext(DataRouterContext);\n  !dataRouterContext ? process.env.NODE_ENV !== \"production\" ? invariant(false, \"useRevalidator must be used within a DataRouterContext\") : invariant(false) : void 0;\n  let state = useDataRouterState(DataRouterHook.UseRevalidator);\n  return {\n    revalidate: dataRouterContext.router.revalidate,\n    state: state.revalidation\n  };\n}\n/**\n * Returns the active route matches, useful for accessing loaderData for\n * parent/child routes or the route \"handle\" property\n */\n\nfunction useMatches() {\n  let {\n    matches,\n    loaderData\n  } = useDataRouterState(DataRouterHook.UseMatches);\n  return React.useMemo(() => matches.map(match => {\n    let {\n      pathname,\n      params\n    } = match; // Note: This structure matches that created by createUseMatchesMatch\n    // in the @remix-run/router , so if you change this please also change\n    // that :)  Eventually we'll DRY this up\n\n    return {\n      id: match.route.id,\n      pathname,\n      params,\n      data: loaderData[match.route.id],\n      handle: match.route.handle\n    };\n  }), [matches, loaderData]);\n}\n/**\n * Returns the loader data for the nearest ancestor Route loader\n */\n\nfunction useLoaderData() {\n  let state = useDataRouterState(DataRouterHook.UseLoaderData);\n  let route = React.useContext(RouteContext);\n  !route ? process.env.NODE_ENV !== \"production\" ? invariant(false, \"useLoaderData must be used inside a RouteContext\") : invariant(false) : void 0;\n  let thisRoute = route.matches[route.matches.length - 1];\n  !thisRoute.route.id ? process.env.NODE_ENV !== \"production\" ? invariant(false, \"useLoaderData can only be used on routes that contain a unique \\\"id\\\"\") : invariant(false) : void 0;\n  return state.loaderData[thisRoute.route.id];\n}\n/**\n * Returns the loaderData for the given routeId\n */\n\nfunction useRouteLoaderData(routeId) {\n  let state = useDataRouterState(DataRouterHook.UseRouteLoaderData);\n  return state.loaderData[routeId];\n}\n/**\n * Returns the action data for the nearest ancestor Route action\n */\n\nfunction useActionData() {\n  let state = useDataRouterState(DataRouterHook.UseActionData);\n  let route = React.useContext(RouteContext);\n  !route ? process.env.NODE_ENV !== \"production\" ? invariant(false, \"useActionData must be used inside a RouteContext\") : invariant(false) : void 0;\n  return Object.values((state == null ? void 0 : state.actionData) || {})[0];\n}\n/**\n * Returns the nearest ancestor Route error, which could be a loader/action\n * error or a render error.  This is intended to be called from your\n * errorElement to display a proper error message.\n */\n\nfunction useRouteError() {\n  var _state$errors;\n\n  let error = React.useContext(RouteErrorContext);\n  let state = useDataRouterState(DataRouterHook.UseRouteError);\n  let route = React.useContext(RouteContext);\n  let thisRoute = route.matches[route.matches.length - 1]; // If this was a render error, we put it in a RouteError context inside\n  // of RenderErrorBoundary\n\n  if (error) {\n    return error;\n  }\n\n  !route ? process.env.NODE_ENV !== \"production\" ? invariant(false, \"useRouteError must be used inside a RouteContext\") : invariant(false) : void 0;\n  !thisRoute.route.id ? process.env.NODE_ENV !== \"production\" ? invariant(false, \"useRouteError can only be used on routes that contain a unique \\\"id\\\"\") : invariant(false) : void 0; // Otherwise look for errors from our data router state\n\n  return (_state$errors = state.errors) == null ? void 0 : _state$errors[thisRoute.route.id];\n}\n/**\n * Returns the happy-path data from the nearest ancestor <Await /> value\n */\n\nfunction useAsyncValue() {\n  let value = React.useContext(AwaitContext);\n  return value == null ? void 0 : value._data;\n}\n/**\n * Returns the error from the nearest ancestor <Await /> value\n */\n\nfunction useAsyncError() {\n  let value = React.useContext(AwaitContext);\n  return value == null ? void 0 : value._error;\n}\nconst alreadyWarned = {};\n\nfunction warningOnce(key, cond, message) {\n  if (!cond && !alreadyWarned[key]) {\n    alreadyWarned[key] = true;\n    process.env.NODE_ENV !== \"production\" ? warning(false, message) : void 0;\n  }\n}\n\n/**\n * Given a Remix Router instance, render the appropriate UI\n */\nfunction RouterProvider(_ref) {\n  let {\n    fallbackElement,\n    router\n  } = _ref;\n  // Sync router state to our component state to force re-renders\n  let state = useSyncExternalStore(router.subscribe, () => router.state, // We have to provide this so React@18 doesn't complain during hydration,\n  // but we pass our serialized hydration data into the router so state here\n  // is already synced with what the server saw\n  () => router.state);\n  let navigator = React.useMemo(() => {\n    return {\n      createHref: router.createHref,\n      go: n => router.navigate(n),\n      push: (to, state, opts) => router.navigate(to, {\n        state,\n        preventScrollReset: opts == null ? void 0 : opts.preventScrollReset\n      }),\n      replace: (to, state, opts) => router.navigate(to, {\n        replace: true,\n        state,\n        preventScrollReset: opts == null ? void 0 : opts.preventScrollReset\n      })\n    };\n  }, [router]);\n  let basename = router.basename || \"/\";\n  return /*#__PURE__*/React.createElement(DataRouterContext.Provider, {\n    value: {\n      router,\n      navigator,\n      static: false,\n      // Do we need this?\n      basename\n    }\n  }, /*#__PURE__*/React.createElement(DataRouterStateContext.Provider, {\n    value: state\n  }, /*#__PURE__*/React.createElement(Router, {\n    basename: router.basename,\n    location: router.state.location,\n    navigationType: router.state.historyAction,\n    navigator: navigator\n  }, router.state.initialized ? /*#__PURE__*/React.createElement(Routes, null) : fallbackElement)));\n}\n\n/**\n * A <Router> that stores all entries in memory.\n *\n * @see https://reactrouter.com/docs/en/v6/routers/memory-router\n */\nfunction MemoryRouter(_ref2) {\n  let {\n    basename,\n    children,\n    initialEntries,\n    initialIndex\n  } = _ref2;\n  let historyRef = React.useRef();\n\n  if (historyRef.current == null) {\n    historyRef.current = createMemoryHistory({\n      initialEntries,\n      initialIndex,\n      v5Compat: true\n    });\n  }\n\n  let history = historyRef.current;\n  let [state, setState] = React.useState({\n    action: history.action,\n    location: history.location\n  });\n  React.useLayoutEffect(() => history.listen(setState), [history]);\n  return /*#__PURE__*/React.createElement(Router, {\n    basename: basename,\n    children: children,\n    location: state.location,\n    navigationType: state.action,\n    navigator: history\n  });\n}\n\n/**\n * Changes the current location.\n *\n * Note: This API is mostly useful in React.Component subclasses that are not\n * able to use hooks. In functional components, we recommend you use the\n * `useNavigate` hook instead.\n *\n * @see https://reactrouter.com/docs/en/v6/components/navigate\n */\nfunction Navigate(_ref3) {\n  let {\n    to,\n    replace,\n    state,\n    relative\n  } = _ref3;\n  !useInRouterContext() ? process.env.NODE_ENV !== \"production\" ? invariant(false, // TODO: This error is probably because they somehow have 2 versions of\n  // the router loaded. We can help them understand how to avoid that.\n  \"<Navigate> may be used only in the context of a <Router> component.\") : invariant(false) : void 0;\n  process.env.NODE_ENV !== \"production\" ? warning(!React.useContext(NavigationContext).static, \"<Navigate> must not be used on the initial render in a <StaticRouter>. \" + \"This is a no-op, but you should modify your code so the <Navigate> is \" + \"only ever rendered in response to some user interaction or state change.\") : void 0;\n  let dataRouterState = React.useContext(DataRouterStateContext);\n  let navigate = useNavigate();\n  React.useEffect(() => {\n    // Avoid kicking off multiple navigations if we're in the middle of a\n    // data-router navigation, since components get re-rendered when we enter\n    // a submitting/loading state\n    if (dataRouterState && dataRouterState.navigation.state !== \"idle\") {\n      return;\n    }\n\n    navigate(to, {\n      replace,\n      state,\n      relative\n    });\n  });\n  return null;\n}\n\n/**\n * Renders the child route's element, if there is one.\n *\n * @see https://reactrouter.com/docs/en/v6/components/outlet\n */\nfunction Outlet(props) {\n  return useOutlet(props.context);\n}\n\n/**\n * Declares an element that should be rendered at a certain URL path.\n *\n * @see https://reactrouter.com/docs/en/v6/components/route\n */\nfunction Route(_props) {\n  process.env.NODE_ENV !== \"production\" ? invariant(false, \"A <Route> is only ever to be used as the child of <Routes> element, \" + \"never rendered directly. Please wrap your <Route> in a <Routes>.\") : invariant(false) ;\n}\n\n/**\n * Provides location context for the rest of the app.\n *\n * Note: You usually won't render a <Router> directly. Instead, you'll render a\n * router that is more specific to your environment such as a <BrowserRouter>\n * in web browsers or a <StaticRouter> for server rendering.\n *\n * @see https://reactrouter.com/docs/en/v6/routers/router\n */\nfunction Router(_ref4) {\n  let {\n    basename: basenameProp = \"/\",\n    children = null,\n    location: locationProp,\n    navigationType = Action.Pop,\n    navigator,\n    static: staticProp = false\n  } = _ref4;\n  !!useInRouterContext() ? process.env.NODE_ENV !== \"production\" ? invariant(false, \"You cannot render a <Router> inside another <Router>.\" + \" You should never have more than one in your app.\") : invariant(false) : void 0; // Preserve trailing slashes on basename, so we can let the user control\n  // the enforcement of trailing slashes throughout the app\n\n  let basename = basenameProp.replace(/^\\/*/, \"/\");\n  let navigationContext = React.useMemo(() => ({\n    basename,\n    navigator,\n    static: staticProp\n  }), [basename, navigator, staticProp]);\n\n  if (typeof locationProp === \"string\") {\n    locationProp = parsePath(locationProp);\n  }\n\n  let {\n    pathname = \"/\",\n    search = \"\",\n    hash = \"\",\n    state = null,\n    key = \"default\"\n  } = locationProp;\n  let location = React.useMemo(() => {\n    let trailingPathname = stripBasename(pathname, basename);\n\n    if (trailingPathname == null) {\n      return null;\n    }\n\n    return {\n      pathname: trailingPathname,\n      search,\n      hash,\n      state,\n      key\n    };\n  }, [basename, pathname, search, hash, state, key]);\n  process.env.NODE_ENV !== \"production\" ? warning(location != null, \"<Router basename=\\\"\" + basename + \"\\\"> is not able to match the URL \" + (\"\\\"\" + pathname + search + hash + \"\\\" because it does not start with the \") + \"basename, so the <Router> won't render anything.\") : void 0;\n\n  if (location == null) {\n    return null;\n  }\n\n  return /*#__PURE__*/React.createElement(NavigationContext.Provider, {\n    value: navigationContext\n  }, /*#__PURE__*/React.createElement(LocationContext.Provider, {\n    children: children,\n    value: {\n      location,\n      navigationType\n    }\n  }));\n}\n\n/**\n * A container for a nested tree of <Route> elements that renders the branch\n * that best matches the current location.\n *\n * @see https://reactrouter.com/docs/en/v6/components/routes\n */\nfunction Routes(_ref5) {\n  let {\n    children,\n    location\n  } = _ref5;\n  let dataRouterContext = React.useContext(DataRouterContext); // When in a DataRouterContext _without_ children, we use the router routes\n  // directly.  If we have children, then we're in a descendant tree and we\n  // need to use child routes.\n\n  let routes = dataRouterContext && !children ? dataRouterContext.router.routes : createRoutesFromChildren(children);\n  return useRoutes(routes, location);\n}\n\n/**\n * Component to use for rendering lazily loaded data from returning defer()\n * in a loader function\n */\nfunction Await(_ref6) {\n  let {\n    children,\n    errorElement,\n    resolve\n  } = _ref6;\n  return /*#__PURE__*/React.createElement(AwaitErrorBoundary, {\n    resolve: resolve,\n    errorElement: errorElement\n  }, /*#__PURE__*/React.createElement(ResolveAwait, null, children));\n}\nvar AwaitRenderStatus;\n\n(function (AwaitRenderStatus) {\n  AwaitRenderStatus[AwaitRenderStatus[\"pending\"] = 0] = \"pending\";\n  AwaitRenderStatus[AwaitRenderStatus[\"success\"] = 1] = \"success\";\n  AwaitRenderStatus[AwaitRenderStatus[\"error\"] = 2] = \"error\";\n})(AwaitRenderStatus || (AwaitRenderStatus = {}));\n\nconst neverSettledPromise = new Promise(() => {});\n\nclass AwaitErrorBoundary extends React.Component {\n  constructor(props) {\n    super(props);\n    this.state = {\n      error: null\n    };\n  }\n\n  static getDerivedStateFromError(error) {\n    return {\n      error\n    };\n  }\n\n  componentDidCatch(error, errorInfo) {\n    console.error(\"<Await> caught the following error during render\", error, errorInfo);\n  }\n\n  render() {\n    let {\n      children,\n      errorElement,\n      resolve\n    } = this.props;\n    let promise = null;\n    let status = AwaitRenderStatus.pending;\n\n    if (!(resolve instanceof Promise)) {\n      // Didn't get a promise - provide as a resolved promise\n      status = AwaitRenderStatus.success;\n      promise = Promise.resolve();\n      Object.defineProperty(promise, \"_tracked\", {\n        get: () => true\n      });\n      Object.defineProperty(promise, \"_data\", {\n        get: () => resolve\n      });\n    } else if (this.state.error) {\n      // Caught a render error, provide it as a rejected promise\n      status = AwaitRenderStatus.error;\n      let renderError = this.state.error;\n      promise = Promise.reject().catch(() => {}); // Avoid unhandled rejection warnings\n\n      Object.defineProperty(promise, \"_tracked\", {\n        get: () => true\n      });\n      Object.defineProperty(promise, \"_error\", {\n        get: () => renderError\n      });\n    } else if (resolve._tracked) {\n      // Already tracked promise - check contents\n      promise = resolve;\n      status = promise._error !== undefined ? AwaitRenderStatus.error : promise._data !== undefined ? AwaitRenderStatus.success : AwaitRenderStatus.pending;\n    } else {\n      // Raw (untracked) promise - track it\n      status = AwaitRenderStatus.pending;\n      Object.defineProperty(resolve, \"_tracked\", {\n        get: () => true\n      });\n      promise = resolve.then(data => Object.defineProperty(resolve, \"_data\", {\n        get: () => data\n      }), error => Object.defineProperty(resolve, \"_error\", {\n        get: () => error\n      }));\n    }\n\n    if (status === AwaitRenderStatus.error && promise._error instanceof AbortedDeferredError) {\n      // Freeze the UI by throwing a never resolved promise\n      throw neverSettledPromise;\n    }\n\n    if (status === AwaitRenderStatus.error && !errorElement) {\n      // No errorElement, throw to the nearest route-level error boundary\n      throw promise._error;\n    }\n\n    if (status === AwaitRenderStatus.error) {\n      // Render via our errorElement\n      return /*#__PURE__*/React.createElement(AwaitContext.Provider, {\n        value: promise,\n        children: errorElement\n      });\n    }\n\n    if (status === AwaitRenderStatus.success) {\n      // Render children with resolved value\n      return /*#__PURE__*/React.createElement(AwaitContext.Provider, {\n        value: promise,\n        children: children\n      });\n    } // Throw to the suspense boundary\n\n\n    throw promise;\n  }\n\n}\n/**\n * @private\n * Indirection to leverage useAsyncValue for a render-prop API on <Await>\n */\n\n\nfunction ResolveAwait(_ref7) {\n  let {\n    children\n  } = _ref7;\n  let data = useAsyncValue();\n\n  if (typeof children === \"function\") {\n    return children(data);\n  }\n\n  return /*#__PURE__*/React.createElement(React.Fragment, null, children);\n} ///////////////////////////////////////////////////////////////////////////////\n// UTILS\n///////////////////////////////////////////////////////////////////////////////\n\n/**\n * Creates a route config from a React \"children\" object, which is usually\n * either a `<Route>` element or an array of them. Used internally by\n * `<Routes>` to create a route config from its children.\n *\n * @see https://reactrouter.com/docs/en/v6/utils/create-routes-from-children\n */\n\n\nfunction createRoutesFromChildren(children, parentPath) {\n  if (parentPath === void 0) {\n    parentPath = [];\n  }\n\n  let routes = [];\n  React.Children.forEach(children, (element, index) => {\n    if (! /*#__PURE__*/React.isValidElement(element)) {\n      // Ignore non-elements. This allows people to more easily inline\n      // conditionals in their route config.\n      return;\n    }\n\n    if (element.type === React.Fragment) {\n      // Transparently support React.Fragment and its children.\n      routes.push.apply(routes, createRoutesFromChildren(element.props.children, parentPath));\n      return;\n    }\n\n    !(element.type === Route) ? process.env.NODE_ENV !== \"production\" ? invariant(false, \"[\" + (typeof element.type === \"string\" ? element.type : element.type.name) + \"] is not a <Route> component. All component children of <Routes> must be a <Route> or <React.Fragment>\") : invariant(false) : void 0;\n    let treePath = [...parentPath, index];\n    let route = {\n      id: element.props.id || treePath.join(\"-\"),\n      caseSensitive: element.props.caseSensitive,\n      element: element.props.element,\n      index: element.props.index,\n      path: element.props.path,\n      loader: element.props.loader,\n      action: element.props.action,\n      errorElement: element.props.errorElement,\n      hasErrorBoundary: element.props.errorElement != null,\n      shouldRevalidate: element.props.shouldRevalidate,\n      handle: element.props.handle\n    };\n\n    if (element.props.children) {\n      route.children = createRoutesFromChildren(element.props.children, treePath);\n    }\n\n    routes.push(route);\n  });\n  return routes;\n}\n/**\n * Renders the result of `matchRoutes()` into a React element.\n */\n\nfunction renderMatches(matches) {\n  return _renderMatches(matches);\n}\n/**\n * @private\n * Walk the route tree and add hasErrorBoundary if it's not provided, so that\n * users providing manual route arrays can just specify errorElement\n */\n\nfunction enhanceManualRouteObjects(routes) {\n  return routes.map(route => {\n    let routeClone = _extends({}, route);\n\n    if (routeClone.hasErrorBoundary == null) {\n      routeClone.hasErrorBoundary = routeClone.errorElement != null;\n    }\n\n    if (routeClone.children) {\n      routeClone.children = enhanceManualRouteObjects(routeClone.children);\n    }\n\n    return routeClone;\n  });\n}\n\nfunction createMemoryRouter(routes, opts) {\n  return createRouter({\n    basename: opts == null ? void 0 : opts.basename,\n    history: createMemoryHistory({\n      initialEntries: opts == null ? void 0 : opts.initialEntries,\n      initialIndex: opts == null ? void 0 : opts.initialIndex\n    }),\n    hydrationData: opts == null ? void 0 : opts.hydrationData,\n    routes: enhanceManualRouteObjects(routes)\n  }).initialize();\n} ///////////////////////////////////////////////////////////////////////////////\n\nexport { Await, MemoryRouter, Navigate, Outlet, Route, Router, RouterProvider, Routes, DataRouterContext as UNSAFE_DataRouterContext, DataRouterStateContext as UNSAFE_DataRouterStateContext, DataStaticRouterContext as UNSAFE_DataStaticRouterContext, LocationContext as UNSAFE_LocationContext, NavigationContext as UNSAFE_NavigationContext, RouteContext as UNSAFE_RouteContext, enhanceManualRouteObjects as UNSAFE_enhanceManualRouteObjects, createMemoryRouter, createRoutesFromChildren, createRoutesFromChildren as createRoutesFromElements, renderMatches, useActionData, useAsyncError, useAsyncValue, useHref, useInRouterContext, useLoaderData, useLocation, useMatch, useMatches, useNavigate, useNavigation, useNavigationType, useOutlet, useOutletContext, useParams, useResolvedPath, useRevalidator, useRouteError, useRouteLoaderData, useRoutes };\n//# sourceMappingURL=index.js.map\n","/**\n * React Router DOM v6.4.1\n *\n * Copyright (c) Remix Software Inc.\n *\n * This source code is licensed under the MIT license found in the\n * LICENSE.md file in the root directory of this source tree.\n *\n * @license MIT\n */\nimport * as React from 'react';\nimport { UNSAFE_enhanceManualRouteObjects, Router, useHref, createPath, useResolvedPath, useMatch, UNSAFE_DataRouterStateContext, useNavigate, useLocation, UNSAFE_DataRouterContext, UNSAFE_RouteContext, useMatches, useNavigation } from 'react-router';\nexport { AbortedDeferredError, Await, MemoryRouter, Navigate, NavigationType, Outlet, Route, Router, RouterProvider, Routes, UNSAFE_DataRouterContext, UNSAFE_DataRouterStateContext, UNSAFE_DataStaticRouterContext, UNSAFE_LocationContext, UNSAFE_NavigationContext, UNSAFE_RouteContext, UNSAFE_enhanceManualRouteObjects, createMemoryRouter, createPath, createRoutesFromChildren, createRoutesFromElements, defer, generatePath, isRouteErrorResponse, json, matchPath, matchRoutes, parsePath, redirect, renderMatches, resolvePath, useActionData, useAsyncError, useAsyncValue, useHref, useInRouterContext, useLoaderData, useLocation, useMatch, useMatches, useNavigate, useNavigation, useNavigationType, useOutlet, useOutletContext, useParams, useResolvedPath, useRevalidator, useRouteError, useRouteLoaderData, useRoutes } from 'react-router';\nimport { createRouter, createBrowserHistory, createHashHistory, matchPath, invariant } from '@remix-run/router';\n\nfunction _extends() {\n  _extends = Object.assign ? Object.assign.bind() : function (target) {\n    for (var i = 1; i < arguments.length; i++) {\n      var source = arguments[i];\n\n      for (var key in source) {\n        if (Object.prototype.hasOwnProperty.call(source, key)) {\n          target[key] = source[key];\n        }\n      }\n    }\n\n    return target;\n  };\n  return _extends.apply(this, arguments);\n}\n\nfunction _objectWithoutPropertiesLoose(source, excluded) {\n  if (source == null) return {};\n  var target = {};\n  var sourceKeys = Object.keys(source);\n  var key, i;\n\n  for (i = 0; i < sourceKeys.length; i++) {\n    key = sourceKeys[i];\n    if (excluded.indexOf(key) >= 0) continue;\n    target[key] = source[key];\n  }\n\n  return target;\n}\n\nconst defaultMethod = \"get\";\nconst defaultEncType = \"application/x-www-form-urlencoded\";\nfunction isHtmlElement(object) {\n  return object != null && typeof object.tagName === \"string\";\n}\nfunction isButtonElement(object) {\n  return isHtmlElement(object) && object.tagName.toLowerCase() === \"button\";\n}\nfunction isFormElement(object) {\n  return isHtmlElement(object) && object.tagName.toLowerCase() === \"form\";\n}\nfunction isInputElement(object) {\n  return isHtmlElement(object) && object.tagName.toLowerCase() === \"input\";\n}\n\nfunction isModifiedEvent(event) {\n  return !!(event.metaKey || event.altKey || event.ctrlKey || event.shiftKey);\n}\n\nfunction shouldProcessLinkClick(event, target) {\n  return event.button === 0 && ( // Ignore everything but left clicks\n  !target || target === \"_self\") && // Let browser handle \"target=_blank\" etc.\n  !isModifiedEvent(event) // Ignore clicks with modifier keys\n  ;\n}\n/**\n * Creates a URLSearchParams object using the given initializer.\n *\n * This is identical to `new URLSearchParams(init)` except it also\n * supports arrays as values in the object form of the initializer\n * instead of just strings. This is convenient when you need multiple\n * values for a given key, but don't want to use an array initializer.\n *\n * For example, instead of:\n *\n *   let searchParams = new URLSearchParams([\n *     ['sort', 'name'],\n *     ['sort', 'price']\n *   ]);\n *\n * you can do:\n *\n *   let searchParams = createSearchParams({\n *     sort: ['name', 'price']\n *   });\n */\n\nfunction createSearchParams(init) {\n  if (init === void 0) {\n    init = \"\";\n  }\n\n  return new URLSearchParams(typeof init === \"string\" || Array.isArray(init) || init instanceof URLSearchParams ? init : Object.keys(init).reduce((memo, key) => {\n    let value = init[key];\n    return memo.concat(Array.isArray(value) ? value.map(v => [key, v]) : [[key, value]]);\n  }, []));\n}\nfunction getSearchParamsForLocation(locationSearch, defaultSearchParams) {\n  let searchParams = createSearchParams(locationSearch);\n\n  for (let key of defaultSearchParams.keys()) {\n    if (!searchParams.has(key)) {\n      defaultSearchParams.getAll(key).forEach(value => {\n        searchParams.append(key, value);\n      });\n    }\n  }\n\n  return searchParams;\n}\nfunction getFormSubmissionInfo(target, defaultAction, options) {\n  let method;\n  let action;\n  let encType;\n  let formData;\n\n  if (isFormElement(target)) {\n    let submissionTrigger = options.submissionTrigger;\n    method = options.method || target.getAttribute(\"method\") || defaultMethod;\n    action = options.action || target.getAttribute(\"action\") || defaultAction;\n    encType = options.encType || target.getAttribute(\"enctype\") || defaultEncType;\n    formData = new FormData(target);\n\n    if (submissionTrigger && submissionTrigger.name) {\n      formData.append(submissionTrigger.name, submissionTrigger.value);\n    }\n  } else if (isButtonElement(target) || isInputElement(target) && (target.type === \"submit\" || target.type === \"image\")) {\n    let form = target.form;\n\n    if (form == null) {\n      throw new Error(\"Cannot submit a <button> or <input type=\\\"submit\\\"> without a <form>\");\n    } // <button>/<input type=\"submit\"> may override attributes of <form>\n\n\n    method = options.method || target.getAttribute(\"formmethod\") || form.getAttribute(\"method\") || defaultMethod;\n    action = options.action || target.getAttribute(\"formaction\") || form.getAttribute(\"action\") || defaultAction;\n    encType = options.encType || target.getAttribute(\"formenctype\") || form.getAttribute(\"enctype\") || defaultEncType;\n    formData = new FormData(form); // Include name + value from a <button>, appending in case the button name\n    // matches an existing input name\n\n    if (target.name) {\n      formData.append(target.name, target.value);\n    }\n  } else if (isHtmlElement(target)) {\n    throw new Error(\"Cannot submit element that is not <form>, <button>, or \" + \"<input type=\\\"submit|image\\\">\");\n  } else {\n    method = options.method || defaultMethod;\n    action = options.action || defaultAction;\n    encType = options.encType || defaultEncType;\n\n    if (target instanceof FormData) {\n      formData = target;\n    } else {\n      formData = new FormData();\n\n      if (target instanceof URLSearchParams) {\n        for (let [name, value] of target) {\n          formData.append(name, value);\n        }\n      } else if (target != null) {\n        for (let name of Object.keys(target)) {\n          formData.append(name, target[name]);\n        }\n      }\n    }\n  }\n\n  let {\n    protocol,\n    host\n  } = window.location;\n  let url = new URL(action, protocol + \"//\" + host);\n  return {\n    url,\n    method,\n    encType,\n    formData\n  };\n}\n\nconst _excluded = [\"onClick\", \"relative\", \"reloadDocument\", \"replace\", \"state\", \"target\", \"to\", \"preventScrollReset\"],\n      _excluded2 = [\"aria-current\", \"caseSensitive\", \"className\", \"end\", \"style\", \"to\", \"children\"],\n      _excluded3 = [\"reloadDocument\", \"replace\", \"method\", \"action\", \"onSubmit\", \"fetcherKey\", \"routeId\", \"relative\"];\n//#region Routers\n////////////////////////////////////////////////////////////////////////////////\n\nfunction createBrowserRouter(routes, opts) {\n  var _window;\n\n  return createRouter({\n    basename: opts == null ? void 0 : opts.basename,\n    history: createBrowserHistory({\n      window: opts == null ? void 0 : opts.window\n    }),\n    hydrationData: (opts == null ? void 0 : opts.hydrationData) || ((_window = window) == null ? void 0 : _window.__staticRouterHydrationData),\n    routes: UNSAFE_enhanceManualRouteObjects(routes)\n  }).initialize();\n}\nfunction createHashRouter(routes, opts) {\n  var _window2;\n\n  return createRouter({\n    basename: opts == null ? void 0 : opts.basename,\n    history: createHashHistory({\n      window: opts == null ? void 0 : opts.window\n    }),\n    hydrationData: (opts == null ? void 0 : opts.hydrationData) || ((_window2 = window) == null ? void 0 : _window2.__staticRouterHydrationData),\n    routes: UNSAFE_enhanceManualRouteObjects(routes)\n  }).initialize();\n}\n/**\n * A `<Router>` for use in web browsers. Provides the cleanest URLs.\n */\n\nfunction BrowserRouter(_ref) {\n  let {\n    basename,\n    children,\n    window\n  } = _ref;\n  let historyRef = React.useRef();\n\n  if (historyRef.current == null) {\n    historyRef.current = createBrowserHistory({\n      window,\n      v5Compat: true\n    });\n  }\n\n  let history = historyRef.current;\n  let [state, setState] = React.useState({\n    action: history.action,\n    location: history.location\n  });\n  React.useLayoutEffect(() => history.listen(setState), [history]);\n  return /*#__PURE__*/React.createElement(Router, {\n    basename: basename,\n    children: children,\n    location: state.location,\n    navigationType: state.action,\n    navigator: history\n  });\n}\n/**\n * A `<Router>` for use in web browsers. Stores the location in the hash\n * portion of the URL so it is not sent to the server.\n */\n\nfunction HashRouter(_ref2) {\n  let {\n    basename,\n    children,\n    window\n  } = _ref2;\n  let historyRef = React.useRef();\n\n  if (historyRef.current == null) {\n    historyRef.current = createHashHistory({\n      window,\n      v5Compat: true\n    });\n  }\n\n  let history = historyRef.current;\n  let [state, setState] = React.useState({\n    action: history.action,\n    location: history.location\n  });\n  React.useLayoutEffect(() => history.listen(setState), [history]);\n  return /*#__PURE__*/React.createElement(Router, {\n    basename: basename,\n    children: children,\n    location: state.location,\n    navigationType: state.action,\n    navigator: history\n  });\n}\n/**\n * A `<Router>` that accepts a pre-instantiated history object. It's important\n * to note that using your own history object is highly discouraged and may add\n * two versions of the history library to your bundles unless you use the same\n * version of the history library that React Router uses internally.\n */\n\nfunction HistoryRouter(_ref3) {\n  let {\n    basename,\n    children,\n    history\n  } = _ref3;\n  const [state, setState] = React.useState({\n    action: history.action,\n    location: history.location\n  });\n  React.useLayoutEffect(() => history.listen(setState), [history]);\n  return /*#__PURE__*/React.createElement(Router, {\n    basename: basename,\n    children: children,\n    location: state.location,\n    navigationType: state.action,\n    navigator: history\n  });\n}\n\nif (process.env.NODE_ENV !== \"production\") {\n  HistoryRouter.displayName = \"unstable_HistoryRouter\";\n}\n/**\n * The public API for rendering a history-aware <a>.\n */\n\nconst Link = /*#__PURE__*/React.forwardRef(function LinkWithRef(_ref4, ref) {\n  let {\n    onClick,\n    relative,\n    reloadDocument,\n    replace,\n    state,\n    target,\n    to,\n    preventScrollReset\n  } = _ref4,\n      rest = _objectWithoutPropertiesLoose(_ref4, _excluded);\n\n  let href = useHref(to, {\n    relative\n  });\n  let internalOnClick = useLinkClickHandler(to, {\n    replace,\n    state,\n    target,\n    preventScrollReset,\n    relative\n  });\n\n  function handleClick(event) {\n    if (onClick) onClick(event);\n\n    if (!event.defaultPrevented) {\n      internalOnClick(event);\n    }\n  }\n\n  return (\n    /*#__PURE__*/\n    // eslint-disable-next-line jsx-a11y/anchor-has-content\n    React.createElement(\"a\", _extends({}, rest, {\n      href: href,\n      onClick: reloadDocument ? onClick : handleClick,\n      ref: ref,\n      target: target\n    }))\n  );\n});\n\nif (process.env.NODE_ENV !== \"production\") {\n  Link.displayName = \"Link\";\n}\n/**\n * A <Link> wrapper that knows if it's \"active\" or not.\n */\n\n\nconst NavLink = /*#__PURE__*/React.forwardRef(function NavLinkWithRef(_ref5, ref) {\n  let {\n    \"aria-current\": ariaCurrentProp = \"page\",\n    caseSensitive = false,\n    className: classNameProp = \"\",\n    end = false,\n    style: styleProp,\n    to,\n    children\n  } = _ref5,\n      rest = _objectWithoutPropertiesLoose(_ref5, _excluded2);\n\n  let path = useResolvedPath(to);\n  let match = useMatch({\n    path: path.pathname,\n    end,\n    caseSensitive\n  });\n  let routerState = React.useContext(UNSAFE_DataRouterStateContext);\n  let nextLocation = routerState == null ? void 0 : routerState.navigation.location;\n  let nextPath = useResolvedPath(nextLocation || \"\");\n  let nextMatch = React.useMemo(() => nextLocation ? matchPath({\n    path: path.pathname,\n    end,\n    caseSensitive\n  }, nextPath.pathname) : null, [nextLocation, path.pathname, caseSensitive, end, nextPath.pathname]);\n  let isPending = nextMatch != null;\n  let isActive = match != null;\n  let ariaCurrent = isActive ? ariaCurrentProp : undefined;\n  let className;\n\n  if (typeof classNameProp === \"function\") {\n    className = classNameProp({\n      isActive,\n      isPending\n    });\n  } else {\n    // If the className prop is not a function, we use a default `active`\n    // class for <NavLink />s that are active. In v5 `active` was the default\n    // value for `activeClassName`, but we are removing that API and can still\n    // use the old default behavior for a cleaner upgrade path and keep the\n    // simple styling rules working as they currently do.\n    className = [classNameProp, isActive ? \"active\" : null, isPending ? \"pending\" : null].filter(Boolean).join(\" \");\n  }\n\n  let style = typeof styleProp === \"function\" ? styleProp({\n    isActive,\n    isPending\n  }) : styleProp;\n  return /*#__PURE__*/React.createElement(Link, _extends({}, rest, {\n    \"aria-current\": ariaCurrent,\n    className: className,\n    ref: ref,\n    style: style,\n    to: to\n  }), typeof children === \"function\" ? children({\n    isActive,\n    isPending\n  }) : children);\n});\n\nif (process.env.NODE_ENV !== \"production\") {\n  NavLink.displayName = \"NavLink\";\n}\n/**\n * A `@remix-run/router`-aware `<form>`. It behaves like a normal form except\n * that the interaction with the server is with `fetch` instead of new document\n * requests, allowing components to add nicer UX to the page as the form is\n * submitted and returns with data.\n */\n\n\nconst Form = /*#__PURE__*/React.forwardRef((props, ref) => {\n  return /*#__PURE__*/React.createElement(FormImpl, _extends({}, props, {\n    ref: ref\n  }));\n});\n\nif (process.env.NODE_ENV !== \"production\") {\n  Form.displayName = \"Form\";\n}\n\nconst FormImpl = /*#__PURE__*/React.forwardRef((_ref6, forwardedRef) => {\n  let {\n    reloadDocument,\n    replace,\n    method = defaultMethod,\n    action,\n    onSubmit,\n    fetcherKey,\n    routeId,\n    relative\n  } = _ref6,\n      props = _objectWithoutPropertiesLoose(_ref6, _excluded3);\n\n  let submit = useSubmitImpl(fetcherKey, routeId);\n  let formMethod = method.toLowerCase() === \"get\" ? \"get\" : \"post\";\n  let formAction = useFormAction(action, {\n    relative\n  });\n\n  let submitHandler = event => {\n    onSubmit && onSubmit(event);\n    if (event.defaultPrevented) return;\n    event.preventDefault();\n    let submitter = event.nativeEvent.submitter;\n    submit(submitter || event.currentTarget, {\n      method,\n      replace,\n      relative\n    });\n  };\n\n  return /*#__PURE__*/React.createElement(\"form\", _extends({\n    ref: forwardedRef,\n    method: formMethod,\n    action: formAction,\n    onSubmit: reloadDocument ? onSubmit : submitHandler\n  }, props));\n});\n\nif (process.env.NODE_ENV !== \"production\") {\n  Form.displayName = \"Form\";\n}\n/**\n * This component will emulate the browser's scroll restoration on location\n * changes.\n */\n\n\nfunction ScrollRestoration(_ref7) {\n  let {\n    getKey,\n    storageKey\n  } = _ref7;\n  useScrollRestoration({\n    getKey,\n    storageKey\n  });\n  return null;\n}\n\nif (process.env.NODE_ENV !== \"production\") {\n  ScrollRestoration.displayName = \"ScrollRestoration\";\n} //#endregion\n////////////////////////////////////////////////////////////////////////////////\n//#region Hooks\n////////////////////////////////////////////////////////////////////////////////\n\n/**\n * Handles the click behavior for router `<Link>` components. This is useful if\n * you need to create custom `<Link>` components with the same click behavior we\n * use in our exported `<Link>`.\n */\n\n\nfunction useLinkClickHandler(to, _temp) {\n  let {\n    target,\n    replace: replaceProp,\n    state,\n    preventScrollReset,\n    relative\n  } = _temp === void 0 ? {} : _temp;\n  let navigate = useNavigate();\n  let location = useLocation();\n  let path = useResolvedPath(to, {\n    relative\n  });\n  return React.useCallback(event => {\n    if (shouldProcessLinkClick(event, target)) {\n      event.preventDefault(); // If the URL hasn't changed, a regular <a> will do a replace instead of\n      // a push, so do the same here unless the replace prop is explicitly set\n\n      let replace = replaceProp !== undefined ? replaceProp : createPath(location) === createPath(path);\n      navigate(to, {\n        replace,\n        state,\n        preventScrollReset,\n        relative\n      });\n    }\n  }, [location, navigate, path, replaceProp, state, target, to, preventScrollReset, relative]);\n}\n/**\n * A convenient wrapper for reading and writing search parameters via the\n * URLSearchParams interface.\n */\n\nfunction useSearchParams(defaultInit) {\n  process.env.NODE_ENV !== \"production\" ? warning(typeof URLSearchParams !== \"undefined\", \"You cannot use the `useSearchParams` hook in a browser that does not \" + \"support the URLSearchParams API. If you need to support Internet \" + \"Explorer 11, we recommend you load a polyfill such as \" + \"https://github.com/ungap/url-search-params\\n\\n\" + \"If you're unsure how to load polyfills, we recommend you check out \" + \"https://polyfill.io/v3/ which provides some recommendations about how \" + \"to load polyfills only for users that need them, instead of for every \" + \"user.\") : void 0;\n  let defaultSearchParamsRef = React.useRef(createSearchParams(defaultInit));\n  let location = useLocation();\n  let searchParams = React.useMemo(() => getSearchParamsForLocation(location.search, defaultSearchParamsRef.current), [location.search]);\n  let navigate = useNavigate();\n  let setSearchParams = React.useCallback((nextInit, navigateOptions) => {\n    const newSearchParams = createSearchParams(typeof nextInit === \"function\" ? nextInit(searchParams) : nextInit);\n    navigate(\"?\" + newSearchParams, navigateOptions);\n  }, [navigate, searchParams]);\n  return [searchParams, setSearchParams];\n}\n/**\n * Returns a function that may be used to programmatically submit a form (or\n * some arbitrary data) to the server.\n */\n\nfunction useSubmit() {\n  return useSubmitImpl();\n}\n\nfunction useSubmitImpl(fetcherKey, routeId) {\n  let dataRouterContext = React.useContext(UNSAFE_DataRouterContext);\n  !dataRouterContext ? process.env.NODE_ENV !== \"production\" ? invariant(false, \"useSubmitImpl must be used within a Data Router\") : invariant(false) : void 0;\n  let {\n    router\n  } = dataRouterContext;\n  let defaultAction = useFormAction();\n  return React.useCallback(function (target, options) {\n    if (options === void 0) {\n      options = {};\n    }\n\n    if (typeof document === \"undefined\") {\n      throw new Error(\"You are calling submit during the server render. \" + \"Try calling submit within a `useEffect` or callback instead.\");\n    }\n\n    let {\n      method,\n      encType,\n      formData,\n      url\n    } = getFormSubmissionInfo(target, defaultAction, options);\n    let href = url.pathname + url.search;\n    let opts = {\n      replace: options.replace,\n      formData,\n      formMethod: method,\n      formEncType: encType\n    };\n\n    if (fetcherKey) {\n      !(routeId != null) ? process.env.NODE_ENV !== \"production\" ? invariant(false, \"No routeId available for useFetcher()\") : invariant(false) : void 0;\n      router.fetch(fetcherKey, routeId, href, opts);\n    } else {\n      router.navigate(href, opts);\n    }\n  }, [defaultAction, router, fetcherKey, routeId]);\n}\n\nfunction useFormAction(action, _temp2) {\n  let {\n    relative\n  } = _temp2 === void 0 ? {} : _temp2;\n  let routeContext = React.useContext(UNSAFE_RouteContext);\n  !routeContext ? process.env.NODE_ENV !== \"production\" ? invariant(false, \"useFormAction must be used inside a RouteContext\") : invariant(false) : void 0;\n  let [match] = routeContext.matches.slice(-1);\n  let resolvedAction = action != null ? action : \".\";\n  let path = useResolvedPath(resolvedAction, {\n    relative\n  }); // Previously we set the default action to \".\". The problem with this is that\n  // `useResolvedPath(\".\")` excludes search params and the hash of the resolved\n  // URL. This is the intended behavior of when \".\" is specifically provided as\n  // the form action, but inconsistent w/ browsers when the action is omitted.\n  // https://github.com/remix-run/remix/issues/927\n\n  let location = useLocation();\n\n  if (action == null) {\n    // Safe to write to these directly here since if action was undefined, we\n    // would have called useResolvedPath(\".\") which will never include a search\n    // or hash\n    path.search = location.search;\n    path.hash = location.hash; // When grabbing search params from the URL, remove the automatically\n    // inserted ?index param so we match the useResolvedPath search behavior\n    // which would not include ?index\n\n    if (match.route.index) {\n      let params = new URLSearchParams(path.search);\n      params.delete(\"index\");\n      path.search = params.toString() ? \"?\" + params.toString() : \"\";\n    }\n  }\n\n  if ((!action || action === \".\") && match.route.index) {\n    path.search = path.search ? path.search.replace(/^\\?/, \"?index&\") : \"?index\";\n  }\n\n  return createPath(path);\n}\n\nfunction createFetcherForm(fetcherKey, routeId) {\n  let FetcherForm = /*#__PURE__*/React.forwardRef((props, ref) => {\n    return /*#__PURE__*/React.createElement(FormImpl, _extends({}, props, {\n      ref: ref,\n      fetcherKey: fetcherKey,\n      routeId: routeId\n    }));\n  });\n\n  if (process.env.NODE_ENV !== \"production\") {\n    FetcherForm.displayName = \"fetcher.Form\";\n  }\n\n  return FetcherForm;\n}\n\nlet fetcherId = 0;\n/**\n * Interacts with route loaders and actions without causing a navigation. Great\n * for any interaction that stays on the same page.\n */\n\nfunction useFetcher() {\n  var _route$matches;\n\n  let dataRouterContext = React.useContext(UNSAFE_DataRouterContext);\n  !dataRouterContext ? process.env.NODE_ENV !== \"production\" ? invariant(false, \"useFetcher must be used within a Data Router\") : invariant(false) : void 0;\n  let {\n    router\n  } = dataRouterContext;\n  let route = React.useContext(UNSAFE_RouteContext);\n  !route ? process.env.NODE_ENV !== \"production\" ? invariant(false, \"useFetcher must be used inside a RouteContext\") : invariant(false) : void 0;\n  let routeId = (_route$matches = route.matches[route.matches.length - 1]) == null ? void 0 : _route$matches.route.id;\n  !(routeId != null) ? process.env.NODE_ENV !== \"production\" ? invariant(false, \"useFetcher can only be used on routes that contain a unique \\\"id\\\"\") : invariant(false) : void 0;\n  let [fetcherKey] = React.useState(() => String(++fetcherId));\n  let [Form] = React.useState(() => {\n    !routeId ? process.env.NODE_ENV !== \"production\" ? invariant(false, \"No routeId available for fetcher.Form()\") : invariant(false) : void 0;\n    return createFetcherForm(fetcherKey, routeId);\n  });\n  let [load] = React.useState(() => href => {\n    !router ? process.env.NODE_ENV !== \"production\" ? invariant(false, \"No router available for fetcher.load()\") : invariant(false) : void 0;\n    !routeId ? process.env.NODE_ENV !== \"production\" ? invariant(false, \"No routeId available for fetcher.load()\") : invariant(false) : void 0;\n    router.fetch(fetcherKey, routeId, href);\n  });\n  let submit = useSubmitImpl(fetcherKey, routeId);\n  let fetcher = router.getFetcher(fetcherKey);\n  let fetcherWithComponents = React.useMemo(() => _extends({\n    Form,\n    submit,\n    load\n  }, fetcher), [fetcher, Form, submit, load]);\n  React.useEffect(() => {\n    // Is this busted when the React team gets real weird and calls effects\n    // twice on mount?  We really just need to garbage collect here when this\n    // fetcher is no longer around.\n    return () => {\n      if (!router) {\n        console.warn(\"No fetcher available to clean up from useFetcher()\");\n        return;\n      }\n\n      router.deleteFetcher(fetcherKey);\n    };\n  }, [router, fetcherKey]);\n  return fetcherWithComponents;\n}\n/**\n * Provides all fetchers currently on the page. Useful for layouts and parent\n * routes that need to provide pending/optimistic UI regarding the fetch.\n */\n\nfunction useFetchers() {\n  let state = React.useContext(UNSAFE_DataRouterStateContext);\n  !state ? process.env.NODE_ENV !== \"production\" ? invariant(false, \"useFetchers must be used within a DataRouterStateContext\") : invariant(false) : void 0;\n  return [...state.fetchers.values()];\n}\nconst SCROLL_RESTORATION_STORAGE_KEY = \"react-router-scroll-positions\";\nlet savedScrollPositions = {};\n/**\n * When rendered inside a RouterProvider, will restore scroll positions on navigations\n */\n\nfunction useScrollRestoration(_temp3) {\n  let {\n    getKey,\n    storageKey\n  } = _temp3 === void 0 ? {} : _temp3;\n  let location = useLocation();\n  let matches = useMatches();\n  let navigation = useNavigation();\n  let dataRouterContext = React.useContext(UNSAFE_DataRouterContext);\n  !dataRouterContext ? process.env.NODE_ENV !== \"production\" ? invariant(false, \"useScrollRestoration must be used within a DataRouterContext\") : invariant(false) : void 0;\n  let {\n    router\n  } = dataRouterContext;\n  let state = React.useContext(UNSAFE_DataRouterStateContext);\n  !(router != null && state != null) ? process.env.NODE_ENV !== \"production\" ? invariant(false, \"useScrollRestoration must be used within a DataRouterStateContext\") : invariant(false) : void 0;\n  let {\n    restoreScrollPosition,\n    preventScrollReset\n  } = state; // Trigger manual scroll restoration while we're active\n\n  React.useEffect(() => {\n    window.history.scrollRestoration = \"manual\";\n    return () => {\n      window.history.scrollRestoration = \"auto\";\n    };\n  }, []); // Save positions on unload\n\n  useBeforeUnload(React.useCallback(() => {\n    if (navigation.state === \"idle\") {\n      let key = (getKey ? getKey(location, matches) : null) || location.key;\n      savedScrollPositions[key] = window.scrollY;\n    }\n\n    sessionStorage.setItem(storageKey || SCROLL_RESTORATION_STORAGE_KEY, JSON.stringify(savedScrollPositions));\n    window.history.scrollRestoration = \"auto\";\n  }, [storageKey, getKey, navigation.state, location, matches])); // Read in any saved scroll locations\n\n  React.useLayoutEffect(() => {\n    try {\n      let sessionPositions = sessionStorage.getItem(storageKey || SCROLL_RESTORATION_STORAGE_KEY);\n\n      if (sessionPositions) {\n        savedScrollPositions = JSON.parse(sessionPositions);\n      }\n    } catch (e) {// no-op, use default empty object\n    }\n  }, [storageKey]); // Enable scroll restoration in the router\n\n  React.useLayoutEffect(() => {\n    let disableScrollRestoration = router == null ? void 0 : router.enableScrollRestoration(savedScrollPositions, () => window.scrollY, getKey);\n    return () => disableScrollRestoration && disableScrollRestoration();\n  }, [router, getKey]); // Restore scrolling when state.restoreScrollPosition changes\n\n  React.useLayoutEffect(() => {\n    // Explicit false means don't do anything (used for submissions)\n    if (restoreScrollPosition === false) {\n      return;\n    } // been here before, scroll to it\n\n\n    if (typeof restoreScrollPosition === \"number\") {\n      window.scrollTo(0, restoreScrollPosition);\n      return;\n    } // try to scroll to the hash\n\n\n    if (location.hash) {\n      let el = document.getElementById(location.hash.slice(1));\n\n      if (el) {\n        el.scrollIntoView();\n        return;\n      }\n    } // Opt out of scroll reset if this link requested it\n\n\n    if (preventScrollReset === true) {\n      return;\n    } // otherwise go to the top on new locations\n\n\n    window.scrollTo(0, 0);\n  }, [location, restoreScrollPosition, preventScrollReset]);\n}\n\nfunction useBeforeUnload(callback) {\n  React.useEffect(() => {\n    window.addEventListener(\"beforeunload\", callback);\n    return () => {\n      window.removeEventListener(\"beforeunload\", callback);\n    };\n  }, [callback]);\n} //#endregion\n////////////////////////////////////////////////////////////////////////////////\n//#region Utils\n////////////////////////////////////////////////////////////////////////////////\n\n\nfunction warning(cond, message) {\n  if (!cond) {\n    // eslint-disable-next-line no-console\n    if (typeof console !== \"undefined\") console.warn(message);\n\n    try {\n      // Welcome to debugging React Router!\n      //\n      // This error is thrown as a convenience so you can more easily\n      // find the source for a warning that appears in the console by\n      // enabling \"pause on exceptions\" in your JavaScript debugger.\n      throw new Error(message); // eslint-disable-next-line no-empty\n    } catch (e) {}\n  }\n} //#endregion\n\nexport { BrowserRouter, Form, HashRouter, Link, NavLink, ScrollRestoration, createBrowserRouter, createHashRouter, createSearchParams, HistoryRouter as unstable_HistoryRouter, useFetcher, useFetchers, useFormAction, useLinkClickHandler, useSearchParams, useSubmit };\n//# sourceMappingURL=index.js.map\n","import {createSvgIcon} from '../create-svg-icon';\n\nexport const ErrorOutlineIcon = createSvgIcon(\n  <path d=\"M11 15h2v2h-2v-2zm0-8h2v6h-2V7zm.99-5C6.47 2 2 6.48 2 12s4.47 10 9.99 10C17.52 22 22 17.52 22 12S17.52 2 11.99 2zM12 20c-4.42 0-8-3.58-8-8s3.58-8 8-8 8 3.58 8 8-3.58 8-8 8z\" />\n, 'ErrorOutlineOutlined');\n","import {createSvgIcon} from '../create-svg-icon';\n\nexport const CheckCircleIcon = createSvgIcon(\n  <path d=\"M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm0 18c-4.41 0-8-3.59-8-8s3.59-8 8-8 8 3.59 8 8-3.59 8-8 8zm4.59-12.42L10 14.17l-2.59-2.58L6 13l4 4 8-8z\" />\n, 'CheckCircleOutlined');\n","import {AnimatePresence, m} from 'framer-motion';\nimport React from 'react';\nimport clsx from 'clsx';\nimport {IconButton} from '../buttons/icon-button';\nimport {CloseIcon} from '../../icons/material/Close';\nimport {MixedText} from '../../i18n/mixed-text';\nimport {Button} from '../buttons/button';\nimport {toastState, useToastStore} from './toast-store';\nimport {Link} from 'react-router-dom';\nimport {ErrorOutlineIcon} from '../../icons/material/ErrorOutline';\nimport {CheckCircleIcon} from '../../icons/material/CheckCircle';\n\nexport function ToastContainer() {\n  const toasts = useToastStore(s => s.toasts);\n\n  return (\n    <div className=\"relative pointer-events-none\">\n      <AnimatePresence initial={false}>\n        {toasts.map(toast => (\n          <div\n            key={toast.id}\n            data-toast={true}\n            className={clsx(\n              'fixed mx-auto p-20 z-toast',\n              toast.position === 'bottom-center'\n                ? 'left-0 right-0 bottom-0'\n                : 'right-0 bottom-0'\n            )}\n          >\n            <m.div\n              initial={{opacity: 0, y: 50, scale: 0.3}}\n              animate={{opacity: 1, y: 0, scale: 1}}\n              exit={{opacity: 0, scale: 0.5, transition: {duration: 0.2}}}\n              className={clsx(\n                'flex items-center gap-10 min-w-288 max-w-500 shadow-lg w-min rounded-lg pl-16 pr-6 py-6 text-sm pointer-events-auto max-h-100 bg-paper text-main bg-paper border mx-auto'\n              )}\n              onPointerEnter={() => toast.timer?.pause()}\n              onPointerLeave={() => toast.timer?.resume()}\n              role=\"alert\"\n              aria-live={toast.type === 'danger' ? 'assertive' : 'polite'}\n            >\n              {toast.type === 'danger' && (\n                <ErrorOutlineIcon\n                  className=\"text-danger flex-shrink-0\"\n                  size=\"md\"\n                />\n              )}\n              {toast.type === 'positive' && (\n                <CheckCircleIcon\n                  className=\"text-positive flex-shrink-0\"\n                  size=\"md\"\n                />\n              )}\n\n              <div className=\"overflow-hidden overflow-ellipsis w-max mr-auto\">\n                <MixedText value={toast.message} />\n              </div>\n\n              {toast.action && (\n                <Button\n                  variant=\"text\"\n                  color=\"primary\"\n                  size=\"sm\"\n                  className=\"flex-shrink-0\"\n                  onFocus={() => toast.timer?.pause()}\n                  onBlur={() => toast.timer?.resume()}\n                  onClick={() => toastState().remove(toast.id)}\n                  elementType={Link}\n                  to={toast.action.action}\n                >\n                  <MixedText value={toast.action.label} />\n                </Button>\n              )}\n              <IconButton\n                onFocus={() => toast.timer?.pause()}\n                onBlur={() => toast.timer?.resume()}\n                type=\"button\"\n                className=\"flex-shrink-0\"\n                onClick={() => {\n                  toastState().remove(toast.id);\n                }}\n                size=\"sm\"\n              >\n                <CloseIcon />\n              </IconButton>\n            </m.div>\n          </div>\n        ))}\n      </AnimatePresence>\n    </div>\n  );\n}\n","import {isMac} from '@react-aria/utils';\n\ninterface Event {\n  altKey: boolean;\n  ctrlKey: boolean;\n  metaKey: boolean;\n}\n\nexport function isCtrlKeyPressed(e: Event) {\n  if (isMac()) {\n    return e.metaKey;\n  }\n\n  return e.ctrlKey;\n}\n","import React from 'react';\nimport {isCtrlKeyPressed} from '../common/utils/keybinds/is-ctrl-key-pressed';\nimport {tools} from '../state/utils';\n\nexport function handleCanvasKeydown(e: React.KeyboardEvent) {\n  switch (e.key) {\n    case 'z':\n      if (isCtrlKeyPressed(e)) {\n        e.preventDefault();\n        e.stopPropagation();\n        if (e.shiftKey) {\n          tools().history.redo();\n        } else {\n          tools().history.undo();\n        }\n      }\n      break;\n    case 'ArrowUp':\n      e.preventDefault();\n      e.stopPropagation();\n      tools().objects.move('up');\n      break;\n    case 'ArrowRight':\n      e.preventDefault();\n      e.stopPropagation();\n      tools().objects.move('right');\n      break;\n    case 'ArrowDown':\n      e.preventDefault();\n      e.stopPropagation();\n      tools().objects.move('down');\n      break;\n    case 'ArrowLeft':\n      e.preventDefault();\n      e.stopPropagation();\n      tools().objects.move('left');\n      break;\n    case 'Delete':\n      e.preventDefault();\n      e.stopPropagation();\n      tools().objects.delete();\n      break;\n    default:\n  }\n}\n","import {DragMonitor} from './use-drag-monitor';\nimport {ConnectedDraggable, DraggableId} from './use-draggable';\nimport {ConnectedDroppable} from './use-droppable';\n\nexport type DragSessionStatus =\n  | 'dropSuccess'\n  | 'dropFail'\n  | 'dragging'\n  | 'inactive';\n\nexport interface DragSession {\n  dragTargetId?: DraggableId;\n  status: DragSessionStatus;\n}\n\nexport const draggables = new Map<DraggableId, ConnectedDraggable>();\nexport const droppables = new Map<DraggableId, ConnectedDroppable>();\nexport const dragMonitors = new Map<DraggableId, DragMonitor>();\nexport const dragSession: DragSession = {\n  status: 'inactive',\n};\n","import {UploadedFile} from '../../../uploads/uploaded-file';\n\nexport async function* readFilesFromDataTransfer(dataTransfer: DataTransfer) {\n  for (const item of dataTransfer.items) {\n    if (item.kind === 'file') {\n      if (typeof item.webkitGetAsEntry === 'function') {\n        const entry: FileSystemEntry | null = item.webkitGetAsEntry();\n        if (!entry) continue;\n\n        if (entry.isFile) {\n          if (entry.name === '.DS_Store') continue;\n          yield new UploadedFile(item.getAsFile()!, entry.fullPath);\n        } else if (entry.isDirectory) {\n          yield* getEntries(entry as FileSystemDirectoryEntry);\n        }\n      } else {\n        const file = item.getAsFile();\n        if (!file || file.name === '.DS_Store') continue;\n        yield new UploadedFile(file, (item as any).fullPath);\n      }\n    }\n  }\n}\n\nasync function* getEntries(item: FileSystemDirectoryEntry): AsyncIterable<any> {\n  const reader = item.createReader();\n\n  // We must call readEntries repeatedly because there may be a limit to the\n  // number of entries that are returned at once.\n  let entries: FileSystemEntry[];\n  do {\n    entries = await new Promise((resolve, reject) => {\n      reader.readEntries(resolve, reject);\n    });\n\n    for (const entry of entries) {\n      if (entry.isFile) {\n        if (entry.name === '.DS_Store') continue;\n        const file = await getEntryFile(entry as FileSystemFileEntry);\n        yield new UploadedFile(file, entry.fullPath);\n      } else if (entry.isDirectory) {\n        yield* getEntries(entry as FileSystemDirectoryEntry);\n      }\n    }\n  } while (entries.length > 0);\n}\n\nfunction getEntryFile(entry: FileSystemFileEntry): Promise<File> {\n  return new Promise((resolve, reject) => entry.file(resolve, reject));\n}\n","export async function asyncIterableToArray<T>(\n  iterator: AsyncIterable<T>\n): Promise<T[]> {\n  const items: T[] = [];\n  for await (const item of iterator) {\n    items.push(item);\n  }\n  return items;\n}\n","import React, {RefObject, useLayoutEffect, useRef} from 'react';\nimport {draggables, dragSession, droppables} from './drag-state';\nimport {readFilesFromDataTransfer} from './read-files-from-data-transfer';\nimport {asyncIterableToArray} from '../../../utils/array/async-iterable-to-array';\nimport {InteractableRect} from '../interactable-event';\nimport {DraggableId, MixedDraggable} from './use-draggable';\n\nexport interface ConnectedDroppable {\n  id: DraggableId;\n  rect?: InteractableRect;\n  disabled?: boolean;\n  ref: RefObject<HTMLElement>;\n}\n\n// File dragged in from desktop\nexport interface NativeFileDraggable {\n  type: 'nativeFile';\n  el: null;\n  ref: null;\n  getData: () => Promise<File[]>;\n}\n\ninterface UseDroppableProps<T extends HTMLElement> {\n  id: DraggableId;\n  disabled?: boolean;\n  types: ('nativeFile' | string)[];\n  ref: RefObject<T>;\n  onDragEnter?: (target: MixedDraggable) => void;\n  onDragLeave?: (target: MixedDraggable) => void;\n  // Handler that is called after draggable is held over droppable for a period of time.\n  // This typically opens the item so that the user can drop within it.\n  onDropActivate?: (e: MixedDraggable) => void;\n  onDrop?: (target: MixedDraggable) => void | Promise<void> | false;\n  acceptsDrop?: (target: MixedDraggable) => boolean;\n}\n\ninterface DroppableState {\n  dragOverElements: Set<Element>;\n  dropActivateTimer: ReturnType<typeof setTimeout> | undefined;\n}\n\nconst DROP_ACTIVATE_TIMEOUT = 400;\n\nexport function useDroppable<T extends HTMLElement>({\n  id,\n  disabled,\n  ref,\n  ...options\n}: UseDroppableProps<T>) {\n  const state = useRef<DroppableState>({\n    dragOverElements: new Set<Element>(),\n    dropActivateTimer: undefined,\n  }).current;\n\n  const optionsRef = useRef(options);\n  optionsRef.current = options;\n\n  useLayoutEffect(() => {\n    droppables.set(id, {\n      ...droppables.get(id),\n      disabled,\n      id,\n      ref,\n    });\n    return () => {\n      droppables.delete(id);\n    };\n  }, [id, optionsRef, disabled, ref]);\n\n  // check if drop target accepted drag target\n  const canDrop = (draggable: MixedDraggable): boolean => {\n    const options = optionsRef.current;\n\n    return !!(\n      draggable?.type &&\n      ref.current !== draggable.ref?.current &&\n      options.types.includes(draggable.type) &&\n      (!options.acceptsDrop || options.acceptsDrop(draggable))\n    );\n  };\n\n  const fireDragLeave = (e: React.DragEvent<HTMLElement>) => {\n    const draggable = getDraggable(e);\n    if (draggable) {\n      optionsRef.current.onDragLeave?.(draggable);\n    }\n  };\n\n  const onDragEnter = (e: React.DragEvent<HTMLElement>) => {\n    e.stopPropagation();\n\n    state.dragOverElements.add(e.target as Element);\n    if (state.dragOverElements.size > 1) {\n      return;\n    }\n\n    const draggable = getDraggable(e);\n    if (draggable && canDrop(draggable)) {\n      optionsRef.current.onDragEnter?.(draggable);\n\n      clearTimeout(state.dropActivateTimer);\n      if (typeof optionsRef.current.onDropActivate === 'function') {\n        state.dropActivateTimer = setTimeout(() => {\n          if (draggable) {\n            optionsRef.current.onDropActivate?.(draggable);\n          }\n        }, DROP_ACTIVATE_TIMEOUT);\n      }\n    }\n  };\n\n  const onDragLeave = (e: React.DragEvent<HTMLElement>) => {\n    e.stopPropagation();\n\n    // Track all the targets of dragenter events in a set, and remove them\n    // in dragleave. When the set becomes empty, we've left the drop target completely.\n    // We must also remove any elements that are no longer in the DOM, because dragleave\n    // events will never be fired for these. This can happen, for example, with drop\n    // indicators between items, which disappear when the drop target changes.\n    state.dragOverElements.delete(e.target as Element);\n    for (const element of state.dragOverElements) {\n      if (!e.currentTarget.contains(element)) {\n        state.dragOverElements.delete(element);\n      }\n    }\n\n    if (state.dragOverElements.size > 0) {\n      return;\n    }\n\n    const draggable = getDraggable(e);\n    if (draggable && canDrop(draggable)) {\n      fireDragLeave(e);\n      clearTimeout(state.dropActivateTimer);\n    }\n  };\n\n  const onDrop = async (e: React.DragEvent<HTMLElement>) => {\n    e.preventDefault();\n    e.stopPropagation();\n    state.dragOverElements.clear();\n\n    fireDragLeave(e);\n    clearTimeout(state.dropActivateTimer);\n\n    const draggable = getDraggable(e);\n    if (draggable) {\n      optionsRef.current.onDragLeave?.(draggable);\n\n      // drop target does not accept this type of droppable\n      if (!canDrop(draggable)) {\n        if (dragSession.status !== 'inactive') {\n          dragSession.status = 'dropFail';\n        }\n        // drop target accepts this type, but it might still reject the drop in callback\n      } else {\n        // allow callback to mark drop as failed\n        const dropResult = optionsRef.current.onDrop?.(draggable);\n\n        // drag session will only be active for draggables within the app, never for files dragged in from desktop\n        if (dragSession.status !== 'inactive') {\n          dragSession.status =\n            dropResult === false ? 'dropFail' : 'dropSuccess';\n        }\n      }\n    }\n  };\n\n  const droppableProps = {\n    onDragOver: (e: React.DragEvent) => {\n      e.preventDefault();\n      e.stopPropagation();\n    },\n    onDragEnter,\n    onDragLeave,\n    onDrop,\n  };\n\n  return {\n    droppableProps: disabled ? {} : droppableProps,\n  };\n}\n\nfunction getDraggable(\n  e: React.DragEvent<HTMLElement>\n): MixedDraggable | undefined {\n  if (dragSession.dragTargetId != null) {\n    return draggables.get(dragSession.dragTargetId);\n  } else if (e.dataTransfer.types.includes('Files')) {\n    return {\n      type: 'nativeFile',\n      el: null,\n      ref: null,\n      getData: () => {\n        return asyncIterableToArray(readFilesFromDataTransfer(e.dataTransfer));\n      },\n    };\n  }\n}\n","import React, {useMemo} from 'react';\nimport {\n  BoostrapDataContext,\n  BoostrapDataContextValue,\n} from './common/core/bootstrap-data/bootstrap-data-context';\nimport {useStore} from './state/store';\n\ninterface BootstrapDataProviderProps {\n  children: any;\n}\nexport function PixieBootstrapDataProvider({\n  children,\n}: BootstrapDataProviderProps) {\n  const data = useStore(s => s.bootstrapData);\n\n  const value: BoostrapDataContextValue = useMemo(() => {\n    return {\n      data,\n      setBootstrapData: () => {},\n      mergeBootstrapData: () => {},\n      invalidateBootstrapData: () => {},\n    };\n  }, [data]) as BoostrapDataContextValue;\n\n  return (\n    <BoostrapDataContext.Provider value={value}>\n      {children}\n    </BoostrapDataContext.Provider>\n  );\n}\n","import React, {useCallback, useEffect, useRef} from 'react';\nimport {domAnimation, LazyMotion, m, Variants} from 'framer-motion';\nimport clsx from 'clsx';\nimport {mergeProps} from '@react-aria/utils';\nimport {initTools} from '../tools/init-tools';\nimport {observeSize} from '../common/utils/dom/observe-size';\nimport {getBoundingClientRect} from '../common/utils/dom/get-bounding-client-rect';\nimport {ToolbarContainer} from './toolbar/toolbar-container';\nimport {LoadingIndicator} from './stage/loading-indicator';\nimport {CanvasWrapper} from './stage/canvas-wrapper';\nimport {ToolControlsOverlay} from './navbar/tool-controls-overlay';\nimport {Navbar} from './navbar/navbar';\nimport {OverlayPanelContainer} from './overlay-panel-container';\nimport {useStore} from '../state/store';\nimport {ToastContainer} from '../common/ui/toast/toast-container';\nimport {state, tools} from '../state/utils';\nimport {handleCanvasKeydown} from './handle-canvas-keydown';\nimport {IconButton} from '../common/ui/buttons/icon-button';\nimport {CloseIcon} from '../common/icons/material/Close';\nimport {useEditorMode} from './editor-mode';\nimport {Underlay} from '../common/ui/overlays/underlay';\nimport {useDroppable} from '../common/ui/interactions/dnd/use-droppable';\nimport {MixedDraggable} from '../common/ui/interactions/dnd/use-draggable';\nimport {UploadedFile} from '../common/uploads/uploaded-file';\nimport {PixieBootstrapDataProvider} from '../pixie-bootstrap-data-provider';\n\nexport function ImageEditor() {\n  const isVisible = useStore(s => s.config.ui?.visible) ?? true;\n  const navPosition = useStore(s => s.config.ui?.nav?.position) ?? 'bottom';\n  const menuPosition = useStore(s => s.config.ui?.menubar?.position) ?? 'top';\n  const allowEditorClose = useStore(s => s.config.ui?.allowEditorClose) ?? true;\n  const canvasRef = useRef<HTMLCanvasElement>(null!);\n  const stageRef = useRef<HTMLDivElement>(null);\n  const {isModal, isMobile} = useEditorMode();\n\n  const onDrop = useCallback(async (target: MixedDraggable) => {\n    if (state().activeTool || state().dirty || target.type !== 'nativeFile')\n      return;\n    const files = (await target.getData()) as UploadedFile[];\n\n    if (!tools().import.fileIsValid(files[0])) {\n      return;\n    }\n\n    if (state().config.tools?.import?.openDroppedImageAsBackground ?? false) {\n      await tools().import.openBackgroundImage(files[0]);\n    } else {\n      await tools().import.openUploadedFile(files[0]);\n    }\n  }, []);\n\n  const {droppableProps} = useDroppable({\n    id: 'pixie-root',\n    ref: stageRef,\n    types: ['nativeFile'],\n    onDrop: onDrop,\n  });\n\n  useEffect(() => {\n    // editor already booted\n    if (!state().fabric) {\n      useStore.setState({canvasRef});\n      initTools(canvasRef.current);\n\n      if (state().config.ui?.defaultTool) {\n        state().setActiveTool(state().config.ui?.defaultTool!, null);\n      }\n\n      tools()\n        .canvas.loadInitialContent()\n        .then(() => {\n          state().config.onLoad?.(state().editor);\n        });\n    }\n\n    // set initial rects for stage and canvas, and update them on resize\n    const unobserveStage = observeSize(stageRef, () => {\n      state().setStageSize(getBoundingClientRect(stageRef.current!));\n    });\n    const unobserveCanvas = observeSize(canvasRef, () => {\n      state().setCanvasSize(getBoundingClientRect(canvasRef.current));\n    });\n\n    return () => {\n      unobserveStage();\n      unobserveCanvas();\n    };\n  }, [stageRef]);\n\n  const variants: Variants = {\n    visible: {\n      opacity: 1,\n      scale: 1,\n      display: 'flex',\n    },\n    hidden: {opacity: 0, transitionEnd: {display: 'none'}},\n  };\n\n  const rootClassName = clsx(\n    'pixie-root flex flex-col overflow-hidden bg-background text-main no-tap-highlight w-full h-full',\n    {\n      relative: !isModal,\n      'fixed inset-0 w-full h-full z-20': isModal,\n      'shadow-lg border rounded-md m-auto max-h-[calc(100vh-90px)] max-w-[calc(100vw-90px)]':\n        isModal && !isMobile,\n    }\n  );\n\n  const showCloseIcon = isModal && isVisible && !isMobile && allowEditorClose;\n  const showUnderlay = isModal && isVisible;\n\n  return (\n    <LazyMotion features={domAnimation} strict>\n      <PixieBootstrapDataProvider>\n        {showCloseIcon && (\n          <IconButton\n            className=\"z-20 fixed right-2 top-2 text-white\"\n            size=\"lg\"\n            onClick={() => {\n              state().editor.close();\n            }}\n          >\n            <CloseIcon />\n          </IconButton>\n        )}\n        {showUnderlay && <Underlay position=\"fixed\" disableInitialTransition />}\n        <m.div\n          initial={false}\n          variants={variants}\n          animate={isVisible ? 'visible' : 'hidden'}\n          className={rootClassName}\n        >\n          {menuPosition === 'top' && <ToolbarContainer />}\n          {navPosition === 'top' && <Navbar className=\"pt-14\" />}\n\n          <main\n            className=\"relative flex-auto my-20 overflow-hidden outline-none\"\n            tabIndex={-1}\n            {...mergeProps(droppableProps, {\n              onKeyDownCapture: handleCanvasKeydown,\n            })}\n            ref={stageRef}\n          >\n            <LoadingIndicator />\n            <CanvasWrapper ref={canvasRef} />\n          </main>\n          <ToolControlsOverlay />\n          {navPosition === 'bottom' && <Navbar />}\n          {menuPosition === 'bottom' && <ToolbarContainer />}\n          <OverlayPanelContainer />\n          <ToastContainer />\n        </m.div>\n      </PixieBootstrapDataProvider>\n    </LazyMotion>\n  );\n}\n","import React from 'react';\nimport {Canvas, IEvent} from 'fabric/fabric-impl';\nimport deepmerge from 'deepmerge';\nimport styleInject from 'style-inject';\nimport NP from 'number-precision';\nimport {init as initSentry} from '@sentry/react';\nimport {\n  DEFAULT_CONFIG,\n  PIXIE_VERSION,\n  PixieConfig,\n} from './config/default-config';\nimport {useStore} from './state/store';\nimport {ObjectModifiedEvent} from './objects/object-modified-event';\nimport type {Tools} from './tools/init-tools';\nimport {state, tools} from './state/utils';\nimport {EditorState} from './state/editor-state';\nimport {resetEditor} from './utils/reset-editor';\nimport {fetchStateJsonFromUrl} from './tools/import/fetch-state-json-from-url';\nimport {getCurrentCanvasState} from './tools/history/state/get-current-canvas-state';\nimport {SerializedPixieState} from './tools/history/serialized-pixie-state';\nimport {setActiveTool} from './ui/navbar/set-active-tool';\nimport {ToolName} from './tools/tool-name';\nimport {canvasIsEmpty} from './tools/canvas/canvas-is-empty';\nimport css from './styles.css';\nimport {toast} from './common/ui/toast/toast';\nimport {createRoot} from 'react-dom/client';\nimport {ImageEditor} from './ui/image-editor';\nimport {setRootEl} from './common/core/root-el';\n\nNP.enableBoundaryChecking(false);\n\nexport class Pixie {\n  tools: Tools = {} as any;\n  fabric: Canvas | null = null;\n\n  static defaultConfig = DEFAULT_CONFIG;\n  static version = PIXIE_VERSION;\n\n  get state() {\n    return state();\n  }\n\n  get defaultConfig() {\n    return Pixie.defaultConfig;\n  }\n\n  constructor(config: Partial<PixieConfig>) {\n    if (config.sentryDsn) {\n      initSentry({\n        dsn: config.sentryDsn,\n      });\n    }\n    if (import.meta.env.PROD) {\n      styleInject(css);\n    }\n    if (!config.selector) {\n      throw new Error('Pixie required \"selector\" option.');\n    }\n    const container = document.querySelector(config.selector);\n    if (!container) {\n      return;\n    }\n    container.classList.add('pi');\n    setRootEl(container as HTMLElement);\n    this.setConfig(config);\n    useStore.setState({editor: this});\n\n    const root = createRoot(container);\n    root.render(\n      <React.StrictMode>\n        <ImageEditor />\n      </React.StrictMode>\n    );\n  }\n\n  /**\n   * Open editor.\n   */\n  open(config: Partial<PixieConfig> = {}) {\n    if (state().config.ui?.visible) return;\n    this.setConfig(deepmerge(config, {ui: {visible: true}}));\n    requestAnimationFrame(() => {\n      tools().zoom.fitToScreen();\n      tools().history.addInitial();\n      if (canvasIsEmpty() && state().config.ui?.openImageDialog?.show) {\n        this.togglePanel('newImage', true);\n      }\n      state().config.onOpen?.();\n    });\n  }\n\n  /**\n   * Close editor.\n   */\n  close() {\n    if (!state().config.ui?.visible) return;\n    this.setConfig({ui: {visible: false}});\n    state().config.onClose?.();\n  }\n\n  /**\n   * Override editor configuration.\n   */\n  setConfig(config: Partial<PixieConfig>) {\n    state().setConfig(config);\n  }\n\n  /**\n   * Open file upload window and add selected image to canvas.\n   */\n  uploadAndAddImage() {\n    return tools().import.uploadAndAddImage();\n  }\n\n  /**\n   * Open file upload window and replace canvas contents with selected image.\n   */\n  uploadAndReplaceMainImage() {\n    return tools().import.uploadAndReplaceMainImage();\n  }\n\n  /**\n   * Open file upload window and replace canvas contents with selected state file.\n   */\n  uploadAndOpenStateFile() {\n    return tools().import.uploadAndOpenStateFile();\n  }\n\n  /**\n   * Clear current canvas and open a new one at specified size.\n   */\n  newCanvas(width: number, height: number, bgColor?: string) {\n    return tools().canvas.openNew(width, height, bgColor);\n  }\n\n  /**\n   * Get current canvas state as json string.\n   */\n  getState(customProps?: string[]) {\n    return JSON.stringify(getCurrentCanvasState(customProps));\n  }\n\n  /**\n   * Replace current canvas contents with specified pixie state.\n   */\n  setState(data: string | SerializedPixieState) {\n    return tools().import.loadState(data);\n  }\n\n  /**\n   * Replace current canvas contents with pixie state file loaded from specified url.\n   */\n  async setStateFromUrl(url: string) {\n    const stateObj = await fetchStateJsonFromUrl(url);\n    return tools().import.loadState(stateObj);\n  }\n\n  /**\n   * Open specified tool (crop, draw, text etc.)\n   */\n  openTool(name: ToolName) {\n    setActiveTool(name);\n  }\n\n  /**\n   * Apply any pending changes from currently open tool.\n   * This is identical to clicking \"apply\" button in the editor.\n   */\n  applyChanges() {\n    state().applyChanges();\n  }\n\n  /**\n   * Cancel any pending changes from currently open tool.\n   * This is identical to clicking \"cancel\" button in the editor.\n   */\n  cancelChanges() {\n    state().cancelChanges();\n  }\n\n  /**\n   * Fully reset editor state and optionally\n   * override specified configuration.\n   */\n  async resetEditor(config?: PixieConfig) {\n    await resetEditor(config);\n    await tools().canvas.loadInitialContent();\n  }\n\n  /**\n   * Toggle specified floating panel.\n   */\n  togglePanel(name: keyof EditorState['openPanels'], isOpen?: boolean) {\n    if (name === 'objects') {\n      state().togglePanel('history', false);\n    }\n    if (name === 'history') {\n      state().togglePanel('objects', false);\n    }\n    state().togglePanel(name, isOpen);\n  }\n\n  /**\n   * Listen to specified canvas event.\n   * (List of all available events can be found in the documentation)\n   */\n  // @ts-ignore\n  on(event: 'object:modified', handler: (e: ObjectModifiedEvent) => void): void;\n  on(event: string, handler: (e: IEvent) => void): void {\n    this.fabric?.on(event, handler);\n  }\n\n  /**\n   * Check if any modifications made to canvas have not been applied yet.\n   */\n  isDirty() {\n    return state().dirty;\n  }\n\n  /**\n   * @hidden\n   */\n  get(name: keyof Tools) {\n    return this.tools[name];\n  }\n\n  /**\n   * Display specified notification message in the editor.\n   */\n  notify(message: string) {\n    return toast(message);\n  }\n\n  /**\n   * Create a new editor instance.\n   */\n  static init(config: PixieConfig): Promise<Pixie> {\n    return new Promise(resolve => {\n      const userOnLoad = config.onLoad;\n      config.onLoad = (instance: Pixie) => {\n        // call user specified \"onLoad\" function\"\n        userOnLoad?.(instance);\n        resolve(instance);\n      };\n      (() => new this(config))();\n    });\n  }\n}\n"],"names":["isMergeableObject","value","isNonNullObject","isSpecial","stringValue","isReactElement","canUseSymbol","REACT_ELEMENT_TYPE","emptyTarget","val","cloneUnlessOtherwiseSpecified","options","deepmerge","defaultArrayMerge","target","source","element","getMergeFunction","key","customMerge","getEnumerableOwnPropertySymbols","symbol","getKeys","propertyIsOnObject","object","property","propertyIsUnsafe","mergeObject","destination","sourceIsArray","targetIsArray","sourceAndTargetTypesMatch","array","prev","next","deepmerge_1","cjs","styleInject","css","ref","insertAt","head","style","strip","num","precision","digitLength","eSplit","len","float2Fixed","dLen","checkBoundary","_boundaryCheckingState","iteratorOperation","arr","operation","num1","num2","others","res","times","nums","_i","num1Changed","num2Changed","baseNum","leftValue","plus","minus","divide","round","ratio","base","result","enableBoundaryChecking","flag","index","isGlobalObj","obj","GLOBAL","getGlobalObject","getGlobalSingleton","name","creator","global","__SENTRY__","singleton","objectToString","isError","wat","isInstanceOf","isBuiltin","className","isErrorEvent","isDOMError","isDOMException","isString","isPrimitive","isPlainObject","isEvent","isElement","isRegExp","isThenable","isSyntheticEvent","isNaN","htmlTreeAsString","elem","keyAttrs","currentElem","MAX_TRAVERSE_HEIGHT","MAX_OUTPUT_LEN","out","height","separator","sepLength","nextStr","_htmlElementAsString","el","classes","attr","i","keyAttrPairs","keyAttr","keyAttrPair","allowedAttrs","getLocationHref","SentryError","message","logLevel","DSN_REGEX","isValidProtocol","protocol","dsnToString","dsn","withPassword","host","path","pass","port","projectId","publicKey","dsnFromString","str","match","lastPath","split","projectMatch","dsnFromComponents","components","validateDsn","requiredComponents","component","makeDsn","from","PREFIX","CONSOLE_LEVELS","consoleSandbox","callback","originalConsole","wrappedLevels","level","originalWrappedFunc","makeLogger","enabled","logger","args","truncate","max","safeJoin","input","delimiter","output","isMatchingPattern","pattern","fill","replacementFactory","original","wrapped","markFunctionWrapped","addNonEnumerableProperty","proto","getOriginalFunction","func","urlEncode","convertToPlainObject","getOwnProperties","newObj","serializeEventTarget","extractedProps","extractExceptionKeysForMessage","exception","maxLength","keys","includedKeys","serialized","dropUndefinedKeys","inputValue","memoizationMap","_dropUndefinedKeys","memoVal","returnValue","item","STACKTRACE_LIMIT","createStackParser","parsers","sortedParsers","a","b","p","stack","skipFirst","frames","line","cleanedLine","parser","frame","stripSentryFramesAndReverse","stackParserFromStackParserOptions","stackParser","localStack","firstFrameFunction","lastFrameFunction","defaultFunctionName","getFunctionName","fn","supportsFetch","isNativeFetch","supportsNativeFetch","doc","sandbox","err","supportsHistory","chrome","isChromePackagedApp","hasHistoryApi","handlers","instrumented","instrument","type","instrumentConsole","instrumentDOM","instrumentXHR","instrumentFetch","instrumentHistory","instrumentError","instrumentUnhandledRejection","addInstrumentationHandler","triggerHandlers","data","handler","e","originalConsoleMethod","originalFetch","handlerData","getFetchMethod","getFetchUrl","response","error","fetchArgs","xhrproto","originalOpen","xhr","url","xhrInfo","onreadystatechangeHandler","readyStateArgs","originalSend","lastHref","oldOnPopState","to","historyReplacementFunction","originalHistoryFunction","debounceDuration","debounceTimerID","lastCapturedEvent","shouldShortcircuitPreviousDebounce","previous","current","shouldSkipDOMEvent","event","makeDOMEventHandler","globalListener","triggerDOMHandler","globalDOMEventHandler","originalAddEventListener","listener","handlerForType","originalRemoveEventListener","_oldOnErrorHandler","msg","column","_oldOnUnhandledRejectionHandler","memoBuilder","hasWeakSet","inner","memoize","unmemoize","uuid4","crypto","getRandomByte","c","getFirstException","getEventDescription","eventId","firstException","addExceptionTypeValue","values","addExceptionMechanism","newMechanism","defaultMechanism","currentMechanism","mergedData","checkOrSetAlreadyCaught","arrayify","maybeArray","isBrowserBundle","isNodeEnv","dynamicRequire","mod","request","normalize","depth","maxProperties","visit","normalizeToSize","maxSize","normalized","jsonSize","memo","stringified","stringifyValue","valueWithToJSON","jsonValue","numAdded","visitable","visitKey","visitValue","utf8Length","States","PENDING","RESOLVED","REJECTED","resolvedSyncPromise","SyncPromise","resolve","rejectedSyncPromise","reason","_","reject","executor","onfulfilled","onrejected","onfinally","isRejected","state","cachedHandlers","makePromiseBuffer","limit","buffer","isReady","remove","task","add","taskProducer","drain","timeout","counter","capturedSetTimeout","parseUrl","query","fragment","validSeverityLevels","severityLevelFromString","dateTimestampSource","getBrowserPerformance","performance","timeOrigin","getNodePerformance","perfHooks","platformPerformance","timestampSource","dateTimestampInSeconds","timestampInSeconds","threshold","performanceNow","dateNow","timeOriginDelta","timeOriginIsReliable","navigationStart","hasNavigationStart","navigationStartDelta","navigationStartIsReliable","createEnvelope","headers","items","addItemToEnvelope","envelope","newItem","forEachEnvelopeItem","envelopeItems","envelopeItem","envelopeItemType","encodeUTF8","textEncoder","utf8","serializeEnvelope","envHeaders","parts","append","itemHeaders","payload","concatBuffers","buffers","totalLength","acc","buf","merged","offset","createAttachmentEnvelopeItem","attachment","ITEM_TYPE_TO_DATA_CATEGORY_MAP","envelopeItemTypeToDataCategory","createClientReportEnvelope","discarded_events","timestamp","clientReportItem","DEFAULT_RETRY_AFTER","parseRetryAfterHeader","header","now","headerDelay","headerDate","disabledUntil","limits","category","isRateLimited","updateRateLimits","statusCode","updatedRateLimits","rateLimitHeader","retryAfterHeader","retryAfter","categories","delay","makeSession","context","startingTime","session","sessionToJSON","updateSession","duration","closeSession","status","MAX_BREADCRUMBS","Scope","scope","newScope","user","requestSession","tags","extras","extra","fingerprint","span","captureContext","updatedScope","breadcrumb","maxBreadcrumbs","maxCrumbs","mergedBreadcrumb","hint","transactionName","getGlobalEventProcessors","newData","processors","processor","final","addGlobalEventProcessor","API_VERSION","DEFAULT_BREADCRUMBS","Hub","client","_version","version","top","syntheticException","beforeBreadcrumb","finalBreadcrumb","oldHub","makeMain","integration","customSamplingContext","endSession","layer","release","environment","userAgent","currentSession","method","carrier","getMainCarrier","sentry","hub","registry","getHubFromCarrier","setHubOnCarrier","getCurrentHub","hasHubOnCarrier","getHubFromActiveDomain","activeDomain","registryHubTopStack","captureException","withScope","SENTRY_API_VERSION","getBaseApiEndpoint","_getIngestEndpoint","_encodedAuth","sdkInfo","getEnvelopeEndpointWithUrlEncodedAuth","tunnelOrOptions","tunnel","getSdkMetadataForEnvelopeHeader","metadata","enhanceEventWithSdkInfo","createSessionEnvelope","envelopeHeaders","createEventEnvelope","eventType","createEventEnvelopeHeaders","eventItem","dynamicSamplingContext","installedIntegrations","filterDuplicates","integrations","integrationsByName","currentInstance","existingInstance","getIntegrationsToSetup","defaultIntegrations","userIntegrations","finalIntegrations","debugIndex","debugInstance","setupIntegrations","integrationIndex","ALREADY_SEEN_ERROR","BaseClient","promisedEvent","transport","clientFinished","transportFlushed","integrationId","env","crashed","errored","exceptions","ex","mechanism","sessionNonTerminal","shouldUpdateAndSend","ticked","tick","interval","normalizeDepth","normalizeMaxBreadth","prepared","finalScope","attachments","evt","maxBreadth","dist","maxValueLength","integrationsArray","finalEvent","sentryError","beforeSend","sampleRate","isTransaction","isInternalException","beforeSendResult","_ensureBeforeSendRv","processedEvent","transactionInfo","promise","outcomes","rv","nullErr","initAndBind","clientClass","DEFAULT_TRANSPORT_BUFFER_SIZE","createTransport","makeRequest","rateLimits","flush","send","filteredEnvelopeItems","envelopeItemDataCategory","filteredEnvelope","recordEnvelopeLoss","requestTask","SDK_VERSION","originalFunctionToString","FunctionToString","DEFAULT_IGNORE_ERRORS","InboundFilters","_options","eventProcess","self","clientOptions","_mergeOptions","_shouldDropEvent","internalOptions","_isSentryError","_isIgnoredError","_isDeniedUrl","_getEventFilterUrl","_isAllowedUrl","ignoreErrors","_getPossibleEventMessages","denyUrls","allowUrls","_getLastValidUrl","exceptionFromError","parseStackFrames","extractMessage","eventFromPlainObject","isUnhandledRejection","eventFromError","stacktrace","popSize","getPopSize","reactMinifiedRegexp","eventFromException","attachStacktrace","eventFromUnknownInput","eventFromMessage","eventFromString","errorEvent","domException","objectException","BREADCRUMB_INTEGRATION_ID","Breadcrumbs","_consoleBreadcrumb","_domBreadcrumb","_xhrBreadcrumb","_fetchBreadcrumb","_historyBreadcrumb","dom","_innerDomBreadcrumb","status_code","body","parsedLoc","parsedFrom","parsedTo","globalObject","BrowserClient","breadcrumbIntegration","isRealNavigator","hasSendBeacon","sendBeacon","cachedFetchImpl","getNativeFetchImplementation","document","fetchImpl","contentWindow","makeFetchTransport","nativeFetch","requestOptions","XHR_READYSTATE_DONE","makeXHRTransport","UNKNOWN_FUNCTION","CHROME_PRIORITY","WINJS_PRIORITY","GECKO_PRIORITY","createFrame","filename","lineno","colno","chromeRegex","chromeEvalRegex","isEval","subMatch","extractSafariExtensionDetails","chromeStackLineParser","geckoREgex","geckoEvalRegex","gecko","geckoStackLineParser","winjsRegex","winjs","winjsStackLineParser","defaultStackLineParsers","defaultStackParser","isSafariExtension","isSafariWebExtension","ignoreOnError","shouldIgnoreOnError","ignoreNextOnError","wrap","before","wrapper","sentryWrapped","wrappedArguments","arg","descriptor","GlobalHandlers","_installGlobalOnErrorHandler","_installGlobalOnUnhandledRejectionHandler","installFunc","globalHandlerLog","getHubAndOptions","_eventFromIncompleteOnError","_enhanceEventWithInitialFrame","addMechanismAndCapture","_eventFromRejectionWithPrimitive","ERROR_TYPES_RE","groups","ev","ev0","ev0s","ev0sf","DEFAULT_EVENT_TARGET","TryCatch","_wrapTimeFunction","_wrapRAF","_wrapXHR","eventTargetOption","eventTarget","_wrapEventTarget","originalCallback","xmlHttpRequestProps","prop","wrapOptions","originalFunction","eventName","wrappedEventHandler","originalEventHandler","DEFAULT_KEY","DEFAULT_LIMIT","LinkedErrors","_handler","linkedErrors","_walkErrorTree","HttpContext","referrer","Dedupe","eventProcessor","currentEvent","previousEvent","_isSameMessageEvent","_isSameExceptionEvent","currentMessage","previousMessage","_isSameFingerprint","_isSameStacktrace","previousException","_getExceptionFromEvent","currentException","currentFrames","_getFramesFromEvent","previousFrames","frameA","frameB","currentFingerprint","previousFingerprint","Integrations.InboundFilters","Integrations.FunctionToString","init","window","startSessionTracking","startSessionOnHub","init$1","f","require$$0","k","l","m","n","q","g","d","h","reactJsxRuntime_production_min","module","EditorMode","NavPosition","defaultShapes","emoticonsList","props","defaultStickers","StickerCategoryMessages","defaultObjectProps","BrushTypes","BrushSizes","EditorTheme","DEFAULT_THEMES","ToolName","r","t","clsx","SvgIcon","forwardRef","size","title","color","children","viewBox","width","svgProps","getSizeClassName","_jsx","createSvgIcon","displayName","Component","React","createSvgIconFromTree","treeToElement","tree","map","node","createElement","tag","child","TuneIcon","PhotoSizeSelectLargeIcon","CropIcon","TextFieldsIcon","ExtensionIcon","FaceIcon","FilterFramesIcon","MergeIcon","RoundedCornerIcon","PhotoLibraryIcon","HistoryIcon","StyleIcon","DeleteIcon","DrawIcon","HomeIcon","HISTORY_DISPLAY_NAMES","DEFAULT_NAV_ITEMS","toolName","editor","navItemMessages","FileDownloadIcon","PIXIE_VERSION","packageConfig","DEFAULT_CONFIG","_a","createStoreImpl","createState","listeners","setState","partial","replace","nextState","previousState","getState","api","createStore","u","useSyncExternalStoreShim_production_min","require$$1","v","w","withSelector_production_min","useSyncExternalStoreWithSelector","useSyncExternalStoreExports","useStore","selector","equalityFn","slice","useDebugValue","createImpl","createStore__default","useBoundStore","create","create$1","subscribeWithSelectorImpl","set","get","origSubscribe","optListener","currentSlice","nextSlice","previousSlice","subscribeWithSelector","Q","Z","L","s","o","nn","X","rn","y","tn","U","j","O","S","P","M","x","H","A","z","I","E","R","en","on","D","F","G","W","B","un","an","lowerFirst","string","mergeConfig","userConfig","currentConfig","replaceDefaultConfigItems","config","iterablesKey","createHistorySlice","historySliceDefaults","id","pointer","ActiveToolOverlay","createFilterSlice","filterSliceDefaults","filterName","hasOptions","createCropSlice","cropSliceDefaults","rect","angle","scaledRect","isText","ObjectName","OBJ_DISPLAY_NAMES","isImage","DEFAULT_ACTIVE_OBJ_PROPS","fabricObjToState","shadow","createObjectsSlice","objectsSliceDefaults","defaultEditableProps","_c","_b","_e","_d","createFrameSlice","frameSliceDefaults","createResizeSlice","resizeSliceDefaults","newSize","oldSize","createCornersSlice","cornerSliceDefaults","newRadius","immerImpl","initializer","store","updater","produce","immer","colorName","isArrayish","concat","swizzle","simpleSwizzleModule","results","colorNames","hasOwnProperty","reverseNames","cs","colorStringModule","prefix","model","abbr","hex","rgba","per","keyword","rgb","hexAlpha","i2","clamp","hsl","alpha","hwb","hexDouble","hsla","hwba","min","cssKeywords","reverseKeywords","convert","conversions","channels","labels","delta","rdif","gdif","bdif","diff","diffc","comparativeDistance","reversed","currentClosestDistance","currentClosestKeyword","distance","xyz","t2","t3","t1","smin","lmin","sv","hsv","hi","vmin","sl","wh","bl","cmyk","lab","y2","x2","z2","lch","hr","saturation","ansi","mult","rem","colorString","char","integer","chroma","grayscale","hue","hcg","pure","mg","apple","gray","buildGraph","graph","models","deriveBFS","fromModel","queue","adjacents","adjacent","link","wrapConversion","toModel","cur","route","conversion","wrapRaw","wrappedFn","arg0","wrapRounded","routes","colorConvert","skippedModels","hashedModelKeys","limiters","Color","newArray","zeroArray","hashedKeys","places","roundToPlace","getset","maxfn","rgbArray","alphaHex","lum","chan","color2","lum1","lum2","contrastRatio","degrees","mixinColor","weight","color1","w1","w2","assertArray","roundTo","number","channel","modifier","length","pixieThemeToCssTheme","theme","defaultTheme","mergedTheme","parsedColors","parseThemeValue","rootEl","setRootEl","setThemeColor","applyThemeToDom","EMPTY_PLAIN_RECT","newZoom","isDirty","isLoading","overlay","partialConfig","mergedConfig","language","lines","themes","activeTheme","panelName","isOpen","activeToolName","toolSlice","wasDirty","tools","fabricCanvas","resetEditor","fetchStateJsonFromUrl","staticObjectConfig","getCurrentCanvasState","customProps","canvas","activeFrame","setActiveTool","overlayName","getToolForObj","canvasIsEmpty","nanoid","byte","ToastTimer","remaining","__publicField","maximumVisible","getDefaultDuration","useToastStore","opts","amountToRemove","toastId","toastType","toast","toastIndex","newToasts","toastState","createRoot","MotionConfigContext","createContext","MotionContext","useVisualElementContext","useContext","PresenceContext","isBrowser","useIsomorphicLayoutEffect","useLayoutEffect","useEffect","LazyContext","useVisualElement","visualState","createVisualElement","parent","lazyContext","presenceContext","reducedMotionConfig","visualElementRef","useRef","visualElement","isRefObject","useMotionRef","externalRef","useCallback","instance","isVariantLabel","isAnimationControls","variantProps","isControllingVariants","isVariantNode","getCurrentTreeVariants","initial","animate","useCreateMotionContext","useMemo","variantLabelsAsDependency","createDefinition","propNames","featureDefinitions","loadFeatures","features","useConstant","globalProjectionState","useProjectionId","LayoutGroupContext","VisualElementHandler","React__default","SwitchLayoutGroupContext","motionComponentSymbol","createMotionComponent","preloadedFeatures","projectionNodeConstructor","useRender","useVisualState","MotionComponent","configAndProps","layoutId","useLayoutId","isStatic","projectionId","undefined","lazyStrictMode","strict","initialLayoutGroupConfig","_jsxs","ForwardRefComponent","layoutGroupId","createMotionProxy","createConfig","custom","customMotionComponentConfig","componentCache","_target","lowercaseSVGElements","isSVGComponent","scaleCorrectors","transformPropOrder","transformProps","isForcedMotionValue","layout","isMotionValue","translateAlias","sortTransformProps","buildTransform","transform","transformKeys","enableHardwareAcceleration","allowTransformNone","transformIsDefault","transformTemplate","transformString","isCSSVariable","getValueAsType","sanitize","floatRegex","colorRegex","singleColorRegex","scale","createUnitType","unit","percent","px","vh","vw","progressPercentage","isColorString","testProp","splitColor","aName","bName","cName","lightness","alpha$1","clampRgbUnit","rgbUnit","red","green","blue","parseHex","colorToken","numberToken","test","analyse","numColors","colors","numbers","parse","createTransformer","tokenised","numValues","convertNumbersToZero","getAnimatableNone","parsed","complex","maxDefaults","applyDefaultFilter","defaultValue","functionRegex","filter","functions","int","numberValueTypes","buildHTMLStyles","latestValues","vars","transformOrigin","hasTransform","hasTransformOrigin","transformIsNone","valueType","valueAsType","originX","originY","originZ","createHtmlRenderState","copyRawValuesOnly","useInitialMotionValues","useStyle","styleProp","useHTMLProps","htmlProps","animationProps","tapProps","panProps","inViewProps","validMotionProps","isValidMotionProp","shouldForward","loadExternalIsValidProp","isValidProp","filterProps","isDom","forwardMotionProps","filteredProps","calcOrigin","origin","calcSVGTransformOrigin","dimensions","pxOriginX","pxOriginY","dashKeys","camelKeys","buildSVGPath","attrs","spacing","useDashCase","pathLength","pathSpacing","buildSVGAttrs","attrX","attrY","pathOffset","latest","createSvgRenderState","useSVGProps","visualProps","rawStyles","createUseRender","elementProps","camelToDash","renderHTML","projection","camelCaseAttributes","renderSVG","renderState","_styleProp","scrapeMotionValuesFromProps","newValues","scrapeMotionValuesFromProps$1","targetKey","resolveVariantFromProps","definition","currentValues","currentVelocity","isKeyframesTarget","isCustomValue","resolveFinalValueInKeyframes","resolveMotionValue","unwrappedValue","makeState","createRenderState","onMount","makeLatestValues","makeUseVisualState","make","scrapeMotionValues","motionValues","isControllingVariants$1","isVariantNode$1","isInitialAnimationBlocked","variantToSet","resolved","transitionEnd","transition","valueTarget","svgMotionConfig","htmlMotionConfig","createDomMotionConfig","AnimationType","addDomEvent","useDomEvent","useFocusGesture","whileFocus","animationState","onFocus","onBlur","isMouseEvent","isTouchEvent","filterPrimaryPointer","eventHandler","defaultPagePoint","pointFromTouch","pointType","point","pointFromMouse","extractEventInfo","wrapHandler","shouldFilterPrimaryPointer","supportsPointerEvents","supportsTouchEvents","supportsMouseEvents","mouseEventNames","touchEventNames","getPointerEventName","addPointerEvent","usePointerEvent","createLock","lock","openLock","globalHorizontalLock","globalVerticalLock","getGlobalLock","drag","openHorizontal","openVertical","isDragActive","openGestureLock","createHoverEvent","isActive","info","useHoverGesture","onHoverStart","onHoverEnd","whileHover","isNodeOrChild","useUnmountEffect","__rest","warning","invariant","safeMin","minDuration","maxDuration","minDamping","maxDamping","findSpring","bounce","velocity","mass","derivative","dampingRatio","undampedFreq","exponentialDecay","calcAngularFreq","initialGuess","approximateRoot","stiffness","rootIterations","durationKeys","physicsKeys","isSpringType","getSpringOptions","springOptions","derived","spring","restSpeed","restDelta","damping","isResolvedFromDuration","resolveSpring","zero","resolveVelocity","createSpring","initialVelocity","initialDelta","undampedAngularFreq","angularFreq","dampedAngularFreq","freqForT","isBelowVelocityThreshold","isBelowDisplacementThreshold","_t","progress","toFromDifference","mix","hueToRgb","hslaToRgba","mixLinearColor","fromExpo","toExpo","colorTypes","getColorType","mixColor","fromColorType","toColorType","fromColor","toColor","blended","isNum","combineFunctions","pipe","transformers","getMixer","mixComplex","mixArray","blendValue","fromThis","mixObject","numNumbers","numRGB","numHSL","template","originStats","targetStats","mixNumber","detectMixerFactory","createMixers","ease","customMixer","mixers","mixerFactory","numMixers","mixer","easingFunction","fastInterpolate","slowInterpolate","inputLength","lastInputIndex","mixerIndex","foundMixerIndex","progressInRange","interpolate","isClamp","interpolator","reverseEasing","easing","mirrorEasing","createExpoIn","power","createBackIn","createAnticipate","backEasing","DEFAULT_OVERSHOOT_STRENGTH","BOUNCE_FIRST_THRESHOLD","BOUNCE_SECOND_THRESHOLD","BOUNCE_THIRD_THRESHOLD","linear","easeIn","easeOut","easeInOut","circIn","circOut","circInOut","backIn","backOut","backInOut","anticipate","ca","cb","cc","bounceOut","p2","bounceIn","bounceInOut","defaultEasing","defaultOffset","_value","convertOffsetToTimes","keyframes","createInterpolator","decay","timeConstant","modifyTarget","amplitude","ideal","types","detectAnimationFromOptions","defaultTimestep","getCurrentTime","onNextFrame","createRenderStep","runNextFrame","toRun","toRunNextFrame","numToRun","isProcessing","flushNextFrame","toKeepAlive","step","keepAlive","immediate","addToCurrentFrame","frameData","maxElapsed","useDefaultElapsed","stepsOrder","steps","sync","process","startLoop","cancelSync","processStep","stepId","processFrame","getFrameData","loopElapsed","elapsed","reverseElapsed","isForwardPlayback","hasRepeatDelayElapsed","framesync","update","passTimestamp","autoplay","driver","repeatMax","repeatType","repeatDelay","onPlay","onStop","onComplete","onRepeat","onUpdate","driverControls","repeatCount","computedDuration","isComplete","interpolateFromNumber","animator","animation","repeat","complete","play","velocityPerSecond","frameDuration","inertia","bounceStiffness","bounceDamping","currentAnimation","isOutOfBounds","boundaryNearest","startAnimation","startSpring","boundary","heading","a1","a2","calcBezier","getSlope","subdivisionPrecision","subdivisionMaxIterations","binarySubdivide","aX","aA","aB","mX1","mX2","currentX","currentT","newtonIterations","newtonMinSlope","newtonRaphsonIterate","aGuessT","currentSlope","kSplineTableSize","kSampleStepSize","cubicBezier","mY1","mY2","sampleValues","getTForX","intervalStart","currentSample","lastSample","guessForT","initialSlope","useTapGesture","onTap","onTapStart","onTapCancel","whileTap","hasPressListeners","isPressing","cancelPointerEndListeners","eventOptions","onPointerDown","removePointerEndListener","checkPointerEnd","onPointerUp","onPointerCancel","defaultEnvironment","warned","warnOnce","condition","observerCallbacks","observers","fireObserverCallback","entry","fireAllObserverCallbacks","entries","initIntersectionObserver","root","lookupRoot","rootObservers","observeIntersection","rootInteresectionObserver","useViewport","whileInView","onViewportEnter","onViewportLeave","viewport","shouldObserve","useMissingIntersectionObserver","useIntersectionObserver","thresholdNames","rootMargin","amount","once","intersectionCallback","isIntersecting","fallback","makeRenderlessComponent","hook","gestureAnimations","usePresence","isPresent","onExitComplete","register","useId","shallowCompare","prevLength","secondsToMilliseconds","seconds","easingLookup","easingDefinitionToFunction","x1","y1","isEasingArray","isAnimatable","underDampedSpring","criticallyDampedSpring","linearTween","defaultTransitions","getDefaultTransition","valueKey","transitionFactory","defaultValueTypes","getDefaultValueType","defaultValueType","instantAnimationState","isTransitionDefined","when","delayChildren","staggerChildren","staggerDirection","convertTransitionToAnimationOptions","yoyo","flip","loop","getDelayFromTransition","getValueTransition","hydrateKeyframes","getPopmotionAnimationOptions","getAnimation","valueTransition","isTargetAnimatable","isZero","getZeroUnit","isOriginAnimatable","start","finalTarget","potentialUnitType","delayTimer","controls","isNumericalString","isZeroValueString","addUniqueItem","removeItem","SubscriptionManager","numSubscriptions","isFloat","MotionValue","render","subscription","passiveEffect","motionValue","testValueType","auto","dimensionValueTypes","findDimensionValueType","valueTypes","findValueType","getCurrent","getVelocity","resolveVariant","setMotionValue","setTarget","checkTargetForNewValues","newValueKeys","numNewValues","targetValue","getOriginFromTransition","getOrigin","transitionOrigin","isWillChangeMotionValue","animateVisualElement","animations","variant","animateVariant","resolvedDefinition","animateTarget","getChildAnimations","forwardDelay","animateChildren","first","last","transitionOverride","willChange","animationTypeState","shouldBlockAnimation","maxStaggerDuration","generateStaggerDuration","sortByTreeOrder","protectedKeys","needsAnimating","shouldBlock","variantPriorityOrder","reversePriorityOrder","numAnimationTypes","animateList","createAnimationState","isInitialRender","buildResolvedTypeValues","setAnimateFunction","makeAnimator","animateChanges","changedActiveType","removedKeys","encounteredKeys","removedVariantIndex","typeState","propIsVariant","activeDelta","isInherited","variantDidChange","checkVariantsDidChange","shouldAnimateType","definitionList","resolvedValues","prevResolvedValues","allKeys","markToAnimate","fallbackAnimation","fallbackTarget","shouldAnimate","setActive","createTypeState","safeToRemove","convertBoundingBoxToBox","left","right","bottom","transformBoxPoints","transformPoint","topLeft","bottomRight","measureViewportBox","prefersReducedMotion","hasReducedMotionListener","initPrefersReducedMotion","motionMediaQuery","setReducedMotionPreferences","names","createLifecycles","managers","propSubscriptions","lifecycles","manager","propListener","updateMotionValuesFromProps","nextValue","prevValue","existingValue","latestValue","featureNames","numFeatures","treeType","build","getBaseTarget","makeTargetAnimatable","renderInstance","readValueFromInstance","removeValueFromRenderState","sortNodePosition","presenceId","blockInitialAnimation","isMounted","valueSubscriptions","prevMotionValues","baseTarget","removeFromVariantTree","triggerBuild","bindToMotionValue","removeOnChange","removeOnRenderRequest","initialMotionValues","newInstance","renderedProps","isStrict","ProjectionNodeConstructor","isEnabled","dragConstraints","layoutScroll","closestVariantNode","other","visibility","canMutate","newProps","startAtParent","numVariantProps","cssVariableRegex","parseCSSVariable","token","getVariableValue","resolveCSSVariables","positionalKeys","isPositionalKey","hasPositionalKey","setAndResetVelocity","isNumOrPxType","BoundingBoxDimension","getPosFromMatrix","matrix","pos","getTranslateFromMatrix","pos2","pos3","_bbox","matrix3d","nonTranslationalTransformKeys","removeNonTranslationalTransform","removedTransforms","positionalValues","paddingLeft","paddingRight","paddingTop","paddingBottom","convertChangedValueTypes","changedKeys","originBbox","elementComputedStyle","display","targetBbox","checkAndConvertChangedValueTypes","targetPositionalKeys","removedTransformValues","hasAttemptedToRemoveTransformValues","changedValueTypeKeys","fromType","toType","numKeyframes","fromIndex","scrollY","convertedTarget","unitConversion","parseDomVariant","getComputedStyle","htmlConfig","domElement","defaultType","computedStyle","transformPagePoint","mutableState","transformValues","htmlVisualElement","svgVisualElement","_element","createDomVisualElement","useIsMounted","useForceUpdate","forcedRenderCount","setForcedRenderCount","useState","forceRender","PopChildMeasure","getSnapshotBeforeUpdate","prevProps","childRef","sizeRef","offsetHeight","offsetWidth","offsetTop","offsetLeft","componentDidUpdate","PopChild","useInsertionEffect","dataset","motionPopId","appendChild","sheet","insertRule","removeChild","cloneElement","PresenceChild","presenceAffectsLayout","mode","presenceChildren","newChildrenMap","childId","delete","forEach","Map","getChildKey","updateChildLookup","allChildren","onlyElements","filtered","Children","isValidElement","push","AnimatePresence","exitBeforeEnter","forceRenderLayoutGroup","filteredChildren","childrenToRender","exiting","Set","presentChildren","clear","_Fragment","presentKeys","targetKeys","numPresent","indexOf","insertionIndex","onExit","removeIndex","findIndex","presentChild","splice","has","console","warn","LazyMotion","setIsLoaded","isLazyBundle","loadedRenderer","renderer","loadedFeatures","then","domAnimation","$458b0a5536c1a7cf$export$40bfa8c7b0832715","value1","onChange","stateValue","setStateValue","$6imuh$useState","$6imuh$useRef","wasControlled","isControlled","stateRef","setValue","$6imuh$useCallback","value2","onChangeCaller","onChangeArgs","oldValue","functionArgs","interceptedValue","$9446cca9a3875146$export$7d15b64cf5a3a4c4","$9446cca9a3875146$export$cb6e0bb50bc19463","remainder","snappedValue","pow","$9446cca9a3875146$export$b6268554fba451f","digits","$704cf1d3b684cc5c$var$defaultContext","$704cf1d3b684cc5c$var$SSRContext","$89yE2$react","$704cf1d3b684cc5c$export$535bd6ca7f90a273","isInSSRContext","$89yE2$useContext","isSSR","setIsSSR","$89yE2$useState","$89yE2$useLayoutEffect","$f0a04ccd8dbdd83b$export$e5c5a5f917a5871c","$12uGp$react","$bdb11010cef70236$var$idsUpdaterMap","$bdb11010cef70236$export$cd8c9cb68f842629","idA","idB","setIdA","setIdB","$ff5963eb1fccf552$export$e08e3b67e392101e","callbacks","$3ef42575df84b30b$export$9d1611c77c2fe928","$12uGp$clsx","$7215afc6de606d6b$export$de79e2c695e052f3","$7215afc6de606d6b$var$supportsPreventScroll","scrollableElements","$7215afc6de606d6b$var$getScrollableElements","$7215afc6de606d6b$var$restoreScrollPosition","$7215afc6de606d6b$var$supportsPreventScrollCached","focusElem","rootScrollingElement","scrollTop","scrollLeft","$bbed8b41f857bcc0$var$transitionsByElement","$bbed8b41f857bcc0$var$transitionCallbacks","$bbed8b41f857bcc0$var$setupGlobalEvents","onTransitionStart","transitions","onTransitionEnd","properties","$bbed8b41f857bcc0$export$24490316f764c430","$03deb23ff14920c4$export$4eaf04e54aa8eed6","globalListeners","$12uGp$useRef","addGlobalListener","$12uGp$useCallback","removeGlobalListener","removeAllGlobalListeners","$12uGp$useEffect","$df56164dff5785e2$export$4338b53315abf666","forwardedRef","objRef","$5df64b3807dc15ee$var$visualViewport","$5df64b3807dc15ee$export$d699905dd57c73ca","size1","setSize","$12uGp$useState","$5df64b3807dc15ee$var$getViewportSize","onResize","$c87311424ea30a05$var$testPlatform","re","$c87311424ea30a05$export$9ac100e40613ea10","__viteBrowserExternal","fabric","exports","jsdom","virtualWindow","require$$2","_removeEventListener","eventListener","_once","off","fire","listenersForEvent","nonSplicing","objects","somethingRemoved","deep","filler","sqrt","atan2","PiBy180","PiBy2","angleSlice","sign","idx","radians","newPoint","vector","sin","cos","rx","ry","C","AB","AC","ro","phi","points","openPath","coords","strokeUniformScalar","getStrokeHatVector","scalar","bisector","bisectorVector","miterVector","ignoreOffset","xPoints","minX","maxX","yPoints","minY","maxY","fractionDigits","fontSize","namespace","attributes","crossOrigin","img","onLoadCallback","div","reviver","enlivenedObjects","numLoadedObjects","numTotalObjects","onLoaded","klass","enlivenProps","enlivedProps","patterns","numLoadedPatterns","numPatterns","enlivenedPatterns","elements","newCanvas","canvasEl","format","quality","is2x2","denom","scaleX","scaleY","skewX","theta","scaleMatrix","multiply","degreesToRadians","ctx","tolerance","_isTransparent","temp","imageData","attribute","meetOrSlice","alignX","alignY","aspectRatioAttrs","align","fontFamily","ar","maximumArea","roughWidth","perfLimitSizeY","inverted","finalTransform","center","dimX","dimY","transformMatrix","bbox","c1","c2","prevStyle","thisStyle","forTextSpans","styles","text","textLines","charIndex","stylesArray","styleChanged","styleIndex","stylesObject","_join","commandLengths","repeatedCommands","segmentToBezier","th2","th3","cosTh","sinTh","cx1","cy1","mT","fromX","fromY","costh2","sinth2","costh3","sinth3","toX","toY","cp1X","cp1Y","cp2X","cp2Y","arcToSegments","large","sweep","rotateX","PI","th","py","rx2","ry2","py2","px2","pl","cx","cy","mTheta","calcVectorAngle","dtheta","segments","mDelta","ux","uy","vx","vy","ta","tb","getBoundsOfCurve","x0","y0","x3","y3","argsString","abs","tvalues","bounds","b2ac","sqrtb2ac","jlen","mt","fromArcToBeziers","fx","fy","rot","tx","ty","segsNorm","makePathSimpler","converted","destinationPath","controlX","controlY","calcLineLength","CB1","CB2","CB3","CB4","getPointOnCubicBezierIterator","p1x","p1y","p2x","p2y","p3x","p3y","p4x","p4y","pct","c3","c4","getTangentCubicIterator","invT","tangentX","tangentY","QB1","QB2","QB3","getPointOnQuadraticBezierIterator","getTangentQuadraticIterator","pathIterator","iterator","tempP","tmpLen","perc","findPercentageForDistance","segInfo","nextLen","nextStep","angleFinder","lastPerc","getPathSegmentsInfo","tempInfo","getPointOnPath","infos","segPercent","command","segment","parsePath","pathString","currentPath","rNumber","rNumberCommaWsp","rFlagCommaWsp","rArcSeq","regArcArgumentSequence","coordsStr","coordsParsed","commandLength","repeatedCommand","klen","getSmoothPathFromPoints","correction","p1","multSignX","multSignY","manyPoints","midPoint","transformPath","pathSegment","newSegment","pathData","invoke","byProperty","find","extend","clone","camelize","character","capitalize","firstLetterOnly","escapeXml","graphemeSplit","textstring","chr","graphemes","getWholeChar","code","emptyFunction","IS_DONTENUM_BUGGY","addMethods","superclass","Subclass","callSuper","methodName","parentMethod","_this","superClassMethod","createClass","couldUseAttachEvent","touchEvents","getTouchInfo","touchProp","scroll","_evt","setStyle","elementStyle","setOpacity","normalizedProperty","parseEl","supportsOpacity","supportsFilters","reOpacity","es","_slice","getById","sliceCanConvertNodelists","toArray","arrayLike","makeElement","tagName","addClass","wrapElement","getScrollLeftTop","docElement","getElementOffset","docElem","box","scrollLeftTop","offsetAttributes","getElementStyle","selectProp","makeElementUnselectable","makeElementSelectable","getNodeCanvas","impl","cleanUpJsdomNode","setImageSmoothing","addParamToUrl","param","emptyFn","RUNNING_ANIMATIONS","cancelled","cancelFunc","noop","cancel","removeFromRegistry","requestAnimFrame","finish","time","abort","isMany","startValue","endValue","byValue","ticktime","currentTime","timePerc","valuePerc","_requestAnimFrame","_cancelAnimFrame","cancelAnimFrame","calculateColor","begin","end","animateColor","startColor","endColor","originalOnComplete","originalOnChange","posValue","elastic","easeOutCubic","easeInOutCubic","easeInQuart","easeOutQuart","easeInOutQuart","easeInQuint","easeOutQuint","easeInOutQuint","easeInSine","easeOutSine","easeInOutSine","easeInExpo","easeOutExpo","easeInOutExpo","easeInCirc","easeOutCirc","easeInOutCirc","easeInElastic","easeOutElastic","easeInOutElastic","easeInBack","easeOutBack","easeInOutBack","easeInBounce","easeOutBounce","easeInOutBounce","toFixed","parseUnit","multiplyTransformMatrices","svgValidTagNames","svgViewBoxElements","svgInvalidAncestors","svgValidParents","attributesMap","colorAttributes","fSize","cPath","getSvgRegex","normalizeAttr","normalizeValue","parentAttributes","isArray","fillIndex","strokeIndex","_setStrokeFillOpacity","_getMultipleNodes","nodeNames","nodeName","nodeArray","nodeList","rotateMatrix","multiplierX","multiplierY","skewMatrix","translateMatrix","iMatrix","commaWsp","skewY","rotate","translate","transforms","transformList","reTransformList","reTransform","attributeValue","matrices","combinedMatrix","parseStyleString","oStyle","chunk","pair","parseStyleObject","getGlobalStylesForElement","svgUid","rule","elementMatchesRule","selectors","firstMatching","parentMatching","selectorMatches","doesSomeParentMatch","classNames","matcher","elementById","nodelist","parseUseDirectives","xlinkAttribute","xlink","el2","currentTrans","parentNode","oldLength","applyViewboxTransform","el3","reViewBoxAttrValue","viewBoxAttr","viewBoxWidth","viewBoxHeight","widthAttr","heightAttr","preserveAspectRatio","missingViewBox","missingDimAttr","toBeParsed","parsedDim","widthDiff","heightDiff","hasAncestorWithNodeName","parsingOptions","descendants","clipPaths","instances","recursivelyParseGradientsXlink","gradient","gradientsAttrs","xlinkAttr","xLink","referencedGradient","referenceClone","reFontDeclaration","fontStyle","fontWeight","lineHeight","tagArray","elList","gradientDefs","parentFontSize","ownAttributes","cssAttrs","normalizedAttr","normalizedValue","normalizedStyle","mergedAttrs","parsedPoints","allRules","rules","styleContents","ruleObj","declaration","propertyValuePairs","_rule","xml","allElements","storage","regex","gradientDef","opacityAttr","container","_newObj","usingElement","clipPath","objTransformInv","gTransform","clipPathTag","clipPathOwner","Point","that","dx","dy","Intersection","b1","b2","uaT","ubT","uB","ua","ub","inter","points1","points2","r1","r2","topRight","bottomLeft","inter1","inter2","inter3","inter4","average","currentAlpha","otherColor","otherAlpha","otherSource","hue2rgb","isShortNotation","isRGBa","oColor","scaleMap","skewMap","LEFT","TOP","RIGHT","BOTTOM","CENTER","opposite","radiansToDegrees","findCornerQuadrant","fabricObject","control","cornerAngle","fireEvent","canvasOptions","scaleIsProportional","eventData","uniScaleKey","uniformIsToggled","isTransformCentered","scalingIsForbidden","by","scaleProportionally","lockX","lockY","scaleCursorStyleHandler","notAllowed","skewCursorStyleHandler","scaleSkewCursorStyleHandler","scaleOrSkewActionName","isAlternative","rotationStyleHandler","commonEventInfo","wrapWithFixedAnchor","actionHandler","centerPoint","constraint","actionPerformed","wrapWithFireEvent","getLocalPoint","zoom","padding","localPoint","targetHasOneFlip","compensateScaleForSkew","oppositeSkew","scaleToCompensate","axis","reference","newDim","newValue","skewObjectX","dimNoSkew","totalSkewSize","currentSkew","newSkew","hasSkewed","dimBeforeSkewing","skewObjectY","skewHandlerX","localPointFromCenter","finalHandler","skewHandlerY","rotationWithSnapping","pivotPoint","lastAngle","curAngle","hasRotated","snapAngle","snapThreshold","rightAngleLocked","leftAngleLocked","scaleObject","lockScalingX","lockScalingY","dim","forbidScaling","signX","signY","gestureScale","originalDistance","oldScaleX","oldScaleY","scaleObjectFromCorner","scaleObjectX","scaleObjectY","scalingYOrSkewingX","scalingXOrSkewingY","changeWidth","strokePadding","multiplier","oldWidth","newWidth","dragHandler","newLeft","newTop","moveX","moveY","renderCircleControl","styleOverride","xSize","ySize","transparentCorners","stroke","myLeft","myTop","renderSquareControl","xSizeBy2","ySizeBy2","Control","controlKey","objectVisibility","finalMatrix","objectAngle","objectCornerSize","centerX","centerY","isTouch","cosHalfOffset","sinHalfOffset","cosHalfOffsetComp","sinHalfOffsetComp","controlTriangleAngle","cornerHypotenuse","newTheta","newThetaComp","cornerSize","getColorStop","colorAlpha","opacity","keyValuePairs","getLinearCoords","getRadialCoords","option","colorStops","position","propertiesToInclude","markup","commonAttributes","needsSwap","offsetX","offsetY","withViewport","gradientUnits","minRadius","maxRadius","percentageShift","colorStop","svgOptions","colorStopEls","gradientTransform","__convertPercentUnitsToValues","propValue","finalValue","NUM_FRACTION_DIGITS","patternSource","patternWidth","patternHeight","patternOffsetX","patternOffsetY","patternImgSrc","shadowStr","offsetsAndBlur","fBoxX","fBoxY","BLUR_BOX","removeFromArray","invertTransform","createCanvasElement","CANVAS_INIT_ERROR","scaleRatio","image","overlayColor","backgroundColor","lowerCanvasEl","cssValue","vpt","activeObject","backgroundObject","overlayObject","after","canvasToDrawOn","iVpt","needsVpt","vpCenter","originalValue","bgImage","overlayImage","bgColor","shouldTransform","fontList","row","rowIndex","_char","fontPaths","finalWidth","finalHeight","shouldInvert","additionalTransform","activeSelection","objs","intersecting","newIdx","objsMoved","pointerPoint","adjustedDistance","lastPoint","newPoints","cDistance","originalRenderOnAddRemove","circles","circle","group","circleRadius","circleColor","rects","ilen","sprayChunk","uniqueRects","uniqueRectsArray","radius","dotWidth","dotDistance","patternCanvas","patternCtx","getPointer","activeObjects","objsToRender","activeGroupObjects","invertedM","vptPointer","normalizedPointer","targetRelativeX","targetRelativeY","isTransparent","originalColor","selectionKeyPressed","action","altKey","centerTransform","corner","alreadySelected","viewportStart","viewportExtent","extent","strokeOffset","skipGroup","ignoreZoom","aObjects","activeTarget","activeTargetSubs","shouldLookForActive","globalPointer","subTarget","objToCheck","pointerToUse","upperCanvasEl","boundsWidth","boundsHeight","cssScale","retinaScaling","lowerCanvasClass","fromEl","toEl","active","oldObjects","somethingChanged","added","removed","oldObject","currentActives","originalProperties","layoutProps","originalValues","addListener","removeListener","RIGHT_CLICK","MIDDLE_CLICK","LEFT_CLICK","addEventOptions","checkClick","functor","eventjsFunctor","canvasElement","eventTypePrefix","changedTouches","groupSelector","shouldRender","isClick","targetWasActive","mouseUpHandler","originalControl","originalMouseUpHandler","targets","button","shouldGroup","mouseDownHandler","_hoveredTarget","_hoveredTargets","_draggedoverTarget","inOpt","outOpt","oldTarget","outFires","inFires","targetChanged","canvasEvtIn","canvasEvtOut","hoverCursor","currentActiveObjects","isActiveLower","groupObjects","aGroup","currentObject","selectionX1Y1","selectionX2Y2","allowIntersect","cropping","scaledWidth","scaledHeight","originalWidth","originalHeight","vp","translateX","translateY","originalInteractive","newVp","originalRetina","originalContextTop","json","renderOnAddRemove","enlivenedCanvasClip","loaded","cbIfLoaded","enlivedObject","objectCaching","ALIASING_LIMIT","dims","perfLimitSizeTotal","limitedDims","capValue","objectScale","neededX","neededY","targetCanvas","minCacheSize","drawingWidth","drawingHeight","zoomX","zoomY","dimensionsChanged","zoomChanged","shouldRedraw","additionalWidth","additionalHeight","shouldResizeCanvas","canvasWidth","canvasHeight","sizeGrowing","sizeShrinking","needFullTransform","prototype","stateProperties","retina","shouldConstrainValue","isChanged","groupNeedsUpdate","forClipping","originalFill","originalStroke","skipCanvas","decl","dashArray","drawBorders","drawControls","scaling","multX","multY","pCanvas","pCtx","preserveAspectRatioOptions","objectForm","utils","origParams","originalGroup","originalShadow","boundingRect","shadowOffset","shadowBlur","originalCanvas","shouldCenterOrigin","pClicked","objectLeftTop","extraParam","originXOffset","originYOffset","fromOriginX","fromOriginY","toOriginX","toOriginY","leftTop","hypotFull","xFull","yFull","offsetFrom","offsetTo","originPoint","arrayFromCoords","util","multiplyMatrices","absolute","calculate","pointTL","pointBR","intersection","otherCoords","allPointsAreOutside","oCoords","xi","xcount","iLine","lineKey","boundingRectFactor","cosP","sinP","cosPSinP","cosPMinusSinP","aCoords","lineCoords","startMatrix","skipCorners","sep","cache","tMatrix","strokeWidth","noSkew","getSvgColorString","skipShadow","fillRule","strokeDashArray","strokeDashOffset","strokeLineCap","strokeLineJoin","strokeMiterLimit","useWhiteSpace","term","textDecoration","deltaY","decoration","full","svgTransform","textBgRects","objectMarkup","commonPieces","noStyle","styleInfo","shadowInfo","vectorEffect","absoluteClipPath","clipPathMarkup","originalSet","saveProps","tmpObj","_isEqual","origValue","currentValue","firstPass","propertySet","dashedPropertySet","forTouch","ey","controlObject","hasControls","shouldStroke","strokeUniform","borderScaleFactor","visible","empty","propsToAnimate","skipCallbacks","propPair","propIsColor","valueProgress","timeProgress","coordProps","makeEdgeToOriginGetter","origStrokeStyle","xMult","yMult","parsedAttributes","_callback","propertyNames","originValues","axis1","axis2","dimension","nearest","farthest","svgString","startX","startY","endX","endY","largeFlag","isValidRadius","widthBy2","heightBy2","piBy2","isRounded","projectStrokeOnPoints","calcDim","correctLeftTop","correctSize","diffX","diffY","_class","subpathStartX","subpathStartY","aY","deltaX","pathUrl","elivenedObjects","isAlreadyGrouped","skipControls","objectLeft","objectTop","nested","_includeDefaultValues","objsToObject","originalDefaults","_obj","sourcePath","ownCache","groupMatrix","onlyWidthHeight","iLen","jLen","minXY","maxXY","newGroup","childrenOverride","backend","filters","filterObj","imageMarkup","strokeSvg","imageRendering","clipPathId","origFill","src","minimumScale","elementToFilter","cacheKey","sourceWidth","sourceHeight","imgElement","elementToDraw","cropX","cropY","elWidth","elHeight","sX","sY","sW","sH","maxDestW","maxDestH","pAR","rWidth","rHeight","pWidth","pHeight","_object","resizeFilters","imgOptions","testPrecision","gl","fragmentSource","fragmentShader","tileSize","isSupported","precisions","WebglFilterBackend","canMeasurePerf","canUseImageData","canUseArrayBuffer","canUseUint8Clamped","imageBuffer","copyGLTo2DPutImageData","testContext","startTime","drawImageTime","putImageDataTime","copyGLTo2DDrawImage","glOptions","cachedTexture","pipelineState","tempFbo","resizeCanvasIfNeeded","textureImageSource","texture","uniqueId","gpuInfo","ext","vendor","dWidth","dHeight","glCanvas","sourceY","numBytes","u8","u8Clamped","imgData","Canvas2dFilterBackend","sourceElement","originalImageData","vertexSource","vertexShader","program","attributeLocations","uniformLocations","aPositionData","attributeLocation","main","shader","textureUnit","helpLayer","mainP","colorsOnly","constants","brightness","shaderSource","weights","side","halfSide","sw","sh","dst","alphaFac","dstOff","scx","scy","srcOff","wt","noise","rand","_j","_iLen","_jLen","lowC","highC","tr","tg","alpha1","resources","canvas1","blendData","floor","ceil","filterWindow","lobeFunction","taps","offsets","lobes","xx","oW","oH","dW","dH","doneW","doneH","stepW","stepH","tmpCanvas","dX","dY","fX","fY","ratioX","icenter","ratioY","range2X","cacheLanc","range2Y","lanczos","rcpRatioX","rcpRatioY","srcData","destData","destImg","xDiff","yDiff","chnl","origPix","w4","pixels","destImage","destPixels","ratioW","ratioH","ratioWHalf","ratioHHalf","img2","data2","weightsAlpha","gxR","gxG","gxB","gxA","yy","w0","contrast","contrastF","adjust","avg","amt","canvas2","ctx1","ctx2","nSamples","random","blur","newImageData","blurScale","gamma","rInv","gInv","bInv","subFilters","rad","aThird","aThirdSqtSin","OneMinusCos","additionalProps","newLines","diffSpace","currentLineWidth","numberOfSpaces","accumulatedSpace","charBound","spaces","lineIndex","charStyle","forMeasuring","maxWidth","heightOfLine","lineLeftOffset","lastColor","leftOffset","lineTopOffset","boxStart","boxWidth","charBox","currentColor","drawStart","cacheProp","previousChar","prevCharStyle","fontCache","fontDeclaration","previousFontDeclaration","couple","stylesAreEqual","coupleWidth","previousWidth","fontMultiplier","kernedWidth","lineInfo","grapheme","prevGrapheme","graphemeInfo","numOfSpaces","lineBounds","positionInPath","startingPoint","totalPathLength","reverse","centerPosition","skipLeft","charSpacing","previousBox","maxHeight","lineHeights","isJustify","actualStyle","nextStyle","charsToRender","timeToRender","shortCut","isLtr","drawingLeft","currentDirection","fullDecl","shouldFill","fillOffsets","strokeOffsets","schema","loc","lineWidth","lineDiff","textAlign","direction","isEndOfWrapping","shouldClear","_size","_dy","lastDecoration","topOffset","currentDecoration","currentFill","lastFill","styleObject","family","fontIsGeneric","newLine","newText","allProperties","needsDims","isAddingPath","_key","parsedAnchor","textContent","originalStrokeWidth","textHeightScaleFactor","lineHeightDiff","scaledDiff","textHeight","offX","objectCopy","textInstance","pathInstance","p3","stylesCount","letterCount","stylePropertyValue","allStyleObjectPropertiesMatch","graphemeCount","stylePropertyHasBeenSet","lineNum","charNum","selectionStart","skipWrapping","startIndex","endIndex","lineStyle","parseDecoration","skipRestore","boundaries","cursorPosition","bound","cursorLocation","charHeight","cursorWidth","selectionEnd","startLine","endLine","startChar","endChar","lineOffset","realLineHeight","boxEnd","drawWidth","drawHeight","extraTop","cp","objCopy","targetOpacity","completeMethod","tickState","restart","startFrom","reNonWord","newSelectionStart","newSelectionEnd","currentStart","currentEnd","smallerTextStart","graphemeStart","smallerTextEnd","graphemeEnd","_text","newSelection","desiredPosition","upperCanvas","upperCanvasWidth","upperCanvasHeight","isTextChanged","hiddenTextarea","cursorStart","cursorEnd","lineStart","charStart","lineEnd","charEnd","styleObj","numericChar","clonedStyles","numericLine","qty","copiedStyle","currentCharStyle","newLineStyles","somethingAdded","isEndOfLine","numIndex","styleCarriedOver","quantity","currentLineStyles","currentLineStylesCloned","numericIndex","newStyle","insertedText","cursorLoc","addedLines","linesLength","newPointer","currentActive","mouseOffset","prevWidth","distanceBtwLastCharAndCursor","distanceBtwNextCharAndCursor","keyMap","fromPaste","nextText","charCount","nextCharCount","removedText","charDiff","selection","removeFrom","removeTo","textareaSelection","backDelete","widthBeforeCursor","isRight","selectionProp","indexOnOtherLine","textAfterCursor","textBeforeCursor","missingNewlineOffset","widthOfCharsOnLine","indexOnLine","charWidth","foundMatch","leftEdge","rightEdge","offsetFromLeftEdge","offsetFromRightEdge","change","actionName","changed","multipleSpacesRegex","textAndBg","noShadow","textTopOffset","textLeftOffset","textSpans","styleDecl","shouldUseWhitespace","styleProps","fillStyles","dySpan","fillColor","lastHeight","svgStyle","textInfo","realLineCount","realLineCharCount","nextLineIndex","nextOffset","shouldLimit","mapNextLine","desiredWidth","word","charOffset","_line","reservedSpace","splitByGrapheme","graphemeLines","words","infix","wordWidth","infixWidth","largestWordWidth","lineJustStarted","additionalSpace","linesToKeep","controlsUtils","scaleSkewStyleHandler","scaleStyleHandler","scalingEqually","objectControls","textBoxControls","DEFAULT_OBJ_CONFIG","randomString","possible","initFabric","textureSize","objectDefaults","activeInteraction","setActiveInteraction","ZoomTool","resize","NP","stageHeight","stageWidth","opt","loadFabricImage","PixieCanvas","applyZoom","resizeHelper","currentZoom","loadStateName","stateJson","stateObj","isSvgSticker","SIZE_AND_POSITION_PROPS","fireObjModifiedEvent","buildObjModifiedEvent","sizeOrPositionChanged","bindToFabricSelectionEvents","shouldPreventObjDeselect","selectNewObj","objIsHandledByActiveTool","ObjectTool","objectOrId","objId","objOrId","fontChanged","clonedObj","DEFAULT_SERIALIZED_EDITOR_STATE","createHistoryItem","params","TEXT_CONTROLS_PADDING","TextTool","providedConfig","itext","minWidth","textObj","loadFonts","fonts","prefixSrc","promises","fontConfig","loadedFont","fontFace","isAbsoluteUrl","assetUrl","uri","HistoryTool","newItems","getUsedFonts","MergeTool","filterList","filterNameMessages","filterOptionMessages","ucFirst","FilterTool","newFilter","mainImage","optionName","optionValue","fabricFilter","curr","editableOptions","initialConfig","imgFilters","fabricFilters","filterConfig","applied","matrix1","matrix2","clampResizePayload","getMinWidth","aspectToHeight","getMaxWidth","getMinHeight","aspectToWidth","getMaxHeight","usePercentages","minHeight","newHeight","hRatio","wRatio","ResizeTool","currentWidth","currentHeight","widthScale","heightScale","tempScaleX","tempScaleY","tempLeft","tempTop","drawCropzone","refs","drawInnerZone","drawMask","drawLines","contWidth","contHeight","rightLeft","horSpace","verSpace","calcNewSizeFromAspectRatio","aspectRatio","oldHeight","aspectRatioFromStr","centerWithinBoundary","CropTool","frameName","frameSize","aspectRatioStr","boundaryRect","newRect","ShapeTool","shapes","shape","shapeName","fabricShape","shapeType","categoryName","cat","stickerUrl","sticker","objectName","stickerName","FramePatterns","part","images","FrameBuilder","partName","fullWidth","fullHeight","ActiveFrame","FrameTool","sizePercent","percentage","VLineBrush","vLinePatternBrush","HLineBrush","hLinePatternBrush","DiamondBrush","diamondBrush","squareWidth","squareDistance","SquareBrush","squareBrush","DrawTool","getPathConfig","brush","staticObjConfig","extensionFromFilename","fullFileName","getFileMime","file","extensionsToMime","fileExtension","activeWorkspaceId","getActiveWorkspaceId","UploadedFile","relativePath","generateId","reader","mime","lastModified","encodeFilename","encodeCharacter","suffix","createUploadInput","old","buildUploadInputAccept","extensions","accept","openUploadWindow","fileList","uploads","addImage","fitToScreen","UploadInputType","prettyBytes","neg","units","exponent","WildcardMatcher","matches","ii","partsCount","testParts","wildcard","reMimePartSplit","mimeMatch","validateUpload","restrictions","maxFileSize","allowedFileTypes","blockedFileTypes","fileMatchesTypes","convertToBytes","ImportTool","stateContentType","fileData","contentTypes","imgContentTypes","errorMessage","validExtensions","WatermarkTool","watermarkText","halfWidth","halfHeight","line1","line2","line3","line4","this","b64toBlob","b64Data","contentType","sliceSize","byteCharacters","byteArrays","byteNumbers","byteArray","ExportTool","exportConfig","blob","saveAs","watermark","CornersTool","TransformTool","newAngle","currentRotateAngle","cw","ch","iw","ih","diagAngle","ang1","ang2","dist1","dist2","relationToCanvas","newTransform","oldHelper","newHelper","initTools","observeSize","observer","getBoundingClientRect","toolbarStyle","toolbarAnimation","exit","getButtonSizeStyle","equalWidth","getIconSizeStyle","getSharedButtonStyle","outline","contained","border","disabled","createEventHandler","ButtonBase","justify","href","form","elementType","onClick","onKeyDown","domProps","Element","isLink","Button","startIcon","endIcon","mergedClassName","InlineIcon","icon","assign","vrgs","nanomemoize","vargs","wm","eq","maxargs","srlz","Section","label","buildListboxCollection","maxItems","collection","childrenToCollection","filteredCollection","filterCollection","filterIndex","meta","reactChildren","optionIndex","setOption","section","sectionIndex","sectionItemIndex","getTextLabel","childIndex","nestedChild","nestedChildIndex","content","getSide","placement","getAlignment","getMainAxisFromPlacement","getLengthFromAxis","computeCoordsFromPlacement","_ref","rtl","floating","commonX","commonY","mainAxis","commonAlign","isVertical","computePosition","strategy","middleware","platform","statefulPlacement","middlewareData","resetCount","nextX","nextY","reset","expandPaddingObject","getSideObjectFromPadding","rectToClientRect","detectOverflow","middlewareArguments","_await$platform$isEle","rootBoundary","elementContext","altBoundary","paddingObject","clippingClientRect","elementClientRect","within","min$1","max$1","arrow","alignment","arrowDimensions","minProp","maxProp","endDiff","startDiff","arrowOffsetParent","clientSize","centerToReference","alignmentOffset","hash$1","getOppositePlacement","matched","getAlignmentSides","mainAlignmentSide","hash","getOppositeAlignmentPlacement","getExpandedPlacements","oppositePlacement","_middlewareData$flip","initialPlacement","checkMainAxis","checkCrossAxis","specifiedFallbackPlacements","fallbackStrategy","flipAlignment","detectOverflowOptions","fallbackPlacements","placements","overflow","overflows","overflowsData","cross","_middlewareData$flip$","_middlewareData$flip2","nextIndex","nextPlacement","resetPlacement","_overflowsData$map$so","convertValueToCoords","mainAxisMulti","crossAxisMulti","rawValue","crossAxis","alignmentAxis","diffCoords","getCrossAxis","shift","limiter","mainAxisCoord","crossAxisCoord","minSide","maxSide","limitedCoords","apply","heightSide","widthSide","xMin","xMax","yMin","yMax","nextDimensions","isWindow","getWindow","ownerDocument","getNodeName","getUAString","uaData","isHTMLElement","isNode","isShadowRoot","OwnElement","isOverflowElement","overflowX","overflowY","isTableElement","isContainingBlock","isFirefox","isLayoutViewport","includeScale","isFixedStrategy","_win$visualViewport$o","_win$visualViewport","_win$visualViewport$o2","_win$visualViewport2","clientRect","win","addVisualOffsets","getDocumentElement","getNodeScroll","getWindowScrollBarX","isScaled","getRectRelativeToOffsetParent","offsetParent","isOffsetParentAnElement","documentElement","offsetRect","getParentNode","getTrueOffsetParent","getContainingBlock","currentNode","getOffsetParent","getDimensions","convertOffsetParentRelativeRectToViewportRelativeRect","getViewportRect","html","visualViewport","layoutViewport","getDocumentRect","_element$ownerDocumen","getNearestOverflowAncestor","getOverflowAncestors","list","_node$ownerDocument","scrollableAncestor","isBody","updatedList","contains","rootNode","getInnerBoundingClientRect","getClientRectFromClippingAncestor","clippingParent","getClippingAncestors","clippingAncestors","clipperElement","getClippingRect","firstClippingAncestor","clippingRect","accRect","clippingAncestor","autoUpdate","_ancestorScroll","_ancestorResize","elementResize","animationFrame","ancestorScroll","ancestorResize","ancestors","ancestor","initialUpdate","frameId","prevRefRect","frameLoop","nextRefRect","_observer","computePosition$1","deepEqual","useLatestRef","useFloating","_temp","whileElementsMounted","setData","latestMiddleware","setLatestMiddleware","_ref2","cleanupRef","dataRef","whileElementsMountedRef","isMountedRef","ReactDOM","runElementMountCallback","cleanupFn","setReference","setFloating","isRef","arrow$1","useFloatingPosition","floatingWidth","disablePositioning","showArrow","arrowRef","floatingConfig","offsetMiddleware","availableHeight","availableWidth","floatingProps","mergedReferenceRef","mergeRefs","arrowX","arrowY","staticSide","arrowStyle","useListbox","role","virtualFocus","loopFocus","onItemSelected","clearInputOnItemSelection","floatingMinWidth","showCheckmark","showEmptyMessage","isAsync","selectionMode","listboxId","setInputValue","useControlledState","activeCollection","setActiveCollection","collections","listItemsRef","listContent","selectedValues","selectValues","useControlledSelection","setIsOpen","activeIndex","setActiveIndex","selectedOption","selectedIndex","setSelectedIndex","focusItem","fallbackOperation","newIndex","allItemsDisabled","lastIndex","getNonDisabledIndex","onInputChange","allowEmptySelection","selectionEnabled","stateValues","setStateValues","mixedValue","ListBoxContext","useListboxContext","CheckIcon","ListItemBase","capitalizeFirst","description","endSection","isDisabled","isSelected","iconClassName","itemClassName","Item","textLabel","onSelected","handleItemSelection","includes","tabIndex","currentTarget","focus","preventDefault","MOBILE_SCREEN_WIDTH","useIsMobileDevice","useIsSSR","PopoverAnimation","useOverlayViewport","useViewportSize","$8a9cb279dc87e130$export$60278871457622de","$8a9cb279dc87e130$export$905e7fc544a71f36","nativeEvent","$8a9cb279dc87e130$export$715c682d09d639cc","$bx7SL$useRef","$bx7SL$useLayoutEffect","$bx7SL$useCallback","e1","onBlurHandler","_current","$ae1eeba8b9eafd08$export$5165eccb35aaadb5","$bx7SL$react","$507fabe10e71c6fb$var$currentModality","$507fabe10e71c6fb$var$changeHandlers","$507fabe10e71c6fb$var$hasSetupGlobalListeners","$507fabe10e71c6fb$var$hasEventBeforeFocus","$507fabe10e71c6fb$var$hasBlurredWindowRecently","$507fabe10e71c6fb$var$triggerChangeHandlers","modality","$507fabe10e71c6fb$var$isValidKey","$bx7SL$isMac","$507fabe10e71c6fb$var$handleKeyboardEvent","$507fabe10e71c6fb$var$handlePointerEvent","$507fabe10e71c6fb$var$handleClickEvent","$507fabe10e71c6fb$var$handleFocusEvent","$507fabe10e71c6fb$var$handleWindowBlur","$507fabe10e71c6fb$var$setupGlobalFocusEvents","$507fabe10e71c6fb$export$630ff653c5ada6a9","$9ab94262bd0047c7$export$420e68273165f4ec","onBlurWithin","onFocusWithin","onFocusWithinChange","onSyntheticFocus","$e0b6e0b68ec7f50f$export$872b660ac5a1ff98","onInteractOutside","onInteractOutsideStart","$bx7SL$useEffect","$e0b6e0b68ec7f50f$var$isValidEvent","onMouseUp","onTouchEnd","$6a99195332edec8b$export$80f3e147d781571c","$6nfFC$getInteractionModality","lastFocusedElement","$6nfFC$runAfterTransition","$6nfFC$focusWithoutScrolling","$645f2e67b85a24c9$var$isStyleVisible","isVisible","computedDisplay","computedVisibility","$645f2e67b85a24c9$var$isAttributeVisible","childElement","$645f2e67b85a24c9$export$e989c0fffaa6b27a","$9bf71ea28793e738$var$FocusContext","$6nfFC$react","$9bf71ea28793e738$var$activeScope","$9bf71ea28793e738$var$scopes","$9bf71ea28793e738$export$20e40289641fbbb6","contain","restoreFocus","autoFocus","startRef","$6nfFC$useRef","endRef","scopeRef","$6nfFC$useContext","parentScope","$6nfFC$useLayoutEffect","nodes","$9bf71ea28793e738$var$isAncestorScope","$9bf71ea28793e738$var$useFocusContainment","$9bf71ea28793e738$var$useRestoreFocus","$9bf71ea28793e738$var$useAutoFocus","focusManager","$9bf71ea28793e738$var$createFocusManagerForScope","$9bf71ea28793e738$export$10c5169755ce7bd7","tabbable","sentinel","walker","$9bf71ea28793e738$export$2d6ec8fc375ceafa","$9bf71ea28793e738$var$getScopeRoot","$9bf71ea28793e738$var$isElementInScope","nextNode","$9bf71ea28793e738$var$focusElement","previousNode","$9bf71ea28793e738$var$focusableElements","$9bf71ea28793e738$var$FOCUSABLE_ELEMENT_SELECTOR","$9bf71ea28793e738$var$TABBABLE_ELEMENT_SELECTOR","focusedNode","raf","scope1","focusedElement","nextElement","$9bf71ea28793e738$var$isElementInChildScope","$9bf71ea28793e738$var$focusFirstInScope","$6nfFC$useEffect","$9bf71ea28793e738$var$isElementInAnyScope","autoFocusRef","nodeToRestoreRef","nodeToRestore","$5b160d28a433310d$export$c17fa47878dc55b6","locale","strings","$5b160d28a433310d$var$getStringsForLocale","messages","defaultLocale","$5b160d28a433310d$var$getLanguage","$488c6ddbf4ef74c2$var$formatterCache","$488c6ddbf4ef74c2$var$supportsSignDisplay","$488c6ddbf4ef74c2$var$supportsUnit","$488c6ddbf4ef74c2$var$UNITS","$488c6ddbf4ef74c2$export$cc77c4ff7e8673c5","$488c6ddbf4ef74c2$export$711b50b3c525e0f2","unitDisplay","startParts","endParts","$488c6ddbf4ef74c2$var$getCachedNumberFormatter","numberingSystem","numberFormatter","numberFormat","signDisplay","needsPositiveSign","negative","noSign","$a11501f3d1d39e6c$var$visibleOverlays","$a11501f3d1d39e6c$export$ea8f71083e90600f","onClose","shouldCloseOnBlur","isDismissable","isKeyboardDismissDisabled","shouldCloseOnInteractOutside","$k7QOs$useEffect","onHide","$k7QOs$useInteractOutside","focusWithinProps","$k7QOs$useFocusWithin","onPointerDownUnderlay","Popover","triggerRef","viewPortStyle","useObjectRef","overlayProps","useOverlay","onScroll","Node","requestAnimationFrame","addEventListener","removeEventListener","mergeProps","FocusScope","opacityAnimation","Underlay","disableInitialTransition","Tray","shallowEqual","objA","objB","aKeys","bKeys","BoostrapDataContext","useBootstrapData","useSelectedLocale","i18n","handlePluralMessage","localeCode","count","Number","pluralPlaceholder","pluralConfig","choices","choiceName","getRules","select","choiceConfig","startsWith","choice","substring","Intl","PluralRules","Trans","initialMessage","translatedMessage","Fragment","nodePlaceholders","tagNames","regexArray","tagNameMatchers","join","nodePlaceholderMatchers","RegExp","compiledMessage","Boolean","endsWith","renderFn","areEqual","nextProps","otherProps","nextValues","nextOtherProps","Listbox","listbox","trigger","mobileOverlay","isMobile","positionStyle","Overlay","renderedSections","reduce","createPortal","FocusContainer","domRef","preventScroll","EmptyMessage","useListboxKeyboardNavigation","useCollator","formatter","useTypeSelect","collator","getMatchingIndex","getStringForKey","useMediaQuery","noSSR","supportsMatchMedia","setMatches","mq","useIsMobileMediaQuery","MenuTrigger","menuTrigger","menu","handleTriggerKeyDown","handleListboxKeyboardNavigation","findMatchingItem","Menu","DropdownButton","menuItems","IconButton","iconSize","_MixedIcon","iconEl","Array","MixedIcon","MixedText","ToolbarButton","ButtonWithLabel","IconOnlyButton","buttonColor","buttonVariant","ButtonGroup","multiple","childValue","toggleMultipleValue","buttons","adjustedColor","getStyle","UndoIcon","RedoIcon","UndoRedoBtns","canUndo","history","canRedo","undo","redo","RemoveIcon","AddIcon","ZoomWidget","allowUserZoom","canZoomOut","zoomOut","Math","canZoomIn","zoomIn","ToolbarItem","CloseIcon","useEditorMode","isModal","MainToolbar","allowEditorClose","ui","menubar","groupMenuItems","closeButton","close","groupedItems","mobileOnly","desktopOnly","Object","sort","fromEntries","CropzoneSizeIndicator","crop","zoneRect","ActiveToolbar","activeTool","CancelButton","getToolName","ApplyButton","dirty","cancelChanges","defaultCmp","CROP","allowCustomRatio","applyChanges","ToolbarContainer","merge","LoadingIndicator","activeLoadState","setActiveLoadState","subscribe","loading","loadState","setTimeout","V","v1","v2","rubberband","constant","rubberbandIfOutOfBounds","computeRubberband","Vx","Vy","Rx","Ry","X0","X1","Y0","Y1","_defineProperty","ownKeys","enumerableOnly","symbols","sym","_objectSpread2","EVENT_TYPE_MAP","actionsWithoutCaptureSupported","hasCapture","capture","actionKey","toHandlerProp","device","deviceProps","pointerCaptureEvents","parseProp","eventKey","passive","captureKey","toDomEventType","getPointerType","getCurrentTargetTouchList","_event$currentTarget","_event$currentTarget$","getTouchList","getValueEvent","distanceAngle","P1","P2","touchIds","touch","touchDistanceAngle","ids","pointerId","valueEvent","pointerValues","LINE_HEIGHT","PAGE_HEIGHT","wheelValues","deltaMode","getEventDetails","shiftKey","metaKey","ctrlKey","call","chain","fns","assignDefault","BEFORE_LAST_KINEMATICS_DELAY","Engine","ctrl","shared","ingKey","dt","_absoluteDelta","_m0","_m1","t0","_step","movement","v0","previousOffset","gestureIsActive","ox","oy","absoluteDelta","selectAxis","absDx","absDy","CoordinatesEngine","identity","DEFAULT_RUBBERBAND","commonConfigResolver","_k","DEFAULT_AXIS_THRESHOLD","coordinatesConfigResolver","_v","DISPLACEMENT","KEYS_DELTA_MAP","factor","DragEngine","boundRect","targetRect","_bounds","ctrlIds","_values","dirx","diry","mx","my","svx","svy","sx","sy","sdt","persistEvent","deltaFn","bindFunction","isTouchScreen","supportsPointerLock","supportsGestureEvents","SUPPORT","DEFAULT_PREVENT_SCROLL_DELAY","DEFAULT_DRAG_DELAY","DEFAULT_SWIPE_VELOCITY","DEFAULT_SWIPE_DISTANCE","DEFAULT_SWIPE_DURATION","DEFAULT_DRAG_AXIS_THRESHOLD","dragConfigResolver","mouse","filterTaps","tapsThreshold","SCALE_ANGLE_RATIO_INTENT_DEG","PINCH_WHEEL_RATIO","PinchEngine","lastOffset","axisMovementDifference","ctrlTouchIds","_pointerEvents","ctrlPointerIds","prev_a","delta_a","delta_turns","_previousMovement","modifierKey","pinchConfigResolver","scaleBounds","angleBounds","_scaleBounds","_angleBounds","EngineMap","ConfigResolverMap","registerAction","dragAction","pinchAction","_objectWithoutPropertiesLoose","excluded","sourceKeys","_objectWithoutProperties","sourceSymbolKeys","sharedConfigResolver","_excluded","resolveWith","resolvers","resolver","newConfig","gestureKey","_config","rest","EventStore","TimeoutStore","ms","Controller","resolveGestures","nativeHandlers","sharedConfig","gestureConfig","bindToProps","nativeBindFunction","handlerProp","setupGesture","internalHandlers","withPassiveOption","isNative","_options$capture","_options$passive","RE_NOT_NATIVE","sortHandlers","_handlers","native","actions","registerGesture","handlerKey","startKey","endKey","parseMergedHandlers","mergedHandlers","useRecognizers","createUseGesture","interactableEvent","usePointerEvents","onMoveStart","onMove","onMoveEnd","minimumMovement","stopPropagation","onPress","onLongPress","useGlobalListeners","onPointerMove","longPressTriggered","restrictResizableWithinBoundary","boundedRect","leftRestriction","topRestriction","domRectToObj","resizeHandlePosition","resetState","useResize","boundaryRef","restrictWithinBoundary","pointerProps","resizable","resizeRect","applyBounds","prevRect","isLeftSideHandle","isTopSideHandle","widthRestriction","heightRestriction","CornerHandle","inset","getPositionClass","MaskPosition","MaskPart","getClassNameByPosition","Line","useMove","Cropzone","isMoving","setIsMoving","canvasSize","controlConfig","cropzone","defaultRatio","selectedAspectRatio","moveProps","drawZone","resizeProps","onResizeStart","onResizeEnd","registerRefs","resetCropzone","innerZone","hideTopLeft","hideTopRight","hideBottomLeft","hideBottomRight","CustomDuplicateIcon","CustomFlipIcon","CustomFrontSortingIcon","CustomRemoveIcon","floatingControlsSize","duplicate","flipHorizontally","bringToFront","FloatingObjectControls","Icon","repositionFloatingControls","floatingControlsTopOffset","stage","stageSize","canvasTopMargin","canvasLeftMargin","canvasRightMargin","canvasBottomMargin","maxTop","maxLeft","maxRight","maxBottom","getBoundingRect","floatingTop","floatingLeft","rotateActiveObj","moveActiveObj","resizeActiveObj","syncBoxPositionWithActiveObj","boxRef","floatingControlsRef","angleRad","enableTextEditing","RotationControl","useRotate","rotatable","rotateVal","rotation","getDragAngle","ObjectBox","activeObjId","isEditingText","objTypeConfig","getObjTypeConfig","doubleTapTimer","doubleTapHandler","clearTimeout","canvasRef","setActiveIsMoving","lockMovement","unlockAspectRatio","rotateProps","onRotateEnd","onRotate","hideRotatingPoint","getActive","objName","StageOverlays","cropToolIsActive","objIsSelected","useGesture","CanvasWrapper","setIsVisible","variants","hidden","PanContainer","backgroundImage","bind","onPinch","shouldHandleGesture","onDrag","pinching","findTarget","isDrawingMode","ToolControlsOverlayWrapper","actionBtn","arguments","defaultView","identifier","touches","pageX","pageXOffset","pageY","pageYOffset","onKey","which","keyCode","onTouchStart","onMouseDown","parseInt","K","toString","T","hsva","toLowerCase","Y","toHsva","equal","fromHsva","$","__webpack_nonce__","J","innerHTML","setAttribute","colorModel","defaultColor","qe","ke","escape","validate","spellCheck","Ie","Oe","prefixed","exec","$parcel$interopDefault","$7a451c0c6841e6b9$exports","$2d805fd52bb48883$exports","$6c28468dc1df643c$exports","$807554f8230db0ed$exports","$7097f64386f1761c$exports","$bdd847d8beb08799$exports","$a53e00b683950971$exports","$21cdd87e84f28d89$exports","$92fee9698e4d675a$exports","$7ea012e91a5ad3ee$exports","$8460c13bb2d75345$exports","$2a2d5dc14e680587$exports","$9a3f292371bb0589$exports","$4742231a685fa068$exports","$05e247fd2960981e$exports","$a67524a79ccbe190$exports","$a9eefe9d6c8cb7d5$exports","$4a6b836d4f1bfaba$exports","$c950e4b1c482abde$exports","$d10d6b60dc50b438$exports","$371a732b2494f452$exports","$6d042cae6243464b$exports","$d9ab5c2611e0bcd3$exports","$73f77c9902e29ca6$exports","$4f461eb266a95c10$exports","$dc46bea2f2597899$exports","$622bbd6719cc95af$exports","$4da03c1ecd9a9c7d$exports","$edb6b2fe456ed4e8$exports","$264cd81c52b30815$exports","$6f80afde0270dda7$exports","$23a92651c6957668$exports","$0f9b1074d04f4954$exports","$a9cedf75b94e4916$exports","$37cff576474bc8d4$exports","$799cddbef784668f$var$strings","$cBgAy$LocalizedStringDictionary","$799cddbef784668f$export$6e865ea70d7724f","$799cddbef784668f$var$RGBColor","$799cddbef784668f$var$HSBColor","$799cddbef784668f$var$HSLColor","$799cddbef784668f$var$Color","xyChannels","xChannel","yChannel","xCh","yCh","zCh","$cBgAy$clamp","$cBgAy$toFixedNumber","$cBgAy$NumberFormatter","$799cddbef784668f$var$HSB_REGEX","$799cddbef784668f$var$mod","$799cddbef784668f$var$HSL_REGEX","$b335ada08155d9c0$var$MIN_COLOR","$b335ada08155d9c0$var$MAX_COLOR","ColorSwatch","presetButtons","getInputFieldClassNames","startAdornment","endAdornment","startAppend","endAppend","labelPosition","labelDisplay","inputClassName","inputWrapperClassName","unstyled","invalid","background","flexibleHeight","sizeClass","inputSizeClass","isInputGroup","borderColor","ringColor","defaultPresets","ColorPicker","colorPresets","showInput","setColor","presets","HexColorPicker","newColor","parseColor","HexColorInput","DialogContext","useDialogContext","useTrans","DismissButton","onDismiss","trans","Dialog","dialogProps","contextProps","dismissButton","isTrayOrFullScreen","sizeStyle","dialogSize","KeyboardArrowDownIcon","Modal","DialogTrigger","moveFocusToDialog","returnFocusToTrigger","defaultIsOpen","onOpenChange","dialogTrigger","dialog","extractChildren","floatingStyle","labelId","descriptionId","formId","contextValue","rawChildren","ColorPickerButton","selectedColor","setSelectedColor","onColorChange","ArrowIcon","adornment","BaseSlider","inline","showValueLabel","slider","trackRef","getThumbPercent","getThumbValueLabel","groupId","thumbIds","minValue","maxValue","getValueLabel","outputValue","maxLabelLength","wrapperClassname","getElementById","useNumberFormatter","NumberFormatter","useSlider","formatOptions","onChangeEnd","setValues","valuesRef","draggedThumbs","setDraggedThumbs","draggedThumbsRef","getFormattedValue","isThumbDragging","getThumbMinValue","getThumbMaxValue","setThumbValue","isThumbEditable","thisMin","thisMax","snapValueToStep","replaceIndex","updateDraggedThumbs","dragging","wasDragging","focusedThumb","setFocusedThumb","getValuePercent","setThumbPercent","getPercentValue","getRoundedValue","editableThumbsRef","setThumbEditable","editable","realTimeTrackDraggingIndex","currentPointer","handlePointerDown","trackPosition","closestThumb","lastLeft","firstRight","onUpTrack","currentPosition","SliderThumb","isThumbDisabled","ariaLabel","inputRef","inputObjRef","isSliderDisabled","focusInput","isFocused","handlePointerUp","thumbColor","isDragging","parseFloat","isCheckBoxInput","isDateObject","Date","isNullOrUndefined","isObjectType","isObject","getEventValue","checked","getNodeParentName","search","isNameInFieldArray","compact","isUndefined","EVENTS","BLUR","FOCUS_OUT","CHANGE","VALIDATION_MODE","onSubmit","onTouched","all","HookFormContext","useFormContext","getProxyFormState","formState","_proxyFormState","localProxyFormState","isRoot","defineProperty","isEmptyObject","shouldRenderFormState","formStateData","convertToArrayPayload","shouldSubscribeByName","signalName","exact","some","currentName","useSubscribe","_props","tearDown","unsubscribe","subject","useFormState","methods","updateFormState","_formState","_localProxyFormState","dirtyFields","touchedFields","isValidating","isValid","errors","_name","_mounted","_subjects","generateWatchOutput","_names","formValues","isGlobal","watch","fieldName","watchAll","isFunction","objectHasFunction","useWatch","fieldValues","_formValues","updateValue","_getWatch","_removeUnmounted","useController","shouldUnregister","isArrayField","_defaultValues","_registerProps","updateMounted","field","_fields","_f","mount","_shouldUnregisterField","_stateFlags","unregister","elm","setCustomValidity","reportValidity","fieldState","defineProperties","enumerable","isTouched","Slider","baseProps","Adornment","dirClass","Field","descriptionProps","errorMessageProps","fieldClassNames","wrapperProps","Label","inputWrapper","Append","labelElementType","labelProps","labelSuffix","required","labelNode","useAutoFocus","autoSelectText","useField","focusRef","inputDomProps","defaultId","inputId","errorId","inputProps","labelledBy","describedBy","Select","hideCaret","placeholder","selectedValue","onInputValueChange","onSelectionChange","inputFieldProps","fieldProps","FilterControls","selectedFilter","selected","getByName","applyValue","setDirty","activeFilters","getMainImage","findFilterIndex","available","ActiveFrameControls","showColorPicker","builder","changeColor","getMinSize","getMaxSize","currentSizeInPercent","TabContext","TabLine","tabsRef","selectedTab","prevState","TabList","childrenArray","Tabs","isLazy","setSelectedTab","defaultSelectedTab","onTabChange","ContextValue","FormatUnderlinedIcon","FormatStrikethroughIcon","FormatItalicIcon","FormatAlignRightIcon","FormatAlignLeftIcon","FormatAlignCenterIcon","TextField","inputElementType","isTextArea","ElementType","inputFieldClassNames","rows","formProps","TextStyleTabPanel","FontSizeSelector","StyleSelector","AlignmentSelector","editableProps","valueAsNumber","underline","linethrough","setStyles","newStyles","newAlign","TabPanels","panelArray","rendered","panel","TabPanel","setTabIndex","getFocusableTreeWalker","MutationObserver","observe","subtree","childList","attributeFilter","disconnect","DEFAULT_GRADIENTS","TextureIcon","GradientIcon","AddPhotoAlternateIcon","ColorTabPanel","FillSelector","PreviewButtons","previewBtnClass","previewBtns","previewUrl","Gradient","patternFromUrlOrData","unshift","UploadButton","import","Promise","loadImage","Pattern","OpacityTabPanel","newOpacity","OutlineTabPanel","outlineColor","outlineWidth","ImageIcon","ImageTabPanel","setSrc","shadowDefaults","ShadowTabPanel","modifiedShadow","Shadow","Tab","useFocusManager","mergedClassname","textColor","focusPrevious","focusNext","focusFirst","focusLast","ActiveObjectControls","ActiveTextControls","ToolControlsOverlay","activeOverlay","activeToolOverlay","overlayCmp","getOverlay","Filter","Frame","Text","ActiveObject","CancelIcon","FilterButton","FilterImg","ActiveOverlay","ToggleSettingsButton","ScrollableView","gap","extendedChildren","isFirst","isLast","ScrollableViewItem","mergedClass","FilterNav","syncState","filterBtns","LockIcon","LockOpenIcon","CheckBoxOutlineBlankIcon","CheckboxFilledIcon","IndeterminateCheckboxFilledIcon","Checkbox","checkedIcon","isIndeterminate","orientation","CheckedIcon","indeterminate","setSelected","defaultChecked","updateChecked","CheckboxIcon","checkboxColor","font","ResizeNav","originalSize","formVal","formValue","setFormValue","onWidthChange","newVal","maintainAspect","onHeightChange","onAspectChange","isChecked","CropPresetBtns","selectedRatio","btns","preset","PresetPreview","PresetName","FlipIcon","FlipBtns","RotateLeftIcon","RotateRightIcon","RotateBtns","rotateLeft","rotateRight","TransformWidget","StraightenSlider","svgRef","straightenAngle","straighten","setTransformAngle","FreeTransformTrack","numberOfDots","CropNav","hide","show","CustomEllipseIcon","CustomCircleIcon","CustomSquareIcon","CustomTriangleIcon","ShapeNav","shapeBtns","addBasicShape","ShapeIcon","shapeIconMap","square","triangle","ellipse","getDeps","deps","depTime","newDeps","dep","resultTime","depEndTime","resultEndTime","resultFpsPercentage","pad","defaultKeyExtractor","defaultRangeExtractor","range","observeElementRect","_entries$","_entries$2","scrollProps","createOffsetObserver","propX","propY","prevX","prevY","scrollX","observeElementOffset","measureElement","elementScroll","canSmooth","_instance$scrollEleme2","Virtualizer","_opts","_this$options$onChang","_this$options","scrollElement","paddingStart","getItemKey","measurementsCache","measurements","measuredSize","outerSize","scrollOffset","calculateRange","rangeExtractor","overscan","indexes","makeMeasureElement","measurableItem","_this$itemMeasurement","measuredItemSize","itemSize","virtualItems","currentMeasureElements","_this$measureElementC","toOffset","smoothScroll","_temp2","measurement","_this$getMeasurements","scrollCheckFrame","check","findNearestBinarySearch","low","high","getCurrentValue","middle","useVirtualizerBase","rerender","resolvedOptions","useVirtualizer","useActiveTheme","StickerList","iterable","parentRef","virtualizer","horizontal","getScrollElement","estimateSize","scrollToIndex","getTotalSize","getVirtualItems","virtualColumn","addSticker","invertPreview","isDark","StickerNav","stickers","selectedCategory","setSelectedCategory","categoryBtns","newCategory","FrameNav","showOptionsPanel","frameItems","TextNav","catch","selectOrAddText","fontButtons","FontButton","selectedFont","descriptors","DrawNav","draw","enable","disable","currentBrush","setBrushColor","TypeSelect","SizeSelect","sizes","brushSizes","selectedSize","setSelectedSize","setBrushSize","brushTypes","selectedType","setSelectedType","setBrushType","getBrushPreview","isDarkMode","CornersNav","corners","showPreview","hidePreview","updatePreview","setRadius","navbarAnimation","ToolControls","toolNav","getToolNav","FILTER","RESIZE","DRAW","TEXT","SHAPES","STICKERS","FRAME","CORNERS","Navbar","NavItems","navItems","nav","ToolButton","clickHandler","HistoryPanel","togglePanel","load","DialogHeader","leftAdornment","rightAdornment","hideDismissButton","showDivider","getPadding","DialogBody","NewImageDialogTrigger","openPanels","newImage","NewImageDialog","activePanel","setActivePanel","DefaultPanel","NewCanvasPanel","uploadAndReplaceMainImage","SampleImagesPanel","sampleImages","openImageDialog","openBackgroundImage","thumbnail","setFormVal","setConfig","blankCanvasSize","openNew","addInitial","RadioGroup","Radio","sizeClassNames","getSizeClassNames","ExportDialogTrigger","export","ExportDialog","defaultName","defaultFormat","defaultQuality","save","ObjListPanel","activeId","selectable","OverlayPanelContainer","historyVisible","objectsVisible","_extends","Action","createPath","pathname","parsedPath","hashIndex","searchIndex","ResultType","resolvePath","fromPathname","toPathname","resolvePathname","normalizeSearch","normalizeHash","resolveTo","toArg","routePathnames","locationPathname","isPathRelative","isEmptyPath","routePathnameIndex","toSegments","hasExplicitTrailingSlash","hasCurrentTrailingSlash","joinPaths","paths","isPolyfill","is","useSyncExternalStore$2","getSnapshot","getServerSnapshot","inst","forceUpdate","checkIfSnapshotChanged","latestGetSnapshot","useSyncExternalStore$1","canUseDOM","isServerEnvironment","shim","useSyncExternalStore","NavigationContext","LocationContext","RouteContext","outlet","useHref","relative","useInRouterContext","basename","navigator","useResolvedPath","joinedPathname","createHref","useLocation","location","getPathContributingMatches","pathnameBase","useNavigate","routePathnamesJson","JSON","stringify","activeRef","go","DataRouterHook","AwaitRenderStatus","isModifiedEvent","shouldProcessLinkClick","Link","_ref4","reloadDocument","preventScrollReset","internalOnClick","useLinkClickHandler","handleClick","defaultPrevented","replaceProp","navigate","ErrorOutlineIcon","CheckCircleIcon","ToastContainer","toasts","timer","pause","resume","isCtrlKeyPressed","isMac","handleCanvasKeydown","draggables","droppables","dragSession","readFilesFromDataTransfer","dataTransfer","getEntries","getEntryFile","asyncIterableToArray","DROP_ACTIVATE_TIMEOUT","useDroppable","optionsRef","canDrop","draggable","fireDragLeave","getDraggable","PixieBootstrapDataProvider","bootstrapData","setBootstrapData","mergeBootstrapData","invalidateBootstrapData","ImageEditor","navPosition","menuPosition","stageRef","onDrop","files","getData","fileIsValid","openDroppedImageAsBackground","openUploadedFile","droppableProps","defaultTool","loadInitialContent","onLoad","unobserveStage","setStageSize","unobserveCanvas","setCanvasSize","rootClassName","showCloseIcon","onKeyDownCapture","Pixie","constructor","sentryDsn","initSentry","Error","querySelector","classList","defaultConfig","open","onOpen","uploadAndAddImage","uploadAndOpenStateFile","setStateFromUrl","openTool","notify","userOnLoad","_Pixie"],"mappings":"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ACR;AAAA,EACF;AACF,GCvFaC,KAAgB;AAAA,EAC3B;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AACF;AC1NgB,SAAAppB,GAAQkK,GAAamf,GAAyC;AAC5E,SAAO,EAAC,GAAGA,GAAO,SAASnf,EAAG;AAChC;ACQO,MAAMof,KAAqC;AAAA,EAChD;AAAA,IACE,MAAM;AAAA,IACN,MAAMF;AAAA,IACN,MAAM;AAAA,IA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"}